<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-str">1. Overview of Strimzi</a>
<ul class="sectlevel2">
<li><a href="#key-features-str">1.1. Kafka Key Features</a></li>
<li><a href="#document-conventions-str">1.2. Document Conventions</a></li>
</ul>
</li>
<li><a href="#getting-started-str">2. Getting started with Strimzi</a>
<ul class="sectlevel2">
<li><a href="#downloads-str">2.1. Installing Strimzi and deploying components</a></li>
<li><a href="#assembly-custom-resources-str">2.2. Custom resources</a>
<ul class="sectlevel3">
<li><a href="#con-custom-resources-example-str">2.2.1. Strimzi custom resource example</a></li>
<li><a href="#con-custom-resources-status-str">2.2.2. Strimzi custom resource status</a></li>
</ul>
</li>
<li><a href="#cluster-operator-str">2.3. Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#con-what-the-cluster-operator-does-str">2.3.1. Overview of the Cluster Operator component</a></li>
<li><a href="#con-cluster-operator-watch-options-str">2.3.2. Watch options for a Cluster Operator deployment</a></li>
<li><a href="#deploying-cluster-operator-str">2.3.3. Deploying the Cluster Operator to watch a single namespace</a></li>
<li><a href="#deploying-cluster-operator-to-watch-multiple-namespacesstr">2.3.4. Deploying the Cluster Operator to watch multiple namespaces</a></li>
<li><a href="#deploying-cluster-operator-to-watch-whole-cluster-str">2.3.5. Deploying the Cluster Operator to watch all namespaces</a></li>
<li><a href="#deploying-cluster-operator-helm-chart-str">2.3.6. Deploying the Cluster Operator using Helm Chart</a></li>
<li><a href="#deploying-cluster-operator-from-operator-hub-str">2.3.7. Deploying the Cluster Operator from OperatorHub.io</a></li>
</ul>
</li>
<li><a href="#kafka-cluster-str">2.4. Kafka cluster</a>
<ul class="sectlevel3">
<li><a href="#deploying-kafka-cluster-str">2.4.1. Deploying the Kafka cluster</a></li>
</ul>
</li>
<li><a href="#kafka-connect-str">2.5. Kafka Connect</a>
<ul class="sectlevel3">
<li><a href="#deploying-kafka-connect-str">2.5.1. Deploying Kafka Connect to your cluster</a></li>
<li><a href="#using-kafka-connect-with-plug-ins-str">2.5.2. Extending Kafka Connect with connector plug-ins</a></li>
</ul>
</li>
<li><a href="#kafka-mirror-maker-str">2.6. Kafka Mirror Maker</a>
<ul class="sectlevel3">
<li><a href="#deploying-kafka-mirror-maker-str">2.6.1. Deploying Kafka Mirror Maker</a></li>
</ul>
</li>
<li><a href="#kafka-bridge-str">2.7. Kafka Bridge</a>
<ul class="sectlevel3">
<li><a href="#deploying-kafka-bridge-str">2.7.1. Deploying Kafka Bridge to your Kubernetes cluster</a></li>
</ul>
</li>
<li><a href="#deploying-example-clients-str">2.8. Deploying example clients</a></li>
<li><a href="#assembly-getting-started-topic-operator-str">2.9. Topic Operator</a>
<ul class="sectlevel3">
<li><a href="#what-the-topic-operator-does-str">2.9.1. Overview of the Topic Operator component</a></li>
<li><a href="#deploying-the-topic-operator-using-the-cluster-operator-str">2.9.2. Deploying the Topic Operator using the Cluster Operator</a></li>
</ul>
</li>
<li><a href="#assembly-getting-started-user-operator-str">2.10. User Operator</a>
<ul class="sectlevel3">
<li><a href="#con-what-the-user-operator-does-str">2.10.1. Overview of the User Operator component</a></li>
<li><a href="#proc-deploying-the-user-operator-using-the-cluster-operator-str">2.10.2. Deploying the User Operator using the Cluster Operator</a></li>
</ul>
</li>
<li><a href="#assembly-getting-started-strimzi-admin-str">2.11. Strimzi Administrators</a>
<ul class="sectlevel3">
<li><a href="#proc-adding-users-the-strimzi-admin-role-str">2.11.1. Designating Strimzi Administrators</a></li>
</ul>
</li>
<li><a href="#container-images-str">2.12. Container images</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-str">3. Deployment configuration</a>
<ul class="sectlevel2">
<li><a href="#assembly-deployment-configuration-kafka-str">3.1. Kafka cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">3.1.1. Sample Kafka YAML configuration</a></li>
<li><a href="#considerations-for-data-storage-deployment-configuration-kafka">3.1.2. Data storage considerations</a></li>
<li><a href="#assembly-storage-deployment-configuration-kafka">3.1.3. Kafka and Zookeeper storage types</a></li>
<li><a href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">3.1.4. Kafka broker replicas</a></li>
<li><a href="#assembly-kafka-broker-configuration-deployment-configuration-kafka">3.1.5. Kafka broker configuration</a></li>
<li><a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">3.1.6. Kafka broker listeners</a></li>
<li><a href="#assembly-kafka-authentication-and-authorization-deployment-configuration-kafka">3.1.7. Authentication and Authorization</a></li>
<li><a href="#assembly-zookeeper-replicas-deployment-configuration-kafka">3.1.8. Zookeeper replicas</a></li>
<li><a href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">3.1.9. Zookeeper configuration</a></li>
<li><a href="#assembly-zookeeper-connection-deployment-configuration-kafka">3.1.10. Zookeeper connection</a></li>
<li><a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">3.1.11. Entity Operator</a></li>
<li><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">3.1.12. CPU and memory resources</a></li>
<li><a href="#assembly-logging-deployment-configuration-kafka">3.1.13. Logging</a></li>
<li><a href="#assembly-kafka-rack-deployment-configuration-kafka">3.1.14. Kafka rack awareness</a></li>
<li><a href="#assembly-healthchecks-deployment-configuration-kafka">3.1.15. Healthchecks</a></li>
<li><a href="#assembly-metrics-deployment-configuration-kafka">3.1.16. Prometheus metrics</a></li>
<li><a href="#assembly-jvm-options-deployment-configuration-kafka">3.1.17. JVM Options</a></li>
<li><a href="#assembly-configuring-container-images-deployment-configuration-kafka">3.1.18. Container images</a></li>
<li><a href="#assembly-tls-sidecar-deployment-configuration-kafka">3.1.19. TLS sidecar</a></li>
<li><a href="#assembly-scheduling-deployment-configuration-kafka">3.1.20. Configuring pod scheduling</a></li>
<li><a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">3.1.21. Kafka Exporter</a></li>
<li><a href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">3.1.22. Performing a rolling update of a Kafka cluster</a></li>
<li><a href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">3.1.23. Performing a rolling update of a Zookeeper cluster</a></li>
<li><a href="#scaling-clusters-deployment-configuration-kafka">3.1.24. Scaling clusters</a></li>
<li><a href="#proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka">3.1.25. Deleting Kafka nodes manually</a></li>
<li><a href="#proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka">3.1.26. Deleting Zookeeper nodes manually</a></li>
<li><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">3.1.27. Maintenance time windows for rolling updates</a></li>
<li><a href="#proc-renewing-ca-certs-manually-deployment-configuration-kafka">3.1.28. Renewing CA certificates manually</a></li>
<li><a href="#proc-replacing-private-keys-deployment-configuration-kafka">3.1.29. Replacing private keys</a></li>
<li><a href="#ref-list-of-kafka-cluster-resources-deployment-configuration-kafka">3.1.30. List of resources created as part of Kafka cluster</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-connect-str">3.2. Kafka Connect cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#assembly-kafka-connect-replicas-deployment-configuration-kafka-connect">3.2.1. Replicas</a></li>
<li><a href="#assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect">3.2.2. Bootstrap servers</a></li>
<li><a href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect">3.2.3. Connecting to Kafka brokers using TLS</a></li>
<li><a href="#assembly-kafka-connect-authentication-deployment-configuration-kafka-connect">3.2.4. Connecting to Kafka brokers with Authentication</a></li>
<li><a href="#assembly-kafka-connect-configuration-deployment-configuration-kafka-connect">3.2.5. Kafka Connect configuration</a></li>
<li><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect">3.2.6. CPU and memory resources</a></li>
<li><a href="#assembly-logging-deployment-configuration-kafka-connect">3.2.7. Logging</a></li>
<li><a href="#assembly-healthchecks-deployment-configuration-kafka-connect">3.2.8. Healthchecks</a></li>
<li><a href="#assembly-metrics-deployment-configuration-kafka-connect">3.2.9. Prometheus metrics</a></li>
<li><a href="#assembly-jvm-options-deployment-configuration-kafka-connect">3.2.10. JVM Options</a></li>
<li><a href="#assembly-configuring-container-images-deployment-configuration-kafka-connect">3.2.11. Container images</a></li>
<li><a href="#assembly-scheduling-deployment-configuration-kafka-connect">3.2.12. Configuring pod scheduling</a></li>
<li><a href="#assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect">3.2.13. Using external configuration and secrets</a></li>
<li><a href="#ref-list-of-kafka-connect-resources-deployment-configuration-kafka-connect">3.2.14. List of resources created as part of Kafka Connect cluster</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-connect-s2i-str">3.3. Kafka Connect cluster with Source2Image support</a>
<ul class="sectlevel3">
<li><a href="#assembly-kafka-connect-replicas-deployment-configuration-kafka-connect-s2i">3.3.1. Replicas</a></li>
<li><a href="#assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect-s2i">3.3.2. Bootstrap servers</a></li>
<li><a href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect-s2i">3.3.3. Connecting to Kafka brokers using TLS</a></li>
<li><a href="#assembly-kafka-connect-authentication-deployment-configuration-kafka-connect-s2i">3.3.4. Connecting to Kafka brokers with Authentication</a></li>
<li><a href="#assembly-kafka-connect-configuration-deployment-configuration-kafka-connect-s2i">3.3.5. Kafka Connect configuration</a></li>
<li><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">3.3.6. CPU and memory resources</a></li>
<li><a href="#assembly-logging-deployment-configuration-kafka-connect-s2i">3.3.7. Logging</a></li>
<li><a href="#assembly-healthchecks-deployment-configuration-kafka-connect-s2i">3.3.8. Healthchecks</a></li>
<li><a href="#assembly-metrics-deployment-configuration-kafka-connect-s2i">3.3.9. Prometheus metrics</a></li>
<li><a href="#assembly-jvm-options-deployment-configuration-kafka-connect-s2i">3.3.10. JVM Options</a></li>
<li><a href="#assembly-configuring-container-images-deployment-configuration-kafka-connect-s2i">3.3.11. Container images</a></li>
<li><a href="#assembly-scheduling-deployment-configuration-kafka-connect-s2i">3.3.12. Configuring pod scheduling</a></li>
<li><a href="#assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect-s2i">3.3.13. Using external configuration and secrets</a></li>
<li><a href="#ref-list-of-kafka-connect-s2i-resources-deployment-configuration-kafka-connect-s2i">3.3.14. List of resources created as part of Kafka Connect cluster with Source2Image support</a></li>
<li><a href="#using-openshift-s2i-create-image-deployment-configuration-kafka-connect-s2i">3.3.15. Creating a container image using OpenShift builds and Source-to-Image</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-mirror-maker-str">3.4. Kafka Mirror Maker configuration</a>
<ul class="sectlevel3">
<li><a href="#configuring-kafka-mirror-maker-deployment-configuration-kafka-mirror-maker">3.4.1. Configuring Kafka Mirror Maker</a></li>
<li><a href="#con-configuring-mirror-maker-deployment-configuration-kafka-mirror-maker">3.4.2. Kafka Mirror Maker configuration properties</a></li>
<li><a href="#ref-list-of-kafka-mirror-maker-resources-deployment-configuration-kafka-mirror-maker">3.4.3. List of resources created as part of Kafka Mirror Maker</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-bridge-str">3.5. Kafka Bridge configuration</a>
<ul class="sectlevel3">
<li><a href="#assembly-kafka-bridge-replicas-deployment-configuration-kafka-bridge">3.5.1. Replicas</a></li>
<li><a href="#assembly-kafka-bridge-bootstrap-servers-deployment-configuration-kafka-bridge">3.5.2. Bootstrap servers</a></li>
<li><a href="#assembly-kafka-bridge-tls-deployment-configuration-kafka-bridge">3.5.3. Connecting to Kafka brokers using TLS</a></li>
<li><a href="#assembly-kafka-bridge-authentication-deployment-configuration-kafka-bridge">3.5.4. Connecting to Kafka brokers with Authentication</a></li>
<li><a href="#assembly-kafka-bridge-configuration-deployment-configuration-kafka-bridge">3.5.5. Kafka Bridge configuration</a></li>
<li><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-bridge">3.5.6. CPU and memory resources</a></li>
<li><a href="#assembly-logging-deployment-configuration-kafka-bridge">3.5.7. Logging</a></li>
<li><a href="#assembly-jvm-options-deployment-configuration-kafka-bridge">3.5.8. JVM Options</a></li>
<li><a href="#assembly-healthchecks-deployment-configuration-kafka-bridge">3.5.9. Healthchecks</a></li>
<li><a href="#assembly-configuring-container-images-deployment-configuration-kafka-bridge">3.5.10. Container images</a></li>
<li><a href="#assembly-scheduling-deployment-configuration-kafka-bridge">3.5.11. Configuring pod scheduling</a></li>
<li><a href="#ref-list-of-kafka-bridge-resources-deployment-configuration-kafka-bridge">3.5.12. List of resources created as part of Kafka Bridge cluster</a></li>
</ul>
</li>
<li><a href="#assembly-oauth-str">3.6. Using OAuth 2.0 token based authentication</a>
<ul class="sectlevel3">
<li><a href="#con-oauth-authentication-flow-str">3.6.1. OAuth 2.0 authentication mechanism</a></li>
<li><a href="#con-oauth-authentication-client-options-str">3.6.2. OAuth 2.0 client authentication flow</a></li>
<li><a href="#con-oauth-strimzi-config-str">3.6.3. Configuring OAuth 2.0 authentication</a></li>
</ul>
</li>
<li><a href="#assembly-customizing-deployments-str">3.7. Customizing deployments</a>
<ul class="sectlevel3">
<li><a href="#con-customizing-template-properties-str">3.7.1. Template properties</a></li>
<li><a href="#con-customizing-labels-and-annotations-str">3.7.2. Labels and Annotations</a></li>
<li><a href="#con-customizing-pods-str">3.7.3. Customizing Pods</a></li>
<li><a href="#con-customizing-containers-str">3.7.4. Customizing containers with environment variables</a></li>
<li><a href="#con-customizing-image-pull-policy-str">3.7.5. Customizing the image pull policy</a></li>
<li><a href="#con-customizing-pod-disruption-budgets-str">3.7.6. Customizing Pod Disruption Budgets</a></li>
<li><a href="#proc-customizing-deployments-str">3.7.7. Customizing deployments</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-operators-str">4. Operators</a>
<ul class="sectlevel2">
<li><a href="#assembly-operators-cluster-operator-str">4.1. Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#con-what-the-cluster-operator-does-deploying-co">4.1.1. Overview of the Cluster Operator component</a></li>
<li><a href="#con-cluster-operator-watch-options-deploying-co">4.1.2. Watch options for a Cluster Operator deployment</a></li>
<li><a href="#deploying-cluster-operator-deploying-co">4.1.3. Deploying the Cluster Operator to watch a single namespace</a></li>
<li><a href="#deploying-cluster-operator-to-watch-multiple-namespacesdeploying-co">4.1.4. Deploying the Cluster Operator to watch multiple namespaces</a></li>
<li><a href="#deploying-cluster-operator-to-watch-whole-cluster-deploying-co">4.1.5. Deploying the Cluster Operator to watch all namespaces</a></li>
<li><a href="#deploying-cluster-operator-helm-chart-deploying-co">4.1.6. Deploying the Cluster Operator using Helm Chart</a></li>
<li><a href="#deploying-cluster-operator-from-operator-hub-deploying-co">4.1.7. Deploying the Cluster Operator from OperatorHub.io</a></li>
<li><a href="#con-cluster-operator-reconciliation-deploying-co">4.1.8. Reconciliation</a></li>
<li><a href="#ref-operators-cluster-operator-configuration-deploying-co">4.1.9. Cluster Operator Configuration</a></li>
<li><a href="#con-cluster-operator-rbac-deploying-co">4.1.10. Role-Based Access Control (RBAC)</a></li>
</ul>
</li>
<li><a href="#deploying-the-topic-operator-str">4.2. Topic Operator</a>
<ul class="sectlevel3">
<li><a href="#what-the-topic-operator-does-deploying">4.2.1. Overview of the Topic Operator component</a></li>
<li><a href="#con-topic-operator-cluster-label-deploying">4.2.2. Identifying a Kafka cluster for topic handling</a></li>
<li><a href="#how-the-topic-operator-works-deploying">4.2.3. Understanding the Topic Operator</a></li>
<li><a href="#deploying-the-topic-operator-using-the-cluster-operator-deploying">4.2.4. Deploying the Topic Operator using the Cluster Operator</a></li>
<li><a href="#proc-topic-operator-with-resource-requests-limits-deploying">4.2.5. Configuring the Topic Operator with resource requests and limits</a></li>
<li><a href="#deploying-the-topic-operator-standalone-deploying">4.2.6. Deploying the standalone Topic Operator</a></li>
<li><a href="#topic-operator-environment-deploying">4.2.7. Topic Operator environment</a></li>
</ul>
</li>
<li><a href="#assembly-user-operator-str">4.3. User Operator</a>
<ul class="sectlevel3">
<li><a href="#con-what-the-user-operator-does-deploying-uo">4.3.1. Overview of the User Operator component</a></li>
<li><a href="#con-user-operator-cluster-label-deploying-uo">4.3.2. Identifying a Kafka cluster for user handling</a></li>
<li><a href="#proc-deploying-the-user-operator-using-the-cluster-operator-deploying-uo">4.3.3. Deploying the User Operator using the Cluster Operator</a></li>
<li><a href="#proc-user-operator-with-resource-requests-limits-deploying-uo">4.3.4. Configuring the User Operator with resource requests and limits</a></li>
<li><a href="#proc-deploying-the-user-operator-standalone-deploying-uo">4.3.5. Deploying the standalone User Operator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#using-the-topic-operator-str">5. Using the Topic Operator</a>
<ul class="sectlevel2">
<li><a href="#topic-operator-usage-recommendations-str">5.1. Topic Operator usage recommendations</a></li>
<li><a href="#creating-a-topic-str">5.2. Creating a topic</a></li>
<li><a href="#changing-a-topic-str">5.3. Changing a topic</a></li>
<li><a href="#deleting-a-topic-str">5.4. Deleting a topic</a></li>
</ul>
</li>
<li><a href="#assembly-using-the-user-operator-str">6. Using the User Operator</a>
<ul class="sectlevel2">
<li><a href="#con-what-the-user-operator-does-using-uo">6.1. Overview of the User Operator component</a></li>
<li><a href="#con-mutual-tls-authentication-using-uo">6.2. Mutual TLS authentication</a>
<ul class="sectlevel3">
<li><a href="#when_to_use_mutual_tls_authentication_for_clients_2">6.2.1. When to use mutual TLS authentication for clients</a></li>
</ul>
</li>
<li><a href="#proc-creating-kafka-user-tls-using-uo">6.3. Creating a Kafka user with mutual TLS authentication</a></li>
<li><a href="#con-scram-sha-authentication-using-uo">6.4. SCRAM-SHA authentication</a>
<ul class="sectlevel3">
<li><a href="#supported_scram_credentials_2">6.4.1. Supported SCRAM credentials</a></li>
<li><a href="#when_to_use_scram_sha_authentication_for_clients_2">6.4.2. When to use SCRAM-SHA authentication for clients</a></li>
</ul>
</li>
<li><a href="#proc-creating-kafka-user-scram-using-uo">6.5. Creating a Kafka user with SCRAM SHA authentication</a></li>
<li><a href="#proc-changing-kafka-user-using-uo">6.6. Editing a Kafka user</a></li>
<li><a href="#deleting-kafka-user-using-uo">6.7. Deleting a Kafka user</a></li>
<li><a href="#ref-kafka-user-using-uo">6.8. Kafka User resource</a>
<ul class="sectlevel3">
<li><a href="#authentication">6.8.1. Authentication</a></li>
<li><a href="#simple-acl-using-uo">6.8.2. Authorization</a></li>
<li><a href="#additional_resources">6.8.3. Additional resources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kafka-bridge-concepts-str">7. Kafka Bridge</a>
<ul class="sectlevel2">
<li><a href="#assembly-kafka-bridge-overview-str">7.1. Kafka Bridge overview</a>
<ul class="sectlevel3">
<li><a href="#con-supported-clients-kafka-bridge-kafka-bridge-overview">7.1.1. Supported clients for the Kafka Bridge</a></li>
<li><a href="#con-securing-kafka-bridge-kafka-bridge-overview">7.1.2. Securing the Kafka Bridge</a></li>
<li><a href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">7.1.3. Accessing the Kafka Bridge outside of Kubernetes</a></li>
<li><a href="#con-requests-kafka-bridge-kafka-bridge-overview">7.1.4. Requests to the Kafka Bridge</a></li>
<li><a href="#con-loggers-kafka-bridge-kafka-bridge-overview">7.1.5. Configuring loggers for the Kafka Bridge</a></li>
<li><a href="#ref-api-resources-kafka-bridge-kafka-bridge-overview">7.1.6. Kafka Bridge API resources</a></li>
</ul>
</li>
<li><a href="#assembly-kafka-bridge-quickstart-str">7.2. Kafka Bridge quickstart</a>
<ul class="sectlevel3">
<li><a href="#proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart">7.2.1. Deploying the Kafka Bridge to your Kubernetes cluster</a></li>
<li><a href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">7.2.2. Exposing the Kafka Bridge service to your local machine</a></li>
<li><a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">7.2.3. Producing messages to topics and partitions</a></li>
<li><a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">7.2.4. Creating a Kafka Bridge consumer</a></li>
<li><a href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">7.2.5. Subscribing a Kafka Bridge consumer to topics</a></li>
<li><a href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">7.2.6. Retrieving the latest messages from a Kafka Bridge consumer</a></li>
<li><a href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">7.2.7. Commiting offsets to the log</a></li>
<li><a href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">7.2.8. Seeking to offsets for a partition</a></li>
<li><a href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">7.2.9. Deleting a Kafka Bridge consumer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-metrics-setup-str">8. Introducing Metrics</a>
<ul class="sectlevel2">
<li><a href="#ref-metrics-config-files-str">8.1. Example Metrics files</a></li>
<li><a href="#assembly-metrics-kafka-str">8.2. Prometheus metrics</a>
<ul class="sectlevel3">
<li><a href="#con-metrics-kafka-options-str">8.2.1. Prometheus metrics configuration</a></li>
<li><a href="#con-metrics-kafka-deploy-options-str">8.2.2. Prometheus metrics deployment options</a></li>
<li><a href="#proc-metrics-kafka-str">8.2.3. Copying Prometheus metrics configuration to a Kafka resource</a></li>
<li><a href="#proc-metrics-deploying-kafka-str">8.2.4. Deploying a Kafka cluster with Prometheus metrics configuration</a></li>
</ul>
</li>
<li><a href="#assembly-metrics-prometheus-str">8.3. Prometheus</a>
<ul class="sectlevel3">
<li><a href="#con-metrics-prometheus-options-str">8.3.1. Prometheus configuration</a></li>
<li><a href="#con-metrics-prometheus-resources-str">8.3.2. Prometheus resources</a></li>
<li><a href="#proc-metrics-deploying-prometheus-operator-str">8.3.3. Deploying the Prometheus Operator</a></li>
<li><a href="#proc-metrics-deploying-prometheus-str">8.3.4. Deploying Prometheus</a></li>
</ul>
</li>
<li><a href="#assembly-metrics-prometheus-alertmanager-str">8.4. Prometheus Alertmanager</a>
<ul class="sectlevel3">
<li><a href="#con-metrics-alertmanager-options-str">8.4.1. Alertmanager configuration</a></li>
<li><a href="#con-metrics-prometheus-alerts-str">8.4.2. Alerting rules</a></li>
<li><a href="#ref-metrics-alertmanager-examples-str">8.4.3. Alerting rule examples</a></li>
<li><a href="#proc-metrics-deploying-prometheus-alertmanager-str">8.4.4. Deploying Alertmanager</a></li>
</ul>
</li>
<li><a href="#assembly-metrics-grafana-str">8.5. Grafana</a>
<ul class="sectlevel3">
<li><a href="#con-metrics-grafana-options-str">8.5.1. Grafana configuration</a></li>
<li><a href="#proc-metrics-deploying-grafana-str">8.5.2. Deploying Grafana</a></li>
<li><a href="#proc-metrics-grafana-dashboard-str">8.5.3. Enabling the example Grafana dashboards</a></li>
</ul>
</li>
<li><a href="#con-metrics-kafka-mini-kube-shift-str">8.6. Using metrics with <code>minikube</code> or <code>minishift</code></a></li>
</ul>
</li>
<li><a href="#assembly-distributed-tracing-str">9. Distributed tracing</a>
<ul class="sectlevel2">
<li><a href="#con-overview-distributed-tracing-str">9.1. Overview of distributed tracing in Strimzi</a>
<ul class="sectlevel3">
<li><a href="#distributed_tracing_support_in_strimzi">9.1.1. Distributed tracing support in Strimzi</a></li>
</ul>
</li>
<li><a href="#assembly-setting-up-tracing-kafka-clients-str">9.2. Setting up tracing for Kafka clients</a>
<ul class="sectlevel3">
<li><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">9.2.1. Initializing a Jaeger tracer for Kafka clients</a></li>
<li><a href="#ref-tracing-environment-variables-str">9.2.2. Tracing environment variables</a></li>
</ul>
</li>
<li><a href="#assembly-instrumenting-kafka-clients-tracers-str">9.3. Instrumenting Kafka clients with tracers</a>
<ul class="sectlevel3">
<li><a href="#proc-instrumenting-producers-consumers-for-opentracing-str">9.3.1. Instrumenting Kafka Producers and Consumers for tracing</a></li>
<li><a href="#proc-instrumenting-kafka-streams-with-tracers-str">9.3.2. Instrumenting Kafka Streams applications for tracing</a></li>
</ul>
</li>
<li><a href="#assembly-setting-up-tracing-mirror-maker-connect-str">9.4. Setting up tracing for Mirror Maker and Kafka Connect</a>
<ul class="sectlevel3">
<li><a href="#proc-enabling-tracing-in-connect-mirror-maker-resources-str">9.4.1. Enabling tracing in Mirror Maker and Kafka Connect resources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-kafka-exporter-str">10. Kafka Exporter</a>
<ul class="sectlevel2">
<li><a href="#con-metrics-kafka-exporter-lag-str">10.1. Consumer lag</a></li>
<li><a href="#con-metrics-kafka-exporter-alerts-str">10.2. Kafka Exporter alerting rule examples</a></li>
<li><a href="#ref-metrics-kafka-exporter-str">10.3. Kafka Exporter metrics</a></li>
<li><a href="#proc-kafka-exporter-enabling-str">10.4. Enabling the Kafka Exporter Grafana dashboard</a></li>
</ul>
</li>
<li><a href="#security-str">11. Security</a>
<ul class="sectlevel2">
<li><a href="#certificate-authorities-str">11.1. Certificate Authorities</a>
<ul class="sectlevel3">
<li><a href="#ca_certificates">11.1.1. CA certificates</a></li>
</ul>
</li>
<li><a href="#certificates-and-secrets-str">11.2. Certificates and <code>Secrets</code></a>
<ul class="sectlevel3">
<li><a href="#cluster_ca_secrets">11.2.1. Cluster CA <code>Secrets</code></a></li>
<li><a href="#client_ca_secrets">11.2.2. Client CA <code>Secrets</code></a></li>
<li><a href="#user_secrets">11.2.3. User <code>Secrets</code></a></li>
</ul>
</li>
<li><a href="#installing-your-own-ca-certificates-str">11.3. Installing your own CA certificates</a></li>
<li><a href="#con-certificate-renewal-str">11.4. Certificate renewal</a>
<ul class="sectlevel3">
<li><a href="#renewal_process_with_generated_cas">11.4.1. Renewal process with generated CAs</a></li>
<li><a href="#client_applications">11.4.2. Client applications</a></li>
</ul>
</li>
<li><a href="#proc-renewing-ca-certs-manually-str">11.5. Renewing CA certificates manually</a></li>
<li><a href="#proc-replacing-private-keys-str">11.6. Replacing private keys</a></li>
<li><a href="#tls-connections-str">11.7. TLS connections</a>
<ul class="sectlevel3">
<li><a href="#zookeeper_communication">11.7.1. Zookeeper communication</a></li>
<li><a href="#kafka_interbroker_communication">11.7.2. Kafka interbroker communication</a></li>
<li><a href="#topic_and_user_operators">11.7.3. Topic and User Operators</a></li>
<li><a href="#kafka_client_connections">11.7.4. Kafka Client connections</a></li>
</ul>
</li>
<li><a href="#configuring-internal-clients-to-trust-cluster-ca-str">11.8. Configuring internal clients to trust the cluster CA</a></li>
<li><a href="#configuring-external-clients-to-trust-cluster-ca-str">11.9. Configuring external clients to trust the cluster CA</a></li>
</ul>
</li>
<li><a href="#assembly-upgrade-str">12. Strimzi and Kafka upgrades</a>
<ul class="sectlevel2">
<li><a href="#con-upgrade-intro-str">12.1. Upgrade process</a></li>
<li><a href="#ref-kafka-versions-str">12.2. Kafka versions</a></li>
<li><a href="#assembly-upgrade-cluster-operator-str">12.3. Upgrading the Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#proc-upgrading-the-co-str">12.3.1. Upgrading the Cluster Operator to a later version</a></li>
</ul>
</li>
<li><a href="#assembly-upgrading-kafka-versions-str">12.4. Upgrading Kafka</a>
<ul class="sectlevel3">
<li><a href="#con-versions-and-images-str">12.4.1. Kafka version and image mappings</a></li>
<li><a href="#con-strategies-for-upgrading-clients-str">12.4.2. Strategies for upgrading clients</a></li>
<li><a href="#proc-upgrading-brokers-newer-kafka-str">12.4.3. Upgrading Kafka brokers and client applications</a></li>
</ul>
</li>
<li><a href="#assembly-downgrading-kafka-versions-str">12.5. Downgrading Kafka</a>
<ul class="sectlevel3">
<li><a href="#com-target-downgrade-version-str">12.5.1. Target downgrade version</a></li>
<li><a href="#proc-downgrading-brokers-older-kafka-str">12.5.2. Downgrading Kafka brokers and client applications</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-upgrade-resources-str">13. Strimzi resource upgrades</a>
<ul class="sectlevel2">
<li><a href="#proc-upgrade-kafka-resources-str">13.1. Upgrading Kafka resources</a></li>
<li><a href="#proc-upgrade-kafka-connect-resources-str">13.2. Upgrading Kafka Connect resources</a></li>
<li><a href="#proc-upgrade-kafka-connect-s2i-resources-str">13.3. Upgrading Kafka Connect S2I resources</a></li>
<li><a href="#proc-upgrade-kafka-mirror-maker-resources-str">13.4. Upgrading Kafka Mirror Maker resources</a></li>
<li><a href="#proc-upgrade-kafka-topic-resources-str">13.5. Upgrading Kafka Topic resources</a></li>
<li><a href="#proc-upgrade-kafka-user-resources-str">13.6. Upgrading Kafka User resources</a></li>
</ul>
</li>
<li><a href="#uninstalling-str">14. Uninstalling Strimzi</a></li>
<li><a href="#proc-accessing-resource-status-str">15. Checking the status of a custom resource</a></li>
<li><a href="#ref-kafka-logging-str">Appendix A: Configurable loggers</a></li>
<li><a href="#frequently_asked_questions">Appendix B: Frequently Asked Questions</a>
<ul class="sectlevel2">
<li><a href="#cluster_operator">B.1. Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#why_do_i_need_cluster_admin_privileges_to_install_strimzi">B.1.1. Why do I need cluster admin privileges to install Strimzi?</a></li>
<li><a href="#why_does_the_cluster_operator_require_the_ability_to_create_clusterrolebindings_is_that_not_a_security_risk">B.1.2. Why does the Cluster Operator require the ability to create <code>ClusterRoleBindings</code>? Is that not a security risk?</a></li>
<li><a href="#why_can_standard_kubernetes_users_not_create_the_custom_resource_kafka_kafkatopic_and_so_on">B.1.3. Why can standard Kubernetes users not create the custom resource (<code>Kafka</code>, <code>KafkaTopic</code>, and so on)?</a></li>
<li><a href="#log_contains_warnings_about_failing_to_acquire_lock">B.1.4. Log contains warnings about failing to acquire lock</a></li>
<li><a href="#hostname_verification_fails_when_connecting_to_nodeports_using_tls">B.1.5. Hostname verification fails when connecting to NodePorts using TLS</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#installing_kubernetes_cluster">Appendix C: Installing a Kubernetes cluster</a></li>
<li><a href="#installing_openshift_cluster">Appendix D: Installing an OpenShift cluster</a>
<ul class="sectlevel2">
<li><a href="#oc_and_kubectl">D.1. <code>oc</code> and <code>kubectl</code></a></li>
</ul>
</li>
<li><a href="#api_reference-str">Appendix E: Custom Resource API Reference</a>
<ul class="sectlevel2">
<li><a href="#type-Kafka-reference">E.1. <code>Kafka</code> schema reference</a></li>
<li><a href="#type-KafkaSpec-reference">E.2. <code>KafkaSpec</code> schema reference</a></li>
<li><a href="#type-KafkaClusterSpec-reference">E.3. <code>KafkaClusterSpec</code> schema reference</a></li>
<li><a href="#type-EphemeralStorage-reference">E.4. <code>EphemeralStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorage-reference">E.5. <code>PersistentClaimStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorageOverride-reference">E.6. <code>PersistentClaimStorageOverride</code> schema reference</a></li>
<li><a href="#type-JbodStorage-reference">E.7. <code>JbodStorage</code> schema reference</a></li>
<li><a href="#type-KafkaListeners-reference">E.8. <code>KafkaListeners</code> schema reference</a></li>
<li><a href="#type-KafkaListenerPlain-reference">E.9. <code>KafkaListenerPlain</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationTls-reference">E.10. <code>KafkaListenerAuthenticationTls</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationScramSha512-reference">E.11. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationOAuth-reference">E.12. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-GenericSecretSource-reference">E.13. <code>GenericSecretSource</code> schema reference</a></li>
<li><a href="#type-CertSecretSource-reference">E.14. <code>CertSecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaListenerTls-reference">E.15. <code>KafkaListenerTls</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalRoute-reference">E.16. <code>KafkaListenerExternalRoute</code> schema reference</a></li>
<li><a href="#type-RouteListenerOverride-reference">E.17. <code>RouteListenerOverride</code> schema reference</a></li>
<li><a href="#type-RouteListenerBootstrapOverride-reference">E.18. <code>RouteListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-RouteListenerBrokerOverride-reference">E.19. <code>RouteListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalLoadBalancer-reference">E.20. <code>KafkaListenerExternalLoadBalancer</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerOverride-reference">E.21. <code>LoadBalancerListenerOverride</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerBootstrapOverride-reference">E.22. <code>LoadBalancerListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerBrokerOverride-reference">E.23. <code>LoadBalancerListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalNodePort-reference">E.24. <code>KafkaListenerExternalNodePort</code> schema reference</a></li>
<li><a href="#type-NodePortListenerOverride-reference">E.25. <code>NodePortListenerOverride</code> schema reference</a></li>
<li><a href="#type-NodePortListenerBootstrapOverride-reference">E.26. <code>NodePortListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-NodePortListenerBrokerOverride-reference">E.27. <code>NodePortListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalIngress-reference">E.28. <code>KafkaListenerExternalIngress</code> schema reference</a></li>
<li><a href="#type-IngressListenerConfiguration-reference">E.29. <code>IngressListenerConfiguration</code> schema reference</a></li>
<li><a href="#type-IngressListenerBootstrapConfiguration-reference">E.30. <code>IngressListenerBootstrapConfiguration</code> schema reference</a></li>
<li><a href="#type-IngressListenerBrokerConfiguration-reference">E.31. <code>IngressListenerBrokerConfiguration</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationSimple-reference">E.32. <code>KafkaAuthorizationSimple</code> schema reference</a></li>
<li><a href="#type-Rack-reference">E.33. <code>Rack</code> schema reference</a></li>
<li><a href="#type-Probe-reference">E.34. <code>Probe</code> schema reference</a></li>
<li><a href="#type-JvmOptions-reference">E.35. <code>JvmOptions</code> schema reference</a></li>
<li><a href="#type-ResourceRequirements-reference">E.36. <code>ResourceRequirements</code> schema reference</a></li>
<li><a href="#type-InlineLogging-reference">E.37. <code>InlineLogging</code> schema reference</a></li>
<li><a href="#type-ExternalLogging-reference">E.38. <code>ExternalLogging</code> schema reference</a></li>
<li><a href="#type-TlsSidecar-reference">E.39. <code>TlsSidecar</code> schema reference</a></li>
<li><a href="#type-KafkaClusterTemplate-reference">E.40. <code>KafkaClusterTemplate</code> schema reference</a></li>
<li><a href="#type-ResourceTemplate-reference">E.41. <code>ResourceTemplate</code> schema reference</a></li>
<li><a href="#type-MetadataTemplate-reference">E.42. <code>MetadataTemplate</code> schema reference</a></li>
<li><a href="#type-PodTemplate-reference">E.43. <code>PodTemplate</code> schema reference</a></li>
<li><a href="#type-PodDisruptionBudgetTemplate-reference">E.44. <code>PodDisruptionBudgetTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerTemplate-reference">E.45. <code>ContainerTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerEnvVar-reference">E.46. <code>ContainerEnvVar</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterSpec-reference">E.47. <code>ZookeeperClusterSpec</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterTemplate-reference">E.48. <code>ZookeeperClusterTemplate</code> schema reference</a></li>
<li><a href="#type-TopicOperatorSpec-reference">E.49. <code>TopicOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityOperatorJvmOptions-reference">E.50. <code>EntityOperatorJvmOptions</code> schema reference</a></li>
<li><a href="#type-EntityOperatorSpec-reference">E.51. <code>EntityOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityTopicOperatorSpec-reference">E.52. <code>EntityTopicOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityUserOperatorSpec-reference">E.53. <code>EntityUserOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityOperatorTemplate-reference">E.54. <code>EntityOperatorTemplate</code> schema reference</a></li>
<li><a href="#type-CertificateAuthority-reference">E.55. <code>CertificateAuthority</code> schema reference</a></li>
<li><a href="#type-KafkaExporterSpec-reference">E.56. <code>KafkaExporterSpec</code> schema reference</a></li>
<li><a href="#type-KafkaExporterTemplate-reference">E.57. <code>KafkaExporterTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaStatus-reference">E.58. <code>KafkaStatus</code> schema reference</a></li>
<li><a href="#type-Condition-reference">E.59. <code>Condition</code> schema reference</a></li>
<li><a href="#type-ListenerStatus-reference">E.60. <code>ListenerStatus</code> schema reference</a></li>
<li><a href="#type-ListenerAddress-reference">E.61. <code>ListenerAddress</code> schema reference</a></li>
<li><a href="#type-KafkaConnect-reference">E.62. <code>KafkaConnect</code> schema reference</a></li>
<li><a href="#type-KafkaConnectSpec-reference">E.63. <code>KafkaConnectSpec</code> schema reference</a></li>
<li><a href="#type-JaegerTracing-reference">E.64. <code>JaegerTracing</code> schema reference</a></li>
<li><a href="#type-KafkaConnectTemplate-reference">E.65. <code>KafkaConnectTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationTls-reference">E.66. <code>KafkaClientAuthenticationTls</code> schema reference</a></li>
<li><a href="#type-CertAndKeySecretSource-reference">E.67. <code>CertAndKeySecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationScramSha512-reference">E.68. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a></li>
<li><a href="#type-PasswordSecretSource-reference">E.69. <code>PasswordSecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationPlain-reference">E.70. <code>KafkaClientAuthenticationPlain</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationOAuth-reference">E.71. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-ExternalConfiguration-reference">E.72. <code>ExternalConfiguration</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationEnv-reference">E.73. <code>ExternalConfigurationEnv</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationEnvVarSource-reference">E.74. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationVolumeSource-reference">E.75. <code>ExternalConfigurationVolumeSource</code> schema reference</a></li>
<li><a href="#type-KafkaConnectTls-reference">E.76. <code>KafkaConnectTls</code> schema reference</a></li>
<li><a href="#type-KafkaConnectStatus-reference">E.77. <code>KafkaConnectStatus</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2I-reference">E.78. <code>KafkaConnectS2I</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2ISpec-reference">E.79. <code>KafkaConnectS2ISpec</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2Istatus-reference">E.80. <code>KafkaConnectS2Istatus</code> schema reference</a></li>
<li><a href="#type-KafkaTopic-reference">E.81. <code>KafkaTopic</code> schema reference</a></li>
<li><a href="#type-KafkaTopicSpec-reference">E.82. <code>KafkaTopicSpec</code> schema reference</a></li>
<li><a href="#type-KafkaTopicStatus-reference">E.83. <code>KafkaTopicStatus</code> schema reference</a></li>
<li><a href="#type-KafkaUser-reference">E.84. <code>KafkaUser</code> schema reference</a></li>
<li><a href="#type-KafkaUserSpec-reference">E.85. <code>KafkaUserSpec</code> schema reference</a></li>
<li><a href="#type-KafkaUserTlsClientAuthentication-reference">E.86. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserScramSha512ClientAuthentication-reference">E.87. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserAuthorizationSimple-reference">E.88. <code>KafkaUserAuthorizationSimple</code> schema reference</a></li>
<li><a href="#type-AclRule-reference">E.89. <code>AclRule</code> schema reference</a></li>
<li><a href="#type-AclRuleTopicResource-reference">E.90. <code>AclRuleTopicResource</code> schema reference</a></li>
<li><a href="#type-AclRuleGroupResource-reference">E.91. <code>AclRuleGroupResource</code> schema reference</a></li>
<li><a href="#type-AclRuleClusterResource-reference">E.92. <code>AclRuleClusterResource</code> schema reference</a></li>
<li><a href="#type-AclRuleTransactionalIdResource-reference">E.93. <code>AclRuleTransactionalIdResource</code> schema reference</a></li>
<li><a href="#type-KafkaUserStatus-reference">E.94. <code>KafkaUserStatus</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker-reference">E.95. <code>KafkaMirrorMaker</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerSpec-reference">E.96. <code>KafkaMirrorMakerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerConsumerSpec-reference">E.97. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerTls-reference">E.98. <code>KafkaMirrorMakerTls</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerProducerSpec-reference">E.99. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerTemplate-reference">E.100. <code>KafkaMirrorMakerTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerStatus-reference">E.101. <code>KafkaMirrorMakerStatus</code> schema reference</a></li>
<li><a href="#type-KafkaBridge-reference">E.102. <code>KafkaBridge</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeSpec-reference">E.103. <code>KafkaBridgeSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeTls-reference">E.104. <code>KafkaBridgeTls</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeHttpConfig-reference">E.105. <code>KafkaBridgeHttpConfig</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeConsumerSpec-reference">E.106. <code>KafkaBridgeConsumerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeProducerSpec-reference">E.107. <code>KafkaBridgeProducerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeTemplate-reference">E.108. <code>KafkaBridgeTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeStatus-reference">E.109. <code>KafkaBridgeStatus</code> schema reference</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="overview-str"><a class="link" href="#overview-str">1. Overview of Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi is based on Apache Kafka, a popular platform for streaming data delivery and processing. Strimzi makes it easy to run Apache Kafka on Kubernetes.</p>
</div>
<div class="paragraph">
<p>Strimzi provides three operators:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster Operator</dt>
<dd>
<p>Responsible for deploying and managing Apache Kafka clusters within a Kubernetes cluster.</p>
</dd>
<dt class="hdlist1">Topic Operator</dt>
<dd>
<p>Responsible for managing Kafka topics within a Kafka cluster running within a Kubernetes cluster.</p>
</dd>
<dt class="hdlist1">User Operator</dt>
<dd>
<p>Responsible for managing Kafka users within a Kafka cluster running within a Kubernetes cluster.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Cluster Operator can deploy the Topic Operator and User Operator (as part of an Entity Operator configuration) at the same time as a Kafka cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Operators within the Strimzi architecture</div>
<p><span class="image"><img src="images/operators.png" alt="Operators"></span></p>
</div>
<div class="sect2">
<h3 id="key-features-str"><a class="link" href="#key-features-str">1.1. Kafka Key Features</a></h3>
<div class="ulist">
<ul>
<li>
<p>Designed for horizontal scalability</p>
</li>
<li>
<p>Message ordering guarantee at the partition level</p>
</li>
<li>
<p>Message rewind/replay</p>
<div class="ulist">
<ul>
<li>
<p>"Long term" storage allows the reconstruction of an application state by replaying the messages</p>
</li>
<li>
<p>Combines with compacted topics to use Kafka as a key-value store</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Apache Kafka, see the <a href="http://kafka.apache.org" target="_blank" rel="noopener">Apache Kafka website</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions-str"><a class="link" href="#document-conventions-str">1.2. Document Conventions</a></h3>
<div class="paragraph">
<div class="title">Replaceables</div>
<p>In this document, replaceable text is styled in monospace and italics.</p>
</div>
<div class="paragraph">
<p>For example, in the following code, you will want to replace <code><em>my-namespace</em></code> with the name of your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-str"><a class="link" href="#getting-started-str">2. Getting started with Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi is designed to work on all types of Kubernetes cluster regardless of distribution, from public and private clouds to local deployments intended for development.
Strimzi supports a few features which are specific to OpenShift, where such integration benefits OpenShift users and cannot be implemented equivalently using standard Kubernetes.</p>
</div>
<div class="paragraph">
<p>This guide assumes that a Kubernetes cluster is available and the <code>kubectl</code> command-line tool is installed and configured to connect to the running cluster.</p>
</div>
<div class="paragraph">
<p>When no existing Kubernetes cluster is available, <code>minikube</code> can be used to create a local cluster.
More details can be found in <a href="#installing_kubernetes_cluster">Installing Kubernetes clusters</a>.</p>
</div>
<div class="paragraph">
<p>If you want to use OpenShift-specific features and have no OpenShift cluster <code>minishift</code> can be used to create a local cluster.
More details can be found in <a href="#installing_openshift_cluster">Installing OpenShift clusters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To run the commands in this guide, your cluster user must have the rights to manage role-based access control (RBAC) and CRDs.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="downloads-str"><a class="link" href="#downloads-str">2.1. Installing Strimzi and deploying components</a></h3>
<div class="paragraph">
<p>To install Strimzi, download the release artefacts from <a href="https://github.com/strimzi/strimzi-kafka-operator/releases" target="_blank" rel="noopener">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>The folder contains several YAML files to help you deploy the components of Strimzi to Kubernetes, perform common operations, and configure your Kafka cluster. The YAML files are referenced throughout this documentation.</p>
</div>
<div class="paragraph">
<p>Additionally, a Helm Chart is provided for deploying the Cluster Operator using <a href="https://helm.sh/" target="_blank" rel="noopener">Helm</a>. The container images are available through the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>The remainder of this chapter provides an overview of each component and instructions for deploying the components to Kubernetes using the YAML files provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although container images for Strimzi are available in the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a>, we recommend that you use the YAML files provided instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="assembly-custom-resources-str"><a class="link" href="#assembly-custom-resources-str">2.2. Custom resources</a></h3>
<div class="paragraph">
<p>Custom resource definitions (CRDs) extend the Kubernetes API, providing definitions to create and modify custom resources to a Kubernetes cluster. Custom resources are created as instances of CRDs.</p>
</div>
<div class="paragraph">
<p>In Strimzi, CRDs introduce custom resources specific to Strimzi to a Kubernetes cluster, such as Kafka, Kafka Connect, Kafka Mirror Maker, and users and topics custom resources.  CRDs provide configuration instructions, defining the schemas used to instantiate and manage the Strimzi-specific resources. CRDs also allow Strimzi resources to benefit from native Kubernetes features like CLI accessibility and configuration validation.</p>
</div>
<div class="paragraph">
<p>CRDs require a one-time installation in a cluster. Depending on the cluster setup, installation typically requires cluster admin privileges.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Access to manage custom resources is limited to <a href="#assembly-getting-started-strimzi-admin-str">Strimzi administrators</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>CRDs and custom resources are defined as YAML files.</p>
</div>
<div class="paragraph">
<p>A CRD defines a new <code>kind</code> of resource, such as <code>kind:Kafka</code>, within a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>The Kubernetes API server allows custom resources to be created based on the <code>kind</code> and understands from the CRD how to validate and store the custom resource when it is added to the Kubernetes cluster.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When CRDs are deleted, custom resources of that type are also deleted. Additionally, the resources created by the custom resource, such as pods and statefulsets are also deleted.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/" target="_blank" rel="noopener">Extend the Kubernetes API with CustomResourceDefinitions</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-custom-resources-example-str"><a class="link" href="#con-custom-resources-example-str">2.2.1. Strimzi custom resource example</a></h4>
<div class="paragraph">
<p>Each Strimzi-specific custom resource conforms to the schema defined by the CRD for the resource&#8217;s <code>kind</code>.</p>
</div>
<div class="paragraph">
<p>To understand the relationship between a CRD and a custom resource, let&#8217;s look at a sample of the CRD for a Kafka topic.</p>
</div>
<div class="listingblock">
<div class="title">Kafka topic CRD</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: CustomResourceDefinition
metadata: <b class="conum">(1)</b>
  name: kafkatopics.kafka.strimzi.io
  labels:
    app: strimzi
spec: <b class="conum">(2)</b>
  group: kafka.strimzi.io
  versions:
    v1beta1
  scope: Namespaced
  names:
    # ...
    singular: kafkatopic
    plural: kafkatopics
    shortNames:
    - kt <b class="conum">(3)</b>
  additionalPrinterColumns: <b class="conum">(4)</b>
      # ...
  subresources:
    status: {} <b class="conum">(5)</b>
  validation: <b class="conum">(6)</b>
    openAPIV3Schema:
      properties:
        spec:
          type: object
          properties:
            partitions:
              type: integer
              minimum: 1
            replicas:
              type: integer
              minimum: 1
              maximum: 32767
      # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The metadata for the topic CRD, its name and a label to identify the CRD.</p>
</li>
<li>
<p>The specification for this CRD, including the group (domain) name, the plural name and the supported schema version, which are used in the URL to access the API of the topic. The other names are used to identify instance resources in the CLI. For example, <code>kubectl get kafkatopic my-topic</code> or <code>kubectl get kafkatopics</code>.</p>
</li>
<li>
<p>The shortname can be used in CLI commands. For example, <code>kubectl get kt</code> can be used as an abbreviation instead of <code>kubectl get kafkatopic</code>.</p>
</li>
<li>
<p>The information presented when using a <code>get</code> command on the custom resource.</p>
</li>
<li>
<p>The current status of the CRD as described in the <a href="#type-Kafka-reference">schema reference</a> for the resource.</p>
</li>
<li>
<p>openAPIV3Schema validation provides validation for the creation of topic custom resources. For example, a topic requires at least one partition and one replica.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can identify the CRD YAML files supplied with the Strimzi installation files, because the file names contain an index number followed by Crd.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a corresponding example of a <code>KafkaTopic</code> custom resource.</p>
</div>
<div class="listingblock">
<div class="title">Kafka topic custom resource</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic <b class="conum">(1)</b>
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster <b class="conum">(2)</b>
spec: <b class="conum">(3)</b>
  partitions: 1
  replicas: 1
  config:
    retention.ms: 7200000
    segment.bytes: 1073741824
status:
  conditions: <b class="conum">(4)</b>
    lastTransitionTime: "2019-08-20T11:37:00.706Z"
    status: "True"
    type: Ready
  observedGeneration: 1
  / ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>kind</code> and <code>apiVersion</code> identify the CRD of which the custom resource is an instance.</p>
</li>
<li>
<p>A label, applicable only to <code>KafkaTopic</code> and <code>KafkaUser</code> resources, that defines the name of the Kafka cluster (which is same as the name of the <code>Kafka</code> resource) to which a topic or user belongs.</p>
<div class="paragraph">
<p>The name is used by the <a href="#con-topic-operator-cluster-label-deploying">Topic Operator</a> and <a href="#con-user-operator-cluster-label-deploying-uo">User Operator</a> to identify the Kafka cluster when creating a topic or user.</p>
</div>
</li>
<li>
<p>The spec shows the number of partitions and replicas for the topic as well as the configuration parameters for the topic itself. In this example, the retention period for a message to remain in the topic and the segment file size for the log are specified.</p>
</li>
<li>
<p>Status conditions for the <code>KafkaTopic</code> resource. The <code>type</code> condition changed to <code>Ready</code> at the <code>lastTransitionTime</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Custom resources can be applied to a cluster through the platform CLI. When the custom resource is created, it uses the same validation as the built-in resources of the Kubernetes API.</p>
</div>
<div class="paragraph">
<p>After a <code>KafkaTopic</code> custom resource is created, the Topic Operator is notified and corresponding Kafka topics are created in Strimzi.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-custom-resources-status-str"><a class="link" href="#con-custom-resources-status-str">2.2.2. Strimzi custom resource status</a></h4>
<div class="paragraph">
<p>The <code>status</code> property of a Strimzi custom resource publishes information about the resource to users and tools that need it.</p>
</div>
<div class="paragraph">
<p>Several resources have a <code>status</code> property, as described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Strimzi resource</th>
<th class="tableblock halign-left valign-top">Schema reference</th>
<th class="tableblock halign-left valign-top">Publishes status information on&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Kafka</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaStatus-reference"><code>KafkaStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka Connect cluster, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnectS2I</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2Istatus-reference"><code>KafkaConnectS2Istatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka Connect cluster with Source-to-Image support, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaMirrorMaker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka MirrorMaker tool, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka topics in your Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka users in your Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaBridge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Strimzi Kafka Bridge, if deployed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>status</code> property of a resource provides information on the resource&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Current state</em>, in the <code>status.conditions</code> property</p>
</li>
<li>
<p><em>Last observed generation</em>, in the <code>status.observedGeneration</code> property</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>status</code> property also provides resource-specific information. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KafkaConnectStatus</code> provides the REST API endpoint for Kafka Connect connectors.</p>
</li>
<li>
<p><code>KafkaUserStatus</code> provides the user name of the Kafka user and the <code>Secret</code> in which their credentials are stored.</p>
</li>
<li>
<p><code>KafkaBridgeStatus</code> provides the HTTP address at which external client applications can access the Bridge service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource&#8217;s <em>current state</em> is useful for tracking progress related to the resource achieving its <em>desired state</em>, as defined by the <code>spec</code> property. The status conditions provide the time and reason the state of the resource changed and details of events preventing or delaying the operator from realizing the resource&#8217;s desired state.</p>
</div>
<div class="paragraph">
<p>The <em>last observed generation</em> is the generation of the resource that was last reconciled by the Cluster Operator. If the value of <code>observedGeneration</code> is different from the value of <code>metadata.generation</code>, the operator has not yet processed the latest update to the resource. If these values are the same, the status information reflects the most recent changes to the resource.</p>
</div>
<div class="paragraph">
<p>Strimzi creates and maintains the status of custom resources, periodically evaluating the current state of the custom resource and updating its status accordingly.
When performing an update on a custom resource using <code>kubectl edit</code>, for example, its <code>status</code> is not editable. Moreover, changing the <code>status</code> would not affect the configuration of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Here we see the <code>status</code> property specified for a Kafka custom resource.</p>
</div>
<div class="listingblock">
<div class="title">Kafka custom resource with status</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
spec:
  # ...
status:
  conditions: <b class="conum">(1)</b>
  - lastTransitionTime: 2019-07-23T23:46:57+0000
    status: "True"
    type: Ready <b class="conum">(2)</b>
  observedGeneration: 4 <b class="conum">(3)</b>
  listeners: <b class="conum">(4)</b>
  - addresses:
    - host: my-cluster-kafka-bootstrap.myproject.svc
      port: 9092
    type: plain
  - addresses:
    - host: my-cluster-kafka-bootstrap.myproject.svc
      port: 9093
    type: tls
  - addresses:
    - host: 172.29.49.180
      port: 9094
    type: external
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Status <code>conditions</code> describe criteria related to the status that cannot be deduced from the existing resource information, or are specific to the instance of a resource.</p>
</li>
<li>
<p>The <code>Ready</code> condition indicates whether the Cluster Operator currently considers the Kafka cluster able to handle traffic.</p>
</li>
<li>
<p>The <code>observedGeneration</code> indicates the generation of the <code>Kafka</code> custom resource that was last reconciled by the Cluster Operator.</p>
</li>
<li>
<p>The <code>listeners</code> describe the current Kafka bootstrap addresses by type.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The address in the custom resource status for external listeners with type <code>nodeport</code> is currently not supported.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Kafka bootstrap addresses listed in the status do not signify that those endpoints or the Kafka cluster is in a ready state.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Accessing status information</div>
<p>You can access status information for a resource from the command line. For more information, see <a href="#proc-accessing-resource-status-str">Checking the status of a custom resource</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-operator-str"><a class="link" href="#cluster-operator-str">2.3. Cluster Operator</a></h3>
<div class="paragraph">
<p>The Cluster Operator is responsible for deploying and managing Apache Kafka clusters within a Kubernetes cluster.</p>
</div>
<div class="sect3">
<h4 id="con-what-the-cluster-operator-does-str"><a class="link" href="#con-what-the-cluster-operator-does-str">2.3.1. Overview of the Cluster Operator component</a></h4>
<div class="paragraph">
<p>Strimzi uses the Cluster Operator to deploy and manage clusters for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka (including Zookeeper, Entity Operator and Kafka Exporter)</p>
</li>
<li>
<p>Kafka Connect</p>
</li>
<li>
<p>Kafka Mirror Maker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom resources are used to deploy the clusters.</p>
</div>
<div class="paragraph">
<p>For example, to deploy a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Kafka</code> resource with the cluster configuration is created within the Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator deploys a corresponding Kafka cluster, based on what is declared in the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Cluster Operator can also deploy (through Entity Operator configuration of the <code>Kafka</code> resource):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Topic Operator to provide operator-style topic management through <code>KafkaTopic</code> custom resources</p>
</li>
<li>
<p>A User Operator to provide operator-style user management through <code>KafkaUser</code> custom resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on the configuration options supported by the <code>Kafka</code> resource, see <a href="#assembly-deployment-configuration-kafka-str">Kafka cluster configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
On OpenShift, a Kafka Connect deployment can incorporate a Source2Image feature to provides a convenient way to include connectors.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Cluster Operator</div>
<p><span class="image"><img src="images/cluster-operator.png" alt="Cluster Operator"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="con-cluster-operator-watch-options-str"><a class="link" href="#con-cluster-operator-watch-options-str">2.3.2. Watch options for a Cluster Operator deployment</a></h4>
<div class="paragraph">
<p>When the Cluster Operator is running, it starts to <em>watch</em> for updates of Kafka resources.</p>
</div>
<div class="paragraph">
<p>Depending on the deployment, the Cluster Operator can watch Kafka resources from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#deploying-cluster-operator-str">A single namespace (the namespace it is installed)</a></p>
</li>
<li>
<p><a href="#deploying-cluster-operator-to-watch-multiple-namespacesstr">Multiple namespaces</a></p>
</li>
<li>
<p><a href="#deploying-cluster-operator-to-watch-whole-cluster-str">All namespaces</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi provides example YAML files to make the deployment process easier.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Cluster Operator watches the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka</code> for the Kafka cluster.</p>
</li>
<li>
<p><code>KafkaConnect</code> for the Kafka Connect cluster.</p>
</li>
<li>
<p><code>KafkaConnectS2I</code> for the Kafka Connect cluster with Source2Image support.</p>
</li>
<li>
<p><code>KafkaMirrorMaker</code> for the Kafka Mirror Maker instance.</p>
</li>
<li>
<p><code>KafkaBridge</code> for the Kafka Bridge instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of these resources is created in the Kubernetes cluster, the operator gets the cluster description from the resource and starts creating a new cluster for the resource by creating the necessary Kubernetes resources, such as StatefulSets, Services and ConfigMaps.</p>
</div>
<div class="paragraph">
<p>Each time a Kafka resource is updated, the operator performs corresponding updates on the Kubernetes resources that make up the cluster for the resource.</p>
</div>
<div class="paragraph">
<p>Resources are either patched or deleted, and then recreated in order to make the cluster for the resource reflect the desired state of the cluster. This operation might cause a rolling update that might lead to service disruption.</p>
</div>
<div class="paragraph">
<p>When a resource is deleted, the operator undeploys the cluster and deletes all related Kubernetes resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-str"><a class="link" href="#deploying-cluster-operator-str">2.3.3. Deploying the Cluster Operator to watch a single namespace</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Modify the installation files according to the namespace the Cluster Operator is going to be installed in.</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Deploy the Cluster Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-to-watch-multiple-namespacesstr"><a class="link" href="#deploying-cluster-operator-to-watch-multiple-namespacesstr">2.3.4. Deploying the Cluster Operator to watch multiple namespaces</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Edit the installation files according to the namespace the Cluster Operator is going to be installed in.</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the file <code>install/cluster-operator/050-Deployment-strimzi-cluster-operator.yaml</code> and in the environment variable <code>STRIMZI_NAMESPACE</code> list all the namespaces where Cluster Operator should watch for resources.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      serviceAccountName: strimzi-cluster-operator
      containers:
      - name: strimzi-cluster-operator
        image: strimzi/operator:latest
        imagePullPolicy: IfNotPresent
        env:
        - name: STRIMZI_NAMESPACE
          value: watched-namespace-1,watched-namespace-2,watched-namespace-3</code></pre>
</div>
</div>
</li>
<li>
<p>For all namespaces which should be watched by the Cluster Operator (<code>watched-namespace-1</code>, <code>watched-namespace-2</code>, <code>watched-namespace-3</code> in the above example), install the <code>RoleBindings</code>.
Replace the <code><em>watched-namespace</em></code> with the namespace used in the previous step.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator/020-RoleBinding-strimzi-cluster-operator.yaml -n <em>watched-namespace</em>
kubectl apply -f install/cluster-operator/031-RoleBinding-strimzi-cluster-operator-entity-operator-delegation.yaml -n <em>watched-namespace</em>
kubectl apply -f install/cluster-operator/032-RoleBinding-strimzi-cluster-operator-topic-operator-delegation.yaml -n <em>watched-namespace</em></code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-to-watch-whole-cluster-str"><a class="link" href="#deploying-cluster-operator-to-watch-whole-cluster-str">2.3.5. Deploying the Cluster Operator to watch all namespaces</a></h4>
<div class="paragraph">
<p>You can configure the Cluster Operator to watch Strimzi resources across all namespaces in your Kubernetes cluster. When running in this mode, the Cluster Operator automatically manages clusters in any new namespaces that are created.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Your Kubernetes cluster is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the Cluster Operator to watch all namespaces:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the <code>050-Deployment-strimzi-cluster-operator.yaml</code> file.</p>
</li>
<li>
<p>Set the value of the <code>STRIMZI_NAMESPACE</code> environment variable to <code>*</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      # ...
      serviceAccountName: strimzi-cluster-operator
      containers:
      - name: strimzi-cluster-operator
        image: strimzi/operator:latest
        imagePullPolicy: IfNotPresent
        env:
        - name: STRIMZI_NAMESPACE
          value: "*"
        # ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create <code>ClusterRoleBindings</code> that grant cluster-wide access to all namespaces to the Cluster Operator.</p>
<div class="paragraph">
<p>Use the <code>kubectl create clusterrolebinding</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create clusterrolebinding strimzi-cluster-operator-namespaced --clusterrole=strimzi-cluster-operator-namespaced --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator
kubectl create clusterrolebinding strimzi-cluster-operator-entity-operator-delegation --clusterrole=strimzi-entity-operator --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator
kubectl create clusterrolebinding strimzi-cluster-operator-topic-operator-delegation --clusterrole=strimzi-topic-operator --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code><em>my-namespace</em></code> with the namespace in which you want to install the Cluster Operator.</p>
</div>
</li>
<li>
<p>Deploy the Cluster Operator to your Kubernetes cluster.</p>
<div class="paragraph">
<p>Use the <code>kubectl apply</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-helm-chart-str"><a class="link" href="#deploying-cluster-operator-helm-chart-str">2.3.6. Deploying the Cluster Operator using Helm Chart</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Helm client has to be installed on the local machine.</p>
</li>
<li>
<p>Helm has to be installed in the Kubernetes cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the Strimzi Helm Chart repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm repo add strimzi https://strimzi.io/charts/</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator using the Helm command line tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm install strimzi/strimzi-kafka-operator</code></pre>
</div>
</div>
</li>
<li>
<p>Verify whether the Cluster Operator has been deployed successfully using the Helm command line tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm ls</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Helm, see the <a href="https://helm.sh/" target="_blank" rel="noopener">Helm website</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-from-operator-hub-str"><a class="link" href="#deploying-cluster-operator-from-operator-hub-str">2.3.7. Deploying the Cluster Operator from OperatorHub.io</a></h4>
<div class="paragraph">
<p><a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a> is a catalog of Kubernetes Operators sourced from multiple providers.
It offers you an alternative way to install stable versions of Strimzi using the Strimzi Kafka Operator.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/operator-framework/operator-lifecycle-manager" target="_blank" rel="noopener">Operator Lifecycle Manager</a> is used for the installation and management of all Operators published on <a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a>.</p>
</div>
<div class="paragraph">
<p>To install Strimzi from <a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a>, locate the Strimzi Kafka Operator and follow the instructions provided.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kafka-cluster-str"><a class="link" href="#kafka-cluster-str">2.4. Kafka cluster</a></h3>
<div class="paragraph">
<p>You can use Strimzi to deploy an ephemeral or persistent Kafka cluster to Kubernetes. When installing Kafka, Strimzi also installs a Zookeeper cluster and adds the necessary configuration to connect Kafka with Zookeeper.</p>
</div>
<div class="paragraph">
<p>You can also use it to deploy <a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">Kafka Exporter</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ephemeral cluster</dt>
<dd>
<p>In general, an ephemeral (that is, temporary) Kafka cluster is suitable for development and testing purposes, not for production. This deployment uses <code>emptyDir</code> volumes for storing broker information (for Zookeeper) and topics or partitions (for Kafka). Using an <code>emptyDir</code> volume means that its content is strictly related to the pod life cycle and is deleted when the pod goes down.</p>
</dd>
<dt class="hdlist1">Persistent cluster</dt>
<dd>
<p>A persistent Kafka cluster uses <code>PersistentVolumes</code> to store Zookeeper and Kafka data. The <code>PersistentVolume</code> is
acquired using a <code>PersistentVolumeClaim</code> to make it independent of the actual type of the <code>PersistentVolume</code>. For example, it can use
Amazon EBS volumes in Amazon AWS deployments without any changes in the YAML files. The <code>PersistentVolumeClaim</code> can use a <code>StorageClass</code> to trigger automatic volume provisioning.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Strimzi includes two templates for deploying a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kafka-ephemeral.yaml</code> deploys an ephemeral cluster, named <code>my-cluster</code> by default.</p>
</li>
<li>
<p><code>kafka-persistent.yaml</code> deploys a persistent cluster, named <code>my-cluster</code> by default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cluster name is defined by the name of the resource and cannot be changed after the cluster has been deployed. To change the cluster name before you deploy the cluster, edit the <code>Kafka.metadata.name</code> property of the resource in the relevant YAML file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
# ...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="deploying-kafka-cluster-str"><a class="link" href="#deploying-kafka-cluster-str">2.4.1. Deploying the Kafka cluster</a></h4>
<div class="paragraph">
<p>You can deploy an ephemeral or persistent Kafka cluster to Kubernetes on the command line.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is deployed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you plan to use the cluster for development or testing purposes, you can create and deploy an ephemeral cluster using <code>kubectl apply</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka/kafka-ephemeral.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>If you plan to use the cluster in production, create and deploy a persistent cluster using <code>kubectl apply</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka/kafka-persistent.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information on the different configuration options supported by the <code>Kafka</code> resource, see <a href="#assembly-deployment-configuration-kafka-str">Kafka cluster configuration</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kafka-connect-str"><a class="link" href="#kafka-connect-str">2.5. Kafka Connect</a></h3>
<div class="paragraph">
<p><a href="https://kafka.apache.org/documentation/#connect" target="_blank" rel="noopener">Kafka Connect</a> is a tool for streaming data between Apache Kafka and external systems. It provides a framework for moving large amounts of data into and out of your Kafka cluster while maintaining scalability and reliability. Kafka Connect is typically used to integrate Kafka with external databases and storage and messaging systems.</p>
</div>
<div class="paragraph">
<p>You can use Kafka Connect to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build connector plug-ins (as JAR files) for your Kafka cluster</p>
</li>
<li>
<p>Run connectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kafka Connect includes the following built-in connectors for moving file-based data into and out of your Kafka cluster.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File Connector</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FileStreamSourceConnector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfers data to your Kafka cluster from a file (the source).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FileStreamSinkConnector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transfers data from your Kafka cluster to a file (the sink).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In Strimzi, you can use the Cluster Operator to deploy a Kafka Connect to your Kubernetes cluster.
OpenShift also supports Kafka Connect Source-2-Image (S2I) clusters.</p>
</div>
<div class="paragraph">
<p>A Kafka Connect cluster is implemented as a <code>Deployment</code> with a configurable number of workers. The Kafka Connect REST API is available on port 8083, as the <code>&lt;connect-cluster-name&gt;-connect-api</code> service.</p>
</div>
<div class="paragraph">
<p>For more information on deploying a Kafka Connect S2I cluster on OpenShift, see <a href="#using-openshift-s2i-create-image-str">Creating a container image using OpenShift builds and Source-to-Image</a>.</p>
</div>
<div class="sect3">
<h4 id="deploying-kafka-connect-str"><a class="link" href="#deploying-kafka-connect-str">2.5.1. Deploying Kafka Connect to your cluster</a></h4>
<div class="paragraph">
<p>You can deploy a Kafka Connect cluster to your Kubernetes cluster by using the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#deploying-cluster-operator-str">Deploying the Cluster Operator</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>kubectl apply</code> command to create a <code>KafkaConnect</code> resource based on the <code>kafka-connect.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka-connect/kafka-connect.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-deployment-configuration-kafka-connect-str">Kafka Connect cluster configuration</a></p>
</li>
<li>
<p><a href="#assembly-deployment-configuration-kafka-connect-s2i-str">Kafka Connect cluster with Source2Image support</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-kafka-connect-with-plug-ins-str"><a class="link" href="#using-kafka-connect-with-plug-ins-str">2.5.2. Extending Kafka Connect with connector plug-ins</a></h4>
<div class="paragraph">
<p>The Strimzi container images for Kafka Connect include the two built-in file connectors: <code>FileStreamSourceConnector</code> and <code>FileStreamSinkConnector</code>.
You can add your own connectors by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a container image from the Kafka Connect base image (manually or using your CI (continuous integration), for example).</p>
</li>
<li>
<p>Creating a container image using OpenShift builds and Source-to-Image (S2I) - available only on OpenShift.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="creating-new-image-from-base-str"><a class="link" href="#creating-new-image-from-base-str">Creating a Docker image from the Kafka Connect base image</a></h5>
<div class="paragraph">
<p>You can use the Kafka container image on <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a> as a base image for creating your own custom image with additional connector plug-ins.</p>
</div>
<div class="paragraph">
<p>The following procedure explains how to create your custom image and add it to the <code>/opt/kafka/plugins</code> directory. At startup, the Strimzi version of Kafka Connect loads any third-party connector plug-ins contained in the <code>/opt/kafka/plugins</code> directory.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#deploying-cluster-operator-str">Deploying the Cluster Operator</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new <code>Dockerfile</code> using <code>strimzi/kafka:latest-kafka-2.3.0</code> as the base image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">FROM strimzi/kafka:latest-kafka-2.3.0
USER root:root
COPY ./<em>my-plugins</em>/ /opt/kafka/plugins/
USER 1001</code></pre>
</div>
</div>
</li>
<li>
<p>Build the container image.</p>
</li>
<li>
<p>Push your custom image to your container registry.</p>
</li>
<li>
<p>Point to the new container image.</p>
<div class="paragraph">
<p>You can either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the <code>KafkaConnect.spec.image</code> property of the <code>KafkaConnect</code> custom resource.</p>
<div class="paragraph">
<p>If set, this property overrides the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> variable in the Cluster Operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  image: my-new-container-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>In the <code>install/cluster-operator/050-Deployment-strimzi-cluster-operator.yaml</code> file, edit the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> variable to point to the new container image and reinstall the Cluster Operator.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on the <code>KafkaConnect.spec.image property</code>, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka-connect">Container images</a>.</p>
</li>
<li>
<p>For more information on the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> variable, see <a href="#ref-operators-cluster-operator-configuration-deploying-co">Cluster Operator Configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="using-openshift-s2i-create-image-str"><a class="link" href="#using-openshift-s2i-create-image-str">Creating a container image using OpenShift builds and Source-to-Image</a></h5>
<div class="paragraph">
<p>You can use OpenShift <a href="https://docs.okd.io/3.9/dev_guide/builds/index.html" target="_blank" rel="noopener">builds</a> and the  <a href="https://docs.okd.io/3.9/creating_images/s2i.html" target="_blank" rel="noopener">Source-to-Image (S2I)</a> framework to create new container images. An OpenShift build takes a builder image with S2I support, together with source code and binaries provided by the user, and uses them to build a new container image. Once built, container images are stored in OpenShift&#8217;s local container image repository and are available for use in deployments.</p>
</div>
<div class="paragraph">
<p>A Kafka Connect builder image with S2I support is provided on the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a> as part of the <code>strimzi/kafka:latest-kafka-2.3.0</code> image. This S2I image takes your binaries (with plug-ins and connectors) and stores them in the <code>/tmp/kafka-plugins/s2i</code> directory. It creates a new Kafka Connect image from this directory, which can then be used with the Kafka Connect deployment. When started using the enhanced image, Kafka Connect loads any third-party plug-ins from the <code>/tmp/kafka-plugins/s2i</code> directory.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the command line, use the <code>oc apply</code> command to create and deploy a Kafka Connect S2I cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc apply -f examples/kafka-connect/kafka-connect-s2i.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create a directory with Kafka Connect plug-ins:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ tree ./<em>my-plugins</em>/
./<em>my-plugins</em>/
 debezium-connector-mongodb
  bson-3.4.2.jar
  CHANGELOG.md
  CONTRIBUTE.md
  COPYRIGHT.txt
  debezium-connector-mongodb-0.7.1.jar
  debezium-core-0.7.1.jar
  LICENSE.txt
  mongodb-driver-3.4.2.jar
  mongodb-driver-core-3.4.2.jar
  README.md
 debezium-connector-mysql
  CHANGELOG.md
  CONTRIBUTE.md
  COPYRIGHT.txt
  debezium-connector-mysql-0.7.1.jar
  debezium-core-0.7.1.jar
  LICENSE.txt
  mysql-binlog-connector-java-0.13.0.jar
  mysql-connector-java-5.1.40.jar
  README.md
  wkb-1.0.2.jar
 debezium-connector-postgres
     CHANGELOG.md
     CONTRIBUTE.md
     COPYRIGHT.txt
     debezium-connector-postgres-0.7.1.jar
     debezium-core-0.7.1.jar
     LICENSE.txt
     postgresql-42.0.0.jar
     protobuf-java-2.6.1.jar
     README.md</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>oc start-build</code> command to start a new build of the image using the prepared directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc start-build <em>my-connect-cluster-connect</em> --from-dir ./<em>my-plugins</em>/</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The name of the build is the same as the name of the deployed Kafka Connect cluster.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Once the build has finished, the new image is used automatically by the Kafka Connect deployment.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kafka-mirror-maker-str"><a class="link" href="#kafka-mirror-maker-str">2.6. Kafka Mirror Maker</a></h3>
<div class="paragraph">
<p>The Cluster Operator deploys one or more Kafka Mirror Maker replicas to replicate data between Kafka clusters.
This process is called mirroring to avoid confusion with the Kafka partitions replication concept.
The Mirror Maker consumes messages from the source cluster and republishes those messages to the target cluster.</p>
</div>
<div class="paragraph">
<p>For information about example resources and the format for deploying Kafka Mirror Maker, see <a href="#assembly-deployment-configuration-kafka-mirror-maker-str">Kafka Mirror Maker configuration</a>.</p>
</div>
<div class="sect3">
<h4 id="deploying-kafka-mirror-maker-str"><a class="link" href="#deploying-kafka-mirror-maker-str">2.6.1. Deploying Kafka Mirror Maker</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Before deploying Kafka Mirror Maker, the Cluster Operator must be deployed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a Kafka Mirror Maker cluster from the command-line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka-mirror-maker/kafka-mirror-maker.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kafka-bridge-str"><a class="link" href="#kafka-bridge-str">2.7. Kafka Bridge</a></h3>
<div class="paragraph">
<p>The Cluster Operator deploys one or more Kafka bridge replicas to send data between Kafka clusters and clients via HTTP API.</p>
</div>
<div class="paragraph">
<p>For information about example resources and the format for deploying Kafka Bridge, see <a href="#assembly-deployment-configuration-kafka-bridge-str">Kafka Bridge configuration</a>.</p>
</div>
<div class="sect3">
<h4 id="deploying-kafka-bridge-str"><a class="link" href="#deploying-kafka-bridge-str">2.7.1. Deploying Kafka Bridge to your Kubernetes cluster</a></h4>
<div class="paragraph">
<p>You can deploy a Kafka Bridge cluster to your Kubernetes cluster by using the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#deploying-cluster-operator-str">Deploying the Cluster Operator to Kubernetes</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Use the <code>kubectl apply</code> command to create a <code>KafkaBridge</code> resource based on the <code>kafka-bridge.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka-bridge/kafka-bridge.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-deployment-configuration-kafka-bridge-str">Kafka Bridge configuration</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-example-clients-str"><a class="link" href="#deploying-example-clients-str">2.8. Deploying example clients</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster for the client to connect to.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy the producer.</p>
<div class="paragraph">
<p>Use <code>kubectl run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl run kafka-producer -ti --image=strimzi/kafka:latest-kafka-2.3.0 --rm=true --restart=Never -- bin/kafka-console-producer.sh --broker-list <em>cluster-name</em>-kafka-bootstrap:9092 --topic <em>my-topic</em></code></pre>
</div>
</div>
</li>
<li>
<p>Type your message into the console where the producer is running.</p>
</li>
<li>
<p>Press Enter to send the message.</p>
</li>
<li>
<p>Deploy the consumer.</p>
<div class="paragraph">
<p>Use <code>kubectl run</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl run kafka-consumer -ti --image=strimzi/kafka:latest-kafka-2.3.0 --rm=true --restart=Never -- bin/kafka-console-consumer.sh --bootstrap-server <em>cluster-name</em>-kafka-bootstrap:9092 --topic <em>my-topic</em> --from-beginning</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that you see the incoming messages in the consumer console.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="assembly-getting-started-topic-operator-str"><a class="link" href="#assembly-getting-started-topic-operator-str">2.9. Topic Operator</a></h3>
<div class="paragraph">
<p>The Topic Operator is responsible for managing Kafka topics within a Kafka cluster running within a Kubernetes cluster.</p>
</div>
<div class="sect3">
<h4 id="what-the-topic-operator-does-str"><a class="link" href="#what-the-topic-operator-does-str">2.9.1. Overview of the Topic Operator component</a></h4>
<div class="paragraph">
<p>The Topic Operator provides a way of managing topics in a Kafka cluster via Kubernetes resources.</p>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Topic Operator</div>
<p><span class="image"><img src="images/topic-operator.png" alt="Topic Operator"></span></p>
</div>
<div class="paragraph">
<p>The role of the Topic Operator is to keep a set of <code>KafkaTopic</code> Kubernetes resources describing Kafka topics in-sync with corresponding Kafka topics.</p>
</div>
<div class="paragraph">
<p>Specifically, if a <code>KafkaTopic</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created, the operator will create the topic it describes</p>
</li>
<li>
<p>Deleted, the operator will delete the topic it describes</p>
</li>
<li>
<p>Changed, the operator will update the topic it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And also, in the other direction, if a topic is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created within the Kafka cluster, the operator will create a <code>KafkaTopic</code> describing it</p>
</li>
<li>
<p>Deleted from the Kafka cluster, the operator will delete the <code>KafkaTopic</code> describing it</p>
</li>
<li>
<p>Changed in the Kafka cluster, the operator will update the <code>KafkaTopic</code> describing it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows you to declare a <code>KafkaTopic</code> as part of your application&#8217;s deployment and the Topic Operator will take care of creating the topic for you.
Your application just needs to deal with producing or consuming from the necessary topics.</p>
</div>
<div class="paragraph">
<p>If the topic is reconfigured or reassigned to different Kafka nodes, the <code>KafkaTopic</code> will always be up to date.</p>
</div>
<div class="paragraph">
<p>For more details about creating, modifying and deleting topics, see <a href="#using-the-topic-operator-str">Using the Topic Operator</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploying-the-topic-operator-using-the-cluster-operator-str"><a class="link" href="#deploying-the-topic-operator-using-the-cluster-operator-str">2.9.2. Deploying the Topic Operator using the Cluster Operator</a></h4>
<div class="paragraph">
<p>This procedure describes how to deploy the Topic Operator using the Cluster Operator.
If you want to use the Topic Operator with a Kafka cluster that is not managed by Strimzi, you must deploy the Topic Operator as a standalone component. For more information, see <a href="#deploying-the-topic-operator-standalone-deploying">Deploying the standalone Topic Operator</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource to be created or updated</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the <code>Kafka.spec.entityOperator</code> object exists in the <code>Kafka</code> resource. This configures the Entity Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  #...
  entityOperator:
    <strong>topicOperator: {}</strong>
    userOperator: {}</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Topic Operator using the fields described in <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code> schema reference</a>.</p>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Entity Operator, see <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">Entity Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>Kafka.spec.entityOperator</code> object used to configure the Topic Operator when deployed by the Cluster Operator, see <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-getting-started-user-operator-str"><a class="link" href="#assembly-getting-started-user-operator-str">2.10. User Operator</a></h3>
<div class="paragraph">
<p>The User Operator is responsible for managing Kafka users within a Kafka cluster running within a Kubernetes cluster.</p>
</div>
<div class="sect3">
<h4 id="con-what-the-user-operator-does-str"><a class="link" href="#con-what-the-user-operator-does-str">2.10.1. Overview of the User Operator component</a></h4>
<div class="paragraph">
<p>The User Operator manages Kafka users for a Kafka cluster by watching for <code>KafkaUser</code> resources that describe Kafka users and ensuring that they are configured properly in the Kafka cluster.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a <code>KafkaUser</code> is created, the User Operator will create the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is deleted, the User Operator will delete the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is changed, the User Operator will update the user it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike the <a href="#what-the-topic-operator-does-str">Topic Operator</a>, the User Operator does not sync any changes from the Kafka cluster with the Kubernetes resources.
Unlike the Kafka topics which might be created by applications directly in Kafka, it is not expected that the users will be managed directly in the Kafka cluster in parallel with the User Operator, so this should not be needed.</p>
</div>
<div class="paragraph">
<p>The User Operator allows you to declare a <code>KafkaUser</code> as part of your application&#8217;s deployment.
When the user is created, the user credentials will be created in a <code>Secret</code>.
Your application needs to use the user and its credentials for authentication and to produce or consume messages.</p>
</div>
<div class="paragraph">
<p>In addition to managing credentials for authentication, the User Operator also manages authorization rules by including a description of the user&#8217;s rights in the <code>KafkaUser</code> declaration.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-deploying-the-user-operator-using-the-cluster-operator-str"><a class="link" href="#proc-deploying-the-user-operator-using-the-cluster-operator-str">2.10.2. Deploying the User Operator using the Cluster Operator</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource to be created or updated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>Kafka</code> resource ensuring it has a <code>Kafka.spec.entityOperator.userOperator</code> object that configures the User Operator how you want.</p>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>Kafka.spec.entityOperator</code> object used to configure the User Operator when deployed by the Cluster Operator, see <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-getting-started-strimzi-admin-str"><a class="link" href="#assembly-getting-started-strimzi-admin-str">2.11. Strimzi Administrators</a></h3>
<div class="paragraph">
<p>Strimzi includes several custom resources.
By default, permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators.
If you want to allow non-cluster administators to manage Strimzi resources, you must assign them the Strimzi Administrator role.</p>
</div>
<div class="sect3">
<h4 id="proc-adding-users-the-strimzi-admin-role-str"><a class="link" href="#proc-adding-users-the-strimzi-admin-role-str">2.11.1. Designating Strimzi Administrators</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi <code>CustomResourceDefinitions</code> are installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the <code>strimzi-admin</code> cluster role in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/strimzi-admin</code></pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>strimzi-admin</code> <code>ClusterRole</code> to one or more existing users in the Kubernetes cluster.</p>
<div class="paragraph">
<p>Use <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create clusterrolebinding strimzi-admin --clusterrole=strimzi-admin --user=<em>user1</em> --user=<em>user2</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="container-images-str"><a class="link" href="#container-images-str">2.12. Container images</a></h3>
<div class="paragraph">
<p>Container images for Strimzi are available in the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a>.
The installation YAML files provided by Strimzi will pull the images directly from the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>If you do not have access to the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a> or want to use your own container repository:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull <strong>all</strong> container images listed here</p>
</li>
<li>
<p>Push them into your own registry</p>
</li>
<li>
<p>Update the image names in the installation YAML files</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Each Kafka version supported for the release has a separate image.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Container image</th>
<th class="tableblock halign-left valign-top">Namespace/Repository</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>docker.io/strimzi/kafka:latest-kafka-2.2.1</p>
</li>
<li>
<p>docker.io/strimzi/kafka:latest-kafka-2.3.0</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Strimzi image for running Kafka, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Broker</p>
</li>
<li>
<p>Kafka Connect / S2I</p>
</li>
<li>
<p>Kafka Mirror Maker</p>
</li>
<li>
<p>Zookeeper</p>
</li>
<li>
<p>TLS Sidecars</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operator</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>docker.io/strimzi/operator:latest</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Strimzi image for running the operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster Operator</p>
</li>
<li>
<p>Topic Operator</p>
</li>
<li>
<p>User Operator</p>
</li>
<li>
<p>Kafka Initializer</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Bridge</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>docker.io/strimzi/kafka-bridge:latest</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Strimzi image for running the Strimzi kafka Bridge</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-deployment-configuration-str"><a class="link" href="#assembly-deployment-configuration-str">3. Deployment configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to configure different aspects of the supported deployments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka clusters</p>
</li>
<li>
<p>Kafka Connect clusters</p>
</li>
<li>
<p>Kafka Connect clusters with <em>Source2Image</em> support</p>
</li>
<li>
<p>Kafka Mirror Maker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
<li>
<p>OAuth 2.0 token based authentication</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-str"><a class="link" href="#assembly-deployment-configuration-kafka-str">3.1. Kafka cluster configuration</a></h3>
<div class="paragraph">
<p>The full schema of the <code>Kafka</code> resource is described in the <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.
All labels that are applied to the desired <code>Kafka</code> resource will also be applied to the Kubernetes resources making up the Kafka cluster.
This provides a convenient mechanism for resources to be labeled as required.</p>
</div>
<div class="sect3">
<h4 id="ref-sample-kafka-resource-config-deployment-configuration-kafka"><a class="link" href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">3.1.1. Sample Kafka YAML configuration</a></h4>
<div class="paragraph">
<p>For help in understanding the configuration options available for your Kafka deployment, refer to sample YAML file provided here.</p>
</div>
<div class="paragraph">
<p>The sample shows only some of the possible configuration options, but those that are particularly important include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource requests (CPU / Memory)</p>
</li>
<li>
<p>JVM options for maximum and minimum memory allocation</p>
</li>
<li>
<p>Listeners (and authentication)</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Storage</p>
</li>
<li>
<p>Rack awareness</p>
</li>
<li>
<p>Metrics</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    replicas: 3 <b class="conum">(1)</b>
    version: latest <b class="conum">(2)</b>
    resources: <b class="conum">(3)</b>
      requests:
        memory: 64Gi
        cpu: "8"
      limits: <b class="conum">(4)</b>
        memory: 64Gi
        cpu: "12"
    jvmOptions: <b class="conum">(5)</b>
      -Xms: 8192m
      -Xmx: 8192m
    listeners: <b class="conum">(6)</b>
      tls:
        authentication:<b class="conum">(7)</b>
          type: tls
      external: <b class="conum">(8)</b>
        type: route
        authentication:
          type: tls
    authorization: <b class="conum">(9)</b>
      type: simple
    config: <b class="conum">(10)</b>
      auto.create.topics.enable: "false"
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 2
    storage: <b class="conum">(11)</b>
      type: persistent-claim <b class="conum">(12)</b>
      size: 10000Gi <b class="conum">(13)</b>
    rack: <b class="conum">(14)</b>
      topologyKey: failure-domain.beta.kubernetes.io/zone
    metrics: <b class="conum">(15)</b>
      lowercaseOutputName: true
      rules: <b class="conum">(16)</b>
      # Special cases and very specific rules
      - pattern : kafka.server&lt;type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)&gt;&lt;&gt;Value
        name: kafka_server_$1_$2
        type: GAUGE
        labels:
          clientId: "$3"
          topic: "$4"
          partition: "$5"
        # ...
  zookeeper: <b class="conum">(17)</b>
    replicas: 3
    resources:
      requests:
        memory: 8Gi
        cpu: "2"
      limits:
        memory: 8Gi
        cpu: "2"
    jvmOptions:
      -Xms: 4096m
      -Xmx: 4096m
    storage:
      type: persistent-claim
      size: 1000Gi
    metrics:
      # ...
  entityOperator: <b class="conum">(18)</b>
    topicOperator:
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
    userOperator:
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
  kafkaExporter: <b class="conum">(19)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Replicas <a href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">specifies the number of broker nodes</a>.</p>
</li>
<li>
<p>Kafka version, <a href="#assembly-upgrade-str">which can be changed by following the upgrade procedure</a>.</p>
</li>
<li>
<p>Resource requests <a href="#ref-resource-limits-and-requests-deployment-configuration-kafka">specify the resources to reserve for a given container</a>.</p>
</li>
<li>
<p>Resource limits specify the maximum resources that can be consumed by a container.</p>
</li>
<li>
<p>JVM options can <a href="#ref-jvm-options-deployment-configuration-kafka">specify the minimum (<code>-Xms</code>) and maximum (<code>-Xmx</code>) memory allocation for JVM</a>.</p>
</li>
<li>
<p>Listeners configure how clients connect to the Kafka cluster via bootstrap addresses. Listeners are <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">configured as <code>plain</code> (without encryption), <code>tls</code> or <code>external</code></a>.</p>
</li>
<li>
<p>Listener authentication mechanisms may be configured for each listener, and <a href="#assembly-kafka-broker-listener-authentication-deployment-configuration-kafka">specified as mutual TLS or SCRAM-SHA</a>.</p>
</li>
<li>
<p>External listener configuration specifies <a href="#assembly-kafka-broker-external-listeners-deployment-configuration-kafka">how the Kafka cluster is exposed outside Kubernetes, such as through a <code>route</code>, <code>loadbalancer</code> or <code>nodeport</code></a>.</p>
</li>
<li>
<p>Authorization <a href="#ref-kafka-authorization-deployment-configuration-kafka">enables <code>simple</code> authorization on the Kafka broker using the <code>SimpleAclAuthorizer</code> Kafka plugin</a>.</p>
</li>
<li>
<p>Config specifies the broker configuration. <a href="#ref-kafka-broker-configuration-deployment-configuration-kafka">Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi</a>.</p>
</li>
<li>
<p>Storage is <a href="#assembly-storage-deployment-configuration-kafka">configured as <code>ephemeral</code>, <code>persistent-claim</code> or <code>jbod</code></a>.</p>
</li>
<li>
<p>Storage size for <a href="#proc-resizing-persistent-volumes-deployment-configuration-kafka">persistent volumes may be increased</a> and additional <a href="#proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka">volumes may be added to JBOD storage</a>.</p>
</li>
<li>
<p>Persistent storage has <a href="#ref-persistent-storage-deployment-configuration-kafka">additional configuration options</a>, such as a storage <code>id</code> and <code>class</code> for dynamic volume provisioning.</p>
</li>
<li>
<p>Rack awareness is configured to <a href="#assembly-kafka-rack-deployment-configuration-kafka">spread replicas across different racks</a>. A <code>topology</code> key must match the label of a cluster node.</p>
</li>
<li>
<p>Kafka <a href="#assembly-metrics-setup-str">metrics configuration for use with Prometheus</a>.</p>
</li>
<li>
<p>Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A set of rules provided with Strimzi may be copied to your Kafka resource configuration.</p>
</li>
<li>
<p><a href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">Zookeeper-specific configuration</a>, which contains properties similar to the Kafka configuration.</p>
</li>
<li>
<p>Entity Operator configuration, which <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">specifies the configuration for the Topic Operator and User Operator</a>.</p>
</li>
<li>
<p>Kafka Exporter configuration, which is used <a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">to expose data as Prometheus metrics</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="considerations-for-data-storage-deployment-configuration-kafka"><a class="link" href="#considerations-for-data-storage-deployment-configuration-kafka">3.1.2. Data storage considerations</a></h4>
<div class="paragraph">
<p>An efficient data storage infrastructure is essential to the optimal performance of Strimzi.</p>
</div>
<div class="paragraph">
<p>Strimzi requires block storage and is designed to work optimally with cloud-based block storage solutions, including Amazon Elastic Block Store (EBS). The use of file storage (for example, NFS) is not recommended.</p>
</div>
<div class="paragraph">
<p>Choose local storage (local persistent volumes) when possible. If local storage is not available, you can use a Storage Area Network (SAN) accessed by a protocol such as Fibre Channel or iSCSI.</p>
</div>
<div class="sect4">
<h5 id="apache_kafka_and_zookeeper_storage"><a class="link" href="#apache_kafka_and_zookeeper_storage">Apache Kafka and Zookeeper storage</a></h5>
<div class="paragraph">
<p>Use separate disks for Apache Kafka and Zookeeper.</p>
</div>
<div class="paragraph">
<p>Three types of data storage are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ephemeral (Recommended for development only)</p>
</li>
<li>
<p>Persistent</p>
</li>
<li>
<p>JBOD  (Just a Bunch of Disks, suitable for Kafka only)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="#assembly-storage-deployment-configuration-kafka">Kafka and Zookeeper storage</a>.</p>
</div>
<div class="paragraph">
<p>Solid-state drives (SSDs), though not essential, can improve the performance of Kafka in large clusters where data is sent to and received from multiple topics asynchronously. SSDs are particularly effective with Zookeeper, which requires fast, low latency data access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You do not need to provision replicated storage because Kafka and Zookeeper both have built-in data replication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="file_systems"><a class="link" href="#file_systems">File systems</a></h5>
<div class="paragraph">
<p>It is recommended that you configure your storage system to use the XFS file system. Strimzi is also compatible with the ext4 file system, but this might require additional configuration for best results.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-storage-deployment-configuration-kafka"><a class="link" href="#assembly-storage-deployment-configuration-kafka">3.1.3. Kafka and Zookeeper storage types</a></h4>
<div class="paragraph">
<p>As stateful applications, Kafka and Zookeeper need to store data on disk. Strimzi supports three storage types for this data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ephemeral</p>
</li>
<li>
<p>Persistent</p>
</li>
<li>
<p>JBOD storage</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
JBOD storage is supported only for Kafka, not for Zookeeper.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When configuring a <code>Kafka</code> resource, you can specify the type of storage used by the Kafka broker and its corresponding Zookeeper node. You configure the storage type using the <code>storage</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The storage type is configured in the <code>type</code> field.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The storage type cannot be changed after a Kafka cluster is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about ephemeral storage, see <a href="#type-EphemeralStorage-reference">ephemeral storage schema reference</a>.</p>
</li>
<li>
<p>For more information about persistent storage, see <a href="#type-PersistentClaimStorage-reference">persistent storage schema reference</a>.</p>
</li>
<li>
<p>For more information about JBOD storage, see <a href="#type-JbodStorage-reference">JBOD schema reference</a>.</p>
</li>
<li>
<p>For more information about the schema for <code>Kafka</code>, see <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-ephemeral-storage-deployment-configuration-kafka"><a class="link" href="#ref-ephemeral-storage-deployment-configuration-kafka">Ephemeral storage</a></h5>
<div class="paragraph">
<p>Ephemeral storage uses the <a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener">`emptyDir` volumes</a> to store data.
To use ephemeral storage, the <code>type</code> field should be set to <code>ephemeral</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>EmptyDir</code> volumes are not persistent and the data stored in them will be lost when the Pod is restarted.
After the new pod is started, it has to recover all data from other nodes of the cluster.
Ephemeral storage is not suitable for use with single node Zookeeper clusters and for Kafka topics with replication factor 1, because it will lead to data loss.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example of Ephemeral storage</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: ephemeral
    # ...
  zookeeper:
    # ...
    storage:
      type: ephemeral
    # ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="log_directories"><a class="link" href="#log_directories">Log directories</a></h6>
<div class="paragraph">
<p>The ephemeral volume will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>idx</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-persistent-storage-deployment-configuration-kafka"><a class="link" href="#ref-persistent-storage-deployment-configuration-kafka">Persistent storage</a></h5>
<div class="paragraph">
<p>Persistent storage uses <a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/" target="_blank" rel="noopener">Persistent Volume Claims</a> to provision persistent volumes for storing data.
Persistent Volume Claims can be used to provision volumes of many different types, depending on the <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">Storage Class</a> which will provision the volume.
The data types which can be used with persistent volume claims include many types of SAN storage as well as <a href="https://kubernetes.io/docs/concepts/storage/volumes/#local" target="_blank" rel="noopener">Local persistent volumes</a>.</p>
</div>
<div class="paragraph">
<p>To use persistent storage, the <code>type</code> has to be set to <code>persistent-claim</code>.
Persistent storage supports additional configuration options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>id</code> (optional)</dt>
<dd>
<p>Storage identification number. This option is mandatory for storage volumes defined in a JBOD storage declaration.
Default is <code>0</code>.</p>
</dd>
<dt class="hdlist1"><code>size</code> (required)</dt>
<dd>
<p>Defines the size of the persistent volume claim, for example, "1000Gi".</p>
</dd>
<dt class="hdlist1"><code>class</code> (optional)</dt>
<dd>
<p>The Kubernetes <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">Storage Class</a> to use for dynamic volume provisioning.</p>
</dd>
<dt class="hdlist1"><code>selector</code> (optional)</dt>
<dd>
<p>Allows selecting a specific persistent volume to use.
It contains key:value pairs representing labels for selecting such a volume.</p>
</dd>
<dt class="hdlist1"><code>deleteClaim</code> (optional)</dt>
<dd>
<p>Boolean value which specifies if the Persistent Volume Claim has to be deleted when the cluster is undeployed.
Default is <code>false</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Increasing the size of persistent volumes in an existing Strimzi cluster is only supported in Kubernetes versions that support persistent volume resizing. The persistent volume to be resized must use a storage class that supports volume expansion.
For other versions of Kubernetes and storage classes which do not support volume expansion, you must decide the necessary storage size before deploying the cluster.
Decreasing the size of existing persistent volumes is not possible.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with 1000Gi <code>size</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1000Gi
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of a storage class.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with specific Storage Class</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1Gi
  class: my-storage-class
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, a <code>selector</code> can be used to select a specific labeled persistent volume to provide needed features such as an SSD.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with selector</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1Gi
  selector:
    hdd-type: ssd
  deleteClaim: true
# ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="storage_class_overrides"><a class="link" href="#storage_class_overrides">Storage class overrides</a></h6>
<div class="paragraph">
<p>You can specify a different storage class for one or more Kafka brokers, instead of using the default storage class.
This is useful if, for example, storage classes are restricted to different availability zones or data centers.
You can use the <code>overrides</code> field for this purpose.</p>
</div>
<div class="paragraph">
<p>In this example, the default storage class is named <code>my-storage-class</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example Strimzi cluster using storage class overrides</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  labels:
    app: my-cluster
  name: my-cluster
  namespace: myproject
spec:
  # ...
  kafka:
    replicas: 3
    storage:
      deleteClaim: true
      size: 100Gi
      type: persistent-claim
      class: my-storage-class
      overrides:
        - broker: 0
          class: my-storage-class-zone-1a
        - broker: 1
          class: my-storage-class-zone-1b
        - broker: 2
          class: my-storage-class-zone-1c
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the configured <code>overrides</code> property, the broker volumes use the following storage classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The persistent volumes of broker 0 will use <code>my-storage-class-zone-1a</code>.</p>
</li>
<li>
<p>The persistent volumes of broker 1 will use <code>my-storage-class-zone-1b</code>.</p>
</li>
<li>
<p>The persistent volumes of broker 2 will use <code>my-storage-class-zone-1c</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>overrides</code> property is currently used only to override storage class configurations. Overriding other storage configuration fields is not currently supported.
Other fields from the storage configuration are currently not supported.</p>
</div>
</div>
<div class="sect5">
<h6 id="persistent_volume_claim_naming"><a class="link" href="#persistent_volume_claim_naming">Persistent Volume Claim naming</a></h6>
<div class="paragraph">
<p>When persistent storage is used, it creates Persistent Volume Claims with the following names:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Zookeeper node pod <code><em>idx</em></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="log_directories_2"><a class="link" href="#log_directories_2">Log directories</a></h6>
<div class="paragraph">
<p>The persistent volume will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>idx</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-resizing-persistent-volumes-deployment-configuration-kafka"><a class="link" href="#proc-resizing-persistent-volumes-deployment-configuration-kafka">Resizing persistent volumes</a></h5>
<div class="paragraph">
<p>You can provision increased storage capacity by increasing the size of the persistent volumes used by an existing Strimzi cluster.
Resizing persistent volumes is supported in clusters that use either a single persistent volume or multiple persistent volumes in a JBOD storage configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can increase but not decrease the size of persistent volumes.
Decreasing the size of persistent volumes is not currently supported in Kubernetes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster with support for volume resizing.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster using persistent volumes created using a storage class that supports volume expansion.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a <code>Kafka</code> resource, increase the size of the persistent volume allocated to the Kafka cluster, the Zookeeper cluster, or both.</p>
<div class="ulist">
<ul>
<li>
<p>To increase the volume size allocated to the Kafka cluster, edit the <code>spec.kafka.storage</code> property.</p>
</li>
<li>
<p>To increase the volume size allocated to the Zookeeper cluster, edit the <code>spec.zookeeper.storage</code> property.</p>
<div class="paragraph">
<p>For example, to increase the volume size from <code>1000Gi</code> to <code>2000Gi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: persistent-claim
      size: 2000Gi
      class: my-storage-class
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes increases the capacity of the selected persistent volumes in response to a request from the Cluster Operator.
When the resizing is complete, the Cluster Operator restarts all pods that use the resized persistent volumes.
This happens automatically.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about resizing persistent volumes in Kubernetes, see <a href="https://kubernetes.io/blog/2018/07/12/resizing-persistent-volumes-using-kubernetes/" target="_blank" rel="noopener">Resizing Persistent Volumes using Kubernetes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ref-jbod-storage-deployment-configuration-kafka"><a class="link" href="#ref-jbod-storage-deployment-configuration-kafka">JBOD storage overview</a></h5>
<div class="paragraph">
<p>You can configure Strimzi to use JBOD, a data storage configuration of multiple disks or volumes. JBOD is one approach to providing increased data storage for Kafka brokers. It can also improve performance.</p>
</div>
<div class="paragraph">
<p>A JBOD configuration is described by one or more volumes, each of which can be either <a href="#ref-ephemeral-storage-deployment-configuration-kafka">ephemeral</a> or <a href="#ref-persistent-storage-deployment-configuration-kafka">persistent</a>. The rules and constraints for JBOD volume declarations are the same as those for ephemeral and persistent storage. For example, you cannot change the size of a persistent storage volume after it has been provisioned.</p>
</div>
<div class="sect5">
<h6 id="jbod_configuration"><a class="link" href="#jbod_configuration">JBOD configuration</a></h6>
<div class="paragraph">
<p>To use JBOD with Strimzi, the storage <code>type</code> must be set to <code>jbod</code>. The <code>volumes</code> property allows you to describe the disks that make up your JBOD storage array or configuration. The following fragment shows an example JBOD configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: jbod
  volumes:
  - id: 0
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
  - id: 1
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ids cannot be changed once the JBOD volumes are created.</p>
</div>
<div class="paragraph">
<p>Users can add or remove volumes from the JBOD configuration.</p>
</div>
</div>
<div class="sect5">
<h6 id="jbod_and_persistent_volume_claims"><a class="link" href="#jbod_and_persistent_volume_claims">JBOD and Persistent Volume Claims</a></h6>
<div class="paragraph">
<p>When persistent storage is used to declare JBOD volumes, the naming scheme of the resulting Persistent Volume Claims is as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Where <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod <code><em>idx</em></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="log_directories_3"><a class="link" href="#log_directories_3">Log directories</a></h6>
<div class="paragraph">
<p>The JBOD volumes will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data-<em>id</em>/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod <code><em>idx</em></code>. For example <code>/var/lib/kafka/data-0/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka"><a class="link" href="#proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka">Adding volumes to JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to add volumes to a Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When adding a new volume under an <code>id</code> which was already used in the past and removed, you have to make sure that the previously used <code>PersistentVolumeClaims</code> have been deleted.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Add the new volumes to the <code>volumes</code> array.
For example, add the new volume with id <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 1
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 2
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create new topics or reassign existing partitions to the new disks.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-removing-volumes-from-jbod-storage-deployment-configuration-kafka"><a class="link" href="#proc-removing-volumes-from-jbod-storage-deployment-configuration-kafka">Removing volumes from JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to remove volumes from Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.
The JBOD storage always has to contain at least one volume.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
To avoid data loss, you have to move all partitions before removing the volumes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage with two or more volumes</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Reassign all partitions from the disks which are you going to remove.
Any data in partitions still assigned to the disks which are going to be removed might be lost.</p>
</li>
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Remove one or more volumes from the <code>volumes</code> array.
For example, remove the volumes with ids <code>1</code> and <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-broker-replicas-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">3.1.4. Kafka broker replicas</a></h4>
<div class="paragraph">
<p>A Kafka cluster can run with many brokers.
You can configure the number of brokers used for the Kafka cluster in <code>Kafka.spec.kafka.replicas</code>.
The best number of brokers for your cluster has to be determined based on your specific use case.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-broker-replicas-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-broker-replicas-deployment-configuration-kafka">Configuring the number of broker nodes</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure the number of Kafka broker nodes in a new cluster.
It only applies to new clusters with no partitions.
If your cluster already has topics defined, see
<a href="#scaling-clusters-deployment-configuration-kafka">Scaling clusters</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with no topics defined yet</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>replicas</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    replicas: 3
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>If your cluster already has topics defined, see
<a href="#scaling-clusters-deployment-configuration-kafka">Scaling clusters</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-broker-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-configuration-deployment-configuration-kafka">3.1.5. Kafka broker configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of the Kafka brokers in your Kafka cluster.
You can specify and configure most of the options listed in the "Broker Configs" section of the <a href="http://kafka.apache.org/documentation/#brokerconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a>. You cannot configure options that are related to the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Broker ID configuration</p>
</li>
<li>
<p>Configuration of log data directories</p>
</li>
<li>
<p>Inter-broker communication</p>
</li>
<li>
<p>Zookeeper connectivity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-broker-configuration-deployment-configuration-kafka"><a class="link" href="#ref-kafka-broker-configuration-deployment-configuration-kafka">Kafka broker configuration</a></h5>
<div class="paragraph">
<p>The <code>config</code> property in <code>Kafka.spec.kafka</code> contains Kafka broker configuration options as keys with values in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure all of the options in the "Broker Configs" section of the <a href="http://kafka.apache.org/documentation/#brokerconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> apart from those managed directly by Strimzi.
Specifically, you are prevented from modifying all configuration options with keys equal to or starting with one of the following strings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>advertised.</code></p>
</li>
<li>
<p><code>broker.</code></p>
</li>
<li>
<p><code>listener.</code></p>
</li>
<li>
<p><code>host.name</code></p>
</li>
<li>
<p><code>port</code></p>
</li>
<li>
<p><code>inter.broker.listener.name</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>password.</code></p>
</li>
<li>
<p><code>principal.builder.class</code></p>
</li>
<li>
<p><code>log.dir</code></p>
</li>
<li>
<p><code>zookeeper.connect</code></p>
</li>
<li>
<p><code>zookeeper.set.acl</code></p>
</li>
<li>
<p><code>authorizer.</code></p>
</li>
<li>
<p><code>super.user</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>config</code> property specifies a restricted option, it is ignored and a warning message is printed to the Cluster Operator log file.
All other supported options are passed to Kafka.</p>
</div>
<div class="listingblock">
<div class="title">An example Kafka broker configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    config:
      num.partitions: 1
      num.recovery.threads.per.data.dir: 1
      default.replication.factor: 3
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 1
      log.retention.hours: 168
      log.segment.bytes: 1073741824
      log.retention.check.interval.ms: 300000
      num.network.threads: 3
      num.io.threads: 8
      socket.send.buffer.bytes: 102400
      socket.receive.buffer.bytes: 102400
      socket.request.max.bytes: 104857600
      group.initial.rebalance.delay.ms: 0
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-brokers-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-brokers-deployment-configuration-kafka">Configuring Kafka brokers</a></h5>
<div class="paragraph">
<p>You can configure an existing Kafka broker, or create a new Kafka broker with a specified configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.kafka.config</code> property in the <code>Kafka</code> resource, enter one or more Kafka configuration settings. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    config:
      default.replication.factor: 3
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 1
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka"><a class="link" href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">3.1.6. Kafka broker listeners</a></h4>
<div class="paragraph">
<p>You can configure the listeners enabled in Kafka brokers.
The following types of listener are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plain listener on port 9092 (without encryption)</p>
</li>
<li>
<p>TLS listener on port 9093 (with encryption)</p>
</li>
<li>
<p>External listener on port 9094 for access from outside of Kubernetes</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">OAuth 2.0</div>
<p>If you are using OAuth 2.0 token based authentication, you can configure the listeners to connect to your authorization server.
For more information, see <a href="#assembly-oauth-str">Using OAuth 2.0 token based authentication</a>.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-listeners-deployment-configuration-kafka"><a class="link" href="#con-kafka-listeners-deployment-configuration-kafka">Kafka listeners</a></h5>
<div class="paragraph">
<p>You can configure Kafka broker listeners using the <code>listeners</code> property in the <code>Kafka.spec.kafka</code> resource.
The <code>listeners</code> property contains three sub-properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>plain</code></p>
</li>
<li>
<p><code>tls</code></p>
</li>
<li>
<p><code>external</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each listener will only be defined when the <code>listeners</code> object has the given property.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>listeners</code> property with all listeners enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  plain: {}
  tls: {}
  external:
    type: loadbalancer
# ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">An example of <code>listeners</code> property with only the plain listener enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  plain: {}
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-listeners-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-listeners-deployment-configuration-kafka">Configuring Kafka listeners</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>listeners</code> property in the <code>Kafka.spec.kafka</code> resource.</p>
<div class="paragraph">
<p>An example configuration of the plain (unencrypted) listener without authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      plain: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="assembly-kafka-broker-listener-authentication-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-listener-authentication-deployment-configuration-kafka">Listener authentication</a></h5>
<div class="paragraph">
<p>The listener <code>authentication</code> property is used to specify an authentication mechanism specific to that listener:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mutual TLS authentication (only on the listeners with TLS encryption)</p>
</li>
<li>
<p>SCRAM-SHA authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no <code>authentication</code> property is specified then the listener does not authenticate clients which connect through that listener.</p>
</div>
<div class="paragraph">
<p>Authentication must be configured when using the User Operator to manage <code>KafkaUsers</code>.</p>
</div>
<div class="sect5">
<h6 id="ref-kafka-listener-authentication-example-deployment-configuration-kafka"><a class="link" href="#ref-kafka-listener-authentication-example-deployment-configuration-kafka">Authentication configuration for a listener</a></h6>
<div class="paragraph">
<p>The following example shows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>plain</code> listener configured for SCRAM-SHA authentication</p>
</li>
<li>
<p>A <code>tls</code> listener with mutual TLS authentication</p>
</li>
<li>
<p>An <code>external</code> listener with mutual TLS authentication</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example showing listener authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  plain:
    authentication:
      type: scram-sha-512
  tls:
    authentication:
      type: tls
  external:
    type: loadbalancer
    tls: true
    authentication:
      type: tls
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="con-mutual-tls-authentication-deployment-configuration-kafka"><a class="link" href="#con-mutual-tls-authentication-deployment-configuration-kafka">Mutual TLS authentication</a></h6>
<div class="paragraph">
<p>Mutual TLS authentication is always used for the communication between Kafka brokers and Zookeeper pods.</p>
</div>
<div class="paragraph">
<p>Mutual authentication or two-way authentication is when both the server and the client present certificates. Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="when_to_use_mutual_tls_authentication_for_clients"><a class="link" href="#when_to_use_mutual_tls_authentication_for_clients">When to use mutual TLS authentication for clients</a></h7>
<div class="paragraph">
<p>Mutual TLS authentication is recommended for authenticating Kafka clients when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client supports authentication using mutual TLS authentication</p>
</li>
<li>
<p>It is necessary to use the TLS certificates rather than passwords</p>
</li>
<li>
<p>You can reconfigure and restart client applications periodically so that they do not use expired certificates.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="con-scram-sha-authentication-deployment-configuration-kafka"><a class="link" href="#con-scram-sha-authentication-deployment-configuration-kafka">SCRAM-SHA authentication</a></h6>
<div class="paragraph">
<p>SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and Zookeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.</p>
</div>
<div class="paragraph">
<p>The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The passwords are not sent in the clear over the communication channel.
Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.</p>
</li>
<li>
<p>The server and client each generate a new challenge for each authentication exchange.
This means that the exchange is resilient against replay attacks.</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="supported_scram_credentials"><a class="link" href="#supported_scram_credentials">Supported SCRAM credentials</a></h7>
<div class="paragraph">
<p>Strimzi supports SCRAM-SHA-512 only.
When a <code>KafkaUser.spec.authentication.type</code> is configured with <code>scram-sha-512</code> the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.</p>
</div>
</div>
<div class="sect6">
<h7 id="when_to_use_scram_sha_authentication_for_clients"><a class="link" href="#when_to_use_scram_sha_authentication_for_clients">When to use SCRAM-SHA authentication for clients</a></h7>
<div class="paragraph">
<p>SCRAM-SHA is recommended for authenticating Kafka clients when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client supports authentication using SCRAM-SHA-512</p>
</li>
<li>
<p>It is necessary to use passwords rather than the TLS certificates</p>
</li>
<li>
<p>Authentication for unencrypted communication is required</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-kafka-broker-external-listeners-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-external-listeners-deployment-configuration-kafka">External listeners</a></h5>
<div class="paragraph">
<p>Use an external listener to expose your Strimzi Kafka cluster to a client outside a Kubernetes environment.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/2019/04/17/accessing-kafka-part-1.html" target="_blank" rel="noopener">Accessing Apache Kafka in Strimzi</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="con-kafka-broker-external-listeners-addresses-deployment-configuration-kafka"><a class="link" href="#con-kafka-broker-external-listeners-addresses-deployment-configuration-kafka">Customizing advertised addresses on external listeners</a></h6>
<div class="paragraph">
<p>By default, Strimzi tries to automatically determine the hostnames and ports that your Kafka cluster advertises to its clients.
This is not sufficient in all situations, because the infrastructure on which Strimzi is running might not provide the right hostname or port through which Kafka can be accessed.
You can customize the advertised hostname and port in the <code>overrides</code> property of the external listener.
Strimzi will then automatically configure the advertised address in the Kafka brokers and add it to the broker certificates so it can be used for TLS hostname verification.
Overriding the advertised host and ports is available for all types of external listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with overrides for advertised addresses</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: route
    authentication:
      type: tls
    overrides:
      brokers:
      - broker: 0
        advertisedHost: example.hostname.0
        advertisedPort: 12340
      - broker: 1
        advertisedHost: example.hostname.1
        advertisedPort: 12341
      - broker: 2
        advertisedHost: example.hostname.2
        advertisedPort: 12342
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, you can specify the name of the bootstrap service.
This name will be added to the broker certificates and can be used for TLS hostname verification.
Adding the additional bootstrap address is available for all types of external listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with an additional bootstrap address</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: route
    authentication:
      type: tls
    overrides:
      bootstrap:
        address: example.hostname
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="assembly-kafka-broker-external-listeners-routes-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-external-listeners-routes-deployment-configuration-kafka">Route external listeners</a></h6>
<div class="paragraph">
<p>An external listener of type <code>route</code> exposes Kafka using OpenShift <code>Routes</code> and the HAProxy router.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>route</code> is only supported on OpenShift
</td>
</tr>
</table>
</div>
<div class="sect6">
<h7 id="con-kafka-broker-external-listeners-routes-deployment-configuration-kafka"><a class="link" href="#con-kafka-broker-external-listeners-routes-deployment-configuration-kafka">Exposing Kafka using OpenShift <code>Routes</code></a></h7>
<div class="paragraph">
<p>When exposing Kafka using OpenShift <code>Routes</code>  and the HAProxy router, a dedicated <code>Route</code> is created for every Kafka broker pod.
An additional <code>Route</code> is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Routes</code> to connect to Kafka on port 443.</p>
</div>
<div class="paragraph">
<p>TLS encryption is always used with <code>Routes</code>.</p>
</div>
<div class="paragraph">
<p>By default, the route hosts are automatically assigned by OpenShift.
However, you can override the assigned route hosts by specifying the requested hosts in the <code>overrides</code> property.
Strimzi will not perform any validation that the requested hosts are available; you must ensure that they are free and can be used.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>routes</code> configured with overrides for OpenShift route hosts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: route
    authentication:
      type: tls
    overrides:
      bootstrap:
        host: bootstrap.myrouter.com
      brokers:
      - broker: 0
        host: broker-0.myrouter.com
      - broker: 1
        host: broker-1.myrouter.com
      - broker: 2
        host: broker-2.myrouter.com
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using <code>Routes</code> to access Kafka, see <a href="#proc-accessing-kafka-using-routes-deployment-configuration-kafka">Accessing Kafka using OpenShift routes</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="proc-accessing-kafka-using-routes-deployment-configuration-kafka"><a class="link" href="#proc-accessing-kafka-using-routes-deployment-configuration-kafka">Accessing Kafka using OpenShift routes</a></h7>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An OpenShift cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy Kafka cluster with an external listener enabled and configured to the type <code>route</code>.</p>
<div class="paragraph">
<p>An example configuration with an external listener configured to use <code>Routes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      external:
        type: route
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Find the address of the bootstrap <code>Route</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc get routes _cluster-name_-kafka-bootstrap -o=jsonpath='{.status.ingress[0].host}{"\n"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the address together with port 443 in your Kafka client as the <em>bootstrap</em> address.</p>
</div>
</li>
<li>
<p>Extract the public certificate of the broker certification authority</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret _&lt;cluster-name&gt;_-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="assembly-kafka-broker-external-listeners-loadbalancers-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-external-listeners-loadbalancers-deployment-configuration-kafka">Loadbalancer external listeners</a></h6>
<div class="paragraph">
<p>External listeners of type <code>loadbalancer</code> expose Kafka by using <code>Loadbalancer</code> type <code>Services</code>.</p>
</div>
<div class="sect6">
<h7 id="con-kafka-broker-external-listeners-loadbalancers-deployment-configuration-kafka"><a class="link" href="#con-kafka-broker-external-listeners-loadbalancers-deployment-configuration-kafka">Exposing Kafka using loadbalancers</a></h7>
<div class="paragraph">
<p>When exposing Kafka using <code>Loadbalancer</code> type <code>Services</code>, a new loadbalancer service is created for every Kafka broker pod.
An additional loadbalancer is created to serve as a Kafka <em>bootstrap</em> address.
Loadbalancers listen to connections on port 9094.</p>
</div>
<div class="paragraph">
<p>By default, TLS encryption is enabled.
To disable it, set the <code>tls</code> field to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: loadbalancer
    authentication:
      type: tls
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using loadbalancers to access Kafka, see <a href="#proc-accessing-kafka-using-loadbalancers-deployment-configuration-kafka">Accessing Kafka using loadbalancers</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="customizing_the_dns_names_of_external_loadbalancer_listeners"><a class="link" href="#customizing_the_dns_names_of_external_loadbalancer_listeners">Customizing the DNS names of external loadbalancer listeners</a></h7>
<div class="paragraph">
<p>On <code>loadbalancer</code> listeners, you can use the <code>dnsAnnotations</code> property to add additional annotations to the loadbalancer services.
You can use these annotations to instrument DNS tooling such as <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener">External DNS</a>, which automatically assigns DNS names to the loadbalancer services.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> using <code>dnsAnnotations</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: loadbalancer
    authentication:
      type: tls
    overrides:
      bootstrap:
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-bootstrap.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      brokers:
      - broker: 0
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-0.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 1
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-1.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 2
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-2.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
# ...</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="customizing_the_loadbalancer_ip_addresses"><a class="link" href="#customizing_the_loadbalancer_ip_addresses">Customizing the loadbalancer IP addresses</a></h7>
<div class="paragraph">
<p>On <code>loadbalancer</code> listeners, you can use the <code>loadBalancerIP</code> property to request a specific IP address when creating a loadbalancer.
Use this property when you need to use a loadbalancer with a specific IP address.
The <code>loadBalancerIP</code> field is ignored if the cloud provider does not support the feature.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> with specific loadbalancer IP address requests</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: loadbalancer
    authentication:
      type: tls
    overrides:
      bootstrap:
        loadBalancerIP: 172.29.3.10
      brokers:
      - broker: 0
        loadBalancerIP: 172.29.3.1
      - broker: 1
        loadBalancerIP: 172.29.3.2
      - broker: 2
        loadBalancerIP: 172.29.3.3
# ...</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="proc-accessing-kafka-using-loadbalancers-deployment-configuration-kafka"><a class="link" href="#proc-accessing-kafka-using-loadbalancers-deployment-configuration-kafka">Accessing Kafka using loadbalancers</a></h7>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy Kafka cluster with an external listener enabled and configured to the type <code>loadbalancer</code>.</p>
<div class="paragraph">
<p>An example configuration with an external listener configured to use loadbalancers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      external:
        type: loadbalancer
        authentication:
          type: tls
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Find the hostname of the bootstrap loadbalancer.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get service <em>cluster-name</em>-kafka-external-bootstrap -o=jsonpath='{.status.loadBalancer.ingress[0].hostname}{"\n"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no hostname was found (nothing was returned by the command), use the loadbalancer IP address.</p>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get service <em>cluster-name</em>-kafka-external-bootstrap -o=jsonpath='{.status.loadBalancer.ingress[0].ip}{"\n"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the hostname or IP address together with port 9094 in your Kafka client as the <em>bootstrap</em> address.</p>
</div>
</li>
<li>
<p>Unless TLS encryption was disabled, extract the public certificate of the broker certification authority.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>cluster-name</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="assembly-kafka-broker-external-listeners-nodeports-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-external-listeners-nodeports-deployment-configuration-kafka">Node Port external listeners</a></h6>
<div class="paragraph">
<p>External listeners of type <code>nodeport</code> expose Kafka by using <code>NodePort</code> type <code>Services</code>.</p>
</div>
<div class="sect6">
<h7 id="con-kafka-broker-external-listeners-nodeports-deployment-configuration-kafka"><a class="link" href="#con-kafka-broker-external-listeners-nodeports-deployment-configuration-kafka">Exposing Kafka using node ports</a></h7>
<div class="paragraph">
<p>When exposing Kafka using <code>NodePort</code> type <code>Services</code>, Kafka clients connect directly to the nodes of Kubernetes.
You must enable access to the ports on the Kubernetes nodes for each client (for example, in firewalls or security groups).
Each Kafka broker pod is then accessible on a separate port.
Additional <code>NodePort</code> type <code>Service</code> is created to serve as a Kafka bootstrap address.</p>
</div>
<div class="paragraph">
<p>When configuring the advertised addresses for the Kafka broker pods, Strimzi uses the address of the node on which the given pod is running.
When selecting the node address, the different address types are used with the following priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ExternalDNS</p>
</li>
<li>
<p>ExternalIP</p>
</li>
<li>
<p>Hostname</p>
</li>
<li>
<p>InternalDNS</p>
</li>
<li>
<p>InternalIP</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By default, TLS encryption is enabled.
To disable it, set the <code>tls</code> field to <code>false</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS hostname verification is not currently supported when exposing Kafka clusters using node ports.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the port numbers used for the bootstrap and broker services are automatically assigned by Kubernetes.
However, you can override the assigned node ports by specifying the requested port numbers in the <code>overrides</code> property.
Strimzi does not perform any validation on the requested ports; you must ensure that they are free and available for use.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with overrides for node ports</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: nodeport
    tls: true
    authentication:
      type: tls
    overrides:
      bootstrap:
        nodePort: 32100
      brokers:
      - broker: 0
        nodePort: 32000
      - broker: 1
        nodePort: 32001
      - broker: 2
        nodePort: 32002
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using node ports to access Kafka, see <a href="#proc-accessing-kafka-using-nodeports-deployment-configuration-kafka">Accessing Kafka using node ports</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="customizing_the_dns_names_of_external_node_port_listeners"><a class="link" href="#customizing_the_dns_names_of_external_node_port_listeners">Customizing the DNS names of external node port listeners</a></h7>
<div class="paragraph">
<p>On <code>nodeport</code> listeners, you can use the <code>dnsAnnotations</code> property to add additional annotations to the nodeport services.
You can use these annotations to instrument DNS tooling such as <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener">External DNS</a>, which automatically assigns DNS names to the cluster nodes.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>nodeport</code> using <code>dnsAnnotations</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: nodeport
    tls: true
    authentication:
      type: tls
    overrides:
      bootstrap:
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-bootstrap.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      brokers:
      - broker: 0
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-0.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 1
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-1.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 2
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-2.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
# ...</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="proc-accessing-kafka-using-nodeports-deployment-configuration-kafka"><a class="link" href="#proc-accessing-kafka-using-nodeports-deployment-configuration-kafka">Accessing Kafka using node ports</a></h7>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy Kafka cluster with an external listener enabled and configured to the type <code>nodeport</code>.</p>
<div class="paragraph">
<p>An example configuration with an external listener configured to use node ports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      external:
        type: nodeport
        tls: true
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Find the port number of the bootstrap service.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get service <em>cluster-name</em>-kafka-external-bootstrap -o=jsonpath='{.spec.ports[0].nodePort}{"\n"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port should be used in the Kafka <em>bootstrap</em> address.</p>
</div>
</li>
<li>
<p>Find the address of the Kubernetes node.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get node <em>node-name</em> -o=jsonpath='{range .status.addresses[*]}{.type}{"\t"}{.address}{"\n"}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If several different addresses are returned, select the address type you want based on the following order:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ExternalDNS</p>
</li>
<li>
<p>ExternalIP</p>
</li>
<li>
<p>Hostname</p>
</li>
<li>
<p>InternalDNS</p>
</li>
<li>
<p>InternalIP</p>
<div class="paragraph">
<p>Use the address with the port found in the previous step in the Kafka <em>bootstrap</em> address.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Unless TLS encryption was disabled, extract the public certificate of the broker certification authority.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>cluster-name</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="assembly-kafka-broker-external-listeners-ingressdeployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-external-listeners-ingressdeployment-configuration-kafka">Kubernetes Ingress external listeners</a></h6>
<div class="paragraph">
<p>External listeners of type <code>ingress</code> exposes Kafka by using Kubernetes <code>Ingress</code> and the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.</p>
</div>
<div class="sect6">
<h7 id="con-kafka-broker-external-listeners-ingress-deployment-configuration-kafka"><a class="link" href="#con-kafka-broker-external-listeners-ingress-deployment-configuration-kafka">Exposing Kafka using Kubernetes <code>Ingress</code></a></h7>
<div class="paragraph">
<p>When exposing Kafka using using Kubernetes <code>Ingress</code> and the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>, a dedicated <code>Ingress</code> resource is created for every Kafka broker pod.
An additional <code>Ingress</code> resource is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Ingress</code> resources to connect to Kafka on port 443.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
External listeners using <code>Ingress</code> have been currently tested only with the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Strimzi uses the TLS passthrough feature of the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.
Make sure TLS passthrough is enabled in your <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a> deployment.
For more information about enabling TLS passthrough see <a href="https://kubernetes.github.io/ingress-nginx/user-guide/tls/#ssl-passthrough">TLS passthrough documentation</a>.
Because it is using the TLS passthrough functionality, TLS encryption cannot be disabled when exposing Kafka using <code>Ingress</code>.</p>
</div>
<div class="paragraph">
<p>The Ingress controller does not assign any hostnames automatically.
You have to specify the hostnames which should be used by the bootstrap and per-broker services in the <code>spec.kafka.listeners.external.configuration</code> section.
You also have to make sure that the hostnames resolve to the Ingress endpoints.
Strimzi will not perform any validation that the requested hosts are available and properly routed to the Ingress endpoints.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>ingress</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: ingress
    authentication:
      type: tls
    configuration:
      bootstrap:
        host: bootstrap.myingress.com
      brokers:
      - broker: 0
        host: broker-0.myingress.com
      - broker: 1
        host: broker-1.myingress.com
      - broker: 2
        host: broker-2.myingress.com
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using <code>Ingress</code> to access Kafka, see <a href="#proc-accessing-kafka-using-ingress-deployment-configuration-kafka">Accessing Kafka using ingress</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="configuring_the_ingress_class"><a class="link" href="#configuring_the_ingress_class">Configuring the <code>Ingress</code> class</a></h7>
<div class="paragraph">
<p>By default, the <code>Ingress</code> class is set to <code>nginx</code>.
You can change the <code>Ingress</code> class using the <code>class</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>ingress</code> using <code>Ingress</code> class <code>nginx-internal</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: ingress
    class: nginx-internal
    # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="customizing_the_dns_names_of_external_ingress_listeners"><a class="link" href="#customizing_the_dns_names_of_external_ingress_listeners">Customizing the DNS names of external ingress listeners</a></h7>
<div class="paragraph">
<p>On <code>ingress</code> listeners, you can use the <code>dnsAnnotations</code> property to add additional annotations to the ingress resources.
You can use these annotations to instrument DNS tooling such as <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener">External DNS</a>, which automatically assigns DNS names to the ingress resources.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>ingress</code> using <code>dnsAnnotations</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  external:
    type: ingress
    authentication:
      type: tls
    configuration:
      bootstrap:
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: bootstrap.myingress.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
        host: bootstrap.myingress.com
      brokers:
      - broker: 0
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: broker-0.myingress.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
        host: broker-0.myingress.com
      - broker: 1
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: broker-1.myingress.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
        host: broker-1.myingress.com
      - broker: 2
        dnsAnnotations:
          external-dns.alpha.kubernetes.io/hostname: broker-2.myingress.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
        host: broker-2.myingress.com
# ...</code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="proc-accessing-kafka-using-ingress-deployment-configuration-kafka"><a class="link" href="#proc-accessing-kafka-using-ingress-deployment-configuration-kafka">Accessing Kafka using ingress</a></h7>
<div class="paragraph">
<p>This procedure shows how to access Strimzi Kafka clusters from outside of Kubernetes using Ingress.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>Deployed <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a> with TLS passthrough enabled</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy Kafka cluster with an external listener enabled and configured to the type <code>ingress</code>.</p>
<div class="paragraph">
<p>An example configuration with an external listener configured to use <code>Ingress</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      external:
        type: ingress
        authentication:
          type: tls
        configuration:
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure the hosts in the <code>configuration</code> section properly resolve to the Ingress endpoints.</p>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Extract the public certificate of the broker certificate authority</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>cluster-name</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Use the extracted certificate in your Kafka client to configure the TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.
Connect with your client to the host you specified in the configuration on port 443.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-kafka-broker-listener-network-policies-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-listener-network-policies-deployment-configuration-kafka">Network policies</a></h5>
<div class="paragraph">
<p>Strimzi automatically creates a <code>NetworkPolicy</code> resource for every listener that is enabled on a Kafka broker.
By default, a <code>NetworkPolicy</code> grants access to a listener to all applications and namespaces.</p>
</div>
<div class="paragraph">
<p>If you want to restrict access to a listener at the network level to only selected applications or namespaces, use the <code>networkPolicyPeers</code> field.</p>
</div>
<div class="paragraph">
<p>Use network policies in conjunction with authentication and authorization.</p>
</div>
<div class="paragraph">
<p>Each listener can have a different <code>networkPolicyPeers</code> configuration.</p>
</div>
<div class="sect5">
<h6 id="ref-kafka-listener-network-policy-example-deployment-configuration-kafka"><a class="link" href="#ref-kafka-listener-network-policy-example-deployment-configuration-kafka">Network policy configuration for a listener</a></h6>
<div class="paragraph">
<p>The following example shows a <code>networkPolicyPeers</code> configuration for a <code>plain</code> and a <code>tls</code> listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  plain:
    authentication:
      type: scram-sha-512
    networkPolicyPeers:
      - podSelector:
          matchLabels:
            app: kafka-sasl-consumer
      - podSelector:
          matchLabels:
            app: kafka-sasl-producer
  tls:
    authentication:
      type: tls
    networkPolicyPeers:
      - namespaceSelector:
          matchLabels:
            project: myproject
      - namespaceSelector:
          matchLabels:
            project: myproject2
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only application pods matching the labels <code>app: kafka-sasl-consumer</code> and <code>app: kafka-sasl-producer</code> can connect to the <code>plain</code> listener.
The application pods must be running in the same namespace as the Kafka broker.</p>
</li>
<li>
<p>Only application pods running in namespaces matching the labels <code>project: myproject</code> and <code>project: myproject2</code> can connect to the <code>tls</code> listener.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax of the <code>networkPolicyPeers</code> field is the same as the <code>from</code> field in <code>NetworkPolicy</code> resources.
For more information about the schema, see <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io" target="_blank" rel="noopener">NetworkPolicyPeer API reference</a> and the <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Your configuration of Kubernetes must support ingress NetworkPolicies in order to use network policies in Strimzi.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="proc-restricting-access-to-listeners-using-network-policies-deployment-configuration-kafka"><a class="link" href="#proc-restricting-access-to-listeners-using-network-policies-deployment-configuration-kafka">Restricting access to Kafka listeners using <code>networkPolicyPeers</code></a></h6>
<div class="paragraph">
<p>You can restrict access to a listener to only selected applications by using the <code>networkPolicyPeers</code> field.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster with support for Ingress NetworkPolicies.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>Kafka</code> resource.</p>
</li>
<li>
<p>In the <code>networkPolicyPeers</code> field, define the application pods or namespaces that will be allowed to access the Kafka cluster.</p>
<div class="paragraph">
<p>For example, to configure a <code>tls</code> listener to allow connections only from application pods with the label <code>app</code> set to <code>kafka-client</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      tls:
        networkPolicyPeers:
          - podSelector:
              matchLabels:
                app: kafka-client
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io" target="_blank" rel="noopener">NetworkPolicyPeer API reference</a> and the <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-authentication-and-authorization-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-authentication-and-authorization-deployment-configuration-kafka">3.1.7. Authentication and Authorization</a></h4>
<div class="paragraph">
<p>Strimzi supports authentication and authorization.
Authentication can be configured independently for each <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">listener</a>.
Authorization is always configured for the whole Kafka cluster.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-authentication-deployment-configuration-kafka"><a class="link" href="#ref-kafka-authentication-deployment-configuration-kafka">Authentication</a></h5>
<div class="paragraph">
<p>Authentication is configured as part of the <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">listener configuration</a> in the <code>authentication</code> property.
The authentication mechanism is defined by the <code>type</code> field.</p>
</div>
<div class="paragraph">
<p>When the <code>authentication</code> property is missing, no authentication is enabled on a given listener.
The listener will accept all connections without authentication.</p>
</div>
<div class="paragraph">
<p>Supported authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS client authentication</p>
</li>
<li>
<p>SASL SCRAM-SHA-512</p>
</li>
<li>
<p><a href="#assembly-oauth-str">OAuth 2.0 token based authentication</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="tls_client_authentication"><a class="link" href="#tls_client_authentication">TLS client authentication</a></h6>
<div class="paragraph">
<p>TLS Client authentication is enabled by specifying the <code>type</code> as <code>tls</code>.
The TLS client authentication is supported only on the <code>tls</code> listener.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>authentication</code> with type <code>tls</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
authentication:
  type: tls
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-authentication-deployment-configuration-kafka"><a class="link" href="#proc-kafka-authentication-deployment-configuration-kafka">Configuring authentication in Kafka brokers</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.kafka.listeners</code> property in the <code>Kafka</code> resource, add the <code>authentication</code> field to the listeners for which you want to enable authentication.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      tls:
        authentication:
          type: tls
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the supported authentication mechanisms, see <a href="#ref-kafka-authentication-deployment-configuration-kafka">authentication reference</a>.</p>
</li>
<li>
<p>For more information about the schema for <code>Kafka</code>, see <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ref-kafka-authorization-deployment-configuration-kafka"><a class="link" href="#ref-kafka-authorization-deployment-configuration-kafka">Authorization</a></h5>
<div class="paragraph">
<p>You configure authorization for Kafka brokers using the <code>authorization</code> property in the <code>Kafka.spec.kafka</code> resource.
If the <code>authorization</code> property is missing, no authorization is enabled.
When enabled, authorization is applied to all enabled <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">listeners</a>.
The authorization method is defined in the <code>type</code> field; only Simple authorization is currently supported.</p>
</div>
<div class="paragraph">
<p>You can optionally designate a list of super users in the <code>superUsers</code> field.</p>
</div>
<div class="sect5">
<h6 id="simple_authorization"><a class="link" href="#simple_authorization">Simple authorization</a></h6>
<div class="paragraph">
<p>Simple authorization in Strimzi uses the <code>SimpleAclAuthorizer</code> plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka. ACLs allow you to define which users have access to which resources at a granular level.
To enable simple authorization, set the <code>type</code> field to <code>simple</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of Simple authorization</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
authorization:
  type: simple
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="super_users"><a class="link" href="#super_users">Super users</a></h6>
<div class="paragraph">
<p>Super users can access all resources in your Kafka cluster regardless of any access restrictions defined in ACLs.
To designate super users for a Kafka cluster, enter a list of user principles in the <code>superUsers</code> field.
If a user uses TLS Client Authentication, the username will be the common name from their certificate subject prefixed with <code>CN=</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of designating super users</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
authorization:
  type: simple
  superUsers:
    - CN=fred
    - sam
    - CN=edward
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>super.user</code> configuration option in the <code>config</code> property in <code>Kafka.spec.kafka</code> is ignored.
Designate super users in the <code>authorization</code> property instead.
For more information, see <a href="#ref-kafka-broker-configuration-deployment-configuration-kafka">Kafka broker configuration</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-authorization-deployment-configuration-kafka"><a class="link" href="#proc-kafka-authorization-deployment-configuration-kafka">Configuring authorization in Kafka brokers</a></h5>
<div class="paragraph">
<p>Configure authorization and designate super users for a particular Kafka broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>The Cluster Operator is running</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add or edit the <code>authorization</code> property in the <code>Kafka.spec.kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    authorization:
      type: simple
      superUsers:
        - CN=fred
        - sam
        - CN=edward
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the supported authorization methods, see <a href="#ref-kafka-authorization-deployment-configuration-kafka">authorization reference</a>.</p>
</li>
<li>
<p>For more information about the schema for <code>Kafka</code>, see <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.</p>
</li>
<li>
<p>For more information about configuring user authentication, see <a href="#ref-kafka-user-using-uo">Kafka User resource</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-replicas-deployment-configuration-kafka">3.1.8. Zookeeper replicas</a></h4>
<div class="paragraph">
<p>Zookeeper clusters or ensembles usually run with an odd number of nodes, typically three, five, or seven.</p>
</div>
<div class="paragraph">
<p>The majority of nodes must be available in order to maintain an effective quorum. If the Zookeeper cluster loses its quorum, it will stop responding to clients and the Kafka brokers will stop working. Having a stable and highly available Zookeeper cluster is crucial for Strimzi.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Three-node cluster</dt>
<dd>
<p>A three-node Zookeeper cluster requires at least two nodes to be up and running in order to maintain the quorum.
It can tolerate only one node being unavailable.</p>
</dd>
<dt class="hdlist1">Five-node cluster</dt>
<dd>
<p>A five-node Zookeeper cluster requires at least three nodes to be up and running in order to maintain the quorum.
It can tolerate two nodes being unavailable.</p>
</dd>
<dt class="hdlist1">Seven-node cluster</dt>
<dd>
<p>A seven-node Zookeeper cluster requires at least four nodes to be up and running in order to maintain the quorum.
It can tolerate three nodes being unavailable.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For development purposes, it is also possible to run Zookeeper with a single node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Having more nodes does not necessarily mean better performance, as the costs to maintain the quorum will rise with the number of nodes in the cluster.
Depending on your availability requirements, you can decide for the number of nodes to use.</p>
</div>
<div class="sect4">
<h5 id="ref-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#ref-zookeeper-replicas-deployment-configuration-kafka">Number of Zookeeper nodes</a></h5>
<div class="paragraph">
<p>The number of Zookeeper nodes can be configured using the <code>replicas</code> property in <code>Kafka.spec.zookeeper</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example showing replicas configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    replicas: 3
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#proc-configuring-zookeeper-replicas-deployment-configuration-kafka">Changing the number of Zookeeper replicas</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.zookeeper.replicas</code> property in the <code>Kafka</code> resource, enter the number of replicated Zookeeper servers.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    replicas: 3
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-node-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">3.1.9. Zookeeper configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of Apache Zookeeper nodes.
You can specify and configure most of the options listed in the <a href="http://zookeeper.apache.org/doc/r3.4.13/zookeeperAdmin.html" target="_blank" rel="noopener">Zookeeper documentation</a>.</p>
</div>
<div class="paragraph">
<p>Options which cannot be configured are those related to the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Configuration of data directories</p>
</li>
<li>
<p>Zookeeper cluster composition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="sect4">
<h5 id="ref-zookeeper-node-configuration-deployment-configuration-kafka"><a class="link" href="#ref-zookeeper-node-configuration-deployment-configuration-kafka">Zookeeper configuration</a></h5>
<div class="paragraph">
<p>Zookeeper nodes are configured using the <code>config</code> property in <code>Kafka.spec.zookeeper</code>.
This property contains the Zookeeper configuration options as keys.
The values can be described using one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can specify and configure the options listed in <a href="http://zookeeper.apache.org/doc/r3.4.13/zookeeperAdmin.html" target="_blank" rel="noopener">Zookeeper documentation</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server.</code></p>
</li>
<li>
<p><code>dataDir</code></p>
</li>
<li>
<p><code>dataLogDir</code></p>
</li>
<li>
<p><code>clientPort</code></p>
</li>
<li>
<p><code>authProvider</code></p>
</li>
<li>
<p><code>quorum.auth</code></p>
</li>
<li>
<p><code>requireClientAuthScheme</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message is printed to the Custer Operator log file.
All other options are passed to Zookeeper.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When invalid configuration is provided, the Zookeeper cluster might not start or might become unstable.
In such cases, the configuration in the <code>Kafka.spec.zookeeper.config</code> object should be fixed and the Cluster Operator will roll out the new configuration to all Zookeeper nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Selected options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>timeTick</code> with default value <code>2000</code></p>
</li>
<li>
<p><code>initLimit</code> with default value <code>5</code></p>
</li>
<li>
<p><code>syncLimit</code> with default value <code>2</code></p>
</li>
<li>
<p><code>autopurge.purgeInterval</code> with default value <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options will be automatically configured when they are not present in the <code>Kafka.spec.zookeeper.config</code> property.</p>
</div>
<div class="listingblock">
<div class="title">An example showing Zookeeper configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    config:
      autopurge.snapRetainCount: 3
      autopurge.purgeInterval: 1
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-zookeeper-nodes-deployment-configuration-kafka"><a class="link" href="#proc-configuring-zookeeper-nodes-deployment-configuration-kafka">Configuring Zookeeper</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.zookeeper.config</code> property in the <code>Kafka</code> resource, enter one or more Zookeeper configuration settings. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    config:
      autopurge.snapRetainCount: 3
      autopurge.purgeInterval: 1
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-connection-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-connection-deployment-configuration-kafka">3.1.10. Zookeeper connection</a></h4>
<div class="paragraph">
<p>Zookeeper services are secured with encryption and authentication and are not intended to be used by external applications that are not part of Strimzi.</p>
</div>
<div class="paragraph">
<p>However, if you want to use Kafka CLI tools that require a connection to Zookeeper, such as the <code>kafka-topics</code> tool, you can use a terminal inside a Kafka container and connect to the local end of the TLS tunnel to Zookeeper by using <code>localhost:2181</code> as the Zookeeper address.</p>
</div>
<div class="sect4">
<h5 id="proc-connnecting-to-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-connnecting-to-zookeeper-deployment-configuration-kafka">Connecting to Zookeeper from a terminal</a></h5>
<div class="paragraph">
<p>Open a terminal inside a Kafka container to use Kafka CLI tools that require a Zookeeper connection.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>A kafka cluster is running.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the terminal using the Kubernetes console or run the <code>exec</code> command from your CLI.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec -ti <em>my-cluster</em>-kafka-0 -- bin/kafka-topics.sh --list --zookeeper localhost:2181</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to use <code>localhost:2181</code>.</p>
</div>
<div class="paragraph">
<p>You can now run Kafka commands to Zookeeper.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-entity-operator-deployment-configuration-kafka">3.1.11. Entity Operator</a></h4>
<div class="paragraph">
<p>The Entity Operator is responsible for managing Kafka-related entities in a running Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The Entity Operator comprises the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#assembly-getting-started-topic-operator-str">Topic Operator</a> to manage Kafka topics</p>
</li>
<li>
<p><a href="#assembly-getting-started-user-operator-str">User Operator</a> to manage Kafka users</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Through <code>Kafka</code> resource configuration, the Cluster Operator can deploy the Entity Operator, including one or both operators, when deploying a Kafka cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When deployed, the Entity Operator contains the operators according to the deployment configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operators are automatically configured to manage the topics and users of the Kafka cluster.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#ref-kafka-entity-operator-deployment-configuration-kafka">Configuration</a></h5>
<div class="paragraph">
<p>The Entity Operator can be configured using the <code>entityOperator</code> property in <code>Kafka.spec</code></p>
</div>
<div class="paragraph">
<p>The <code>entityOperator</code> property supports several sub-properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tlsSidecar</code></p>
</li>
<li>
<p><code>topicOperator</code></p>
</li>
<li>
<p><code>userOperator</code></p>
</li>
<li>
<p><code>template</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>tlsSidecar</code> property can be used to configure the TLS sidecar container which is used to communicate with Zookeeper.
For more details about configuring the TLS sidecar, see <a href="#assembly-tls-sidecar-deployment-configuration-kafka">TLS sidecar</a>.</p>
</div>
<div class="paragraph">
<p>The <code>template</code> property can be used to configure details of the Entity Operator pod, such as labels, annotations, affinity, tolerations and so on.</p>
</div>
<div class="paragraph">
<p>The <code>topicOperator</code> property contains the configuration of the Topic Operator.
When this option is missing, the Entity Operator is deployed without the Topic Operator.</p>
</div>
<div class="paragraph">
<p>The <code>userOperator</code> property contains the configuration of the User Operator.
When this option is missing, the Entity Operator is deployed without the User Operator.</p>
</div>
<div class="listingblock">
<div class="title">Example of basic configuration enabling both operators</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When both <code>topicOperator</code> and <code>userOperator</code> properties are missing, the Entity Operator will be not deployed.</p>
</div>
<div class="sect5">
<h6 id="topic-operator-deployment-configuration-kafka"><a class="link" href="#topic-operator-deployment-configuration-kafka">Topic Operator</a></h6>
<div class="paragraph">
<p>Topic Operator deployment can be configured using additional options inside the <code>topicOperator</code> object.
The following options are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the topic operator watches for <code>KafkaTopics</code>.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>90</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperSessionTimeoutSeconds</code></dt>
<dd>
<p>The Zookeeper session timeout in seconds.
Default <code>20</code>.</p>
</dd>
<dt class="hdlist1"><code>topicMetadataMaxAttempts</code></dt>
<dd>
<p>The number of attempts at getting topic metadata from Kafka.
The time between each attempt is defined as an exponential back-off.
Consider increasing this value when topic creation could take more time due to the number of partitions or replicas.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the Topic Operator.
For more details about resource request and limit configuration, see <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources</a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the Topic Operator.</p>
<div class="paragraph">
<p>The Topic Operator has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example of Topic Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="user-operator-deployment-configuration-kafka"><a class="link" href="#user-operator-deployment-configuration-kafka">User Operator</a></h6>
<div class="paragraph">
<p>User Operator deployment can be configured using additional options inside the <code>userOperator</code> object.
The following options are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the topic operator watches for <code>KafkaUsers</code>.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>120</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperSessionTimeoutSeconds</code></dt>
<dd>
<p>The Zookeeper session timeout in seconds.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the User Operator.
For more details about resource request and limit configuration, see <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources</a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the User Operator.</p>
<div class="paragraph">
<p>The User Operator has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example of Topic Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    userOperator:
      watchedNamespace: my-user-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-entity-operator-deployment-configuration-kafka">Configuring Entity Operator</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>entityOperator</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
    userOperator:
      watchedNamespace: my-user-namespace
      reconciliationIntervalSeconds: 60</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">3.1.12. CPU and memory resources</a></h4>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports two types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU</p>
</li>
<li>
<p>Memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying CPU and memory resources.</p>
</div>
<div class="sect4">
<h5 id="ref-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#ref-resource-limits-and-requests-deployment-configuration-kafka">Resource limits and requests</a></h5>
<div class="paragraph">
<p>Resource limits and requests are configured using the <code>resources</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="resource_requests"><a class="link" href="#resource_requests">Resource requests</a></h6>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resources requests are specified in the <code>requests</code> property.
Resources requests currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource request configuration with all resources</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="resource_limits"><a class="link" href="#resource_limits">Resource limits</a></h6>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>Resource limits are specified in the <code>limits</code> property.
Resource limits currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="listingblock">
<div class="title">Example resource limits configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  limits:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="supported_cpu_formats"><a class="link" href="#supported_cpu_formats">Supported CPU formats</a></h6>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="supported_memory_formats"><a class="link" href="#supported_memory_formats">Supported memory formats</a></h6>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#proc-configuring-resource-limits-and-requests-deployment-configuration-kafka">Configuring resource requests and limits</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>resources</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    resources:
      requests:
        cpu: "8"
        memory: 64Gi
      limits:
        cpu: "12"
        memory: 128Gi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-ResourceRequirements-reference"><code>Resources</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-logging-deployment-configuration-kafka"><a class="link" href="#assembly-logging-deployment-configuration-kafka">3.1.13. Logging</a></h4>
<div class="paragraph">
<p>This section provides information on loggers and how to configure log levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the loggers and their levels directly (inline) or use a custom (external) config map.</p>
</div>
<div class="sect4">
<h5 id="ref-loggers-Kafka-deployment-configuration-kafka"><a class="link" href="#ref-loggers-Kafka-deployment-configuration-kafka">Kafka and Zookeeper loggers</a></h5>
<div class="paragraph">
<p>Kafka has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kafka.root.logger.level</code></p>
</li>
<li>
<p><code>log4j.logger.org.I0Itec.zkclient.ZkClient</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.zookeeper</code></p>
</li>
<li>
<p><code>log4j.logger.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.request.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.Processor</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.server.KafkaApis</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.RequestChannel$</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.controller</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.log.LogCleaner</code></p>
</li>
<li>
<p><code>log4j.logger.state.change.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.authorizer.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zookeeper has its own logger as well:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zookeeper.root.logger</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="kafka-inline-logging-deployment-configuration-kafka"><a class="link" href="#kafka-inline-logging-deployment-configuration-kafka">Specifying inline logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the loggers and logging level for the required components.</p>
<div class="paragraph">
<p>For example, the logging level here is set to INFO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    logging:
      type: inline
      loggers:
        <em>logger.name</em>: "INFO"
    # ...
  zookeeper:
    # ...
    logging:
      type: inline
      loggers:
        <em>logger.name</em>: "INFO"
    # ...
  entityOperator:
    # ...
    topicOperator:
      # ...
      logging:
        type: inline
        loggers:
          <em>logger.name</em>: "INFO"
    # ...
    # ...
    userOperator:
      # ...
      logging:
        type: inline
        loggers:
          <em>logger.name</em>: "INFO"
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</div>
<div class="paragraph">
<p>For more information about the log levels, see the <a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" target="_blank" rel="noopener">log4j manual</a>.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="kafka-external-logging-deployment-configuration-kafka"><a class="link" href="#kafka-external-logging-deployment-configuration-kafka">Specifying an external ConfigMap for logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the name of the <code>ConfigMap</code> to use for the required components. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    logging:
      type: external
      name: customConfigMap
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to place your custom ConfigMap under the <code>log4j.properties</code> or <code>log4j2.properties</code> key.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on GC, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-rack-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-rack-deployment-configuration-kafka">3.1.14. Kafka rack awareness</a></h4>
<div class="paragraph">
<p>The rack awareness feature in Strimzi helps to spread the Kafka broker pods and Kafka topic replicas across different racks.
Enabling rack awareness helps to improve availability of Kafka brokers and the topics they are hosting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
"Rack" might represent an availability zone, data center, or an actual rack in your data center.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-rack-awareness-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-rack-awareness-deployment-configuration-kafka">Configuring rack awareness in Kafka brokers</a></h5>
<div class="paragraph">
<p>Kafka rack awareness can be configured in the <code>rack</code> property of <code>Kafka.spec.kafka</code>.
The <code>rack</code> object has one mandatory field named <code>topologyKey</code>.
This key needs to match one of the labels assigned to the Kubernetes cluster nodes.
The label is used by Kubernetes when scheduling the Kafka broker pods to nodes.
If the Kubernetes cluster is running on a cloud provider platform, that label should represent the availability zone where the node is running.
Usually, the nodes are labeled with <code>failure-domain.beta.kubernetes.io/zone</code> that can be easily used as the <code>topologyKey</code> value.
This has the effect of spreading the broker pods across zones, and also setting the brokers' <code>broker.rack</code> configuration parameter inside Kafka broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Consult your Kubernetes administrator regarding the node label that represents the zone / rack into which the node is deployed.</p>
</li>
<li>
<p>Edit the <code>rack</code> property in the <code>Kafka</code> resource using the label as the topology key.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    rack:
      topologyKey: failure-domain.beta.kubernetes.io/zone
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For information about Configuring init container image for Kafka rack awareness, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-healthchecks-deployment-configuration-kafka"><a class="link" href="#assembly-healthchecks-deployment-configuration-kafka">3.1.15. Healthchecks</a></h4>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>Kubernetes supports two types of Healthcheck probes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Liveness probes</p>
</li>
<li>
<p>Readiness probes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.
Both types of probes are used in Strimzi components.</p>
</div>
<div class="paragraph">
<p>Users can configure selected options for liveness and readiness probes.</p>
</div>
<div class="sect4">
<h5 id="ref-healthchecks-deployment-configuration-kafka"><a class="link" href="#ref-healthchecks-deployment-configuration-kafka">Healthcheck configurations</a></h5>
<div class="paragraph">
<p>Liveness and readiness probes can be configured using the <code>livenessProbe</code> and <code>readinessProbe</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference"><code>Probe</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-healthchecks-deployment-configuration-kafka"><a class="link" href="#proc-configuring-healthchecks-deployment-configuration-kafka">Configuring healthchecks</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>livenessProbe</code> or <code>readinessProbe</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-metrics-deployment-configuration-kafka"><a class="link" href="#assembly-metrics-deployment-configuration-kafka">3.1.16. Prometheus metrics</a></h4>
<div class="paragraph">
<p>Strimzi supports Prometheus metrics using <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a> to convert the JMX metrics supported by Apache Kafka and Zookeeper to Prometheus metrics.
When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>For more information about configuring Prometheus and Grafana, see <a href="#assembly-metrics-setup-str">Metrics</a>.</p>
</div>
<div class="sect4">
<h5 id="ref-metrics-deployment-configuration-kafka"><a class="link" href="#ref-metrics-deployment-configuration-kafka">Metrics configuration</a></h5>
<div class="paragraph">
<p>Prometheus metrics are enabled by configuring the <code>metrics</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics will be disabled.
To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics without any further configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property might contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics with additional Prometheus JMX Exporter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics:
      lowercaseOutputName: true
      rules:
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*, topic=(.+)&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
          labels:
            topic: "$3"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-metrics-deployment-configuration-kafka"><a class="link" href="#proc-configuring-metrics-deployment-configuration-kafka">Configuring Prometheus metrics</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>metrics</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    metrics:
      lowercaseOutputName: true
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jvm-options-deployment-configuration-kafka"><a class="link" href="#assembly-jvm-options-deployment-configuration-kafka">3.1.17. JVM Options</a></h4>
<div class="paragraph">
<p>The following components of Strimzi run inside a Virtual Machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache Zookeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka Mirror Maker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JVM configuration options optimize the performance for different platforms and architectures.
Strimzi allows you to configure some of these options.</p>
</div>
<div class="sect4">
<h5 id="ref-jvm-options-deployment-configuration-kafka"><a class="link" href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></h5>
<div class="paragraph">
<p>JVM options can be configured using the <code>jvmOptions</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only a selected subset of available JVM options can be configured.
The following options are supported:</p>
</div>
<div class="paragraph">
<div class="title">-Xms and -Xmx</div>
<p><code>-Xms</code> configures the minimum initial allocation heap size when the JVM starts.
<code>-Xmx</code> configures the maximum heap size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings such as <code>-Xmx</code> and <code>-Xms</code> are those accepted by the JDK <code>java</code> binary in the corresponding image.
Accordingly, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is in contrast to the units used for <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default values used for <code>-Xms</code> and <code>-Xmx</code> depends on whether there is a <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">memory request</a> limit configured for the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a memory limit then the JVM&#8217;s minimum and maximum memory will be set to a value corresponding to the limit.</p>
</li>
<li>
<p>If there is no memory limit then the JVM&#8217;s minimum memory will be set to <code>128M</code> and the JVM&#8217;s maximum memory will not be defined.  This allows for the JVM&#8217;s memory to grow as-needed, which is ideal for single node environments in test and development.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>-Xmx</code> explicitly requires some care:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JVM&#8217;s overall memory usage will be approximately 4  the maximum heap, as configured by <code>-Xmx</code>.</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory limit, it is possible that the container will be killed should the Kubernetes node experience memory pressure (from other Pods running on it).</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory request, it is possible that the container will be scheduled to a node with insufficient memory.
In this case, the container will not start but crash (immediately if <code>-Xms</code> is set to <code>-Xmx</code>, or some later time if not).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting <code>-Xmx</code> explicitly, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the memory request and the memory limit to the same value,</p>
</li>
<li>
<p>use a memory request that is at least 4.5  the <code>-Xmx</code>,</p>
</li>
<li>
<p>consider setting <code>-Xms</code> to the same value as <code>-Xmx</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers doing lots of disk I/O (such as Kafka broker containers) will need to leave some memory available for use as operating system page cache.
On such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-Xmx</code> and <code>-Xms</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the JVM will use 2 GiB (=2,147,483,648 bytes) for its heap.
Its total memory usage will be approximately 8GiB.</p>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.
For Kafka and Zookeeper pods such allocation could cause unwanted latency.
For Kafka Connect avoiding over allocation may be the most important concern, especially in distributed mode where the effects of over-allocation will be multiplied by the number of consumers.</p>
</div>
<div class="paragraph">
<div class="title">-server</div>
<p><code>-server</code> enables the server JVM. This option can be set to true or false.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-server</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-server": true
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">-XX</div>
<p><code>-XX</code> object can be used for configuring advanced runtime options of a JVM.
The <code>-server</code> and <code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the use of the <code>-XX</code> object</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true
    "UseParNewGC": false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example configuration above will result in the following JVM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="garbage_collector_logging"><a class="link" href="#garbage_collector_logging">Garbage collector logging</a></h6>
<div class="paragraph">
<p>The <code>jvmOptions</code> section also allows you to enable and disable garbage collector (GC) logging.
GC logging is enabled by default.
To disable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example of disabling GC logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  gcLoggingEnabled: false
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-jvm-options-deployment-configuration-kafka"><a class="link" href="#proc-configuring-jvm-options-deployment-configuration-kafka">Configuring JVM options</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>jvmOptions</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jvmOptions:
      "-Xmx": "8g"
      "-Xms": "8g"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#assembly-configuring-container-images-deployment-configuration-kafka">3.1.18. Container images</a></h4>
<div class="paragraph">
<p>Strimzi allows you to configure container images which will be used for its components.
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such a case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="sect4">
<h5 id="ref-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#ref-configuring-container-images-deployment-configuration-kafka">Container image configurations</a></h5>
<div class="paragraph">
<p>Container image which should be used for given components can be specified using the <code>image</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="configuring_the_kafka_spec_kafka_image_property"><a class="link" href="#configuring_the_kafka_spec_kafka_image_property">Configuring the <code>Kafka.spec.kafka.image</code> property</a></h6>
<div class="paragraph">
<p>The <code>Kafka.spec.kafka.image</code> property functions differently from the others, because Strimzi supports multiple versions of Kafka, each requiring the own image.
The <code>STRIMZI_KAFKA_IMAGES</code> environment variable of the Cluster Operator configuration is used to provide a mapping between Kafka versions and the corresponding images.
This is used in combination with the <code>Kafka.spec.kafka.image</code> and <code>Kafka.spec.kafka.version</code> properties as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>Kafka.spec.kafka.image</code> nor <code>Kafka.spec.kafka.version</code> are given in the custom resource then the <code>version</code> will default to the  Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is given but <code>Kafka.spec.kafka.version</code> is not then the given image will be used and the <code>version</code> will be assumed to be the  Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.version</code> is given but <code>Kafka.spec.kafka.image</code> is not then image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>Both <code>Kafka.spec.kafka.version</code> and <code>Kafka.spec.kafka.image</code> are given the given image will be used, and it will be assumed to contain a Kafka broker with the given version.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is best to provide just <code>Kafka.spec.kafka.version</code> and leave the <code>Kafka.spec.kafka.image</code> property unspecified.
This reduces the chances of making a mistake in configuring the <code>Kafka</code> resource. If you need to change the images used for different versions of Kafka, it is better to configure the Cluster Operator&#8217;s <code>STRIMZI_KAFKA_IMAGES</code> environment variable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configuring_the_image_property_in_other_resources"><a class="link" href="#configuring_the_image_property_in_other_resources">Configuring the <code>image</code> property in other resources</a></h6>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka broker TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper nodes:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper node TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect with Source2image support:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_S2I_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such case, you should either copy the Strimzi images or build them from source.
In case the configured image is not compatible with Strimzi images, it might not work properly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#proc-configuring-container-images-deployment-configuration-kafka">Configuring container images</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>image</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#assembly-tls-sidecar-deployment-configuration-kafka">3.1.19. TLS sidecar</a></h4>
<div class="paragraph">
<p>A sidecar is a container that runs in a pod but serves a supporting purpose.
In Strimzi, the TLS sidecar uses TLS to encrypt and decrypt all communication between the various components and Zookeeper.
Zookeeper does not have native TLS support.</p>
</div>
<div class="paragraph">
<p>The TLS sidecar is used in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka brokers</p>
</li>
<li>
<p>Zookeeper nodes</p>
</li>
<li>
<p>Entity Operator</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#ref-tls-sidecar-deployment-configuration-kafka">TLS sidecar configuration</a></h5>
<div class="paragraph">
<p>The TLS sidecar can be configured using the <code>tlsSidecar</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The TLS sidecar supports the following additional options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>image</code></p>
</li>
<li>
<p><code>resources</code></p>
</li>
<li>
<p><code>logLevel</code></p>
</li>
<li>
<p><code>readinessProbe</code></p>
</li>
<li>
<p><code>livenessProbe</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>resources</code> property can be used to specify the <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">memory and CPU resources</a> allocated for the TLS sidecar.</p>
</div>
<div class="paragraph">
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</div>
<div class="paragraph">
<p>The <code>logLevel</code> property is used to specify the logging level.
Following logging levels are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>emerg</p>
</li>
<li>
<p>alert</p>
</li>
<li>
<p>crit</p>
</li>
<li>
<p>err</p>
</li>
<li>
<p>warning</p>
</li>
<li>
<p>notice</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>debug</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default value is <em>notice</em>.</p>
</div>
<div class="paragraph">
<p>For more information about configuring the <code>readinessProbe</code> and <code>livenessProbe</code> properties for the healthchecks, see <a href="#ref-healthchecks-deployment-configuration-kafka">Healthcheck configurations</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of TLS sidecar configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    tlsSidecar:
      image: my-org/my-image:latest
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
      logLevel: debug
      readinessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 5
      livenessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#proc-configuring-tls-sidecar-deployment-configuration-kafka">Configuring TLS sidecar</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>tlsSidecar</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    tlsSidecar:
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-scheduling-deployment-configuration-kafka"><a class="link" href="#assembly-scheduling-deployment-configuration-kafka">3.1.20. Configuring pod scheduling</a></h4>
<div id="con-scheduling-deployment-configuration-kafka" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-scheduling-based-on-pods">Scheduling pods based on other applications</a></h5>
<div class="sect5">
<h6 id="con-scheduling-based-on-other-pods-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#con-scheduling-based-on-other-pods-deployment-configuration-kafka-scheduling-based-on-pods">Avoid critical applications to share the node</a></h6>
<div class="paragraph">
<p>Pod anti-affinity can be used to ensure that critical applications are never scheduled on the same disk.
When running Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share the nodes with other workloads like databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#affinity-deployment-configuration-kafka-scheduling-based-on-pods">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-scheduling-based-on-pods">Configuring pod anti-affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-node-scheduling-deployment-configuration-kafka-node-scheduling"><a class="link" href="#assembly-node-scheduling-deployment-configuration-kafka-node-scheduling">Scheduling pods to specific nodes</a></h5>
<div class="sect5">
<h6 id="con-scheduling-to-specific-nodes-deployment-configuration-kafka-node-scheduling"><a class="link" href="#con-scheduling-to-specific-nodes-deployment-configuration-kafka-node-scheduling">Node scheduling</a></h6>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-node-scheduling"><a class="link" href="#affinity-deployment-configuration-kafka-node-scheduling">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-configuring-node-affinity-deployment-configuration-kafka-node-scheduling"><a class="link" href="#proc-configuring-node-affinity-deployment-configuration-kafka-node-scheduling">Configuring node affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-dedidcated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#assembly-dedidcated-nodes-deployment-configuration-kafka-dedicated-nodes">Using dedicated nodes</a></h5>
<div class="sect5">
<h6 id="con-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#con-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes">Dedicated nodes</a></h6>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Taints can be used to create dedicated nodes.
Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
<div class="paragraph">
<p>To schedule Kafka pods on the dedicated nodes, configure <a href="#affinity-deployment-configuration-kafka-dedicated-nodes">node affinity</a> and <a href="#tolerations-deployment-configuration-kafka-dedicated-nodes">tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#affinity-deployment-configuration-kafka-dedicated-nodes">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="tolerations-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#tolerations-deployment-configuration-kafka-dedicated-nodes">Tolerations</a></h6>
<div class="paragraph">
<p>Tolerations can be configured using the <code>tolerations</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>tolerations</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#proc-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes">Setting up dedicated nodes and scheduling pods on them</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl taint node <em>your-node</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-exporter-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">3.1.21. Kafka Exporter</a></h4>
<div class="paragraph">
<p>You can configure the <code>Kafka</code> resource to automatically deploy Kafka Exporter in your cluster.</p>
</div>
<div class="paragraph">
<p>Kafka Exporter extracts data for analysis as Prometheus metrics, primarily data relating to offsets, consumer groups, consumer lag and topics.</p>
</div>
<div class="paragraph">
<p>For information on Kafka Exporter and why it is important to monitor consumer lag for performance, see <a href="#assembly-kafka-exporter-str">Kafka Exporter</a>.</p>
</div>
<div class="sect4">
<h5 id="proc-kafka-exporter-configuring-deployment-configuration-kafka"><a class="link" href="#proc-kafka-exporter-configuring-deployment-configuration-kafka">Configuring Kafka Exporter</a></h5>
<div class="paragraph">
<p>Configure Kafka Exporter in the <code>Kafka</code> resource through <code>KafkaExporter</code> properties.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">sample Kafka YAML configuration</a> for an overview of the <code>Kafka</code> resource and its properties.</p>
</div>
<div class="paragraph">
<p>The properties relevant to the Kafka Exporter configuration are shown in this procedure.</p>
</div>
<div class="paragraph">
<p>You can configure these properties as part of a deployment or redeployment of the Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>KafkaExporter</code> properties for the <code>Kafka</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  kafkaExporter:
    image: my-org/my-image:latest <b class="conum">(1)</b>
    groupRegex: ".*" <b class="conum">(2)</b>
    topicRegex: ".*" <b class="conum">(3)</b>
    resources: <b class="conum">(4)</b>
      requests:
        cpu: 200m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 128Mi
    logging: debug <b class="conum">(5)</b>
    enableSaramaLogging: true <b class="conum">(6)</b>
    template: <b class="conum">(7)</b>
      pod:
        metadata:
          labels:
            label1: value1
        imagePullSecrets:
          - name: my-docker-credentials
        securityContext:
          runAsUser: 1000001
          fsGroup: 0
        terminationGracePeriodSeconds: 120
    readinessProbe: <b class="conum">(8)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe: <b class="conum">(9)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>ADVANCED OPTION: Container image configuration, which is <a href="#assembly-configuring-container-images-deployment-configuration-kafka">recommended only in special situations</a>.</p>
</li>
<li>
<p>A regular expression to specify the consumer groups to include in the metrics.</p>
</li>
<li>
<p>A regular expression to specify the topics to include in the metrics.</p>
</li>
<li>
<p><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources to reserve</a>.</p>
</li>
<li>
<p>Logging configuration, to log messages with a given severity (debug, info, warn, error, fatal) or above.</p>
</li>
<li>
<p>Boolean to enable Sarama logging, a Go client library used by Kafka Exporter.</p>
</li>
<li>
<p><a href="#assembly-customizing-deployments-str">Customization of deployment templates and pods</a>.</p>
</li>
<li>
<p><a href="#assembly-healthchecks-deployment-configuration-kafka">Healthcheck readiness probes</a>.</p>
</li>
<li>
<p><a href="#assembly-healthchecks-deployment-configuration-kafka">Healthcheck liveness probes</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After configuring and deploying Kafka Exporter, you can <a href="#proc-kafka-exporter-enabling-str">enable Grafana to present the Kafka Exporter dashboards</a>.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code> schema reference</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-rolling-update-kafka-deployment-configuration-kafka"><a class="link" href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">3.1.22. Performing a rolling update of a Kafka cluster</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a rolling update of an existing Kafka cluster by using a Kubernetes annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>StatefulSet</code> that controls the Kafka pods you want to manually update.</p>
<div class="paragraph">
<p>For example, if your Kafka cluster is named <em>my-cluster</em>, the corresponding <code>StatefulSet</code> is named <em>my-cluster-kafka</em>.</p>
</div>
</li>
<li>
<p>Annotate the <code>StatefulSet</code> resource in Kubernetes. For example, using <code>kubectl annotate</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate statefulset <em>cluster-name</em>-kafka strimzi.io/manual-rolling-update=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).
A rolling update of all pods within the annotated <code>StatefulSet</code> is triggered, as long as the annotation was detected by the reconciliation process.
When the rolling update of all the pods is complete, the annotation is removed from the <code>StatefulSet</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Kafka cluster, see <a href="#deploying-kafka-cluster-str">Deploying the Kafka cluster</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-rolling-update-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">3.1.23. Performing a rolling update of a Zookeeper cluster</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a rolling update of an existing Zookeeper cluster by using a Kubernetes annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Zookeeper cluster.</p>
</li>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>StatefulSet</code> that controls the Zookeeper pods you want to manually update.</p>
<div class="paragraph">
<p>For example, if your Kafka cluster is named <em>my-cluster</em>, the corresponding <code>StatefulSet</code> is named <em>my-cluster-zookeeper</em>.</p>
</div>
</li>
<li>
<p>Annotate the <code>StatefulSet</code> resource in Kubernetes. For example, using <code>kubectl annotate</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate statefulset <em>cluster-name</em>-zookeeper strimzi.io/manual-rolling-update=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).
A rolling update of all pods within the annotated <code>StatefulSet</code> is triggered, as long as the annotation was detected by the reconciliation process.
When the rolling update of all the pods is complete, the annotation is removed from the <code>StatefulSet</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Zookeeper cluster, see <a href="#deploying-kafka-cluster-str">Deploying the Kafka cluster</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scaling-clusters-deployment-configuration-kafka"><a class="link" href="#scaling-clusters-deployment-configuration-kafka">3.1.24. Scaling clusters</a></h4>
<div class="sect4">
<h5 id="con-scaling-kafka-clusters-deployment-configuration-kafka"><a class="link" href="#con-scaling-kafka-clusters-deployment-configuration-kafka">Scaling Kafka clusters</a></h5>
<div class="sect5">
<h6 id="adding_brokers_to_a_cluster"><a class="link" href="#adding_brokers_to_a_cluster">Adding brokers to a cluster</a></h6>
<div class="paragraph">
<p>The primary way of increasing throughput for a topic is to increase the number of partitions for that topic.
That works because the extra partitions allow the load of the topic to be shared between the different brokers in the cluster.
However, in situations where every broker is constrained by a particular resource (typically I/O) using more partitions will not result in increased throughput.
Instead, you need to add brokers to the cluster.</p>
</div>
<div class="paragraph">
<p>When you add an extra broker to the cluster, Kafka does not assign any partitions to it automatically.
You must decide which partitions to move from the existing brokers to the new broker.</p>
</div>
<div class="paragraph">
<p>Once the partitions have been redistributed between all the brokers, the resource utilization of each broker should be reduced.</p>
</div>
</div>
<div class="sect5">
<h6 id="removing_brokers_from_a_cluster"><a class="link" href="#removing_brokers_from_a_cluster">Removing brokers from a cluster</a></h6>
<div class="paragraph">
<p>Because Strimzi uses <code>StatefulSets</code> to manage broker pods, you cannot remove <em>any</em> pod from the cluster.
You can only remove one or more of the highest numbered pods from the cluster.
For example, in a cluster of 12 brokers the pods are named <code><em>cluster-name</em>-kafka-0</code> up to <code><em>cluster-name</em>-kafka-11</code>.
If you decide to scale down by one broker, the <code><em>cluster-name</em>-kafka-11</code> will be removed.</p>
</div>
<div class="paragraph">
<p>Before you remove a broker from a cluster, ensure that it is not assigned to any partitions.
You should also decide which of the remaining brokers will be responsible for each of the partitions on the broker being decommissioned.
Once the broker has no assigned partitions, you can scale the cluster down safely.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-partition-reassignment-deployment-configuration-kafka"><a class="link" href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a></h5>
<div class="paragraph">
<p>The Topic Operator does not currently support reassigning replicas to different brokers, so it is necessary to connect directly to broker pods to reassign replicas to brokers.</p>
</div>
<div class="paragraph">
<p>Within a broker pod, the <code>kafka-reassign-partitions.sh</code> utility allows you to reassign partitions to different brokers.</p>
</div>
<div class="paragraph">
<p>It has three different modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--generate</code></dt>
<dd>
<p>Takes a set of topics and brokers and generates a <em>reassignment JSON file</em> which will result in the partitions of those topics being assigned to those brokers.
Because this operates on whole topics, it cannot be used when you just need to reassign some of the partitions of some topics.</p>
</dd>
<dt class="hdlist1"><code>--execute</code></dt>
<dd>
<p>Takes a <em>reassignment JSON file</em> and applies it to the partitions and brokers in the cluster.
Brokers that gain partitions as a result become followers of the partition leader.
For a given partition, once the new broker has caught up and joined the ISR (in-sync replicas) the old broker will stop being a follower and will delete its replica.</p>
</dd>
<dt class="hdlist1"><code>--verify</code></dt>
<dd>
<p>Using the same <em>reassignment JSON file</em> as the <code>--execute</code> step, <code>--verify</code> checks whether all of the partitions in the file have been moved to their intended brokers.
If the reassignment is complete, --verify also removes any <a href="#con-reassignment-throttles-deployment-configuration-kafka">throttles</a> that are in effect.
Unless removed, throttles will continue to affect the cluster even after the reassignment has finished.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is only possible to have one reassignment running in a cluster at any given time, and it is not possible to cancel a running reassignment.
If you need to cancel a reassignment, wait for it to complete and then perform another reassignment to revert the effects of the first reassignment.
The <code>kafka-reassign-partitions.sh</code> will print the reassignment JSON for this reversion as part of its output.
Very large reassignments should be broken down into a number of smaller reassignments in case there is a need to stop in-progress reassignment.</p>
</div>
<div class="sect5">
<h6 id="reassignment_json_file"><a class="link" href="#reassignment_json_file">Reassignment JSON file</a></h6>
<div class="paragraph">
<p>The <em>reassignment JSON file</em> has a specific structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "version": 1,
  "partitions": [
    <em>&lt;PartitionObjects&gt;</em>
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>&lt;PartitionObjects&gt;</em> is a comma-separated list of objects like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although Kafka also supports a <code>"log_dirs"</code> property this should not be used in Strimzi.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example reassignment JSON file that assigns topic <code>topic-a</code>, partition <code>4</code> to brokers <code>2</code>, <code>4</code> and <code>7</code>, and topic <code>topic-b</code> partition <code>2</code> to brokers <code>1</code>, <code>5</code> and <code>7</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "version": 1,
  "partitions": [
    {
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7]
    },
    {
      "topic": "topic-b",
      "partition": 2,
      "replicas": [1,5,7]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Partitions not included in the JSON are not changed.</p>
</div>
</div>
<div class="sect5">
<h6 id="reassigning_partitions_between_jbod_volumes"><a class="link" href="#reassigning_partitions_between_jbod_volumes">Reassigning partitions between JBOD volumes</a></h6>
<div class="paragraph">
<p>When using JBOD storage in your Kafka cluster, you can choose to reassign the partitions between specific volumes and their log directories (each volume has a single log directory).
To reassign a partition to a specific volume, add the <code>log_dirs</code> option to <em>&lt;PartitionObjects&gt;</em> in the reassignment JSON file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ],
  "log_dirs": [ <em>&lt;AssignedLogDirs&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>log_dirs</code> object should contain the same number of log directories as the number of replicas specified in the <code>replicas</code> object.
The value should be either an absolute path to the log directory, or the <code>any</code> keyword.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7].
      "log_dirs": [ "/var/lib/kafka/data-0/kafka-log2", "/var/lib/kafka/data-0/kafka-log4", "/var/lib/kafka/data-0/kafka-log7" ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-generating-reassignment-json-files-deployment-configuration-kafka"><a class="link" href="#proc-generating-reassignment-json-files-deployment-configuration-kafka">Generating reassignment JSON files</a></h5>
<div class="paragraph">
<p>This procedure describes how to generate a reassignment JSON file that reassigns all the partitions for a given set of topics using the <code>kafka-reassign-partitions.sh</code> tool.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource</p>
</li>
<li>
<p>A set of topics to reassign the partitions of</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a JSON file named <code><em>topics.json</em></code> that lists the topics to move.
It must have the following structure:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "version": 1,
  "topics": [
    <em>&lt;TopicObjects&gt;</em>
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>&lt;TopicObjects&gt;</em> is a comma-separated list of objects like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example if you want to reassign all the partitions of <code>topic-a</code> and <code>topic-b</code>, you would need to prepare a <code><em>topics.json</em></code> file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "version": 1,
  "topics": [
    { "topic": "topic-a"},
    { "topic": "topic-b"}
  ]
}</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code><em>topics.json</em></code> file to one of the broker pods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">cat <em>topics.json</em> | kubectl exec -c kafka <em>&lt;BrokerPod&gt;</em> -i -- \
  /bin/bash -c \
  'cat &gt; /tmp/topics.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>kafka-reassign-partitions.sh`</code> command to generate the reassignment JSON.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">kubectl exec <em>&lt;BrokerPod&gt;</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --topics-to-move-json-file /tmp/topics.json \
  --broker-list <em>&lt;BrokerList&gt;</em> \
  --generate</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to move all the partitions of <code>topic-a</code> and <code>topic-b</code> to brokers <code>4</code> and <code>7</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>&lt;BrokerPod&gt;</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --topics-to-move-json-file /tmp/topics.json \
  --broker-list 4,7 \
  --generate</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="creating_reassignment_json_files_manually"><a class="link" href="#creating_reassignment_json_files_manually">Creating reassignment JSON files manually</a></h5>
<div class="paragraph">
<p>You can manually create the reassignment JSON file if you want to move specific partitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-reassignment-throttles-deployment-configuration-kafka"><a class="link" href="#con-reassignment-throttles-deployment-configuration-kafka">Reassignment throttles</a></h5>
<div class="paragraph">
<p>Partition reassignment can be a slow process because it involves transferring large amounts of data between brokers.
To avoid a detrimental impact on clients, you can throttle the reassignment process.
This might cause the reassignment to take longer to complete.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the throttle is too low then the newly assigned brokers will not be able to keep up with records being published and the reassignment will never complete.</p>
</li>
<li>
<p>If the throttle is too high then clients will be impacted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, for producers, this could manifest as higher than normal latency waiting for acknowledgement. For consumers, this could manifest as a drop in throughput caused by higher latency between polls.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-up-a-kafka-cluster-deployment-configuration-kafka"><a class="link" href="#proc-scaling-up-a-kafka-cluster-deployment-configuration-kafka">Scaling up a Kafka cluster</a></h5>
<div class="paragraph">
<p>This procedure describes how to increase the number of brokers in a Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster.</p>
</li>
<li>
<p>A <em>reassignment JSON file</em> named <code><em>reassignment.json</em></code> that describes how partitions should be reassigned to brokers in the enlarged cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add as many new brokers as you need by increasing the <code>Kafka.spec.kafka.replicas</code> configuration option.</p>
</li>
<li>
<p>Verify that the new broker pods have started.</p>
</li>
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the broker pod on which you will later execute the commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec <em>broker-pod</em> -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec my-cluster-kafka-0 -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the partition reassignment using the <code>kafka-reassign-partitions.sh</code> command line tool from the same broker pod.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are going to throttle replication you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
</li>
<li>
<p>If you need to change the throttle during reassignment you can use the same command line with a different throttled rate. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Periodically verify whether the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods. This is the same command as the previous step but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
</li>
<li>
<p>The reassignment has finished when the <code>--verify</code> command reports each of  the partitions being moved as completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.
You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-down-a-kafka-cluster-deployment-configuration-kafka"><a class="link" href="#proc-scaling-down-a-kafka-cluster-deployment-configuration-kafka">Scaling down a Kafka cluster</a></h5>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>This procedure describes how to decrease the number of brokers in a Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster.</p>
</li>
<li>
<p>A <em>reassignment JSON file</em> named <code><em>reassignment.json</em></code> describing how partitions should be reassigned to brokers in the cluster once the broker(s) in the highest numbered <code>Pod(s)</code> have been removed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the broker pod on which you will later execute the commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec <em>broker-pod</em> -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec my-cluster-kafka-0 -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the partition reassignment using the <code>kafka-reassign-partitions.sh</code> command line tool from the same broker pod.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are going to throttle replication you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
</li>
<li>
<p>If you need to change the throttle during reassignment you can use the same command line with a different throttled rate. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Periodically verify whether the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods. This is the same command as the previous step but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
</li>
<li>
<p>The reassignment has finished when the <code>--verify</code> command reports each of  the partitions being moved as completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.
You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
<li>
<p>Once all the partition reassignments have finished, the broker(s) being removed should not have responsibility for any of the partitions in the cluster.
You can verify this by checking that the broker&#8217;s data log directory does not contain any live partition logs.
If the log directory on the broker contains a directory that does not match the extended regular expression <code>[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$</code> then the broker still has live partitions and it should not be stopped.</p>
<div class="paragraph">
<p>You can check this by executing the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  /bin/bash -c \
  "ls -l /var/lib/kafka/kafka-log_&lt;N&gt;_ | grep -E '^d' | grep -vE '[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>N</em> is the number of the <code>Pod(s)</code> being deleted.</p>
</div>
<div class="paragraph">
<p>If the above command prints any output then the broker still has live partitions.
In this case, either the reassignment has not finished, or the reassignment JSON file was incorrect.</p>
</div>
</li>
<li>
<p>Once you have confirmed that the broker has no live partitions you can edit the <code>Kafka.spec.kafka.replicas</code> of your <code>Kafka</code> resource, which will scale down the <code>StatefulSet</code>, deleting the highest numbered broker <code>Pod(s)</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka"><a class="link" href="#proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka">3.1.25. Deleting Kafka nodes manually</a></h4>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>This procedure describes how to delete an existing Kafka node by using a Kubernetes annotation.
Deleting a Kafka node consists of deleting both the <code>Pod</code> on which the Kafka broker is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>For example, if the cluster is named <em>cluster-name</em>, the pods are named <em>cluster-name</em>-kafka-<em>index</em>, where <em>index</em> starts at zero and ends at the total number of replicas.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate pod <em>cluster-name</em>-kafka-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Kafka cluster, see <a href="#deploying-kafka-cluster-str">Deploying the Kafka cluster</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka">3.1.26. Deleting Zookeeper nodes manually</a></h4>
<div class="paragraph">
<p>This procedure describes how to delete an existing Zookeeper node by using a Kubernetes annotation.
Deleting a Zookeeper node consists of deleting both the <code>Pod</code> on which Zookeeper is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Zookeeper cluster.</p>
</li>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>For example, if the cluster is named <em>cluster-name</em>, the pods are named <em>cluster-name</em>-zookeeper-<em>index</em>, where <em>index</em> starts at zero and ends at the total number of replicas.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate pod <em>cluster-name</em>-zookeeper-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Zookeeper cluster, see <a href="#deploying-kafka-cluster-str">Deploying the Kafka cluster</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="assembly-maintenance-time-windows-deployment-configuration-kafka"><a class="link" href="#assembly-maintenance-time-windows-deployment-configuration-kafka">3.1.27. Maintenance time windows for rolling updates</a></h4>
<div class="paragraph">
<p>Maintenance time windows allow you to schedule certain rolling updates of your Kafka and Zookeeper clusters to start at a convenient time.</p>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-windows-overview-deployment-configuration-kafka"><a class="link" href="#con-maintenance-time-windows-overview-deployment-configuration-kafka">Maintenance time windows overview</a></h5>
<div class="paragraph">
<p>In most cases, the Cluster Operator only updates your Kafka or Zookeeper clusters in response to changes to the corresponding <code>Kafka</code> resource.
This enables you to plan when to apply changes to a <code>Kafka</code> resource to minimize the impact on Kafka client applications.</p>
</div>
<div class="paragraph">
<p>However, some updates to your Kafka and Zookeeper clusters can happen without any corresponding change to the <code>Kafka</code> resource.
For example, the Cluster Operator will need to perform a rolling restart if a CA (Certificate Authority) certificate that it manages is close to expiry.</p>
</div>
<div class="paragraph">
<p>While a rolling restart of the pods should not affect <em>availability</em> of the service (assuming correct broker and topic configurations), it could affect <em>performance</em> of the Kafka client applications.
Maintenance time windows allow you to schedule such spontaneous rolling updates of your Kafka and Zookeeper clusters to start at a convenient time.
If maintenance time windows are not configured for a cluster then it is possible that such spontaneous rolling updates will happen at an inconvenient time, such as during a predictable period of high load.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-window-definition-deployment-configuration-kafka"><a class="link" href="#con-maintenance-time-window-definition-deployment-configuration-kafka">Maintenance time window definition</a></h5>
<div class="paragraph">
<p>You configure maintenance time windows by entering an array of strings in the <code>Kafka.spec.maintenanceTimeWindows</code> property.
Each string is a <a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html" target="_blank" rel="noopener">cron expression</a> interpreted as being in UTC (Coordinated Universal Time, which for practical purposes is the same as Greenwich Mean Time).</p>
</div>
<div class="paragraph">
<p>The following example configures a single maintenance time window that starts at midnight and ends at 01:59am (UTC), on Sundays, Mondays, Tuesdays, Wednesdays, and Thursdays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
maintenanceTimeWindows:
  - "* * 0-1 ? * SUN,MON,TUE,WED,THU *"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, maintenance windows should be set in conjunction with the <code>Kafka.spec.clusterCa.renewalDays</code> and <code>Kafka.spec.clientsCa.renewalDays</code> properties of the <code>Kafka</code> resource, to ensure that the necessary CA certificate renewal can be completed in the configured maintenance time windows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi does not schedule maintenance operations exactly according to the given windows. Instead, for each reconciliation, it checks whether a maintenance window is currently "open".
This means that the start of maintenance operations within a given time window can be delayed by up to the Cluster Operator reconciliation interval.
Maintenance time windows must therefore be at least this long.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the Cluster Operator configuration, see <a href="#ref-operators-cluster-operator-configuration-deploying-co">Cluster Operator Configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-maintenance-time-windows-deployment-configuration-kafka"><a class="link" href="#proc-configuring-maintenance-time-windows-deployment-configuration-kafka">Configuring a maintenance time window</a></h5>
<div class="paragraph">
<p>You can configure a maintenance time window for rolling updates triggered by supported processes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add or edit the <code>maintenanceTimeWindows</code> property in the <code>Kafka</code> resource.
For example to allow maintenance between 0800 and 1059 and between 1400 and 1559 you would set the <code>maintenanceTimeWindows</code> as shown below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  maintenanceTimeWindows:
    - "* * 8-10 * * ?"
    - "* * 14-15 * * ?"</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Performing a rolling update of a Kafka cluster, see <a href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">Performing a rolling update of a Kafka cluster</a></p>
</li>
<li>
<p>Performing a rolling update of a Zookeeper cluster, see <a href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">Performing a rolling update of a Zookeeper cluster</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-renewing-ca-certs-manually-deployment-configuration-kafka"><a class="link" href="#proc-renewing-ca-certs-manually-deployment-configuration-kafka">3.1.28. Renewing CA certificates manually</a></h4>
<div class="paragraph">
<p>Unless the <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> and <code>Kafka.spec.clientsCa.generateCertificateAuthority</code> objects are set to <code>false</code>, the cluster and clients CA certificates will auto-renew at the start of their respective certificate renewal periods.
You can manually renew one or both of these certificates before the certificate renewal period starts, if required for security reasons.
A renewed certificate uses the same private key as the old certificate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-renew</code> annotation to the <code>Secret</code> that contains the CA certificate that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will generate a new CA certificate for the <code>Secret</code> that you annotated.
If maintenance time windows are configured, the Cluster Operator will generate the new CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Certificates and <code>Secrets</code></a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-replacing-private-keys-deployment-configuration-kafka"><a class="link" href="#proc-replacing-private-keys-deployment-configuration-kafka">3.1.29. Replacing private keys</a></h4>
<div class="paragraph">
<p>You can replace the private keys used by the cluster CA and clients CA certificates.
When a private key is replaced, the Cluster Operator generates a new CA certificate for the new private key.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-replace</code> annotation to the <code>Secret</code> that contains the private key that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Private key for</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca strimzi.io/force-replace=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca strimzi.io/force-replace=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new private key for the <code>Secret</code> that you annotated</p>
</li>
<li>
<p>Generate a new CA certificate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will generate the new private key and CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Certificates and <code>Secrets</code></a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-cluster-resources-deployment-configuration-kafka"><a class="link" href="#ref-list-of-kafka-cluster-resources-deployment-configuration-kafka">3.1.30. List of resources created as part of Kafka cluster</a></h4>
<div class="paragraph">
<p>The following resources will created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>StatefulSet which is in charge of managing the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Service needed to have DNS resolve the Kafka broker pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-bootstrap</code></dt>
<dd>
<p>Service can be used as bootstrap servers for Kafka clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap service for clients connecting from outside of the Kubernetes cluster. This resource will be created only when external listener is enabled.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Service used to route traffic from outside of the Kubernetes cluster to individual pods. This resource will be created only when external listener is enabled.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap route for clients connecting from outside of the Kubernetes cluster. This resource will be created only when external listener is enabled and set to type <code>route</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Route for traffic from outside of the Kubernetes cluster to individual pods. This resource will be created only when external listener is enabled and set to type <code>route</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-config</code></dt>
<dd>
<p>ConfigMap which contains the Kafka ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Secret with Kafka broker keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>Service account used by the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>namespace-name</em>-<em>cluster-name</em>-kafka-init</code></dt>
<dd>
<p>Cluster role binding used by the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>StatefulSet which is in charge of managing the Zookeeper node pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Service needed to have DNS resolve the Zookeeper pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-client</code></dt>
<dd>
<p>Service used by Kafka brokers to connect to Zookeeper nodes as clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-config</code></dt>
<dd>
<p>ConfigMap which contains the Zookeeper ancillary configuration and is mounted as a volume by the Zookeeper node pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Secret with Zookeeper node keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>Pod Disruption Budget configured for the Zookeeper nodes.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator</code></dt>
<dd>
<p>Deployment with Topic and User Operators. This resource will be created only if Cluster Operator deployed Entity Operator.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-topic-operator-config</code></dt>
<dd>
<p>Configmap with ancillary configuration for Topic Operators. This resource will be created only if Cluster Operator deployed Entity Operator.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-user-operator-config</code></dt>
<dd>
<p>Configmap with ancillary configuration for User Operators. This resource will be created only if Cluster Operator deployed Entity Operator.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator-certs</code></dt>
<dd>
<p>Secret with Entitiy operators keys for communication with Kafka and Zookeeper. This resource will be created only if Cluster Operator deployed Entity Operator.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator</code></dt>
<dd>
<p>Service account used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-topic-operator</code></dt>
<dd>
<p>Role binding used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-user-operator</code></dt>
<dd>
<p>Role binding used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca</code></dt>
<dd>
<p>Secret with the Cluster CA used to encrypt the cluster communication.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca-cert</code></dt>
<dd>
<p>Secret with the Cluster CA public key. This key can be used to verify the identity of the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca</code></dt>
<dd>
<p>Secret with the Clients CA used to encrypt the communication between Kafka brokers and Kafka clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca-cert</code></dt>
<dd>
<p>Secret with the Clients CA public key. This key can be used to verify the identity of the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-operator-certs</code></dt>
<dd>
<p>Secret with Cluster operators keys for communication with Kafka and Zookeeper.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource will be created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume <code><em>id</em></code> used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource is only created if persistent storage is selected for JBOD volumes when provisioning persistent volumes to store data.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Zookeeper node pod <code><em>idx</em></code>. This resource will be created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-connect-str"><a class="link" href="#assembly-deployment-configuration-kafka-connect-str">3.2. Kafka Connect cluster configuration</a></h3>
<div class="paragraph">
<p>The full schema of the <code>KafkaConnect</code> resource is described in the <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code> schema reference</a>.
All labels that are applied to the desired <code>KafkaConnect</code> resource will also be applied to the Kubernetes resources making up the Kafka Connect cluster.
This provides a convenient mechanism for resources to be labeled as required.</p>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-replicas-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-replicas-deployment-configuration-kafka-connect">3.2.1. Replicas</a></h4>
<div class="paragraph">
<p>Kafka Connect clusters can run multiple of nodes.
The number of nodes is defined in the <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources.
Running a Kafka Connect cluster with multiple nodes can provide better availability and scalability.
However, when running Kafka Connect on Kubernetes it is not absolutely necessary to run multiple nodes of Kafka Connect for high availability.
If a node where Kafka Connect is deployed to crashes, Kubernetes will automatically reschedule the Kafka Connect pod to a different node.
However, running Kafka Connect with multiple nodes can provide faster failover times, because the other nodes will be up and running already.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-replicas-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-replicas-deployment-configuration-kafka-connect">Configuring the number of nodes</a></h5>
<div class="paragraph">
<p>The number of Kafka Connect nodes is configured using the <code>replicas</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>replicas</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
metadata:
  name: my-cluster
spec:
  # ...
  replicas: 3
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect">3.2.2. Bootstrap servers</a></h4>
<div class="paragraph">
<p>A Kafka Connect cluster always works in combination with a Kafka cluster.
A Kafka cluster is specified as a list of bootstrap servers.
On Kubernetes, the list must ideally contain the Kafka cluster bootstrap service named <code><em>cluster-name</em>-kafka-bootstrap</code>, and a port of 9092 for plain traffic or 9093 for encrypted traffic.</p>
</div>
<div class="paragraph">
<p>The list of bootstrap servers is configured in the <code>bootstrapServers</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>. The servers must be defined as a comma-separated list specifying one or more Kafka brokers, or a service pointing to Kafka brokers specified as a <code><em>hostname</em>:_port_</code> pairs.</p>
</div>
<div class="paragraph">
<p>When using Kafka Connect with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the cluster.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect">Configuring bootstrap servers</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>bootstrapServers</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  bootstrapServers: my-cluster-kafka-bootstrap:9092
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-tls-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect">3.2.3. Connecting to Kafka brokers using TLS</a></h4>
<div class="paragraph">
<p>By default, Kafka Connect tries to connect to Kafka brokers using a plain text connection.
If you prefer to use TLS, additional configuration is required.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-connect-tls-deployment-configuration-kafka-connect"><a class="link" href="#ref-kafka-connect-tls-deployment-configuration-kafka-connect">TLS support in Kafka Connect</a></h5>
<div class="paragraph">
<p>TLS support is configured in the <code>tls</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
The <code>tls</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-secret
        certificate: ca.crt
      - secretName: my-other-secret
        certificate: certificate.crt
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple certificates are stored in the same secret, it can be listed multiple times.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates from the same secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
metadata:
  name: my-cluster
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-secret
        certificate: ca.crt
      - secretName: my-secret
        certificate: ca2.crt
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-tls-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-tls-deployment-configuration-kafka-connect">Configuring TLS in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> for the certificate used for TLS Server Authentication, and the key under which the certificate is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the TLS certificate used in authentication in a file and create a <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The secrets created by the Cluster Operator for Kafka cluster may be used directly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-file.crt</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>tls</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-authentication-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-authentication-deployment-configuration-kafka-connect">3.2.4. Connecting to Kafka brokers with Authentication</a></h4>
<div class="paragraph">
<p>By default, Kafka Connect will try to connect to Kafka brokers without authentication.
Authentication is enabled through the <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-authenticationdeployment-configuration-kafka-connect"><a class="link" href="#con-kafka-connect-authenticationdeployment-configuration-kafka-connect">Authentication support in Kafka Connect</a></h5>
<div class="paragraph">
<p>Authentication is configured through the <code>authentication</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
The <code>authentication</code> property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.
The supported authentication types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS client authentication</p>
</li>
<li>
<p>SASL-based authentication using the SCRAM-SHA-512 mechanism</p>
</li>
<li>
<p>SASL-based authentication using the PLAIN mechanism</p>
</li>
<li>
<p><a href="#assembly-oauth-str">OAuth 2.0 token based authentication</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="tls_client_authentication_2"><a class="link" href="#tls_client_authentication_2">TLS Client Authentication</a></h6>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> property to the value <code>tls</code>.
TLS client authentication uses a TLS certificate to authenticate.
The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from a Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS client authentication can be used only with TLS connections.
For more details about TLS configuration in Kafka Connect see <a href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect">Connecting to Kafka brokers using TLS</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example TLS client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: public.crt
      key: private.key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sasl_based_scram_sha_512_authentication"><a class="link" href="#sasl_based_scram_sha_512_authentication">SASL based SCRAM-SHA-512 authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based SCRAM-SHA-512 client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: my-connect-user
    passwordSecret:
      secretName: my-connect-user
      password: my-connect-password-key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sasl_based_plain_authentication"><a class="link" href="#sasl_based_plain_authentication">SASL based PLAIN authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Connect to use SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name of such a <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example showing SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: plain
    username: my-connect-user
    passwordSecret:
      secretName: my-connect-user
      password: my-connect-password-key
  # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-authentication-tls-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-authentication-tls-deployment-configuration-kafka-connect">Configuring TLS client authentication in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the public and private keys used for TLS Client Authentication, and the keys under which they are stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the keys used for authentication in a file and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-public.crt</em> --from-file=<em>my-private.key</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  authentication:
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: my-public.crt
      key: my-private.key
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-authentication-scram-sha-512-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-authentication-scram-sha-512-deployment-configuration-kafka-connect">Configuring SCRAM-SHA-512 authentication in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>Username of the user which should be used for authentication</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the password used for authentication and the key under which the password is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare a file with the password used in authentication and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">echo -n '<em>&lt;password&gt;</em>' &gt; <em>&lt;my-password.txt&gt;</em>
kubectl create secret generic <em>&lt;my-secret&gt;</em> --from-file=<em>&lt;my-password.txt&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: _&lt;my-username&gt;_
    passwordSecret:
      secretName: _&lt;my-secret&gt;_
      password: _&lt;my-password.txt&gt;_
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>On Kubernetes this can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-configuration-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-configuration-deployment-configuration-kafka-connect">3.2.5. Kafka Connect configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of Apache Kafka Connect nodes by editing certain options listed in <a href="http://kafka.apache.org/20/documentation.html#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener / REST interface configuration</p>
</li>
<li>
<p>Plugin path configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-connect-configuration-deployment-configuration-kafka-connect"><a class="link" href="#ref-kafka-connect-configuration-deployment-configuration-kafka-connect">Kafka Connect configuration</a></h5>
<div class="paragraph">
<p>Kafka Connect is configured using the <code>config</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
This property contains the Kafka Connect configuration options as keys.
The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/20/documentation.html#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> with the exception of those options that are managed directly by Strimzi.
Specifically, configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>plugin.path</code></p>
</li>
<li>
<p><code>rest.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Custer Operator log file.
All other options are passed to Kafka Connect.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Connect cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Connect nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group.id</code> with default value <code>connect-cluster</code></p>
</li>
<li>
<p><code>offset.storage.topic</code> with default value <code>connect-cluster-offsets</code></p>
</li>
<li>
<p><code>config.storage.topic</code> with default value <code>connect-cluster-configs</code></p>
</li>
<li>
<p><code>status.storage.topic</code> with default value <code>connect-cluster-status</code></p>
</li>
<li>
<p><code>key.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
<li>
<p><code>value.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured in case they are not present in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-multiple-instances-deployment-configuration-kafka-connect"><a class="link" href="#con-kafka-connect-multiple-instances-deployment-configuration-kafka-connect">Kafka Connect configuration for multiple instances</a></h5>
<div class="paragraph">
<p>If you are running multiple instances of Kafka Connect, pay attention to the default configuration of the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
  group.id: connect-cluster <b class="conum">(1)</b>
  offset.storage.topic: connect-cluster-offsets <b class="conum">(2)</b>
  config.storage.topic: connect-cluster-configs <b class="conum">(3)</b>
  status.storage.topic: connect-cluster-status  <b class="conum">(4)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Kafka Connect cluster group the instance belongs to.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Values for the three topics must be the same for all Kafka Connect instances with the same <code>group.id</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless you change the default settings, each Kafka Connect instance connecting to the same Kafka cluster is deployed with the same values.
What happens, in effect, is all instances are coupled to run in a cluster and use the same topics.</p>
</div>
<div class="paragraph">
<p>If multiple Kafka Connect clusters try to use the same topics, Kafka Connect will not work as expected and generate errors.</p>
</div>
<div class="paragraph">
<p>If you wish to run multiple Kafka Connect instances, change the values of these properties for each instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-kafka-connect-deployment-configuration-kafka-connect">Configuring Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>config</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-resource-limits-and-requests-deployment-configuration-kafka-connect"><a class="link" href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect">3.2.6. CPU and memory resources</a></h4>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports two types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU</p>
</li>
<li>
<p>Memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying CPU and memory resources.</p>
</div>
<div class="sect4">
<h5 id="ref-resource-limits-and-requests-deployment-configuration-kafka-connect"><a class="link" href="#ref-resource-limits-and-requests-deployment-configuration-kafka-connect">Resource limits and requests</a></h5>
<div class="paragraph">
<p>Resource limits and requests are configured using the <code>resources</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="resource_requests_2"><a class="link" href="#resource_requests_2">Resource requests</a></h6>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resources requests are specified in the <code>requests</code> property.
Resources requests currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource request configuration with all resources</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="resource_limits_2"><a class="link" href="#resource_limits_2">Resource limits</a></h6>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>Resource limits are specified in the <code>limits</code> property.
Resource limits currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="listingblock">
<div class="title">Example resource limits configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  limits:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="supported_cpu_formats_2"><a class="link" href="#supported_cpu_formats_2">Supported CPU formats</a></h6>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="supported_memory_formats_2"><a class="link" href="#supported_memory_formats_2">Supported memory formats</a></h6>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-connect">Configuring resource requests and limits</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>resources</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    resources:
      requests:
        cpu: "8"
        memory: 64Gi
      limits:
        cpu: "12"
        memory: 128Gi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-ResourceRequirements-reference"><code>Resources</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-logging-deployment-configuration-kafka-connect"><a class="link" href="#assembly-logging-deployment-configuration-kafka-connect">3.2.7. Logging</a></h4>
<div class="paragraph">
<p>This section provides information on loggers and how to configure log levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the loggers and their levels directly (inline) or use a custom (external) config map.</p>
</div>
<div class="sect4">
<h5 id="ref-loggers-KafkaConnect-deployment-configuration-kafka-connect"><a class="link" href="#ref-loggers-KafkaConnect-deployment-configuration-kafka-connect">Kafka Connect loggers</a></h5>
<div class="paragraph">
<p>Kafka Connect has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connect.root.logger.level</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.zookeeper</code></p>
</li>
<li>
<p><code>log4j.logger.org.I0Itec.zkclient</code></p>
</li>
<li>
<p><code>log4j.logger.org.reflections</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="kafka-inline-logging-deployment-configuration-kafka-connect"><a class="link" href="#kafka-inline-logging-deployment-configuration-kafka-connect">Specifying inline logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the loggers and logging level for the required components.</p>
<div class="paragraph">
<p>For example, the logging level here is set to INFO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
spec:
  # ...
  logging:
    type: inline
    loggers:
      <em>logger.name</em>: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</div>
<div class="paragraph">
<p>For more information about the log levels, see the <a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" target="_blank" rel="noopener">log4j manual</a>.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="kafka-external-logging-deployment-configuration-kafka-connect"><a class="link" href="#kafka-external-logging-deployment-configuration-kafka-connect">Specifying an external ConfigMap for logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the name of the <code>ConfigMap</code> to use for the required components. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to place your custom ConfigMap under the <code>log4j.properties</code> or <code>log4j2.properties</code> key.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on GC, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-healthchecks-deployment-configuration-kafka-connect"><a class="link" href="#assembly-healthchecks-deployment-configuration-kafka-connect">3.2.8. Healthchecks</a></h4>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>Kubernetes supports two types of Healthcheck probes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Liveness probes</p>
</li>
<li>
<p>Readiness probes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.
Both types of probes are used in Strimzi components.</p>
</div>
<div class="paragraph">
<p>Users can configure selected options for liveness and readiness probes.</p>
</div>
<div class="sect4">
<h5 id="ref-healthchecks-deployment-configuration-kafka-connect"><a class="link" href="#ref-healthchecks-deployment-configuration-kafka-connect">Healthcheck configurations</a></h5>
<div class="paragraph">
<p>Liveness and readiness probes can be configured using the <code>livenessProbe</code> and <code>readinessProbe</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference"><code>Probe</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-healthchecks-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-healthchecks-deployment-configuration-kafka-connect">Configuring healthchecks</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>livenessProbe</code> or <code>readinessProbe</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-metrics-deployment-configuration-kafka-connect"><a class="link" href="#assembly-metrics-deployment-configuration-kafka-connect">3.2.9. Prometheus metrics</a></h4>
<div class="paragraph">
<p>Strimzi supports Prometheus metrics using <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a> to convert the JMX metrics supported by Apache Kafka and Zookeeper to Prometheus metrics.
When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>For more information about configuring Prometheus and Grafana, see <a href="#assembly-metrics-setup-str">Metrics</a>.</p>
</div>
<div class="sect4">
<h5 id="ref-metrics-deployment-configuration-kafka-connect"><a class="link" href="#ref-metrics-deployment-configuration-kafka-connect">Metrics configuration</a></h5>
<div class="paragraph">
<p>Prometheus metrics are enabled by configuring the <code>metrics</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics will be disabled.
To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics without any further configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property might contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics with additional Prometheus JMX Exporter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics:
      lowercaseOutputName: true
      rules:
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*, topic=(.+)&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
          labels:
            topic: "$3"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-metrics-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-metrics-deployment-configuration-kafka-connect">Configuring Prometheus metrics</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>metrics</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    metrics:
      lowercaseOutputName: true
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jvm-options-deployment-configuration-kafka-connect"><a class="link" href="#assembly-jvm-options-deployment-configuration-kafka-connect">3.2.10. JVM Options</a></h4>
<div class="paragraph">
<p>The following components of Strimzi run inside a Virtual Machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache Zookeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka Mirror Maker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JVM configuration options optimize the performance for different platforms and architectures.
Strimzi allows you to configure some of these options.</p>
</div>
<div class="sect4">
<h5 id="ref-jvm-options-deployment-configuration-kafka-connect"><a class="link" href="#ref-jvm-options-deployment-configuration-kafka-connect">JVM configuration</a></h5>
<div class="paragraph">
<p>JVM options can be configured using the <code>jvmOptions</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only a selected subset of available JVM options can be configured.
The following options are supported:</p>
</div>
<div class="paragraph">
<div class="title">-Xms and -Xmx</div>
<p><code>-Xms</code> configures the minimum initial allocation heap size when the JVM starts.
<code>-Xmx</code> configures the maximum heap size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings such as <code>-Xmx</code> and <code>-Xms</code> are those accepted by the JDK <code>java</code> binary in the corresponding image.
Accordingly, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is in contrast to the units used for <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default values used for <code>-Xms</code> and <code>-Xmx</code> depends on whether there is a <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect">memory request</a> limit configured for the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a memory limit then the JVM&#8217;s minimum and maximum memory will be set to a value corresponding to the limit.</p>
</li>
<li>
<p>If there is no memory limit then the JVM&#8217;s minimum memory will be set to <code>128M</code> and the JVM&#8217;s maximum memory will not be defined.  This allows for the JVM&#8217;s memory to grow as-needed, which is ideal for single node environments in test and development.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>-Xmx</code> explicitly requires some care:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JVM&#8217;s overall memory usage will be approximately 4  the maximum heap, as configured by <code>-Xmx</code>.</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory limit, it is possible that the container will be killed should the Kubernetes node experience memory pressure (from other Pods running on it).</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory request, it is possible that the container will be scheduled to a node with insufficient memory.
In this case, the container will not start but crash (immediately if <code>-Xms</code> is set to <code>-Xmx</code>, or some later time if not).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting <code>-Xmx</code> explicitly, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the memory request and the memory limit to the same value,</p>
</li>
<li>
<p>use a memory request that is at least 4.5  the <code>-Xmx</code>,</p>
</li>
<li>
<p>consider setting <code>-Xms</code> to the same value as <code>-Xmx</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers doing lots of disk I/O (such as Kafka broker containers) will need to leave some memory available for use as operating system page cache.
On such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-Xmx</code> and <code>-Xms</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the JVM will use 2 GiB (=2,147,483,648 bytes) for its heap.
Its total memory usage will be approximately 8GiB.</p>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.
For Kafka and Zookeeper pods such allocation could cause unwanted latency.
For Kafka Connect avoiding over allocation may be the most important concern, especially in distributed mode where the effects of over-allocation will be multiplied by the number of consumers.</p>
</div>
<div class="paragraph">
<div class="title">-server</div>
<p><code>-server</code> enables the server JVM. This option can be set to true or false.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-server</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-server": true
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">-XX</div>
<p><code>-XX</code> object can be used for configuring advanced runtime options of a JVM.
The <code>-server</code> and <code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the use of the <code>-XX</code> object</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true
    "UseParNewGC": false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example configuration above will result in the following JVM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="garbage_collector_logging_2"><a class="link" href="#garbage_collector_logging_2">Garbage collector logging</a></h6>
<div class="paragraph">
<p>The <code>jvmOptions</code> section also allows you to enable and disable garbage collector (GC) logging.
GC logging is enabled by default.
To disable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example of disabling GC logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  gcLoggingEnabled: false
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-jvm-options-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-jvm-options-deployment-configuration-kafka-connect">Configuring JVM options</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>jvmOptions</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jvmOptions:
      "-Xmx": "8g"
      "-Xms": "8g"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-container-images-deployment-configuration-kafka-connect"><a class="link" href="#assembly-configuring-container-images-deployment-configuration-kafka-connect">3.2.11. Container images</a></h4>
<div class="paragraph">
<p>Strimzi allows you to configure container images which will be used for its components.
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such a case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="sect4">
<h5 id="ref-configuring-container-images-deployment-configuration-kafka-connect"><a class="link" href="#ref-configuring-container-images-deployment-configuration-kafka-connect">Container image configurations</a></h5>
<div class="paragraph">
<p>Container image which should be used for given components can be specified using the <code>image</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="configuring_the_kafka_spec_kafka_image_property_2"><a class="link" href="#configuring_the_kafka_spec_kafka_image_property_2">Configuring the <code>Kafka.spec.kafka.image</code> property</a></h6>
<div class="paragraph">
<p>The <code>Kafka.spec.kafka.image</code> property functions differently from the others, because Strimzi supports multiple versions of Kafka, each requiring the own image.
The <code>STRIMZI_KAFKA_IMAGES</code> environment variable of the Cluster Operator configuration is used to provide a mapping between Kafka versions and the corresponding images.
This is used in combination with the <code>Kafka.spec.kafka.image</code> and <code>Kafka.spec.kafka.version</code> properties as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>Kafka.spec.kafka.image</code> nor <code>Kafka.spec.kafka.version</code> are given in the custom resource then the <code>version</code> will default to the  Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is given but <code>Kafka.spec.kafka.version</code> is not then the given image will be used and the <code>version</code> will be assumed to be the  Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.version</code> is given but <code>Kafka.spec.kafka.image</code> is not then image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>Both <code>Kafka.spec.kafka.version</code> and <code>Kafka.spec.kafka.image</code> are given the given image will be used, and it will be assumed to contain a Kafka broker with the given version.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is best to provide just <code>Kafka.spec.kafka.version</code> and leave the <code>Kafka.spec.kafka.image</code> property unspecified.
This reduces the chances of making a mistake in configuring the <code>Kafka</code> resource. If you need to change the images used for different versions of Kafka, it is better to configure the Cluster Operator&#8217;s <code>STRIMZI_KAFKA_IMAGES</code> environment variable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configuring_the_image_property_in_other_resources_2"><a class="link" href="#configuring_the_image_property_in_other_resources_2">Configuring the <code>image</code> property in other resources</a></h6>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka broker TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper nodes:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper node TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect with Source2image support:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_S2I_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such case, you should either copy the Strimzi images or build them from source.
In case the configured image is not compatible with Strimzi images, it might not work properly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-container-images-deployment-configuration-kafka-connect"><a class="link" href="#proc-configuring-container-images-deployment-configuration-kafka-connect">Configuring container images</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>image</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-scheduling-deployment-configuration-kafka-connect"><a class="link" href="#assembly-scheduling-deployment-configuration-kafka-connect">3.2.12. Configuring pod scheduling</a></h4>
<div id="con-scheduling-deployment-configuration-kafka-connect" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-connect-scheduling-based-on-pods"><a class="link" href="#assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-connect-scheduling-based-on-pods">Scheduling pods based on other applications</a></h5>
<div class="sect5">
<h6 id="con-scheduling-based-on-other-pods-deployment-configuration-kafka-connect-scheduling-based-on-pods"><a class="link" href="#con-scheduling-based-on-other-pods-deployment-configuration-kafka-connect-scheduling-based-on-pods">Avoid critical applications to share the node</a></h6>
<div class="paragraph">
<p>Pod anti-affinity can be used to ensure that critical applications are never scheduled on the same disk.
When running Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share the nodes with other workloads like databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-scheduling-based-on-pods"><a class="link" href="#affinity-deployment-configuration-kafka-connect-scheduling-based-on-pods">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-connect-scheduling-based-on-pods"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-connect-scheduling-based-on-pods">Configuring pod anti-affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-node-scheduling-deployment-configuration-kafka-connect-node-scheduling"><a class="link" href="#assembly-node-scheduling-deployment-configuration-kafka-connect-node-scheduling">Scheduling pods to specific nodes</a></h5>
<div class="sect5">
<h6 id="con-scheduling-to-specific-nodes-deployment-configuration-kafka-connect-node-scheduling"><a class="link" href="#con-scheduling-to-specific-nodes-deployment-configuration-kafka-connect-node-scheduling">Node scheduling</a></h6>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-node-scheduling"><a class="link" href="#affinity-deployment-configuration-kafka-connect-node-scheduling">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-configuring-node-affinity-deployment-configuration-kafka-connect-node-scheduling"><a class="link" href="#proc-configuring-node-affinity-deployment-configuration-kafka-connect-node-scheduling">Configuring node affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-dedidcated-nodes-deployment-configuration-kafka-connect-dedicated-nodes"><a class="link" href="#assembly-dedidcated-nodes-deployment-configuration-kafka-connect-dedicated-nodes">Using dedicated nodes</a></h5>
<div class="sect5">
<h6 id="con-dedicated-nodes-deployment-configuration-kafka-connect-dedicated-nodes"><a class="link" href="#con-dedicated-nodes-deployment-configuration-kafka-connect-dedicated-nodes">Dedicated nodes</a></h6>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Taints can be used to create dedicated nodes.
Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
<div class="paragraph">
<p>To schedule Kafka pods on the dedicated nodes, configure <a href="#affinity-deployment-configuration-kafka-connect-dedicated-nodes">node affinity</a> and <a href="#tolerations-deployment-configuration-kafka-connect-dedicated-nodes">tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-dedicated-nodes"><a class="link" href="#affinity-deployment-configuration-kafka-connect-dedicated-nodes">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="tolerations-deployment-configuration-kafka-connect-dedicated-nodes"><a class="link" href="#tolerations-deployment-configuration-kafka-connect-dedicated-nodes">Tolerations</a></h6>
<div class="paragraph">
<p>Tolerations can be configured using the <code>tolerations</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>tolerations</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-dedicated-nodes-deployment-configuration-kafka-connect-dedicated-nodes"><a class="link" href="#proc-dedicated-nodes-deployment-configuration-kafka-connect-dedicated-nodes">Setting up dedicated nodes and scheduling pods on them</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl taint node <em>your-node</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect"><a class="link" href="#assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect">3.2.13. Using external configuration and secrets</a></h4>
<div class="paragraph">
<p>Kafka Connect connectors are configured using an HTTP REST interface.
The connector configuration is passed to Kafka Connect as part of an HTTP request and stored within Kafka itself.</p>
</div>
<div class="paragraph">
<p>Some parts of the configuration of a Kafka Connect connector can be externalized using ConfigMaps or Secrets.
You can then reference the configuration values in HTTP REST commands (this keeps the configuration separate and more secure, if needed).
This method applies especially to confidential data, such as usernames, passwords, or certificates.</p>
</div>
<div class="paragraph">
<p>ConfigMaps and Secrets are standard Kubernetes resources used for storing of configurations and confidential data.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-external-configuration-deployment-configuration-kafka-connect"><a class="link" href="#con-kafka-connect-external-configuration-deployment-configuration-kafka-connect">Storing connector configurations externally</a></h5>
<div class="paragraph">
<p>You can mount ConfigMaps or Secrets into a Kafka Connect pod as volumes or environment variables.
Volumes and environment variables are configured in the <code>externalConfiguration</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.</p>
</div>
<div class="sect5">
<h6 id="external_configuration_as_environment_variables"><a class="link" href="#external_configuration_as_environment_variables">External configuration as environment variables</a></h6>
<div class="paragraph">
<p>The <code>env</code> property is used to specify one or more environment variables.
These variables can contain a value from either a ConfigMap or a Secret.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The names of user-defined environment variables cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mount a value from a Secret to an environment variable, use the <code>valueFrom</code> property and the <code>secretKeyRef</code> as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example of an environment variable set to a value from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          secretKeyRef:
            name: my-secret
            key: my-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>A common use case for mounting Secrets to environment variables is when your connector needs to communicate with Amazon AWS and needs to read the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with credentials.</p>
</div>
<div class="paragraph">
<p>To mount a value from a ConfigMap to an environment variable, use <code>configMapKeyRef</code> in the <code>valueFrom</code> property as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example of an environment variable set to a value from a ConfigMap</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          configMapKeyRef:
            name: my-config-map
            key: my-key</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="external_configuration_as_volumes"><a class="link" href="#external_configuration_as_volumes">External configuration as volumes</a></h6>
<div class="paragraph">
<p>You can also mount ConfigMaps or Secrets to a Kafka Connect pod as volumes.
Using volumes instead of environment variables is useful in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mounting truststores or keystores with TLS certificates</p>
</li>
<li>
<p>Mounting a properties file that is used to configure Kafka Connect connectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <code>volumes</code> property of the <code>externalConfiguration</code> resource, list the ConfigMaps or Secrets that will be mounted as volumes.
Each volume must specify a name in the <code>name</code> property and a reference to ConfigMap or Secret.</p>
</div>
<div class="listingblock">
<div class="title">Example of volumes with external configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    volumes:
      - name: connector1
        configMap:
          name: connector1-configuration
      - name: connector1-certificates
        secret:
          secretName: connector1-certificates</code></pre>
</div>
</div>
<div class="paragraph">
<p>The volumes will be mounted inside the Kafka Connect containers in the path <code>/opt/kafka/external-configuration/<em>&lt;volume-name&gt;</em></code>.
For example, the files from a volume named <code>connector1</code> would appear in the directory <code>/opt/kafka/external-configuration/connector1</code>.</p>
</div>
<div class="paragraph">
<p>The <code>FileConfigProvider</code> has to be used to read the values from the mounted properties files in connector configurations.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-connect-mounting-secrets-as-environment-variables-deployment-configuration-kafka-connect"><a class="link" href="#proc-kafka-connect-mounting-secrets-as-environment-variables-deployment-configuration-kafka-connect">Mounting Secrets as environment variables</a></h5>
<div class="paragraph">
<p>You can create a Kubernetes Secret and mount it to Kafka Connect as an environment variable.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a secret containing the information that will be mounted as an environment variable.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: aws-creds
type: Opaque
data:
  awsAccessKey: QUtJQVhYWFhYWFhYWFhYWFg=
  awsSecretAccessKey: Ylhsd1lYTnpkMjl5WkE=</code></pre>
</div>
</div>
</li>
<li>
<p>Create or edit the Kafka Connect resource.
Configure the <code>externalConfiguration</code> section of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> custom resource to reference the secret.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the changes to your Kafka Connect deployment.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The environment variables are now available for use when developing your connectors.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about external configuration in Kafka Connect, see <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-connect-mounting-volumes-deployment-configuration-kafka-connect"><a class="link" href="#proc-kafka-connect-mounting-volumes-deployment-configuration-kafka-connect">Mounting Secrets as volumes</a></h5>
<div class="paragraph">
<p>You can create a Kubernetes Secret, mount it as a volume to Kafka Connect, and then use it to configure a Kafka Connect connector.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a secret containing a properties file that defines the configuration options for your connector configuration.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData:
  connector.properties: |-
    dbUsername: my-user
    dbPassword: my-password</code></pre>
</div>
</div>
</li>
<li>
<p>Create or edit the Kafka Connect resource.
Configure the <code>FileConfigProvider</code> in the <code>config</code> section and the <code>externalConfiguration</code> section of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> custom resource to reference the secret.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    config.providers: file
    config.providers.file.class: org.apache.kafka.common.config.provider.FileConfigProvider
  #...
  externalConfiguration:
    volumes:
      - name: connector-config
        secret:
          secretName: mysecret</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the changes to your Kafka Connect deployment.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Use the values from the mounted properties file in your JSON payload with connector configuration.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
   "name":"my-connector",
   "config":{
      "connector.class":"MyDbConnector",
      "tasks.max":"3",
      "database": "my-postgresql:5432"
      "username":"${file:/opt/kafka/external-configuration/connector-config/connector.properties:dbUsername}",
      "password":"${file:/opt/kafka/external-configuration/connector-config/connector.properties:dbPassword}",
      # ...
   }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about external configuration in Kafka Connect, see <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-connect-resources-deployment-configuration-kafka-connect"><a class="link" href="#ref-list-of-kafka-connect-resources-deployment-configuration-kafka-connect">3.2.14. List of resources created as part of Kafka Connect cluster</a></h4>
<div class="paragraph">
<p>The following resources will created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Connect worker node pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-api</dt>
<dd>
<p>Service which exposes the REST interface for managing the Kafka Connect cluster.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Connect ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Connect worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-connect-s2i-str"><a class="link" href="#assembly-deployment-configuration-kafka-connect-s2i-str">3.3. Kafka Connect cluster with Source2Image support</a></h3>
<div class="paragraph">
<p>The full schema of the <code>KafkaConnectS2I</code> resource is described in the <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code> schema reference</a>.
All labels that are applied to the desired <code>KafkaConnectS2I</code> resource will also be applied to the Kubernetes resources making up the Kafka Connect cluster with Source2Image support.
This provides a convenient mechanism for resources to be labeled as required.</p>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-replicas-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-replicas-deployment-configuration-kafka-connect-s2i">3.3.1. Replicas</a></h4>
<div class="paragraph">
<p>Kafka Connect clusters can run multiple of nodes.
The number of nodes is defined in the <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources.
Running a Kafka Connect cluster with multiple nodes can provide better availability and scalability.
However, when running Kafka Connect on Kubernetes it is not absolutely necessary to run multiple nodes of Kafka Connect for high availability.
If a node where Kafka Connect is deployed to crashes, Kubernetes will automatically reschedule the Kafka Connect pod to a different node.
However, running Kafka Connect with multiple nodes can provide faster failover times, because the other nodes will be up and running already.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-replicas-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-replicas-deployment-configuration-kafka-connect-s2i">Configuring the number of nodes</a></h5>
<div class="paragraph">
<p>The number of Kafka Connect nodes is configured using the <code>replicas</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>replicas</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
metadata:
  name: my-cluster
spec:
  # ...
  replicas: 3
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect-s2i">3.3.2. Bootstrap servers</a></h4>
<div class="paragraph">
<p>A Kafka Connect cluster always works in combination with a Kafka cluster.
A Kafka cluster is specified as a list of bootstrap servers.
On Kubernetes, the list must ideally contain the Kafka cluster bootstrap service named <code><em>cluster-name</em>-kafka-bootstrap</code>, and a port of 9092 for plain traffic or 9093 for encrypted traffic.</p>
</div>
<div class="paragraph">
<p>The list of bootstrap servers is configured in the <code>bootstrapServers</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>. The servers must be defined as a comma-separated list specifying one or more Kafka brokers, or a service pointing to Kafka brokers specified as a <code><em>hostname</em>:_port_</code> pairs.</p>
</div>
<div class="paragraph">
<p>When using Kafka Connect with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the cluster.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-bootstrap-servers-deployment-configuration-kafka-connect-s2i">Configuring bootstrap servers</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>bootstrapServers</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  bootstrapServers: my-cluster-kafka-bootstrap:9092
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-tls-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect-s2i">3.3.3. Connecting to Kafka brokers using TLS</a></h4>
<div class="paragraph">
<p>By default, Kafka Connect tries to connect to Kafka brokers using a plain text connection.
If you prefer to use TLS, additional configuration is required.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-connect-tls-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-kafka-connect-tls-deployment-configuration-kafka-connect-s2i">TLS support in Kafka Connect</a></h5>
<div class="paragraph">
<p>TLS support is configured in the <code>tls</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
The <code>tls</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-secret
        certificate: ca.crt
      - secretName: my-other-secret
        certificate: certificate.crt
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple certificates are stored in the same secret, it can be listed multiple times.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates from the same secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
metadata:
  name: my-cluster
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-secret
        certificate: ca.crt
      - secretName: my-secret
        certificate: ca2.crt
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-tls-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-tls-deployment-configuration-kafka-connect-s2i">Configuring TLS in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> for the certificate used for TLS Server Authentication, and the key under which the certificate is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the TLS certificate used in authentication in a file and create a <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The secrets created by the Cluster Operator for Kafka cluster may be used directly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-file.crt</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>tls</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  tls:
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-authentication-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-authentication-deployment-configuration-kafka-connect-s2i">3.3.4. Connecting to Kafka brokers with Authentication</a></h4>
<div class="paragraph">
<p>By default, Kafka Connect will try to connect to Kafka brokers without authentication.
Authentication is enabled through the <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-authenticationdeployment-configuration-kafka-connect-s2i"><a class="link" href="#con-kafka-connect-authenticationdeployment-configuration-kafka-connect-s2i">Authentication support in Kafka Connect</a></h5>
<div class="paragraph">
<p>Authentication is configured through the <code>authentication</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
The <code>authentication</code> property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.
The supported authentication types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS client authentication</p>
</li>
<li>
<p>SASL-based authentication using the SCRAM-SHA-512 mechanism</p>
</li>
<li>
<p>SASL-based authentication using the PLAIN mechanism</p>
</li>
<li>
<p><a href="#assembly-oauth-str">OAuth 2.0 token based authentication</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="tls_client_authentication_3"><a class="link" href="#tls_client_authentication_3">TLS Client Authentication</a></h6>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> property to the value <code>tls</code>.
TLS client authentication uses a TLS certificate to authenticate.
The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from a Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS client authentication can be used only with TLS connections.
For more details about TLS configuration in Kafka Connect see <a href="#assembly-kafka-connect-tls-deployment-configuration-kafka-connect-s2i">Connecting to Kafka brokers using TLS</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example TLS client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: public.crt
      key: private.key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sasl_based_scram_sha_512_authentication_2"><a class="link" href="#sasl_based_scram_sha_512_authentication_2">SASL based SCRAM-SHA-512 authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Connect to use SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based SCRAM-SHA-512 client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: my-connect-user
    passwordSecret:
      secretName: my-connect-user
      password: my-connect-password-key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sasl_based_plain_authentication_2"><a class="link" href="#sasl_based_plain_authentication_2">SASL based PLAIN authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Connect to use SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name of such a <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example showing SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-cluster
spec:
  # ...
  authentication:
    type: plain
    username: my-connect-user
    passwordSecret:
      secretName: my-connect-user
      password: my-connect-password-key
  # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-authentication-tls-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-authentication-tls-deployment-configuration-kafka-connect-s2i">Configuring TLS client authentication in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the public and private keys used for TLS Client Authentication, and the keys under which they are stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the keys used for authentication in a file and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-public.crt</em> --from-file=<em>my-private.key</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  authentication:
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: my-public.crt
      key: my-private.key
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-authentication-scram-sha-512-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-authentication-scram-sha-512-deployment-configuration-kafka-connect-s2i">Configuring SCRAM-SHA-512 authentication in Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>Username of the user which should be used for authentication</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the password used for authentication and the key under which the password is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare a file with the password used in authentication and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be done using <code>kubectl create</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">echo -n '<em>&lt;password&gt;</em>' &gt; <em>&lt;my-password.txt&gt;</em>
kubectl create secret generic <em>&lt;my-secret&gt;</em> --from-file=<em>&lt;my-password.txt&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: _&lt;my-username&gt;_
    passwordSecret:
      secretName: _&lt;my-secret&gt;_
      password: _&lt;my-password.txt&gt;_
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>On Kubernetes this can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-configuration-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-configuration-deployment-configuration-kafka-connect-s2i">3.3.5. Kafka Connect configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of Apache Kafka Connect nodes by editing certain options listed in <a href="http://kafka.apache.org/20/documentation.html#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener / REST interface configuration</p>
</li>
<li>
<p>Plugin path configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-connect-configuration-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-kafka-connect-configuration-deployment-configuration-kafka-connect-s2i">Kafka Connect configuration</a></h5>
<div class="paragraph">
<p>Kafka Connect is configured using the <code>config</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.
This property contains the Kafka Connect configuration options as keys.
The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/20/documentation.html#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> with the exception of those options that are managed directly by Strimzi.
Specifically, configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>plugin.path</code></p>
</li>
<li>
<p><code>rest.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Custer Operator log file.
All other options are passed to Kafka Connect.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Connect cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Connect nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group.id</code> with default value <code>connect-cluster</code></p>
</li>
<li>
<p><code>offset.storage.topic</code> with default value <code>connect-cluster-offsets</code></p>
</li>
<li>
<p><code>config.storage.topic</code> with default value <code>connect-cluster-configs</code></p>
</li>
<li>
<p><code>status.storage.topic</code> with default value <code>connect-cluster-status</code></p>
</li>
<li>
<p><code>key.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
<li>
<p><code>value.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured in case they are not present in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-multiple-instances-deployment-configuration-kafka-connect-s2i"><a class="link" href="#con-kafka-connect-multiple-instances-deployment-configuration-kafka-connect-s2i">Kafka Connect configuration for multiple instances</a></h5>
<div class="paragraph">
<p>If you are running multiple instances of Kafka Connect, pay attention to the default configuration of the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
  group.id: connect-cluster <b class="conum">(1)</b>
  offset.storage.topic: connect-cluster-offsets <b class="conum">(2)</b>
  config.storage.topic: connect-cluster-configs <b class="conum">(3)</b>
  status.storage.topic: connect-cluster-status  <b class="conum">(4)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Kafka Connect cluster group the instance belongs to.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Values for the three topics must be the same for all Kafka Connect instances with the same <code>group.id</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless you change the default settings, each Kafka Connect instance connecting to the same Kafka cluster is deployed with the same values.
What happens, in effect, is all instances are coupled to run in a cluster and use the same topics.</p>
</div>
<div class="paragraph">
<p>If multiple Kafka Connect clusters try to use the same topics, Kafka Connect will not work as expected and generate errors.</p>
</div>
<div class="paragraph">
<p>If you wish to run multiple Kafka Connect instances, change the values of these properties for each instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-connect-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-kafka-connect-deployment-configuration-kafka-connect-s2i">Configuring Kafka Connect</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>config</code> property in the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">3.3.6. CPU and memory resources</a></h4>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports two types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU</p>
</li>
<li>
<p>Memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying CPU and memory resources.</p>
</div>
<div class="sect4">
<h5 id="ref-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">Resource limits and requests</a></h5>
<div class="paragraph">
<p>Resource limits and requests are configured using the <code>resources</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="resource_requests_3"><a class="link" href="#resource_requests_3">Resource requests</a></h6>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resources requests are specified in the <code>requests</code> property.
Resources requests currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource request configuration with all resources</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="resource_limits_3"><a class="link" href="#resource_limits_3">Resource limits</a></h6>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>Resource limits are specified in the <code>limits</code> property.
Resource limits currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="listingblock">
<div class="title">Example resource limits configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  limits:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="supported_cpu_formats_3"><a class="link" href="#supported_cpu_formats_3">Supported CPU formats</a></h6>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="supported_memory_formats_3"><a class="link" href="#supported_memory_formats_3">Supported memory formats</a></h6>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">Configuring resource requests and limits</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>resources</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    resources:
      requests:
        cpu: "8"
        memory: 64Gi
      limits:
        cpu: "12"
        memory: 128Gi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-ResourceRequirements-reference"><code>Resources</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-logging-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-logging-deployment-configuration-kafka-connect-s2i">3.3.7. Logging</a></h4>
<div class="paragraph">
<p>This section provides information on loggers and how to configure log levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the loggers and their levels directly (inline) or use a custom (external) config map.</p>
</div>
<div class="sect4">
<h5 id="ref-loggers-KafkaConnectS2I-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-loggers-KafkaConnectS2I-deployment-configuration-kafka-connect-s2i">Kafka Connect with Source2Image loggers</a></h5>
<div class="paragraph">
<p>Kafka Connect with Source2Image support has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connect.root.logger.level</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.zookeeper</code></p>
</li>
<li>
<p><code>log4j.logger.org.I0Itec.zkclient</code></p>
</li>
<li>
<p><code>log4j.logger.org.reflections</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="kafka-inline-logging-deployment-configuration-kafka-connect-s2i"><a class="link" href="#kafka-inline-logging-deployment-configuration-kafka-connect-s2i">Specifying inline logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the loggers and logging level for the required components.</p>
<div class="paragraph">
<p>For example, the logging level here is set to INFO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
spec:
  # ...
  logging:
    type: inline
    loggers:
      <em>logger.name</em>: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</div>
<div class="paragraph">
<p>For more information about the log levels, see the <a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" target="_blank" rel="noopener">log4j manual</a>.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="kafka-external-logging-deployment-configuration-kafka-connect-s2i"><a class="link" href="#kafka-external-logging-deployment-configuration-kafka-connect-s2i">Specifying an external ConfigMap for logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the name of the <code>ConfigMap</code> to use for the required components. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnectS2I
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to place your custom ConfigMap under the <code>log4j.properties</code> or <code>log4j2.properties</code> key.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on GC, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-healthchecks-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-healthchecks-deployment-configuration-kafka-connect-s2i">3.3.8. Healthchecks</a></h4>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>Kubernetes supports two types of Healthcheck probes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Liveness probes</p>
</li>
<li>
<p>Readiness probes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.
Both types of probes are used in Strimzi components.</p>
</div>
<div class="paragraph">
<p>Users can configure selected options for liveness and readiness probes.</p>
</div>
<div class="sect4">
<h5 id="ref-healthchecks-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-healthchecks-deployment-configuration-kafka-connect-s2i">Healthcheck configurations</a></h5>
<div class="paragraph">
<p>Liveness and readiness probes can be configured using the <code>livenessProbe</code> and <code>readinessProbe</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference"><code>Probe</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-healthchecks-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-healthchecks-deployment-configuration-kafka-connect-s2i">Configuring healthchecks</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>livenessProbe</code> or <code>readinessProbe</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-metrics-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-metrics-deployment-configuration-kafka-connect-s2i">3.3.9. Prometheus metrics</a></h4>
<div class="paragraph">
<p>Strimzi supports Prometheus metrics using <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a> to convert the JMX metrics supported by Apache Kafka and Zookeeper to Prometheus metrics.
When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>For more information about configuring Prometheus and Grafana, see <a href="#assembly-metrics-setup-str">Metrics</a>.</p>
</div>
<div class="sect4">
<h5 id="ref-metrics-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-metrics-deployment-configuration-kafka-connect-s2i">Metrics configuration</a></h5>
<div class="paragraph">
<p>Prometheus metrics are enabled by configuring the <code>metrics</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics will be disabled.
To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics without any further configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property might contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics with additional Prometheus JMX Exporter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics:
      lowercaseOutputName: true
      rules:
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*, topic=(.+)&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
          labels:
            topic: "$3"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-metrics-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-metrics-deployment-configuration-kafka-connect-s2i">Configuring Prometheus metrics</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>metrics</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    metrics:
      lowercaseOutputName: true
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jvm-options-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-jvm-options-deployment-configuration-kafka-connect-s2i">3.3.10. JVM Options</a></h4>
<div class="paragraph">
<p>The following components of Strimzi run inside a Virtual Machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache Zookeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka Mirror Maker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JVM configuration options optimize the performance for different platforms and architectures.
Strimzi allows you to configure some of these options.</p>
</div>
<div class="sect4">
<h5 id="ref-jvm-options-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-jvm-options-deployment-configuration-kafka-connect-s2i">JVM configuration</a></h5>
<div class="paragraph">
<p>JVM options can be configured using the <code>jvmOptions</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only a selected subset of available JVM options can be configured.
The following options are supported:</p>
</div>
<div class="paragraph">
<div class="title">-Xms and -Xmx</div>
<p><code>-Xms</code> configures the minimum initial allocation heap size when the JVM starts.
<code>-Xmx</code> configures the maximum heap size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings such as <code>-Xmx</code> and <code>-Xms</code> are those accepted by the JDK <code>java</code> binary in the corresponding image.
Accordingly, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is in contrast to the units used for <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default values used for <code>-Xms</code> and <code>-Xmx</code> depends on whether there is a <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-connect-s2i">memory request</a> limit configured for the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a memory limit then the JVM&#8217;s minimum and maximum memory will be set to a value corresponding to the limit.</p>
</li>
<li>
<p>If there is no memory limit then the JVM&#8217;s minimum memory will be set to <code>128M</code> and the JVM&#8217;s maximum memory will not be defined.  This allows for the JVM&#8217;s memory to grow as-needed, which is ideal for single node environments in test and development.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>-Xmx</code> explicitly requires some care:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JVM&#8217;s overall memory usage will be approximately 4  the maximum heap, as configured by <code>-Xmx</code>.</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory limit, it is possible that the container will be killed should the Kubernetes node experience memory pressure (from other Pods running on it).</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory request, it is possible that the container will be scheduled to a node with insufficient memory.
In this case, the container will not start but crash (immediately if <code>-Xms</code> is set to <code>-Xmx</code>, or some later time if not).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting <code>-Xmx</code> explicitly, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the memory request and the memory limit to the same value,</p>
</li>
<li>
<p>use a memory request that is at least 4.5  the <code>-Xmx</code>,</p>
</li>
<li>
<p>consider setting <code>-Xms</code> to the same value as <code>-Xmx</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers doing lots of disk I/O (such as Kafka broker containers) will need to leave some memory available for use as operating system page cache.
On such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-Xmx</code> and <code>-Xms</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the JVM will use 2 GiB (=2,147,483,648 bytes) for its heap.
Its total memory usage will be approximately 8GiB.</p>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.
For Kafka and Zookeeper pods such allocation could cause unwanted latency.
For Kafka Connect avoiding over allocation may be the most important concern, especially in distributed mode where the effects of over-allocation will be multiplied by the number of consumers.</p>
</div>
<div class="paragraph">
<div class="title">-server</div>
<p><code>-server</code> enables the server JVM. This option can be set to true or false.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-server</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-server": true
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">-XX</div>
<p><code>-XX</code> object can be used for configuring advanced runtime options of a JVM.
The <code>-server</code> and <code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the use of the <code>-XX</code> object</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true
    "UseParNewGC": false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example configuration above will result in the following JVM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="garbage_collector_logging_3"><a class="link" href="#garbage_collector_logging_3">Garbage collector logging</a></h6>
<div class="paragraph">
<p>The <code>jvmOptions</code> section also allows you to enable and disable garbage collector (GC) logging.
GC logging is enabled by default.
To disable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example of disabling GC logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  gcLoggingEnabled: false
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-jvm-options-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-jvm-options-deployment-configuration-kafka-connect-s2i">Configuring JVM options</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>jvmOptions</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jvmOptions:
      "-Xmx": "8g"
      "-Xms": "8g"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-container-images-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-configuring-container-images-deployment-configuration-kafka-connect-s2i">3.3.11. Container images</a></h4>
<div class="paragraph">
<p>Strimzi allows you to configure container images which will be used for its components.
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such a case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="sect4">
<h5 id="ref-configuring-container-images-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-configuring-container-images-deployment-configuration-kafka-connect-s2i">Container image configurations</a></h5>
<div class="paragraph">
<p>Container image which should be used for given components can be specified using the <code>image</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="configuring_the_kafka_spec_kafka_image_property_3"><a class="link" href="#configuring_the_kafka_spec_kafka_image_property_3">Configuring the <code>Kafka.spec.kafka.image</code> property</a></h6>
<div class="paragraph">
<p>The <code>Kafka.spec.kafka.image</code> property functions differently from the others, because Strimzi supports multiple versions of Kafka, each requiring the own image.
The <code>STRIMZI_KAFKA_IMAGES</code> environment variable of the Cluster Operator configuration is used to provide a mapping between Kafka versions and the corresponding images.
This is used in combination with the <code>Kafka.spec.kafka.image</code> and <code>Kafka.spec.kafka.version</code> properties as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>Kafka.spec.kafka.image</code> nor <code>Kafka.spec.kafka.version</code> are given in the custom resource then the <code>version</code> will default to the  Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is given but <code>Kafka.spec.kafka.version</code> is not then the given image will be used and the <code>version</code> will be assumed to be the  Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.version</code> is given but <code>Kafka.spec.kafka.image</code> is not then image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>Both <code>Kafka.spec.kafka.version</code> and <code>Kafka.spec.kafka.image</code> are given the given image will be used, and it will be assumed to contain a Kafka broker with the given version.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is best to provide just <code>Kafka.spec.kafka.version</code> and leave the <code>Kafka.spec.kafka.image</code> property unspecified.
This reduces the chances of making a mistake in configuring the <code>Kafka</code> resource. If you need to change the images used for different versions of Kafka, it is better to configure the Cluster Operator&#8217;s <code>STRIMZI_KAFKA_IMAGES</code> environment variable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configuring_the_image_property_in_other_resources_3"><a class="link" href="#configuring_the_image_property_in_other_resources_3">Configuring the <code>image</code> property in other resources</a></h6>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka broker TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper nodes:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper node TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect with Source2image support:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_S2I_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such case, you should either copy the Strimzi images or build them from source.
In case the configured image is not compatible with Strimzi images, it might not work properly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-container-images-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-configuring-container-images-deployment-configuration-kafka-connect-s2i">Configuring container images</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>image</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-scheduling-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-scheduling-deployment-configuration-kafka-connect-s2i">3.3.12. Configuring pod scheduling</a></h4>
<div id="con-scheduling-deployment-configuration-kafka-connect-s2i" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods"><a class="link" href="#assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods">Scheduling pods based on other applications</a></h5>
<div class="sect5">
<h6 id="con-scheduling-based-on-other-pods-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods"><a class="link" href="#con-scheduling-based-on-other-pods-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods">Avoid critical applications to share the node</a></h6>
<div class="paragraph">
<p>Pod anti-affinity can be used to ensure that critical applications are never scheduled on the same disk.
When running Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share the nodes with other workloads like databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods"><a class="link" href="#affinity-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-connect-s2i-scheduling-based-on-pods">Configuring pod anti-affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-node-scheduling-deployment-configuration-kafka-connect-s2i-node-scheduling"><a class="link" href="#assembly-node-scheduling-deployment-configuration-kafka-connect-s2i-node-scheduling">Scheduling pods to specific nodes</a></h5>
<div class="sect5">
<h6 id="con-scheduling-to-specific-nodes-deployment-configuration-kafka-connect-s2i-node-scheduling"><a class="link" href="#con-scheduling-to-specific-nodes-deployment-configuration-kafka-connect-s2i-node-scheduling">Node scheduling</a></h6>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-s2i-node-scheduling"><a class="link" href="#affinity-deployment-configuration-kafka-connect-s2i-node-scheduling">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-configuring-node-affinity-deployment-configuration-kafka-connect-s2i-node-scheduling"><a class="link" href="#proc-configuring-node-affinity-deployment-configuration-kafka-connect-s2i-node-scheduling">Configuring node affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-dedidcated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes"><a class="link" href="#assembly-dedidcated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes">Using dedicated nodes</a></h5>
<div class="sect5">
<h6 id="con-dedicated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes"><a class="link" href="#con-dedicated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes">Dedicated nodes</a></h6>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Taints can be used to create dedicated nodes.
Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
<div class="paragraph">
<p>To schedule Kafka pods on the dedicated nodes, configure <a href="#affinity-deployment-configuration-kafka-connect-s2i-dedicated-nodes">node affinity</a> and <a href="#tolerations-deployment-configuration-kafka-connect-s2i-dedicated-nodes">tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-connect-s2i-dedicated-nodes"><a class="link" href="#affinity-deployment-configuration-kafka-connect-s2i-dedicated-nodes">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="tolerations-deployment-configuration-kafka-connect-s2i-dedicated-nodes"><a class="link" href="#tolerations-deployment-configuration-kafka-connect-s2i-dedicated-nodes">Tolerations</a></h6>
<div class="paragraph">
<p>Tolerations can be configured using the <code>tolerations</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>tolerations</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-dedicated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes"><a class="link" href="#proc-dedicated-nodes-deployment-configuration-kafka-connect-s2i-dedicated-nodes">Setting up dedicated nodes and scheduling pods on them</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl taint node <em>your-node</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect-s2i"><a class="link" href="#assembly-kafka-connect-external-configuration-deployment-configuration-kafka-connect-s2i">3.3.13. Using external configuration and secrets</a></h4>
<div class="paragraph">
<p>Kafka Connect connectors are configured using an HTTP REST interface.
The connector configuration is passed to Kafka Connect as part of an HTTP request and stored within Kafka itself.</p>
</div>
<div class="paragraph">
<p>Some parts of the configuration of a Kafka Connect connector can be externalized using ConfigMaps or Secrets.
You can then reference the configuration values in HTTP REST commands (this keeps the configuration separate and more secure, if needed).
This method applies especially to confidential data, such as usernames, passwords, or certificates.</p>
</div>
<div class="paragraph">
<p>ConfigMaps and Secrets are standard Kubernetes resources used for storing of configurations and confidential data.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-connect-external-configuration-deployment-configuration-kafka-connect-s2i"><a class="link" href="#con-kafka-connect-external-configuration-deployment-configuration-kafka-connect-s2i">Storing connector configurations externally</a></h5>
<div class="paragraph">
<p>You can mount ConfigMaps or Secrets into a Kafka Connect pod as volumes or environment variables.
Volumes and environment variables are configured in the <code>externalConfiguration</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.</p>
</div>
<div class="sect5">
<h6 id="external_configuration_as_environment_variables_2"><a class="link" href="#external_configuration_as_environment_variables_2">External configuration as environment variables</a></h6>
<div class="paragraph">
<p>The <code>env</code> property is used to specify one or more environment variables.
These variables can contain a value from either a ConfigMap or a Secret.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The names of user-defined environment variables cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mount a value from a Secret to an environment variable, use the <code>valueFrom</code> property and the <code>secretKeyRef</code> as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example of an environment variable set to a value from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          secretKeyRef:
            name: my-secret
            key: my-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>A common use case for mounting Secrets to environment variables is when your connector needs to communicate with Amazon AWS and needs to read the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with credentials.</p>
</div>
<div class="paragraph">
<p>To mount a value from a ConfigMap to an environment variable, use <code>configMapKeyRef</code> in the <code>valueFrom</code> property as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example of an environment variable set to a value from a ConfigMap</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          configMapKeyRef:
            name: my-config-map
            key: my-key</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="external_configuration_as_volumes_2"><a class="link" href="#external_configuration_as_volumes_2">External configuration as volumes</a></h6>
<div class="paragraph">
<p>You can also mount ConfigMaps or Secrets to a Kafka Connect pod as volumes.
Using volumes instead of environment variables is useful in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mounting truststores or keystores with TLS certificates</p>
</li>
<li>
<p>Mounting a properties file that is used to configure Kafka Connect connectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <code>volumes</code> property of the <code>externalConfiguration</code> resource, list the ConfigMaps or Secrets that will be mounted as volumes.
Each volume must specify a name in the <code>name</code> property and a reference to ConfigMap or Secret.</p>
</div>
<div class="listingblock">
<div class="title">Example of volumes with external configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    volumes:
      - name: connector1
        configMap:
          name: connector1-configuration
      - name: connector1-certificates
        secret:
          secretName: connector1-certificates</code></pre>
</div>
</div>
<div class="paragraph">
<p>The volumes will be mounted inside the Kafka Connect containers in the path <code>/opt/kafka/external-configuration/<em>&lt;volume-name&gt;</em></code>.
For example, the files from a volume named <code>connector1</code> would appear in the directory <code>/opt/kafka/external-configuration/connector1</code>.</p>
</div>
<div class="paragraph">
<p>The <code>FileConfigProvider</code> has to be used to read the values from the mounted properties files in connector configurations.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-connect-mounting-secrets-as-environment-variables-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-kafka-connect-mounting-secrets-as-environment-variables-deployment-configuration-kafka-connect-s2i">Mounting Secrets as environment variables</a></h5>
<div class="paragraph">
<p>You can create a Kubernetes Secret and mount it to Kafka Connect as an environment variable.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a secret containing the information that will be mounted as an environment variable.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: aws-creds
type: Opaque
data:
  awsAccessKey: QUtJQVhYWFhYWFhYWFhYWFg=
  awsSecretAccessKey: Ylhsd1lYTnpkMjl5WkE=</code></pre>
</div>
</div>
</li>
<li>
<p>Create or edit the Kafka Connect resource.
Configure the <code>externalConfiguration</code> section of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> custom resource to reference the secret.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the changes to your Kafka Connect deployment.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The environment variables are now available for use when developing your connectors.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about external configuration in Kafka Connect, see <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-kafka-connect-mounting-volumes-deployment-configuration-kafka-connect-s2i"><a class="link" href="#proc-kafka-connect-mounting-volumes-deployment-configuration-kafka-connect-s2i">Mounting Secrets as volumes</a></h5>
<div class="paragraph">
<p>You can create a Kubernetes Secret, mount it as a volume to Kafka Connect, and then use it to configure a Kafka Connect connector.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a secret containing a properties file that defines the configuration options for your connector configuration.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData:
  connector.properties: |-
    dbUsername: my-user
    dbPassword: my-password</code></pre>
</div>
</div>
</li>
<li>
<p>Create or edit the Kafka Connect resource.
Configure the <code>FileConfigProvider</code> in the <code>config</code> section and the <code>externalConfiguration</code> section of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> custom resource to reference the secret.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    config.providers: file
    config.providers.file.class: org.apache.kafka.common.config.provider.FileConfigProvider
  #...
  externalConfiguration:
    volumes:
      - name: connector-config
        secret:
          secretName: mysecret</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the changes to your Kafka Connect deployment.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Use the values from the mounted properties file in your JSON payload with connector configuration.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
   "name":"my-connector",
   "config":{
      "connector.class":"MyDbConnector",
      "tasks.max":"3",
      "database": "my-postgresql:5432"
      "username":"${file:/opt/kafka/external-configuration/connector-config/connector.properties:dbUsername}",
      "password":"${file:/opt/kafka/external-configuration/connector-config/connector.properties:dbPassword}",
      # ...
   }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about external configuration in Kafka Connect, see <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-connect-s2i-resources-deployment-configuration-kafka-connect-s2i"><a class="link" href="#ref-list-of-kafka-connect-s2i-resources-deployment-configuration-kafka-connect-s2i">3.3.14. List of resources created as part of Kafka Connect cluster with Source2Image support</a></h4>
<div class="paragraph">
<p>The following resources will created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-source</dt>
<dd>
<p>ImageStream which is used as the base image for the newly-built Docker images.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>BuildConfig which is responsible for building the new Kafka Connect Docker images.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>ImageStream where the newly built Docker images will be pushed.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>DeploymentConfig which is in charge of creating the Kafka Connect worker node pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-api</dt>
<dd>
<p>Service which exposes the REST interface for managing the Kafka Connect cluster.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Connect ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Connect worker nodes.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="using-openshift-s2i-create-image-deployment-configuration-kafka-connect-s2i"><a class="link" href="#using-openshift-s2i-create-image-deployment-configuration-kafka-connect-s2i">3.3.15. Creating a container image using OpenShift builds and Source-to-Image</a></h4>
<div class="paragraph">
<p>You can use OpenShift <a href="https://docs.okd.io/3.9/dev_guide/builds/index.html" target="_blank" rel="noopener">builds</a> and the  <a href="https://docs.okd.io/3.9/creating_images/s2i.html" target="_blank" rel="noopener">Source-to-Image (S2I)</a> framework to create new container images. An OpenShift build takes a builder image with S2I support, together with source code and binaries provided by the user, and uses them to build a new container image. Once built, container images are stored in OpenShift&#8217;s local container image repository and are available for use in deployments.</p>
</div>
<div class="paragraph">
<p>A Kafka Connect builder image with S2I support is provided on the <a href="https://hub.docker.com/u/strimzi" target="_blank" rel="noopener">Docker Hub</a> as part of the <code>strimzi/kafka:latest-kafka-2.3.0</code> image. This S2I image takes your binaries (with plug-ins and connectors) and stores them in the <code>/tmp/kafka-plugins/s2i</code> directory. It creates a new Kafka Connect image from this directory, which can then be used with the Kafka Connect deployment. When started using the enhanced image, Kafka Connect loads any third-party plug-ins from the <code>/tmp/kafka-plugins/s2i</code> directory.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the command line, use the <code>oc apply</code> command to create and deploy a Kafka Connect S2I cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc apply -f examples/kafka-connect/kafka-connect-s2i.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Create a directory with Kafka Connect plug-ins:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ tree ./<em>my-plugins</em>/
./<em>my-plugins</em>/
 debezium-connector-mongodb
  bson-3.4.2.jar
  CHANGELOG.md
  CONTRIBUTE.md
  COPYRIGHT.txt
  debezium-connector-mongodb-0.7.1.jar
  debezium-core-0.7.1.jar
  LICENSE.txt
  mongodb-driver-3.4.2.jar
  mongodb-driver-core-3.4.2.jar
  README.md
 debezium-connector-mysql
  CHANGELOG.md
  CONTRIBUTE.md
  COPYRIGHT.txt
  debezium-connector-mysql-0.7.1.jar
  debezium-core-0.7.1.jar
  LICENSE.txt
  mysql-binlog-connector-java-0.13.0.jar
  mysql-connector-java-5.1.40.jar
  README.md
  wkb-1.0.2.jar
 debezium-connector-postgres
     CHANGELOG.md
     CONTRIBUTE.md
     COPYRIGHT.txt
     debezium-connector-postgres-0.7.1.jar
     debezium-core-0.7.1.jar
     LICENSE.txt
     postgresql-42.0.0.jar
     protobuf-java-2.6.1.jar
     README.md</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>oc start-build</code> command to start a new build of the image using the prepared directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc start-build <em>my-connect-cluster-connect</em> --from-dir ./<em>my-plugins</em>/</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The name of the build is the same as the name of the deployed Kafka Connect cluster.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Once the build has finished, the new image is used automatically by the Kafka Connect deployment.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-mirror-maker-str"><a class="link" href="#assembly-deployment-configuration-kafka-mirror-maker-str">3.4. Kafka Mirror Maker configuration</a></h3>
<div class="paragraph">
<p>This chapter describes how to configure the <code>KafkaMirrorMaker</code> resource to support a Kafka Mirror Maker deployment in your cluster.</p>
</div>
<div class="paragraph">
<p>The following procedures show how the resource is configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-kafka-mirror-maker-deployment-configuration-kafka-mirror-maker">Configuring Kafka Mirror Maker</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Supported properties are also described in more detail for your reference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#con-configuring-mirror-maker-deployment-configuration-kafka-mirror-maker">Kafka Mirror Maker configuration properties</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full schema of the <code>KafkaMirrorMaker</code> resource is described in the <a href="#type-KafkaMirrorMaker-reference">KafkaMirrorMaker schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Labels applied to a <code>KafkaMirrorMaker</code> resource are also applied to the Kubernetes resources comprising Kafka Mirror Maker.
This provides a convenient mechanism for resources to be labeled as required.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-kafka-mirror-maker-deployment-configuration-kafka-mirror-maker"><a class="link" href="#configuring-kafka-mirror-maker-deployment-configuration-kafka-mirror-maker">3.4.1. Configuring Kafka Mirror Maker</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>KafkaMirrorMaker</code> resource to configure your Kafka Mirror Maker deployment.</p>
</div>
<div class="paragraph">
<p>You can configure access control for producers and consumers using TLS or SASL authentication.
This procedure shows a configuration that uses TLS encryption and authentication on the consumer and producer side.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#cluster-operator-str">Strimzi and Kafka is deployed</a></p>
</li>
<li>
<p>Source and target Kafka clusters are available</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaMirrorMaker</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
metadata:
  name: my-mirror-maker
spec:
  replicas: 3 <b class="conum">(1)</b>
  consumer:
    bootstrapServers: my-source-cluster-kafka-bootstrap:9092 <b class="conum">(2)</b>
    groupId: "my-group" <b class="conum">(3)</b>
    numStreams: 2 <b class="conum">(4)</b>
    offsetCommitInterval: 120000 <b class="conum">(5)</b>
    tls: <b class="conum">(6)</b>
      trustedCertificates:
      - secretName: my-source-cluster-ca-cert
        certificate: ca.crt
    authentication: <b class="conum">(7)</b>
      type: tls
      certificateAndKey:
        secretName: my-source-secret
        certificate: public.crt
        key: private.key
    config: <b class="conum">(8)</b>
      max.poll.records: 100
      receive.buffer.bytes: 32768
  producer:
    bootstrapServers: my-target-cluster-kafka-bootstrap:9092
    abortOnSendFailure: false <b class="conum">(9)</b>
    tls:
      trustedCertificates:
      - secretName: my-target-cluster-ca-cert
        certificate: ca.crt
    authentication:
      type: tls
      certificateAndKey:
        secretName: my-target-secret
        certificate: public.crt
        key: private.key
    config:
      compression.type: gzip
      batch.size: 8192
  whitelist: "my-topic|other-topic" <b class="conum">(10)</b>
  resources: <b class="conum">(11)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(12)</b>
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  readinessProbe: <b class="conum">(13)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  metrics: <b class="conum">(14)</b>
    lowercaseOutputName: true
    rules:
      - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
        name: "kafka_server_$1_$2_total"
      - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*,
        topic=(.+)&gt;&lt;&gt;Count"
        name: "kafka_server_$1_$2_total"
        labels:
          topic: "$3"
  jvmOptions: <b class="conum">(15)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(16)</b>
  template: <b class="conum">(17)</b>
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The number of replica nodes.</p>
</li>
<li>
<p>Bootstrap servers for consumer and producer.</p>
</li>
<li>
<p>Group ID for the consumer.</p>
</li>
<li>
<p>The number of consumer streams.</p>
</li>
<li>
<p>The offset auto-commit interval in milliseconds.</p>
</li>
<li>
<p>TLS encryption with key names under which TLS certificates are stored in X.509 format for consumer or producer. For more details see <a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code> schema reference</a>.</p>
</li>
<li>
<p>Authentication for consumer or producer, using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>, as shown here, using <a href="#type-KafkaClientAuthenticationOAuth-reference">OAuth bearer tokens</a>, or a SASL-based <a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a> or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a> mechanism.</p>
</li>
<li>
<p>Kafka configuration options for consumer and producer.</p>
</li>
<li>
<p>If set to <code>true</code>, Kafka Mirror Maker will exit and the container will restart following a send failure for a message.</p>
</li>
<li>
<p>Topics mirrored from source to target Kafka cluster.</p>
</li>
<li>
<p>Requests for reservation of supported resources, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified loggers and log levels added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. Mirror Maker has a single logger called <code>mirrormaker.root.logger</code>. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p>Healthchecks to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p>Prometheus metrics, which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using <code>metrics: {}</code>.</p>
</li>
<li>
<p>JVM configuration options to optimize performance for the Virtual Machine (VM) running Kafka Mirror Maker.</p>
</li>
<li>
<p>ADVANCED OPTION: Container image configuration, which is <a href="#con-configuring-container-images-deployment-configuration-kafka-mirror-maker">recommended only in special situations</a>.</p>
</li>
<li>
<p><a href="#assembly-customizing-deployments-str">Template customization</a>. Here a pod is scheduled based with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
With the <code>abortOnSendFailure</code> property set to <code>false</code>, the producer attempts to send the next message in a topic. The original message might be lost, as there is no attempt to resend a failed message.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>&lt;your-file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-configuring-mirror-maker-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-configuring-mirror-maker-deployment-configuration-kafka-mirror-maker">3.4.2. Kafka Mirror Maker configuration properties</a></h4>
<div class="paragraph">
<p>Use the <code>spec</code> configuration properties of the <code>KafkaMirrorMaker</code> resource to set up your Mirror Maker deployment.</p>
</div>
<div class="paragraph">
<p>Supported properties are described here for your reference.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-replicas-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-replicas-deployment-configuration-kafka-mirror-maker">Replicas</a></h5>
<div class="paragraph">
<p>Use the <code>replicas</code> property to configure replicas.</p>
</div>
<div class="paragraph">
<p>You can run multiple Mirror Maker replicas to provide better availability and scalability.
When running Kafka Mirror Maker on Kubernetes it is not absolutely necessary to run multiple replicas of the Kafka Mirror Maker for high availability.
When the node where the Kafka Mirror Maker has deployed crashes, Kubernetes will automatically reschedule the Kafka Mirror Maker pod to a different node.
However, running Kafka Mirror Maker with multiple replicas can provide faster failover times as the other nodes will be up and running.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-bootstrap-servers-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-bootstrap-servers-deployment-configuration-kafka-mirror-maker">Bootstrap servers</a></h5>
<div class="paragraph">
<p>Use the <code>consumer.bootstrapServers</code> and <code>producer.bootstrapServers</code> properties to configure lists of bootstrap servers for the consumer and producer.</p>
</div>
<div class="paragraph">
<p>Kafka Mirror Maker always works together with two Kafka clusters (source and target).
The source and the target Kafka clusters are specified in the form of two lists of comma-separated list of <code><em>&lt;hostname&gt;</em>:<em>&lt;port&gt;</em></code> pairs.
Each comma-separated list contains one or more Kafka brokers or a <code>Service</code> pointing to Kafka brokers specified as a <code>&lt;hostname&gt;:&lt;port&gt;</code> pairs.</p>
</div>
<div class="paragraph">
<p>The bootstrap server lists can refer to Kafka clusters that do not need to be deployed in the same Kubernetes cluster.
They can even refer to a Kafka cluster not deployed by Strimzi, or deployed by Strimzi but on a different Kubernetes cluster accessible outside.</p>
</div>
<div class="paragraph">
<p>If on the same Kubernetes cluster, each list must ideally contain the Kafka cluster bootstrap service which is named <code><em>&lt;cluster-name&gt;</em>-kafka-bootstrap</code> and a port of 9092 for plain traffic or 9093 for encrypted traffic.
If deployed by Strimzi but on different Kubernetes clusters, the list content depends on the approach used for exposing the clusters (routes, nodeports or loadbalancers).</p>
</div>
<div class="paragraph">
<p>When using Kafka Mirror Maker with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the given cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-whitelist-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-whitelist-deployment-configuration-kafka-mirror-maker">Whitelist</a></h5>
<div class="paragraph">
<p>Use the <code>whitelist</code> property to configure a list of topics that Kafka Mirror Maker mirrors from the source to the target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The property allows any regular expression from the simplest case with a single topic name to complex patterns.
For example, you can mirror topics A and B using "A|B" or all topics using "*".
You can also pass multiple regular expressions separated by commas to the Kafka Mirror Maker.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-groupid-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-groupid-deployment-configuration-kafka-mirror-maker">Consumer group identifier</a></h5>
<div class="paragraph">
<p>Use the <code>consumer.groupId</code> property to configure a consumer group identifier for the consumer.</p>
</div>
<div class="paragraph">
<p>Kafka Mirror Maker uses a Kafka consumer to consume messages, behaving like any other Kafka consumer client.
Messages consumed from the source Kafka cluster are mirrored to a target Kafka cluster.
A group identifier is required, as the consumer needs to be part of a consumer group for the assignment of partitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-numstreams-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-numstreams-deployment-configuration-kafka-mirror-maker">Consumer streams</a></h5>
<div class="paragraph">
<p>Use the <code>consumer.numStreams</code> property to configure the number of streams for the consumer.</p>
</div>
<div class="paragraph">
<p>You can increase the throughput in mirroring topics by increasing the number of consumer threads.
Consumer threads belong to the consumer group specified for Kafka Mirror Maker.
Topic partitions are assigned across the consumer threads, which consume messages in parallel.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-offset-commit-interval-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-offset-commit-interval-deployment-configuration-kafka-mirror-maker">Offset auto-commit interval</a></h5>
<div class="paragraph">
<p>Use the <code>consumer.offsetCommitInterval</code> property to configure an offset auto-commit interval for the consumer.</p>
</div>
<div class="paragraph">
<p>You can specify the regular time interval at which an offset is committed after Kafka Mirror Maker has consumed data from the source Kafka cluster.
The time interval is set in milliseconds, with a default value of 60,000.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-abort-on-send-failure-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-abort-on-send-failure-deployment-configuration-kafka-mirror-maker">Abort on message send failure</a></h5>
<div class="paragraph">
<p>Use the <code>producer.abortOnSendFailure</code> property to configure how to handle message send failure from the producer.</p>
</div>
<div class="paragraph">
<p>By default, if an error occurs when sending a message from Kafka Mirror Maker to a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka Mirror Maker container is terminated in Kubernetes.</p>
</li>
<li>
<p>The container is then recreated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>abortOnSendFailure</code> option is set to <code>false</code>, message sending errors are ignored.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-configuration-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-configuration-deployment-configuration-kafka-mirror-maker">Kafka producer and consumer</a></h5>
<div class="paragraph">
<p>Use the <code>consumer.config</code> and <code>producer.config</code> properties to configure Kafka options for the consumer and producer.</p>
</div>
<div class="paragraph">
<p>The <code>config</code> property contains the Kafka Mirror Maker consumer and producer configuration options as keys, with values set in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Exceptions</div>
<p>You can specify and configure standard Kafka consumer and producer options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://kafka.apache.org/20/documentation.html#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a></p>
</li>
<li>
<p><a href="http://kafka.apache.org/20/documentation.html#newconsumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, there are exceptions for options automatically configured and managed directly by Strimzi related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (encryption, authentication, and authorization)</p>
</li>
<li>
<p>Consumer group identifier</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Custer Operator log file.
All other options are passed to Kafka Mirror Maker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When an invalid configuration is provided, the Kafka Mirror Maker might not start or might become unstable.
In such cases, the configuration in the <code>KafkaMirrorMaker.spec.consumer.config</code> or <code>KafkaMirrorMaker.spec.producer.config</code> object should be fixed and the Cluster Operator will roll out the new configuration for Kafka Mirror Maker.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="con-resource-limits-and-requests-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-resource-limits-and-requests-deployment-configuration-kafka-mirror-maker">CPU and memory resources</a></h5>
<div class="paragraph">
<p>Use the <code>reources.requests</code> and <code>resources.limits</code> properties to configure resource requests and limits.</p>
</div>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports requests and limits for the following types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying these resources.</p>
</div>
<div class="paragraph">
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</div>
<div class="paragraph">
<div class="title">Resource requests</div>
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="paragraph">
<div class="title">Resource limits</div>
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="paragraph">
<div class="title">Supported CPU formats</div>
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</div>
<div class="paragraph">
<div class="title">Supported memory formats</div>
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-kafka-mirror-maker-logging-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-kafka-mirror-maker-logging-deployment-configuration-kafka-mirror-maker">Kafka Mirror Maker loggers</a></h5>
<div class="paragraph">
<p>Kafka Mirror Maker has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mirrormaker.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on GC, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</li>
<li>
<p>For more information about log levels, see the <a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" target="_blank" rel="noopener">log4j manual</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="con-healthchecks-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-healthchecks-deployment-configuration-kafka-mirror-maker">Healthchecks</a></h5>
<div class="paragraph">
<p>Use the <code>livenessProbe</code> and <code>readinessProbe</code> properties to configure healthcheck probes supported in Strimzi.</p>
</div>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.</p>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference">Probe schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-metrics-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-metrics-deployment-configuration-kafka-mirror-maker">Prometheus metrics</a></h5>
<div class="paragraph">
<p>Use the <code>metrics</code> property to enable and configure Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property can also contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.
Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and Zookeeper to Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="paragraph">
<p>When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics are disabled.</p>
</div>
<div class="paragraph">
<p>For more information about configuring Prometheus and Grafana, see <a href="#assembly-metrics-setup-str">Metrics</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-jvm-options-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-jvm-options-deployment-configuration-kafka-mirror-maker">JVM Options</a></h5>
<div class="paragraph">
<p>Use the <code>jvmOptions</code> property to configure supported options for the JVM on which the component is running.</p>
</div>
<div class="paragraph">
<p>Supported JVM options help to optimize performance for different platforms and architectures.</p>
</div>
<div class="paragraph">
<p>For more information on the supported options, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-configuring-container-images-deployment-configuration-kafka-mirror-maker"><a class="link" href="#con-configuring-container-images-deployment-configuration-kafka-mirror-maker">Container images</a></h5>
<div class="paragraph">
<p>Use the <code>image</code> property to configure the container image used by the component.</p>
</div>
<div class="paragraph">
<p>Overriding container images is recommended only in special situations where you need to use a different container registry or a customized image.</p>
</div>
<div class="paragraph">
<p>For example, if your network does not allow access to the container repository used by Strimzi, you can copy the Strimzi images or build them from the source.
However, if the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="paragraph">
<p>A copy of the container image might also be customized and used for debugging.</p>
</div>
<div class="paragraph">
<p>For more information see <a href="#ref-configuring-container-images-deployment-configuration-kafka">Container image configurations</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-mirror-maker-resources-deployment-configuration-kafka-mirror-maker"><a class="link" href="#ref-list-of-kafka-mirror-maker-resources-deployment-configuration-kafka-mirror-maker">3.4.3. List of resources created as part of Kafka Mirror Maker</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Deployment which is responsible for creating the Kafka Mirror Maker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-config</dt>
<dd>
<p>ConfigMap which contains ancillary configuration for the the Kafka Mirror Maker, and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Mirror Maker worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-bridge-str"><a class="link" href="#assembly-deployment-configuration-kafka-bridge-str">3.5. Kafka Bridge configuration</a></h3>
<div class="paragraph">
<p>The full schema of the <code>KafkaBridge</code> resource is described in the <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code> schema reference</a>.
All labels that are applied to the desired <code>KafkaBridge</code> resource will also be applied to the Kubernetes resources making up the Kafka Bridge cluster.
This provides a convenient mechanism for resources to be labeled as required.</p>
</div>
<div class="sect3">
<h4 id="assembly-kafka-bridge-replicas-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-kafka-bridge-replicas-deployment-configuration-kafka-bridge">3.5.1. Replicas</a></h4>
<div class="paragraph">
<p>Kafka Bridge can run multiple nodes.
The number of nodes is defined in the <code>KafkaBridge</code> resource.
Running a Kafka Bridge with multiple nodes can provide better availability and scalability.
However, when running Kafka Bridge on Kubernetes it is not absolutely necessary to run multiple nodes of Kafka Bridge for high availability.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If a node where Kafka Bridge is deployed to crashes, Kubernetes will automatically reschedule the Kafka Bridge pod to a different node.
In order to prevent issues arising when client consumer requests are processed by different Kafka Bridge instances, addressed-based routing must be employed to ensure that requests are routed to the right Kafka Bridge instance.
Additionally, each independent Kafka Bridge instance must have a replica. A Kafka Bridge instance has its own state which is not shared with another instances.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-bridge-replicas-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-bridge-replicas-deployment-configuration-kafka-bridge">Configuring the number of nodes</a></h5>
<div class="paragraph">
<p>The number of Kafka Bridge nodes is configured using the <code>replicas</code> property in <code>KafkaBridge.spec</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>replicas</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  replicas: 3
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-bridge-bootstrap-servers-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-kafka-bridge-bootstrap-servers-deployment-configuration-kafka-bridge">3.5.2. Bootstrap servers</a></h4>
<div class="paragraph">
<p>A Kafka Bridge always works in combination with a Kafka cluster.
A Kafka cluster is specified as a list of bootstrap servers.
On Kubernetes, the list must ideally contain the Kafka cluster bootstrap service named <code><em>cluster-name</em>-kafka-bootstrap</code>, and a port of 9092 for plain traffic or 9093 for encrypted traffic.</p>
</div>
<div class="paragraph">
<p>The list of bootstrap servers is configured in the <code>bootstrapServers</code> property in <code>KafkaBridge.kafka.spec</code>. The servers must be defined as a comma-separated list specifying one or more Kafka brokers, or a service pointing to Kafka brokers specified as a <code><em>hostname</em>:_port_</code> pairs.</p>
</div>
<div class="paragraph">
<p>When using Kafka Bridge with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the cluster.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-beridge-bootstrap-servers-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-beridge-bootstrap-servers-deployment-configuration-kafka-bridge">Configuring bootstrap servers</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>bootstrapServers</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  bootstrapServers: my-cluster-kafka-bootstrap:9092
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-bridge-tls-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-kafka-bridge-tls-deployment-configuration-kafka-bridge">3.5.3. Connecting to Kafka brokers using TLS</a></h4>
<div class="paragraph">
<p>By default, Kafka Bridge tries to connect to Kafka brokers using a plain text connection.
If you prefer to use TLS, additional configuration is required.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-bridge-tls-deployment-configuration-kafka-bridge"><a class="link" href="#ref-kafka-bridge-tls-deployment-configuration-kafka-bridge">TLS support for Kafka connection to the Kafka Bridge</a></h5>
<div class="paragraph">
<p>TLS support for Kafka connection is configured in the <code>tls</code> property in <code>KafkaBridge.spec.kafka</code>.
The <code>tls</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  tls:
    trustedCertificates:
    - secretName: my-secret
      certificate: ca.crt
    - secretName: my-other-secret
      certificate: certificate.crt
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple certificates are stored in the same secret, it can be listed multiple times.</p>
</div>
<div class="listingblock">
<div class="title">An example showing TLS configuration with multiple certificates from the same secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  tls:
    trustedCertificates:
    - secretName: my-secret
      certificate: ca.crt
    - secretName: my-secret
      certificate: ca2.crt
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-bridge-tls-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-bridge-tls-deployment-configuration-kafka-bridge">Configuring TLS in Kafka Bridge</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> for the certificate used for TLS Server Authentication, and the key under which the certificate is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the TLS certificate used in authentication in a file and create a <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The secrets created by the Cluster Operator for Kafka cluster may be used directly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-file.crt</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>tls</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  tls:
	  trustedCertificates:
	  - secretName: my-cluster-cluster-cert
	    certificate: ca.crt
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-bridge-authentication-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-kafka-bridge-authentication-deployment-configuration-kafka-bridge">3.5.4. Connecting to Kafka brokers with Authentication</a></h4>
<div class="paragraph">
<p>By default, Kafka Bridge will try to connect to Kafka brokers without authentication.
Authentication is enabled through the <code>KafkaBridge</code> resources.</p>
</div>
<div class="sect4">
<h5 id="con-kafka-bridge-authentication-deployment-configuration-kafka-bridge"><a class="link" href="#con-kafka-bridge-authentication-deployment-configuration-kafka-bridge">Authentication support in Kafka Bridge</a></h5>
<div class="paragraph">
<p>Authentication is configured through the <code>authentication</code> property in <code>KafkaBridge.spec.kafka</code>.
The <code>authentication</code> property specifies the type of the authentication mechanisms which should be used and additional configuration details depending on the mechanism.
The currently supported authentication types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS client authentication</p>
</li>
<li>
<p>SASL-based authentication using the SCRAM-SHA-512 mechanism</p>
</li>
<li>
<p>SASL-based authentication using the PLAIN mechanism</p>
</li>
<li>
<p><a href="#assembly-oauth-str">OAuth 2.0 token based authentication</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="tls_client_authentication_4"><a class="link" href="#tls_client_authentication_4">TLS Client Authentication</a></h6>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> property to the value <code>tls</code>.
TLS client authentication uses a TLS certificate to authenticate.
The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from an Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS client authentication can be used only with TLS connections.
For more details about TLS configuration in Kafka Bridge see <a href="#assembly-kafka-bridge-tls-deployment-configuration-kafka-bridge">Connecting to Kafka brokers using TLS</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example TLS client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: public.crt
      key: private.key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="scram_sha_512_authentication"><a class="link" href="#scram_sha_512_authentication">SCRAM-SHA-512 authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Bridge to use SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based SCRAM-SHA-512 client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: my-bridge-user
    passwordSecret:
      secretName: my-bridge-user
      password: my-bridge-password-key
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sasl_based_plain_authentication_3"><a class="link" href="#sasl_based_plain_authentication_3">SASL-based PLAIN authentication</a></h6>
<div class="paragraph">
<p>To configure Kafka Bridge to use SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
This authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password. The <code>secretName</code> property contains the name the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example showing SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
    type: plain
    username: my-bridge-user
    passwordSecret:
      secretName: my-bridge-user
      password: my-bridge-password-key
  # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-bridge-authentication-tls-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-bridge-authentication-tls-deployment-configuration-kafka-bridge">Configuring TLS client authentication in Kafka Bridge</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the public and private keys used for TLS Client Authentication, and the keys under which they are stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare the keys used for authentication in a file and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-public.crt</em> --from-file=<em>my-private.key</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
  type: tls
  certificateAndKey:
    secretName: my-secret
    certificate: my-public.crt
    key: my-private.key
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-bridge-authentication-scram-sha-512-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-bridge-authentication-scram-sha-512-deployment-configuration-kafka-bridge">Configuring SCRAM-SHA-512 authentication in Kafka Bridge</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>Username of the user which should be used for authentication</p>
</li>
<li>
<p>If they exist, the name of the <code>Secret</code> with the password used for authentication and the key under which the password is stored in the <code>Secret</code></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>(Optional) If they do not already exist, prepare a file with the password used in authentication and create the <code>Secret</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Secrets created by the User Operator may be used.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">echo -n '<em>&lt;password&gt;</em>' &gt; <em>&lt;my-password.txt&gt;</em>
kubectl create secret generic <em>&lt;my-secret&gt;</em> --from-file=<em>&lt;my-password.txt&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>authentication</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
    type: scram-sha-512
    username: _&lt;my-username&gt;_
    passwordSecret:
      secretName: _&lt;my-secret&gt;_
      password: _&lt;my-password.txt&gt;_
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-bridge-configuration-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-kafka-bridge-configuration-deployment-configuration-kafka-bridge">3.5.5. Kafka Bridge configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of Apache Kafka Bridge nodes by editing certain options listed in <a href="http://kafka.apache.org/20/documentation.html#newconsumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a> and <a href="http://kafka.apache.org/20/documentation.html#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a>.</p>
</div>
<div class="paragraph">
<p>Configuration options that can be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Consumer configuration</p>
</li>
<li>
<p>Producer configuration</p>
</li>
<li>
<p>HTTP configuration</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-kafka-bridge-consumer-configuration-deployment-configuration-kafka-bridge"><a class="link" href="#ref-kafka-bridge-consumer-configuration-deployment-configuration-kafka-bridge">Kafka Bridge Consumer configuration</a></h5>
<div class="paragraph">
<p>Kafka Bridge consumer is configured using the properties in <code>KafkaBridge.spec.consumer</code>.
This property contains the Kafka Bridge consumer configuration options as keys.
The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can specify and configure the options listed in the <a href="http://kafka.apache.org/20/documentation.html#newconsumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it will be ignored and a warning message will be printed to the Custer Operator log file.
All other options will be passed to Kafka</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaBridge.spec.consumer.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge consumer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  consumer:
    config:
      auto.offset.reset: earliest
      enable.auto.commit: true
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-kafka-bridge-producer-configuration-deployment-configuration-kafka-bridge"><a class="link" href="#ref-kafka-bridge-producer-configuration-deployment-configuration-kafka-bridge">Kafka Bridge Producer configuration</a></h5>
<div class="paragraph">
<p>Kafka Bridge producer is configured using the properties in <code>KafkaBridge.spec.producer</code>.
This property contains the Kafka Bridge producer configuration options as keys.
The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can specify and configure the options listed in the <a href="http://kafka.apache.org/20/documentation.html#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaBridge.spec.producer.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge producer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  producer:
    config:
      acks: 1
      delivery.timeout.ms: 300000
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-kafka-bridge-http-configuration-deployment-configuration-kafka-bridge"><a class="link" href="#ref-kafka-bridge-http-configuration-deployment-configuration-kafka-bridge">Kafka Bridge HTTP configuration</a></h5>
<div class="paragraph">
<p>Kafka Bridge HTTP configuration is set using the properties in <code>KafkaBridge.spec.http</code>.
This property contains the Kafka Bridge HTTP configuration options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>port</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge HTTP configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  http:
    port: 8080
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-bridge-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-kafka-bridge-deployment-configuration-kafka-bridge">Configuring Kafka Bridge</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>kafka</code>, <code>http</code>, <code>consumer</code> or <code>producer</code> property in the <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  bootstrapServers: my-cluster-kafka:9092
  http:
    port: 8080
  consumer:
    config:
      auto.offset.reset: earliest
  producer:
    config:
      delivery.timeout.ms: 300000
  # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-resource-limits-and-requests-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-bridge">3.5.6. CPU and memory resources</a></h4>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports two types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU</p>
</li>
<li>
<p>Memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying CPU and memory resources.</p>
</div>
<div class="sect4">
<h5 id="ref-resource-limits-and-requests-deployment-configuration-kafka-bridge"><a class="link" href="#ref-resource-limits-and-requests-deployment-configuration-kafka-bridge">Resource limits and requests</a></h5>
<div class="paragraph">
<p>Resource limits and requests are configured using the <code>resources</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="resource_requests_4"><a class="link" href="#resource_requests_4">Resource requests</a></h6>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resources requests are specified in the <code>requests</code> property.
Resources requests currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource request configuration with all resources</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="resource_limits_4"><a class="link" href="#resource_limits_4">Resource limits</a></h6>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>Resource limits are specified in the <code>limits</code> property.
Resource limits currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="listingblock">
<div class="title">Example resource limits configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  limits:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="supported_cpu_formats_4"><a class="link" href="#supported_cpu_formats_4">Supported CPU formats</a></h6>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="supported_memory_formats_4"><a class="link" href="#supported_memory_formats_4">Supported memory formats</a></h6>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-resource-limits-and-requests-deployment-configuration-kafka-bridge">Configuring resource requests and limits</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>resources</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    resources:
      requests:
        cpu: "8"
        memory: 64Gi
      limits:
        cpu: "12"
        memory: 128Gi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="#type-ResourceRequirements-reference"><code>Resources</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-logging-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-logging-deployment-configuration-kafka-bridge">3.5.7. Logging</a></h4>
<div class="paragraph">
<p>This section provides information on loggers and how to configure log levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the loggers and their levels directly (inline) or use a custom (external) config map.</p>
</div>
<div class="sect4">
<h5 id="ref-loggers-KafkaBridge-deployment-configuration-kafka-bridge"><a class="link" href="#ref-loggers-KafkaBridge-deployment-configuration-kafka-bridge">Kafka Bridge loggers</a></h5>
<div class="paragraph">
<p>Kafka Bridge has configurable loggers for each OpenAPI operation:
Loggers are formatted as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">log4j.logger.http.openapi.operation.&lt;operation-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;operation-id&gt;</code> is the identifier of the specific operation.
Following is the list of operations defined by the OpenAPI specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createConsumer</code></p>
</li>
<li>
<p><code>deleteConsumer</code></p>
</li>
<li>
<p><code>subscribe</code></p>
</li>
<li>
<p><code>unsubscribe</code></p>
</li>
<li>
<p><code>poll</code></p>
</li>
<li>
<p><code>assign</code></p>
</li>
<li>
<p><code>commit</code></p>
</li>
<li>
<p><code>send</code></p>
</li>
<li>
<p><code>sendToPartition</code></p>
</li>
<li>
<p><code>seekToBeginning</code></p>
</li>
<li>
<p><code>seekToEnd</code></p>
</li>
<li>
<p><code>seek</code></p>
</li>
<li>
<p><code>healthy</code></p>
</li>
<li>
<p><code>ready</code></p>
</li>
<li>
<p><code>openapi</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="kafka-inline-logging-deployment-configuration-kafka-bridge"><a class="link" href="#kafka-inline-logging-deployment-configuration-kafka-bridge">Specifying inline logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the loggers and logging level for the required components.</p>
<div class="paragraph">
<p>For example, the logging level here is set to INFO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
spec:
  # ...
  logging:
    type: inline
    loggers:
      <em>logger.name</em>: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</div>
<div class="paragraph">
<p>For more information about the log levels, see the <a href="https://logging.apache.org/log4j/2.x/manual/customloglevels.html" target="_blank" rel="noopener">log4j manual</a>.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="kafka-external-logging-deployment-configuration-kafka-bridge"><a class="link" href="#kafka-external-logging-deployment-configuration-kafka-bridge">Specifying an external ConfigMap for logging</a></h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the YAML file to specify the name of the <code>ConfigMap</code> to use for the required components. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to place your custom ConfigMap under the <code>log4j.properties</code> or <code>log4j2.properties</code> key.</p>
</div>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on GC, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jvm-options-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-jvm-options-deployment-configuration-kafka-bridge">3.5.8. JVM Options</a></h4>
<div class="paragraph">
<p>The following components of Strimzi run inside a Virtual Machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache Zookeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka Mirror Maker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JVM configuration options optimize the performance for different platforms and architectures.
Strimzi allows you to configure some of these options.</p>
</div>
<div class="sect4">
<h5 id="ref-jvm-options-deployment-configuration-kafka-bridge"><a class="link" href="#ref-jvm-options-deployment-configuration-kafka-bridge">JVM configuration</a></h5>
<div class="paragraph">
<p>JVM options can be configured using the <code>jvmOptions</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only a selected subset of available JVM options can be configured.
The following options are supported:</p>
</div>
<div class="paragraph">
<div class="title">-Xms and -Xmx</div>
<p><code>-Xms</code> configures the minimum initial allocation heap size when the JVM starts.
<code>-Xmx</code> configures the maximum heap size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings such as <code>-Xmx</code> and <code>-Xms</code> are those accepted by the JDK <code>java</code> binary in the corresponding image.
Accordingly, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is in contrast to the units used for <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-bridge">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default values used for <code>-Xms</code> and <code>-Xmx</code> depends on whether there is a <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka-bridge">memory request</a> limit configured for the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a memory limit then the JVM&#8217;s minimum and maximum memory will be set to a value corresponding to the limit.</p>
</li>
<li>
<p>If there is no memory limit then the JVM&#8217;s minimum memory will be set to <code>128M</code> and the JVM&#8217;s maximum memory will not be defined.  This allows for the JVM&#8217;s memory to grow as-needed, which is ideal for single node environments in test and development.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>-Xmx</code> explicitly requires some care:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JVM&#8217;s overall memory usage will be approximately 4  the maximum heap, as configured by <code>-Xmx</code>.</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory limit, it is possible that the container will be killed should the Kubernetes node experience memory pressure (from other Pods running on it).</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory request, it is possible that the container will be scheduled to a node with insufficient memory.
In this case, the container will not start but crash (immediately if <code>-Xms</code> is set to <code>-Xmx</code>, or some later time if not).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting <code>-Xmx</code> explicitly, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the memory request and the memory limit to the same value,</p>
</li>
<li>
<p>use a memory request that is at least 4.5  the <code>-Xmx</code>,</p>
</li>
<li>
<p>consider setting <code>-Xms</code> to the same value as <code>-Xmx</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers doing lots of disk I/O (such as Kafka broker containers) will need to leave some memory available for use as operating system page cache.
On such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-Xmx</code> and <code>-Xms</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the JVM will use 2 GiB (=2,147,483,648 bytes) for its heap.
Its total memory usage will be approximately 8GiB.</p>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.
For Kafka and Zookeeper pods such allocation could cause unwanted latency.
For Kafka Connect avoiding over allocation may be the most important concern, especially in distributed mode where the effects of over-allocation will be multiplied by the number of consumers.</p>
</div>
<div class="paragraph">
<div class="title">-server</div>
<p><code>-server</code> enables the server JVM. This option can be set to true or false.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-server</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-server": true
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">-XX</div>
<p><code>-XX</code> object can be used for configuring advanced runtime options of a JVM.
The <code>-server</code> and <code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the use of the <code>-XX</code> object</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true
    "UseParNewGC": false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example configuration above will result in the following JVM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) is specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> will be used.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="garbage_collector_logging_4"><a class="link" href="#garbage_collector_logging_4">Garbage collector logging</a></h6>
<div class="paragraph">
<p>The <code>jvmOptions</code> section also allows you to enable and disable garbage collector (GC) logging.
GC logging is enabled by default.
To disable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example of disabling GC logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  gcLoggingEnabled: false
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-jvm-options-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-jvm-options-deployment-configuration-kafka-bridge">Configuring JVM options</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>jvmOptions</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jvmOptions:
      "-Xmx": "8g"
      "-Xms": "8g"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-healthchecks-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-healthchecks-deployment-configuration-kafka-bridge">3.5.9. Healthchecks</a></h4>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>Kubernetes supports two types of Healthcheck probes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Liveness probes</p>
</li>
<li>
<p>Readiness probes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.
Both types of probes are used in Strimzi components.</p>
</div>
<div class="paragraph">
<p>Users can configure selected options for liveness and readiness probes.</p>
</div>
<div class="sect4">
<h5 id="ref-healthchecks-deployment-configuration-kafka-bridge"><a class="link" href="#ref-healthchecks-deployment-configuration-kafka-bridge">Healthcheck configurations</a></h5>
<div class="paragraph">
<p>Liveness and readiness probes can be configured using the <code>livenessProbe</code> and <code>readinessProbe</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.KafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference"><code>Probe</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-healthchecks-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-healthchecks-deployment-configuration-kafka-bridge">Configuring healthchecks</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>livenessProbe</code> or <code>readinessProbe</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-container-images-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-configuring-container-images-deployment-configuration-kafka-bridge">3.5.10. Container images</a></h4>
<div class="paragraph">
<p>Strimzi allows you to configure container images which will be used for its components.
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such a case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="sect4">
<h5 id="ref-configuring-container-images-deployment-configuration-kafka-bridge"><a class="link" href="#ref-configuring-container-images-deployment-configuration-kafka-bridge">Container image configurations</a></h5>
<div class="paragraph">
<p>Container image which should be used for given components can be specified using the <code>image</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="configuring_the_kafka_spec_kafka_image_property_4"><a class="link" href="#configuring_the_kafka_spec_kafka_image_property_4">Configuring the <code>Kafka.spec.kafka.image</code> property</a></h6>
<div class="paragraph">
<p>The <code>Kafka.spec.kafka.image</code> property functions differently from the others, because Strimzi supports multiple versions of Kafka, each requiring the own image.
The <code>STRIMZI_KAFKA_IMAGES</code> environment variable of the Cluster Operator configuration is used to provide a mapping between Kafka versions and the corresponding images.
This is used in combination with the <code>Kafka.spec.kafka.image</code> and <code>Kafka.spec.kafka.version</code> properties as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>Kafka.spec.kafka.image</code> nor <code>Kafka.spec.kafka.version</code> are given in the custom resource then the <code>version</code> will default to the  Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is given but <code>Kafka.spec.kafka.version</code> is not then the given image will be used and the <code>version</code> will be assumed to be the  Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.version</code> is given but <code>Kafka.spec.kafka.image</code> is not then image will be the one corresponding to this version in the <code>STRIMZI_KAFKA_IMAGES</code>.</p>
</li>
<li>
<p>Both <code>Kafka.spec.kafka.version</code> and <code>Kafka.spec.kafka.image</code> are given the given image will be used, and it will be assumed to contain a Kafka broker with the given version.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is best to provide just <code>Kafka.spec.kafka.version</code> and leave the <code>Kafka.spec.kafka.image</code> property unspecified.
This reduces the chances of making a mistake in configuring the <code>Kafka</code> resource. If you need to change the images used for different versions of Kafka, it is better to configure the Cluster Operator&#8217;s <code>STRIMZI_KAFKA_IMAGES</code> environment variable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configuring_the_image_property_in_other_resources_4"><a class="link" href="#configuring_the_image_property_in_other_resources_4">Configuring the <code>image</code> property in other resources</a></h6>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka broker TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper nodes:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Zookeeper node TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ZOOKEEPER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Connect with Source2image support:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_CONNECT_S2I_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:latest-kafka-2.3.0</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such case, you should either copy the Strimzi images or build them from source.
In case the configured image is not compatible with Strimzi images, it might not work properly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-container-images-deployment-configuration-kafka-bridge"><a class="link" href="#proc-configuring-container-images-deployment-configuration-kafka-bridge">Configuring container images</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>image</code> property in the <code>Kafka</code>, <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-scheduling-deployment-configuration-kafka-bridge"><a class="link" href="#assembly-scheduling-deployment-configuration-kafka-bridge">3.5.11. Configuring pod scheduling</a></h4>
<div id="con-scheduling-deployment-configuration-kafka-bridge" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-bridge-scheduling-based-on-pods"><a class="link" href="#assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-bridge-scheduling-based-on-pods">Scheduling pods based on other applications</a></h5>
<div class="sect5">
<h6 id="con-scheduling-based-on-other-pods-deployment-configuration-kafka-bridge-scheduling-based-on-pods"><a class="link" href="#con-scheduling-based-on-other-pods-deployment-configuration-kafka-bridge-scheduling-based-on-pods">Avoid critical applications to share the node</a></h6>
<div class="paragraph">
<p>Pod anti-affinity can be used to ensure that critical applications are never scheduled on the same disk.
When running Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share the nodes with other workloads like databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-bridge-scheduling-based-on-pods"><a class="link" href="#affinity-deployment-configuration-kafka-bridge-scheduling-based-on-pods">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-bridge-scheduling-based-on-pods"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-bridge-scheduling-based-on-pods">Configuring pod anti-affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-node-scheduling-deployment-configuration-kafka-bridge-node-scheduling"><a class="link" href="#assembly-node-scheduling-deployment-configuration-kafka-bridge-node-scheduling">Scheduling pods to specific nodes</a></h5>
<div class="sect5">
<h6 id="con-scheduling-to-specific-nodes-deployment-configuration-kafka-bridge-node-scheduling"><a class="link" href="#con-scheduling-to-specific-nodes-deployment-configuration-kafka-bridge-node-scheduling">Node scheduling</a></h6>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-bridge-node-scheduling"><a class="link" href="#affinity-deployment-configuration-kafka-bridge-node-scheduling">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-configuring-node-affinity-deployment-configuration-kafka-bridge-node-scheduling"><a class="link" href="#proc-configuring-node-affinity-deployment-configuration-kafka-bridge-node-scheduling">Configuring node affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-dedidcated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes"><a class="link" href="#assembly-dedidcated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes">Using dedicated nodes</a></h5>
<div class="sect5">
<h6 id="con-dedicated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes"><a class="link" href="#con-dedicated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes">Dedicated nodes</a></h6>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Taints can be used to create dedicated nodes.
Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
<div class="paragraph">
<p>To schedule Kafka pods on the dedicated nodes, configure <a href="#affinity-deployment-configuration-kafka-bridge-dedicated-nodes">node affinity</a> and <a href="#tolerations-deployment-configuration-kafka-bridge-dedicated-nodes">tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-bridge-dedicated-nodes"><a class="link" href="#affinity-deployment-configuration-kafka-bridge-dedicated-nodes">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="tolerations-deployment-configuration-kafka-bridge-dedicated-nodes"><a class="link" href="#tolerations-deployment-configuration-kafka-bridge-dedicated-nodes">Tolerations</a></h6>
<div class="paragraph">
<p>Tolerations can be configured using the <code>tolerations</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>tolerations</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-dedicated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes"><a class="link" href="#proc-dedicated-nodes-deployment-configuration-kafka-bridge-dedicated-nodes">Setting up dedicated nodes and scheduling pods on them</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl taint node <em>your-node</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-bridge-resources-deployment-configuration-kafka-bridge"><a class="link" href="#ref-list-of-kafka-bridge-resources-deployment-configuration-kafka-bridge">3.5.12. List of resources created as part of Kafka Bridge cluster</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Bridge worker node pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-service</dt>
<dd>
<p>Service which exposes the REST interface of the Kafka Bridge cluster.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Bridge ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Bridge worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-oauth-str"><a class="link" href="#assembly-oauth-str">3.6. Using OAuth 2.0 token based authentication</a></h3>
<div class="paragraph">
<p>Strimzi supports the use of OAuth 2.0 authentication using the <em>SASL OAUTHBEARER</em> mechanism.</p>
</div>
<div class="paragraph">
<p>OAuth 2.0 enables standardized token based authentication and authorization between applications, using a central authorization server to issue tokens that grant limited access to resources.</p>
</div>
<div class="paragraph">
<p>OAuth 2.0 is currently only supported for authentication, with no authorization support.
However, OAuth 2.0 authentication can be used in conjunction with <a href="#simple-acl-using-uo">ACL-based Kafka authorization</a>.</p>
</div>
<div class="paragraph">
<p>Using OAuth 2.0 token based authentication, application clients can access resources on application servers (called resource servers) without exposing account credentials.
The client passes an access token as a means of authenticating, which application servers can also use to find more information about the level of access granted.
The authorization server handles the granting of access and inquiries about access.</p>
</div>
<div class="paragraph">
<p>In the context of Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka brokers act as resource servers</p>
</li>
<li>
<p>Kafka clients act as resource clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The brokers and clients communicate with the OAuth 2.0 authorization server, as necessary, to obtain or validate access tokens.</p>
</div>
<div class="paragraph">
<p>For a deployment of Strimzi, OAuth 2.0 integration provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server-side OAuth 2.0 support for Kafka brokers</p>
</li>
<li>
<p>Client-side OAuth 2.0 support for Kafka Mirror Maker, Kafka Connect and the Kafka Bridge</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://oauth.net/2/" target="_blank" rel="noopener">OAuth 2.0 site</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-flow-str"><a class="link" href="#con-oauth-authentication-flow-str">3.6.1. OAuth 2.0 authentication mechanism</a></h4>
<div class="paragraph">
<p>Support for OAuth 2.0 is based on the Kafka <em>SASL OAUTHBEARER</em> mechanism, which is used to establish authenticated sessions with a Kafka broker.</p>
</div>
<div class="paragraph">
<p>A Kafka client initiates a session with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism for credentials exchange, where credentials take the form of an access token.</p>
</div>
<div class="paragraph">
<p>Kafka brokers and clients need to be configured to use OAuth 2.0.</p>
</div>
<div class="paragraph">
<div class="title">Kafka broker configuration</div>
<p>The Kafka broker must be configured to validate the token received during session initiation.
The recommended approach is to create a <em>client</em> definition in an authorization server with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID of <code>kafka-broker</code></p>
</li>
<li>
<p>Client ID and secret as the authentication mechanism</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Kafka client configuration</div>
<p>A Kafka client is configured with either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Credentials required to obtain a valid access token from an authorization server</p>
</li>
<li>
<p>A valid long-lived access token, obtained using tools provided by an authorization server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Credentials are never sent to the Kafka broker.
The only information ever sent to the Kafka broker is an access token.
When a client obtains an access token, no further communication with the authorization server is needed.</p>
</div>
<div class="paragraph">
<p>The simplest mechanism, which requires no additional usage of authorization server tools, is authentication with a client ID and secret.
Using a long-lived access token, or a long-lived refresh token, is more complex.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using long-lived access tokens, you can set policy in the authorization server to increase the maximum lifetime of the token.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the Kafka client is not configured with an access token directly, the client exchanges credentials for an access token during Kafka session initiation by contacting the authorization server.
The Kafka client uses one of two mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client id and secret</p>
</li>
<li>
<p>Client id, refresh token, and (optionally) a secret</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-client-options-str"><a class="link" href="#con-oauth-authentication-client-options-str">3.6.2. OAuth 2.0 client authentication flow</a></h4>
<div class="paragraph">
<p>In this section, we explain and visualize the communication flow between Kafka client, Kafka broker, and authorization server during Kafka session initiation.
The flow depends on the client and server configuration.</p>
</div>
<div class="paragraph">
<p>When a Kafka client sends an access token as credentials to a Kafka broker, the token needs to be validated.</p>
</div>
<div class="paragraph">
<p>Depending on the authorization server used, and the configuration options available, you may prefer to use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast local token validation based on JWT signature checking and local token introspection, without contacting the authorization server</p>
</li>
<li>
<p>An OAuth 2.0 introspection endpoint provided by the authorization server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using fast local token validation requires the authorization server to provide a JWKS endpoint with public certificates that are used to validate signatures on the tokens.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An authorization server might only allow the use of opaque access tokens, which means that local token validation is not possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another option is to use an OAuth 2.0 introspection endpoint on the authorization server.
Each time a Kafka broker connection is established, the broker sends the access token it receives to the authorization server, and a response confirming whether or not the token is valid is returned.</p>
</div>
<div class="paragraph">
<p>Kafka client credentials can also be configured for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct local access using a previously generated long-lived access token</p>
</li>
<li>
<p>Contact with the authorization server for a new access token to be issued and sent to the Kafka broker</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="example_client_authentication_flows"><a class="link" href="#example_client_authentication_flows">Example client authentication flows</a></h5>
<div class="paragraph">
<p>Here you can see the communication flows, for different configurations of Kafka clients and brokers, during Kafka session authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#oauth-introspection-endpoint-str">Client using client ID and secret, with broker delegating validation to authorization server</a></p>
</li>
<li>
<p><a href="#oauth-jwt-str">Client using client ID and secret, with broker performing fast local token validation</a></p>
</li>
<li>
<p><a href="#oauth-token-endpoint-str">Client using long-lived access token, with broker delegating validation to authorization server</a></p>
</li>
<li>
<p><a href="#oauth-token-jwt-str">Client using long-lived access token, with broker performing fast local validation</a></p>
</li>
</ul>
</div>
<div id="oauth-introspection-endpoint-str" class="paragraph">
<div class="title">Client using client ID and secret, with broker delegating validation to authorization server</div>
<p><span class="image"><img src="images/oauth-introspection-endpoint.png" alt="Client using client ID and secret with broker delegating validation to authorization server"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client requests access token from authorization server, using client ID and secret, and optionally a refresh token.</p>
</li>
<li>
<p>Authorization server generates a new access token.</p>
</li>
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the access token.</p>
</li>
<li>
<p>Kafka broker validates the access token by calling a token introspection endpoint on authorization server, using its own client ID and secret.</p>
</li>
<li>
<p>Kafka client session is established if the token is valid.</p>
</li>
</ol>
</div>
<div id="oauth-jwt-str" class="paragraph">
<div class="title">Client using client ID and secret, with broker performing fast local token validation</div>
<p><span class="image"><img src="images/oauth-jwt-signature.png" alt="Client using client ID and secret with broker performing fast local token validation"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with authorization server from the token endpoint, using a client ID and secret, and optionally a refresh token.</p>
</li>
<li>
<p>Authorization server generates a new access token.</p>
</li>
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the access token.</p>
</li>
<li>
<p>Kafka broker validates the access token locally using a JWT token signature check, and local token introspection.</p>
</li>
</ol>
</div>
<div id="oauth-token-endpoint-str" class="paragraph">
<div class="title">Client using long-lived access token, with broker delegating validation to authorization server</div>
<p><span class="image"><img src="images/oauth-introspection-endpoint-long-token.png" alt="Client using long-lived access token with broker delegating validation to authorization server"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the long-lived access token.</p>
</li>
<li>
<p>Kafka broker validates the access token by calling a token introspection endpoint on authorization server, using its own client ID and secret.</p>
</li>
<li>
<p>Kafka client session is established if the token is valid.</p>
</li>
</ol>
</div>
<div id="oauth-token-jwt-str" class="paragraph">
<div class="title">Client using long-lived access token, with broker performing fast local validation</div>
<p><span class="image"><img src="images/oauth-jwt-signature-token.png" alt="Client using long-lived access token with broker performing fast local validation"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the long-lived access token.</p>
</li>
<li>
<p>Kafka broker validates the access token locally using JWT token signature check, and local token introspection.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Fast local JWT token signature validation is suitable only for short-lived tokens as there is no check with the authorization server if a token has been revoked.
Token expiration is written into the token, but revocation can happen at any time, so cannot be accounted for without contacting the authorization server.
Any issued token would be considered valid until it expires.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-strimzi-config-str"><a class="link" href="#con-oauth-strimzi-config-str">3.6.3. Configuring OAuth 2.0 authentication</a></h4>
<div class="paragraph">
<p>OAuth 2.0 is used for interaction between Kafka clients and Strimzi components.</p>
</div>
<div class="paragraph">
<p>In order to use OAuth 2.0 for Strimzi, you must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#proc-oauth-server-config-str">Deploy an authorization server and configure the deployment to integrate with Strimzi</a></p>
</li>
<li>
<p><a href="#proc-oauth-broker-config-str">Deploy or update the Kafka cluster with Kafka broker listeners configured to use OAuth 2.0</a></p>
</li>
<li>
<p><a href="#proc-oauth-client-config-str">Update your Java-based Kafka clients to use OAuth 2.0</a></p>
</li>
<li>
<p><a href="#proc-oauth-kafka-config-str">Update Kafka component clients to use OAuth 2.0</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="proc-oauth-server-config-str"><a class="link" href="#proc-oauth-server-config-str">Configuring an OAuth 2.0 authorization server</a></h5>
<div class="paragraph">
<p>This procedure describes in general what you need to do to configure an authorization server for integration with Strimzi.</p>
</div>
<div class="paragraph">
<p>These instructions are not product specific.</p>
</div>
<div class="paragraph">
<p>The steps are dependent on the chosen authorization server.
Consult the product documentation for the authorization server for information on how to set up OAuth 2.0 access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you already have an authorization server deployed, you can skip the deployment step and use your current deployment.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy the authorization server to your cluster.</p>
</li>
<li>
<p>Access the CLI or admin console for the authorization server to configure OAuth 2.0 for Strimzi.</p>
<div class="paragraph">
<p>Now prepare the authorization server to work with Strimzi.</p>
</div>
</li>
<li>
<p>Configure a <code>kafka-broker</code> client.</p>
</li>
<li>
<p>Configure clients for each Kafka client component of your application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After deploying and configuring the authorization server, <a href="#proc-oauth-broker-config-str">configure the Kafka brokers to use OAuth 2.0</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-broker-config-str"><a class="link" href="#proc-oauth-broker-config-str">Configuring OAuth 2.0 support for Kafka brokers</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka brokers so that the broker listeners are enabled to use OAuth 2.0 authentication using an authorization server.</p>
</div>
<div class="paragraph">
<p>If the authorization server is using certificates signed by the trusted CA and matching the OAuth 2.0 server hostname, TLS connection works using the default settings.
Otherwise, you have two connection options for your external listener configuration when delegating token validation to the authorization server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>TLS connection to the authorization server with trusted certificates</p>
</li>
<li>
<p>Direct connection using an introspection endpoint configuration</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Both options are described in this procedure.</p>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>For more information on the configuration and authentication of Kafka broker listeners, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">Kafka broker listeners</a></p>
</li>
<li>
<p><a href="#assembly-kafka-authentication-and-authorization-deployment-configuration-kafka">Authentication and Authorization</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka broker configuration (<code>Kafka.spec.kafka</code>) of your <code>Kafka</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka my-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Kafka broker <code>listeners</code> configuration.</p>
<div class="paragraph">
<p>The configuration for each type of listener does not have to be the same, as they are independent.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
   authentication:
     type: oauth <b class="conum">(1)</b>
     validIssuerUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/master</em>&gt; <b class="conum">(2)</b>
     jwksEndpointUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/master/protocol/openid-connect/certs</em>&gt; <b class="conum">(3)</b>
     userNameClaim: preferred_username <b class="conum">(4)</b>

#external configuration
 external:
   type: loadbalancer

   //Option 1
   authentication: <b class="conum">(5)</b>
     type: oauth
     validIssuerUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/external</em>&gt;
     jwksEndpointUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/external/protocol/openid-connect/certs</em>&gt;
     userNameClaim: preferred_username
     tlsTrustedCertificates: <b class="conum">(6)</b>
     - secretName: oauth-server-cert
       certificate: ca.crt
   disableTlsHostnameVerification: true <b class="conum">(7)</b>

   //Option 2
   authentication: <b class="conum">(8)</b>
     type: oauth
     validIssuerUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/external</em>&gt;
     introspectionEndpointUri: &lt;<em>https://&lt;authorization-server-address&gt;/auth/realms/external/protocol/openid-connect/token/introspect</em>&gt;
     clientId: kafka-broker
     clientSecret:
       secretName: my-cluster-oauth
       key: clientSecret</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Listener type set to <code>oauth</code>.</p>
</li>
<li>
<p>URI of the token issuer used for authentication.</p>
</li>
<li>
<p>URI of the JWKS certificate endpoint used for local JWT validation.</p>
</li>
<li>
<p>The user name profile claim (or key) that contains the actual user name in the token. The user name is the <em>principal</em> used to identify the user. The <code>userNameClaim</code> value will depend on the authentication flow and the authorization server used.</p>
</li>
<li>
<p>OPTION 1: TLS connection to the authorization server.</p>
</li>
<li>
<p>(Optional) Trusted certificates for TLS connection to the authorization server.</p>
</li>
<li>
<p>Enable TLS hostname verification. Default is <code>false</code>.</p>
</li>
<li>
<p>OPTION 2: Introspection endpoint to connect directly to the authorization server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save and exit the editor, then wait for rolling updates to complete.</p>
</li>
<li>
<p>Check the update in the logs or by watching the pod state transitions:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl logs -f ${POD_NAME} -c ${CONTAINER_NAME}
kubectl get po -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rolling update configures the brokers to use OAuth 2.0 authentication.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">What to do next</div>
<ul>
<li>
<p><a href="#proc-oauth-client-config-str">Configure your Kafka clients to use OAuth 2.0</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-client-config-str"><a class="link" href="#proc-oauth-client-config-str">Configuring Kafka Java clients to use OAuth 2.0</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka producer and consumer APIs to use OAuth 2.0 for interaction with Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Add a client callback plugin to your <em>pom.xml</em> file, and configure the system properties.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed and configured for OAuth access to Kafka brokers</p>
</li>
<li>
<p>Kafka brokers are configured for OAuth 2.0</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the client library with OAuth 2.0 support to the <code>pom.xml</code> file for the Kafka client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
 &lt;groupId&gt;io.strimzi&lt;/groupId&gt;
 &lt;artifactId&gt;kafka-oauth-client&lt;/artifactId&gt;
 &lt;version&gt;0.1.0.redhat-00002&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the system properties for the callback:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">System.setProperty(ClientConfig.OAUTH_TOKEN_ENDPOINT_URI, <em>https://&lt;authorization-server-address&gt;/auth/realms/master/protocol/openid-connect/token</em>); <b class="conum">(1)</b>
System.setProperty(ClientConfig.OAUTH_CLIENT_ID, "<em>&lt;client-name&gt;</em>"); <b class="conum">(2)</b>
System.setProperty(ClientConfig.OAUTH_CLIENT_SECRET, "<em>&lt;client-secret&gt;</em>"); <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>URI of the authorization server token endpoint.</p>
</li>
<li>
<p>Client ID, which is the name used when creating the <em>client</em> in the authorization server.</p>
</li>
<li>
<p>Client secret created when creating the <em>client</em> in the authorization server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enable the <em>SASL OAUTHBEARER</em> mechanism on a TLS encrypted connection in the Kafka client configuration:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">props.put("sasl.jaas.config", "org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required;");
props.put("security.protocol", "SASL_SSL"); <b class="conum">(1)</b>
props.put("sasl.mechanism", "OAUTHBEARER");
props.put("sasl.login.callback.handler.class", "io.strimzi.kafka.oauth.client.JaasClientOauthLoginCallbackHandler");</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here we use <code>SASL_SSL</code> for use over TLS connections. Use <code>SASL_PLAINTEXT</code> over unencrypted connections.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify that the Kafka client can access the Kafka brokers.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">What to do next</div>
<ul>
<li>
<p><a href="#proc-oauth-kafka-config-str">Configure Kafka components to use OAuth 2.0</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-kafka-config-str"><a class="link" href="#proc-oauth-kafka-config-str">Configuring OAuth for Kafka components</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka components to use OAuth 2.0 authentication using an authorization server.</p>
</div>
<div class="paragraph">
<p>You can configure authentication for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Connect</p>
</li>
<li>
<p>Kafka Mirror Maker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this scenario, the Kafka component and the authorization server are running in the same cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed and configured for OAuth access to Kafka brokers</p>
</li>
<li>
<p>Kafka brokers are configured for OAuth 2.0</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a client secret and mount it to the component as an environment variable.</p>
<div class="paragraph">
<p>For example, here we are creating a client <code>Secret</code> for the Kafka Bridge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Secret
metadata:
 name: my-bridge-oauth
type: Opaque
data:
 clientSecret: MGQ1OTRmMzYtZTllZS00MDY2LWI5OGEtMTM5MzM2NjdlZjQw <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>clientSecret</code> key must be in base64 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or edit the resource for the Kafka component so that OAuth 2.0 authentication is configured for the authentication property.</p>
<div class="paragraph">
<p>For example, here OAuth 2.0 is assigned to the Kafka Bridge client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
   type: oauth <b class="conum">(1)</b>
   tokenEndpointUri: https://&lt;authorization-server-address&gt;/auth/realms/master/protocol/openid-connect/token <b class="conum">(2)</b>
   clientId: kafka-bridge
   clientSecret:
     secretName: my-bridge-oauth
     key: clientSecret
   tlsTrustedCertificates: <b class="conum">(3)</b>
     - secretName: oauth-server-cert
     certificate: tls.crt</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Authentication type set to <code>oauth</code>.</p>
</li>
<li>
<p>URI of the token endpoint for authentication.</p>
</li>
<li>
<p>Trusted certificates for TLS connection to the authorization server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the changes to the deployment of your Kafka resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">oc apply -f your-file</code></pre>
</div>
</div>
</li>
<li>
<p>Check the update in the logs or by watching the pod state transitions:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kubectl logs -f ${POD_NAME} -c ${CONTAINER_NAME}
kubectl get pod -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rolling updates configure the component for interaction with Kafka brokers using OAuth 2.0 authentication.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-customizing-deployments-str"><a class="link" href="#assembly-customizing-deployments-str">3.7. Customizing deployments</a></h3>
<div class="paragraph">
<p>Strimzi creates several Kubernetes resources, such as <code>Deployments</code>, <code>StatefulSets</code>, <code>Pods</code>, and <code>Services</code>, which are managed by Kubernetes operators.
Only the operator that is responsible for managing a particular Kubernetes resource can change that resource.
If you try to manually change an operator-managed Kubernetes resource, the operator will revert your changes back.</p>
</div>
<div class="paragraph">
<p>However, changing an operator-managed Kubernetes resource can be useful if you want to perform certain tasks, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding custom labels or annotations that control how <code>Pods</code> are treated by Istio or other services;</p>
</li>
<li>
<p>Managing how <code>Loadbalancer</code>-type Services are created by the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can make these types of changes using the <code>template</code> property in the Strimzi custom resources.</p>
</div>
<div class="sect3">
<h4 id="con-customizing-template-properties-str"><a class="link" href="#con-customizing-template-properties-str">3.7.1. Template properties</a></h4>
<div class="paragraph">
<p>You can use the <code>template</code> property to configure aspects of the resource creation process.
You can include it in the following resources and properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.kafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMakerSpec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, the <code>template</code> property is used to modify the labels in a Kafka broker&#8217;s <code>StatefulSet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
  labels:
    app: my-cluster
spec:
  kafka:
    # ...
    template:
      statefulset:
        metadata:
          labels:
            mylabel: myvalue
    # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_a_kafka_cluster"><a class="link" href="#supported_template_properties_for_a_kafka_cluster">Supported template properties for a Kafka cluster</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>statefulset</code></dt>
<dd>
<p>Configures the <code>StatefulSet</code> used by the Kafka broker.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Kafka broker <code>Pods</code> created by the <code>StatefulSet</code>.</p>
</dd>
<dt class="hdlist1"><code>bootstrapService</code></dt>
<dd>
<p>Configures the bootstrap service used by clients running within Kubernetes to connect to the Kafka broker.</p>
</dd>
<dt class="hdlist1"><code>brokersService</code></dt>
<dd>
<p>Configures the headless service.</p>
</dd>
<dt class="hdlist1"><code>externalBootstrapService</code></dt>
<dd>
<p>Configures the bootstrap service used by clients connecting to Kafka brokers from outside of Kubernetes.</p>
</dd>
<dt class="hdlist1"><code>perPodService</code></dt>
<dd>
<p>Configures the per-Pod services used by clients connecting to the Kafka broker from outside Kubernetes to access individual brokers.</p>
</dd>
<dt class="hdlist1"><code>externalBootstrapRoute</code></dt>
<dd>
<p>Configures the bootstrap route used by clients connecting to the Kafka brokers from outside of OpenShift using OpenShift <code>Routes</code>.</p>
</dd>
<dt class="hdlist1"><code>perPodRoute</code></dt>
<dd>
<p>Configures the per-Pod routes used by clients connecting to the Kafka broker from outside OpenShift to access individual brokers using OpenShift <code>Routes</code>.</p>
</dd>
<dt class="hdlist1"><code>podDisruptionBudget</code></dt>
<dd>
<p>Configures the Pod Disruption Budget for Kafka broker <code>StatefulSet</code>.</p>
</dd>
<dt class="hdlist1"><code>kafkaContainer</code></dt>
<dd>
<p>Configures the container used to run the Kafka broker, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>tlsSidecarContainer</code></dt>
<dd>
<p>Configures the TLS sidecar container, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>initContainer</code></dt>
<dd>
<p>Configures the container used to initialize the brokers.</p>
</dd>
<dt class="hdlist1"><code>persistentVolumeClaim</code></dt>
<dd>
<p>Configures the metadata of the Kafka <code>PersistentVolumeClaims</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_a_zookeeper_cluster"><a class="link" href="#supported_template_properties_for_a_zookeeper_cluster">Supported template properties for a Zookeeper cluster</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>statefulset</code></dt>
<dd>
<p>Configures the Zookeeper <code>StatefulSet</code>.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Zookeeper <code>Pods</code> created by the <code>StatefulSet</code>.</p>
</dd>
<dt class="hdlist1"><code>clientsService</code></dt>
<dd>
<p>Configures the service used by clients to access Zookeeper.</p>
</dd>
<dt class="hdlist1"><code>nodesService</code></dt>
<dd>
<p>Configures the headless service.</p>
</dd>
<dt class="hdlist1"><code>podDisruptionBudget</code></dt>
<dd>
<p>Configures the Pod Disruption Budget for Zookeeper <code>StatefulSet</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperContainer</code></dt>
<dd>
<p>Configures the container used to run the Zookeeper Node, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>tlsSidecarContainer</code></dt>
<dd>
<p>Configures the TLS sidecar container, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>persistentVolumeClaim</code></dt>
<dd>
<p>Configures the metadata of the Zookeeper <code>PersistentVolumeClaims</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_entity_operator"><a class="link" href="#supported_template_properties_for_entity_operator">Supported template properties for Entity Operator</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deployment</code></dt>
<dd>
<p>Configures the Deployment used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Entity Operator <code>Pod</code> created by the <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>topicOperatorContainer</code></dt>
<dd>
<p>Configures the container used to run the Topic Operator, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>userOperatorContainer</code></dt>
<dd>
<p>Configures the container used to run the User Operator, including custom environment variables.</p>
</dd>
<dt class="hdlist1"><code>tlsSidecarContainer</code></dt>
<dd>
<p>Configures the TLS sidecar container, including custom environment variables.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_kafka_exporter"><a class="link" href="#supported_template_properties_for_kafka_exporter">Supported template properties for Kafka Exporter</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deployment</code></dt>
<dd>
<p>Configures the Deployment used by Kafka Exporter.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Kafka Exporter <code>Pod</code> created by the <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>services</code></dt>
<dd>
<p>Configures the Kafka Exporter services.</p>
</dd>
<dt class="hdlist1"><code>container</code></dt>
<dd>
<p>Configures the container used to run Kafka Exporter, including custom environment variables.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_kafka_connect_and_kafka_connect_with_source2image_support"><a class="link" href="#supported_template_properties_for_kafka_connect_and_kafka_connect_with_source2image_support">Supported template properties for Kafka Connect and Kafka Connect with Source2Image support</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deployment</code></dt>
<dd>
<p>Configures the Kafka Connect <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Kafka Connect <code>Pods</code> created by the <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>apiService</code></dt>
<dd>
<p>Configures the service used by the Kafka Connect REST API.</p>
</dd>
<dt class="hdlist1"><code>podDisruptionBudget</code></dt>
<dd>
<p>Configures the Pod Disruption Budget for Kafka Connect <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>connectContainer</code></dt>
<dd>
<p>Configures the container used to run Kafka Connect, including custom environment variables.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="supported_template_properties_for_kafka_mirror_maker"><a class="link" href="#supported_template_properties_for_kafka_mirror_maker">Supported template properties for Kafka Mirror Maker</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>deployment</code></dt>
<dd>
<p>Configures the Kafka Mirror Maker <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>pod</code></dt>
<dd>
<p>Configures the Kafka Mirror Maker <code>Pods</code> created by the <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>podDisruptionBudget</code></dt>
<dd>
<p>Configures the Pod Disruption Budget for Kafka Mirror Maker <code>Deployment</code>.</p>
</dd>
<dt class="hdlist1"><code>mirrorMakerContainer</code></dt>
<dd>
<p>Configures the container used to run Kafka Mirror Maker, including custom environment variables.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code> schema reference</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-labels-and-annotations-str"><a class="link" href="#con-customizing-labels-and-annotations-str">3.7.2. Labels and Annotations</a></h4>
<div class="paragraph">
<p>For every resource, you can configure additional <code>Labels</code> and <code>Annotations</code>.
<code>Labels</code> and <code>Annotations</code> are used to identify and organize resources, and are configured in the <code>metadata</code> property.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
    statefulset:
        metadata:
            labels:
                label1: value1
                label2: value2
            annotations:
                annotation1: value1
                annotation2: value2
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>labels</code> and <code>annotations</code> fields can contain any labels or annotations that do not contain the reserved string <code>strimzi.io</code>.
Labels and annotations containing <code>strimzi.io</code> are used internally by Strimzi and cannot be configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>metadata</code> property is not applicable to container templates, such as the <code>kafkaContainer</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-pods-str"><a class="link" href="#con-customizing-pods-str">3.7.3. Customizing Pods</a></h4>
<div class="paragraph">
<p>In addition to Labels and Annotations, you can customize some other fields on Pods.
These fields are described in the following table and affect how the Pod is created.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>terminationGracePeriodSeconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the period of time, in seconds, by which the Pod must have terminated gracefully.
After the grace period, the Pod and its containers are forcefully terminated (killed).
The default value is <code>30</code> seconds.</p>
<p class="tableblock">NOTE: You might need to increase the grace period for very large Kafka clusters, so that the Kafka brokers have enough time to transfer their work to another broker before they are terminated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>imagePullSecrets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a list of references to Kubernetes Secrets that can be used for pulling container images from private repositories.
For more information about how to create a Secret with the credentials, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/" target="_blank" rel="noopener">Pull an Image from a Private Registry</a>.</p>
<p class="tableblock">NOTE: When the <code>STRIMZI_IMAGE_PULL_SECRETS</code> environment variable in Cluster Operator and the <code>imagePullSecrets</code> option are specified, only the <code>imagePullSecrets</code> variable is used. The <code>STRIMZI_IMAGE_PULL_SECRETS</code> variable is ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>securityContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures pod-level security attributes for containers running as part of a given Pod.
For more information about configuring SecurityContext, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener">Configure a Security Context for a Pod or Container</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priorityClassName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the name of the Priority Class which will be used for given a Pod.
For more information about Priority Classes, see <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption" target="_blank" rel="noopener">Pod Priority and Preemption</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These fields are effective on each type of cluster (Kafka and Zookeeper; Kafka Connect and Kafka Connect with S2I support; and Kafka Mirror Maker).</p>
</div>
<div class="paragraph">
<p>The following example shows these customized fields on a <code>template</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
  pod:
    metadata:
      labels:
        label1: value1
    imagePullSecrets:
      - name: my-docker-credentials
    securityContext:
      runAsUser: 1000001
      fsGroup: 0
    terminationGracePeriodSeconds: 120
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="#type-PodTemplate-reference"><code>PodTemplate</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-containers-str"><a class="link" href="#con-customizing-containers-str">3.7.4. Customizing containers with environment variables</a></h4>
<div class="paragraph">
<p>You can set custom environment variables for a container by using the relevant <code>template</code> container property.
The following table lists the Strimzi containers and the relevant template configuration property (defined under <code>spec</code>) for each custom resource.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table Container environment variable properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Strimzi Element</th>
<th class="tableblock halign-left valign-top">Container</th>
<th class="tableblock halign-left valign-top">Configuration property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka.template.kafkaContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Broker TLS Sidecar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka.template.tlsSidecarContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Initialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka.template.initContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zookeeper Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zookeeper.template.zookeeperContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zookeeper TLS Sidecar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zookeeper.template.tlsSidecarContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Topic Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entityOperator.template.topicOperatorContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entityOperator.template.userOperatorContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity Operator TLS Sidecar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entityOperator.template.tlsSidecarContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KafkaConnect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect and ConnectS2I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>template.connectContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KafkaMirrorMaker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mirror Maker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>template.mirrorMakerContainer.env</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KafkaBridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>template.bridgeContainer.env</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The environment variables are defined under the <code>env</code> property as a list of objects with <code>name</code> and <code>value</code> fields.
The following example shows two custom environment variables set for the Kafka broker containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
kind: Kafka
spec:
    kafka:
        template:
            kafkaContainer:
                env:
                    - name: TEST_ENV_1
                      value: test.env.one
                    - name: TEST_ENV_2
                      value: test.env.two
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment variables prefixed with <code>KAFKA_</code> are internal to Strimzi and should be avoided.
If you set a custom environment variable that is already in use by Strimzi, it is ignored and a warning is recorded in the log.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-image-pull-policy-str"><a class="link" href="#con-customizing-image-pull-policy-str">3.7.5. Customizing the image pull policy</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the image pull policy for containers in all pods deployed by the Cluster Operator.
The image pull policy is configured using the environment variable <code>STRIMZI_IMAGE_PULL_POLICY</code> in the Cluster Operator deployment.
The <code>STRIMZI_IMAGE_PULL_POLICY</code> environment variable can be set to three different values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Always</code></dt>
<dd>
<p>Container images are pulled from the registry every time the pod is started or restarted.</p>
</dd>
<dt class="hdlist1"><code>IfNotPresent</code></dt>
<dd>
<p>Container images are pulled from the registry only when they were not pulled before.</p>
</dd>
<dt class="hdlist1"><code>Never</code></dt>
<dd>
<p>Container images are never pulled from the registry.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The image pull policy can be currently customized only for all Kafka, Kafka Connect, and Kafka Mirror Maker clusters at once.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka Mirror Maker clusters.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Cluster Operator configuration, see <a href="#assembly-operators-cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about Image Pull Policies, see <a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images" target="_blank" rel="noopener">Disruptions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-pod-disruption-budgets-str"><a class="link" href="#con-customizing-pod-disruption-budgets-str">3.7.6. Customizing Pod Disruption Budgets</a></h4>
<div class="paragraph">
<p>Strimzi creates a pod disruption budget for every new <code>StatefulSet</code> or <code>Deployment</code>.
By default, these pod disruption budgets only allow a single pod to be unavailable at a given time by setting the <code>maxUnavailable</code> value in the`PodDisruptionBudget.spec` resource to 1.
You can change the amount of unavailable pods allowed by changing the default value of <code>maxUnavailable</code> in the pod disruption budget template.
This template applies to each type of cluster (Kafka and Zookeeper; Kafka Connect and Kafka Connect with S2I support; and Kafka Mirror Maker).</p>
</div>
<div class="paragraph">
<p>The following example shows customized <code>podDisruptionBudget</code> fields on a <code>template</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
    podDisruptionBudget:
        metadata:
            labels:
                key1: label1
                key2: label2
            annotations:
                key1: label1
                key2: label2
        maxUnavailable: 1
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code> schema reference</a>.</p>
</li>
<li>
<p>The <a href="https://kubernetes.io/docs/concepts/workloads/pods/disruptions/" target="_blank" rel="noopener">Disruptions</a> chapter of the Kubernetes documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-customizing-deployments-str"><a class="link" href="#proc-customizing-deployments-str">3.7.7. Customizing deployments</a></h4>
<div class="paragraph">
<p>This procedure describes how to customize <code>Labels</code> of a Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>A running Cluster Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>template</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, or <code>KafkaMirrorMaker</code> resource.
For example, to modify the labels for the Kafka broker <code>StatefulSet</code>, use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
  labels:
    app: my-cluster
spec:
  kafka:
    # ...
    template:
      statefulset:
        metadata:
          labels:
            mylabel: myvalue
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use <code>kubectl edit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit <em>Resource</em> <em>ClusterName</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operators-str"><a class="link" href="#assembly-operators-str">4. Operators</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="assembly-operators-cluster-operator-str"><a class="link" href="#assembly-operators-cluster-operator-str">4.1. Cluster Operator</a></h3>
<div class="sect3">
<h4 id="con-what-the-cluster-operator-does-deploying-co"><a class="link" href="#con-what-the-cluster-operator-does-deploying-co">4.1.1. Overview of the Cluster Operator component</a></h4>
<div class="paragraph">
<p>Strimzi uses the Cluster Operator to deploy and manage clusters for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka (including Zookeeper, Entity Operator and Kafka Exporter)</p>
</li>
<li>
<p>Kafka Connect</p>
</li>
<li>
<p>Kafka Mirror Maker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom resources are used to deploy the clusters.</p>
</div>
<div class="paragraph">
<p>For example, to deploy a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Kafka</code> resource with the cluster configuration is created within the Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator deploys a corresponding Kafka cluster, based on what is declared in the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Cluster Operator can also deploy (through Entity Operator configuration of the <code>Kafka</code> resource):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Topic Operator to provide operator-style topic management through <code>KafkaTopic</code> custom resources</p>
</li>
<li>
<p>A User Operator to provide operator-style user management through <code>KafkaUser</code> custom resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on the configuration options supported by the <code>Kafka</code> resource, see <a href="#assembly-deployment-configuration-kafka-str">Kafka cluster configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
On OpenShift, a Kafka Connect deployment can incorporate a Source2Image feature to provides a convenient way to include connectors.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Cluster Operator</div>
<p><span class="image"><img src="images/cluster-operator.png" alt="Cluster Operator"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="con-cluster-operator-watch-options-deploying-co"><a class="link" href="#con-cluster-operator-watch-options-deploying-co">4.1.2. Watch options for a Cluster Operator deployment</a></h4>
<div class="paragraph">
<p>When the Cluster Operator is running, it starts to <em>watch</em> for updates of Kafka resources.</p>
</div>
<div class="paragraph">
<p>Depending on the deployment, the Cluster Operator can watch Kafka resources from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#deploying-cluster-operator-deploying-co">A single namespace (the namespace it is installed)</a></p>
</li>
<li>
<p><a href="#deploying-cluster-operator-to-watch-multiple-namespacesdeploying-co">Multiple namespaces</a></p>
</li>
<li>
<p><a href="#deploying-cluster-operator-to-watch-whole-cluster-deploying-co">All namespaces</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi provides example YAML files to make the deployment process easier.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Cluster Operator watches the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka</code> for the Kafka cluster.</p>
</li>
<li>
<p><code>KafkaConnect</code> for the Kafka Connect cluster.</p>
</li>
<li>
<p><code>KafkaConnectS2I</code> for the Kafka Connect cluster with Source2Image support.</p>
</li>
<li>
<p><code>KafkaMirrorMaker</code> for the Kafka Mirror Maker instance.</p>
</li>
<li>
<p><code>KafkaBridge</code> for the Kafka Bridge instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of these resources is created in the Kubernetes cluster, the operator gets the cluster description from the resource and starts creating a new cluster for the resource by creating the necessary Kubernetes resources, such as StatefulSets, Services and ConfigMaps.</p>
</div>
<div class="paragraph">
<p>Each time a Kafka resource is updated, the operator performs corresponding updates on the Kubernetes resources that make up the cluster for the resource.</p>
</div>
<div class="paragraph">
<p>Resources are either patched or deleted, and then recreated in order to make the cluster for the resource reflect the desired state of the cluster. This operation might cause a rolling update that might lead to service disruption.</p>
</div>
<div class="paragraph">
<p>When a resource is deleted, the operator undeploys the cluster and deletes all related Kubernetes resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-deploying-co"><a class="link" href="#deploying-cluster-operator-deploying-co">4.1.3. Deploying the Cluster Operator to watch a single namespace</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Modify the installation files according to the namespace the Cluster Operator is going to be installed in.</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Deploy the Cluster Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-to-watch-multiple-namespacesdeploying-co"><a class="link" href="#deploying-cluster-operator-to-watch-multiple-namespacesdeploying-co">4.1.4. Deploying the Cluster Operator to watch multiple namespaces</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Edit the installation files according to the namespace the Cluster Operator is going to be installed in.</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the file <code>install/cluster-operator/050-Deployment-strimzi-cluster-operator.yaml</code> and in the environment variable <code>STRIMZI_NAMESPACE</code> list all the namespaces where Cluster Operator should watch for resources.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      serviceAccountName: strimzi-cluster-operator
      containers:
      - name: strimzi-cluster-operator
        image: strimzi/operator:latest
        imagePullPolicy: IfNotPresent
        env:
        - name: STRIMZI_NAMESPACE
          value: watched-namespace-1,watched-namespace-2,watched-namespace-3</code></pre>
</div>
</div>
</li>
<li>
<p>For all namespaces which should be watched by the Cluster Operator (<code>watched-namespace-1</code>, <code>watched-namespace-2</code>, <code>watched-namespace-3</code> in the above example), install the <code>RoleBindings</code>.
Replace the <code><em>watched-namespace</em></code> with the namespace used in the previous step.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator/020-RoleBinding-strimzi-cluster-operator.yaml -n <em>watched-namespace</em>
kubectl apply -f install/cluster-operator/031-RoleBinding-strimzi-cluster-operator-entity-operator-delegation.yaml -n <em>watched-namespace</em>
kubectl apply -f install/cluster-operator/032-RoleBinding-strimzi-cluster-operator-topic-operator-delegation.yaml -n <em>watched-namespace</em></code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-to-watch-whole-cluster-deploying-co"><a class="link" href="#deploying-cluster-operator-to-watch-whole-cluster-deploying-co">4.1.5. Deploying the Cluster Operator to watch all namespaces</a></h4>
<div class="paragraph">
<p>You can configure the Cluster Operator to watch Strimzi resources across all namespaces in your Kubernetes cluster. When running in this mode, the Cluster Operator automatically manages clusters in any new namespaces that are created.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>This procedure requires use of a Kubernetes user account which is able to create <code>CustomResourceDefinitions</code>, <code>ClusterRoles</code> and <code>ClusterRoleBindings</code>.
Use of Role Base Access Control (RBAC) in the Kubernetes cluster usually means that permission to create, edit, and delete these resources is limited to Kubernetes cluster administrators, such as <code>system:admin</code>.</p>
</li>
<li>
<p>Your Kubernetes cluster is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the Cluster Operator to watch all namespaces:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the <code>050-Deployment-strimzi-cluster-operator.yaml</code> file.</p>
</li>
<li>
<p>Set the value of the <code>STRIMZI_NAMESPACE</code> environment variable to <code>*</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      # ...
      serviceAccountName: strimzi-cluster-operator
      containers:
      - name: strimzi-cluster-operator
        image: strimzi/operator:latest
        imagePullPolicy: IfNotPresent
        env:
        - name: STRIMZI_NAMESPACE
          value: "*"
        # ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create <code>ClusterRoleBindings</code> that grant cluster-wide access to all namespaces to the Cluster Operator.</p>
<div class="paragraph">
<p>Use the <code>kubectl create clusterrolebinding</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create clusterrolebinding strimzi-cluster-operator-namespaced --clusterrole=strimzi-cluster-operator-namespaced --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator
kubectl create clusterrolebinding strimzi-cluster-operator-entity-operator-delegation --clusterrole=strimzi-entity-operator --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator
kubectl create clusterrolebinding strimzi-cluster-operator-topic-operator-delegation --clusterrole=strimzi-topic-operator --serviceaccount <em>my-namespace</em>:strimzi-cluster-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code><em>my-namespace</em></code> with the namespace in which you want to install the Cluster Operator.</p>
</div>
</li>
<li>
<p>Deploy the Cluster Operator to your Kubernetes cluster.</p>
<div class="paragraph">
<p>Use the <code>kubectl apply</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-namespace</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-helm-chart-deploying-co"><a class="link" href="#deploying-cluster-operator-helm-chart-deploying-co">4.1.6. Deploying the Cluster Operator using Helm Chart</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Helm client has to be installed on the local machine.</p>
</li>
<li>
<p>Helm has to be installed in the Kubernetes cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the Strimzi Helm Chart repository:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm repo add strimzi https://strimzi.io/charts/</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator using the Helm command line tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm install strimzi/strimzi-kafka-operator</code></pre>
</div>
</div>
</li>
<li>
<p>Verify whether the Cluster Operator has been deployed successfully using the Helm command line tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">helm ls</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Helm, see the <a href="https://helm.sh/" target="_blank" rel="noopener">Helm website</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-cluster-operator-from-operator-hub-deploying-co"><a class="link" href="#deploying-cluster-operator-from-operator-hub-deploying-co">4.1.7. Deploying the Cluster Operator from OperatorHub.io</a></h4>
<div class="paragraph">
<p><a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a> is a catalog of Kubernetes Operators sourced from multiple providers.
It offers you an alternative way to install stable versions of Strimzi using the Strimzi Kafka Operator.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/operator-framework/operator-lifecycle-manager" target="_blank" rel="noopener">Operator Lifecycle Manager</a> is used for the installation and management of all Operators published on <a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a>.</p>
</div>
<div class="paragraph">
<p>To install Strimzi from <a href="https://operatorhub.io/" target="_blank" rel="noopener">OperatorHub.io</a>, locate the Strimzi Kafka Operator and follow the instructions provided.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-cluster-operator-reconciliation-deploying-co"><a class="link" href="#con-cluster-operator-reconciliation-deploying-co">4.1.8. Reconciliation</a></h4>
<div class="paragraph">
<p>Although the operator reacts to all notifications about the desired cluster resources received from the Kubernetes cluster,
if the operator is not running, or if a notification is not received for any reason, the desired resources will get out of sync with the state of the running Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>In order to handle failovers properly, a periodic reconciliation process is executed by the Cluster Operator so that it can compare the state of the desired resources with the current cluster deployments in order to have a consistent state across all of them.
You can set the time interval for the periodic reconciliations using the <a href="#STRIMZI_FULL_RECONCILIATION_INTERVAL_MS"><code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></a> variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-operators-cluster-operator-configuration-deploying-co"><a class="link" href="#ref-operators-cluster-operator-configuration-deploying-co">4.1.9. Cluster Operator Configuration</a></h4>
<div class="paragraph">
<p>The Cluster Operator can be configured through the following supported environment variables:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_NAMESPACE</code></dt>
<dd>
<p>A comma-separated list of namespaces that the operator should operate in.
When not set, set to empty string, or to <code>*</code> the Cluster Operator will operate in all namespaces.
The Cluster Operator deployment might use the <a href="https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api" target="_blank" rel="noopener">Kubernetes Downward API</a>
to set this automatically to the namespace the Cluster Operator is deployed in. See the example below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">env:
  - name: STRIMZI_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><a id="STRIMZI_FULL_RECONCILIATION_INTERVAL_MS"></a> <code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></dt>
<dd>
<p>Optional, default is 120000 ms. The interval between periodic reconciliations, in milliseconds.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_LOG_LEVEL</code></dt>
<dd>
<p>Optional, default <code>INFO</code>.
The level for printing logging messages. The value can be set to: <code>ERROR</code>, <code>WARNING</code>, <code>INFO</code>, <code>DEBUG</code>, and <code>TRACE</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATION_TIMEOUT_MS</code></dt>
<dd>
<p>Optional, default 300000 ms.
The timeout for internal operations, in milliseconds. This value should be
increased when using Strimzi on clusters where regular Kubernetes operations take longer than usual (because of slow downloading of Docker images, for example).</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from Kafka version to the corresponding Docker image containing a Kafka broker of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.2.1=strimzi/kafka:latest-kafka-2.2.1, 2.3.0=strimzi/kafka:latest-kafka-2.3.0</code>.
This is used when a <code>Kafka.spec.kafka.version</code> property is specified but not the <code>Kafka.spec.kafka.image</code>, as described in <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:latest</code>.
The image name to use as default for the init container started before the broker for initial configuration work (that is, rack support), if no image is specified as the <code>kafka-init-image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TLS_SIDECAR_KAFKA_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/kafka:latest-kafka-2.3.0</code>.
The image name to use as the default when deploying the sidecar container which provides TLS support for Kafka,
if no image is specified as the <code>Kafka.spec.kafka.tlsSidecar.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_ZOOKEEPER_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/kafka:latest-kafka-2.3.0</code>.
The image name to use as the default when deploying Zookeeper, if
no image is specified as the <code>Kafka.spec.zookeeper.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TLS_SIDECAR_ZOOKEEPER_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/kafka:latest-kafka-2.3.0</code>.
The image name to use as the default when deploying the sidecar container which provides TLS support for Zookeeper, if
no image is specified as the <code>Kafka.spec.zookeeper.tlsSidecar.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_CONNECT_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka connect of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.2.1=strimzi/kafka:latest-kafka-2.2.1, 2.3.0=strimzi/kafka:latest-kafka-2.3.0</code>.
This is used when a <code>KafkaConnect.spec.version</code> property is specified but not the <code>KafkaConnect.spec.image</code>, as described in <a href="#assembly-configuring-container-images-deployment-configuration-kafka-connect">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_CONNECT_S2I_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka connect of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.2.1=strimzi/kafka:latest-kafka-2.2.1, 2.3.0=strimzi/kafka:latest-kafka-2.3.0</code>.
This is used when a <code>KafkaConnectS2I.spec.version</code> property is specified but not the <code>KafkaConnectS2I.spec.image</code>, as described in <a href="#assembly-configuring-container-images-deployment-configuration-kafka-connect-s2i">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_MIRROR_MAKER_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka mirror maker of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.2.1=strimzi/kafka:latest-kafka-2.2.1, 2.3.0=strimzi/kafka:latest-kafka-2.3.0</code>.
This is used when a <code>KafkaMirrorMaker.spec.version</code> property is specified but not the <code>KafkaMirrorMaker.spec.image</code>, as described in <a href="#con-configuring-container-images-deployment-configuration-kafka-mirror-maker">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:latest</code>.
The image name to use as the default when deploying the topic operator,
if no image is specified as the <code>Kafka.spec.entityOperator.topicOperator.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a> of the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:latest</code>.
The image name to use as the default when deploying the user operator,
if no image is specified as the <code>Kafka.spec.entityOperator.userOperator.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a> of the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/kafka:latest-kafka-2.3.0</code>.
The image name to use as the default when deploying the sidecar container which provides TLS support for the Entity Operator, if
no image is specified as the <code>Kafka.spec.entityOperator.tlsSidecar.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_POLICY</code></dt>
<dd>
<p>Optional.
The <code>ImagePullPolicy</code> which will be applied to containers in all pods managed by Strimzi Cluster Operator.
The valid values are <code>Always</code>, <code>IfNotPresent</code>, and <code>Never</code>.
If not specified, the Kubernetes defaults will be used.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka Mirror Maker clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_SECRETS</code></dt>
<dd>
<p>Optional.
A comma-separated list of <code>Secret</code> names.
The secrets referenced here contain the credentials to the container registries where the container images are pulled from.
The secrets are used in the <code>imagePullSecrets</code> field for all <code>Pods</code> created by the Cluster Operator.
Changing this list results in a rolling update of all your Kafka, Kafka Connect, and Kafka Mirror Maker clusters.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="con-cluster-operator-rbac-deploying-co"><a class="link" href="#con-cluster-operator-rbac-deploying-co">4.1.10. Role-Based Access Control (RBAC)</a></h4>
<div class="sect4">
<h5 id="provisioning_role_based_access_control_rbac_for_the_cluster_operator"><a class="link" href="#provisioning_role_based_access_control_rbac_for_the_cluster_operator">Provisioning Role-Based Access Control (RBAC) for the Cluster Operator</a></h5>
<div class="paragraph">
<p>For the Cluster Operator to function it needs permission within the Kubernetes cluster to interact with resources such as <code>Kafka</code>, <code>KafkaConnect</code>, and so on, as well as the managed resources, such as <code>ConfigMaps</code>, <code>Pods</code>, <code>Deployments</code>, <code>StatefulSets</code>, <code>Services</code>, and so on.
Such permission is described in terms of Kubernetes role-based access control (RBAC) resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceAccount</code>,</p>
</li>
<li>
<p><code>Role</code> and <code>ClusterRole</code>,</p>
</li>
<li>
<p><code>RoleBinding</code> and <code>ClusterRoleBinding</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to running under its own <code>ServiceAccount</code> with a <code>ClusterRoleBinding</code>, the Cluster Operator manages some RBAC resources for the components that need access to Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>Kubernetes also includes privilege escalation protections that prevent components operating under one <code>ServiceAccount</code> from granting other <code>ServiceAccounts</code> privileges that the granting <code>ServiceAccount</code> does not have.
Because the Cluster Operator must be able to create the <code>ClusterRoleBindings</code>, and <code>RoleBindings</code> needed by resources it manages, the Cluster Operator must also have those same privileges.</p>
</div>
</div>
<div class="sect4">
<h5 id="delegated-privileges-deploying-co"><a class="link" href="#delegated-privileges-deploying-co">Delegated privileges</a></h5>
<div class="paragraph">
<p>When the Cluster Operator deploys resources for a desired <code>Kafka</code> resource it also creates <code>ServiceAccounts</code>, <code>RoleBindings</code>, and <code>ClusterRoleBindings</code>, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka broker pods use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-kafka</code></p>
<div class="ulist">
<ul>
<li>
<p>When the rack feature is used, the <code>strimzi-<em>cluster-name</em>-kafka-init</code> <code>ClusterRoleBinding</code> is used to grant this <code>ServiceAccount</code> access to the nodes within the cluster via a <code>ClusterRole</code> called <code>strimzi-kafka-broker</code></p>
</li>
<li>
<p>When the rack feature is not used no binding is created.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Zookeeper pods use the default <code>ServiceAccount</code>, as they do not need access to the Kubernetes resources.</p>
</li>
<li>
<p>The Topic Operator pod uses a <code>ServiceAccount</code> called <code><em>cluster-name</em>-topic-operator</code></p>
<div class="ulist">
<ul>
<li>
<p>The Topic Operator produces Kubernetes events with status information, so the <code>ServiceAccount</code> is bound to a <code>ClusterRole</code> called <code>strimzi-topic-operator</code> which grants this access via the <code>strimzi-topic-operator-role-binding</code> <code>RoleBinding</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The pods for <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources use the default <code>ServiceAccount</code>, as they do not require access to the Kubernetes resources.</p>
</div>
</div>
<div class="sect4">
<h5 id="serviceaccount"><a class="link" href="#serviceaccount"><code>ServiceAccount</code></a></h5>
<div class="paragraph">
<p>The Cluster Operator is best run using a <code>ServiceAccount</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ServiceAccount</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: ServiceAccount
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Deployment</code> of the operator then needs to specify this in its <code>spec.template.spec.serviceAccountName</code>:</p>
</div>
<div class="listingblock">
<div class="title">Partial example of <code>Deployment</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
spec:
  replicas: 1
  selector:
    matchLabels:
      name: strimzi-cluster-operator
      strimzi.io/kind: cluster-operator
  template:
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note line 12, where the the <code>strimzi-cluster-operator</code> <code>ServiceAccount</code> is specified as the <code>serviceAccountName</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="clusterroles"><a class="link" href="#clusterroles"><code>ClusterRoles</code></a></h5>
<div class="paragraph">
<p>The Cluster Operator needs to operate using <code>ClusterRoles</code> that gives access to the necessary resources.
Depending on the Kubernetes cluster setup, a cluster administrator might be needed to create the <code>ClusterRoles</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cluster administrator rights are only needed for the creation of the <code>ClusterRoles</code>.
The Cluster Operator will not run under the cluster admin account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ClusterRoles</code> follow the <em>principle of least privilege</em> and contain only those privileges needed by the Cluster Operator to operate Kafka, Kafka Connect, and Zookeeper clusters. The first set of assigned privileges allow the Cluster Operator to manage Kubernetes resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>ConfigMaps</code>.</p>
</div>
<div class="paragraph">
<p>Cluster Operator uses ClusterRoles to grant permission at the namespace-scoped resources level and cluster-scoped resources level:</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with namespaced resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-namespaced
  labels:
    app: strimzi
rules:
- apiGroups:
  - ""
  resources:
  - serviceaccounts
  verbs:
  - get
  - create
  - delete
  - patch
  - update
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - rolebindings
  verbs:
  - get
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - kafka.strimzi.io
  resources:
  - kafkas
  - kafkas/status
  - kafkaconnects
  - kafkaconnects/status
  - kafkaconnects2is
  - kafkaconnects2is/status
  - kafkamirrormakers
  - kafkamirrormakers/status
  - kafkabridges
  - kafkabridges/status
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - pods
  verbs:
  - get
  - list
  - watch
  - delete
- apiGroups:
  - ""
  resources:
  - services
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - extensions
  resources:
  - deployments
  - deployments/scale
  - replicasets
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - apps
  resources:
  - deployments
  - deployments/scale
  - deployments/status
  - statefulsets
  - replicasets
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - extensions
  resources:
  - replicationcontrollers
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - apps.openshift.io
  resources:
  - deploymentconfigs
  - deploymentconfigs/scale
  - deploymentconfigs/status
  - deploymentconfigs/finalizers
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - build.openshift.io
  resources:
  - buildconfigs
  - builds
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - watch
  - update
- apiGroups:
  - image.openshift.io
  resources:
  - imagestreams
  - imagestreams/status
  verbs:
  - create
  - delete
  - get
  - list
  - watch
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - replicationcontrollers
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - create
  - delete
  - patch
  - update
- apiGroups:
  - extensions
  resources:
  - networkpolicies
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - networking.k8s.io
  resources:
  - networkpolicies
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - route.openshift.io
  resources:
  - routes
  - routes/custom-host
  verbs:
  - get
  - list
  - create
  - delete
  - patch
  - update
- apiGroups:
  - ""
  resources:
  - persistentvolumeclaims
  verbs:
  - get
  - list
  - create
  - delete
  - patch
  - update
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update
- apiGroups:
  - extensions
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
  - create
  - delete
  - patch
  - update</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second includes the permissions needed for cluster-scoped resources.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with cluster-scoped resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-global
  labels:
    app: strimzi
rules:
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterrolebindings
  verbs:
  - get
  - create
  - delete
  - patch
  - update
  - watch
- apiGroups:
  - storage.k8s.io
  resources:
  - storageclasses
  verbs:
  - get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-kafka-broker</code> <code>ClusterRole</code> represents the access needed by the init container in Kafka pods that is used for the rack feature. As described in the <a href="#delegated-privileges-deploying-co">Delegated privileges</a> section, this role is also needed by the Cluster Operator in order to be able to delegate this access.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to Kubernetes nodes to the Kafka broker pods</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-kafka-broker
  labels:
    app: strimzi
rules:
- apiGroups:
  - ""
  resources:
  - nodes
  verbs:
  - get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-topic-operator</code> <code>ClusterRole</code> represents the access needed by the Topic Operator. As described in the <a href="#delegated-privileges-deploying-co">Delegated privileges</a> section, this role is also needed by the Cluster Operator in order to be able to delegate this access.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to events to the Topic Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-entity-operator
  labels:
    app: strimzi
rules:
- apiGroups:
  - kafka.strimzi.io
  resources:
  - kafkatopics
  - kafkatopics/status
  verbs:
  - get
  - list
  - watch
  - create
  - patch
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
- apiGroups:
  - kafka.strimzi.io
  resources:
  - kafkausers
  - kafkausers/status
  verbs:
  - get
  - list
  - watch
  - create
  - patch
  - update
  - delete
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - create
  - patch
  - update
  - delete</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="clusterrolebindings"><a class="link" href="#clusterrolebindings"><code>ClusterRoleBindings</code></a></h5>
<div class="paragraph">
<p>The operator needs <code>ClusterRoleBindings</code> and <code>RoleBindings</code> which associates its <code>ClusterRole</code> with its <code>ServiceAccount</code>:
<code>ClusterRoleBindings</code> are needed for <code>ClusterRoles</code> containing cluster-scoped resources.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
- kind: ServiceAccount
  name: strimzi-cluster-operator
  namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-global
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterRoleBindings</code> are also needed for the <code>ClusterRoles</code> needed for delegation:</p>
</div>
<div class="listingblock">
<div class="title">Examples <code>RoleBinding</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator-kafka-broker-delegation
  labels:
    app: strimzi
subjects:
- kind: ServiceAccount
  name: strimzi-cluster-operator
  namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-kafka-broker
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterRoles</code> containing only namespaced resources are bound using <code>RoleBindings</code> only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
- kind: ServiceAccount
  name: strimzi-cluster-operator
  namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-namespaced
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator-entity-operator-delegation
  labels:
    app: strimzi
subjects:
- kind: ServiceAccount
  name: strimzi-cluster-operator
  namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-entity-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-the-topic-operator-str"><a class="link" href="#deploying-the-topic-operator-str">4.2. Topic Operator</a></h3>
<div class="sect3">
<h4 id="what-the-topic-operator-does-deploying"><a class="link" href="#what-the-topic-operator-does-deploying">4.2.1. Overview of the Topic Operator component</a></h4>
<div class="paragraph">
<p>The Topic Operator provides a way of managing topics in a Kafka cluster via Kubernetes resources.</p>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Topic Operator</div>
<p><span class="image"><img src="images/topic-operator.png" alt="Topic Operator"></span></p>
</div>
<div class="paragraph">
<p>The role of the Topic Operator is to keep a set of <code>KafkaTopic</code> Kubernetes resources describing Kafka topics in-sync with corresponding Kafka topics.</p>
</div>
<div class="paragraph">
<p>Specifically, if a <code>KafkaTopic</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created, the operator will create the topic it describes</p>
</li>
<li>
<p>Deleted, the operator will delete the topic it describes</p>
</li>
<li>
<p>Changed, the operator will update the topic it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And also, in the other direction, if a topic is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created within the Kafka cluster, the operator will create a <code>KafkaTopic</code> describing it</p>
</li>
<li>
<p>Deleted from the Kafka cluster, the operator will delete the <code>KafkaTopic</code> describing it</p>
</li>
<li>
<p>Changed in the Kafka cluster, the operator will update the <code>KafkaTopic</code> describing it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows you to declare a <code>KafkaTopic</code> as part of your application&#8217;s deployment and the Topic Operator will take care of creating the topic for you.
Your application just needs to deal with producing or consuming from the necessary topics.</p>
</div>
<div class="paragraph">
<p>If the topic is reconfigured or reassigned to different Kafka nodes, the <code>KafkaTopic</code> will always be up to date.</p>
</div>
<div class="paragraph">
<p>For more details about creating, modifying and deleting topics, see <a href="#using-the-topic-operator-str">Using the Topic Operator</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-topic-operator-cluster-label-deploying"><a class="link" href="#con-topic-operator-cluster-label-deploying">4.2.2. Identifying a Kafka cluster for topic handling</a></h4>
<div class="paragraph">
<p>A <code>KafkaTopic</code> resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the <code>Kafka</code> resource) to which it belongs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label is used by the Topic Operator to identify the <code>KafkaTopic</code> resource and create a new topic, and also in subsequent handling of the topic.</p>
</div>
<div class="paragraph">
<p>If the label does not match the Kafka cluster, the Topic Operator cannot identify the <code>KafkaTopic</code> and the topic is not created.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-the-topic-operator-works-deploying"><a class="link" href="#how-the-topic-operator-works-deploying">4.2.3. Understanding the Topic Operator</a></h4>
<div class="paragraph">
<p>A fundamental problem that the operator has to solve is that there is no single source of truth:
Both the <code>KafkaTopic</code> resource and the topic within Kafka can be modified independently of the operator.
Complicating this, the Topic Operator might not always be able to observe changes at each end in real time (for example, the operator might be down).</p>
</div>
<div class="paragraph">
<p>To resolve this, the operator maintains its own private copy of the information about each topic.
When a change happens either in the Kafka cluster, or in Kubernetes, it looks at both the state of the other system and at its private copy in order to determine what needs to change to keep everything in sync.
The same thing happens whenever the operator starts, and periodically while it is running.</p>
</div>
<div class="paragraph">
<p>For example, suppose the Topic Operator is not running, and a <code>KafkaTopic</code> <code>my-topic</code> gets created.
When the operator starts it will lack a private copy of "my-topic", so it can infer that the <code>KafkaTopic</code> has been created since it was last running.
The operator will create the topic corresponding to "my-topic" and also store a private copy of the metadata for "my-topic".</p>
</div>
<div class="paragraph">
<p>The private copy allows the operator to cope with scenarios where the topic configuration gets changed both in Kafka and in Kubernetes, so long as the changes are not incompatible (for example, both changing the same topic config key, but to different values).
In the case of incompatible changes, the Kafka configuration wins, and the <code>KafkaTopic</code> will be updated to reflect that.</p>
</div>
<div class="paragraph">
<p>The private copy is held in the same Zookeeper ensemble used by Kafka itself.
This mitigates availability concerns, because if Zookeeper is not running then Kafka itself cannot run, so the operator will be no less available than it would even if it was stateless.</p>
</div>
</div>
<div class="sect3">
<h4 id="deploying-the-topic-operator-using-the-cluster-operator-deploying"><a class="link" href="#deploying-the-topic-operator-using-the-cluster-operator-deploying">4.2.4. Deploying the Topic Operator using the Cluster Operator</a></h4>
<div class="paragraph">
<p>This procedure describes how to deploy the Topic Operator using the Cluster Operator.
If you want to use the Topic Operator with a Kafka cluster that is not managed by Strimzi, you must deploy the Topic Operator as a standalone component. For more information, see <a href="#deploying-the-topic-operator-standalone-deploying">Deploying the standalone Topic Operator</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource to be created or updated</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the <code>Kafka.spec.entityOperator</code> object exists in the <code>Kafka</code> resource. This configures the Entity Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  #...
  entityOperator:
    <strong>topicOperator: {}</strong>
    userOperator: {}</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Topic Operator using the fields described in <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code> schema reference</a>.</p>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Entity Operator, see <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">Entity Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>Kafka.spec.entityOperator</code> object used to configure the Topic Operator when deployed by the Cluster Operator, see <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-topic-operator-with-resource-requests-limits-deploying"><a class="link" href="#proc-topic-operator-with-resource-requests-limits-deploying">4.2.5. Configuring the Topic Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the Topic Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="paragraph">
<p>Use <code>kubectl edit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka my-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.topicOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the Topic Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # kafka and zookeeper sections...
  entityOperator:
    topicOperator:
      resources:
        request:
          cpu: "1"
          memory: 500Mi
        limit:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema of the <code>resources</code> object, see <a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="deploying-the-topic-operator-standalone-deploying"><a class="link" href="#deploying-the-topic-operator-standalone-deploying">4.2.6. Deploying the standalone Topic Operator</a></h4>
<div class="paragraph">
<p>Deploying the Topic Operator as a standalone component is more complicated than installing it using the Cluster Operator, but it is more flexible.
For instance, it can operate <em>with</em> any Kafka cluster, not necessarily one deployed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster for the Topic Operator to connect to.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>install/topic-operator/05-Deployment-strimzi-topic-operator.yaml</code> resource. You will need to change the following</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <code>STRIMZI_KAFKA_BOOTSTRAP_SERVERS</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to a list of bootstrap brokers in your Kafka cluster, given as a comma-separated list of <code><em>hostname</em>:<em>port</em></code> pairs.</p>
</li>
<li>
<p>The <code>STRIMZI_ZOOKEEPER_CONNECT</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to a list of the Zookeeper nodes, given as a comma-separated list of <code><em>hostname</em>:<em>port</em></code> pairs. This should be the same Zookeeper cluster that your Kafka cluster is using.</p>
</li>
<li>
<p>The <code>STRIMZI_NAMESPACE</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to the Kubernetes namespace in which you want the operator to watch for  <code>KafkaTopic</code> resources.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the Topic Operator.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/topic-operator</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Topic Operator has been deployed successfully.
This can be done using <code>kubectl describe</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe deployment strimzi-topic-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Topic Operator is deployed once the <code>Replicas:</code> entry shows <code>1 available</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This could take some time if you have a slow connection to the Kubernetes and the images have not been downloaded before.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the environment variables used to configure the Topic Operator, see <a href="#topic-operator-environment-deploying">Topic Operator environment</a>.</p>
</li>
<li>
<p>For more information about getting the Cluster Operator to deploy the Topic Operator for you, see <a href="#deploying-the-topic-operator-using-the-cluster-operator-str">Deploying the Topic Operator using the Cluster Operator</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="topic-operator-environment-deploying"><a class="link" href="#topic-operator-environment-deploying">4.2.7. Topic Operator environment</a></h4>
<div class="paragraph">
<p>When deployed standalone the Topic Operator can be configured using environment variables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Topic Operator should be configured using the <code>Kafka.spec.entityOperator.topicOperator</code> property when deployed by the Cluster Operator.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_RESOURCE_LABELS</code></dt>
<dd>
<p>The label selector used to identify <code>KafkaTopics</code> to be managed by the operator.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_ZOOKEEPER_SESSION_TIMEOUT_MS</code></dt>
<dd>
<p>The Zookeeper session timeout, in milliseconds.
For example, <code>10000</code>.
Default <code>20000</code> (20 seconds).</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_BOOTSTRAP_SERVERS</code></dt>
<dd>
<p>The list of Kafka bootstrap servers.
This variable is mandatory.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_ZOOKEEPER_CONNECT</code></dt>
<dd>
<p>The Zookeeper connection information.
This variable is mandatory.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></dt>
<dd>
<p>The interval between periodic reconciliations, in milliseconds.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_TOPIC_METADATA_MAX_ATTEMPTS</code></dt>
<dd>
<p>The number of attempts at getting topic metadata from Kafka.
The time between each attempt is defined as an exponential back-off.
Consider increasing this value when topic creation could take more time due to the number of partitions or replicas.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_LOG_LEVEL</code></dt>
<dd>
<p>The level for printing logging messages.
The value can be set to: <code>ERROR</code>, <code>WARNING</code>, <code>INFO</code>, <code>DEBUG</code>, and <code>TRACE</code>.
Default <code>INFO</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_TLS_ENABLED</code></dt>
<dd>
<p>For enabling the TLS support so encrypting the communication with Kafka brokers.
Default <code>true</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_TRUSTSTORE_LOCATION</code></dt>
<dd>
<p>The path to the truststore containing certificates for enabling TLS based communication.
This variable is mandatory only if TLS is enabled through <code>STRIMZI_TLS_ENABLED</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_TRUSTSTORE_PASSWORD</code></dt>
<dd>
<p>The password for accessing the truststore defined by <code>STRIMZI_TRUSTSTORE_LOCATION</code>.
This variable is mandatory only if TLS is enabled through <code>STRIMZI_TLS_ENABLED</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KEYSTORE_LOCATION</code></dt>
<dd>
<p>The path to the keystore containing private keys for enabling TLS based communication.
This variable is mandatory only if TLS is enabled through <code>STRIMZI_TLS_ENABLED</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KEYSTORE_PASSWORD</code></dt>
<dd>
<p>The password for accessing the keystore defined by <code>STRIMZI_KEYSTORE_LOCATION</code>.
This variable is mandatory only if TLS is enabled through <code>STRIMZI_TLS_ENABLED</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-user-operator-str"><a class="link" href="#assembly-user-operator-str">4.3. User Operator</a></h3>
<div class="paragraph">
<p>The User Operator manages Kafka users through custom resources.</p>
</div>
<div class="sect3">
<h4 id="con-what-the-user-operator-does-deploying-uo"><a class="link" href="#con-what-the-user-operator-does-deploying-uo">4.3.1. Overview of the User Operator component</a></h4>
<div class="paragraph">
<p>The User Operator manages Kafka users for a Kafka cluster by watching for <code>KafkaUser</code> resources that describe Kafka users and ensuring that they are configured properly in the Kafka cluster.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a <code>KafkaUser</code> is created, the User Operator will create the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is deleted, the User Operator will delete the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is changed, the User Operator will update the user it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike the <a href="#what-the-topic-operator-does-str">Topic Operator</a>, the User Operator does not sync any changes from the Kafka cluster with the Kubernetes resources.
Unlike the Kafka topics which might be created by applications directly in Kafka, it is not expected that the users will be managed directly in the Kafka cluster in parallel with the User Operator, so this should not be needed.</p>
</div>
<div class="paragraph">
<p>The User Operator allows you to declare a <code>KafkaUser</code> as part of your application&#8217;s deployment.
When the user is created, the user credentials will be created in a <code>Secret</code>.
Your application needs to use the user and its credentials for authentication and to produce or consume messages.</p>
</div>
<div class="paragraph">
<p>In addition to managing credentials for authentication, the User Operator also manages authorization rules by including a description of the user&#8217;s rights in the <code>KafkaUser</code> declaration.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-user-operator-cluster-label-deploying-uo"><a class="link" href="#con-user-operator-cluster-label-deploying-uo">4.3.2. Identifying a Kafka cluster for user handling</a></h4>
<div class="paragraph">
<p>A <code>KafkaUser</code> resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the <code>Kafka</code> resource) to which it belongs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label is used by the User Operator to identify the <code>KafkaUser</code> resource and create a new user, and also in subsequent handling of the user.</p>
</div>
<div class="paragraph">
<p>If the label does not match the Kafka cluster, the User Operator cannot identify the <code>kafkaUser</code> and the user is not created.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-deploying-the-user-operator-using-the-cluster-operator-deploying-uo"><a class="link" href="#proc-deploying-the-user-operator-using-the-cluster-operator-deploying-uo">4.3.3. Deploying the User Operator using the Cluster Operator</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource to be created or updated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>Kafka</code> resource ensuring it has a <code>Kafka.spec.entityOperator.userOperator</code> object that configures the User Operator how you want.</p>
</li>
<li>
<p>Create or update the Kafka resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>Kafka.spec.entityOperator</code> object used to configure the User Operator when deployed by the Cluster Operator, see <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-user-operator-with-resource-requests-limits-deploying-uo"><a class="link" href="#proc-user-operator-with-resource-requests-limits-deploying-uo">4.3.4. Configuring the User Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the User Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka my-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.userOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the User Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # kafka and zookeeper sections...
  entityOperator:
    userOperator:
      resources:
        request:
          cpu: "1"
          memory: 500Mi
        limit:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file and exit the editor.
The Cluster Operator will apply the changes automatically.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema of the <code>resources</code> object, see <a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-deploying-the-user-operator-standalone-deploying-uo"><a class="link" href="#proc-deploying-the-user-operator-standalone-deploying-uo">4.3.5. Deploying the standalone User Operator</a></h4>
<div class="paragraph">
<p>Deploying the User Operator as a standalone component is more complicated than installing it using the Cluster Operator, but it is more flexible.
For instance, it can operate <em>with</em> any Kafka cluster, not only the one deployed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster for the User Operator to connect to.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>install/user-operator/05-Deployment-strimzi-user-operator.yaml</code> resource. You will need to change the following</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The <code>STRIMZI_CA_CERT_NAME</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to point to a Kubernetes <code>Secret</code> which should contain the public key of the Certificate Authority for signing new user certificates for TLS Client Authentication.
The <code>Secret</code> should contain the public key of the Certificate Authority under the key <code>ca.crt</code>.</p>
</li>
<li>
<p>The <code>STRIMZI_CA_KEY_NAME</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to point to a Kubernetes <code>Secret</code> which should contain the private key of the Certificate Authority for signing new user certificates for TLS Client Authentication.
The <code>Secret</code> should contain the private key of the Certificate Authority under the key <code>ca.key</code>.</p>
</li>
<li>
<p>The <code>STRIMZI_ZOOKEEPER_CONNECT</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to a list of the Zookeeper nodes, given as a comma-separated list of <code><em>hostname</em>:<em>port</em></code> pairs. This should be the same Zookeeper cluster that your Kafka cluster is using.</p>
</li>
<li>
<p>The <code>STRIMZI_NAMESPACE</code> environment variable in <code>Deployment.spec.template.spec.containers[0].env</code> should be set to the Kubernetes namespace in which you want the operator to watch for  <code>KafkaUser</code> resources.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the User Operator.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/user-operator</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the User Operator has been deployed successfully.
This can be done using <code>kubectl describe</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe deployment strimzi-user-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>The User Operator is deployed once the <code>Replicas:</code> entry shows <code>1 available</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This could take some time if you have a slow connection to the Kubernetes and the images have not been downloaded before.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about getting the Cluster Operator to deploy the User Operator for you, see <a href="#proc-deploying-the-user-operator-using-the-cluster-operator-str">Deploying the User Operator using the Cluster Operator</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-the-topic-operator-str"><a class="link" href="#using-the-topic-operator-str">5. Using the Topic Operator</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="topic-operator-usage-recommendations-str"><a class="link" href="#topic-operator-usage-recommendations-str">5.1. Topic Operator usage recommendations</a></h3>
<div class="paragraph">
<p>When working with topics, be consistent and always operate on either <code>KafkaTopic</code> resources or topics directly. Avoid routinely switching between both methods for a given topic.</p>
</div>
<div class="paragraph">
<p>Use topic names that reflect the nature of the topic, and remember that names cannot be changed later.</p>
</div>
<div class="paragraph">
<p>If creating a topic in Kafka, use a name that is a valid Kubernetes resource name, otherwise the Topic Operator will need to create the corresponding <code>KafkaTopic</code> with a name that conforms to the Kubernetes rules.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Recommendations for identifiers and names in Kubernetes are outlined in <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/architecture/identifiers.md" target="_blank" rel="noopener">Identifiers and Names in Kubernetes</a> community article.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Kafka topic naming conventions</div>
<p>Kafka and Kubernetes impose their own validation rules for the naming of topics in Kafka and <code>KafkaTopic.metadata.name</code> respectively.
There are valid names for each which are invalid in the other.</p>
</div>
<div class="paragraph">
<p>Using the <code>spec.topicName property</code>, it is possible to create a valid topic in Kafka with a name that would be invalid for the KafkaTopic in {ProductPlatformName}.</p>
</div>
<div class="paragraph">
<p>The <code>spec.topicName</code> property inherits Kafka naming validation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name must not be longer than 249 characters.</p>
</li>
<li>
<p>Valid characters for Kafka topics are ASCII alphanumerics, <code>.</code>, <code>_</code>, and <code>-</code>.</p>
</li>
<li>
<p>The name cannot be <code>.</code> or <code>..</code>, though <code>.</code> can be used in a name, such as <code>exampleTopic.</code> or <code>.exampleTopic</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>spec.topicName</code> must not be changed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: topicName-1 # Upper case is invalid in Kubernetes
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>cannot be changed to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: name-2
  # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some Kafka client applications, such as Kafka Streams, can create topics in Kafka programmatically. If those topics have names that are invalid Kubernetes resource names, the Topic Operator gives them valid names based on the Kafka names. Invalid characters are replaced and a hash is appended to the name.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="creating-a-topic-str"><a class="link" href="#creating-a-topic-str">5.2. Creating a topic</a></h3>
<div class="paragraph">
<p>This procedure describes how to create a Kafka topic using a <code>KafkaTopic</code> Kubernetes resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running Topic Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a file containing the <code>KafkaTopic</code> to be created</p>
<div class="listingblock">
<div class="title">An example <code>KafkaTopic</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: orders
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10
  replicas: 2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is recommended that the topic name given is a valid Kubernetes resource name, as it is then not necessary to set the <code>KafkaTopic.spec.topicName</code> property. The <code>KafkaTopic.spec.topicName</code> <em>cannot</em> be changed after creation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>KafkaTopic.spec.partitions</code> cannot be decreased.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the <code>KafkaTopic</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema for <code>KafkaTopics</code>, see <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code> schema reference</a>.</p>
</li>
<li>
<p>For more information about deploying a Kafka cluster using the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Topic Operator using the Cluster Operator, see <a href="#deploying-the-topic-operator-using-the-cluster-operator-str">Deploying the Topic Operator using the Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the standalone Topic Operator, see <a href="#deploying-the-topic-operator-standalone-deploying">Deploying the standalone Topic Operator</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="changing-a-topic-str"><a class="link" href="#changing-a-topic-str">5.3. Changing a topic</a></h3>
<div class="paragraph">
<p>This procedure describes how to change the configuration of an existing Kafka topic by using a <code>KafkaTopic</code> Kubernetes resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running Topic Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>An existing <code>KafkaTopic</code> to be changed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a file containing the desired <code>KafkaTopic</code></p>
<div class="listingblock">
<div class="title">An example <code>KafkaTopic</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: orders
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 16
  replicas: 2</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
You can get the current version of the resource using <code>kubectl get kafkatopic orders -o yaml</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Changing topic names using the <code>KafkaTopic.spec.topicName</code> variable and decreasing partition size using the <code>KafkaTopic.spec.partitions</code> variable is not supported by Kafka.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Increasing <code>spec.partitions</code> for topics with keys will change how records are partitioned, which can be particularly problematic when the topic uses <em>semantic partitioning</em>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the <code>KafkaTopic</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema for <code>KafkaTopics</code>, see <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code> schema reference</a>.</p>
</li>
<li>
<p>For more information about deploying a Kafka cluster, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Topic Operator using the Cluster Operator, see <a href="#deploying-the-topic-operator-using-the-cluster-operator-str">Deploying the Topic Operator using the Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about creating a topic using the Topic Operator, see <a href="#creating-a-topic-str">Creating a topic</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deleting-a-topic-str"><a class="link" href="#deleting-a-topic-str">5.4. Deleting a topic</a></h3>
<div class="paragraph">
<p>This procedure describes how to delete a Kafka topic using a <code>KafkaTopic</code> Kubernetes resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running Topic Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>An existing <code>KafkaTopic</code> to be deleted.</p>
</li>
<li>
<p><code>delete.topic.enable=true</code> (default)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>delete.topic.enable</code> property must be set to <code>true</code> in <code>Kafka.spec.kafka.config</code>. Otherwise, the steps outlined here will delete the <code>KafkaTopic</code> resource, but the Kafka topic and its data will remain. After reconciliation by the Topic Operator, the custom resource is then recreated.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete the <code>KafkaTopic</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl delete</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete kafkatopic <em>your-topic-name</em></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying a Kafka cluster using the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Topic Operator using the Cluster Operator, see <a href="#deploying-the-topic-operator-using-the-cluster-operator-str">Deploying the Topic Operator using the Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about creating a topic using the Topic Operator, see <a href="#creating-a-topic-str">Creating a topic</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-using-the-user-operator-str"><a class="link" href="#assembly-using-the-user-operator-str">6. Using the User Operator</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The User Operator provides a way of managing Kafka users via Kubernetes resources.</p>
</div>
<div class="sect2">
<h3 id="con-what-the-user-operator-does-using-uo"><a class="link" href="#con-what-the-user-operator-does-using-uo">6.1. Overview of the User Operator component</a></h3>
<div class="paragraph">
<p>The User Operator manages Kafka users for a Kafka cluster by watching for <code>KafkaUser</code> resources that describe Kafka users and ensuring that they are configured properly in the Kafka cluster.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if a <code>KafkaUser</code> is created, the User Operator will create the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is deleted, the User Operator will delete the user it describes</p>
</li>
<li>
<p>if a <code>KafkaUser</code> is changed, the User Operator will update the user it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike the <a href="#what-the-topic-operator-does-str">Topic Operator</a>, the User Operator does not sync any changes from the Kafka cluster with the Kubernetes resources.
Unlike the Kafka topics which might be created by applications directly in Kafka, it is not expected that the users will be managed directly in the Kafka cluster in parallel with the User Operator, so this should not be needed.</p>
</div>
<div class="paragraph">
<p>The User Operator allows you to declare a <code>KafkaUser</code> as part of your application&#8217;s deployment.
When the user is created, the user credentials will be created in a <code>Secret</code>.
Your application needs to use the user and its credentials for authentication and to produce or consume messages.</p>
</div>
<div class="paragraph">
<p>In addition to managing credentials for authentication, the User Operator also manages authorization rules by including a description of the user&#8217;s rights in the <code>KafkaUser</code> declaration.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-mutual-tls-authentication-using-uo"><a class="link" href="#con-mutual-tls-authentication-using-uo">6.2. Mutual TLS authentication</a></h3>
<div class="paragraph">
<p>Mutual TLS authentication is always used for the communication between Kafka brokers and Zookeeper pods.</p>
</div>
<div class="paragraph">
<p>Mutual authentication or two-way authentication is when both the server and the client present certificates. Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication. When you configure mutual authentication, the broker authenticates the client and the client authenticates the broker.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS authentication is more commonly one-way, with one party authenticating the identity of another. For example, when HTTPS is used between a web browser and a web server, the server obtains proof of the identity of the browser.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="when_to_use_mutual_tls_authentication_for_clients_2"><a class="link" href="#when_to_use_mutual_tls_authentication_for_clients_2">6.2.1. When to use mutual TLS authentication for clients</a></h4>
<div class="paragraph">
<p>Mutual TLS authentication is recommended for authenticating Kafka clients when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client supports authentication using mutual TLS authentication</p>
</li>
<li>
<p>It is necessary to use the TLS certificates rather than passwords</p>
</li>
<li>
<p>You can reconfigure and restart client applications periodically so that they do not use expired certificates.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-creating-kafka-user-tls-using-uo"><a class="link" href="#proc-creating-kafka-user-tls-using-uo">6.3. Creating a Kafka user with mutual TLS authentication</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster configured with a listener using TLS authentication.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a YAML file containing the <code>KafkaUser</code> to be created.</p>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: literal
        operation: Read</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>KafkaUser</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Use the credentials from the secret <code>my-user</code> in your application</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about configuring a listener that authenticates using TLS see <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">Kafka broker listeners</a>.</p>
</li>
<li>
<p>For more information about deploying the Entity Operator, see <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">Entity Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>KafkaUser</code> object, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-scram-sha-authentication-using-uo"><a class="link" href="#con-scram-sha-authentication-using-uo">6.4. SCRAM-SHA authentication</a></h3>
<div class="paragraph">
<p>SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords. Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and TLS-encrypted client connections. TLS authentication is always used internally between Kafka brokers and Zookeeper nodes. When used with a TLS client connection, the TLS protocol provides encryption, but is not used for authentication.</p>
</div>
<div class="paragraph">
<p>The following properties of SCRAM make it safe to use SCRAM-SHA even on unencrypted connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The passwords are not sent in the clear over the communication channel.
Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.</p>
</li>
<li>
<p>The server and client each generate a new challenge for each authentication exchange.
This means that the exchange is resilient against replay attacks.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="supported_scram_credentials_2"><a class="link" href="#supported_scram_credentials_2">6.4.1. Supported SCRAM credentials</a></h4>
<div class="paragraph">
<p>Strimzi supports SCRAM-SHA-512 only.
When a <code>KafkaUser.spec.authentication.type</code> is configured with <code>scram-sha-512</code> the User Operator will generate a random 12 character password consisting of upper and lowercase ASCII letters and numbers.</p>
</div>
</div>
<div class="sect3">
<h4 id="when_to_use_scram_sha_authentication_for_clients_2"><a class="link" href="#when_to_use_scram_sha_authentication_for_clients_2">6.4.2. When to use SCRAM-SHA authentication for clients</a></h4>
<div class="paragraph">
<p>SCRAM-SHA is recommended for authenticating Kafka clients when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client supports authentication using SCRAM-SHA-512</p>
</li>
<li>
<p>It is necessary to use passwords rather than the TLS certificates</p>
</li>
<li>
<p>Authentication for unencrypted communication is required</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-creating-kafka-user-scram-using-uo"><a class="link" href="#proc-creating-kafka-user-scram-using-uo">6.5. Creating a Kafka user with SCRAM SHA authentication</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster configured with a listener using SCRAM SHA authentication.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a YAML file containing the <code>KafkaUser</code> to be created.</p>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: scram-sha-512
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: literal
        operation: Read</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>KafkaUser</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Use the credentials from the secret <code>my-user</code> in your application</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about configuring a listener that authenticates using SCRAM SHA see <a href="#assembly-configuring-kafka-broker-listeners-deployment-configuration-kafka">Kafka broker listeners</a>.</p>
</li>
<li>
<p>For more information about deploying the Entity Operator, see <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">Entity Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>KafkaUser</code> object, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-changing-kafka-user-using-uo"><a class="link" href="#proc-changing-kafka-user-using-uo">6.6. Editing a Kafka user</a></h3>
<div class="paragraph">
<p>This procedure describes how to change the configuration of an existing Kafka user by using a <code>KafkaUser</code> Kubernetes resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>An existing <code>KafkaUser</code> to be changed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a YAML file containing the desired <code>KafkaUser</code>.</p>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: literal
        operation: Read</code></pre>
</div>
</div>
</li>
<li>
<p>Update the <code>KafkaUser</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
<li>
<p>Use the updated credentials from the <code>my-user</code> secret in your application.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about deploying the Entity Operator, see <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">Entity Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>KafkaUser</code> object, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deleting-kafka-user-using-uo"><a class="link" href="#deleting-kafka-user-using-uo">6.7. Deleting a Kafka user</a></h3>
<div class="paragraph">
<p>This procedure describes how to delete a Kafka user created with <code>KafkaUser</code> Kubernetes resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>An existing <code>KafkaUser</code> to be deleted.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete the <code>KafkaUser</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl delete</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete kafkauser <em>your-user-name</em></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about deploying the Cluster Operator, see <a href="#cluster-operator-str">Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about the <code>KafkaUser</code> object, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ref-kafka-user-using-uo"><a class="link" href="#ref-kafka-user-using-uo">6.8. Kafka User resource</a></h3>
<div class="paragraph">
<p>The <code>KafkaUser</code> resource is used to declare a user with its authentication mechanism, authorization mechanism, and access rights.</p>
</div>
<div class="sect3">
<h4 id="authentication"><a class="link" href="#authentication">6.8.1. Authentication</a></h4>
<div class="paragraph">
<p>Authentication is configured using the <code>authentication</code> property in <code>KafkaUser.spec</code>.
The authentication mechanism enabled for this user will be specified using the <code>type</code> field.
Currently, the only supported authentication mechanisms are the TLS Client Authentication mechanism and the SCRAM-SHA-512 mechanism.</p>
</div>
<div class="paragraph">
<p>When no authentication mechanism is specified, User Operator will not create the user or its credentials.</p>
</div>
<div class="sect4">
<h5 id="tls_client_authentication_5"><a class="link" href="#tls_client_authentication_5">TLS Client Authentication</a></h5>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> field to <code>tls</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>KafkaUser</code> with enabled TLS Client Authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user is created by the User Operator, it will create a new secret with the same name as the <code>KafkaUser</code> resource.
The secret will contain a public and private key which should be used for the TLS Client Authentication.
Bundled with them will be the public key of the client certification authority which was used to sign the user certificate.
All keys will be in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example of the <code>Secret</code> with user credentials</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-user
  labels:
    strimzi.io/kind: KafkaUser
    strimzi.io/cluster: my-cluster
type: Opaque
data:
  ca.crt: # Public key of the Clients CA
  user.crt: # Public key of the user
  user.key: # Private key of the user</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scram_sha_512_authentication_2"><a class="link" href="#scram_sha_512_authentication_2">SCRAM-SHA-512 Authentication</a></h5>
<div class="paragraph">
<p>To use SCRAM-SHA-512 authentication mechanism, set the <code>type</code> field to <code>scram-sha-512</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>KafkaUser</code> with enabled SCRAM-SHA-512 authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: scram-sha-512
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user is created by the User Operator, the User Operator will create a new secret with the same name as the <code>KafkaUser</code> resource.
The secret contains the generated password in the <code>password</code> key, which is encoded with base64. In order to use the password it must be decoded.</p>
</div>
<div class="listingblock">
<div class="title">An example of the <code>Secret</code> with user credentials</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-user
  labels:
    strimzi.io/kind: KafkaUser
    strimzi.io/cluster: my-cluster
type: Opaque
data:
  password: Z2VuZXJhdGVkcGFzc3dvcmQ= # Generated password</code></pre>
</div>
</div>
<div class="paragraph">
<p>For decode the generated password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo "Z2VuZXJhdGVkcGFzc3dvcmQ=" | base64 --decode</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="simple-acl-using-uo"><a class="link" href="#simple-acl-using-uo">6.8.2. Authorization</a></h4>
<div class="paragraph">
<p>Authorization is configured using the <code>authorization</code> property in <code>KafkaUser.spec</code>.
The authorization type enabled for a user is specified using the <code>type</code> field.
Currently, the only supported authorization type is simple authorization.</p>
</div>
<div class="paragraph">
<p>If no authorization is specified, the User Operator does not provision any access rights for the user.</p>
</div>
<div class="sect4">
<h5 id="simple_authorization_2"><a class="link" href="#simple_authorization_2">Simple authorization</a></h5>
<div class="paragraph">
<p>Simple authorization uses the default Kafka authorization plugin, <code>SimpleAclAuthorizer</code>.</p>
</div>
<div class="paragraph">
<p>To use simple authorization, set the <code>type</code> property to <code>simple</code> in <code>KafkaUser.spec</code>.</p>
</div>
<div class="paragraph">
<div class="title">ACL rules</div>
<p><code>SimpleAclAuthorizer</code> uses ACL rules to manage access to Kafka brokers.</p>
</div>
<div class="paragraph">
<p>ACL rules grant access rights to the user, which you specify in the <code>acls</code> property.</p>
</div>
<div class="paragraph">
<p>An <code>AclRule</code> is specified as a set of properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>resource</code></dt>
<dd>
<p>The <code>resource</code> property specifies the resource that the rule applies to.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Simple authorization supports four resource types, which are specified in the <code>type</code> property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topics (<code>topic</code>)</p>
</li>
<li>
<p>Consumer Groups (<code>group</code>)</p>
</li>
<li>
<p>Clusters (<code>cluster</code>)</p>
</li>
<li>
<p>Transactional IDs (<code>transactionalId</code>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For Topic, Group, and Transactional ID resources you can specify the name of the resource the rule applies to in the <code>name</code> property.</p>
</div>
<div class="paragraph">
<p>Cluster type resources have no name.</p>
</div>
<div class="paragraph">
<p>A name is specified as a <code>literal</code> or a <code>prefix</code> using the <code>patternType</code> property.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literal names are taken exactly as they are specified in the <code>name</code> field.</p>
</li>
<li>
<p>Prefix names use the value from the <code>name</code> as a prefix, and will apply the rule to all resources with names starting with the value.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<p>The <code>type</code> property specifies the type of ACL rule, <code>allow</code> or <code>deny</code>.</p>
<div class="paragraph">
<p>The <code>type</code> field is optional.
If <code>type</code> is unspecified, the ACL rule is treated as an <code>allow</code> rule.</p>
</div>
</dd>
<dt class="hdlist1"><code>operation</code></dt>
<dd>
<p>The <code>operation</code> specifies the operation to allow or deny.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following operations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read</p>
</li>
<li>
<p>Write</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Alter</p>
</li>
<li>
<p>Describe</p>
</li>
<li>
<p>All</p>
</li>
<li>
<p>IdempotentWrite</p>
</li>
<li>
<p>ClusterAction</p>
</li>
<li>
<p>Create</p>
</li>
<li>
<p>AlterConfigs</p>
</li>
<li>
<p>DescribeConfigs</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Only certain operations work with each resource.</p>
</div>
<div class="paragraph">
<p>For more details about <code>SimpleAclAuthorizer</code>, ACLs and supported combinations of resources and operations, see <a href="http://kafka.apache.org/documentation/#security_authz" target="_blank" rel="noopener">Authorization and ACLs</a>.</p>
</div>
</dd>
<dt class="hdlist1"><code>host</code></dt>
<dd>
<p>The <code>host</code> property specifies a remote host from which the rule is allowed or denied.</p>
<div class="paragraph">
<p>Use an asterisk (<code>*</code>) to allow or deny the operation from all hosts.
The <code>host</code> field is optional. If <code>host</code> is unspecified, the <code>*</code> value is used by default.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more information about the <code>AclRule</code> object, see <a href="#type-AclRule-reference"><code>AclRule</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: prefix
        operation: Read</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="super_user_access_to_kafka_brokers"><a class="link" href="#super_user_access_to_kafka_brokers">Super user access to Kafka brokers</a></h5>
<div class="paragraph">
<p>If a user is added to a list of super users in a Kafka broker configuration, the user is allowed unlimited access to the cluster regardless of any authorization constraints defined in ACLs.</p>
</div>
<div class="paragraph">
<p>For more information on configuring super users, see <a href="#assembly-kafka-authentication-and-authorization-deployment-configuration-kafka">authentication and authorization</a> of Kafka brokers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="additional_resources"><a class="link" href="#additional_resources">6.8.3. Additional resources</a></h4>
<div class="ulist">
<ul>
<li>
<p>For more information about the <code>KafkaUser</code> object, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
<li>
<p>For more information about the TLS Client Authentication, see <a href="#con-mutual-tls-authentication-using-uo">Mutual TLS authentication</a>.</p>
</li>
<li>
<p>For more information about the SASL SCRAM-SHA-512 authentication, see <a href="#con-scram-sha-authentication-using-uo">SCRAM-SHA authentication</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kafka-bridge-concepts-str"><a class="link" href="#kafka-bridge-concepts-str">7. Kafka Bridge</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an overview of the Strimzi Kafka Bridge and helps you get started using its REST API to interact with Strimzi. To try out the Kafka Bridge in your local environment, see the <a href="#assembly-kafka-bridge-quickstart-str">Kafka Bridge quickstart</a> later in this chapter.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For information on how to deploy the Kafka Bridge, see <a href="#kafka-bridge-str">Kafka Bridge</a> in the <em>Getting started with Strimzi</em> chapter.</p>
</li>
<li>
<p>For detailed information on configuring the Kafka Bridge, see <a href="#assembly-deployment-configuration-kafka-bridge-str">Kafka Bridge configuration</a> in the <em>Deployment configuration</em> chapter</p>
</li>
<li>
<p>To view the API documentation, including example requests and responses, see the <a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Kafka Bridge API reference</a> on the Strimzi website.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="assembly-kafka-bridge-overview-str"><a class="link" href="#assembly-kafka-bridge-overview-str">7.1. Kafka Bridge overview</a></h3>
<div class="paragraph">
<p>The Strimzi Kafka Bridge provides an API for integrating HTTP-based clients with a Kafka cluster running on Kubernetes. The API enables such clients to produce and consume messages without the requirement to use the native Kafka protocol.</p>
</div>
<div class="paragraph">
<p>The API has two main resources&#8201;&#8212;&#8201;<code>consumers</code> and <code>topics</code>&#8201;&#8212;&#8201;that are exposed and made accessible through endpoints to interact with consumers and producers in your Kafka cluster. The resources relate only to the Kafka Bridge, not the consumers and producers connected directly to Kafka.</p>
</div>
<div class="paragraph">
<p>You can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send messages to a topic.</p>
</li>
<li>
<p>Create and delete consumers.</p>
</li>
<li>
<p>Subscribe consumers to topics, so that they start receiving messages from those topics.</p>
</li>
<li>
<p>Unsubscribe consumers from topics.</p>
</li>
<li>
<p>Assign partitions to consumers.</p>
</li>
<li>
<p>Retrieve messages from topics.</p>
</li>
<li>
<p>Commit a list of consumer offsets.</p>
</li>
<li>
<p>Seek on a partition, so that a consumer starts receiving messages from the first or last offset position, or a given offset position.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You deploy the Kafka Bridge into your Kubernetes cluster by using the Cluster Operator. For deployment instructions, see <a href="#deploying-kafka-bridge-str">Deploying Kafka Bridge to your Kubernetes cluster</a>.</p>
</div>
<div class="paragraph">
<p>After the Kafka Bridge is deployed, the Cluster Operator creates a Deployment, Service, and Pod in your Kubernetes cluster, each named <code>strimzi-kafka-bridge</code> by default.</p>
</div>
<div class="sect3">
<h4 id="con-supported-clients-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-supported-clients-kafka-bridge-kafka-bridge-overview">7.1.1. Supported clients for the Kafka Bridge</a></h4>
<div class="paragraph">
<p>You can use the Kafka Bridge to integrate both <em>internal</em> and <em>external</em> HTTP client applications with your Kafka cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internal clients are container-based HTTP clients running in <em>the same</em> Kubernetes cluster as the Kafka Bridge itself.</p>
</li>
<li>
<p>External clients are HTTP clients running <em>outside</em> the Kubernetes cluster in which the Kafka Bridge is deployed and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">HTTP internal and external client integration</div>
<p><span class="image"><img src="images/kafka-bridge.png" alt="Kafka Bridge"></span></p>
</div>
<div class="paragraph">
<p>Internal clients can access the Kafka Bridge on the host and port defined in the <code>KafkaBridge</code> custom resource.</p>
</div>
<div class="paragraph">
<p>External clients can access the Kafka Bridge through an OpenShift Route, a loadbalancer service, or using an Ingress.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on configuring the host and port for the <code>KafkaBridge</code> resource, see <a href="#ref-kafka-bridge-http-configuration-deployment-configuration-kafka-bridge">Kafka Bridge HTTP configuration</a>.</p>
</li>
<li>
<p>For more information on integrating external clients, see <a href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">Accessing the Kafka Bridge outside of Kubernetes</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-securing-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-securing-kafka-bridge-kafka-bridge-overview">7.1.2. Securing the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Strimzi does not currently provide any encryption, authentication, or authorization for the Kafka Bridge. This means that requests sent from external clients to the Kafka Bridge are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Not encrypted, and must use HTTP rather than HTTPS</p>
</li>
<li>
<p>Sent without authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, you can secure the Kafka Bridge using other methods, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes Network Policies that define which pods can access the Kafka Bridge.</p>
</li>
<li>
<p>Reverse proxies with authentication or authorization, for example, OAuth2 proxies.</p>
</li>
<li>
<p>API Gateways.</p>
</li>
<li>
<p>Ingress or OpenShift Routes with TLS termination.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Kafka Bridge supports TLS encryption and TLS and SASL authentication when connecting to the Kafka Brokers. Within your Kubernetes cluster, you can configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS or SASL-based authentication between the Kafka Bridge and your Kafka cluster</p>
</li>
<li>
<p>A TLS-encrypted connection between the Kafka Bridge and your Kafka cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="#con-kafka-bridge-authentication-deployment-configuration-kafka-bridge">Authentication support in Kafka Bridge</a>.</p>
</div>
<div class="paragraph">
<p>You can use ACLs in Kafka brokers to restrict the topics that can be consumed and produced using the Kafka Bridge.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-accessing-kafka-bridge-from-outside-kafka-bridge-overview"><a class="link" href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">7.1.3. Accessing the Kafka Bridge outside of Kubernetes</a></h4>
<div class="paragraph">
<p>After deployment, the Strimzi Kafka Bridge can only be accessed by applications running in the same Kubernetes cluster. These applications use the <code><em>kafka-bridge-name</em>-bridge-service</code> Service to access the API.</p>
</div>
<div class="paragraph">
<p>If you want to make the Kafka Bridge accessible to applications running outside of the Kubernetes cluster, you can expose it manually by using one of the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Services of types LoadBalancer or NodePort</p>
</li>
<li>
<p>Ingress resources</p>
</li>
<li>
<p>OpenShift Routes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you decide to create Services, use the following labels in the <code>selector</code> to configure the pods to which the service will route the traffic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">  # ...
  selector:
    strimzi.io/cluster: kafka-bridge-name <b class="conum">(1)</b>
    strimzi.io/kind: KafkaBridge
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name of the Kafka Bridge custom resource in your Kubernetes cluster.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-requests-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-requests-kafka-bridge-kafka-bridge-overview">7.1.4. Requests to the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Specify data formats and HTTP headers to ensure valid requests are submitted to the Kafka Bridge.</p>
</div>
<div class="sect4">
<h5 id="content_type_headers"><a class="link" href="#content_type_headers">Content Type headers</a></h5>
<div class="paragraph">
<p>API request and response bodies are always encoded as JSON.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When performing consumer operations, <code>POST</code> requests must provide the following <code>Content-Type</code> header if there is a non-empty body:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Content-Type: application/vnd.kafka.v2+json</code></pre>
</div>
</div>
</li>
<li>
<p>When performing producer operations, <code>POST</code> requests must provide <code>Content-Type</code> headers specifying the desired <em>embedded data format</em>, either <code>json</code> or <code>binary</code>, as shown in the following table.</p>
<table class="tableblock frame-all grid-all stripes-none fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Embedded data format</th>
<th class="tableblock halign-left valign-top">Content-Type header</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Content-Type: application/vnd.kafka.json.v2+json</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Content-Type: application/vnd.kafka.binary.v2+json</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>You set the embedded data format when creating a consumer using the <code>consumers/<em>groupid</em></code> endpoint&#8212;&#8203;for more information, see the next section.</p>
</div>
<div class="paragraph">
<p>The <code>Content-Type</code> must not be set if the <code>POST</code> request has an empty body.
An empty body can be used to create a consumer with the default values.</p>
</div>
</div>
<div class="sect4">
<h5 id="embedded_data_format"><a class="link" href="#embedded_data_format">Embedded data format</a></h5>
<div class="paragraph">
<p>The embedded data format is the format of the Kafka messages that are transmitted, over HTTP, from a producer to a consumer using the Kafka Bridge. Two embedded data formats are supported: JSON and binary.</p>
</div>
<div class="paragraph">
<p>When creating a consumer using the <code>/consumers/<em>groupid</em></code> endpoint, the <code>POST</code> request body must specify an embedded data format of either JSON or binary. This is specified in the <code>format</code> field, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "name": "my-consumer",
  "format": "binary", <b class="conum">(1)</b>
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A binary embedded data format.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The embedded data format specified when creating a consumer must match the data format of the Kafka messages it will consume.</p>
</div>
<div class="paragraph">
<p>If you choose to specify a binary embedded data format, subsequent producer requests must provide the binary data in the request body as Base64-encoded strings. For example, when sending messages using the <code>/topics/<em>topicname</em></code> endpoint, <code>records.value</code> must be encoded in Base64:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "records": [
    {
      "key": "my-key",
      "value": "ZWR3YXJkdGhldGhyZWVsZWdnZWRjYXQ="
    },
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Producer requests must also provide a <code>Content-Type</code> header that corresponds to the embedded data format, for example, <code>Content-Type: application/vnd.kafka.binary.v2+json</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="accept_headers"><a class="link" href="#accept_headers">Accept headers</a></h5>
<div class="paragraph">
<p>After creating a consumer, all subsequent GET requests must provide an <code>Accept</code> header in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Accept: application/vnd.kafka.<em>embedded-data-format</em>.v2+json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>embedded-data-format</code> is either <code>json</code> or <code>binary</code>.</p>
</div>
<div class="paragraph">
<p>For example, when retrieving records for a subscribed consumer using an embedded data format of JSON, include this Accept header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Accept: application/vnd.kafka.json.v2+json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-loggers-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-loggers-kafka-bridge-kafka-bridge-overview">7.1.5. Configuring loggers for the Kafka Bridge</a></h4>
<div class="paragraph">
<p>The Strimzi Kafka bridge allows you to set a different log level for each operation that is defined by the related OpenAPI specification.</p>
</div>
<div class="paragraph">
<p>Each operation has a corresponding API endpoint through which the bridge receives requests from HTTP clients.
You can change the log level on each endpoint to produce more or less fine-grained logging information about the incoming and outgoing HTTP requests.</p>
</div>
<div class="paragraph">
<p>Loggers are defined in the <code>log4j.properties</code> file, which has the following default configuration for <code>healthy</code> and <code>ready</code> endpoints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">log4j.logger.http.openapi.operation.healthy=WARN, out
log4j.additivity.http.openapi.operation.healthy=false
log4j.logger.http.openapi.operation.ready=WARN, out
log4j.additivity.http.openapi.operation.ready=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log level of all other operations is set to <code>INFO</code> by default.
Loggers are formatted as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">log4j.logger.http.openapi.operation.&lt;operation-id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;operation-id&gt;</code> is the identifier of the specific operation.
Following is the list of operations defined by the OpenAPI specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createConsumer</code></p>
</li>
<li>
<p><code>deleteConsumer</code></p>
</li>
<li>
<p><code>subscribe</code></p>
</li>
<li>
<p><code>unsubscribe</code></p>
</li>
<li>
<p><code>poll</code></p>
</li>
<li>
<p><code>assign</code></p>
</li>
<li>
<p><code>commit</code></p>
</li>
<li>
<p><code>send</code></p>
</li>
<li>
<p><code>sendToPartition</code></p>
</li>
<li>
<p><code>seekToBeginning</code></p>
</li>
<li>
<p><code>seekToEnd</code></p>
</li>
<li>
<p><code>seek</code></p>
</li>
<li>
<p><code>healthy</code></p>
</li>
<li>
<p><code>ready</code></p>
</li>
<li>
<p><code>openapi</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-api-resources-kafka-bridge-kafka-bridge-overview"><a class="link" href="#ref-api-resources-kafka-bridge-kafka-bridge-overview">7.1.6. Kafka Bridge API resources</a></h4>
<div class="paragraph">
<p>For the full list of REST API endpoints and descriptions, including example requests and responses, see the <a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Kafka Bridge API reference</a> on the Strimzi website.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-kafka-bridge-quickstart-str"><a class="link" href="#assembly-kafka-bridge-quickstart-str">7.2. Kafka Bridge quickstart</a></h3>
<div class="paragraph">
<p>Use this quickstart to try out the Strimzi Kafka Bridge in your local development environment. You will learn how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the Kafka Bridge to your Kubernetes cluster</p>
</li>
<li>
<p>Expose the Kafka Bridge service to your local machine by using port-forwarding</p>
</li>
<li>
<p>Produce messages to topics and partitions in your Kafka cluster</p>
</li>
<li>
<p>Create a Kafka Bridge consumer</p>
</li>
<li>
<p>Perform basic consumer operations, such as subscribing the consumer to topics and retrieving the messages that you produced</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this quickstart, HTTP requests are formatted as curl commands that you can copy and paste to your terminal. Access to a Kubernetes cluster is required; to run and manage a local Kubernetes cluster, use a tool such as Minikube, CodeReady Containers, or MiniShift.</p>
</div>
<div class="paragraph">
<p>Ensure you have the prerequisites and then follow the tasks in the order provided in this chapter.</p>
</div>
<div class="paragraph">
<div class="title">About data formats</div>
<p>In this quickstart, you will produce and consume messages in JSON format, not binary. For more information on the data formats and HTTP headers used in the example requests, see <a href="#con-requests-kafka-bridge-kafka-bridge-overview">Requests to the Kafka Bridge</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites for the quickstart</div>
<ul>
<li>
<p>Cluster administrator access to a local or remote Kubernetes cluster.</p>
</li>
<li>
<p>Strimzi is installed.</p>
</li>
<li>
<p>A running Kafka cluster, deployed by the Cluster Operator, in a Kubernetes namespace.</p>
</li>
<li>
<p>The Entity Operator is deployed and running as part of the Kafka cluster.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart"><a class="link" href="#proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart">7.2.1. Deploying the Kafka Bridge to your Kubernetes cluster</a></h4>
<div class="paragraph">
<p>Strimzi includes a YAML example that specifies the configuration of the Strimzi Kafka Bridge. Make some minimal changes to this file and then deploy an instance of the Kafka Bridge to your Kubernetes cluster.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>examples/kafka-bridge/kafka-bridge.yaml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: quickstart <b class="conum">(1)</b>
spec:
  replicas: 1
  bootstrapServers: &lt;cluster-name&gt;-kafka-bootstrap:9092 <b class="conum">(2)</b>
  http:
    port: 8080</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When the Kafka Bridge is deployed, <code>-bridge</code> is appended to the name of the deployment and other related resources. In this example, the Kafka Bridge deployment is named <code>quickstart-bridge</code> and the accompanying Kafka Bridge service is named <code>quickstart-bridge-service</code>.</p>
</li>
<li>
<p>In the <code>bootstrapServers</code> property, enter the name of the Kafka cluster as the <code>&lt;cluster-name&gt;</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the Kafka Bridge to your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/kafka-bridge/kafka-bridge.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>quickstart-bridge</code> deployment, service, and other related resources are created in your Kubernetes cluster.</p>
</div>
</li>
<li>
<p>Verify that the Kafka Bridge was successfully deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get deployments</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
quickstart-bridge                  1/1     1            1          34m
my-cluster-connect                 1/1     1            1          24h
my-cluster-entity-operator         1/1     1            1          24h
#...</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After deploying the Kafka Bridge to your Kubernetes cluster, <a href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">expose the Kafka Bridge service to your local machine</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more detailed information about configuring the Kafka Bridge, see <a href="#assembly-deployment-configuration-kafka-bridge-str">Kafka Bridge configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart"><a class="link" href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">7.2.2. Exposing the Kafka Bridge service to your local machine</a></h4>
<div class="paragraph">
<p>Next, use port forwarding to expose the Strimzi Kafka Bridge service to your local machine on <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Port forwarding is only suitable for development and testing purposes.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>List the names of the pods in your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get pods -o name

pod/kafka-consumer
# ...
pod/quickstart-bridge-589d78784d-9jcnr
pod/strimzi-cluster-operator-76bcf9bc76-8dnfm</code></pre>
</div>
</div>
</li>
<li>
<p>Connect to the <code>quickstart-bridge</code> pod on port <code>8080</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl port-forward pod/quickstart-bridge-589d78784d-9jcnr 8080:8080 &amp;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If port 8080 on your local machine is already in use, use an alternative HTTP port, such as <code>8008</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>API requests are now forwarded from port 8080 on your local machine to port 8080 in the Kafka Bridge pod.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart"><a class="link" href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">7.2.3. Producing messages to topics and partitions</a></h4>
<div class="paragraph">
<p>Next, produce messages to topics in JSON format by using the <a href="https://strimzi.io/docs/bridge/latest/#_send" target="_blank" rel="noopener">topics</a> endpoint. You can specify destination partitions for messages in the request body, as shown here. The <a href="https://strimzi.io/docs/bridge/latest/#_sendtopartition" target="_blank" rel="noopener">partitions</a> endpoint provides an alternative method for specifying a single destination partition for all messages as a path parameter.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a text editor, create a YAML definition for a Kafka topic with three partitions.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: bridge-quickstart-topic
  labels:
    strimzi.io/cluster: &lt;kafka-cluster-name&gt; <b class="conum">(1)</b>
spec:
  partitions: 3 <b class="conum">(2)</b>
  replicas: 1
  config:
    retention.ms: 7200000
    segment.bytes: 1073741824</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the Kafka cluster in which the Kafka Bridge is deployed.</p>
</li>
<li>
<p>The number of partitions for the topic.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save the file to the <code>examples/topic</code> directory as <code>bridge-quickstart-topic.yaml</code>.</p>
</li>
<li>
<p>Create the topic in your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/topic/bridge-quickstart-topic.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Using the Kafka Bridge, produce three messages to the topic you created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST \
  http://localhost:8080/topics/bridge-quickstart-topic \
  -H 'content-type: application/vnd.kafka.json.v2+json' \
  -d '{
    "records": [
        {
            "key": "my-key",
            "value": "sales-lead-0001"
        },
        {
            "value": "sales-lead-0002",
            "partition": 2
        },
        {
            "value": "sales-lead-0003"
        }
    ]
}'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sales-lead-0001</code> is sent to a partition based on the hash of the key.</p>
</li>
<li>
<p><code>sales-lead-0002</code> is sent directly to partition 2.</p>
</li>
<li>
<p><code>sales-lead-0003</code> is sent to a partition in the <code>bridge-quickstart-topic</code> topic using a round-robin method.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the request is successful, the Kafka Bridge returns an <code>offsets</code> array, along with a <code>200</code> code and a <code>content-type</code> header of <code>application/vnd.kafka.v2+json</code>. For each message, the <code>offsets</code> array describes:</p>
<div class="ulist">
<ul>
<li>
<p>The partition that the message was sent to</p>
</li>
<li>
<p>The current message offset of the partition</p>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">#...
{
  "offsets":[
    {
      "partition":0,
      "offset":0
    },
    {
      "partition":2,
      "offset":0
    },
    {
      "partition":0,
      "offset":1
    }
  ]
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After producing messages to topics and partitions, <a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">create a Kafka Bridge consumer</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_send" target="_blank" rel="noopener">POST /topics/{topicname}</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_sendtopartition" target="_blank" rel="noopener">POST /topics/{topicname}/partitions/{partitionid}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">7.2.4. Creating a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Before you can perform any consumer operations in the Kafka cluster, you must first create a consumer by using the <a href="https://strimzi.io/docs/bridge/latest/#_createconsumer" target="_blank" rel="noopener">consumers</a> endpoint. The consumer is referred to as a <em>Kafka Bridge consumer</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka Bridge consumer in a new consumer group named <code>bridge-quickstart-consumer-group</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "name": "bridge-quickstart-consumer",
    "auto.offset.reset": "earliest",
    "format": "json",
    "enable.auto.commit": false,
    "fetch.min.bytes": 512,
    "consumer.request.timeout.ms": 30000
  }'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The consumer is named <code>bridge-quickstart-consumer</code> and the embedded data format is set as <code>json</code>.</p>
</li>
<li>
<p>Some basic configuration settings are defined.</p>
</li>
<li>
<p>The consumer will not commit offsets to the log automatically because the <code>enable.auto.commit</code> setting is <code>false</code>. You will commit the offsets manually later in this quickstart.</p>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns the consumer ID (<code>instance_id</code>) and base URL (<code>base_uri</code>) in the response body, along with a <code>200</code> code.</p>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">#...
{
  "instance_id": "bridge-quickstart-consumer",
  "base_uri":"http://&lt;bridge-name&gt;-bridge-service:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the base URL (<code>base_uri</code>) to use in the other consumer operations in this quickstart.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>Now that you have created a Kafka Bridge consumer, you can  <a href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">subscribe it to topics</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_createconsumer" target="_blank" rel="noopener">POST /consumers/{groupid}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">7.2.5. Subscribing a Kafka Bridge consumer to topics</a></h4>
<div class="paragraph">
<p>After you have created a Kafka Bridge consumer, subscribe it to one or more topics by using the <a href="https://strimzi.io/docs/bridge/latest/#_subscribe" target="_blank" rel="noopener">subscription</a> endpoint. Once subscribed, the consumer starts receiving all messages that are produced to the topic.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Subscribe the consumer to the <code>bridge-quickstart-topic</code> topic that you created earlier, in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/subscription \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "topics": [
        "bridge-quickstart-topic"
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>topics</code> array can contain a single topic (as shown here) or multiple topics. If you want to subscribe the consumer to multiple topics that match a regular expression, you can use the <code>topic_pattern</code> string instead of the <code>topics</code> array.</p>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> (No Content) code only.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After subscribing a Kafka Bridge consumer to topics, you can <a href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">retrieve messages from the consumer</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_subscribe" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/subscription</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">7.2.6. Retrieving the latest messages from a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Next, retrieve the latest messages from the Kafka Bridge consumer by requesting data from the <a href="https://strimzi.io/docs/bridge/latest/#_poll" target="_blank" rel="noopener">records</a> endpoint. In production, HTTP clients can call this endpoint repeatedly (in a loop).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Produce additional messages to the Kafka Bridge consumer, as described in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>.</p>
</li>
<li>
<p>Submit a <code>GET</code> request to the <code>records</code> endpoint:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X GET http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/records \
  -H 'accept: application/vnd.kafka.json.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating and subscribing to a Kafka Bridge consumer, a first GET request will return an empty response because the poll operation starts a rebalancing process to assign partitions.</p>
</div>
</li>
<li>
<p>Repeat step two to retrieve messages from the Kafka Bridge consumer.</p>
<div class="paragraph">
<p>The Kafka Bridge returns an array of messages&#8201;&#8212;&#8201;describing the topic name, key, value, partition, and offset&#8201;&#8212;&#8201;in the response body, along with a <code>200</code> code. Messages are retrieved from the latest offset by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">HTTP/1.1 200 OK
content-type: application/vnd.kafka.json.v2+json
#...
[
  {
    "topic":"bridge-quickstart-topic",
    "key":"my-key",
    "value":"sales-lead-0001",
    "partition":0,
    "offset":0
  },
  {
    "topic":"bridge-quickstart-topic",
    "key":null,
    "value":"sales-lead-0003",
    "partition":0,
    "offset":1
  },
#...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If an empty response is returned, produce more records to the consumer as described in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>, and then try retrieving messages again.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After retrieving messages from a Kafka Bridge consumer, try <a href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">committing offsets to the log</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_poll" target="_blank" rel="noopener">GET /consumers/{groupid}/instances/{name}/records</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">7.2.7. Commiting offsets to the log</a></h4>
<div class="paragraph">
<p>Next, use the <a href="https://strimzi.io/docs/bridge/latest/#_commit" target="_blank" rel="noopener">offsets</a> endpoint to manually commit  offsets to the log for all messages received by the Kafka Bridge consumer. This is required because the Kafka Bridge consumer that you created earlier, in <a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">Creating a Kafka Bridge consumer</a>, was configured with the <code>enable.auto.commit</code> setting as <code>false</code>.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Commit offsets to the log for the <code>bridge-quickstart-consumer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/offsets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because no request body is submitted, offsets are committed for all the records that have been received by the consumer. Alternatively, the request body can contain an array (<a href="https://strimzi.io/docs/bridge/latest/#_offsetcommitseeklist" target="_blank" rel="noopener">OffsetCommitSeekList</a>) that specifies the topics and partitions that you want to commit offsets for.</p>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After committing offsets to the log, try out the endpoints for <a href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">seeking to offsets</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_commit">POST /consumers/{groupid}/instances/{name}/offsets</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">7.2.8. Seeking to offsets for a partition</a></h4>
<div class="paragraph">
<p>Next, use the <a href="https://strimzi.io/docs/bridge/latest/#_seek" target="_blank" rel="noopener">positions</a> endpoints to configure the Kafka Bridge consumer to retrieve messages for a partition from a specific offset, and then from the latest offset. This is referred to in Apache Kafka as a seek operation.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Seek to a specific offset for partition 0 of the <code>quickstart-bridge-topic</code> topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/positions \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "offsets": [
        {
            "topic": "bridge-quickstart-topic",
            "partition": 0,
            "offset": 2
        }
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
<li>
<p>Submit a <code>GET</code> request to the <code>records</code> endpoint:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X GET http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/records \
  -H 'accept: application/vnd.kafka.json.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kafka Bridge returns messages from the offset that you seeked to.</p>
</div>
</li>
<li>
<p>Restore the default message retrieval behavior by seeking to the last offset for the same partition. This time, use the <a href="https://strimzi.io/docs/bridge/latest/#_seektoend" target="_blank" rel="noopener">positions/end</a> endpoint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/positions/end \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "partitions": [
        {
            "topic": "bridge-quickstart-topic",
            "partition": 0
        }
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns another <code>204</code> code.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also use the <a href="https://strimzi.io/docs/bridge/latest/#_seektobeginning" target="_blank" rel="noopener">positions/beginning</a> endpoint to seek to the first offset for one or more partitions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>In this quickstart, you have used the Strimzi Kafka Bridge to perform several common operations on a Kafka cluster. You can now <a href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">delete the Kafka Bridge consumer</a> that you created earlier.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seek" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seektobeginning" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions/beginning</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seektoend" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions/end</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-deleting-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">7.2.9. Deleting a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Finally, delete the Kafa Bridge consumer that you used throughout this quickstart.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete the Kafka Bridge consumer by sending a <code>DELETE</code> request to the <a href="https://strimzi.io/docs/bridge/latest/#_deleteconsumer" target="_blank" rel="noopener">instances</a> endpoint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X DELETE http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_deleteconsumer" target="_blank" rel="noopener">DELETE /consumers/{groupid}/instances/{name}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-metrics-setup-str"><a class="link" href="#assembly-metrics-setup-str">8. Introducing Metrics</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to monitor Strimzi Kafka, Zookeeper and Kafka Connect clusters using Prometheus to provide monitoring data for example Grafana dashboards.</p>
</div>
<div class="paragraph">
<p>In order to run the example Grafana dashboards, you must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#assembly-metrics-kafka-str">Add metrics configuration to your Kafka cluster resource</a></p>
</li>
<li>
<p><a href="#assembly-metrics-prometheus-str">Deploy Prometheus and Prometheus Alertmanager</a></p>
</li>
<li>
<p><a href="#assembly-metrics-grafana-str">Deploy Grafana</a></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The resources referenced in this section are intended as a starting point for setting up monitoring, but they are provided as examples only.
If you require further support on configuring and running Prometheus or Grafana in production, try reaching out to their respective communities.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Kafka Exporter</div>
<p>When you have Prometheus and Grafana enabled, you can also use Kafka Exporter to provide additional monitoring related to consumer lag.
For more information, see <a href="#assembly-kafka-exporter-str">Kafka Exporter</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Prometheus, see the <a href="https://prometheus.io/docs/introduction/overview/">Prometheus documentation</a>.</p>
</li>
<li>
<p>For more information about Grafana, see the <a href="https://grafana.com/docs/guides/getting_started/">Grafana documentation</a>.</p>
</li>
<li>
<p><a href="http://kafka.apache.org/documentation/#monitoring">Apache Kafka Monitoring</a> describes JMX metrics exposed by Apache Kafka.</p>
</li>
<li>
<p><a href="https://zookeeper.apache.org/doc/current/zookeeperJMX.html">Zookeeper JMX</a> describes JMX metrics exposed by Apache Zookeeper.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ref-metrics-config-files-str"><a class="link" href="#ref-metrics-config-files-str">8.1. Example Metrics files</a></h3>
<div class="paragraph">
<p>You can find the example metrics configuration files in the <code>examples/metrics</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">metrics
 grafana-install
    grafana.yaml <b class="conum">(1)</b>
 grafana-dashboards <b class="conum">(2)</b>
    strimzi-kafka-connect.json
    strimzi-kafka.json
    strimzi-zookeeper.json
    strimzi-kafka-exporter.json <b class="conum">(3)</b>
 kafka-connect-metrics.yaml <b class="conum">(4)</b>
 kafka-metrics.yaml <b class="conum">(5)</b>
 prometheus-additional-properties
    prometheus-additional.yaml <b class="conum">(6)</b>
 prometheus-alertmanager-config
    alert-manager-config.yaml <b class="conum">(7)</b>
 prometheus-install
     alert-manager.yaml <b class="conum">(8)</b>
     prometheus-rules.yaml <b class="conum">(9)</b>
     prometheus.yaml <b class="conum">(10)</b>
     strimzi-service-monitor.yaml <b class="conum">(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Installation file for the Grafana image</p>
</li>
<li>
<p>Grafana dashboard configuration</p>
</li>
<li>
<p>Grafana dashboard configuration specific to <a href="#assembly-kafka-exporter-str">Kafka Exporter</a></p>
</li>
<li>
<p>Metrics configuration that defines Prometheus JMX Exporter relabeling rules for Kafka Connect</p>
</li>
<li>
<p>Metrics configuration that defines Prometheus JMX Exporter relabeling rules for Kafka and Zookeeper</p>
</li>
<li>
<p>Configuration to add roles for service monitoring</p>
</li>
<li>
<p>Hook definitions for sending notifications through Alertmanager</p>
</li>
<li>
<p>Resources for deploying and configuring Alertmanager</p>
</li>
<li>
<p>Alerting rules examples for use with Prometheus Alertmanager (deployed with Prometheus)</p>
</li>
<li>
<p>Installation file for the Prometheus image</p>
</li>
<li>
<p>Prometheus job definitions to scrape metrics data</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="assembly-metrics-kafka-str"><a class="link" href="#assembly-metrics-kafka-str">8.2. Prometheus metrics</a></h3>
<div class="paragraph">
<p>Strimzi uses the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX Exporter</a> to expose JMX metrics from Kafka and Zookeeper using an HTTP endpoint, which is then scraped by the Prometheus server.</p>
</div>
<div class="sect3">
<h4 id="con-metrics-kafka-options-str"><a class="link" href="#con-metrics-kafka-options-str">8.2.1. Prometheus metrics configuration</a></h4>
<div class="paragraph">
<p>Strimzi provides <a href="#ref-metrics-config-files-str">example configuration files for Grafana</a>.</p>
</div>
<div class="paragraph">
<p>Grafana dashboards are dependent on Prometheus JMX Exporter relabeling rules, which are defined for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka and Zookeeper as a <code>Kafka</code> resource configuration in the example <code>kafka-metrics.yaml</code> file</p>
</li>
<li>
<p>Kafka Connect as <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources in the example <code>kafka-connect-metrics.yaml</code> file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A label is a name-value pair. Relabeling is the process of writing a label dynamically. For example, the value of a label may be derived from the name of a Kafka server and client ID.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
We show metrics configuration using <code>kafka-metrics.yaml</code> in this section, but the process is the same when configuring Kafka Connect using the <code>kafka-connect-metrics.yaml</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information on the use of relabeling, see <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration" target="_blank" rel="noopener">Configuration</a> in the Prometheus documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-metrics-kafka-deploy-options-str"><a class="link" href="#con-metrics-kafka-deploy-options-str">8.2.2. Prometheus metrics deployment options</a></h4>
<div class="paragraph">
<p>To apply the example metrics configuration of relabeling rules to your Kafka cluster, do one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-metrics-kafka-str">Copy the example configuration to your own <code>Kafka</code> resource definition</a></p>
</li>
<li>
<p><a href="#proc-metrics-deploying-kafka-str">Deploy an example Kafka cluster with the metrics configuration</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-kafka-str"><a class="link" href="#proc-metrics-kafka-str">8.2.3. Copying Prometheus metrics configuration to a Kafka resource</a></h4>
<div class="paragraph">
<p>To use Grafana dashboards for monitoring, you can copy <a href="#ref-metrics-config-files-str">the example metrics configuration to a <code>Kafka</code> resource</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>Kafka</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>Kafka</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>my-cluster</em></code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <a href="#ref-metrics-config-files-str">example configuration in <code>kafka-metrics.yaml</code></a> to your own <code>Kafka</code> resource definition.</p>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-deploying-kafka-str"><a class="link" href="#proc-metrics-deploying-kafka-str">8.2.4. Deploying a Kafka cluster with Prometheus metrics configuration</a></h4>
<div class="paragraph">
<p>To use Grafana dashboards for monitoring, you can deploy <a href="#ref-metrics-config-files-str">an example Kafka cluster with metrics configuration</a>.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Deploy the Kafka cluster with the metrics configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f kafka-metrics.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-metrics-prometheus-str"><a class="link" href="#assembly-metrics-prometheus-str">8.3. Prometheus</a></h3>
<div class="paragraph">
<p><a href="https://prometheus.io/" target="_blank" rel="noopener">Prometheus</a> provides an open source set of components for systems monitoring and alert notification.</p>
</div>
<div class="paragraph">
<p>We describe here how you can use the <a href="https://github.com/coreos/prometheus-operator" target="_blank" rel="noopener">CoreOS Prometheus Operator</a> to run and manage a Prometheus server that is suitable for use in production environments, but with the correct configuration you can run any Prometheus server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Prometheus server configuration uses service discovery to discover the pods in the cluster from which it gets metrics.  For this feature to work correctly, the service account used for running the Prometheus service pod must have access to the API server so it can retrieve the pod list.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/concepts/services-networking/service/#discovering-services" target="_blank" rel="noopener">Discovering services</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="con-metrics-prometheus-options-str"><a class="link" href="#con-metrics-prometheus-options-str">8.3.1. Prometheus configuration</a></h4>
<div class="paragraph">
<p>Strimzi provides <a href="#ref-metrics-config-files-str">example configuration files for the Prometheus server</a>.</p>
</div>
<div class="paragraph">
<p>A Prometheus image is provided for deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prometheus.yaml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional Prometheus-related configuration is also provided in the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prometheus-additional.yaml</code></p>
</li>
<li>
<p><code>prometheus-rules.yaml</code></p>
</li>
<li>
<p><code>strimzi-service-monitor.yaml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Prometheus to obtain monitoring data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-metrics-deploying-prometheus-operator-str">Deploy the Prometheus Operator</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then use the configuration files to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-metrics-deploying-prometheus-operator-str">Deploy Prometheus</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Alerting rules</div>
<p>The <code>prometheus-rules.yaml</code> file provides <a href="#ref-metrics-alertmanager-examples-str">example alerting rule examples for use with Alertmanager</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-metrics-prometheus-resources-str"><a class="link" href="#con-metrics-prometheus-resources-str">8.3.2. Prometheus resources</a></h4>
<div class="paragraph">
<p>When you apply the Prometheus configuration, the following resources are created in your Kubernetes cluster and managed by the Prometheus Operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>ClusterRole</code> that grants permissions to Prometheus to read the health endpoints exposed by the Kafka and Zookeeper pods, cAdvisor and the kubelet for container metrics.</p>
</li>
<li>
<p>A <code>ServiceAccount</code> for the Prometheus pods to run under.</p>
</li>
<li>
<p>A <code>ClusterRoleBinding</code> which binds the <code>ClusterRole</code> to the <code>ServiceAccount</code>.</p>
</li>
<li>
<p>A <code>Deployment</code> to manage the Prometheus Operator pod.</p>
</li>
<li>
<p>A <code>ServiceMonitor</code> to manage the configuration of the Prometheus pod.</p>
</li>
<li>
<p>A <code>Prometheus</code> to manage the configuration of the Prometheus pod.</p>
</li>
<li>
<p>A <code>PrometheusRule</code> to manage alerting rules for the Prometheus pod.</p>
</li>
<li>
<p>A <code>Secret</code> to manage additional Prometheus settings.</p>
</li>
<li>
<p>A <code>Service</code> to allow applications running in the cluster to connect to Prometheus (for example, Grafana using Prometheus as datasource).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-deploying-prometheus-operator-str"><a class="link" href="#proc-metrics-deploying-prometheus-operator-str">8.3.3. Deploying the Prometheus Operator</a></h4>
<div class="paragraph">
<p>To deploy the Prometheus Operator to your Kafka cluster, apply the YAML resource files from the <a href="https://github.com/coreos/prometheus-operator/tree/master/example/rbac/prometheus-operator">Prometheus CoreOS repository</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the resource files from the repository and replace the example <code>namespace</code> with your own:</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-deployment.yaml | sed -e 's/namespace: .\*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-deployment.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-cluster-role.yaml &gt; prometheus-operator-cluster-role.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-cluster-role-binding.yaml | sed -e 's/namespace: .*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-cluster-role-binding.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-service-account.yaml | sed -e 's/namespace: .*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-service-account.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-deployment.yaml | sed -e '' 's/namespace: .\*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-deployment.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-cluster-role.yaml &gt; prometheus-operator-cluster-role.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-cluster-role-binding.yaml | sed -e '' 's/namespace: .*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-cluster-role-binding.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">curl -s https://raw.githubusercontent.com/coreos/prometheus-operator/master/example/rbac/prometheus-operator/prometheus-operator-service-account.yaml | sed -e '' 's/namespace: .*/namespace: <em>my-namespace</em>/' &gt; prometheus-operator-service-account.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If it is not required, you can manually remove the <code>spec.template.spec.securityContext</code> property from the <code>prometheus-operator-deployment.yaml</code> file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Deploy the Prometheus Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f prometheus-operator-deployment.yaml
kubectl apply -f prometheus-operator-cluster-role.yaml
kubectl apply -f prometheus-operator-cluster-role-binding.yaml
kubectl apply -f prometheus-operator-service-account.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-deploying-prometheus-str"><a class="link" href="#proc-metrics-deploying-prometheus-str">8.3.4. Deploying Prometheus</a></h4>
<div class="paragraph">
<p>To deploy Prometheus to your Kafka cluster to obtain monitoring data, apply the <a href="#ref-metrics-config-files-str">example resource file for the Prometheus docker image and the YAML files for Prometheus-related resources</a>.</p>
</div>
<div class="paragraph">
<p>The deployment process creates a <code>ClusterRoleBinding</code> and discovers an Alertmanager instance in the namespace specified for the deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the Prometheus Operator only supports jobs that include an <code>endpoints</code> role for service discovery. Targets are discovered and scraped for each endpoint port address. For endpoint discovery, the port address may be derived from service (<code>role: service</code>) or pod (<code>role: pod</code>) discovery.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Check the <a href="#ref-metrics-alertmanager-examples-str">example alerting rules provided</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the Prometheus installation file (<code>prometheus.yaml</code>) according to the namespace Prometheus is going to be installed in:</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' prometheus.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' prometheus.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>ServiceMonitor</code> resource in <code>strimzi-service-monitor.yaml</code> to define Prometheus jobs that will scrape the metrics data.</p>
</li>
<li>
<p>To use another role:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a <code>Secret</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc create secret generic additional-scrape-configs --from-file=prometheus-additional.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>additionalScrapeConfigs</code> property in the <code>prometheus.yaml</code> file to include the name of the <code>Secret</code> and the YAML file (<code>prometheus-additional.yaml</code>) that contains the additional configuration.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Edit the <code>prometheus-rules.yaml</code> file that creates sample alert notification rules:</p>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' prometheus-rules.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' prometheus-rules.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Prometheus resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f strimzi-service-monitor.yaml
kubectl apply -f prometheus-rules.yaml
kubectl apply -f prometheus.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-metrics-prometheus-alertmanager-str"><a class="link" href="#assembly-metrics-prometheus-alertmanager-str">8.4. Prometheus Alertmanager</a></h3>
<div class="paragraph">
<p><a href="https://prometheus.io/docs/alerting/alertmanager/" target="_blank" rel="noopener">Prometheus Alertmanager</a> is a plugin for handling alerts and routing them to a notification service.
Alertmanager supports an essential aspect of monitoring, which is to be notified of conditions that indicate potential issues based on alerting rules.</p>
</div>
<div class="sect3">
<h4 id="con-metrics-alertmanager-options-str"><a class="link" href="#con-metrics-alertmanager-options-str">8.4.1. Alertmanager configuration</a></h4>
<div class="paragraph">
<p>Strimzi provides <a href="#ref-metrics-config-files-str">example configuration files for Prometheus Alertmanager</a>.</p>
</div>
<div class="paragraph">
<p>A configuration file defines the resources for deploying Alertmanager:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>alert-manager.yaml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An additional configuration file provides the hook definitions for sending notifications from your Kafka cluster.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>alert-manager-config.yaml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Alertmanger to handle Prometheus alerts, use the configuration files to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-metrics-deploying-prometheus-alertmanager-str">Deploy Alertmanager</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-metrics-prometheus-alerts-str"><a class="link" href="#con-metrics-prometheus-alerts-str">8.4.2. Alerting rules</a></h4>
<div class="paragraph">
<p>Alerting rules provide notifications about specific conditions observed in the metrics. Rules are declared on the Prometheus server, but Prometheus Alertmanager is responsible for alert notifications.</p>
</div>
<div class="paragraph">
<p>Prometheus alerting rules describe conditions using <a href="https://prometheus.io/docs/prometheus/latest/querying/basics/">PromQL</a> expressions that are continuously evaluated.</p>
</div>
<div class="paragraph">
<p>When an alert expression becomes true, the condition is met and the Prometheus server sends alert data to the Alertmanager.
Alertmanager then sends out a notification using the communication method configured for its deployment.</p>
</div>
<div class="paragraph">
<p>Alertmanager can be configured to use email, chat messages or other notification methods.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about setting up alerting rules, see <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration" target="_blank" rel="noopener">Configuration</a> in the Prometheus documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-metrics-alertmanager-examples-str"><a class="link" href="#ref-metrics-alertmanager-examples-str">8.4.3. Alerting rule examples</a></h4>
<div class="paragraph">
<p>Example alerting rules for Kafka and Zookeeper metrics are provided with Strimzi for use in a <a href="#proc-metrics-deploying-prometheus-str">Prometheus deployment</a>.</p>
</div>
<div class="paragraph">
<p>General points about the alerting rule definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>for</code> property is used with the rules to determine the period of time a condition must persist before an alert is triggered.</p>
</li>
<li>
<p>A tick is a basic Zookeeper time unit, which is measured in milliseconds and configured using the <code>tickTime</code> parameter of <code>Kafka.spec.zookeeper.config</code>. For example, if Zookeeper <code>tickTime=3000</code>, 3 ticks (3 x 3000) equals 9000 milliseconds.</p>
</li>
<li>
<p>The availability of the <code>ZookeeperRunningOutOfSpace</code> metric and alert is dependent on the Kubernetes configuration and storage implementation used. Storage implementations for certain platforms may not be able to supply the information on available space required for the metric to provide an alert.</p>
</li>
</ul>
</div>
<div class="dlist">
<div class="title">Kafka alerting rules</div>
<dl>
<dt class="hdlist1"><code>UnderReplicatedPartitions</code></dt>
<dd>
<p>Gives the number of partitions for which the current broker is the lead replica but which have fewer replicas than the <code>min.insync.replicas</code> configured for their topic.
This metric provides insights about brokers that host the follower replicas. Those followers are not keeping up with the leader.
Reasons for this could include being (or having been) offline, and over-throttled interbroker replication.
An alert is raised when this value is greater than zero, providing information on the under-replicated partitions for each broker.</p>
</dd>
<dt class="hdlist1"><code>AbnormalControllerState</code></dt>
<dd>
<p>Indicates whether the current broker is the controller for the cluster.
The metric can be 0 or 1.
During the life of a cluster, only one broker should be the controller and the cluster always needs to have an active controller.
Having two or more brokers saying that they are controllers indicates a problem.
If the condition persists, an alert is raised when the sum of all the values for this metric on all brokers is not equal to 1, meaning that there is no active controller (the sum is 0) or more than one controller (the sum is greater than 1).</p>
</dd>
<dt class="hdlist1"><code>UnderMinIsrPartitionCount</code></dt>
<dd>
<p>Indicates that the minimum number of in-sync replicas (ISRs) for a lead Kafka broker, specified using <code>min.insync.replicas</code>, that must acknowledge a write operation has not been reached.
The metric defines the number of partitions that the broker leads for which the in-sync replicas count is less than the minimum in-sync.
An alert is raised when this value is greater than zero, providing information on the partition count for each broker that did not achieve the minimum number of acknowledgments.</p>
</dd>
<dt class="hdlist1"><code>OfflineLogDirectoryCount</code></dt>
<dd>
<p>Indicates the number of log directories which are offline (for example, due to a hardware failure) so that the broker cannot store incoming messages anymore.
An alert is raised when this value is greater than zero, providing information on the number of offline log directories for each broker.</p>
</dd>
<dt class="hdlist1"><code>KafkaRunningOutOfSpace</code></dt>
<dd>
<p>Indicates the remaining amount of disk space that can be used for writing data.
An alert is raised when this value is lower than 5GiB, providing information on the disk that is running out of space for each persistent volume claim.
The threshold value may be changed in <code>prometheus-rules.yaml</code>.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Zookeeper alerting rules</div>
<dl>
<dt class="hdlist1"><code>AvgRequestLatency</code></dt>
<dd>
<p>Indicates the amount of time it takes for the server to respond to a client request.
An alert is raised when this value is greater than 10 (ticks), providing the actual value of the average request latency for each server.</p>
</dd>
<dt class="hdlist1"><code>OutstandingRequests</code></dt>
<dd>
<p>Indicates the number of queued requests in the server.
This value goes up when the server receives more requests than it can process.
An alert is raised when this value is greater than 10, providing the actual number of outstanding requests for each server.</p>
</dd>
<dt class="hdlist1"><code>ZookeeperRunningOutOfSpace</code></dt>
<dd>
<p>Indicates the remaining amount of disk space that can be used for writing data to Zookeeper.
An alert is raised when this value is lower than 5GiB., providing information on the disk that is running out of space for each persistent volume claim.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-deploying-prometheus-alertmanager-str"><a class="link" href="#proc-metrics-deploying-prometheus-alertmanager-str">8.4.4. Deploying Alertmanager</a></h4>
<div class="paragraph">
<p>To deploy Alertmanager, apply the <a href="#ref-metrics-config-files-str">example configuration files</a>.</p>
</div>
<div class="paragraph">
<p>The sample configuration provided with Strimzi configures the Alertmanager to send notifications to a Slack channel.</p>
</div>
<div class="paragraph">
<p>The following resources are defined on deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>Alertmanager</code> to manage the Alertmanager pod.</p>
</li>
<li>
<p>A <code>Secret</code> to manage the configuration of the Alertmanager.</p>
</li>
<li>
<p>A <code>Service</code> to provide an easy to reference hostname for other services to connect to Alertmanager (such as Prometheus).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#assembly-metrics-kafka-str">Metrics are configured for the Kafka cluster resource</a></p>
</li>
<li>
<p><a href="#assembly-metrics-prometheus-str">Prometheus is deployed</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> resource from the Alertmanager configuration file (<code>alert-manager-config.yaml</code>):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic alertmanager-alertmanager --from-file=alert-manager-config.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Update the <code>alert-manager-config.yaml</code> file to replace the:</p>
<div class="ulist">
<ul>
<li>
<p><code>slack_api_url</code> property with the actual value of the Slack API URL related to the application for the Slack workspace</p>
</li>
<li>
<p><code>channel</code> property with the actual Slack channel on which to send notifications</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deploy Alertmanager:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f alert-manager.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-metrics-grafana-str"><a class="link" href="#assembly-metrics-grafana-str">8.5. Grafana</a></h3>
<div class="paragraph">
<p>Grafana provides visualizations of Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>You can deploy and enable the example Grafana dashboards provided with Strimzi.</p>
</div>
<div class="sect3">
<h4 id="con-metrics-grafana-options-str"><a class="link" href="#con-metrics-grafana-options-str">8.5.1. Grafana configuration</a></h4>
<div class="paragraph">
<p>Strimzi provides <a href="#ref-metrics-config-files-str">example dashboard configuration files for Grafana</a>.</p>
</div>
<div class="paragraph">
<p>A Grafana docker image is provided for deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grafana.yaml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example dashboards are also provided as JSON files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>strimzi-kafka.json</code></p>
</li>
<li>
<p><code>strimzi-kafka-connect.json</code></p>
</li>
<li>
<p><code>strimzi-zookeeper.json</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example dashboards are a good starting point for monitoring key metrics, but they do not represent all available metrics.
You may need to modify the example dashboards or add other metrics, depending on your infrastructure.</p>
</div>
<div class="paragraph">
<p>For Grafana to present the dashboards, use the configuration files to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-metrics-deploying-grafana-str">Deploy Grafana</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-deploying-grafana-str"><a class="link" href="#proc-metrics-deploying-grafana-str">8.5.2. Deploying Grafana</a></h4>
<div class="paragraph">
<p>To deploy Grafana to provide visualizations of Prometheus metrics, apply the <a href="#ref-metrics-config-files-str">example configuration file</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="#assembly-metrics-kafka-str">Metrics are configured for the Kafka cluster resource</a></p>
</li>
<li>
<p><a href="#assembly-metrics-prometheus-str">Prometheus and Prometheus Alertmanager are deployed</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy Grafana:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f grafana.yaml</code></pre>
</div>
</div>
</li>
<li>
<p><a href="#proc-metrics-grafana-dashboard-str">Enable the Grafana dashboards</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-metrics-grafana-dashboard-str"><a class="link" href="#proc-metrics-grafana-dashboard-str">8.5.3. Enabling the example Grafana dashboards</a></h4>
<div class="paragraph">
<p>Set up a Prometheus data source and example dashboards to enable Grafana for monitoring.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
No alert notification rules are defined.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When accessing a dashboard, you can use the <code>port-forward</code> command to forward traffic from the Grafana pod to the host.</p>
</div>
<div class="paragraph">
<p>For example, you can access the Grafana user interface by:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Running <code>kubectl port-forward grafana-1-fbl7s 3000:3000</code></p>
</li>
<li>
<p>Pointing a browser to <code><a href="http://localhost:3000" class="bare">http://localhost:3000</a></code></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The name of the Grafana pod is different for each user.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the Grafana user interface using <code>admin/admin</code> credentials.</p>
<div class="paragraph">
<p>On the initial view choose to reset the password.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/grafana_login.png" alt="Grafana login">
</div>
</div>
</li>
<li>
<p>Click the <strong>Add data source</strong> button.</p>
<div class="imageblock">
<div class="content">
<img src="images/grafana_home.png" alt="Grafana home">
</div>
</div>
</li>
<li>
<p>Add Prometheus as a data source.</p>
<div class="ulist">
<ul>
<li>
<p>Specify a name</p>
</li>
<li>
<p>Add <em>Prometheus</em> as the type</p>
</li>
<li>
<p>Specify the connection string to the Prometheus server (<a href="http://prometheus-operated:9090" class="bare">http://prometheus-operated:9090</a>) in the URL field</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Add</strong> to test the connection to the data source.</p>
<div class="imageblock">
<div class="content">
<img src="images/grafana_prometheus_data_source.png" alt="Add Prometheus data source">
</div>
</div>
</li>
<li>
<p>Click <strong>Dashboards</strong>, then <strong>Import</strong> to open the <em>Import Dashboard</em> window and import the example dashboards (or paste the JSON).</p>
<div class="imageblock">
<div class="content">
<img src="images/grafana_import_dashboard.png" alt="Add Grafana dashboard">
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After importing the dashboards, the Grafana dashboard homepage presents Kafka and Zookeeper dashboards.</p>
</div>
<div class="paragraph">
<p>When the Prometheus server has been collecting metrics for a Strimzi cluster for some time, the dashboards are populated.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/grafana_kafka_dashboard.png" alt="Kafka dashboard">
</div>
<div class="title">Kafka dashboardKafka dashboard</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/grafana_zookeeper_dashboard.png" alt="Zookeeper dashboard">
</div>
<div class="title">Zookeeper dashboardZookeeper dashboard</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-metrics-kafka-mini-kube-shift-str"><a class="link" href="#con-metrics-kafka-mini-kube-shift-str">8.6. Using metrics with <code>minikube</code> or <code>minishift</code></a></h3>
<div class="paragraph">
<p>When adding Prometheus and Grafana servers to an Apache Kafka deployment using <code>minikube</code> or <code>minishift</code>, the memory available to the virtual machine should be increased (to 4 GB of RAM, for example, instead of the default 2 GB).</p>
</div>
<div class="paragraph">
<p>For information on how to increase the default amount of memory, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#installing_kubernetes_cluster">Installing a Kubernetes cluster</a></p>
</li>
<li>
<p><a href="#installing_openshift_cluster">Installing an OpenShift cluster</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/">Prometheus - Monitoring Docker Container Metrics using cAdvisor</a> describes how to use cAdvisor (short for container Advisor) metrics with Prometheus to analyze and expose resource usage (CPU, Memory, and Disk) and performance data from running containers within pods on Kubernetes.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-distributed-tracing-str"><a class="link" href="#assembly-distributed-tracing-str">9. Distributed tracing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter outlines the support for distributed tracing in Strimzi, using Jaeger.</p>
</div>
<div class="paragraph">
<p>How you configure distributed tracing varies by Strimzi client and component.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You <em>instrument</em> Kafka Producer, Consumer, and Streams API applications for distributed tracing using an OpenTracing client library. This involves adding instrumentation code to these clients, which monitors the execution of individual transactions in order to generate trace data.</p>
</li>
<li>
<p>Distributed tracing support is built in to the Kafka Connect and Mirror Maker components of Strimzi. To configure these components for distributed tracing, you configure and update the relevant custom resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before configuring distributed tracing in Strimzi clients and components, you must first initialize and configure a Jaeger tracer in the Kafka cluster, as described in <a href="#proc-configuring-jaeger-tracer-kafka-clients-str">Initializing a Jaeger tracer for Kafka clients</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Distributed tracing is not supported for Kafka brokers.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-overview-distributed-tracing-str"><a class="link" href="#con-overview-distributed-tracing-str">9.1. Overview of distributed tracing in Strimzi</a></h3>
<div class="paragraph">
<p>Distributed tracing allows developers and system administrators to track the progress of transactions between applications (and services in a microservice architecture) in a distributed system. This information is useful for monitoring application performance and investigating issues with target systems and end-user applications.</p>
</div>
<div class="paragraph">
<p>In Strimzi and data streaming platforms in general, distributed tracing facilitates the end-to-end tracking of messages: from source systems to the Kafka cluster and then to target systems and applications.</p>
</div>
<div class="paragraph">
<p>As an aspect of system observability, distributed tracing complements the metrics that are available to view in <a href="#assembly-metrics-setup-str">Grafana dashboards</a> and the available loggers for each component.</p>
</div>
<div class="paragraph">
<div class="title">OpenTracing overview</div>
<p>Distributed tracing in Strimzi is implemented using the open source <a href="https://opentracing.io/" target="_blank" rel="noopener">OpenTracing</a> and <a href="https://www.jaegertracing.io/" target="_blank" rel="noopener">Jaeger</a> projects.</p>
</div>
<div class="paragraph">
<p>The OpenTracing specification defines APIs that developers can use to instrument applications for distributed tracing. It is independent from the tracing system.</p>
</div>
<div class="paragraph">
<p>When instrumented, applications generate <em>traces</em> for individual transactions. Traces are composed of <em>spans</em>, which define specific units of work.</p>
</div>
<div class="paragraph">
<p>To simplify the instrumentation of Kafka Producer, Consumer, and Streams API applications, Strimzi includes the <a href="https://github.com/opentracing-contrib/java-kafka-client/blob/master/README.md" target="_blank" rel="noopener">OpenTracing Apache Kafka Client Instrumentation</a> library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The OpenTracing project is merging with the OpenCensus project. The new, combined project is named <a href="https://opentelemetry.io/" target="_blank" rel="noopener">OpenTelemetry</a>. OpenTelemetry will provide compatibility for applications that are instrumented using the OpenTracing APIs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Jaeger overview</div>
<p>Jaeger, a tracing system, is an implementation of the OpenTracing APIs used for monitoring and troubleshooting microservices-based distributed systems. It consists of four main components and provides client libraries for instrumenting applications. You can use the Jaeger user interface to visualize, query, filter, and analyze trace data.</p>
</div>
<div class="paragraph">
<div class="title">An example of a query in the Jaeger user interface</div>
<p><span class="image"><img src="images/image_con-overview-distributed-tracing.png" alt="Simple Jaeger query"></span></p>
</div>
<div class="sect3">
<h4 id="distributed_tracing_support_in_strimzi"><a class="link" href="#distributed_tracing_support_in_strimzi">9.1.1. Distributed tracing support in Strimzi</a></h4>
<div class="paragraph">
<p>In Strimzi, distributed tracing is supported in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Connect (including Kafka Connect with Source2Image support)</p>
</li>
<li>
<p>Mirror Maker</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You enable and configure distributed tracing for these components by setting template configuration properties in the relevant custom resource (for example, <code>KafkaConnect</code>).</p>
</div>
<div class="paragraph">
<p>To enable distributed tracing in Kafka Producer, Consumer, and Streams API applications, you can instrument application code using the OpenTracing Apache Kafka Client Instrumentation library.
When instrumented, these clients generate traces for messages (for example, when producing messages or writing offsets to the log).</p>
</div>
<div class="paragraph">
<p>Traces are sampled according to a sampling strategy and then visualized in the Jaeger user interface. This trace data is useful for monitoring the performance of your Kafka cluster and debugging issues with target systems and applications.</p>
</div>
<div class="paragraph">
<div class="title">Outline of procedures</div>
<p>To set up distributed tracing for Strimzi, follow these procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">Initialize a Jaeger tracer for Kafka clients</a></p>
</li>
<li>
<p><a href="#proc-instrumenting-producers-consumers-for-opentracing-str">Instrument Kafka Producers and Consumers for tracing</a></p>
</li>
<li>
<p><a href="#proc-instrumenting-kafka-streams-with-tracers-str">Instrument Kafka Streams applications for tracing</a></p>
</li>
<li>
<p><a href="#assembly-setting-up-tracing-mirror-maker-connect-str">Set up tracing for Mirror Maker and Kafka Connect</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter covers setting up distributed tracing for Strimzi clients and components only. Setting up distributed tracing for applications and systems beyond Strimzi is outside the scope of this chapter. To learn more about this subject, see the <a href="https://opentracing.io/docs/overview/" target="_blank" rel="noopener">OpenTracing documentation</a> and search for "inject and extract".</p>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>Before you set up distributed tracing for Strimzi, it is helpful to understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The basics of OpenTracing, including key concepts such as traces, spans, and tracers. Refer to the <a href="https://opentracing.io/docs/overview/" target="_blank" rel="noopener">OpenTracing documentation</a>.</p>
</li>
<li>
<p>The components of the <a href="https://www.jaegertracing.io/docs/1.14/architecture/" target="_blank" rel="noopener">Jaeger architecure</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Jaeger backend components are deployed to your Kubernetes cluster. For deployment instructions, see the <a href="https://www.jaegertracing.io/docs/1.14/deployment/" target="_blank" rel="noopener">Jaeger deployment documentation</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-setting-up-tracing-kafka-clients-str"><a class="link" href="#assembly-setting-up-tracing-kafka-clients-str">9.2. Setting up tracing for Kafka clients</a></h3>
<div class="paragraph">
<p>This section describes how to initialize a Jaeger tracer to allow you to instrument your client applications for distributed tracing.</p>
</div>
<div class="sect3">
<h4 id="proc-configuring-jaeger-tracer-kafka-clients-str"><a class="link" href="#proc-configuring-jaeger-tracer-kafka-clients-str">9.2.1. Initializing a Jaeger tracer for Kafka clients</a></h4>
<div class="paragraph">
<p>Configure and initialize a Jaeger tracer using a set of <a href="#ref-tracing-environment-variables-str">tracing environment variables</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform the following steps for each client application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Maven dependencies for Jaeger to the <code>pom.xml</code> file for the client application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.jaegertracing&lt;/groupId&gt;
    &lt;artifactId&gt;jaeger-client&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Define the configuration of the Jaeger tracer using the <a href="#ref-tracing-environment-variables-str">tracing environment variables</a>.</p>
</li>
<li>
<p>Create the Jaeger tracer from the environment variables that you defined in step two:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Tracer tracer = Configuration.fromEnv().getTracer();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For alternative ways to initialize a Jaeger tracer, see the <a href="https://github.com/jaegertracing/jaeger-client-java/tree/master/jaeger-core" target="_blank" rel="noopener">Java OpenTracing library</a> documentation.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Register the Jaeger tracer as a global tracer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">GlobalTracer.register(tracer);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A Jaeger tracer is now initialized for the client application to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-tracing-environment-variables-str"><a class="link" href="#ref-tracing-environment-variables-str">9.2.2. Tracing environment variables</a></h4>
<div class="paragraph">
<p>Use these environment variables when configuring a Jaeger tracer for Kafka clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The tracing environment variables are part of the Jaeger project and are subject to change. For the latest environment variables, see the <a href="https://github.com/jaegertracing/jaeger-client-java/tree/master/jaeger-core#configuration-via-environment" target="_blank" rel="noopener">Jaeger documentation</a>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none fit-content stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SERVICE_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the Jaeger tracer service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AGENT_HOST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname for communicating with the <code>jaeger-agent</code> through the User Datagram Protocol (UDP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AGENT_PORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used for communicating with the <code>jaeger-agent</code> through UDP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_ENDPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The traces endpoint. Only define this variable if the client application will bypass the <code>jaeger-agent</code> and connect directly to the <code>jaeger-collector</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AUTH_TOKEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The authentication token to send to the endpoint as a bearer token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to send to the endpoint if using basic authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_PASSWORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to send to the endpoint if using basic authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_PROPAGATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of formats to use for propagating the trace context. Defaults to the standard Jaeger format. Valid values are <code>jaeger</code> and <code>b3</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_LOG_SPANS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the reporter should also log the spans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_MAX_QUEUE_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reporter&#8217;s maximum queue size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_FLUSH_INTERVAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reporter&#8217;s flush interval, in ms. Defines how frequently the Jaeger reporter flushes span batches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_TYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sampling strategy to use for client traces: Constant, Probabilistic, Rate Limiting, or Remote (the default type).</p>
<p class="tableblock">To sample all traces, use the Constant sampling strategy with a parameter of 1.</p>
<p class="tableblock">For more information, see the <a href="https://www.jaegertracing.io/docs/1.14/sampling/#client-sampling-configuration" target="_blank" rel="noopener">Jaeger documentation</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_PARAM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sampler parameter (number).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_MANAGER_HOST_PORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname and port to use if a Remote sampling strategy is selected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_TAGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of tracer-level tags that are added to all reported spans.</p>
<p class="tableblock">The value can also refer to an environment variable using the format <code>${envVarName:default}</code>. <code>:default</code> is optional and identifies a value to use if the environment variable cannot be found.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">Initializing a Jaeger tracer for Kafka clients</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-instrumenting-kafka-clients-tracers-str"><a class="link" href="#assembly-instrumenting-kafka-clients-tracers-str">9.3. Instrumenting Kafka clients with tracers</a></h3>
<div class="paragraph">
<p>This section describes how to instrument Kafka Producer, Consumer, and Streams API applications for distributed tracing.</p>
</div>
<div class="sect3">
<h4 id="proc-instrumenting-producers-consumers-for-opentracing-str"><a class="link" href="#proc-instrumenting-producers-consumers-for-opentracing-str">9.3.1. Instrumenting Kafka Producers and Consumers for tracing</a></h4>
<div class="paragraph">
<p>Use a Decorator pattern or Interceptors to instrument your Java Producer and Consumer application code for distributed tracing.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform these steps in the application code of each Kafka Producer and Consumer application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the Maven dependency for OpenTracing to the Producer or Consumer&#8217;s <code>pom.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.opentracing.contrib&lt;/groupId&gt;
    &lt;artifactId&gt;opentracing-kafka-client&lt;/artifactId&gt;
    &lt;version&gt;0.1.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Instrument your client application code using either a Decorator pattern or Interceptors.</p>
<div class="ulist">
<ul>
<li>
<p>If you prefer to use a Decorator pattern, use following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Create an instance of the TracingKafkaProducer:
TracingKafkaProducer&lt;Integer, String&gt; tracingProducer = new TracingKafkaProducer&lt;&gt;(producer,
        tracer);

// Send:
tracingProducer.send(...);

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Create an instance of the TracingKafkaConsumer:
TracingKafkaConsumer&lt;Integer, String&gt; tracingConsumer = new TracingKafkaConsumer&lt;&gt;(consumer,
        tracer);

// Subscribe:
tracingConsumer.subscribe(Collections.singletonList("messages"));

// Get messages:
ConsumerRecords&lt;Integer, String&gt; records = tracingConsumer.poll(1000);

// Retrieve SpanContext from polled record (consumer side):
ConsumerRecord&lt;Integer, String&gt; record = ...
SpanContext spanContext = TracingKafkaUtils.extractSpanContext(record.headers(), tracer);</code></pre>
</div>
</div>
</li>
<li>
<p>If you prefer to use Interceptors, use the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Register the tracer with GlobalTracer:
GlobalTracer.register(tracer);

// Add the TracingProducerInterceptor to the sender properties:
senderProps.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,
          TracingProducerInterceptor.class.getName());

// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Send:
producer.send(...);

// Add the TracingConsumerInterceptor to the consumer properties:
consumerProps.put(ConsumerConfig.INTERCEPTOR_CLASSES_CONFIG,
          TracingConsumerInterceptor.class.getName());

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Subscribe:
consumer.subscribe(Collections.singletonList("messages"));

// Get messages:
ConsumerRecords&lt;Integer, String&gt; records = consumer.poll(1000);

// Retrieve the SpanContext from a polled message (consumer side):
ConsumerRecord&lt;Integer, String&gt; record = ...
SpanContext spanContext = TracingKafkaUtils.extractSpanContext(record.headers(), tracer);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="custom_span_names_in_a_decorator_pattern"><a class="link" href="#custom_span_names_in_a_decorator_pattern">Custom span names in a Decorator pattern</a></h5>
<div class="paragraph">
<p>A <em>span</em> is a logical unit of work in Jaeger, with an operation name, start time, and duration.</p>
</div>
<div class="paragraph">
<p>If you use a Decorator pattern to instrument your Kafka Producer and Consumer applications, you can define custom span names by passing a <code>BiFunction</code> object as an additional argument when creating the <code>TracingKafkaProducer</code> and <code>TracingKafkaConsumer</code> objects. The OpenTracing Apache Kafka Client Instrumentation library includes several built-in span names, which are described below.</p>
</div>
<div class="listingblock">
<div class="title">Example: Using custom span names to instrument client application code in a Decorator pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Create a BiFunction for the KafkaProducer that operates on (String operationName, ProducerRecord consumerRecord) and returns a String to be used as the name:

BiFunction&lt;String, ProducerRecord, String&gt; producerSpanNameProvider =
    (operationName, producerRecord) -&gt; "CUSTOM_PRODUCER_NAME";

// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Create an instance of the TracingKafkaProducer
TracingKafkaProducer&lt;Integer, String&gt; tracingProducer = new TracingKafkaProducer&lt;&gt;(producer,
        tracer,
        producerSpanNameProvider);

// Spans created by the tracingProducer will now have "CUSTOM_PRODUCER_NAME" as the span name.

// Create a BiFunction for the KafkaConsumer that operates on (String operationName, ConsumerRecord consumerRecord) and returns a String to be used as the name:

BiFunction&lt;String, ConsumerRecord, String&gt; consumerSpanNameProvider =
    (operationName, consumerRecord) -&gt; operationName.toUpperCase();

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Create an instance of the TracingKafkaConsumer, passing in the consumerSpanNameProvider BiFunction:

TracingKafkaConsumer&lt;Integer, String&gt; tracingConsumer = new TracingKafkaConsumer&lt;&gt;(consumer,
        tracer,
        consumerSpanNameProvider);

// Spans created by the tracingConsumer will have the operation name as the span name, in upper-case.
// "receive" -&gt; "RECEIVE"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="built_in_span_names"><a class="link" href="#built_in_span_names">Built-in span names</a></h5>
<div class="paragraph">
<p>When defining custom span names, you can use the following <code>BiFunctions</code> in the <code>ClientSpanNameProvider</code> class. If no <code>spanNameProvider</code> is specified, <code>CONSUMER_OPERATION_NAME</code> and <code>PRODUCER_OPERATION_NAME</code> are used.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">BiFunction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_OPERATION_NAME, PRODUCER_OPERATION_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <code>operationName</code> as the span name: "receive" for Consumers and "send" for Producers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_PREFIXED_OPERATION_NAME(String prefix), PRODUCER_PREFIXED_OPERATION_NAME(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and <code>operationName</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_TOPIC, PRODUCER_TOPIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the name of the topic that the message was sent to or retrieved from in the format <code>(record.topic())</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFIXED_CONSUMER_TOPIC(String prefix), PREFIXED_PRODUCER_TOPIC(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and the topic name in the format <code>(record.topic())</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_OPERATION_NAME_TOPIC, PRODUCER_OPERATION_NAME_TOPIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the operation name and the topic name: <code>"operationName - record.topic()"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_PREFIXED_OPERATION_NAME_TOPIC(String prefix), PRODUCER_PREFIXED_OPERATION_NAME_TOPIC(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and <code>"operationName - record.topic()"</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-instrumenting-kafka-streams-with-tracers-str"><a class="link" href="#proc-instrumenting-kafka-streams-with-tracers-str">9.3.2. Instrumenting Kafka Streams applications for tracing</a></h4>
<div class="paragraph">
<p>This section describes how to instrument Kafka Streams API applications for distributed tracing.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform the following steps for each Kafka Streams API application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the <code>opentracing-kafka-streams</code> dependency to the pom.xml file for your Kafka Streams API application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.opentracing.contrib&lt;/groupId&gt;
    &lt;artifactId&gt;opentracing-kafka-streams&lt;/artifactId&gt;
    &lt;version&gt;0.1.4&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>TracingKafkaClientSupplier</code> supplier interface:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">KafkaClientSupplier supplier = new TracingKafkaClientSupplier(tracer);</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the supplier interface to <code>KafkaStreams</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">KafkaStreams streams = new KafkaStreams(builder.build(), new StreamsConfig(config), supplier);
streams.start();</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-setting-up-tracing-mirror-maker-connect-str"><a class="link" href="#assembly-setting-up-tracing-mirror-maker-connect-str">9.4. Setting up tracing for Mirror Maker and Kafka Connect</a></h3>
<div class="paragraph">
<p>Distributed tracing is supported for Mirror Maker and Kafka Connect (including Kafka Connect with Source2Image support).</p>
</div>
<div class="paragraph">
<p>For Mirror Maker, messages are traced from the source cluster to the target cluster; the trace data records messages entering and leaving the Mirror Maker component.</p>
</div>
<div class="paragraph">
<p>Only messages produced and consumed by Kafka Connect itself are traced. To trace messages sent between Kafka Connect and external systems, you must configure tracing in the connectors for those systems. For more information, see <a href="#assembly-deployment-configuration-kafka-connect-str">Kafka Connect cluster configuration</a>.</p>
</div>
<div class="sect3">
<h4 id="proc-enabling-tracing-in-connect-mirror-maker-resources-str"><a class="link" href="#proc-enabling-tracing-in-connect-mirror-maker-resources-str">9.4.1. Enabling tracing in Mirror Maker and Kafka Connect resources</a></h4>
<div class="paragraph">
<p>Update the configuration of <code>KafkaMirrorMaker</code>, <code>KafkaConnect</code>, and <code>KafkaConnectS2I</code> custom resources to specify and configure a Jaeger tracer service for each resource. Updating a tracing-enabled resource in your Kubernetes cluster triggers two events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interceptor classes are updated in the integrated consumers and producers in Mirror Maker or Kafka Connect.</p>
</li>
<li>
<p>The tracing agent initializes a Jaeger tracer based on the tracing configuration defined in the resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform these steps for each <code>KafkaMirrorMaker</code>, <code>KafkaConnect</code>, and <code>KafkaConnectS2I</code> resource.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>spec.template</code> property, configure the Jaeger tracer service. For example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Jaeger tracer configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  template:
    connectContainer: <b class="conum">(1)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing: <b class="conum">(2)</b>
    type: jaeger
  #...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Jaeger tracer configuration for Mirror Maker</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
metadata:
  name: my-mirror-maker
spec:
  #...
  template:
    mirrorMakerContainer: <b class="conum">(1)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing: <b class="conum">(2)</b>
    type: jaeger
#...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use the <a href="#ref-tracing-environment-variables-str">tracing environment variables</a> as template configuration properties.</p>
</li>
<li>
<p>Set the <code>spec.tracing.type</code> property to <code>jaeger</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f your-file</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-customizing-containers-str">Customizing containers with environment variables</a></p>
</li>
<li>
<p><a href="#con-customizing-template-properties-str">Template properties</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-kafka-exporter-str"><a class="link" href="#assembly-kafka-exporter-str">10. Kafka Exporter</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/danielqsj/kafka_exporter" target="_blank" rel="noopener">Kafka Exporter</a> is an open source project to enhance monitoring of Apache Kafka brokers and clients.
Kafka Exporter is provided with Strimzi for deployment with a Kafka cluster to extract additional metrics data from Kafka brokers related to offsets, consumer groups, consumer lag, and topics.</p>
</div>
<div class="paragraph">
<p>The metrics data is used, for example, to help identify slow consumers.</p>
</div>
<div class="paragraph">
<p>Lag data is exposed as Prometheus metrics, which can then be presented in Grafana for analysis.</p>
</div>
<div class="paragraph">
<p>If you are already using Prometheus and Grafana for monitoring of built-in Kafka metrics, you can configure Prometheus to also scrape the Kafka Exporter Prometheus endpoint.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">Kafka Exporter deployment configuration</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="con-metrics-kafka-exporter-lag-str"><a class="link" href="#con-metrics-kafka-exporter-lag-str">10.1. Consumer lag</a></h3>
<div class="paragraph">
<p>Consumer lag indicates the difference in the rate of production and consumption of messages.
Specifically, consumer lag for a given consumer group indicates the delay between the last message in the partition and the message being currently picked up by that consumer.
The lag reflects the position of the consumer offset in relation to the end of the partition log.</p>
</div>
<div class="paragraph">
<p>This difference is sometimes referred to as the <em>delta</em> between the producer offset and consumer offset, the read and write positions in the Kafka broker topic partitions.</p>
</div>
<div class="paragraph">
<p>Suppose a topic streams 100 messages a second. A lag of 1000 messages between the producer offset (the topic partition head) and the last offset the consumer has read means a 10-second delay.</p>
</div>
<div class="paragraph">
<div class="title">The importance of monitoring consumer lag</div>
<p>For applications that rely on the processing of (near) real-time data, it is critical to monitor consumer lag to check that it does not become too big.
The greater the lag becomes, the further the process moves from the real-time processing objective.</p>
</div>
<div class="paragraph">
<p>Consumer lag, for example, might be a result of consuming too much old data that has not been purged, or through unplanned shutdowns.</p>
</div>
<div class="paragraph">
<div class="title">Reducing consumer lag</div>
<p>Typical actions to reduce lag include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scaling-up consumer groups by adding new consumers</p>
</li>
<li>
<p>Increasing the retention time for a message to remain in a topic</p>
</li>
<li>
<p>Adding more disk capacity to increase the message buffer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Actions to reduce consumer lag depend on the underlying infrastructure and the use cases Strimzi is supporting.
For instance, a lagging consumer is less likely to benefit from the broker being able to service a fetch request from its disk cache.
And in certain cases, it might be acceptable to automatically drop messages until a consumer has caught up.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-metrics-kafka-exporter-alerts-str"><a class="link" href="#con-metrics-kafka-exporter-alerts-str">10.2. Kafka Exporter alerting rule examples</a></h3>
<div class="paragraph">
<p>If you performed the steps to introduce metrics to your deployment, you will already have your Kafka cluster configured to use the alert notification rules that support Kafka Exporter.</p>
</div>
<div class="paragraph">
<p>The rules for Kafka Exporter are defined in <code>prometheus-rules.yaml</code>, and are deployed with Prometheus.
For more information, see  <a href="#assembly-metrics-prometheus-str">Prometheus</a>.</p>
</div>
<div class="paragraph">
<p>The sample alert notification rules specific to Kafka Exporter are as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>UnderReplicatedPartition</code></dt>
<dd>
<p>An alert to warn that a topic is under-replicated and the broker is not replicating to enough partitions.
The default configuration is for an alert if there are one or more under-replicated partitions for a topic.
The alert might signify that a Kafka instance is down or the Kafka cluster is overloaded.
A planned restart of the Kafka broker may be required to restart the replication process.</p>
</dd>
<dt class="hdlist1"><code>TooLargeConsumerGroupLag</code></dt>
<dd>
<p>An alert to warn that the lag on a consumer group is too large for a specific topic partition.
The default configuration is 1000 records.
A large lag might indicate that consumers are too slow and are falling behind the producers.</p>
</dd>
<dt class="hdlist1"><code>NoMessageForTooLong</code></dt>
<dd>
<p>An alert to warn that a topic has not received messages for a period of time.
The default configuration for the time period is 10 minutes.
The delay might be a result of a configuration issue preventing a producer from publishing messages to the topic.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Adapt the default configuration of these rules according to your specific needs.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-metrics-setup-str">Introducing Metrics</a></p>
</li>
<li>
<p><a href="#ref-metrics-config-files-str">Example Metrics files</a></p>
</li>
<li>
<p><a href="#con-metrics-prometheus-alerts-str">Alerting rules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ref-metrics-kafka-exporter-str"><a class="link" href="#ref-metrics-kafka-exporter-str">10.3. Kafka Exporter metrics</a></h3>
<div class="paragraph">
<p>Lag information is exposed by Kafka Exporter as Prometheus metrics for presentation in Grafana.</p>
</div>
<div class="paragraph">
<p>Kafka Exporter exposes metrics data for brokers, topics and consumer groups.</p>
</div>
<div class="paragraph">
<p>The data extracted is described here.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 2. Broker metrics output</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_brokers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of brokers in the Kafka cluster</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 3. Topic metrics output</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of partitions for a topic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_current_offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current topic partition offset for a broker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_oldest_offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oldest topic partition offset for a broker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_in_sync_replica</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of in-sync replicas for a topic partition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_leader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leader broker ID of a topic partition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_leader_is_preferred</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows <code>1</code> if a topic partition is using the preferred broker</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_replicas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of replicas for this topic partition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_topic_partition_under_replicated_partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows <code>1</code> if a topic partition is under-replicated</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 4. Consumer group metrics output</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Information</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_consumergroup_current_offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current topic partition offset for a consumer group</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka_consumergroup_lag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current approximate lag for a consumer group at a topic partition</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="proc-kafka-exporter-enabling-str"><a class="link" href="#proc-kafka-exporter-enabling-str">10.4. Enabling the Kafka Exporter Grafana dashboard</a></h3>
<div class="paragraph">
<p>If you deployed Kafka Exporter with your Kafka cluster, you can enable Grafana to present the metrics data it exposes.</p>
</div>
<div class="paragraph">
<p>A Kafka Exporter dashboard is provided in the <code>examples/metrics</code> directory as a JSON file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>strimzi-kafka-exporter.json</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kafka cluster is deployed with <a href="#proc-kafka-exporter-configuring-deployment-configuration-kafka">Kafka Exporter metrics configuration</a></p>
</li>
<li>
<p><a href="#assembly-metrics-prometheus-str">Prometheus and Prometheus Alertmanager are deployed to the Kafka cluster</a></p>
</li>
<li>
<p><a href="#proc-metrics-deploying-grafana-str">Grafana is deployed to the Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure assumes you already have access to the Grafana user interface and Prometheus has been added as a data source.
If you are accessing the user interface for the first time, see <a href="#assembly-metrics-grafana-str">Grafana</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the Grafana user interface.</p>
</li>
<li>
<p>Click <strong>Dashboards</strong>, then <strong>Import</strong> to open the <em>Import Dashboard</em> window and import the example Kafka Exporter dashboard (or paste the JSON).</p>
<div class="paragraph">
<p>When metrics data has been collected for some time, the Kafka Exporter charts are populated.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Kafka Exporter Grafana charts</div>
<p>From the metrics, you can create charts to display:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message in per second (from topics)</p>
</li>
<li>
<p>Message in per minute (from topics)</p>
</li>
<li>
<p>Lag by consumer group</p>
</li>
<li>
<p>Messages consumed per minute (by consumer groups)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the Grafana charts to analyze lag and to check if actions to reduce lag are having an impact on an affected consumer group.
If, for example, Kafka brokers are adjusted to reduce lag, the dashboard will show the  <em>Lag by consumer group</em> chart going down and the <em>Messages consumed per minute</em> chart going up.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-str"><a class="link" href="#security-str">11. Security</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi supports encrypted communication between the Kafka and Strimzi components using the TLS protocol.
Communication between Kafka brokers (interbroker communication), between Zookeeper nodes (internodal communication), and between these and the Strimzi operators is always encrypted.
Communication between Kafka clients and Kafka brokers is encrypted according to how the cluster is configured.
For the Kafka and Strimzi components, TLS certificates are also used for authentication.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator automatically sets up TLS certificates to enable encryption and authentication within your cluster.
It also sets up other TLS certificates if you want to enable encryption or TLS authentication between Kafka brokers and clients.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/secure_communication.png" alt="Secure Communication">
</div>
<div class="title">Figure 1. Example architecture diagram of the communication secured by TLS.</div>
</div>
<div class="sect2">
<h3 id="certificate-authorities-str"><a class="link" href="#certificate-authorities-str">11.1. Certificate Authorities</a></h3>
<div class="paragraph">
<p>To support encryption, each Strimzi component needs its own private keys and public key certificates.
All component certificates are signed by a Certificate Authority (CA) called the <em>cluster CA</em>.</p>
</div>
<div class="paragraph">
<p>Similarly, each Kafka client application connecting using TLS client authentication needs private keys and certificates.
The <em>clients CA</em> is used to sign the certificates for the Kafka clients.</p>
</div>
<div class="sect3">
<h4 id="ca_certificates"><a class="link" href="#ca_certificates">11.1.1. CA certificates</a></h4>
<div class="paragraph">
<p>Each CA has a self-signed public key certificate.</p>
</div>
<div class="paragraph">
<p>Kafka brokers are configured to trust certificates signed by either the clients CA or the cluster CA. Components to which clients do not need to connect, such as Zookeeper, only trust certificates signed by the cluster CA. Client applications that perform mutual TLS authentication have to trust the certificates signed by the cluster CA.</p>
</div>
<div class="paragraph">
<p>By default, Strimzi generates and renews CA certificates automatically. You can configure the management of CA certificates in the <code>Kafka.spec.clusterCa</code> and <code>Kafka.spec.clientsCa</code> objects.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="certificates-and-secrets-str"><a class="link" href="#certificates-and-secrets-str">11.2. Certificates and <code>Secrets</code></a></h3>
<div class="paragraph">
<p>Strimzi stores Certificate Authority (CA), component, and Kafka client private keys and certificates in <code>Secrets</code>.
All keys are 2048 bits in size.</p>
</div>
<div class="paragraph">
<p>CA certificate validity periods are expressed as a number of days after certificate generation. You can configure the validity period of cluster CA certificates in <code>Kafka.spec.clusterCa.validityDays</code> and client CA certificates in <code>Kafka.spec.clientsCa.validityDays</code>.</p>
</div>
<div class="sect3">
<h4 id="cluster_ca_secrets"><a class="link" href="#cluster_ca_secrets">11.2.1. Cluster CA <code>Secrets</code></a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Cluster CA <code>Secrets</code> managed by the Cluster Operator in <em>&lt;cluster&gt;</em></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>Secret</code> name</th>
<th class="tableblock halign-left valign-top">Field within <code>Secret</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-cluster-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the cluster CA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the cluster CA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-brokers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for Kafka broker pod <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for Kafka broker pod <em>&lt;num&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-nodes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for Zookeeper node <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for Zookeeper pod <em>&lt;num&gt;</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-entity-operator-certs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator_.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for TLS communication between the Entity Operator and Kafka or Zookeeper.
                                   Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for TLS communication between the Entity Operator and Kafka or Zookeeper</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The CA certificates in <code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> must be trusted by Kafka client applications so that they validate the Kafka broker certificates when connecting to Kafka brokers over TLS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Only <code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> needs to be used by clients.
All other <code>Secrets</code> in the table above only need to be accessed by the
 Strimzi components.
 You can enforce this using Kubernetes role-based access controls if necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="client_ca_secrets"><a class="link" href="#client_ca_secrets">11.2.2. Client CA <code>Secrets</code></a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Clients CA <code>Secrets</code> managed by the Cluster Operator in <em>&lt;cluster&gt;</em></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>Secret</code> name</th>
<th class="tableblock halign-left valign-top">Field within <code>Secret</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-clients-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the clients CA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-clients-ca-cert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the clients CA.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The certificates in <code><em>&lt;cluster&gt;</em>-clients-ca-cert</code> are those which the Kafka brokers trust.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code><em>&lt;cluster&gt;</em>-cluster-ca</code> is used to sign certificates of client applications.
It needs to be accessible to the Strimzi components and for administrative access if you are intending to issue application certificates without using the User Operator.
You can enforce this using Kubernetes role-based access controls if necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="user_secrets"><a class="link" href="#user_secrets">11.2.3. User <code>Secrets</code></a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. <code>Secrets</code> managed by the User Operator</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 20%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>Secret</code> name</th>
<th class="tableblock halign-left valign-top">Field within <code>Secret</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code><em>&lt;user&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for the user, signed by the clients CA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for the user</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="installing-your-own-ca-certificates-str"><a class="link" href="#installing-your-own-ca-certificates-str">11.3. Installing your own CA certificates</a></h3>
<div class="paragraph">
<p>This procedure describes how to install your own CA certificates and private keys instead of using CA certificates and private keys generated by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster is not yet deployed.</p>
</li>
<li>
<p>Your own X.509 certificates and keys in PEM format for the cluster CA or clients CA.</p>
<div class="ulist">
<ul>
<li>
<p>If you want to use a cluster or clients CA which is not a Root CA, you have to include the whole chain in the certificate file.
The chain should be in the following order:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The cluster or clients CA</p>
</li>
<li>
<p>One or more intermediate CAs</p>
</li>
<li>
<p>The root CA</p>
</li>
</ol>
</div>
</li>
<li>
<p>All CAs in the chain should be configured as a CA in the X509v3 Basic Constraints.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Put your CA certificate in the corresponding <code>Secret</code> (<code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> for the cluster CA or <code><em>&lt;cluster&gt;</em>-clients-ca-cert</code> for the clients CA):</p>
<div class="paragraph">
<p>Run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># Delete any existing secret (ignore "Not Exists" errors)
kubectl delete secret <em>&lt;ca-cert-secret&gt;</em>
# Create and label the new one
kubectl create secret generic <em>&lt;ca-cert-secret&gt;</em> --from-file=ca.crt=<em>&lt;ca-cert-file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Put your CA key in the corresponding <code>Secret</code> (<code><em>&lt;cluster&gt;</em>-cluster-ca</code> for the cluster CA or <code><em>&lt;cluster&gt;</em>-clients-ca</code> for the clients CA)
Run the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># Delete the existing secret
kubectl delete secret <em>&lt;ca-key-secret&gt;</em>
# Create the new one
kubectl create secret generic <em>&lt;ca-key-secret&gt;</em> --from-file=ca.key=<em>&lt;ca-key-file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Label both <code>Secrets</code> with labels <code>strimzi.io/kind=Kafka</code> and <code>strimzi.io/cluster=<em>&lt;my-cluster&gt;</em></code>:
Run the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label secret <em>&lt;ca-cert-secret&gt;</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>&lt;my-cluster&gt;</em>
kubectl label secret <em>&lt;ca-key-secret&gt;</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>&lt;my-cluster&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Kafka</code> resource for your cluster, configuring either the <code>Kafka.spec.clusterCa</code> or the <code>Kafka.spec.clientsCa</code> object to <em>not</em> use generated CAs:</p>
<div class="listingblock">
<div class="title">Example fragment <code>Kafka</code> resource configuring the cluster CA to use certificates you supply for yourself</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: Kafka
version: kafka.strimzi.io/v1beta1
spec:
  # ...
  clusterCa:
    generateCertificateAuthority: false</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="con-certificate-renewal-str"><a class="link" href="#con-certificate-renewal-str">11.4. Certificate renewal</a></h3>
<div class="paragraph">
<p>The cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.
This is usually defined as a number of days since the certificate was generated.
For auto-generated CA certificates, you can configure the validity period in <code>Kafka.spec.clusterCa.validityDays</code> and <code>Kafka.spec.clientsCa.validityDays</code>.
The default validity period for both certificates is 365 days.
Manually-installed CA certificates should have their own validity period defined.</p>
</div>
<div class="paragraph">
<p>When a CA certificate expires, components and clients which still trust that certificate will not accept TLS connections from peers whose certificate were signed by the CA private key.
The components and clients need to trust the <em>new</em> CA certificate instead.</p>
</div>
<div class="paragraph">
<p>To allow the renewal of CA certificates without a loss of service, the Cluster Operator will initiate certificate renewal before the old CA certificates expire.
You can configure the renewal period in <code>Kafka.spec.clusterCa.renewalDays</code> and <code>Kafka.spec.clientsCa.renewalDays</code> (both default to 30 days).
The renewal period is measured backwards, from the expiry date of the current certificate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Not Before                                     Not After
    |                                              |
    |&lt;--------------- validityDays ---------------&gt;|
                              &lt;--- renewalDays ---&gt;|</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the Cluster Operator during the renewal period depends on whether the relevant setting is enabled, in either <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> or <code>Kafka.spec.clientsCa.generateCertificateAuthority</code>.</p>
</div>
<div class="sect3">
<h4 id="renewal_process_with_generated_cas"><a class="link" href="#renewal_process_with_generated_cas">11.4.1. Renewal process with generated CAs</a></h4>
<div class="paragraph">
<p>The Cluster Operator performs the following process to renew CA certificates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a new CA certificate, but retaining the existing key. The new certificate replaces the old one with the name <code>ca.crt</code> within the corresponding <code>Secret</code>.</p>
</li>
<li>
<p>Generate new client certificates (for Zookeeper nodes, Kafka brokers, and the Entity Operator).
This is not strictly necessary because the signing key has not changed, but it keeps the validity period of the client certificate in sync with the CA certificate.</p>
</li>
<li>
<p>Restart Zookeeper nodes so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restart Kafka brokers so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restart the Topic and User Operators so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="client_applications"><a class="link" href="#client_applications">11.4.2. Client applications</a></h4>
<div class="paragraph">
<p>The Cluster Operator is not aware of all the client applications using the Kafka cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Depending on how your applications are configured, you might need take action to ensure they continue working after certificate renewal.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Consider the following important points to ensure that client applications continue working.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When they connect to the cluster, client applications must trust the cluster CA certificate published in <em>&lt;cluster&gt;</em>-cluster-ca-cert.</p>
</li>
<li>
<p>When using the User Operator to provision client certificates, client applications must use the current <code>user.crt</code> and <code>user.key</code> published in their <code><em>&lt;user&gt;</em></code> <code>Secret</code> when they connect to the cluster.
For workloads running inside the same Kubernetes cluster this can be achieved by mounting the secrets as a volume and having the client Pods construct their key- and truststores from the current state of the <code>Secrets</code>.
For more details on this procedure, see <a href="#configuring-internal-clients-to-trust-cluster-ca-str">Configuring internal clients to trust the cluster CA</a>.</p>
</li>
<li>
<p>When renewing client certificates, if you are provisioning client certificates and keys manually, you must generate new client certificates and ensure the new certificates are used by clients within the renewal period. Failure to do this by the end of the renewal period could result in client applications being unable to connect.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-renewing-ca-certs-manually-str"><a class="link" href="#proc-renewing-ca-certs-manually-str">11.5. Renewing CA certificates manually</a></h3>
<div class="paragraph">
<p>Unless the <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> and <code>Kafka.spec.clientsCa.generateCertificateAuthority</code> objects are set to <code>false</code>, the cluster and clients CA certificates will auto-renew at the start of their respective certificate renewal periods.
You can manually renew one or both of these certificates before the certificate renewal period starts, if required for security reasons.
A renewed certificate uses the same private key as the old certificate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-renew</code> annotation to the <code>Secret</code> that contains the CA certificate that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will generate a new CA certificate for the <code>Secret</code> that you annotated.
If maintenance time windows are configured, the Cluster Operator will generate the new CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Certificates and <code>Secrets</code></a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-replacing-private-keys-str"><a class="link" href="#proc-replacing-private-keys-str">11.6. Replacing private keys</a></h3>
<div class="paragraph">
<p>You can replace the private keys used by the cluster CA and clients CA certificates.
When a private key is replaced, the Cluster Operator generates a new CA certificate for the new private key.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-replace</code> annotation to the <code>Secret</code> that contains the private key that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Private key for</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca strimzi.io/force-replace=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca strimzi.io/force-replace=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new private key for the <code>Secret</code> that you annotated</p>
</li>
<li>
<p>Generate a new CA certificate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will generate the new private key and CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Certificates and <code>Secrets</code></a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tls-connections-str"><a class="link" href="#tls-connections-str">11.7. TLS connections</a></h3>
<div class="sect3">
<h4 id="zookeeper_communication"><a class="link" href="#zookeeper_communication">11.7.1. Zookeeper communication</a></h4>
<div class="paragraph">
<p>Zookeeper does not support TLS itself.
By deploying a TLS sidecar within every Zookeeper pod, the Cluster Operator is able to provide data encryption and authentication between Zookeeper nodes in a cluster.
Zookeeper only communicates with the TLS sidecar over the loopback interface.
The TLS sidecar then proxies all Zookeeper traffic, TLS decrypting data upon entry into a Zookeeper pod, and TLS encrypting data upon departure from a Zookeeper pod.</p>
</div>
<div class="paragraph">
<p>This TLS encrypting <code>stunnel</code> proxy is instantiated from the <code>spec.zookeeper.stunnelImage</code> specified in the Kafka resource.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_interbroker_communication"><a class="link" href="#kafka_interbroker_communication">11.7.2. Kafka interbroker communication</a></h4>
<div class="paragraph">
<p>Communication between Kafka brokers is done through an internal listener on port 9091, which is encrypted by default and not accessible to Kafka clients.</p>
</div>
<div class="paragraph">
<p>Communication between Kafka brokers and Zookeeper nodes uses a TLS sidecar, as described above.</p>
</div>
</div>
<div class="sect3">
<h4 id="topic_and_user_operators"><a class="link" href="#topic_and_user_operators">11.7.3. Topic and User Operators</a></h4>
<div class="paragraph">
<p>Like the Cluster Operator, the Topic and User Operators each use a TLS sidecar when communicating with Zookeeper. The Topic Operator connects to Kafka brokers on port 9091.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_client_connections"><a class="link" href="#kafka_client_connections">11.7.4. Kafka Client connections</a></h4>
<div class="paragraph">
<p>Encrypted communication between Kafka brokers and clients running within the same Kubernetes cluster can be provided by configuring the <code>spec.kafka.listeners.tls</code> listener, which listens on port 9093.</p>
</div>
<div class="paragraph">
<p>Encrypted communication between Kafka brokers and clients running outside the same Kubernetes cluster can be provided by configuring the <code>spec.kafka.listeners.external</code> listener (the port of the <code>external</code> listener depends on its type).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Unencrypted client communication with brokers can be configured by <code>spec.kafka.listeners.plain</code>, which listens on port 9092.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-internal-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-internal-clients-to-trust-cluster-ca-str">11.8. Configuring internal clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides inside the Kubernetes cluster  connecting to the <code>tls</code> listener on port 9093  to trust the cluster CA certificate.</p>
</div>
<div class="paragraph">
<p>The easiest way to achieve this for an internal client is to use a volume mount to access the <code>Secrets</code> containing the necessary certificates and keys.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A <code>Kafka</code> resource within the Kubernetes cluster.</p>
</li>
<li>
<p>A Kafka client application inside the Kubernetes cluster which will connect using TLS and needs to trust the cluster CA certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>When defining the client <code>Pod</code></p>
</li>
<li>
<p>The Kafka client has to be configured to trust certificates signed by this CA.
For the Java-based Kafka Producer, Consumer, and Streams APIs, you can do this by importing the CA certificate into the JVM&#8217;s truststore using the following <code>keytool</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">keytool -keystore client.truststore.jks -alias CARoot -import -file ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>To configure the Kafka client, specify the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS for encryption (with or without TLS authentication), or <code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
<li>
<p><code>ssl.truststore.location</code>: the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code>: the password for accessing the truststore. This property can be omitted if it is not needed by the truststore.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For the procedure for configuring external clients to trust the cluster CA, see <a href="#configuring-external-clients-to-trust-cluster-ca-str">Configuring external clients to trust the cluster CA</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-external-clients-to-trust-cluster-ca-str">11.9. Configuring external clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides outside the Kubernetes cluster  connecting to the <code>external</code> listener on port 9094  to trust the cluster CA certificate.</p>
</div>
<div class="paragraph">
<p>You can use the same procedure to configure clients inside Kubernetes, which connect to the <code>tls</code> listener on port 9093, but it is usually more convenient to access the <code>Secrets</code> using a volume mount in the client <code>Pod</code>.</p>
</div>
<div class="paragraph">
<p>Follow this procedure when setting up the client and during the renewal period, when the old clients CA certificate is replaced.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</code> <code>Secret</code> will contain more than one CA certificate during CA certificate renewal. Clients must add <em>all</em> of them to their truststores.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A <code>Kafka</code> resource within the {ProductPlatformName} cluster.</p>
</li>
<li>
<p>A Kafka client application outside the {ProductPlatformName} cluster which will connect using TLS and needs to trust the cluster CA certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate from the generated <code><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</code> <code>Secret</code>.</p>
<div class="paragraph">
<p>Run the following command to extract the certificates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>The Kafka client has to be configured to trust certificates signed by this CA.
For the Java-based Kafka Producer, Consumer, and Streams APIs, you can do this by importing the CA certificates into the JVM&#8217;s truststore using the following <code>keytool</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">keytool -keystore client.truststore.jks -alias CARoot -import -file ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>To configure the Kafka client, specify the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS for encryption (with or without TLS authentication), or <code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
<li>
<p><code>ssl.truststore.location</code>: the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code>: the password for accessing the truststore. This property can be omitted if it is not needed by the truststore.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For the procedure for configuring internal clients to trust the cluster CA, see <a href="#configuring-internal-clients-to-trust-cluster-ca-str">Configuring internal clients to trust the cluster CA</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-upgrade-str"><a class="link" href="#assembly-upgrade-str">12. Strimzi and Kafka upgrades</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi can be upgraded with no cluster downtime. Each version of Strimzi supports one or more versions of Apache Kafka: you can upgrade to a higher Kafka version as long as it is supported by your version of Strimzi.
In some cases, you can also downgrade to a lower supported Kafka version.</p>
</div>
<div class="paragraph">
<p>Newer versions of Strimzi may support newer versions of Kafka, but you need to upgrade Strimzi <em>before</em> you can upgrade to a higher supported Kafka version.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<a href="#assembly-upgrade-resources-str">Resource upgrades</a> <em>must</em> be performed after upgrading Strimzi and Kafka.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-upgrade-intro-str"><a class="link" href="#con-upgrade-intro-str">12.1. Upgrade process</a></h3>
<div class="paragraph">
<p>Upgrading Strimzi is a two-stage process. To upgrade brokers and clients without downtime, you <em>must</em> complete the upgrade procedures in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update your Cluster Operator to the latest Strimzi version.</p>
<div class="ulist">
<ul>
<li>
<p><a href="#assembly-upgrade-cluster-operator-str">Upgrading the Cluster Operator</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Upgrade all Kafka brokers and client applications to the latest Kafka version.</p>
<div class="ulist">
<ul>
<li>
<p><a href="#assembly-upgrading-kafka-versions-str">Upgrading Kafka</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-kafka-versions-str"><a class="link" href="#ref-kafka-versions-str">12.2. Kafka versions</a></h3>
<div class="paragraph">
<p>Kafka&#8217;s log message format version and inter-broker protocol version specify the log format version appended to messages and the version of protocol used in a cluster. As a result, the upgrade process involves making configuration changes to existing Kafka brokers and code changes to client applications (consumers and producers) to ensure the correct versions are used.</p>
</div>
<div class="paragraph">
<p>The following table shows the differences between Kafka versions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kafka version</th>
<th class="tableblock halign-left valign-top">Interbroker protocol version</th>
<th class="tableblock halign-left valign-top">Log message format version</th>
<th class="tableblock halign-left valign-top">Zookeeper version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4.13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.4.13</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Message format version</div>
<p>When a producer sends a message to a Kafka broker, the message is encoded using a specific format.
The format can change between Kafka releases, so messages include a version identifying which version of the format they were encoded with. You can configure a Kafka broker to convert messages from newer format versions to a given older format version before the broker appends the message to the log.</p>
</div>
<div class="paragraph">
<p>In Kafka, there are two different methods for setting the message format version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>message.format.version</code> property is set on topics.</p>
</li>
<li>
<p>The <code>log.message.format.version</code> property is set on Kafka brokers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default value of <code>message.format.version</code> for a topic is defined by the <code>log.message.format.version</code> that is set on the Kafka broker. You can manually set the <code>message.format.version</code> of a topic by modifying its topic configuration.</p>
</div>
<div class="paragraph">
<p>The upgrade tasks in this section assume that the message format version is defined by the <code>log.message.format.version</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="assembly-upgrade-cluster-operator-str"><a class="link" href="#assembly-upgrade-cluster-operator-str">12.3. Upgrading the Cluster Operator</a></h3>
<div class="paragraph">
<p>The steps to upgrade your Cluster Operator deployment to use Strimzi latest are outlined in this section.</p>
</div>
<div class="paragraph">
<p>The availability of Kafka clusters managed by the Cluster Operator is not affected by the upgrade operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Refer to the documentation supporting a specific version of Strimzi for information on how to upgrade to that version.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-upgrading-the-co-str"><a class="link" href="#proc-upgrading-the-co-str">12.3.1. Upgrading the Cluster Operator to a later version</a></h4>
<div class="paragraph">
<p>This procedure describes how to upgrade a Cluster Operator deployment to a later version.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Cluster Operator deployment.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Backup the existing Cluster Operator resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get all -l app=strimzi -o yaml &gt; strimzi-backup.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Update the Cluster Operator.</p>
<div class="paragraph">
<p>Modify the installation files according to the namespace the Cluster Operator is running in.</p>
</div>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: <em>my-namespace</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you modified one or more environment variables in your existing Cluster Operator <code>Deployment</code>, edit the
<code>install/cluster-operator/050-Deployment-cluster-operator.yaml</code> file to reflect the changes that you made in the new version of the Cluster Operator.</p>
</div>
</li>
<li>
<p>When you have an updated configuration, deploy it along with the rest of the install resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the rolling updates to complete.</p>
</div>
</li>
<li>
<p>Get the image for the Kafka pod to ensure the upgrade was successful:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get po my-cluster-kafka-0 -o jsonpath='{.spec.containers[0].image}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The image tag shows the new Strimzi version followed by the Kafka version. For example, <code><em>&lt;New Strimzi version&gt;</em>-kafka-<em>&lt;Current Kafka version&gt;</em></code>.</p>
</div>
</li>
<li>
<p>Update existing resources to handle deprecated custom resource properties.</p>
<div class="ulist">
<ul>
<li>
<p><a href="#assembly-upgrade-resources-str">Strimzi resource upgrades</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You now have an updated Cluster Operator, but the version of Kafka running in the cluster it manages is unchanged.</p>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>Following the Cluster Operator upgrade, you can perform a <a href="#assembly-upgrading-kafka-versions-str">Kafka upgrade</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-upgrading-kafka-versions-str"><a class="link" href="#assembly-upgrading-kafka-versions-str">12.4. Upgrading Kafka</a></h3>
<div class="paragraph">
<p>After you have upgraded your Cluster Operator, you can upgrade your brokers to a higher supported version of Kafka.</p>
</div>
<div class="paragraph">
<p>Kafka upgrades are performed using the Cluster Operator. How the Cluster Operator performs an upgrade depends on the differences between versions of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interbroker protocol</p>
</li>
<li>
<p>Log message format</p>
</li>
<li>
<p>Zookeeper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the versions are the same for the current and target Kafka version, as is typically the case for a patch level upgrade, the Cluster Operator can upgrade through a single rolling update of the Kafka brokers.</p>
</div>
<div class="paragraph">
<p>When one or more of these versions differ, the Cluster Operator requires two or three rolling updates of the Kafka brokers to perform the upgrade.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-upgrade-cluster-operator-str">Upgrading the Cluster Operator</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-versions-and-images-str"><a class="link" href="#con-versions-and-images-str">12.4.1. Kafka version and image mappings</a></h4>
<div class="paragraph">
<p>When upgrading Kafka, consider your settings for the <code>STRIMZI_KAFKA_IMAGES</code> and <code>Kafka.spec.kafka.version</code> properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each <code>Kafka</code> resource can be configured with a <code>Kafka.spec.kafka.version</code>.</p>
</li>
<li>
<p>The Cluster Operator&#8217;s <code>STRIMZI_KAFKA_IMAGES</code> environment variable provides a mapping between the Kafka version and the image to be used when that version is requested in a given <code>Kafka</code> resource.</p>
<div class="ulist">
<ul>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is not configured, the default image for the given version is used.</p>
</li>
<li>
<p>If <code>Kafka.spec.kafka.image</code> is configured, the default image is overridden.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The Cluster Operator cannot validate that an image actually contains a Kafka broker of the expected version.
Take care to ensure that the given image corresponds to the given Kafka version.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-strategies-for-upgrading-clients-str"><a class="link" href="#con-strategies-for-upgrading-clients-str">12.4.2. Strategies for upgrading clients</a></h4>
<div class="paragraph">
<p>The best approach to upgrading your client applications (including Kafka Connect connectors) depends on your particular circumstances.</p>
</div>
<div class="paragraph">
<p>Consuming applications need to receive messages in a message format that they understand. You can ensure that this is the case in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By upgrading all the consumers for a topic <em>before</em> upgrading any of the producers.</p>
</li>
<li>
<p>By having the brokers down-convert messages to an older format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using broker down-conversion puts extra load on the brokers, so it is not ideal to rely on down-conversion for all topics for a prolonged period of time.
For brokers to perform optimally they should not be down converting messages at all.</p>
</div>
<div class="paragraph">
<p>Broker down-conversion is configured in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The topic-level <code>message.format.version</code> configures it for a single topic.</p>
</li>
<li>
<p>The broker-level <code>log.message.format.version</code> is the default for topics that do not have the topic-level <code>message.format.version</code> configured.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Messages published to a topic in a new-version format will be visible to consumers, because brokers perform down-conversion when they receive messages from producers, not when they are sent to consumers.</p>
</div>
<div class="paragraph">
<p>There are a number of strategies you can use to upgrade your clients:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Consumers first</dt>
<dd>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade all the consuming applications.</p>
</li>
<li>
<p>Change the broker-level <code>log.message.format.version</code> to the new version.</p>
</li>
<li>
<p>Upgrade all the producing applications.</p>
<div class="paragraph">
<p>This strategy is straightforward, and avoids any broker down-conversion.
However, it assumes that all consumers in your organization can be upgraded in a coordinated way, and it does not work for applications that are both consumers and producers.
There is also a risk that, if there is a problem with the upgraded clients, new-format messages might get added to the message log so that you cannot revert to the previous consumer version.</p>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Per-topic consumers first</dt>
<dd>
<p>For each topic:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upgrade all the consuming applications.</p>
</li>
<li>
<p>Change the topic-level <code>message.format.version</code> to the new version.</p>
</li>
<li>
<p>Upgrade all the producing applications.</p>
<div class="paragraph">
<p>This strategy avoids any broker down-conversion, and means you can proceed on a topic-by-topic basis. It does not work for applications that are both consumers and producers of the same topic. Again, it has the risk that, if there is a problem with the upgraded clients, new-format messages might get added to the message log.</p>
</div>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">Per-topic consumers first, with down conversion</dt>
<dd>
<p>For each topic:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the topic-level <code>message.format.version</code> to the old version
(or rely on the topic defaulting to the broker-level <code>log.message.format.version</code>).</p>
</li>
<li>
<p>Upgrade all the consuming and producing applications.</p>
</li>
<li>
<p>Verify that the upgraded applications function correctly.</p>
</li>
<li>
<p>Change the topic-level <code>message.format.version</code> to the new version.</p>
<div class="paragraph">
<p>This strategy requires broker down-conversion, but the load on the brokers is minimized because it is only required for a single topic (or small group of topics) at a time. It also works for applications that are both consumers and producers of the same topic. This approach ensures that the upgraded producers and consumers are working correctly before you commit to using the new message format version.</p>
</div>
<div class="paragraph">
<p>The main drawback of this approach is that it can be complicated to manage in a cluster with many topics and applications.</p>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Other strategies for upgrading client applications are also possible.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is also possible to apply multiple strategies.
For example, for the first few applications and topics the
"per-topic consumers first, with down conversion" strategy can be used.
When this has proved successful another, more efficient strategy can be considered acceptable to use instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-upgrading-brokers-newer-kafka-str"><a class="link" href="#proc-upgrading-brokers-newer-kafka-str">12.4.3. Upgrading Kafka brokers and client applications</a></h4>
<div class="paragraph">
<p>This procedure describes how to upgrade a Strimzi Kafka cluster to a higher version of Kafka.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>For the <code>Kafka</code> resource to be upgraded, check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Cluster Operator, which supports both versions of Kafka, is up and running.</p>
</li>
<li>
<p>The <code>Kafka.spec.kafka.config</code> does not contain options that are not supported in the version of Kafka that you are upgrading to.</p>
</li>
<li>
<p>Whether the <code>log.message.format.version</code> for the current Kafka version needs to be updated for the new version.</p>
<div class="paragraph">
<p><a href="#assembly-upgrade-str">Consult the Kafka versions table</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>my-cluster</em></code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the <code>log.message.format.version</code> of the current Kafka version is the same as that of the new Kafka version, proceed to the next step.</p>
<div class="paragraph">
<p>Otherwise, ensure that <code>Kafka.spec.kafka.config</code> has the <code>log.message.format.version</code> configured to the default for the current version.</p>
</div>
<div class="paragraph">
<p>For example, if upgrading from Kafka 2.2.1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: Kafka
spec:
  # ...
  kafka:
    version: 2.2.1
    config:
      log.message.format.version: "2.2"
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>log.message.format.version</code> is unset, set it to the current version.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The value of <code>log.message.format.version</code> must be a string to prevent it from being interpreted as a floating point number.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Change the <code>Kafka.spec.kafka.version</code> to specify the new version (leaving the <code>log.message.format.version</code> as the current version).</p>
<div class="paragraph">
<p>For example, if upgrading from Kafka 2.2.1 to 2.3.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1alpha1
kind: Kafka
spec:
  # ...
  kafka:
    version: 2.3.0 <b class="conum">(1)</b>
    config:
      log.message.format.version: "2.2" <b class="conum">(2)</b>
      # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This is changed to the new version</p>
</li>
<li>
<p>This remains at the current version</p>
</li>
</ol>
</div>
</li>
<li>
<p>If the image for the Kafka version is different from the image defined in <code>STRIMZI_KAFKA_IMAGES</code> for the Cluster Operator, update <code>Kafka.spec.kafka.image</code>.</p>
<div class="paragraph">
<p>See <a href="#con-versions-and-images-str">Kafka version and image mappings</a></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save and exit the editor, then wait for rolling updates to complete.</p>
<div class="paragraph">
<p>Check the update in the logs or by watching the pod state transitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl logs -f <em>&lt;cluster-operator-pod-name&gt;</em> | grep -E "Kafka version upgrade from [0-9.]+ to [0-9.]+, phase ([0-9]+) of \1 completed"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get po -w</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If the current and new versions of Kafka have different interbroker protocol versions, check the Cluster Operator logs for an <code>INFO</code> level message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Reconciliation #<em>&lt;num&gt;</em>(watch) Kafka(<em>&lt;namespace&gt;</em>/<em>&lt;name&gt;</em>): Kafka version upgrade from <em>&lt;from-version&gt;</em> to <em>&lt;to-version&gt;</em>, phase 2 of 2 completed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the current and new versions of Kafka have the same interbroker protocol version, check for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Reconciliation #<em>&lt;num&gt;</em>(watch) Kafka(<em>&lt;namespace&gt;</em>/<em>&lt;name&gt;</em>): Kafka version upgrade from <em>&lt;from-version&gt;</em> to <em>&lt;to-version&gt;</em>, phase 1 of 1 completed</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The rolling updates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure each pod is using the broker binaries for the new version of Kafka</p>
</li>
<li>
<p>Configure the brokers to send messages using the interbroker protocol of the new version of Kafka</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Clients are still using the old version, so brokers will convert messages to the old version before sending them to the clients. To minimize this additional load, updates the clients as quickly as possible.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Depending on your chosen strategy for upgrading clients, upgrade all client applications to use the new version of the client binaries.</p>
<div class="paragraph">
<p>See <a href="#con-strategies-for-upgrading-clients-str">Strategies for upgrading clients</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
You cannot downgrade after completing this step. If you need to revert the update at this point, follow the procedure <a href="#proc-downgrading-brokers-older-kafka-str">Downgrading Kafka brokers and client applications</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If required, set the version property for Kafka Connect and Mirror Maker as the new version of Kafka:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For Kafka Connect, update <code>KafkaConnect.spec.version</code></p>
</li>
<li>
<p>For MIrror Maker, update <code>KafkaMirrorMaker.spec.version</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>If the <code>log.message.format.version</code> identified in step 1 is the same as the new version proceed to the next step.</p>
<div class="paragraph">
<p>Otherwise change the <code>log.message.format.version</code> in <code>Kafka.spec.kafka.config</code> to the default version for the new version of Kafka now being used.</p>
</div>
<div class="paragraph">
<p>For example, if upgrading to 2.3.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1alpha1
kind: Kafka
spec:
  # ...
  kafka:
    version: 2.3.0
    config:
      log.message.format.version: "2.3"
      # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the Cluster Operator to update the cluster.</p>
<div class="paragraph">
<p>The Kafka cluster and clients are now using the new Kafka version.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>See <a href="#proc-downgrading-brokers-older-kafka-str">Downgrading Kafka brokers and client applications</a> for the procedure to downgrade a Strimzi Kafka cluster from one version to a lower version.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-downgrading-kafka-versions-str"><a class="link" href="#assembly-downgrading-kafka-versions-str">12.5. Downgrading Kafka</a></h3>
<div class="paragraph">
<p>Kafka version downgrades are performed using the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>Whether and how the Cluster Operator performs a downgrade depends on the differences between versions of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interbroker protocol</p>
</li>
<li>
<p>Log message format</p>
</li>
<li>
<p>Zookeeper</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="com-target-downgrade-version-str"><a class="link" href="#com-target-downgrade-version-str">12.5.1. Target downgrade version</a></h4>
<div class="paragraph">
<p>How the Cluster Operator handles a downgrade operation depends on the <code>log.message.format.version</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the target downgrade version of Kafka has the same <code>log.message.format.version</code> as the current version, the Cluster Operator downgrades by performing a single rolling restart of the brokers.</p>
</li>
<li>
<p>If the target downgrade version of Kafka has a different <code>log.message.format.version</code>, downgrading is only possible if the running cluster has <em>always</em> had <code>log.message.format.version</code> set to the version used by the downgraded version.</p>
<div class="paragraph">
<p>This is typically only the case if the upgrade procedure was aborted before the <code>log.message.format.version</code> was changed.
In this case, the downgrade requires:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two rolling restarts of the brokers if the interbroker protocol of the two versions is different</p>
</li>
<li>
<p>A single rolling restart if they are the same</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-downgrading-brokers-older-kafka-str"><a class="link" href="#proc-downgrading-brokers-older-kafka-str">12.5.2. Downgrading Kafka brokers and client applications</a></h4>
<div class="paragraph">
<p>This procedure describes how you can downgrade a Strimzi Kafka cluster to a lower (previous) version of Kafka, such as downgrading from 2.3.0 to 2.2.1.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Downgrading is <em>not possible</em> if the new version has ever used a <code>log.message.format.version</code> that is not supported by the previous version, including when the default value for <code>log.message.format.version</code> is used. For example, this resource can be downgraded to Kafka version 2.2.1 because the <code>log.message.format.version</code> has not been changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1alpha1
kind: Kafka
spec:
  # ...
  kafka:
    version: 2.3.0
    config:
      log.message.format.version: "2.2"
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The downgrade would not be possible if the <code>log.message.format.version</code> was set at <code>"2.3"</code> or a value was absent (so that the parameter took the default value for a 2.3.0 broker of 2.3).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>For the <code>Kafka</code> resource to be downgraded, check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Cluster Operator, which supports both versions of Kafka, is up and running.</p>
</li>
<li>
<p>The <code>Kafka.spec.kafka.config</code> does not contain options that are not supported in the version of Kafka you are downgrading to.</p>
</li>
<li>
<p>The <code>Kafka.spec.kafka.config</code> has a <code>log.message.format.version</code> that is supported by the version being downgraded to.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="paragraph">
<p>Use <code>kubectl edit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>my-cluster</em></code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change the <code>Kafka.spec.kafka.version</code> to specify the previous version.</p>
<div class="paragraph">
<p>For example, if downgrading from Kafka 2.3.0 to 2.2.1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1alpha1
kind: Kafka
spec:
  # ...
  kafka:
    version: 2.2.1 <b class="conum">(1)</b>
    config:
      log.message.format.version: "2.2" <b class="conum">(2)</b>
      # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This is changed to the previous version</p>
</li>
<li>
<p>This is unchanged</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You must format the value of <code>log.message.format.version</code> as a string to prevent it from being interpreted as a floating point number.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the image for the Kafka version is different from the image defined in <code>STRIMZI_KAFKA_IMAGES</code> for the Cluster Operator, update <code>Kafka.spec.kafka.image</code>.</p>
<div class="paragraph">
<p>See <a href="#con-versions-and-images-str">Kafka version and image mappings</a></p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save and exit the editor, then wait for rolling updates to complete.</p>
<div class="paragraph">
<p>Check the update in the logs or by watching the pod state transitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl logs -f <em>&lt;cluster-operator-pod-name&gt;</em> | grep -E "Kafka version downgrade from [0-9.]+ to [0-9.]+, phase ([0-9]+) of \1 completed"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get po -w</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If the previous and current versions of Kafka have different interbroker protocol versions, check the Cluster Operator logs for an <code>INFO</code> level message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Reconciliation #<em>&lt;num&gt;</em>(watch) Kafka(<em>&lt;namespace&gt;</em>/<em>&lt;name&gt;</em>): Kafka version downgrade from <em>&lt;from-version&gt;</em> to <em>&lt;to-version&gt;</em>, phase 2 of 2 completed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if the previous and current versions of Kafka have the same interbroker protocol version, check for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Reconciliation #<em>&lt;num&gt;</em>(watch) Kafka(<em>&lt;namespace&gt;</em>/<em>&lt;name&gt;</em>): Kafka version downgrade from <em>&lt;from-version&gt;</em> to <em>&lt;to-version&gt;</em>, phase 1 of 1 completed</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Downgrade all client applications (consumers) to use the previous version of the client binaries.</p>
<div class="paragraph">
<p>The Kafka cluster and clients are now using the previous Kafka version.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-upgrade-resources-str"><a class="link" href="#assembly-upgrade-resources-str">13. Strimzi resource upgrades</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this release of Strimzi, resources that use the API version <code>kafka.strimzi.io/v1alpha1</code> must be updated to use <code>kafka.strimzi.io/v1beta1</code>.</p>
</div>
<div class="paragraph">
<p>The <code>kafka.strimzi.io/v1alpha1</code> API version is deprecated.</p>
</div>
<div class="paragraph">
<p>This section describes the upgrade steps for the resources.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The upgrade of resources <em>must</em> be performed after <a href="#assembly-upgrade-str">upgrading the Cluster Operator</a>, so the Cluster Operator can understand the resources.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">What if the resource upgrade does not take effect?</div>
<p>If the upgrade does not take effect, a warning is given in the logs on reconciliation to indicate that the resource cannot be updated until the <code>apiVersion</code> is updated.</p>
</div>
<div class="paragraph">
<p>To trigger the update, make a cosmetic change to the custom resource, such as adding an annotation.</p>
</div>
<div class="paragraph">
<p>Example annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">metadata:
  # ...
  annotations:
    upgrade: "Upgraded to kafka.strimzi.io/v1beta1"</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-resources-str"><a class="link" href="#proc-upgrade-kafka-resources-str">13.1. Upgrading Kafka resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Cluster Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>Kafka</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>Kafka</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>my-cluster</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>If the <code>Kafka</code> resource has:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.topicOperator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.entityOperator.topicOperator</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, replace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  topicOperator: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  entityOperator:
    topicOperator: {}</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.entityOperator.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.entityOperator.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.entityOperator.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.entityOperator.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  entityOperator:
    affinity {}
    tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  entityOperator:
    template:
      pod:
        affinity {}
        tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.kafka.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.kafka.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.kafka.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.kafka.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  kafka:
    affinity {}
    tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  kafka:
    template:
      pod:
        affinity {}
        tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.zookeeper.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.zookeeper.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.zookeeper.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Kafka.spec.zookeeper.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  zookeeper:
    affinity {}
    tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  zookeeper:
    template:
      pod:
        affinity {}
        tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-connect-resources-str"><a class="link" href="#proc-upgrade-kafka-connect-resources-str">13.2. Upgrading Kafka Connect resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Cluster Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>KafkaConnect</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>KafkaConnect</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafkaconnect <em>my-connect</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnect.spec.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnect.spec.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnect.spec.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnect.spec.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  affinity {}
  tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  template:
    pod:
      affinity {}
      tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-connect-s2i-resources-str"><a class="link" href="#proc-upgrade-kafka-connect-s2i-resources-str">13.3. Upgrading Kafka Connect S2I resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Cluster Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>KafkaConnectS2I</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>KafkaConnectS2I</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafkaconnects2i <em>my-connect</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectS2I.spec.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectS2I.spec.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectS2I.spec.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectS2I.spec.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  affinity {}
  tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  template:
    pod:
      affinity {}
      tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-mirror-maker-resources-str"><a class="link" href="#proc-upgrade-kafka-mirror-maker-resources-str">13.4. Upgrading Kafka Mirror Maker resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Cluster Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>KafkaMirrorMaker</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>KafkaMirrorMaker</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafkamirrormaker <em>my-connect</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>If present, move:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectMirrorMaker.spec.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectMirrorMaker.spec.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectMirrorMaker.spec.template.pod.affinity</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">KafkaConnectMirrorMaker.spec.template.pod.tolerations</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, move:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  affinity {}
  tolerations {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  template:
    pod:
      affinity {}
      tolerations {}</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-topic-resources-str"><a class="link" href="#proc-upgrade-kafka-topic-resources-str">13.5. Upgrading Kafka Topic resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Topic Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>KafkaTopic</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>KafkaTopic</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafkatopic <em>my-topic</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-upgrade-kafka-user-resources-str"><a class="link" href="#proc-upgrade-kafka-user-resources-str">13.6. Upgrading Kafka User resources</a></h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A User Operator supporting the <code>v1beta1</code> API version is up and running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Execute the following steps for each <code>KafkaUser</code> resource in your deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>KafkaUser</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafkauser <em>my-user</em></code></pre>
</div>
</div>
</li>
<li>
<p>Replace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1alpha1</code></pre>
</div>
</div>
<div class="paragraph">
<p>with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion:kafka.strimzi.io/v1beta1</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file, exit the editor and wait for the updated resource to be reconciled.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uninstalling-str"><a class="link" href="#uninstalling-str">14. Uninstalling Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to uninstall Strimzi and remove resources related to the deployment.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>In order to perform this procedure, identify resources created specifically for a deployment and referenced from the Strimzi resource.</p>
</div>
<div class="paragraph">
<p>Such resources include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secrets (Custom CAs and certificates, Kafka Connect secrets, and other Kafka secrets)</p>
</li>
<li>
<p>Logging <code>ConfigMaps</code> (of type <code>external</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are resources referenced by <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete the Cluster Operator <code>Deployment</code>, related <code>CustomResourceDefinitions</code>, and <code>RBAC</code> resources:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl delete -f install/cluster-operator</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting <code>CustomResourceDefinitions</code> results in the garbage collection of the corresponding custom resources (<code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code>) and the resources dependent on them (Deployments, StatefulSets, and other dependent resources).
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Delete the resources you identified in the prerequisites.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proc-accessing-resource-status-str"><a class="link" href="#proc-accessing-resource-status-str">15. Checking the status of a custom resource</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This procedure describes how to find the status of a custom resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify the custom resource and use the <code>-o jsonpath</code> option to apply a standard JSONPath expression to select the <code>status</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>&lt;kafka_resource_name&gt;</em> -o jsonpath='{.status}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This expression returns all the status information for the specified custom resource. You can use dot notation, such as <code>status.listeners</code> or <code>status.observedGeneration</code>, to fine-tune the status information you wish to see.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-custom-resources-status-str">Strimzi custom resource status</a></p>
</li>
<li>
<p>For more information about using JSONPath, see <a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener">JSONPath support</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ref-kafka-logging-str"><a class="link" href="#ref-kafka-logging-str">Appendix A: Configurable loggers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Logging allows you to diagnose error and performance issues for Strimzi.</p>
</div>
<div class="paragraph">
<p>The following logger implementations are used in Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j</code> logger for Kafka and Zookeeper</p>
</li>
<li>
<p><code>log4j2</code> logger for Topic Operator, User Operator, and other components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi components have their own configurable loggers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ref-loggers-Kafka-deployment-configuration-kafka">Kafka loggers</a></p>
</li>
<li>
<p><a href="#ref-loggers-KafkaConnect-deployment-configuration-kafka-connect">Kafka Connect loggers</a></p>
</li>
<li>
<p><a href="#ref-loggers-KafkaConnectS2I-deployment-configuration-kafka-connect-s2i">Kafka Connect with Source2Image loggers</a></p>
</li>
<li>
<p><a href="#con-kafka-mirror-maker-logging-deployment-configuration-kafka-mirror-maker">Kafka Mirror Maker loggers</a></p>
</li>
<li>
<p><a href="#topic-operator-deployment-configuration-kafka">Topic Operator loggers</a></p>
</li>
<li>
<p><a href="#user-operator-deployment-configuration-kafka">User Operator loggers</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frequently_asked_questions"><a class="link" href="#frequently_asked_questions">Appendix B: Frequently Asked Questions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cluster_operator"><a class="link" href="#cluster_operator">B.1. Cluster Operator</a></h3>
<div class="sect3">
<h4 id="why_do_i_need_cluster_admin_privileges_to_install_strimzi"><a class="link" href="#why_do_i_need_cluster_admin_privileges_to_install_strimzi">B.1.1. Why do I need cluster admin privileges to install Strimzi?</a></h4>
<div class="paragraph">
<p>To install Strimzi, you must have the ability to create Custom Resource Definitions (CRDs).
CRDs instruct Kubernetes about resources that are specific to Strimzi, such as Kafka, KafkaConnect, and so on.
Because CRDs are a cluster-scoped resource rather than being scoped to a particular Kubernetes namespace, they typically require cluster admin privileges to install.</p>
</div>
<div class="paragraph">
<p>In addition, you must also have the ability to create ClusterRoles and ClusterRoleBindings. Like CRDs, these are cluster-scoped resources that typically require cluster admin privileges.</p>
</div>
<div class="paragraph">
<p>The cluster administrator can inspect all the resources being installed (in the <code>/install/</code> directory) to assure themselves that the <code>ClusterRoles</code> do not grant unnecessary privileges. For more information about why the Cluster Operator installation resources grant the ability to create <code>ClusterRoleBindings</code> see the following question.</p>
</div>
<div class="paragraph">
<p>After installation, the Cluster Operator will run as a regular <code>Deployment</code>; any non-admin user with privileges to access the <code>Deployment</code> can configure it.</p>
</div>
<div id="normal-user-access-custom-resources-str" class="paragraph">
<p>By default, normal users will not have the privileges necessary to manipulate the custom resources, such as <code>Kafka</code>, <code>KafkaConnect</code> and so on, which the Cluster Operator deals with.
These privileges can be granted using normal RBAC resources by the cluster administrator. See <a href="#assembly-getting-started-strimzi-admin-str">this procedure</a> for more details of how to do this.</p>
</div>
</div>
<div class="sect3">
<h4 id="why_does_the_cluster_operator_require_the_ability_to_create_clusterrolebindings_is_that_not_a_security_risk"><a class="link" href="#why_does_the_cluster_operator_require_the_ability_to_create_clusterrolebindings_is_that_not_a_security_risk">B.1.2. Why does the Cluster Operator require the ability to create <code>ClusterRoleBindings</code>? Is that not a security risk?</a></h4>
<div class="paragraph">
<p>Kubernetes has built-in <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping" target="_blank" rel="noopener">privilege escalation prevention</a>.
That means that the Cluster Operator cannot grant privileges it does not have itself.
Which in turn means that the Cluster Operator needs to have the privileges necessary for <em>all</em> the components it orchestrates.</p>
</div>
<div class="paragraph">
<p>In the context of this question there are two places where the Cluster Operator needs to create bindings to <code>ClusterRoleBindings</code> to <code>ServiceAccounts</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Topic Operator and User Operator need to be able to manipulate <code>KafkaTopics</code> and <code>KafkaUsers</code>, respectively.
The Cluster Operator therefore needs to be able to grant them this access, which it does by creating a <code>Role</code> and <code>RoleBinding</code>.
For this reason the Cluster Operator itself needs to be able to create <code>Roles</code> and <code>RoleBindings</code> in the namespace that those operators will run in.
However, because of the privilege escalation prevention, the Cluster Operator cannot grant privileges it does not have itself (in particular it cannot grant such privileges in namespace it cannot access).</p>
</li>
<li>
<p>When using rack-aware partition assignment, Strimzi needs to be able to discover the failure domain (for example, the Availability Zone in AWS) of the node on which a broker pod is assigned.
To do this the broker pod needs to be able to get information about the <code>Node</code> it is running on.
A <code>Node</code> is a cluster-scoped resource, so access to it can only be granted via a <code>ClusterRoleBinding</code> (not a namespace-scoped <code>RoleBinding</code>).
Therefore the Cluster Operator needs to be able to create <code>ClusterRoleBindings</code>.
But again, because of privilege escalation prevention, the Cluster Operator cannot grant privileges it does not have itself (so it cannot, for example, create a <code>ClusterRoleBinding</code> to a <code>ClusterRole</code> to grant privileges that the Cluster Operator does not not already have).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="why_can_standard_kubernetes_users_not_create_the_custom_resource_kafka_kafkatopic_and_so_on"><a class="link" href="#why_can_standard_kubernetes_users_not_create_the_custom_resource_kafka_kafkatopic_and_so_on">B.1.3. Why can standard Kubernetes users not create the custom resource (<code>Kafka</code>, <code>KafkaTopic</code>, and so on)?</a></h4>
<div class="paragraph">
<p>Because, when they installed Strimzi, the Kubernetes cluster administrator did not grant the necessary privileges to standard users.</p>
</div>
<div class="paragraph">
<p>See <a href="#normal-user-access-custom-resources-str">this FAQ answer</a> for more details.</p>
</div>
</div>
<div class="sect3">
<h4 id="log_contains_warnings_about_failing_to_acquire_lock"><a class="link" href="#log_contains_warnings_about_failing_to_acquire_lock">B.1.4. Log contains warnings about failing to acquire lock</a></h4>
<div class="paragraph">
<p>For each cluster, the Cluster Operator always executes only one operation at a time. The Cluster Operator uses locks
to make sure that there are never two parallel operations running for the same cluster. In case an operation requires
more time to complete, other operations will wait until it is completed and the lock is released.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">INFO</dt>
<dd>
<p>Examples of cluster operations are <em>cluster creation</em>, <em>rolling update</em>, <em>scale down</em> or <em>scale up</em> and so on.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If the wait for the lock takes too long, the operation times out and the following warning message will be printed to
the log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">2018-03-04 17:09:24 WARNING AbstractClusterOperations:290 - Failed to acquire lock for kafka cluster lock::kafka::myproject::my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the exact configuration of <code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code> and <code>STRIMZI_OPERATION_TIMEOUT_MS</code>, this
warning message may appear regularly without indicating any problems. The operations which time out will be picked up by
the next periodic reconciliation. It will try to acquire the lock again and execute.</p>
</div>
<div class="paragraph">
<p>Should this message appear periodically even in situations when there should be no other operations running for a given
cluster, it might indicate that due to some error the lock was not properly released. In such cases it is recommended to
restart the Cluster Operator.</p>
</div>
</div>
<div class="sect3">
<h4 id="hostname_verification_fails_when_connecting_to_nodeports_using_tls"><a class="link" href="#hostname_verification_fails_when_connecting_to_nodeports_using_tls">B.1.5. Hostname verification fails when connecting to NodePorts using TLS</a></h4>
<div class="paragraph">
<p>Currently, off-cluster access using NodePorts with TLS encryption enabled does not support TLS hostname verification.
As a result, the clients that verify the hostname will fail to connect.
For example, the Java client will fail with the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Caused by: java.security.cert.CertificateException: No subject alternative names matching IP address 168.72.15.231 found
    at sun.security.util.HostnameChecker.matchIP(HostnameChecker.java:168)
    at sun.security.util.HostnameChecker.match(HostnameChecker.java:94)
    at sun.security.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:455)
    at sun.security.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:436)
    at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:252)
    at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:136)
    at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1501)
    ... 17 more</code></pre>
</div>
</div>
<div class="paragraph">
<p>To connect, you must disable hostname verification.
In the Java client, you can do this by setting the configuration option <code>ssl.endpoint.identification.algorithm</code> to an empty string.</p>
</div>
<div class="paragraph">
<p>When configuring the client using a properties file, you can do it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">ssl.endpoint.identification.algorithm=</code></pre>
</div>
</div>
<div class="paragraph">
<p>When configuring the client directly in Java, set the configuration option to an empty string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">props.put("ssl.endpoint.identification.algorithm", "");</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing_kubernetes_cluster"><a class="link" href="#installing_kubernetes_cluster">Appendix C: Installing a Kubernetes cluster</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to get started with Kubernetes is using <code>Minikube</code>.
This section provides basic guidance on how to use it.
For more information on the tools, refer to the documentation available online.</p>
</div>
<div class="paragraph">
<p>In order to interact with a Kubernetes cluster the <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/"><code>kubectl</code></a>
utility needs to be installed.</p>
</div>
<div class="paragraph">
<p>The easiest way to get a running Kubernetes cluster is using <code>Minikube</code>.
<code>Minikube</code> can be downloaded and installed from the <a href="https://kubernetes.io/docs/getting-started-guides/minikube/">Kubernetes website</a>.
Depending on the number of brokers you want to deploy inside the cluster and if you need Kafka Connect running as well, it could be worth running <code>Minikube</code> at least with 4 GB of RAM instead of the default 2 GB.
Once installed, it can be started using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">minikube start --memory 4096</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing_openshift_cluster"><a class="link" href="#installing_openshift_cluster">Appendix D: Installing an OpenShift cluster</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The easiest way to get started with OpenShift is using <code>minishift</code> or <code>oc cluster up</code>.</p>
</div>
<div class="paragraph">
<p>This section provides basic guidance on how to use them.</p>
</div>
<div class="paragraph">
<p>For more information on the tools, refer to the documentation available online.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/openshift/origin/releases"><code>oc</code></a> utility is one of the main tools for interacting with OpenShift.
It provides a simple way of starting a local cluster using the command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc cluster up</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command requires Docker to be installed. More information about this way can be found
<a href="https://github.com/openshift/origin/blob/master/docs/cluster_up_down.md">here</a>.</p>
</div>
<div class="paragraph">
<p>Another option is to use <code>minishift</code>. <code>minishift</code> is an OpenShift installation within a VM. It can be downloaded and
installed from the <a href="https://docs.openshift.org/latest/minishift/index.html">Minishift website</a>. Depending on the number of brokers
you want to deploy inside the cluster and if you need Kafka Connect running as well, it could be worth running <code>minishift</code>
at least with 4 GB of RAM instead of the default 2 GB.
Once installed, <code>minishift</code> can be started using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">minishift start --memory 4GB</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use <code>kubectl</code> with either an <code>oc cluster up</code> or <code>minishift</code> cluster you will need to <a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/">configure it</a>, as unlike with <code>minikube</code> this won&#8217;t be done automatically.</p>
</div>
<div class="sect2">
<h3 id="oc_and_kubectl"><a class="link" href="#oc_and_kubectl">D.1. <code>oc</code> and <code>kubectl</code></a></h3>
<div class="paragraph">
<p>The <code>oc</code> command also functions as an alternative to <code>kubectl</code>.
In almost all cases the example <code>kubectl</code> commands given in this guide can be done using <code>oc</code> simply by replacing the command name (options and arguments remain the same).
In other words instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>when using OpenShift you could alternatively use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">oc apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As an exception to this general rule, the <code>oc</code> tool makes "cluster management" subcommands of <code>oc adm</code>, while <code>kubectl</code> does not make such a distinction.
For example, the <code>oc</code> equivalent of <code>kubectl taint</code> is <code>oc adm taint</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api_reference-str"><a class="link" href="#api_reference-str">Appendix E: Custom Resource API Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="type-Kafka-reference"><a class="link" href="#type-Kafka-reference">E.1. <code>Kafka</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka and Zookeeper clusters, and Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka and Zookeeper clusters, and Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaSpec-reference"><a class="link" href="#type-KafkaSpec-reference">E.2. <code>KafkaSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeper</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Zookeeper cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>topicOperator</code> has been deprecated. This feature should now be configured at path <code>spec.entityOerator.topicOperator</code>.</strong> Configuration of the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entityOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Entity Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the cluster certificate authority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientsCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the clients certificate authority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaExporter</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Kafka Exporter. Kafka Exporter can provide additional metrics, for example lag of consumer group at topic/partition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maintenanceTimeWindows</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of time windows for maintenance tasks (that is, certificates renewal). Each time window is defined by a cron expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClusterSpec-reference"><a class="link" href="#type-KafkaClusterSpec-reference">E.3. <code>KafkaClusterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods. The default value depends on the configured <code>Kafka.spec.kafka.version</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim, jbod].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>, <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures listeners of Kafka brokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization configuration for Kafka brokers. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The kafka broker config. Properties with the following prefixes cannot be set: listeners, advertised., broker., listener., host.name, port, inter.broker.listener.name, sasl., ssl., security., password., principal.builder.class, log.dir, zookeeper.connect, zookeeper.set.acl, authorizer., super.user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the <code>broker.rack</code> broker config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image of the init container used for initializing the <code>broker.rack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.kafka.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.kafka.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka cluster resources. The template allows users to specify how are the <code>StatefulSet</code>, <code>Pods</code> and <code>Services</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The kafka broker version. Defaults to 2.3.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EphemeralStorage-reference"><a class="link" href="#type-EphemeralStorage-reference">E.4. <code>EphemeralStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>EphemeralStorage</code> from <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>ephemeral</code> for the type <code>EphemeralStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLimit</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When type=ephemeral, defines the total amount of local storage required for this EmptyDir volume (for example 1Gi).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>ephemeral</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PersistentClaimStorage-reference"><a class="link" href="#type-PersistentClaimStorage-reference">E.5. <code>PersistentClaimStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>PersistentClaimStorage</code> from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>.
It must have the value <code>persistent-claim</code> for the type <code>PersistentClaimStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>persistent-claim</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When type=persistent-claim, defines the size of the persistent volume claim (i.e 1Gi). Mandatory when type=persistent-claim.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies a specific persistent volume to use. It contains key:value pairs representing labels for selecting such a volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies if the persistent volume claim has to be deleted when the cluster is un-deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The storage class to use for dynamic volume allocation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for individual brokers. The <code>overrides</code> field allows to specify a different configuration for different brokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PersistentClaimStorageOverride-reference"><code>PersistentClaimStorageOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PersistentClaimStorageOverride-reference"><a class="link" href="#type-PersistentClaimStorageOverride-reference">E.6. <code>PersistentClaimStorageOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The storage class to use for dynamic volume allocation for this broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JbodStorage-reference"><a class="link" href="#type-JbodStorage-reference">E.7. <code>JbodStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>JbodStorage</code> from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>jbod</code> for the type <code>JbodStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>jbod</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of volumes as Storage objects representing the JBOD disks array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListeners-reference"><a class="link" href="#type-KafkaListeners-reference">E.8. <code>KafkaListeners</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plain</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures plain listener on port 9092.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures TLS listener on port 9093.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures external listener on port 9094. The type depends on the value of the <code>external.type</code> property within the given object, which must be one of [route, loadbalancer, nodeport, ingress].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerPlain-reference"><a class="link" href="#type-KafkaListenerPlain-reference">E.9. <code>KafkaListenerPlain</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for this listener. Since this listener does not use TLS transport you cannot configure an authentication with <code>type: tls</code>. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationTls-reference"><a class="link" href="#type-KafkaListenerAuthenticationTls-reference">E.10. <code>KafkaListenerAuthenticationTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationTls</code> from <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaListenerAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaListenerAuthenticationScramSha512-reference">E.11. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationScramSha512</code> from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaListenerAuthenticationScramSha512</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationOAuth-reference"><a class="link" href="#type-KafkaListenerAuthenticationOAuth-reference">E.12. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationOAuth</code> from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaListenerAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth Client ID which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the OAuth client secret which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable TLS hostname verification. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">introspectionEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the token introspection endpoint which can be used to validate opaque non-JWT tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the JWKS certificate endpoint, which can be used for local JWT validation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksExpirySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures how often are the JWKS certificates considered valid. The expiry interval has to be at least 60 seconds longer then the refresh interval specified in <code>jwksRefreshSeconds</code>. Defaults to 360 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksRefreshSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures how often are the JWKS certificates refreshed. The refresh interval has to be at least 60 seconds shorter then the expiry interval specified in <code>jwksExpirySeconds</code>. Defaults to 300 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection to the OAuth server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>oauth</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userNameClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the claim from the authentication token which will be used as the user principal. Defaults to <code>sub</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validIssuerUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the token issuer used for authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-GenericSecretSource-reference"><a class="link" href="#type-GenericSecretSource-reference">E.13. <code>GenericSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The key under which the secret value is stored in the Kubernetes Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Kubernetes Secret containing the secret value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CertSecretSource-reference"><a class="link" href="#type-CertSecretSource-reference">E.14. <code>CertSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeTls-reference"><code>KafkaBridgeTls</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>, <a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the file certificate in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerTls-reference"><a class="link" href="#type-KafkaListenerTls-reference">E.15. <code>KafkaListenerTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for this listener. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalRoute-reference"><a class="link" href="#type-KafkaListenerExternalRoute-reference">E.16. <code>KafkaListenerExternalRoute</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalRoute</code> from <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>route</code> for the type <code>KafkaListenerExternalRoute</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>route</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerOverride-reference"><a class="link" href="#type-RouteListenerOverride-reference">E.17. <code>RouteListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerBootstrapOverride-reference"><code>RouteListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerBrokerOverride-reference"><code>RouteListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerBootstrapOverride-reference"><a class="link" href="#type-RouteListenerBootstrapOverride-reference">E.18. <code>RouteListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the bootstrap route. This field will be used in the <code>spec.host</code> field of the OpenShift Route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerBrokerOverride-reference"><a class="link" href="#type-RouteListenerBrokerOverride-reference">E.19. <code>RouteListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the broker route. This field will be used in the <code>spec.host</code> field of the OpenShift Route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalLoadBalancer-reference"><a class="link" href="#type-KafkaListenerExternalLoadBalancer-reference">E.20. <code>KafkaListenerExternalLoadBalancer</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalLoadBalancer</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>loadbalancer</code> for the type <code>KafkaListenerExternalLoadBalancer</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>loadbalancer</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enables TLS encryption on the listener. By default set to <code>true</code> for enabled TLS encryption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerOverride-reference"><a class="link" href="#type-LoadBalancerListenerOverride-reference">E.21. <code>LoadBalancerListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerBootstrapOverride-reference"><code>LoadBalancerListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerBrokerOverride-reference"><code>LoadBalancerListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerBootstrapOverride-reference"><a class="link" href="#type-LoadBalancerListenerBootstrapOverride-reference">E.22. <code>LoadBalancerListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerBrokerOverride-reference"><a class="link" href="#type-LoadBalancerListenerBrokerOverride-reference">E.23. <code>LoadBalancerListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalNodePort-reference"><a class="link" href="#type-KafkaListenerExternalNodePort-reference">E.24. <code>KafkaListenerExternalNodePort</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalNodePort</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>nodeport</code> for the type <code>KafkaListenerExternalNodePort</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>nodeport</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enables TLS encryption on the listener. By default set to <code>true</code> for enabled TLS encryption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerOverride-reference"><a class="link" href="#type-NodePortListenerOverride-reference">E.25. <code>NodePortListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerBootstrapOverride-reference"><code>NodePortListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerBrokerOverride-reference"><code>NodePortListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerBootstrapOverride-reference"><a class="link" href="#type-NodePortListenerBootstrapOverride-reference">E.26. <code>NodePortListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerBrokerOverride-reference"><a class="link" href="#type-NodePortListenerBrokerOverride-reference">E.27. <code>NodePortListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the broker service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalIngress-reference"><a class="link" href="#type-KafkaListenerExternalIngress-reference">E.28. <code>KafkaListenerExternalIngress</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalIngress</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>.
It must have the value <code>ingress</code> for the type <code>KafkaListenerExternalIngress</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>ingress</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures the <code>Ingress</code> class that defines which <code>Ingress</code> controller will be used. If not set, the <code>Ingress</code> class is set to <code>nginx</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerConfiguration-reference"><a class="link" href="#type-IngressListenerConfiguration-reference">E.29. <code>IngressListenerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap ingress configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerBootstrapConfiguration-reference"><code>IngressListenerBootstrapConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker ingress configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerBrokerConfiguration-reference"><code>IngressListenerBrokerConfiguration</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerBootstrapConfiguration-reference"><a class="link" href="#type-IngressListenerBootstrapConfiguration-reference">E.30. <code>IngressListenerBootstrapConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the bootstrap route. This field will be used in the Ingress resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerBrokerConfiguration-reference"><a class="link" href="#type-IngressListenerBrokerConfiguration-reference">E.31. <code>IngressListenerBrokerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the broker ingress. This field will be used in the Ingress resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaAuthorizationSimple-reference"><a class="link" href="#type-KafkaAuthorizationSimple-reference">E.32. <code>KafkaAuthorizationSimple</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaAuthorizationSimple</code> from other subtypes which may be added in the future.
It must have the value <code>simple</code> for the type <code>KafkaAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>simple</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of super users. Should contain list of user principals which should get unlimited access rights.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Rack-reference"><a class="link" href="#type-Rack-reference">E.33. <code>Rack</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topologyKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A key that matches labels assigned to the Kubernetes cluster nodes. The value of the label is used to set the broker&#8217;s <code>broker.rack</code> config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Probe-reference"><a class="link" href="#type-Probe-reference">E.34. <code>Probe</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Minimum consecutive failures for the probe to be considered failed after having succeeded. Defaults to 3. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialDelaySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The initial delay before first the health is first checked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">periodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The timeout for each attempted health check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JvmOptions-reference"><a class="link" href="#type-JvmOptions-reference">E.35. <code>JvmOptions</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A map of -XX options to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xms</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">-Xms option to to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xmx</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">-Xmx option to to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcLoggingEnabled</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies whether the Garbage Collection logging is enabled. The default is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ResourceRequirements-reference"><a class="link" href="#type-ResourceRequirements-reference">E.36. <code>ResourceRequirements</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">limits</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-InlineLogging-reference"><a class="link" href="#type-InlineLogging-reference">E.37. <code>InlineLogging</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>InlineLogging</code> from <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a>.
It must have the value <code>inline</code> for the type <code>InlineLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>inline</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A Map from logger name to logger level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalLogging-reference"><a class="link" href="#type-ExternalLogging-reference">E.38. <code>ExternalLogging</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>ExternalLogging</code> from <a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>.
It must have the value <code>external</code> for the type <code>ExternalLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>external</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the <code>ConfigMap</code> from which to get the logging configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-TlsSidecar-reference"><a class="link" href="#type-TlsSidecar-reference">E.39. <code>TlsSidecar</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logLevel</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The log level for the TLS sidecar. Default value is <code>notice</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [emerg, debug, crit, err, alert, warning, notice, info])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClusterTemplate-reference"><a class="link" href="#type-KafkaClusterTemplate-reference">E.40. <code>KafkaClusterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>StatefulSet</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka bootstrap <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokersService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka broker <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Services</code> used for access from outside of Kubernetes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Route</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Routes</code> used for access from outside of OpenShift.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Ingress</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Ingress</code> used for access from outside of Kubernetes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for all Kafka <code>PersistentVolumeClaims</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka broker container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka broker TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka init container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ResourceTemplate-reference"><a class="link" href="#type-ResourceTemplate-reference">E.41. <code>ResourceTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata which should be applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-MetadataTemplate-reference"><a class="link" href="#type-MetadataTemplate-reference">E.42. <code>MetadataTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a>, <a href="#type-PodTemplate-reference"><code>PodTemplate</code></a>, <a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Labels which should be added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations which should be added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PodTemplate-reference"><a class="link" href="#type-PodTemplate-reference">E.43. <code>PodTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullSecrets</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of references to secrets in the same namespace to use for pulling any of the images used by this Pod. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#localobjectreference-v1-core">core/v1 localobjectreference</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#localobjectreference-v1-core">LocalObjectReference</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityContext</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures pod-level security attributes and common container settings. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#podsecuritycontext-v1-core">core/v1 podsecuritycontext</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#podsecuritycontext-v1-core">PodSecurityContext</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminationGracePeriodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The grace period is the duration in seconds after the processes running in the pod are sent a termination signal and the time when the processes are forcibly halted with a kill signal. Set this value longer than the expected cleanup time for your process.Value must be non-negative integer. The value zero indicates delete immediately. Defaults to 30 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priorityClassName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Priority Class to which these pods will be assigned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PodDisruptionBudgetTemplate-reference"><a class="link" href="#type-PodDisruptionBudgetTemplate-reference">E.44. <code>PodDisruptionBudgetTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata to apply to the <code>PodDistruptionBugetTemplate</code> resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxUnavailable</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Maximum number of unavailable pods to allow automatic Pod eviction. A Pod eviction is allowed when the <code>maxUnavailable</code> number of pods or fewer are unavailable after the eviction. Setting this value to 0 prevents all voluntary evictions, so the pods must be evicted manually. Defaults to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ContainerTemplate-reference"><a class="link" href="#type-ContainerTemplate-reference">E.45. <code>ContainerTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Environment variables which should be applied to the container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerEnvVar-reference"><code>ContainerEnvVar</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ContainerEnvVar-reference"><a class="link" href="#type-ContainerEnvVar-reference">E.46. <code>ContainerEnvVar</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The environment variable key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The environment variable value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ZookeeperClusterSpec-reference"><a class="link" href="#type-ZookeeperClusterSpec-reference">E.47. <code>ZookeeperClusterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The zookeeper broker config. Properties with the following prefixes cannot be set: server., dataDir, dataLogDir, clientPort, authProvider, quorum.auth, requireClientAuthScheme.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.zookeeper.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.zookeeper.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Zookeeper. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper cluster resources. The template allows users to specify how are the <code>StatefulSet</code>, <code>Pods</code> and <code>Services</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ZookeeperClusterTemplate-reference"><a class="link" href="#type-ZookeeperClusterTemplate-reference">E.48. <code>ZookeeperClusterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper <code>StatefulSet</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper client <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodesService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper nodes <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for all Zookeeper <code>PersistentVolumeClaims</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Zookeeper <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Zookeeper container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka broker TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-TopicOperatorSpec-reference"><a class="link" href="#type-TopicOperatorSpec-reference">E.49. <code>TopicOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the Topic Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the Zookeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicMetadataMaxAttempts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of attempts at getting topic metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorJvmOptions-reference"><code>EntityOperatorJvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityOperatorJvmOptions-reference"><a class="link" href="#type-EntityOperatorJvmOptions-reference">E.50. <code>EntityOperatorJvmOptions</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcLoggingEnabled</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies whether the Garbage Collection logging is enabled. The default is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityOperatorSpec-reference"><a class="link" href="#type-EntityOperatorSpec-reference">E.51. <code>EntityOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the User Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator resources. The template allows users to specify how is the <code>Deployment</code> and <code>Pods</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityTopicOperatorSpec-reference"><a class="link" href="#type-EntityTopicOperatorSpec-reference">E.52. <code>EntityTopicOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the Topic Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the Zookeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicMetadataMaxAttempts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of attempts at getting topic metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorJvmOptions-reference"><code>EntityOperatorJvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityUserOperatorSpec-reference"><a class="link" href="#type-EntityUserOperatorSpec-reference">E.53. <code>EntityUserOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the User Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the User Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the Zookeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorJvmOptions-reference"><code>EntityOperatorJvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityOperatorTemplate-reference"><a class="link" href="#type-EntityOperatorTemplate-reference">E.54. <code>EntityOperatorTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity Operator TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity Topic Operator container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity User Operator container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CertificateAuthority-reference"><a class="link" href="#type-CertificateAuthority-reference">E.55. <code>CertificateAuthority</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configuration of how TLS certificates are used within the cluster. This applies to certificates used for both internal communication within the cluster and to certificates used for client access via <code>Kafka.spec.kafka.listeners.tls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generateCertificateAuthority</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">If true then Certificate Authority certificates will be generated automatically. Otherwise the user will need to provide a Secret with the CA certificate. Default is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validityDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of days generated certificates should be valid for. The default is 365.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">renewalDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of days in the certificate renewal period. This is the number of days before the a certificate expires during which renewal actions may be performed. When <code>generateCertificateAuthority</code> is true, this will cause the generation of a new certificate. When <code>generateCertificateAuthority</code> is true, this will cause extra logging at WARN level about the pending certificate expiry. Default is 30.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateExpirationPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">How should CA certificate expiration be handled when <code>generateCertificateAuthority=true</code>. The default is for a new CA certificate to be generated reusing the existing private key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [replace-key, renew-certificate])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaExporterSpec-reference"><a class="link" href="#type-KafkaExporterSpec-reference">E.56. <code>KafkaExporterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Regular expression to specify which consumer groups to collect. Default value is <code>.*</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Regular expression to specify which topics to collect. Default value is <code>.*</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Only log messages with the given severity or above. Valid levels: [<code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>]. Default log level is <code>info</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableSaramaLogging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable Sarama logging, a Go client library used by the Kafka Exporter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Customization of deployment templates and pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaExporterTemplate-reference"><a class="link" href="#type-KafkaExporterTemplate-reference">E.57. <code>KafkaExporterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Exporter container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaStatus-reference"><a class="link" href="#type-KafkaStatus-reference">E.58. <code>KafkaStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Addresses of the internal and external listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Condition-reference"><a class="link" href="#type-Condition-reference">E.59. <code>Condition</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a>, <a href="#type-KafkaConnectS2Istatus-reference"><code>KafkaConnectS2Istatus</code></a>, <a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a>, <a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a>, <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a>, <a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a>, <a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The unique identifier of a condition, used to distinguish between other conditions in the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the condition, either True, False or Unknown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastTransitionTime</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Last time the condition of a type changed from one status to another. The required format is 'yyyy-MM-ddTHH:mm:ssZ', in the UTC time zone.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reason</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The reason for the condition&#8217;s last transition (a single word in CamelCase).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Human-readable message indicating details about the condition&#8217;s last transition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ListenerStatus-reference"><a class="link" href="#type-ListenerStatus-reference">E.60. <code>ListenerStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The type of the listener. Can be one of the following three types: <code>plain</code>, <code>tls</code>, and <code>external</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addresses</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of the addresses for this listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerAddress-reference"><code>ListenerAddress</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ListenerAddress-reference"><a class="link" href="#type-ListenerAddress-reference">E.61. <code>ListenerAddress</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The DNS name or IP address of Kafka bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port of the Kafka bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnect-reference"><a class="link" href="#type-KafkaConnect-reference">E.62. <code>KafkaConnect</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Connect cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Connect cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectSpec-reference"><a class="link" href="#type-KafkaConnectSpec-reference">E.63. <code>KafkaConnectSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the Kafka Connect group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect and Kafka Connect S2I resources. The template allows users to specify how is the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka Connect. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Bootstrap servers to connect to. This should be given as a comma separated list of <em>&lt;hostname&gt;</em>:<em>&lt;port&gt;</em> pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect configuration. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect version. Defaults to 2.3.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JaegerTracing-reference"><a class="link" href="#type-JaegerTracing-reference">E.64. <code>JaegerTracing</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>JaegerTracing</code> from other subtypes which may be added in the future.
It must have the value <code>jaeger</code> for the type <code>JaegerTracing</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>jaeger</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectTemplate-reference"><a class="link" href="#type-KafkaConnectTemplate-reference">E.65. <code>KafkaConnectTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect API <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Connect container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationTls-reference"><a class="link" href="#type-KafkaClientAuthenticationTls-reference">E.66. <code>KafkaClientAuthenticationTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> property to the value <code>tls</code>.
TLS client authentication uses a TLS certificate to authenticate.
The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from a Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS client authentication can only be used with TLS connections.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example TLS client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: tls
  certificateAndKey:
    secretName: my-secret
    certificate: public.crt
    key: private.key</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationTls</code> from <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaClientAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CertAndKeySecretSource-reference"><a class="link" href="#type-CertAndKeySecretSource-reference">E.67. <code>CertAndKeySecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the file certificate in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the private key in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha512-reference">E.68. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
The SCRAM-SHA-512 authentication mechanism requires a username and password.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.
The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based SCRAM-SHA-512 client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: scram-sha-512
  username: my-connect
  passwordSecret:
    secretName: my-connect
    password: password</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationScramSha512</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaClientAuthenticationScramSha512</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username used for the authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PasswordSecretSource-reference"><a class="link" href="#type-PasswordSecretSource-reference">E.69. <code>PasswordSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the key in the Secret under which the password is stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationPlain-reference"><a class="link" href="#type-KafkaClientAuthenticationPlain-reference">E.70. <code>KafkaClientAuthenticationPlain</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
SASL PLAIN authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Specify the username in the <code>username</code> property.</p>
</li>
<li>
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.
The <code>secretName</code> property contains the name of such a <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> field.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: plain
  username: my-connect
  passwordSecret:
    secretName: my-connect
    password: password</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationPlain</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>plain</code> for the type <code>KafkaClientAuthenticationPlain</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>plain</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username used for the authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationOAuth-reference"><a class="link" href="#type-KafkaClientAuthenticationOAuth-reference">E.71. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To use OAuth client authentication, set the <code>type</code> property to the value <code>oauth</code>.
OAuth authentication can be configured using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID and secret</p>
</li>
<li>
<p>Client ID and refresh token</p>
</li>
<li>
<p>Access token</p>
</li>
<li>
<p>TLS</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Client ID and secret</div>
<p>You can configure the address of your authorization server in the <code>tokenEndpointUri</code> property together with the client ID and client secret used in authentication.
The OAuth client will connect to the OAuth server, authenticate using the client ID and secret and get an access token which it will use to authenticate with the Kafka broker.
In the <code>clientSecret</code> property, specify a link to a <code>Secret</code> containing the client secret.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using client ID and client secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  clientSecret:
    secretName: my-client-oauth-secret
    key: client-secret</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Client ID and refresh token</div>
<p>You can configure the address of your OAuth server in the <code>tokenEndpointUri</code> property together with the OAuth client ID and refresh token.
The OAuth client will connect to the OAuth server, authenticate using the client ID and refresh token and get an access token which it will use to authenticate with the Kafka broker.
In the <code>refreshToken</code> property, specify a link to a <code>Secret</code> containing the refresh token.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using client ID and refresh token</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Access token</div>
<p>You can configure the access token used for authentication with the Kafka broker directly.
In this case, you do not specify the <code>tokenEndpointUri</code>.
In the <code>accessToken</code> property, specify a link to a <code>Secret</code> containing the access token.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using only an access token</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  accessToken:
    secretName: my-access-token-secret
    key: access-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">TLS</div>
<p>Accessing the OAuth server using the HTTPS protocol does not require any additional configuration as long as the TLS certificates used by it are signed by a trusted certification authority and its hostname is listed in the certificate.</p>
</div>
<div class="paragraph">
<p>If your OAuth server is using certificates which are self-signed or are signed by a certification authority which is not trusted, you can configure a list of trusted certificates in the custom resoruce.
The <code>tlsTrustedCertificates</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example of TLS certificates provided</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  tlsTrustedCertificates:
    - secretName: oauth-server-ca
      certificate: tls.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OAuth client will by default verify that the hostname of your OAuth server matches either the certificate subject or one of the alternative DNS names.
If it is not required, you can disable the hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">An example of disabled TLS hostname verification</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  disableTlsHostnameVerification: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationOAuth</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaClientAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the access token which was obtained from the authorization server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth Client ID which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the OAuth client secret which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable TLS hostname verification. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">refreshToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the refresh token which can be used to obtain access token from the authorization server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection to the OAuth server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization server token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>oauth</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfiguration-reference"><a class="link" href="#type-ExternalConfiguration-reference">E.72. <code>ExternalConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Allows to pass data from Secret or ConfigMap to the Kafka Connect pods as environment variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Allows to pass data from Secret or ConfigMap to the Kafka Connect pods as volumes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationVolumeSource-reference"><code>ExternalConfigurationVolumeSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationEnv-reference"><a class="link" href="#type-ExternalConfigurationEnv-reference">E.73. <code>ExternalConfigurationEnv</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the environment variable which will be passed to the Kafka Connect pods. The name of the environment variable cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Value of the environment variable which will be passed to the Kafka Connect pods. It can be passed either as a reference to Secret or ConfigMap field. The field has to specify exactly one Secret or ConfigMap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnvVarSource-reference"><code>ExternalConfigurationEnvVarSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationEnvVarSource-reference"><a class="link" href="#type-ExternalConfigurationEnvVarSource-reference">E.74. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMapKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Refernce to a key in a ConfigMap. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#configmapkeyselector-v1-core">core/v1 configmapkeyselector</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#configmapkeyselector-v1-core">ConfigMapKeySelector</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a Secret. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#secretkeyselector-v1-core">core/v1 secretkeyselector</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#secretkeyselector-v1-core">SecretKeySelector</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationVolumeSource-reference"><a class="link" href="#type-ExternalConfigurationVolumeSource-reference">E.75. <code>ExternalConfigurationVolumeSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a ConfigMap. Exactly one Secret or ConfigMap has to be specified. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#configmapvolumesource-v1-core">core/v1 configmapvolumesource</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#configmapvolumesource-v1-core">ConfigMapVolumeSource</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the volume which will be added to the Kafka Connect pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a Secret. Exactly one Secret or ConfigMap has to be specified. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#secretvolumesource-v1-core">core/v1 secretvolumesource</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#secretvolumesource-v1-core">SecretVolumeSource</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectTls-reference"><a class="link" href="#type-KafkaConnectTls-reference">E.76. <code>KafkaConnectTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectStatus-reference"><a class="link" href="#type-KafkaConnectStatus-reference">E.77. <code>KafkaConnectStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2I-reference"><a class="link" href="#type-KafkaConnectS2I-reference">E.78. <code>KafkaConnectS2I</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Connect Source-to-Image (S2I) cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Connect Source-to-Image (S2I) cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2Istatus-reference"><code>KafkaConnectS2Istatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2ISpec-reference"><a class="link" href="#type-KafkaConnectS2ISpec-reference">E.79. <code>KafkaConnectS2ISpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the Kafka Connect group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect and Kafka Connect S2I resources. The template allows users to specify how is the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka Connect. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Bootstrap servers to connect to. This should be given as a comma separated list of <em>&lt;hostname&gt;</em>:<em>&lt;port&gt;</em> pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect configuration. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecureSourceRepository</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When true this configures the source repository with the 'Local' reference policy and an import policy that accepts insecure source tags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect version. Defaults to 2.3.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2Istatus-reference"><a class="link" href="#type-KafkaConnectS2Istatus-reference">E.80. <code>KafkaConnectS2Istatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildConfigName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the build configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopic-reference"><a class="link" href="#type-KafkaTopic-reference">E.81. <code>KafkaTopic</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the topic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicSpec-reference"><code>KafkaTopicSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the topic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopicSpec-reference"><a class="link" href="#type-KafkaTopicSpec-reference">E.82. <code>KafkaTopicSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">partitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of partitions the topic should have. This cannot be decreased after topic creation. It can be increased after topic creation, but it is important to understand the consequences that has, especially for topics with semantic partitioning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of replicas the topic should have.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The topic configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the topic. When absent this will default to the metadata.name of the topic. It is recommended to not set this unless the topic name is not a valid Kubernetes resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopicStatus-reference"><a class="link" href="#type-KafkaTopicStatus-reference">E.83. <code>KafkaTopicStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUser-reference"><a class="link" href="#type-KafkaUser-reference">E.84. <code>KafkaUser</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka User.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserSpec-reference"><a class="link" href="#type-KafkaUserSpec-reference">E.85. <code>KafkaUserSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication mechanism enabled for this Kafka user. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>, <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization rules for this Kafka user. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserTlsClientAuthentication-reference"><a class="link" href="#type-KafkaUserTlsClientAuthentication-reference">E.86. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserTlsClientAuthentication</code> from <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaUserTlsClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserScramSha512ClientAuthentication-reference"><a class="link" href="#type-KafkaUserScramSha512ClientAuthentication-reference">E.87. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserScramSha512ClientAuthentication</code> from <a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaUserScramSha512ClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserAuthorizationSimple-reference"><a class="link" href="#type-KafkaUserAuthorizationSimple-reference">E.88. <code>KafkaUserAuthorizationSimple</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserAuthorizationSimple</code> from other subtypes which may be added in the future.
It must have the value <code>simple</code> for the type <code>KafkaUserAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>simple</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of ACL rules which should be applied to this user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRule-reference"><code>AclRule</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRule-reference"><a class="link" href="#type-AclRule-reference">E.89. <code>AclRule</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host from which the action described in the ACL rule is allowed or denied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation which will be allowed or denied. Supported operations are: Read, Write, Create, Delete, Alter, Describe, ClusterAction, AlterConfigs, DescribeConfigs, IdempotentWrite and All.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Read, Write, Delete, Alter, Describe, All, IdempotentWrite, ClusterAction, Create, AlterConfigs, DescribeConfigs])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Indicates the resource for which given ACL rule applies. The type depends on the value of the <code>resource.type</code> property within the given object, which must be one of [topic, group, cluster, transactionalId].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The type of the rule. Currently the only supported type is <code>allow</code>. ACL rules with type <code>allow</code> are used to allow user to execute the specified operations. Default value is <code>allow</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [allow, deny])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleTopicResource-reference"><a class="link" href="#type-AclRuleTopicResource-reference">E.90. <code>AclRuleTopicResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleTopicResource</code> from <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>topic</code> for the type <code>AclRuleTopicResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>topic</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleGroupResource-reference"><a class="link" href="#type-AclRuleGroupResource-reference">E.91. <code>AclRuleGroupResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleGroupResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>group</code> for the type <code>AclRuleGroupResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>group</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleClusterResource-reference"><a class="link" href="#type-AclRuleClusterResource-reference">E.92. <code>AclRuleClusterResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleClusterResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>cluster</code> for the type <code>AclRuleClusterResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>cluster</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleTransactionalIdResource-reference"><a class="link" href="#type-AclRuleTransactionalIdResource-reference">E.93. <code>AclRuleTransactionalIdResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleTransactionalIdResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>.
It must have the value <code>transactionalId</code> for the type <code>AclRuleTransactionalIdResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>transactionalId</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserStatus-reference"><a class="link" href="#type-KafkaUserStatus-reference">E.94. <code>KafkaUserStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of <code>Secret</code> where the credentials are stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker-reference"><a class="link" href="#type-KafkaMirrorMaker-reference">E.95. <code>KafkaMirrorMaker</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of Kafka Mirror Maker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of Kafka Mirror Maker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerSpec-reference">E.96. <code>KafkaMirrorMakerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">whitelist</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of topics which are included for mirroring. This option allows any regular expression using Java-style regular expressions. Mirroring two topics named A and B is achieved by using the whitelist <code>'A|B'</code>. Or, as a special case, you can mirror all topics using the whitelist '*'. You can also specify multiple regular expressions separated by commas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of source cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of target cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.11/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Mirror Maker. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">JMX Exporter documentation</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Mirror Maker. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template to specify how Kafka Mirror Maker resources, <code>Deployments</code> and <code>Pods</code>, are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Mirror Maker version. Defaults to 2.3.0. Consult the documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerConsumerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerConsumerSpec-reference">E.97. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numStreams</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies the number of consumer stream threads to create.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offsetCommitInterval</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies the offset auto-commit interval in ms. Default value is 60000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A unique string that identifies the consumer group this consumer belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Mirror Maker consumer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security., interceptor.classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting Mirror Maker to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerTls-reference"><a class="link" href="#type-KafkaMirrorMakerTls-reference">E.98. <code>KafkaMirrorMakerTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>Use the <code>tls</code> property to configure TLS encryption.
Provide a list of secrets with key names under which the certificates are stored in X.509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example TLS encryption configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">tls:
  trustedCertificates:
    - secretName: my-cluster-cluster-ca-cert
      certificate: ca.crt</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerProducerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerProducerSpec-reference">E.99. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abortOnSendFailure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Flag to set the Mirror Maker to exit on a failed send. Default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Mirror Maker producer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security., interceptor.classes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting Mirror Maker to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerTemplate-reference"><a class="link" href="#type-KafkaMirrorMakerTemplate-reference">E.100. <code>KafkaMirrorMakerTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Mirror Maker <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Mirror Maker <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mirrorMakerContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Mirror Maker container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Mirror Maker <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerStatus-reference"><a class="link" href="#type-KafkaMirrorMakerStatus-reference">E.101. <code>KafkaMirrorMakerStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridge-reference"><a class="link" href="#type-KafkaBridge-reference">E.102. <code>KafkaBridge</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeSpec-reference"><a class="link" href="#type-KafkaBridgeSpec-reference">E.103. <code>KafkaBridgeSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting Kafka Bridge to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeTls-reference"><code>KafkaBridgeTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The HTTP related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeHttpConfig-reference"><code>KafkaBridgeHttpConfig</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka consumer related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeConsumerSpec-reference"><code>KafkaBridgeConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka producer related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeProducerSpec-reference"><code>KafkaBridgeProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceRequirements-reference"><code>ResourceRequirements</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>Currently not supported</strong> JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Bridge. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>Currently not supported</strong> The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">JMX Exporter documentation</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge resources. The template allows users to specify how is the <code>Deployment</code> and <code>Pods</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeTls-reference"><a class="link" href="#type-KafkaBridgeTls-reference">E.104. <code>KafkaBridgeTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeHttpConfig-reference"><a class="link" href="#type-KafkaBridgeHttpConfig-reference">E.105. <code>KafkaBridgeHttpConfig</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port which is the server listening on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeConsumerSpec-reference"><a class="link" href="#type-KafkaBridgeConsumerSpec-reference">E.106. <code>KafkaBridgeConsumerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka consumer configuration used for consumer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeProducerSpec-reference"><a class="link" href="#type-KafkaBridgeProducerSpec-reference">E.107. <code>KafkaBridgeProducerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka producer configuration used for producer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeTemplate-reference"><a class="link" href="#type-KafkaBridgeTemplate-reference">E.108. <code>KafkaBridgeTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge API <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bridgeContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Bridge container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeStatus-reference"><a class="link" href="#type-KafkaBridgeStatus-reference">E.109. <code>KafkaBridgeStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL at which external client applications can access the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
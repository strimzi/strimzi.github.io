<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Configuring Strimzi</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body id="configuring-book_str" class="book toc2 toc-left">
<div id="header">
<h1>Configuring Strimzi</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-str">1. Configuration overview</a>
<ul class="sectlevel2">
<li><a href="#configuration-points-overview-str">1.1. Configuring custom resources</a></li>
<li><a href="#configuration-points-configmaps-str">1.2. Using ConfigMaps to add configuration</a>
<ul class="sectlevel3">
<li><a href="#naming_custom_configmaps">1.2.1. Naming custom ConfigMaps</a></li>
</ul>
</li>
<li><a href="#document-conventions-str">1.3. Document Conventions</a></li>
<li><a href="#additional_resources">1.4. Additional resources</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-str">2. Configuring a Strimzi deployment</a>
<ul class="sectlevel2">
<li><a href="#assembly-config-kafka-str">2.1. Kafka cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#proc-config-kafka-str">2.1.1. Configuring Kafka</a></li>
<li><a href="#assembly-kafka-entity-operator-str">2.1.2. Configuring the Entity Operator</a></li>
<li><a href="#assembly-storage-str">2.1.3. Configuring Kafka and ZooKeeper storage</a></li>
<li><a href="#scaling-clusters-str">2.1.4. Scaling clusters</a></li>
<li><a href="#assembly-jmxtrans-str">2.1.5. Retrieving JMX metrics with JmxTrans</a></li>
<li><a href="#assembly-maintenance-time-windows-str">2.1.6. Maintenance time windows for rolling updates</a></li>
<li><a href="#proc-connnecting-to-zookeeper-str">2.1.7. Connecting to ZooKeeper from a terminal</a></li>
<li><a href="#proc-manual-delete-pod-pvc-kafka-str">2.1.8. Deleting Kafka nodes manually</a></li>
<li><a href="#proc-manual-delete-pod-pvc-zookeeper-str">2.1.9. Deleting ZooKeeper nodes manually</a></li>
<li><a href="#ref-list-of-kafka-cluster-resources-str">2.1.10. List of Kafka cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-kafka-connect-str">2.2. Kafka Connect cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#proc-kafka-connect-config-str">2.2.1. Configuring Kafka Connect</a></li>
<li><a href="#con-kafka-connect-multiple-instances-str">2.2.2. Configuring Kafka Connect for multiple instances</a></li>
<li><a href="#proc-configuring-kafka-connect-user-authorization-str">2.2.3. Configuring Kafka Connect user authorization</a></li>
<li><a href="#ref-list-of-kafka-connect-resources-str">2.2.4. List of Kafka Connect cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-mirrormaker-str">2.3. Kafka MirrorMaker 2.0 cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#con-mirrormaker-str">2.3.1. MirrorMaker 2.0 data replication</a></li>
<li><a href="#con-config-mirrormaker2-connectors-str">2.3.2. Connector configuration</a></li>
<li><a href="#con-mirrormaker-producers-consumers-str">2.3.3. Connector producer and consumer configuration</a></li>
<li><a href="#con-mirrormaker-tasks-max-str">2.3.4. Specifying a maximum number of tasks</a></li>
<li><a href="#con-mirrormaker-acls-str">2.3.5. ACL rules synchronization</a></li>
<li><a href="#proc-mirrormaker-replication-str">2.3.6. Configuring Kafka MirrorMaker 2.0</a></li>
<li><a href="#proc-config-mirrormaker2-securing-connection-str">2.3.7. Securing a Kafka MirrorMaker 2.0 deployment</a></li>
<li><a href="#proc-manual-restart-mirrormaker2-connector-str">2.3.8. Performing a restart of a Kafka MirrorMaker 2.0 connector</a></li>
<li><a href="#proc-manual-restart-mirrormaker2-connector-task-str">2.3.9. Performing a restart of a Kafka MirrorMaker 2.0 connector task</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-mirror-maker-str">2.4. Kafka MirrorMaker cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#configuring-kafka-mirror-maker-str">2.4.1. Configuring Kafka MirrorMaker</a></li>
<li><a href="#ref-list-of-kafka-mirror-maker-resources-str">2.4.2. List of Kafka MirrorMaker cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-config-kafka-bridge-str">2.5. Kafka Bridge cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#proc-config-kafka-bridge-str">2.5.1. Configuring the Kafka Bridge</a></li>
<li><a href="#ref-list-of-kafka-bridge-resources-str">2.5.2. List of Kafka Bridge cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-customizing-kubernetes-resources-str">2.6. Customizing Kubernetes resources</a>
<ul class="sectlevel3">
<li><a href="#con-customizing-image-pull-policy-str">2.6.1. Customizing the image pull policy</a></li>
<li><a href="#con-applying-termination-grace-period-str">2.6.2. Applying a termination grace period</a></li>
</ul>
</li>
<li><a href="#assembly-scheduling-str">2.7. Configuring pod scheduling</a>
<ul class="sectlevel3">
<li><a href="#affinity-str">2.7.1. Specifying affinity, tolerations, and topology spread constraints</a></li>
<li><a href="#configuring-pod-anti-affinity-to-schedule-each-kafka-broker-on-a-different-worker-node-str">2.7.2. Configuring pod anti-affinity to schedule each Kafka broker on a different worker node</a></li>
<li><a href="#configuring-pod-anti-affinity-in-kafka-components-str">2.7.3. Configuring pod anti-affinity in Kafka components</a></li>
<li><a href="#proc-configuring-node-affinity-str">2.7.4. Configuring node affinity in Kafka components</a></li>
<li><a href="#proc-dedicated-nodes-str">2.7.5. Setting up dedicated nodes and scheduling pods on them</a></li>
</ul>
</li>
<li><a href="#external-logging_str">2.8. Logging configuration</a>
<ul class="sectlevel3">
<li><a href="#logging_options_for_kafka_components_and_operators">2.8.1. Logging options for Kafka components and operators</a></li>
<li><a href="#creating-configmap_str">2.8.2. Creating a ConfigMap for logging</a></li>
<li><a href="#creating-logging-filters_str">2.8.3. Adding logging filters to Operators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-loading-config-with-providers-str">3. Loading configuration values from external sources</a>
<ul class="sectlevel2">
<li><a href="#proc-loading-config-from-config-map-str">3.1. Loading configuration values from a ConfigMap</a></li>
<li><a href="#proc-loading-config-from-env-vars-str">3.2. Loading configuration values from environment variables</a></li>
</ul>
</li>
<li><a href="#assembly-security-providers-str">4. Applying security context to Strimzi pods and containers</a>
<ul class="sectlevel2">
<li><a href="#con-config-security-providers-str">4.1. How to configure security context</a>
<ul class="sectlevel3">
<li><a href="#template_configuration_for_security_context">4.1.1. Template configuration for security context</a></li>
<li><a href="#baseline_provider_for_pod_security">4.1.2. Baseline Provider for pod security</a></li>
<li><a href="#restricted_provider_for_pod_security">4.1.3. Restricted Provider for pod security</a></li>
</ul>
</li>
<li><a href="#proc-config-restricted-security-providers-str">4.2. Enabling the Restricted Provider for the Cluster Operator</a></li>
<li><a href="#con-config-custom-security-providers-str">4.3. Implementing a custom pod security provider</a></li>
<li><a href="#con-config-openshift-security-providers-str">4.4. Handling of security context by Kubernetes platform</a></li>
</ul>
</li>
<li><a href="#assembly-operators-str">5. Using Strimzi Operators</a>
<ul class="sectlevel2">
<li><a href="#con-operators-namespaces-str">5.1. Watching namespaces with Strimzi operators</a></li>
<li><a href="#using-the-cluster-operator-str">5.2. Using the Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#ref-operator-cluster-rbac-resources-str">5.2.1. Role-Based Access Control (RBAC) resources</a></li>
<li><a href="#ref-operator-cluster-logging-configmap-str">5.2.2. ConfigMap for Cluster Operator logging</a></li>
<li><a href="#ref-operator-cluster-str">5.2.3. Configuring the Cluster Operator with environment variables</a></li>
<li><a href="#proc-configuring-proxy-config-cluster-operator-str">5.2.4. Configuring the Cluster Operator with default proxy settings</a></li>
<li><a href="#assembly-using-multiple-cluster-operator-replicas-str">5.2.5. Running multiple Cluster Operator replicas with leader election</a></li>
<li><a href="#assembly-fips-support-str">5.2.6. FIPS support</a></li>
</ul>
</li>
<li><a href="#using-the-topic-operator-str">5.3. Using the Topic Operator</a>
<ul class="sectlevel3">
<li><a href="#ref-operator-topic-str">5.3.1. Kafka topic resource</a></li>
<li><a href="#ref-topic-operator-store-str">5.3.2. Topic Operator topic store</a></li>
<li><a href="#proc-configuring-kafka-topic-str">5.3.3. Configuring Kafka topics</a></li>
<li><a href="#proc-topic-operator-with-resource-requests-limits-str">5.3.4. Configuring the Topic Operator with resource requests and limits</a></li>
</ul>
</li>
<li><a href="#assembly-using-the-user-operator-str">5.4. Using the User Operator</a>
<ul class="sectlevel3">
<li><a href="#proc-configuring-kafka-user-str">5.4.1. Configuring Kafka users</a></li>
<li><a href="#proc-user-operator-with-resource-requests-limits-str">5.4.2. Configuring the User Operator with resource requests and limits</a></li>
</ul>
</li>
<li><a href="#ref-operator-cluster-feature-gates-str">5.5. Configuring feature gates</a>
<ul class="sectlevel3">
<li><a href="#controlplanelistener_feature_gate">5.5.1. ControlPlaneListener feature gate</a></li>
<li><a href="#serviceaccountpatching_feature_gate">5.5.2. ServiceAccountPatching feature gate</a></li>
<li><a href="#ref-operator-use-strimzi-pod-sets-feature-gate-str">5.5.3. UseStrimziPodSets feature gate</a></li>
<li><a href="#ref-operator-use-kraft-feature-gate-str">5.5.4. (Preview) UseKRaft feature gate</a></li>
<li><a href="#ref-operator-cluster-feature-gate-releases-str">5.5.5. Feature gate releases</a></li>
</ul>
</li>
<li><a href="#con-operators-prometheus-metrics-str">5.6. Monitoring operators using Prometheus metrics</a></li>
</ul>
</li>
<li><a href="#cruise-control-concepts-str">6. Cruise Control for cluster rebalancing</a>
<ul class="sectlevel2">
<li><a href="#con-cruise-control-overview-str">6.1. Cruise Control components and features</a></li>
<li><a href="#con-optimization-goals-str">6.2. Optimization goals overview</a>
<ul class="sectlevel3">
<li><a href="#goals_order_of_priority">6.2.1. Goals order of priority</a></li>
<li><a href="#goals_configuration_in_strimzi_custom_resources">6.2.2. Goals configuration in Strimzi custom resources</a></li>
<li><a href="#hard-soft-goals">6.2.3. Hard and soft optimization goals</a></li>
<li><a href="#main-goals">6.2.4. Main optimization goals</a></li>
<li><a href="#default-goals">6.2.5. Default optimization goals</a></li>
<li><a href="#user-provided-goals">6.2.6. User-provided optimization goals</a></li>
</ul>
</li>
<li><a href="#con-optimization-proposals-str">6.3. Optimization proposals overview</a>
<ul class="sectlevel3">
<li><a href="#con-optimization-proposals-modes-str">6.3.1. Rebalancing modes</a></li>
<li><a href="#contents-optimization-proposals">6.3.2. The results of an optimization proposal</a></li>
<li><a href="#manually_approving_or_rejecting_an_optimization_proposal">6.3.3. Manually approving or rejecting an optimization proposal</a></li>
<li><a href="#automatically_approving_an_optimization_proposal">6.3.4. Automatically approving an optimization proposal</a></li>
<li><a href="#optimization_proposal_summary_properties">6.3.5. Optimization proposal summary properties</a></li>
<li><a href="#broker_load_properties">6.3.6. Broker load properties</a></li>
<li><a href="#cached_optimization_proposal">6.3.7. Cached optimization proposal</a></li>
</ul>
</li>
<li><a href="#con-rebalance-str">6.4. Rebalance performance tuning overview</a>
<ul class="sectlevel3">
<li><a href="#partition_reassignment_commands">6.4.1. Partition reassignment commands</a></li>
<li><a href="#replica_movement_strategies">6.4.2. Replica movement strategies</a></li>
<li><a href="#intra_broker_disk_balancing">6.4.3. Intra-broker disk balancing</a></li>
<li><a href="#rebalance_tuning_options">6.4.4. Rebalance tuning options</a></li>
</ul>
</li>
<li><a href="#proc-configuring-deploying-cruise-control-str">6.5. Configuring and deploying Cruise Control with Kafka</a></li>
<li><a href="#proc-generating-optimization-proposals-str">6.6. Generating optimization proposals</a></li>
<li><a href="#proc-approving-optimization-proposal-str">6.7. Approving an optimization proposal</a></li>
<li><a href="#proc-stopping-cluster-rebalance-str">6.8. Stopping a cluster rebalance</a></li>
<li><a href="#proc-fixing-problems-with-kafkarebalance-str">6.9. Fixing problems with a <code>KafkaRebalance</code> resource</a></li>
</ul>
</li>
<li><a href="#security-str">7. Managing TLS certificates</a>
<ul class="sectlevel2">
<li><a href="#certificate-authorities-str">7.1. Internal cluster CA and clients CA</a></li>
<li><a href="#certificates-and-secrets-str">7.2. Secrets generated by the operators</a>
<ul class="sectlevel3">
<li><a href="#certificates-and-secrets-formats-str">7.2.1. TLS authentication using keys and certificates in PEM or PKCS #12 format</a></li>
<li><a href="#con-certificates-str">7.2.2. Secrets generated by the Cluster Operator</a></li>
<li><a href="#cluster_ca_secrets">7.2.3. Cluster CA secrets</a></li>
<li><a href="#clients_ca_secrets">7.2.4. Clients CA secrets</a></li>
<li><a href="#user_secrets_generated_by_the_user_operator">7.2.5. User secrets generated by the User Operator</a></li>
<li><a href="#adding_labels_and_annotations_to_cluster_ca_secrets">7.2.6. Adding labels and annotations to cluster CA secrets</a></li>
<li><a href="#disabling_ownerreference_in_the_ca_secrets">7.2.7. Disabling <code>ownerReference</code> in the CA secrets</a></li>
</ul>
</li>
<li><a href="#con-certificate-renewal-str">7.3. Certificate renewal and validity periods</a>
<ul class="sectlevel3">
<li><a href="#renewal_process_with_automatically_generated_ca_certificates">7.3.1. Renewal process with automatically generated CA certificates</a></li>
<li><a href="#client_certificate_renewal">7.3.2. Client certificate renewal</a></li>
<li><a href="#proc-renewing-ca-certs-manually-str">7.3.3. Manually renewing the CA certificates generated by the Cluster Operator</a></li>
<li><a href="#proc-replacing-private-keys-str">7.3.4. Replacing private keys used by the CA certificates generated by the Cluster Operator</a></li>
</ul>
</li>
<li><a href="#tls-connections-str">7.4. TLS connections</a>
<ul class="sectlevel3">
<li><a href="#zookeeper_communication">7.4.1. ZooKeeper communication</a></li>
<li><a href="#kafka_inter_broker_communication">7.4.2. Kafka inter-broker communication</a></li>
<li><a href="#topic_and_user_operators">7.4.3. Topic and User Operators</a></li>
<li><a href="#cruise_control">7.4.4. Cruise Control</a></li>
<li><a href="#kafka_client_connections">7.4.5. Kafka Client connections</a></li>
</ul>
</li>
<li><a href="#configuring-internal-clients-to-trust-cluster-ca-str">7.5. Configuring internal clients to trust the cluster CA</a></li>
<li><a href="#configuring-external-clients-to-trust-cluster-ca-str">7.6. Configuring external clients to trust the cluster CA</a></li>
<li><a href="#security-using-your-own-certificates-str">7.7. Using your own CA certificates and private keys</a>
<ul class="sectlevel3">
<li><a href="#installing-your-own-ca-certificates-str">7.7.1. Installing your own CA certificates and private keys</a></li>
<li><a href="#renewing-your-own-ca-certificates-str">7.7.2. Renewing your own CA certificates</a></li>
<li><a href="#proc-replacing-your-own-private-keys-str">7.7.3. Renewing or replacing CA certificates and private keys with your own</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#api_reference-str">8. Custom resource API reference</a>
<ul class="sectlevel2">
<li><a href="#con-common-configuration-properties-reference">8.1. Common configuration properties</a>
<ul class="sectlevel3">
<li><a href="#con-common-configuration-replicas-reference">8.1.1. <code>replicas</code></a></li>
<li><a href="#con-common-configuration-bootstrap-reference">8.1.2. <code>bootstrapServers</code></a></li>
<li><a href="#con-common-configuration-ssl-reference">8.1.3. <code>ssl</code></a></li>
<li><a href="#con-common-configuration-trusted-certificates-reference">8.1.4. <code>trustedCertificates</code></a></li>
<li><a href="#con-common-configuration-resources-reference">8.1.5. <code>resources</code></a></li>
<li><a href="#con-common-configuration-images-reference">8.1.6. <code>image</code></a></li>
<li><a href="#con-common-configuration-healthchecks-reference">8.1.7. <code>livenessProbe</code> and <code>readinessProbe</code> healthchecks</a></li>
<li><a href="#con-common-configuration-prometheus-reference">8.1.8. <code>metricsConfig</code></a></li>
<li><a href="#con-common-configuration-jvm-reference">8.1.9. <code>jvmOptions</code></a></li>
<li><a href="#con-common-configuration-garbage-collection-reference">8.1.10. Garbage collector logging</a></li>
</ul>
</li>
<li><a href="#schema_properties">8.2. Schema properties</a>
<ul class="sectlevel3">
<li><a href="#type-Kafka-reference">8.2.1. <code>Kafka</code> schema reference</a></li>
<li><a href="#type-KafkaSpec-reference">8.2.2. <code>KafkaSpec</code> schema reference</a></li>
<li><a href="#type-KafkaClusterSpec-reference">8.2.3. <code>KafkaClusterSpec</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListener-reference">8.2.4. <code>GenericKafkaListener</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationTls-reference">8.2.5. <code>KafkaListenerAuthenticationTls</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationScramSha512-reference">8.2.6. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationOAuth-reference">8.2.7. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-GenericSecretSource-reference">8.2.8. <code>GenericSecretSource</code> schema reference</a></li>
<li><a href="#type-CertSecretSource-reference">8.2.9. <code>CertSecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationCustom-reference">8.2.10. <code>KafkaListenerAuthenticationCustom</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListenerConfiguration-reference">8.2.11. <code>GenericKafkaListenerConfiguration</code> schema reference</a></li>
<li><a href="#type-CertAndKeySecretSource-reference">8.2.12. <code>CertAndKeySecretSource</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListenerConfigurationBootstrap-reference">8.2.13. <code>GenericKafkaListenerConfigurationBootstrap</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListenerConfigurationBroker-reference">8.2.14. <code>GenericKafkaListenerConfigurationBroker</code> schema reference</a></li>
<li><a href="#type-EphemeralStorage-reference">8.2.15. <code>EphemeralStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorage-reference">8.2.16. <code>PersistentClaimStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorageOverride-reference">8.2.17. <code>PersistentClaimStorageOverride</code> schema reference</a></li>
<li><a href="#type-JbodStorage-reference">8.2.18. <code>JbodStorage</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationSimple-reference">8.2.19. <code>KafkaAuthorizationSimple</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationOpa-reference">8.2.20. <code>KafkaAuthorizationOpa</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationKeycloak-reference">8.2.21. <code>KafkaAuthorizationKeycloak</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationCustom-reference">8.2.22. <code>KafkaAuthorizationCustom</code> schema reference</a></li>
<li><a href="#type-Rack-reference">8.2.23. <code>Rack</code> schema reference</a></li>
<li><a href="#type-Probe-reference">8.2.24. <code>Probe</code> schema reference</a></li>
<li><a href="#type-JvmOptions-reference">8.2.25. <code>JvmOptions</code> schema reference</a></li>
<li><a href="#type-SystemProperty-reference">8.2.26. <code>SystemProperty</code> schema reference</a></li>
<li><a href="#type-KafkaJmxOptions-reference">8.2.27. <code>KafkaJmxOptions</code> schema reference</a></li>
<li><a href="#type-KafkaJmxAuthenticationPassword-reference">8.2.28. <code>KafkaJmxAuthenticationPassword</code> schema reference</a></li>
<li><a href="#type-JmxPrometheusExporterMetrics-reference">8.2.29. <code>JmxPrometheusExporterMetrics</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationReference-reference">8.2.30. <code>ExternalConfigurationReference</code> schema reference</a></li>
<li><a href="#type-InlineLogging-reference">8.2.31. <code>InlineLogging</code> schema reference</a></li>
<li><a href="#type-ExternalLogging-reference">8.2.32. <code>ExternalLogging</code> schema reference</a></li>
<li><a href="#type-KafkaClusterTemplate-reference">8.2.33. <code>KafkaClusterTemplate</code> schema reference</a></li>
<li><a href="#type-StatefulSetTemplate-reference">8.2.34. <code>StatefulSetTemplate</code> schema reference</a></li>
<li><a href="#type-MetadataTemplate-reference">8.2.35. <code>MetadataTemplate</code> schema reference</a></li>
<li><a href="#type-PodTemplate-reference">8.2.36. <code>PodTemplate</code> schema reference</a></li>
<li><a href="#type-InternalServiceTemplate-reference">8.2.37. <code>InternalServiceTemplate</code> schema reference</a></li>
<li><a href="#type-ResourceTemplate-reference">8.2.38. <code>ResourceTemplate</code> schema reference</a></li>
<li><a href="#type-PodDisruptionBudgetTemplate-reference">8.2.39. <code>PodDisruptionBudgetTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerTemplate-reference">8.2.40. <code>ContainerTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerEnvVar-reference">8.2.41. <code>ContainerEnvVar</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterSpec-reference">8.2.42. <code>ZookeeperClusterSpec</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterTemplate-reference">8.2.43. <code>ZookeeperClusterTemplate</code> schema reference</a></li>
<li><a href="#type-EntityOperatorSpec-reference">8.2.44. <code>EntityOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityTopicOperatorSpec-reference">8.2.45. <code>EntityTopicOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityUserOperatorSpec-reference">8.2.46. <code>EntityUserOperatorSpec</code> schema reference</a></li>
<li><a href="#type-TlsSidecar-reference">8.2.47. <code>TlsSidecar</code> schema reference</a></li>
<li><a href="#type-EntityOperatorTemplate-reference">8.2.48. <code>EntityOperatorTemplate</code> schema reference</a></li>
<li><a href="#type-DeploymentTemplate-reference">8.2.49. <code>DeploymentTemplate</code> schema reference</a></li>
<li><a href="#type-CertificateAuthority-reference">8.2.50. <code>CertificateAuthority</code> schema reference</a></li>
<li><a href="#type-CruiseControlSpec-reference">8.2.51. <code>CruiseControlSpec</code> schema reference</a></li>
<li><a href="#type-CruiseControlTemplate-reference">8.2.52. <code>CruiseControlTemplate</code> schema reference</a></li>
<li><a href="#type-BrokerCapacity-reference">8.2.53. <code>BrokerCapacity</code> schema reference</a></li>
<li><a href="#type-BrokerCapacityOverride-reference">8.2.54. <code>BrokerCapacityOverride</code> schema reference</a></li>
<li><a href="#type-JmxTransSpec-reference">8.2.55. <code>JmxTransSpec</code> schema reference</a></li>
<li><a href="#type-JmxTransOutputDefinitionTemplate-reference">8.2.56. <code>JmxTransOutputDefinitionTemplate</code> schema reference</a></li>
<li><a href="#type-JmxTransQueryTemplate-reference">8.2.57. <code>JmxTransQueryTemplate</code> schema reference</a></li>
<li><a href="#type-JmxTransTemplate-reference">8.2.58. <code>JmxTransTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaExporterSpec-reference">8.2.59. <code>KafkaExporterSpec</code> schema reference</a></li>
<li><a href="#type-KafkaExporterTemplate-reference">8.2.60. <code>KafkaExporterTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaStatus-reference">8.2.61. <code>KafkaStatus</code> schema reference</a></li>
<li><a href="#type-Condition-reference">8.2.62. <code>Condition</code> schema reference</a></li>
<li><a href="#type-ListenerStatus-reference">8.2.63. <code>ListenerStatus</code> schema reference</a></li>
<li><a href="#type-ListenerAddress-reference">8.2.64. <code>ListenerAddress</code> schema reference</a></li>
<li><a href="#type-KafkaConnect-reference">8.2.65. <code>KafkaConnect</code> schema reference</a></li>
<li><a href="#type-KafkaConnectSpec-reference">8.2.66. <code>KafkaConnectSpec</code> schema reference</a></li>
<li><a href="#type-ClientTls-reference">8.2.67. <code>ClientTls</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationTls-reference">8.2.68. <code>KafkaClientAuthenticationTls</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationScramSha256-reference">8.2.69. <code>KafkaClientAuthenticationScramSha256</code> schema reference</a></li>
<li><a href="#type-PasswordSecretSource-reference">8.2.70. <code>PasswordSecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationScramSha512-reference">8.2.71. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationPlain-reference">8.2.72. <code>KafkaClientAuthenticationPlain</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationOAuth-reference">8.2.73. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-JaegerTracing-reference">8.2.74. <code>JaegerTracing</code> schema reference</a></li>
<li><a href="#type-OpenTelemetryTracing-reference">8.2.75. <code>OpenTelemetryTracing</code> schema reference</a></li>
<li><a href="#type-KafkaConnectTemplate-reference">8.2.76. <code>KafkaConnectTemplate</code> schema reference</a></li>
<li><a href="#type-BuildConfigTemplate-reference">8.2.77. <code>BuildConfigTemplate</code> schema reference</a></li>
<li><a href="#type-ExternalConfiguration-reference">8.2.78. <code>ExternalConfiguration</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationEnv-reference">8.2.79. <code>ExternalConfigurationEnv</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationEnvVarSource-reference">8.2.80. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationVolumeSource-reference">8.2.81. <code>ExternalConfigurationVolumeSource</code> schema reference</a></li>
<li><a href="#type-Build-reference">8.2.82. <code>Build</code> schema reference</a></li>
<li><a href="#type-DockerOutput-reference">8.2.83. <code>DockerOutput</code> schema reference</a></li>
<li><a href="#type-ImageStreamOutput-reference">8.2.84. <code>ImageStreamOutput</code> schema reference</a></li>
<li><a href="#type-Plugin-reference">8.2.85. <code>Plugin</code> schema reference</a></li>
<li><a href="#type-JarArtifact-reference">8.2.86. <code>JarArtifact</code> schema reference</a></li>
<li><a href="#type-TgzArtifact-reference">8.2.87. <code>TgzArtifact</code> schema reference</a></li>
<li><a href="#type-ZipArtifact-reference">8.2.88. <code>ZipArtifact</code> schema reference</a></li>
<li><a href="#type-MavenArtifact-reference">8.2.89. <code>MavenArtifact</code> schema reference</a></li>
<li><a href="#type-OtherArtifact-reference">8.2.90. <code>OtherArtifact</code> schema reference</a></li>
<li><a href="#type-KafkaConnectStatus-reference">8.2.91. <code>KafkaConnectStatus</code> schema reference</a></li>
<li><a href="#type-ConnectorPlugin-reference">8.2.92. <code>ConnectorPlugin</code> schema reference</a></li>
<li><a href="#type-KafkaTopic-reference">8.2.93. <code>KafkaTopic</code> schema reference</a></li>
<li><a href="#type-KafkaTopicSpec-reference">8.2.94. <code>KafkaTopicSpec</code> schema reference</a></li>
<li><a href="#type-KafkaTopicStatus-reference">8.2.95. <code>KafkaTopicStatus</code> schema reference</a></li>
<li><a href="#type-KafkaUser-reference">8.2.96. <code>KafkaUser</code> schema reference</a></li>
<li><a href="#type-KafkaUserSpec-reference">8.2.97. <code>KafkaUserSpec</code> schema reference</a></li>
<li><a href="#type-KafkaUserTlsClientAuthentication-reference">8.2.98. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserTlsExternalClientAuthentication-reference">8.2.99. <code>KafkaUserTlsExternalClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserScramSha512ClientAuthentication-reference">8.2.100. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></li>
<li><a href="#type-Password-reference">8.2.101. <code>Password</code> schema reference</a></li>
<li><a href="#type-PasswordSource-reference">8.2.102. <code>PasswordSource</code> schema reference</a></li>
<li><a href="#type-KafkaUserAuthorizationSimple-reference">8.2.103. <code>KafkaUserAuthorizationSimple</code> schema reference</a></li>
<li><a href="#type-AclRule-reference">8.2.104. <code>AclRule</code> schema reference</a></li>
<li><a href="#type-AclRuleTopicResource-reference">8.2.105. <code>AclRuleTopicResource</code> schema reference</a></li>
<li><a href="#type-AclRuleGroupResource-reference">8.2.106. <code>AclRuleGroupResource</code> schema reference</a></li>
<li><a href="#type-AclRuleClusterResource-reference">8.2.107. <code>AclRuleClusterResource</code> schema reference</a></li>
<li><a href="#type-AclRuleTransactionalIdResource-reference">8.2.108. <code>AclRuleTransactionalIdResource</code> schema reference</a></li>
<li><a href="#type-KafkaUserQuotas-reference">8.2.109. <code>KafkaUserQuotas</code> schema reference</a></li>
<li><a href="#type-KafkaUserTemplate-reference">8.2.110. <code>KafkaUserTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaUserStatus-reference">8.2.111. <code>KafkaUserStatus</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker-reference">8.2.112. <code>KafkaMirrorMaker</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerSpec-reference">8.2.113. <code>KafkaMirrorMakerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerConsumerSpec-reference">8.2.114. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerProducerSpec-reference">8.2.115. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerTemplate-reference">8.2.116. <code>KafkaMirrorMakerTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerStatus-reference">8.2.117. <code>KafkaMirrorMakerStatus</code> schema reference</a></li>
<li><a href="#type-KafkaBridge-reference">8.2.118. <code>KafkaBridge</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeSpec-reference">8.2.119. <code>KafkaBridgeSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeHttpConfig-reference">8.2.120. <code>KafkaBridgeHttpConfig</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeHttpCors-reference">8.2.121. <code>KafkaBridgeHttpCors</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeAdminClientSpec-reference">8.2.122. <code>KafkaBridgeAdminClientSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeConsumerSpec-reference">8.2.123. <code>KafkaBridgeConsumerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeProducerSpec-reference">8.2.124. <code>KafkaBridgeProducerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeTemplate-reference">8.2.125. <code>KafkaBridgeTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeStatus-reference">8.2.126. <code>KafkaBridgeStatus</code> schema reference</a></li>
<li><a href="#type-KafkaConnector-reference">8.2.127. <code>KafkaConnector</code> schema reference</a></li>
<li><a href="#type-KafkaConnectorSpec-reference">8.2.128. <code>KafkaConnectorSpec</code> schema reference</a></li>
<li><a href="#type-AutoRestart-reference">8.2.129. <code>AutoRestart</code> schema reference</a></li>
<li><a href="#type-KafkaConnectorStatus-reference">8.2.130. <code>KafkaConnectorStatus</code> schema reference</a></li>
<li><a href="#type-AutoRestartStatus-reference">8.2.131. <code>AutoRestartStatus</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2-reference">8.2.132. <code>KafkaMirrorMaker2</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2Spec-reference">8.2.133. <code>KafkaMirrorMaker2Spec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">8.2.134. <code>KafkaMirrorMaker2ClusterSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">8.2.135. <code>KafkaMirrorMaker2MirrorSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">8.2.136. <code>KafkaMirrorMaker2ConnectorSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2Status-reference">8.2.137. <code>KafkaMirrorMaker2Status</code> schema reference</a></li>
<li><a href="#type-KafkaRebalance-reference">8.2.138. <code>KafkaRebalance</code> schema reference</a></li>
<li><a href="#type-KafkaRebalanceSpec-reference">8.2.139. <code>KafkaRebalanceSpec</code> schema reference</a></li>
<li><a href="#type-KafkaRebalanceStatus-reference">8.2.140. <code>KafkaRebalanceStatus</code> schema reference</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview-str"><a class="link" href="#overview-str">1. Configuration overview</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Strimzi simplifies the process of running <a href="https://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a> in a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>This guide describes how to configure and manage a Strimzi deployment.</p>
</div>
<div class="sect2">
<h3 id="configuration-points-overview-str"><a class="link" href="#configuration-points-overview-str">1.1. Configuring custom resources</a></h3>
<div class="paragraph _abstract">
<p>Use custom resources to configure your Strimzi deployment.</p>
</div>
<div class="paragraph">
<p>You can use custom resources to configure and create instances of the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka clusters</p>
</li>
<li>
<p>Kafka Connect clusters</p>
</li>
<li>
<p>Kafka MirrorMaker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
<li>
<p>Cruise Control</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also use custom resource configuration to manage your instances or modify your deployment to introduce additional features.
This might include configuration that supports the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Securing client access to Kafka brokers</p>
</li>
<li>
<p>Accessing Kafka brokers from outside the cluster</p>
</li>
<li>
<p>Creating topics</p>
</li>
<li>
<p>Creating users (clients)</p>
</li>
<li>
<p>Controlling feature gates</p>
</li>
<li>
<p>Changing logging frequency</p>
</li>
<li>
<p>Allocating resource limits and requests</p>
</li>
<li>
<p>Introducing features, such as Strimzi Drain Cleaner, Cruise Control, or distributed tracing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#api_reference-str">Custom resource API reference</a> describes the properties you can use in your configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-points-configmaps-str"><a class="link" href="#configuration-points-configmaps-str">1.2. Using ConfigMaps to add configuration</a></h3>
<div class="paragraph _abstract">
<p>Use <code>ConfigMap</code> resources to add specific configuration to your Strimzi deployment.
ConfigMaps use key-value pairs to store non-confidential data.
Configuration data added to ConfigMaps is maintained in one place and can be reused amongst components.</p>
</div>
<div class="paragraph">
<p>ConfigMaps can only store configuration data related to the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logging configuration</p>
</li>
<li>
<p>Metrics configuration</p>
</li>
<li>
<p>External configuration for Kafka Connect connectors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can&#8217;t use ConfigMaps for other areas of configuration.</p>
</div>
<div class="paragraph">
<p>When you configure a component, you can add a reference to a ConfigMap using the <code>configMapKeyRef</code> property.</p>
</div>
<div class="paragraph">
<p>For example, you can use <code>configMapKeyRef</code> to reference a ConfigMap that provides configuration for logging.
You might use a ConfigMap to pass a Log4j configuration file.
You add the reference to the <code>logging</code> configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example ConfigMap for logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: my-config-map
        key: my-config-map-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a ConfigMap for metrics configuration, you add a reference to the <code>metricsConfig</code> configuration of the component in the same way.</p>
</div>
<div class="paragraph">
<p><code>ExternalConfiguration</code> properties make data from a ConfigMap (or Secret) mounted to a pod available as environment variables or volumes.
You can use external configuration data for the connectors used by Kafka Connect.
The data might be related to an external data source, providing the values needed for the connector to communicate with that data source.</p>
</div>
<div class="paragraph">
<p>For example, you can use the <code>configMapKeyRef</code> property to pass configuration data from a ConfigMap as an environment variable.</p>
</div>
<div class="listingblock">
<div class="title">Example ConfigMap providing environment variable values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          configMapKeyRef:
            name: my-config-map
            key: my-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using ConfigMaps that are managed externally, use configuration providers to load the data in the ConfigMaps.
For more information on using configuration providers, see <a href="#assembly-loading-config-with-providers-str">Loading configuration values from external sources</a>.</p>
</div>
<div class="sect3">
<h4 id="naming_custom_configmaps"><a class="link" href="#naming_custom_configmaps">1.2.1. Naming custom ConfigMaps</a></h4>
<div class="paragraph">
<p>Strimzi <a href="#ref-list-of-kafka-cluster-resources-str">creates its own ConfigMaps and other resources</a> when it is deployed to Kubernetes.
The ConfigMaps contain data necessary for running components.
The ConfigMaps created by Strimzi must not be edited.</p>
</div>
<div class="paragraph">
<p>Make sure that any custom ConfigMaps you create do not have the same name as these default ConfigMaps. If they have the same name, they will be overwritten. For example, if your ConfigMap has the same name as the ConfigMap for the Kafka cluster, it will be overwritten when there is an update to the Kafka cluster.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#ref-list-of-kafka-cluster-resources-str">List of Kafka cluster resources</a> (including ConfigMaps)</p>
</li>
<li>
<p><a href="#external-logging_str">Logging configuration</a></p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference"><code>metricsConfig</code></a></p>
</li>
<li>
<p><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code> schema reference</a></p>
</li>
<li>
<p><a href="#assembly-loading-config-with-providers-str">Loading configuration values from external sources</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions-str"><a class="link" href="#document-conventions-str">1.3. Document Conventions</a></h3>
<div class="paragraph">
<div class="title">User-replaced values</div>
<p>User-replaced values, also known as <em>replaceables</em>, are shown in <em>italics</em> with angle brackets (&lt; &gt;).
Underscores ( _ ) are used for multi-word values.
If the value refers to code or commands, <code>monospace</code> is also used.</p>
</div>
<div class="paragraph">
<p>For example, in the following code, you will want to replace <code><em>&lt;my_namespace&gt;</em></code> with the name of your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>&lt;my_namespace&gt;</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2 _additional-resources">
<h3 id="additional_resources"><a class="link" href="#additional_resources">1.4. Additional resources</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="./overview.html" target="_blank" rel="noopener">Strimzi Overview</a></p>
</li>
<li>
<p><a href="./deploying.html" target="_blank" rel="noopener">Deploying and Upgrading Strimzi</a></p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Using the Strimzi Kafka Bridge</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-deployment-configuration-str"><a class="link" href="#assembly-deployment-configuration-str">2. Configuring a Strimzi deployment</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Configure your Strimzi deployment using custom resources.
Strimzi provides <a href="./deploying.html#deploy-examples-str" target="_blank" rel="noopener">example configuration files</a>, which can serve as a starting point when building your own Kafka component configuration for deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Labels applied to a custom resource are also applied to the Kubernetes resources making up its cluster.
This provides a convenient mechanism for resources to be labeled as required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Monitoring a Strimzi deployment</div>
<p>You can use Prometheus and Grafana to monitor your Strimzi deployment.
For more information, see <a href="./deploying.html#assembly-metrics-str" target="_blank" rel="noopener">Introducing metrics to Kafka</a>.</p>
</div>
<div class="sect2">
<h3 id="assembly-config-kafka-str"><a class="link" href="#assembly-config-kafka-str">2.1. Kafka cluster configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure a Kafka deployment using the <code>Kafka</code> resource.
A Kafka cluster is deployed with a ZooKeeper cluster, so configuration options are also available for ZooKeeper within the <code>Kafka</code> resource.
The Entity Operator comprises the Topic Operator and User Operator.
You can also configure <code>entityOperator</code> properties in the <code>Kafka</code> resource to include the Topic Operator and User Operator in the deployment.</p>
</div>
<div class="paragraph">
<p><a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a> describes the full schema of the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>For more information about Apache Kafka, see the <a href="https://kafka.apache.org/documentation/" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</div>
<div class="paragraph">
<div class="title">Listener configuration</div>
<p>You configure listeners for connecting clients to Kafka brokers.
For more information on configuring listeners, see <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<div class="title">Managing TLS certificates</div>
<p>When deploying Kafka, the Cluster Operator automatically sets up and renews TLS certificates to enable encryption and authentication within your cluster.
If required, you can manually renew the cluster and clients CA certificates before their renewal period starts.
You can also replace the keys used by the cluster and clients CA certificates.
For more information, see <a href="#proc-renewing-ca-certs-manually-str">Renewing CA certificates manually</a> and <a href="#proc-replacing-private-keys-str">Replacing private keys</a>.</p>
</div>
<div class="sect3">
<h4 id="proc-config-kafka-str"><a class="link" href="#proc-config-kafka-str">2.1.1. Configuring Kafka</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>Kafka</code> resource to configure your Kafka deployment.</p>
</div>
<div class="paragraph">
<p>As well as configuring Kafka, you can add configuration for ZooKeeper and the Strimzi Operators.
Common configuration properties, such as logging and healthchecks, are configured independently for each component.</p>
</div>
<div class="paragraph">
<p>This procedure shows only some of the possible configuration options, but those that are particularly important include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource requests (CPU / Memory)</p>
</li>
<li>
<p>JVM options for maximum and minimum memory allocation</p>
</li>
<li>
<p>Listeners (and authentication of clients)</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Storage</p>
</li>
<li>
<p>Rack awareness</p>
</li>
<li>
<p>Metrics</p>
</li>
<li>
<p>Cruise Control for cluster rebalancing</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Kafka versions</div>
<p>The <code>inter.broker.protocol.version</code> property for the Kafka <code>config</code> must be the version supported by the specified Kafka version (<code>spec.kafka.version</code>).
The property represents the version of Kafka protocol used in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>From Kafka 3.0.0, when the <code>inter.broker.protocol.version</code> is set to <code>3.0</code> or higher, the <code>log.message.format.version</code> option is ignored and doesn&#8217;t need to be set.</p>
</div>
<div class="paragraph">
<p>An update to the <code>inter.broker.protocol.version</code> is required when upgrading your Kafka version.
For more information, see <a href="./deploying.html#assembly-upgrading-kafka-versions-str">Upgrading Kafka</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on deploying a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>Kafka</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    replicas: 3 <b class="conum">(1)</b>
    version: 3.3.2 <b class="conum">(2)</b>
    logging: <b class="conum">(3)</b>
      type: inline
      loggers:
        kafka.root.logger.level: "INFO"
    resources: <b class="conum">(4)</b>
      requests:
        memory: 64Gi
        cpu: "8"
      limits:
        memory: 64Gi
        cpu: "12"
    readinessProbe: <b class="conum">(5)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    jvmOptions: <b class="conum">(6)</b>
      -Xms: 8192m
      -Xmx: 8192m
    image: my-org/my-image:latest <b class="conum">(7)</b>
    listeners: <b class="conum">(8)</b>
      - name: plain <b class="conum">(9)</b>
        port: 9092 <b class="conum">(10)</b>
        type: internal <b class="conum">(11)</b>
        tls: false <b class="conum">(12)</b>
        configuration:
          useServiceDnsDomain: true <b class="conum">(13)</b>
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication: <b class="conum">(14)</b>
          type: tls
      - name: external <b class="conum">(15)</b>
        port: 9094
        type: route
        tls: true
        configuration:
          brokerCertChainAndKey: <b class="conum">(16)</b>
            secretName: my-secret
            certificate: my-certificate.crt
            key: my-key.key
    authorization: <b class="conum">(17)</b>
      type: simple
    config: <b class="conum">(18)</b>
      auto.create.topics.enable: "false"
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 2
      default.replication.factor: 3
      min.insync.replicas: 2
      inter.broker.protocol.version: "3.3"
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(19)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
    storage: <b class="conum">(20)</b>
      type: persistent-claim <b class="conum">(21)</b>
      size: 10000Gi <b class="conum">(22)</b>
    rack: <b class="conum">(23)</b>
      topologyKey: topology.kubernetes.io/zone
    metricsConfig: <b class="conum">(24)</b>
      type: jmxPrometheusExporter
      valueFrom:
        configMapKeyRef: <b class="conum">(25)</b>
          name: my-config-map
          key: my-key
    # ...
  zookeeper: <b class="conum">(26)</b>
    replicas: 3 <b class="conum">(27)</b>
    logging: <b class="conum">(28)</b>
      type: inline
      loggers:
        zookeeper.root.logger: "INFO"
    resources:
      requests:
        memory: 8Gi
        cpu: "2"
      limits:
        memory: 8Gi
        cpu: "2"
    jvmOptions:
      -Xms: 4096m
      -Xmx: 4096m
    storage:
      type: persistent-claim
      size: 1000Gi
    metricsConfig:
      # ...
  entityOperator: <b class="conum">(29)</b>
    tlsSidecar: <b class="conum">(30)</b>
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging: <b class="conum">(31)</b>
        type: inline
        loggers:
          rootLogger.level: "INFO"
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
    userOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging: <b class="conum">(32)</b>
        type: inline
        loggers:
          rootLogger.level: INFO
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
  kafkaExporter: <b class="conum">(33)</b>
    # ...
  cruiseControl: <b class="conum">(34)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>. If your cluster already has topics defined, you can
<a href="#scaling-clusters-str">scale clusters</a>.</p>
</li>
<li>
<p>Kafka version, which can be changed to a supported version by following <a href="./deploying.html#assembly-upgrade-str">the upgrade procedure</a>.</p>
</li>
<li>
<p><a href="#property-kafka-logging-reference">Kafka loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> key. For the Kafka <code>kafka.root.logger.level</code> logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p>Listeners configure how clients connect to the Kafka cluster via bootstrap addresses. Listeners are <a href="#type-GenericKafkaListener-reference">configured as <em>internal</em> or <em>external</em> listeners for connection from inside or outside the Kubernetes cluster</a>.</p>
</li>
<li>
<p>Name to identify the listener. Must be unique within the Kafka cluster.</p>
</li>
<li>
<p>Port number used by the listener inside Kafka. The port number has to be unique within a given Kafka cluster. Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX. Depending on the listener type, the port number might not be the same as the port number that connects Kafka clients.</p>
</li>
<li>
<p>Listener type specified as <code>internal</code> or <code>cluster-ip</code> (to expose Kafka using per-broker <code>ClusterIP</code> services), or for external listeners, as <code>route</code> (OpenShift only), <code>loadbalancer</code>, <code>nodeport</code> or <code>ingress</code> (Kubernetes only).</p>
</li>
<li>
<p>Enables TLS encryption for each listener. Default is <code>false</code>. TLS encryption is not required for <code>route</code> listeners.</p>
</li>
<li>
<p>Defines whether the fully-qualified DNS names including the cluster service suffix (usually <code>.cluster.local</code>) are assigned.</p>
</li>
<li>
<p>Listener authentication mechanism <a href="#type-GenericKafkaListener-reference">specified as mTLS, SCRAM-SHA-512, or token-based OAuth 2.0</a>.</p>
</li>
<li>
<p>External listener configuration specifies <a href="#type-GenericKafkaListener-reference">how the Kafka cluster is exposed outside Kubernetes, such as through a <code>route</code>, <code>loadbalancer</code> or <code>nodeport</code></a>.</p>
</li>
<li>
<p>Optional configuration for a <a href="./deploying.html#proc-installing-certs-per-listener-str">Kafka listener certificate</a> managed by an external CA (certificate authority). The <code>brokerCertChainAndKey</code> specifies a <code>Secret</code> that contains a server certificate and a private key. You can configure Kafka listener certificates on any listener with enabled TLS encryption.</p>
</li>
<li>
<p>Authorization <a href="#type-KafkaClusterSpec-reference">enables simple, OAUTH 2.0, or OPA authorization on the Kafka broker.</a> Simple authorization uses the <code>AclAuthorizer</code> Kafka plugin.</p>
</li>
<li>
<p>Broker configuration. <a href="#property-kafka-config-reference">Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties for listeners with TLS encryption enabled to enable a specific <em>cipher suite</em> or TLS version</a>.</p>
</li>
<li>
<p><a href="#assembly-storage-str">Storage</a> is configured as <code>ephemeral</code>, <code>persistent-claim</code> or <code>jbod</code>.</p>
</li>
<li>
<p>Storage size for <a href="#proc-resizing-persistent-volumes-str">persistent volumes may be increased</a> and additional <a href="#proc-adding-volumes-to-jbod-storage-str">volumes may be added to JBOD storage</a>.</p>
</li>
<li>
<p>Persistent storage has <a href="#ref-persistent-storage-str">additional configuration options</a>, such as a storage <code>id</code> and <code>class</code> for dynamic volume provisioning.</p>
</li>
<li>
<p><a href="#type-Rack-reference">Rack awareness</a> configuration to spread replicas across different racks, data centers, or availability zones. The <code>topologyKey</code> must match a node label containing the rack ID. The example used in this configuration specifies a zone using the standard <code><a href="https://kubernetes.io/docs/reference/labels-annotations-taints/#topologykubernetesiozone" target="_blank" rel="noopener">topology.kubernetes.io/zone</a></code> label.</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a> enabled. In this example, metrics are configured for the Prometheus JMX Exporter (the default metrics exporter).</p>
</li>
<li>
<p>Prometheus rules for exporting metrics to a Grafana dashboard through the Prometheus JMX Exporter, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under <code>metricsConfig.valueFrom.configMapKeyRef.key</code>.</p>
</li>
<li>
<p>ZooKeeper-specific configuration, which contains properties similar to the Kafka configuration.</p>
</li>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of ZooKeeper nodes</a>. ZooKeeper clusters or ensembles usually run with an odd number of nodes, typically three, five, or seven. The majority of nodes must be available in order to maintain an effective quorum.
If the ZooKeeper cluster loses its quorum, it will stop responding to clients and the Kafka brokers will stop working.
Having a stable and highly available ZooKeeper cluster is crucial for Strimzi.</p>
</li>
<li>
<p>Specified <a href="#property-zookeeper-logging-reference">ZooKeeper loggers and log levels</a>.</p>
</li>
<li>
<p>Entity Operator configuration, which <a href="#assembly-kafka-entity-operator-str">specifies the configuration for the Topic Operator and User Operator</a>.</p>
</li>
<li>
<p>Entity Operator <a href="#type-TlsSidecar-reference">TLS sidecar configuration</a>. Entity Operator uses the TLS sidecar for secure communication with ZooKeeper.</p>
</li>
<li>
<p>Specified <a href="#property-topic-operator-logging-reference">Topic Operator loggers and log levels</a>. This example uses <code>inline</code> logging.</p>
</li>
<li>
<p>Specified <a href="#property-user-operator-logging-reference">User Operator loggers and log levels</a>.</p>
</li>
<li>
<p>Kafka Exporter configuration. <a href="./deploying.html#con-metrics-kafka-exporter-lag-str">Kafka Exporter</a> is an optional component for extracting metrics data from Kafka brokers, in particular consumer lag data. For Kafka Exporter to be able to work properly, consumer groups need to be in use.</p>
</li>
<li>
<p>Optional configuration for Cruise Control, which is used to <a href="#cruise-control-concepts-str">rebalance the Kafka cluster</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-entity-operator-str"><a class="link" href="#assembly-kafka-entity-operator-str">2.1.2. Configuring the Entity Operator</a></h4>
<div class="paragraph">
<p>The Entity Operator is responsible for managing Kafka-related entities in a running Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The Entity Operator comprises the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topic Operator to manage Kafka topics</p>
</li>
<li>
<p>User Operator to manage Kafka users</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Through <code>Kafka</code> resource configuration, the Cluster Operator can deploy the Entity Operator, including one or both operators, when deploying a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The operators are automatically configured to manage the topics and users of the Kafka cluster.
The Topic Operator and User Operator can only watch a single namespace.
For more information, see <a href="#con-operators-namespaces-str">Watching namespaces with Strimzi operators</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When deployed, the Entity Operator pod contains the operators according to the deployment configuration.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="ref-kafka-entity-operator-str"><a class="link" href="#ref-kafka-entity-operator-str">Entity Operator configuration properties</a></h5>
<div class="paragraph">
<p>Use the <code>entityOperator</code> property in <code>Kafka.spec</code> to configure the Entity Operator.</p>
</div>
<div class="paragraph">
<p>The <code>entityOperator</code> property supports several sub-properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tlsSidecar</code></p>
</li>
<li>
<p><code>topicOperator</code></p>
</li>
<li>
<p><code>userOperator</code></p>
</li>
<li>
<p><code>template</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>tlsSidecar</code> property contains the configuration of the TLS sidecar container, which is used to communicate with ZooKeeper.</p>
</div>
<div class="paragraph">
<p>The <code>template</code> property contains the configuration of the Entity Operator pod, such as labels, annotations, affinity, and tolerations.
For more information on configuring templates, see <a href="#assembly-customizing-kubernetes-resources-str">Customizing Kubernetes resources</a>.</p>
</div>
<div class="paragraph">
<p>The <code>topicOperator</code> property contains the configuration of the Topic Operator.
When this option is missing, the Entity Operator is deployed without the Topic Operator.</p>
</div>
<div class="paragraph">
<p>The <code>userOperator</code> property contains the configuration of the User Operator.
When this option is missing, the Entity Operator is deployed without the User Operator.</p>
</div>
<div class="paragraph">
<p>For more information on the properties used to configure the Entity Operator, see the <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of basic configuration enabling both operators</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an empty object (<code>{}</code>) is used for the <code>topicOperator</code> and <code>userOperator</code>, all properties use their default values.</p>
</div>
<div class="paragraph">
<p>When both <code>topicOperator</code> and <code>userOperator</code> properties are missing, the Entity Operator is not deployed.</p>
</div>
</div>
<div class="sect4">
<h5 id="topic-operator-str"><a class="link" href="#topic-operator-str">Topic Operator configuration properties</a></h5>
<div class="paragraph">
<p>Topic Operator deployment can be configured using additional options inside the <code>topicOperator</code> object.
The following properties are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the Topic Operator watches for <code>KafkaTopic</code> resources.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>120</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperSessionTimeoutSeconds</code></dt>
<dd>
<p>The ZooKeeper session timeout in seconds.
Default <code>18</code>.</p>
</dd>
<dt class="hdlist1"><code>topicMetadataMaxAttempts</code></dt>
<dd>
<p>The number of attempts at getting topic metadata from Kafka.
The time between each attempt is defined as an exponential back-off.
Consider increasing this value when topic creation might take more time due to the number of partitions or replicas.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#con-common-configuration-images-reference"><code>image</code></a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the Topic Operator.
For more details about resource request and limit configuration, see <a href="#con-common-configuration-resources-reference"><code>resources</code></a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the Topic Operator.
For more details, see <a href="#property-topic-operator-logging-reference"><code>logging</code></a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example Topic Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="user-operator-str"><a class="link" href="#user-operator-str">User Operator configuration properties</a></h5>
<div class="paragraph">
<p>User Operator deployment can be configured using additional options inside the <code>userOperator</code> object.
The following properties are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the User Operator watches for <code>KafkaUser</code> resources.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>120</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#con-common-configuration-images-reference"><code>image</code></a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the User Operator.
For more details about resource request and limit configuration, see <a href="#con-common-configuration-resources-reference"><code>resources</code></a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the User Operator.
For more details, see <a href="#property-topic-operator-logging-reference"><code>logging</code></a>.</p>
</dd>
<dt class="hdlist1"><code>secretPrefix</code></dt>
<dd>
<p>The <code>secretPrefix</code> property adds a prefix to the name of all Secrets created from the KafkaUser resource. For example, <code>secretPrefix: kafka-</code> would prefix all Secret names with <code>kafka-</code>. So a KafkaUser named <code>my-user</code> would create a Secret named <code>kafka-my-user</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example User Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    userOperator:
      watchedNamespace: my-user-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-storage-str"><a class="link" href="#assembly-storage-str">2.1.3. Configuring Kafka and ZooKeeper storage</a></h4>
<div class="paragraph _abstract">
<p>As stateful applications, Kafka and ZooKeeper store data on disk.
Strimzi supports three storage types for this data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ephemeral (Recommended for development only)</p>
</li>
<li>
<p>Persistent</p>
</li>
<li>
<p>JBOD (<strong>Kafka only</strong> not ZooKeeper)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When configuring a <code>Kafka</code> resource, you can specify the type of storage used by the Kafka broker and its corresponding ZooKeeper node. You configure the storage type using the <code>storage</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The storage type is configured in the <code>type</code> field.</p>
</div>
<div class="paragraph">
<p>Refer to the schema reference for more information on storage configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code> schema reference</a></p>
</li>
<li>
<p><a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code> schema reference</a></p>
</li>
<li>
<p><a href="#type-JbodStorage-reference"><code>JbodStorage</code> schema reference</a></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The storage type cannot be changed after a Kafka cluster is deployed.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="considerations-for-data-storage-str"><a class="link" href="#considerations-for-data-storage-str">Data storage considerations</a></h5>
<div class="paragraph _abstract">
<p>For Strimzi to work well, an efficient data storage infrastructure is essential.
We strongly recommend using block storage.
Strimzi is only tested for use with block storage.
File storage, such as NFS, is not tested and there is no guarantee it will work.</p>
</div>
<div class="paragraph">
<p>Choose one of the following options for your block storage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A cloud-based block storage solution, such as <a href="https://aws.amazon.com/ebs/" target="_blank" rel="noopener">Amazon Elastic Block Store (EBS)</a></p>
</li>
<li>
<p>Persistent storage using <a href="https://kubernetes.io/docs/concepts/storage/volumes/#local" target="_blank" rel="noopener">local persistent volumes</a></p>
</li>
<li>
<p>Storage Area Network (SAN) volumes accessed by a protocol such as <em>Fibre Channel</em> or <em>iSCSI</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi does not require Kubernetes raw block volumes.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="file_systems"><a class="link" href="#file_systems">File systems</a></h6>
<div class="paragraph">
<p>Kafka uses a file system for storing messages.
Strimzi is compatible with the XFS and ext4 file systems, which are commonly used with Kafka.
Consider the underlying architecture and requirements of your deployment when choosing and setting up your file system.</p>
</div>
<div class="paragraph">
<p>For more information, refer to <a href="https://kafka.apache.org/documentation/#filesystems" target="_blank" rel="noopener">Filesystem Selection</a> in the Kafka documentation.</p>
</div>
</div>
<div class="sect5">
<h6 id="disk_usage"><a class="link" href="#disk_usage">Disk usage</a></h6>
<div class="paragraph">
<p>Use separate disks for Apache Kafka and ZooKeeper.</p>
</div>
<div class="paragraph">
<p>Solid-state drives (SSDs), though not essential, can improve the performance of Kafka in large clusters where data is sent to and received from multiple topics asynchronously.
SSDs are particularly effective with ZooKeeper, which requires fast, low latency data access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You do not need to provision replicated storage because Kafka and ZooKeeper both have built-in data replication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-ephemeral-storage-str"><a class="link" href="#ref-ephemeral-storage-str">Ephemeral storage</a></h5>
<div class="paragraph _abstract">
<p>Ephemeral data storage is transient.
All pods on a node share a local ephemeral storage space.
Data is retained for as long as the pod that uses it is running.
The data is lost when a pod is deleted.
Although a pod can recover data in a highly available environment.</p>
</div>
<div class="paragraph">
<p>Because of its transient nature, ephemeral storage is only recommended for development and testing.</p>
</div>
<div class="paragraph">
<p>Ephemeral storage uses <code><a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener">emptyDir</a></code> volumes to store data.
An <code>emptyDir</code> volume is created when a pod is assigned to a node.
You can set the total amount of storage for the <code>emptyDir</code> using the <code>sizeLimit</code> property .</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Ephemeral storage is not suitable for single-node ZooKeeper clusters or Kafka topics with a replication factor of 1.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use ephemeral storage, you set the storage type configuration in the <code>Kafka</code> or <code>ZooKeeper</code> resource to <code>ephemeral</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example ephemeral storage configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: ephemeral
    # ...
  zookeeper:
    # ...
    storage:
      type: ephemeral
    # ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="mount_path_of_kafka_log_directories"><a class="link" href="#mount_path_of_kafka_log_directories">Mount path of Kafka log directories</a></h6>
<div class="paragraph">
<p>The ephemeral volume is used by Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/var/lib/kafka/data/kafka-log<em>IDX</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>IDX</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-persistent-storage-str"><a class="link" href="#ref-persistent-storage-str">Persistent storage</a></h5>
<div class="paragraph _abstract">
<p>Persistent data storage retains data in the event of system disruption.
For pods that use persistent data storage, data is persisted across pod failures and restarts.</p>
</div>
<div class="paragraph">
<p>A dynamic provisioning framework enables clusters to be created with persistent storage.
Pod configuration uses <a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/" target="_blank" rel="noopener">Persistent Volume Claims</a> (PVCs) to make storage requests on persistent volumes (PVs).
PVs are storage resources that represent a storage volume.
PVs are independent of the pods that use them.
The PVC requests the amount of storage required when a pod is being created.
The underlying storage infrastructure of the PV does not need to be understood.
If a PV matches the storage criteria, the PVC is bound to the PV.</p>
</div>
<div class="paragraph">
<p>Because of its permanent nature, persistent storage is recommended for production.</p>
</div>
<div class="paragraph">
<p>PVCs can request different types of persistent storage by specifying a <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">StorageClass</a>.
Storage classes define storage profiles and dynamically provision PVs.
If a storage class is not specified, the default storage class is used.
Persistent storage options might include SAN storage types or <a href="https://kubernetes.io/docs/concepts/storage/volumes/#local" target="_blank" rel="noopener">local persistent volumes</a>.</p>
</div>
<div class="paragraph">
<p>To use persistent storage, you set the storage type configuration in the <code>Kafka</code> or <code>ZooKeeper</code> resource to <code>persistent-claim</code>.</p>
</div>
<div class="paragraph">
<p>In the production environment, the following configuration is recommended:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka, configure <code>type: jbod</code>  with one or more <code>type: persistent-claim</code> volumes</p>
</li>
<li>
<p>For ZooKeeper, configure <code>type: persistent-claim</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Persistent storage also has the following configuration options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>id</code> (optional)</dt>
<dd>
<p>A storage identification number. This option is mandatory for storage volumes defined in a JBOD storage declaration.
Default is <code>0</code>.</p>
</dd>
<dt class="hdlist1"><code>size</code> (required)</dt>
<dd>
<p>The size of the persistent volume claim, for example, "1000Gi".</p>
</dd>
<dt class="hdlist1"><code>class</code> (optional)</dt>
<dd>
<p>The Kubernetes <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">StorageClass</a> to use for dynamic volume provisioning.
Storage <code>class</code> configuration includes parameters that describe the profile of a volume in detail.</p>
</dd>
<dt class="hdlist1"><code>selector</code> (optional)</dt>
<dd>
<p>Configuration to specify a specific PV.
Provides key:value pairs representing the labels of the volume selected.</p>
</dd>
<dt class="hdlist1"><code>deleteClaim</code> (optional)</dt>
<dd>
<p>Boolean value to specify whether the PVC is deleted when the cluster is uninstalled.
Default is <code>false</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Increasing the size of persistent volumes in an existing Strimzi cluster is only supported in Kubernetes versions that support persistent volume resizing. The persistent volume to be resized must use a storage class that supports volume expansion.
For other versions of Kubernetes and storage classes that do not support volume expansion, you must decide the necessary storage size before deploying the cluster.
Decreasing the size of existing persistent volumes is not possible.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example persistent storage configuration for Kafka and ZooKeeper</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 1
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 2
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    storage:
      type: persistent-claim
      size: 1000Gi
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not specify a storage class, the default is used.
The following example specifies a storage class.</p>
</div>
<div class="listingblock">
<div class="title">Example persistent storage configuration with specific storage class</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
storage:
  type: persistent-claim
  size: 1Gi
  class: my-storage-class
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use a <code>selector</code> to specify a labeled persistent volume that provides certain features, such as an SSD.</p>
</div>
<div class="listingblock">
<div class="title">Example persistent storage configuration with selector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
storage:
  type: persistent-claim
  size: 1Gi
  selector:
    hdd-type: ssd
  deleteClaim: true
# ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="storage_class_overrides"><a class="link" href="#storage_class_overrides">Storage class overrides</a></h6>
<div class="paragraph">
<p>Instead of using the default storage class, you can specify a different storage class for one or more Kafka brokers or ZooKeeper nodes.
This is useful, for example, when storage classes are restricted to different availability zones or data centers.
You can use the <code>overrides</code> field for this purpose.</p>
</div>
<div class="paragraph">
<p>In this example, the default storage class is named <code>my-storage-class</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example Strimzi cluster using storage class overrides</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  labels:
    app: my-cluster
  name: my-cluster
  namespace: myproject
spec:
  # ...
  kafka:
    replicas: 3
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
        class: my-storage-class
        overrides:
        - broker: 0
          class: my-storage-class-zone-1a
        - broker: 1
          class: my-storage-class-zone-1b
        - broker: 2
          class: my-storage-class-zone-1c
      # ...
  # ...
  zookeeper:
    replicas: 3
    storage:
      deleteClaim: true
      size: 100Gi
      type: persistent-claim
      class: my-storage-class
      overrides:
        - broker: 0
          class: my-storage-class-zone-1a
        - broker: 1
          class: my-storage-class-zone-1b
        - broker: 2
          class: my-storage-class-zone-1c
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the configured <code>overrides</code> property, the volumes use the following storage classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The persistent volumes of ZooKeeper node 0 use <code>my-storage-class-zone-1a</code>.</p>
</li>
<li>
<p>The persistent volumes of ZooKeeper node 1 use <code>my-storage-class-zone-1b</code>.</p>
</li>
<li>
<p>The persistent volumes of ZooKeeepr node 2 use <code>my-storage-class-zone-1c</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 0 use <code>my-storage-class-zone-1a</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 1 use <code>my-storage-class-zone-1b</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 2 use <code>my-storage-class-zone-1c</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>overrides</code> property is currently used only to override storage class configurations.
Overrides for other storage configuration properties is not currently supported.
Other storage configuration properties are currently not supported.</p>
</div>
</div>
<div class="sect5">
<h6 id="ref-persistent-storage-pvc-str"><a class="link" href="#ref-persistent-storage-pvc-str">PVC resources for persistent storage</a></h6>
<div class="paragraph">
<p>When persistent storage is used, it creates PVCs with the following names:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>PVC for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>PVC for the volume used for storing data for the ZooKeeper node pod <code><em>idx</em></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="mount_path_of_kafka_log_directories_2"><a class="link" href="#mount_path_of_kafka_log_directories_2">Mount path of Kafka log directories</a></h6>
<div class="paragraph">
<p>The persistent volume is used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/var/lib/kafka/data/kafka-log<em>IDX</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>IDX</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-resizing-persistent-volumes-str"><a class="link" href="#proc-resizing-persistent-volumes-str">Resizing persistent volumes</a></h5>
<div class="paragraph _abstract">
<p>You can provision increased storage capacity by increasing the size of the persistent volumes used by an existing Strimzi cluster.
Resizing persistent volumes is supported in clusters that use either a single persistent volume or multiple persistent volumes in a JBOD storage configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can increase but not decrease the size of persistent volumes.
Decreasing the size of persistent volumes is not currently supported in Kubernetes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster with support for volume resizing.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster using persistent volumes created using a storage class that supports volume expansion.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>Kafka</code> resource for your cluster.</p>
<div class="paragraph">
<p>Change the <code>size</code> property to increase the size of the persistent volume allocated to a Kafka cluster, a ZooKeeper cluster, or both.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>For Kafka clusters, update the <code>size</code> property under <code>spec.kafka.storage</code>.</p>
</li>
<li>
<p>For ZooKeeper clusters, update the <code>size</code> property under <code>spec.zookeeper.storage</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Kafka configuration to increase the volume size to <code>2000Gi</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: persistent-claim
      size: 2000Gi
      class: my-storage-class
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes increases the capacity of the selected persistent volumes in response to a request from the Cluster Operator.
When the resizing is complete, the Cluster Operator restarts all pods that use the resized persistent volumes.
This happens automatically.</p>
</div>
</li>
<li>
<p>Verify that the storage capacity has increased for the relevant pods on the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get pv</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Kafka broker pods with increased storage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME               CAPACITY   CLAIM
pvc-0ca459ce-...   2000Gi     my-project/data-my-cluster-kafka-2
pvc-6e1810be-...   2000Gi     my-project/data-my-cluster-kafka-0
pvc-82dc78c9-...   2000Gi     my-project/data-my-cluster-kafka-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output shows the names of each PVC associated with a broker pod.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about resizing persistent volumes in Kubernetes, see <a href="https://kubernetes.io/blog/2018/07/12/resizing-persistent-volumes-using-kubernetes/" target="_blank" rel="noopener">Resizing Persistent Volumes using Kubernetes</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ref-jbod-storage-str"><a class="link" href="#ref-jbod-storage-str">JBOD storage</a></h5>
<div class="paragraph _abstract">
<p>You can configure Strimzi to use JBOD, a data storage configuration of multiple disks or volumes.
JBOD is one approach to providing increased data storage for Kafka brokers.
It can also improve performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
JBOD storage is supported for <strong>Kafka only</strong> not ZooKeeper.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A JBOD configuration is described by one or more volumes, each of which can be either <a href="#ref-ephemeral-storage-str">ephemeral</a> or <a href="#ref-persistent-storage-str">persistent</a>. The rules and constraints for JBOD volume declarations are the same as those for ephemeral and persistent storage. For example, you cannot decrease the size of a persistent storage volume after it has been provisioned, or you cannot change the value of <code>sizeLimit</code> when the type is <code>ephemeral</code>.</p>
</div>
<div class="paragraph">
<p>To use JBOD storage, you set the storage type configuration in the <code>Kafka</code> resource to <code>jbod</code>.
The <code>volumes</code> property allows you to describe the disks that make up your JBOD storage array or configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example JBOD storage configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
storage:
  type: jbod
  volumes:
  - id: 0
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
  - id: 1
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The IDs cannot be changed once the JBOD volumes are created.
You can add or remove volumes from the JBOD configuration.</p>
</div>
<div class="sect5">
<h6 id="ref-jbod-storage-pvc-str"><a class="link" href="#ref-jbod-storage-pvc-str">PVC resource for JBOD storage</a></h6>
<div class="paragraph">
<p>When persistent storage is used to declare JBOD volumes, it creates a PVC with the following name:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>PVC for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>.
The <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="mount_path_of_kafka_log_directories_3"><a class="link" href="#mount_path_of_kafka_log_directories_3">Mount path of Kafka log directories</a></h6>
<div class="paragraph">
<p>The JBOD volumes are used by Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">/var/lib/kafka/data-<em>id</em>/kafka-log<em>idx</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod <code><em>idx</em></code>. For example <code>/var/lib/kafka/data-0/kafka-log0</code>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-adding-volumes-to-jbod-storage-str"><a class="link" href="#proc-adding-volumes-to-jbod-storage-str">Adding volumes to JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to add volumes to a Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When adding a new volume under an <code>id</code> which was already used in the past and removed, you have to make sure that the previously used <code>PersistentVolumeClaims</code> have been deleted.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Add the new volumes to the <code>volumes</code> array.
For example, add the new volume with id <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 1
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 2
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create new topics or reassign existing partitions to the new disks.</p>
</li>
</ol>
</div>
<div class="paragraph _additional-resources">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-str">Partition reassignment tool</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-removing-volumes-from-jbod-storage-str"><a class="link" href="#proc-removing-volumes-from-jbod-storage-str">Removing volumes from JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to remove volumes from Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.
The JBOD storage always has to contain at least one volume.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
To avoid data loss, you have to move all partitions before removing the volumes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage with two or more volumes</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Reassign all partitions from the disks which are you going to remove.
Any data in partitions still assigned to the disks which are going to be removed might be lost.</p>
</li>
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Remove one or more volumes from the <code>volumes</code> array.
For example, remove the volumes with ids <code>1</code> and <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph _additional-resources">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-str">Partition reassignment tool</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scaling-clusters-str"><a class="link" href="#scaling-clusters-str">2.1.4. Scaling clusters</a></h4>
<div class="paragraph _abstract">
<p>Scale Kafka clusters by adding or removing brokers.
If a cluster already has topics defined, you also have to reassign partitions.</p>
</div>
<div class="paragraph">
<p>Use the <code>kafka-reassign-partitions.sh</code> tool to reassign partitions.
The tool uses a reassignment JSON file that specifies the topics to reassign.</p>
</div>
<div class="paragraph">
<p>You can generate a reassignment JSON file or create a file manually if you want to move specific partitions.</p>
</div>
<div class="sect4">
<h5 id="con-scaling-kafka-clusters-str"><a class="link" href="#con-scaling-kafka-clusters-str">Broker scaling configuration</a></h5>
<div class="paragraph _abstract">
<p>You configure the <code>Kafka.spec.kafka.replicas</code> configuration to add or reduce the number of brokers.</p>
</div>
<h6 id="broker_addition" class="discrete">Broker addition</h6>
<div class="paragraph">
<p>The primary way of increasing throughput for a topic is to increase the number of partitions for that topic.
That works because the extra partitions allow the load of the topic to be shared between the different brokers in the cluster.
However, in situations where every broker is constrained by a particular resource (typically I/O) using more partitions will not result in increased throughput.
Instead, you need to add brokers to the cluster.</p>
</div>
<div class="paragraph">
<p>When you add an extra broker to the cluster, Kafka does not assign any partitions to it automatically.
You must decide which partitions to reassign from the existing brokers to the new broker.</p>
</div>
<div class="paragraph">
<p>Once the partitions have been redistributed between all the brokers, the resource utilization of each broker is reduced.</p>
</div>
<h6 id="broker_removal" class="discrete">Broker removal</h6>
<div class="paragraph">
<p>If you are using <code>StatefulSets</code> to manage broker pods, you cannot remove <em>any</em> pod from the cluster.
You can only remove one or more of the highest numbered pods from the cluster.
For example, in a cluster of 12 brokers the pods are named <code><em>cluster-name</em>-kafka-0</code> up to <code><em>cluster-name</em>-kafka-11</code>.
If you decide to scale down by one broker, the <code><em>cluster-name</em>-kafka-11</code> will be removed.</p>
</div>
<div class="paragraph">
<p>Before you remove a broker from a cluster, ensure that it is not assigned to any partitions.
You should also decide which of the remaining brokers will be responsible for each of the partitions on the broker being decommissioned.
Once the broker has no assigned partitions, you can scale the cluster down safely.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-partition-reassignment-str"><a class="link" href="#con-partition-reassignment-str">Partition reassignment tool</a></h5>
<div class="paragraph _abstract">
<p>The Topic Operator does not currently support reassigning replicas to different brokers, so it is necessary to connect directly to broker pods to reassign replicas to brokers.</p>
</div>
<div class="paragraph">
<p>Within a broker pod, the <code>kafka-reassign-partitions.sh</code> tool allows you to reassign partitions to different brokers.</p>
</div>
<div class="paragraph">
<p>It has three different modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--generate</code></dt>
<dd>
<p>Takes a set of topics and brokers and generates a <em>reassignment JSON file</em> which will result in the partitions of those topics being assigned to those brokers.
Because this operates on whole topics, it cannot be used when you only want to reassign some partitions of some topics.</p>
</dd>
<dt class="hdlist1"><code>--execute</code></dt>
<dd>
<p>Takes a <em>reassignment JSON file</em> and applies it to the partitions and brokers in the cluster.
Brokers that gain partitions as a result become followers of the partition leader.
For a given partition, once the new broker has caught up and joined the ISR (in-sync replicas) the old broker will stop being a follower and will delete its replica.</p>
</dd>
<dt class="hdlist1"><code>--verify</code></dt>
<dd>
<p>Using the same <em>reassignment JSON file</em> as the <code>--execute</code> step, <code>--verify</code> checks whether all the partitions in the file have been moved to their intended brokers.
If the reassignment is complete, <code>--verify</code> also removes any traffic throttles (<code>--throttle</code>) that are in effect.
Unless removed, throttles will continue to affect the cluster even after the reassignment has finished.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is only possible to have one reassignment running in a cluster at any given time, and it is not possible to cancel a running reassignment.
If you need to cancel a reassignment, wait for it to complete and then perform another reassignment to revert the effects of the first reassignment.
The <code>kafka-reassign-partitions.sh</code> will print the reassignment JSON for this reversion as part of its output.
Very large reassignments should be broken down into a number of smaller reassignments in case there is a need to stop in-progress reassignment.</p>
</div>
<div class="sect5">
<h6 id="partition_reassignment_json_file"><a class="link" href="#partition_reassignment_json_file">Partition reassignment JSON file</a></h6>
<div class="paragraph">
<p>The <em>reassignment JSON file</em> has a specific structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "version": 1,
  "partitions": [
    <em>&lt;PartitionObjects&gt;</em>
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>&lt;PartitionObjects&gt;</em> is a comma-separated list of objects like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although Kafka also supports a <code>"log_dirs"</code> property this should not be used in Strimzi.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example reassignment JSON file that assigns partition <code>4</code> of topic <code>topic-a</code> to brokers <code>2</code>, <code>4</code> and <code>7</code>, and partition <code>2</code> of topic <code>topic-b</code> to brokers <code>1</code>, <code>5</code> and <code>7</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example partition reassignment file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "version": 1,
  "partitions": [
    {
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7]
    },
    {
      "topic": "topic-b",
      "partition": 2,
      "replicas": [1,5,7]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Partitions not included in the JSON are not changed.</p>
</div>
</div>
<div class="sect5">
<h6 id="partition_reassignment_between_jbod_volumes"><a class="link" href="#partition_reassignment_between_jbod_volumes">Partition reassignment between JBOD volumes</a></h6>
<div class="paragraph">
<p>When using JBOD storage in your Kafka cluster, you can choose to reassign the partitions between specific volumes and their log directories (each volume has a single log directory).
To reassign a partition to a specific volume, add the <code>log_dirs</code> option to <em>&lt;PartitionObjects&gt;</em> in the reassignment JSON file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ],
  "log_dirs": [ <em>&lt;AssignedLogDirs&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>log_dirs</code> object should contain the same number of log directories as the number of replicas specified in the <code>replicas</code> object.
The value should be either an absolute path to the log directory, or the <code>any</code> keyword.</p>
</div>
<div class="listingblock">
<div class="title">Example partition reassignment file specifying log directories</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7].
      "log_dirs": [ "/var/lib/kafka/data-0/kafka-log2", "/var/lib/kafka/data-0/kafka-log4", "/var/lib/kafka/data-0/kafka-log7" ]
}</code></pre>
</div>
</div>
<h5 id="partition_reassignment_throttles" class="discrete">Partition reassignment throttles</h5>
<div class="paragraph">
<p>Partition reassignment can be a slow process because it involves transferring large amounts of data between brokers.
To avoid a detrimental impact on clients, you can throttle the reassignment process.
Use the <code>--throttle</code> parameter with the <code>kafka-reassign-partitions.sh</code> tool to throttle a reassignment.
You specify a maximum threshold in bytes per second for the movement of partitions between brokers.
For example, <code>--throttle 5000000</code> sets a maximum threshold for moving partitions of 50 MBps.</p>
</div>
<div class="paragraph">
<p>Throttling might cause the reassignment to take longer to complete.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the throttle is too low, the newly assigned brokers will not be able to keep up with records being published and the reassignment will never complete.</p>
</li>
<li>
<p>If the throttle is too high, clients will be impacted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, for producers, this could manifest as higher than normal latency waiting for acknowledgment.
For consumers, this could manifest as a drop in throughput caused by higher latency between polls.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-generating-reassignment-json-files-str"><a class="link" href="#proc-generating-reassignment-json-files-str">Generating reassignment JSON files</a></h5>
<div class="paragraph _abstract">
<p>This procedure describes how to generate a reassignment JSON file.
Use the reassignment file with the <code>kafka-reassign-partitions.sh</code> tool to reassign partitions after scaling a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>You run the tool from an interactive pod container connected to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The steps describe a secure reassignment process that uses mTLS.
You&#8217;ll need a Kafka cluster that uses TLS encryption and mTLS authentication.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll need the following to establish a connection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The cluster CA certificate and password generated by the Cluster Operator when the Kafka cluster is created</p>
</li>
<li>
<p>The user CA certificate and password generated by the User Operator when a user is created for client access to the Kafka cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this procedure, the CA certificates and corresponding passwords are extracted from the cluster and user secrets that contain them in PKCS #12 (<code>.p12</code> and <code>.password</code>) format.
The passwords allow access to the <code>.p12</code> stores that contain the certificates.
You use the <code>.p12</code> stores to specify a truststore and keystore to authenticate connection to the Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a running Cluster Operator.</p>
</li>
<li>
<p>You have a running Kafka cluster based on a <code>Kafka</code> resource configured with internal TLS encryption and mTLS authentication.</p>
<div class="listingblock">
<div class="title">Kafka configuration with TLS encryption and mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    listeners:
      # ...
      - name: tls
        port: 9093
        type: internal
        tls: true <b class="conum">(1)</b>
        authentication:
          type: tls <b class="conum">(2)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Enables TLS encryption for the internal listener.</p>
</li>
<li>
<p>Listener authentication mechanism specified as mutual <code>tls</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The running Kafka cluster contains a set of topics and partitions to reassign.</p>
<div class="listingblock">
<div class="title">Example topic configuration for <code>my-topic</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10
  replicas: 3
  config:
    retention.ms: 7200000
    segment.bytes: 1073741824
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>You have a <code>KafkaUser</code> configured with ACL rules that specify permission to produce and consume topics from the Kafka brokers.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example Kafka user configuration with ACL rules to allow operations on <code>my-topic</code> and <code>my-cluster</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication: <b class="conum">(1)</b>
    type: tls
  authorization:
    type: simple <b class="conum">(2)</b>
    acls:
      # access to the topic
      - resource:
          type: topic
          name: my-topic
        operations:
          - Create
          - Describe
          - Read
          - AlterConfigs
        host: "*"
      # access to the cluster
      - resource:
          type: cluster
        operations:
          - Alter
          - AlterConfigs
        host: "*"
      # ...
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>User authentication mechanism defined as mutual <code>tls</code>.</p>
</li>
<li>
<p>Simple authorization and accompanying list of ACL rules.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate and password from the <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> secret of the Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;cluster_name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.p12}' | base64 -d &gt; ca.p12</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;cluster_name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.password}' | base64 -d &gt; ca.password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;cluster_name&gt;</em> with the name of the Kafka cluster.
When you deploy Kafka using the <code>Kafka</code> resource, a secret with the cluster CA certificate is created with the Kafka cluster name (<code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code>).
For example, <code>my-cluster-cluster-ca-cert</code>.</p>
</div>
</li>
<li>
<p>Run a new interactive pod container using the Strimzi Kafka image to connect to a running Kafka broker.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl run --restart=Never --image=quay.io/strimzi/kafka:latest-kafka-3.3.2 <em>&lt;interactive_pod_name&gt;</em> -- /bin/sh -c "sleep 3600"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;interactive_pod_name&gt;</em> with the name of the pod.</p>
</div>
</li>
<li>
<p>Copy the cluster CA certificate to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp ca.p12 <em>&lt;interactive_pod_name&gt;</em>:/tmp</code></pre>
</div>
</div>
</li>
<li>
<p>Extract the user CA certificate and password from the secret of the Kafka user that has permission to access the Kafka brokers.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;kafka_user&gt;</em> -o jsonpath='{.data.user\.p12}' | base64 -d &gt; user.p12</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;kafka_user&gt;</em> -o jsonpath='{.data.user\.password}' | base64 -d &gt; user.password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;kafka_user&gt;</em> with the name of the Kafka user.
When you create a Kafka user using the <code>KafkaUser</code> resource, a secret with the user CA certificate is created with the Kafka user name.
For example, <code>my-user</code>.</p>
</div>
</li>
<li>
<p>Copy the user CA certificate to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp user.p12 <em>&lt;interactive_pod_name&gt;</em>:/tmp</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CA certificates allow the interactive pod container to connect to the Kafka broker using TLS.</p>
</div>
</li>
<li>
<p>Create a <code>config.properties</code> file to specify the truststore and keystore used to authenticate connection to the Kafka cluster.</p>
<div class="paragraph">
<p>Use the certificates and passwords you extracted in the previous steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">bootstrap.servers=<em>&lt;kafka_cluster_name&gt;</em>-kafka-bootstrap:9093 <b class="conum">(1)</b>
security.protocol=SSL <b class="conum">(2)</b>
ssl.truststore.location=/tmp/ca.p12 <b class="conum">(3)</b>
ssl.truststore.password=<em>&lt;truststore_password&gt;</em> <b class="conum">(4)</b>
ssl.keystore.location=/tmp/user.p12 <b class="conum">(5)</b>
ssl.keystore.password=<em>&lt;keystore_password&gt;</em> <b class="conum">(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The bootstrap server address to connect to the Kafka cluster. Use your own Kafka cluster name to replace <em>&lt;kafka_cluster_name&gt;</em>.</p>
</li>
<li>
<p>The security protocol option when using TLS for encryption.</p>
</li>
<li>
<p>The truststore location contains the public key certificate (<code>ca.p12</code>) for the Kafka cluster.</p>
</li>
<li>
<p>The password (<code>ca.password</code>) for accessing the truststore.</p>
</li>
<li>
<p>The keystore location contains the public key certificate (<code>user.p12</code>) for the Kafka user.</p>
</li>
<li>
<p>The password (<code>user.password</code>) for accessing the keystore.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Copy the <code>config.properties</code> file to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp config.properties <em>&lt;interactive_pod_name&gt;</em>:/tmp/config.properties</code></pre>
</div>
</div>
</li>
<li>
<p>Prepare a JSON file named <code>topics.json</code> that specifies the topics to move.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Specify topic names as a comma-separated list.</p>
</div>
<div class="listingblock">
<div class="title">Example JSON file to reassign all the partitions of <code>topic-a</code> and <code>topic-b</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "version": 1,
  "topics": [
    { "topic": "topic-a"},
    { "topic": "topic-b"}
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Copy the <code><em>topics.json</em></code> file to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp topics.json <em>&lt;interactive_pod_name&gt;</em>:/tmp/topics.json</code></pre>
</div>
</div>
</li>
<li>
<p>Start a shell process in the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl exec -n <em>&lt;namespace&gt;</em> -ti <em>&lt;interactive_pod_name&gt;</em> /bin/bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;namespace&gt;</em> with the Kubernetes namespace where the pod is running.</p>
</div>
</li>
<li>
<p>Use the <code>kafka-reassign-partitions.sh</code> command to generate the reassignment JSON.</p>
<div class="listingblock">
<div class="title">Example command to move all the partitions of <code>topic-a</code> and <code>topic-b</code> to brokers <code>0</code>, <code>1</code> and <code>2</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server my-cluster-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --topics-to-move-json-file /tmp/topics.json \
  --broker-list 0,1,2 \
  --generate</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-config-kafka-str">Configuring Kafka</a></p>
</li>
<li>
<p><a href="#proc-configuring-kafka-topic-str">Configuring Kafka topics</a></p>
</li>
<li>
<p><a href="#proc-configuring-kafka-user-str">Configuring Kafka users</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-up-a-kafka-cluster-str"><a class="link" href="#proc-scaling-up-a-kafka-cluster-str">Scaling up a Kafka cluster</a></h5>
<div class="paragraph _abstract">
<p>Use a reassignment file to increase the number of brokers in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The reassignment file should describe how partitions are reassigned to brokers in the enlarged Kafka cluster.</p>
</div>
<div class="paragraph">
<p>This procedure describes a secure scaling process that uses TLS.
You&#8217;ll need a Kafka cluster that uses TLS encryption and mTLS authentication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a running Kafka cluster based on a <code>Kafka</code> resource configured with internal TLS encryption and mTLS authentication.</p>
</li>
<li>
<p>You have generated a reassignment JSON file named <code>reassignment.json</code>.</p>
</li>
<li>
<p>You are running an interactive pod container that is connected to the running Kafka broker.</p>
</li>
<li>
<p>You are connected as a <code>KafkaUser</code> configured with ACL rules that specify permission to manage the Kafka cluster and its topics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#proc-generating-reassignment-json-files-str">Generating reassignment JSON files</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add as many new brokers as you need by increasing the <code>Kafka.spec.kafka.replicas</code> configuration option.</p>
</li>
<li>
<p>Verify that the new broker pods have started.</p>
</li>
<li>
<p>If you haven&#8217;t done so, <a href="#proc-generating-reassignment-json-files-str">run an interactive pod container to generate a reassignment JSON file</a> named <code>reassignment.json</code>.</p>
</li>
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp reassignment.json <em>&lt;interactive_pod_name&gt;</em>:/tmp/reassignment.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;interactive_pod_name&gt;</em> with the name of the pod.</p>
</div>
</li>
<li>
<p>Start a shell process in the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl exec -n <em>&lt;namespace&gt;</em> -ti <em>&lt;interactive_pod_name&gt;</em> /bin/bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;namespace&gt;</em> with the Kubernetes namespace where the pod is running.</p>
</div>
</li>
<li>
<p>Run the partition reassignment using the <code>kafka-reassign-partitions.sh</code> script from the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
 <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
 --command-config /tmp/config.properties \
 --reassignment-json-file /tmp/reassignment.json \
 --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;cluster_name&gt;</em> with the name of your Kafka cluster.
For example, <code>my-cluster-kafka-bootstrap:9093</code></p>
</div>
<div class="paragraph">
<p>If you are going to throttle replication, you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
<div class="paragraph">
<p>If you need to change the throttle during reassignment, you can use the same command with a different throttled rate. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods.
This is the same command as the previous step, but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reassignment has finished when the <code>--verify</code> command reports that each of the partitions being moved has completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.</p>
</div>
</li>
<li>
<p>You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-down-a-kafka-cluster-str"><a class="link" href="#proc-scaling-down-a-kafka-cluster-str">Scaling down a Kafka cluster</a></h5>
<div class="paragraph _abstract">
<p>Use a reassignment file to decrease the number of brokers in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The reassignment file must describe how partitions are reassigned to the remaining brokers in the Kafka cluster.
Brokers in the highest numbered pods are removed first.</p>
</div>
<div class="paragraph">
<p>This procedure describes a secure scaling process that uses TLS.
You&#8217;ll need a Kafka cluster that uses TLS encryption and mTLS authentication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a running Kafka cluster based on a <code>Kafka</code> resource configured with internal TLS encryption and mTLS authentication.</p>
</li>
<li>
<p>You have generated a reassignment JSON file named <code>reassignment.json</code>.</p>
</li>
<li>
<p>You are running an interactive pod container that is connected to the running Kafka broker.</p>
</li>
<li>
<p>You are connected as a <code>KafkaUser</code> configured with ACL rules that specify permission to manage the Kafka cluster and its topics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="#proc-generating-reassignment-json-files-str">Generating reassignment JSON files</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If you haven&#8217;t done so, <a href="#proc-generating-reassignment-json-files-str">run an interactive pod container to generate a reassignment JSON file</a> named <code>reassignment.json</code>.</p>
</li>
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl cp reassignment.json <em>&lt;interactive_pod_name&gt;</em>:/tmp/reassignment.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;interactive_pod_name&gt;</em> with the name of the pod.</p>
</div>
</li>
<li>
<p>Start a shell process in the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl exec -n <em>&lt;namespace&gt;</em> -ti <em>&lt;interactive_pod_name&gt;</em> /bin/bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;namespace&gt;</em> with the Kubernetes namespace where the pod is running.</p>
</div>
</li>
<li>
<p>Run the partition reassignment using the <code>kafka-reassign-partitions.sh</code> script from the interactive pod container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
 <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
 --command-config /tmp/config.properties \
 --reassignment-json-file /tmp/reassignment.json \
 --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;cluster_name&gt;</em> with the name of your Kafka cluster.
For example, <code>my-cluster-kafka-bootstrap:9093</code></p>
</div>
<div class="paragraph">
<p>If you are going to throttle replication, you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
<div class="paragraph">
<p>If you need to change the throttle during reassignment, you can use the same command with a different throttled rate. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods.
This is the same command as the previous step, but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-reassign-partitions.sh --bootstrap-server
  <em>&lt;cluster_name&gt;</em>-kafka-bootstrap:9093 \
  --command-config /tmp/config.properties \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reassignment has finished when the <code>--verify</code> command reports that each of the partitions being moved has completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.</p>
</div>
</li>
<li>
<p>You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
<li>
<p>When all the partition reassignments have finished, the brokers being removed should not have responsibility for any of the partitions in the cluster.
You can verify this by checking that the broker&#8217;s data log directory does not contain any live partition logs.
If the log directory on the broker contains a directory that does not match the extended regular expression <code>[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$</code>, the broker still has live partitions and should not be stopped.</p>
<div class="paragraph">
<p>You can check this by executing the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  /bin/bash -c \
  "ls -l /var/lib/kafka/kafka-log_&lt;n&gt;_ | grep -E '^d' | grep -vE '[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>n</em> is the number of the pods being deleted.</p>
</div>
<div class="paragraph">
<p>If the above command prints any output then the broker still has live partitions.
In this case, either the reassignment has not finished or the reassignment JSON file was incorrect.</p>
</div>
</li>
<li>
<p>When you have confirmed that the broker has no live partitions, you can edit the <code>Kafka.spec.kafka.replicas</code> property of your <code>Kafka</code> resource to reduce the number of brokers.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jmxtrans-str"><a class="link" href="#assembly-jmxtrans-str">2.1.5. Retrieving JMX metrics with JmxTrans</a></h4>
<div class="paragraph">
<p><a href="https://github.com/jmxtrans/jmxtrans" target="_blank" rel="noopener">JmxTrans</a> is a tool for retrieving JMX metrics data from Java processes and pushing that data, in various formats, to remote sinks inside or outside the cluster.
JmxTrans can communicate with a secure JMX port.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Support for JmxTrans in Strimzi is deprecated.
It is currently planned to be removed in Strimzi 0.35.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JmxTrans reads JMX metrics data from secure or insecure Kafka brokers and pushes the data to remote sinks in various data formats.
For example, JmxTrans can obtain JMX metrics about the request rate of each Kafka broker&#8217;s network and then push the data to a Logstash database outside the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>For more information about JmxTrans, see the <a href="https://github.com/jmxtrans/jmxtrans" target="_blank" rel="noopener">JmxTrans GitHub</a>.</p>
</div>
<div class="sect4">
<h5 id="proc-jmxtrans-deployment-str"><a class="link" href="#proc-jmxtrans-deployment-str">Configuring a JmxTrans deployment</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kubernetes cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure a JmxTrans deployment by using the <code>Kafka.spec.jmxTrans</code> property.
A JmxTrans deployment can read from a secure or insecure Kafka broker.
To configure a JmxTrans deployment, define the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.jmxTrans.outputDefinitions</code></p>
</li>
<li>
<p><code>Kafka.spec.jmxTrans.kafkaQueries</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on these properties, see the <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code> schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To use JMXTrans, <a href="#proc-config-kafka-str"><code>jmxOptions</code> must be configured on the Kafka broker</a>.
</td>
</tr>
</table>
</div>
<h6 id="configuring_jmxtrans_output_definitions" class="discrete">Configuring JmxTrans output definitions</h6>
<div class="paragraph">
<p>Output definitions specify where JMX metrics are pushed to, and in which data format.
For information about supported data formats, see <a href="https://github.com/jmxtrans/jmxtrans/wiki/OutputWriters" target="_blank" rel="noopener">Data formats</a>.
How many seconds JmxTrans agent waits for before pushing new data can be configured through the <code>flushDelay</code> property.
The <code>host</code> and <code>port</code> properties define the target host address and target port the data is pushed to.
The <code>name</code> property is a required property that is referenced by the <code>Kafka.spec.jmxTrans.kafkaQueries</code> property.</p>
</div>
<div class="paragraph">
<p>Here is an example configuration pushing JMX data in the Graphite format every 5 seconds to a Logstash database on http://myLogstash:9999, and another pushing to <code>standardOut</code> (standard output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  jmxTrans:
    outputDefinitions:
      - outputType: "com.googlecode.jmxtrans.model.output.GraphiteWriter"
        host: "http://myLogstash"
        port: 9999
        flushDelay: 5
        name: "logstash"
      - outputType: "com.googlecode.jmxtrans.model.output.StdOutWriter"
        name: "standardOut"
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<h6 id="configuring_jmxtrans_queries" class="discrete">Configuring JmxTrans queries</h6>
<div class="paragraph">
<p>JmxTrans queries specify what JMX metrics are read from the Kafka brokers.
Currently JmxTrans queries can only be sent to the Kafka Brokers.
Configure the <code>targetMBean</code> property to specify which target MBean on the Kafka broker is addressed.
Configuring the <code>attributes</code> property specifies which MBean attribute is read as JMX metrics from the target MBean.
JmxTrans supports wildcards to read from target MBeans, and filter by specifying the <code>typenames</code>.
The <code>outputs</code> property defines where the metrics are pushed to by specifying the name of the output definitions.</p>
</div>
<div class="paragraph">
<p>The following JmxTrans deployment reads from all MBeans that match the pattern <code>kafka.server:type=BrokerTopicMetrics,name=*</code> and have <code>name</code> in the target MBean&#8217;s name.
From those Mbeans, it obtains JMX metrics about the <code>Count</code> attribute and pushes the metrics to standard output as defined by <code>outputs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  jmxTrans:
    kafkaQueries:
      - targetMBean: "kafka.server:type=BrokerTopicMetrics,*"
        typeNames: ["name"]
        attributes:  ["Count"]
        outputs: ["standardOut"]
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-maintenance-time-windows-str"><a class="link" href="#assembly-maintenance-time-windows-str">2.1.6. Maintenance time windows for rolling updates</a></h4>
<div class="paragraph">
<p>Maintenance time windows allow you to schedule certain rolling updates of your Kafka and ZooKeeper clusters to start at a convenient time.</p>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-windows-overview-str"><a class="link" href="#con-maintenance-time-windows-overview-str">Maintenance time windows overview</a></h5>
<div class="paragraph">
<p>In most cases, the Cluster Operator only updates your Kafka or ZooKeeper clusters in response to changes to the corresponding <code>Kafka</code> resource.
This enables you to plan when to apply changes to a <code>Kafka</code> resource to minimize the impact on Kafka client applications.</p>
</div>
<div class="paragraph">
<p>However, some updates to your Kafka and ZooKeeper clusters can happen without any corresponding change to the <code>Kafka</code> resource.
For example, the Cluster Operator will need to perform a rolling restart if a CA (certificate authority) certificate that it manages is close to expiry.</p>
</div>
<div class="paragraph">
<p>While a rolling restart of the pods should not affect <em>availability</em> of the service (assuming correct broker and topic configurations), it could affect <em>performance</em> of the Kafka client applications.
Maintenance time windows allow you to schedule such spontaneous rolling updates of your Kafka and ZooKeeper clusters to start at a convenient time.
If maintenance time windows are not configured for a cluster then it is possible that such spontaneous rolling updates will happen at an inconvenient time, such as during a predictable period of high load.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-window-definition-str"><a class="link" href="#con-maintenance-time-window-definition-str">Maintenance time window definition</a></h5>
<div class="paragraph">
<p>You configure maintenance time windows by entering an array of strings in the <code>Kafka.spec.maintenanceTimeWindows</code> property.
Each string is a <a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html" target="_blank" rel="noopener">cron expression</a> interpreted as being in UTC (Coordinated Universal Time, which for practical purposes is the same as Greenwich Mean Time).</p>
</div>
<div class="paragraph">
<p>The following example configures a single maintenance time window that starts at midnight and ends at 01:59am (UTC), on Sundays, Mondays, Tuesdays, Wednesdays, and Thursdays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
maintenanceTimeWindows:
  - "* * 0-1 ? * SUN,MON,TUE,WED,THU *"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, maintenance windows should be set in conjunction with the <code>Kafka.spec.clusterCa.renewalDays</code> and <code>Kafka.spec.clientsCa.renewalDays</code> properties of the <code>Kafka</code> resource, to ensure that the necessary CA certificate renewal can be completed in the configured maintenance time windows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi does not schedule maintenance operations exactly according to the given windows. Instead, for each reconciliation, it checks whether a maintenance window is currently "open".
This means that the start of maintenance operations within a given time window can be delayed by up to the Cluster Operator reconciliation interval.
Maintenance time windows must therefore be at least this long.
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the Cluster Operator configuration, see <a href="#ref-operator-cluster-str">Configuring the Cluster Operator with environment variables</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-maintenance-time-windows-str"><a class="link" href="#proc-configuring-maintenance-time-windows-str">Configuring a maintenance time window</a></h5>
<div class="paragraph">
<p>You can configure a maintenance time window for rolling updates triggered by supported processes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add or edit the <code>maintenanceTimeWindows</code> property in the <code>Kafka</code> resource.
For example to allow maintenance between 0800 and 1059 and between 1400 and 1559 you would set the <code>maintenanceTimeWindows</code> as shown below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  maintenanceTimeWindows:
    - "* * 8-10 * * ?"
    - "* * 14-15 * * ?"</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#proc-manual-rolling-update-statefulset-str" target="_blank" rel="noopener">Performing a rolling update using a pod management annotation</a></p>
</li>
<li>
<p><a href="./deploying.html#proc-manual-rolling-update-pods-str" target="_blank" rel="noopener">Performing a rolling update using a pod annotation</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-connnecting-to-zookeeper-str"><a class="link" href="#proc-connnecting-to-zookeeper-str">2.1.7. Connecting to ZooKeeper from a terminal</a></h4>
<div class="paragraph">
<p>Most Kafka CLI tools can connect directly to Kafka, so under normal circumstances you should not need to connect to ZooKeeper.
ZooKeeper services are secured with encryption and authentication and are not intended to be used by external applications that are not part of Strimzi.</p>
</div>
<div class="paragraph">
<p>However, if you want to use Kafka CLI tools that require a connection to ZooKeeper, you can use a terminal inside a ZooKeeper container and connect to <code>localhost:12181</code> as the ZooKeeper address.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>A Kafka cluster is running.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the terminal using the Kubernetes console or run the <code>exec</code> command from your CLI.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl exec -ti <em>my-cluster</em>-zookeeper-0 -- bin/kafka-topics.sh --list --zookeeper localhost:12181</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to use <code>localhost:12181</code>.</p>
</div>
<div class="paragraph">
<p>You can now run Kafka commands to ZooKeeper.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-kafka-str"><a class="link" href="#proc-manual-delete-pod-pvc-kafka-str">2.1.8. Deleting Kafka nodes manually</a></h4>
<div class="paragraph">
<p>This procedure describes how to delete an existing Kafka node by using a Kubernetes annotation.
Deleting a Kafka node consists of deleting both the <code>Pod</code> on which the Kafka broker is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>Kafka broker pods are named <em>&lt;cluster-name&gt;</em>-kafka-<em>&lt;index&gt;</em>, where <em>&lt;index&gt;</em> starts at zero and ends at the total number of replicas minus one.
For example, <code>my-cluster-kafka-0</code>.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate pod <em>cluster-name</em>-kafka-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-zookeeper-str"><a class="link" href="#proc-manual-delete-pod-pvc-zookeeper-str">2.1.9. Deleting ZooKeeper nodes manually</a></h4>
<div class="paragraph">
<p>This procedure describes how to delete an existing ZooKeeper node by using a Kubernetes annotation.
Deleting a ZooKeeper node consists of deleting both the <code>Pod</code> on which ZooKeeper is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>ZooKeeper pods are named <em>&lt;cluster-name&gt;</em>-zookeeper-<em>&lt;index&gt;</em>, where <em>&lt;index&gt;</em> starts at zero and ends at the total number of replicas minus one.
For example, <code>my-cluster-zookeeper-0</code>.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate pod <em>cluster-name</em>-zookeeper-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-cluster-resources-str"><a class="link" href="#ref-list-of-kafka-cluster-resources-str">2.1.10. List of Kafka cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<div class="title">Shared resources</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca</code></dt>
<dd>
<p>Secret with the Cluster CA private key used to encrypt the cluster communication.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca-cert</code></dt>
<dd>
<p>Secret with the Cluster CA public key. This key can be used to verify the identity of the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca</code></dt>
<dd>
<p>Secret with the Clients CA private key used to sign user certificates</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca-cert</code></dt>
<dd>
<p>Secret with the Clients CA public key. This key can be used to verify the identity of the Kafka users.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-operator-certs</code></dt>
<dd>
<p>Secret with Cluster operators keys for communication with Kafka and ZooKeeper.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">ZooKeeper nodes</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>Name given to the following ZooKeeper resources:</p>
<div class="ulist">
<ul>
<li>
<p>StatefulSet or StrimziPodSet (if the <code>UseStrimziPodSets</code> feature gate is enabled) for managing the ZooKeeper node pods.</p>
</li>
<li>
<p>Service account used by the ZooKeeper nodes.</p>
</li>
<li>
<p>PodDisruptionBudget configured for the ZooKeeper nodes.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Pods created by the ZooKeeper StatefulSet or StrimziPodSet.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Headless Service needed to have DNS resolve the ZooKeeper pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-client</code></dt>
<dd>
<p>Service used by Kafka brokers to connect to ZooKeeper nodes as clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-config</code></dt>
<dd>
<p>ConfigMap that contains the ZooKeeper ancillary configuration, and is mounted as a volume by the ZooKeeper node pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Secret with ZooKeeper node keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-zookeeper</code></dt>
<dd>
<p>Network policy managing access to the ZooKeeper services.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the ZooKeeper node pod <code><em>idx</em></code>. This resource will be created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Kafka brokers</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>Name given to the following Kafka resources:</p>
<div class="ulist">
<ul>
<li>
<p>StatefulSet or StrimziPodSet (if the <code>UseStrimziPodSets</code> feature gate is enabled) for managing the Kafka broker pods.</p>
</li>
<li>
<p>Service account used by the Kafka pods.</p>
</li>
<li>
<p>PodDisruptionBudget configured for the Kafka brokers.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Name given to the following Kafka resources:</p>
<div class="ulist">
<ul>
<li>
<p>Pods created by the Kafka StatefulSet or StrimziPodSet.</p>
</li>
<li>
<p>ConfigMap with Kafka broker configuration (if the <code>UseStrimziPodSets</code> feature gate is enabled).</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Service needed to have DNS resolve the Kafka broker pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-bootstrap</code></dt>
<dd>
<p>Service can be used as bootstrap servers for Kafka clients connecting from within the Kubernetes cluster.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap service for clients connecting from outside the Kubernetes cluster. This resource is created only when an external listener is enabled. The old service name will be used for backwards compatibility when the listener name is <code>external</code> and port is <code>9094</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Service used to route traffic from outside the Kubernetes cluster to individual pods. This resource is created only when an external listener is enabled. The old service name will be used for backwards compatibility when the listener name is <code>external</code> and port is <code>9094</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap route for clients connecting from outside the Kubernetes cluster. This resource is created only when an external listener is enabled and set to type <code>route</code>. The old route name will be used for backwards compatibility when the listener name is <code>external</code> and port is <code>9094</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Route for traffic from outside the Kubernetes cluster to individual pods. This resource is created only when an external listener is enabled and set to type <code>route</code>. The old route name will be used for backwards compatibility when the listener name is <code>external</code> and port is <code>9094</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>listener-name</em>-bootstrap</code></dt>
<dd>
<p>Bootstrap service for clients connecting from outside the Kubernetes cluster. This resource is created only when an external listener is enabled. The new service name will be used for all other external listeners.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>listener-name</em>-<em>pod-id</em></code></dt>
<dd>
<p>Service used to route traffic from outside the Kubernetes cluster to individual pods. This resource is created only when an external listener is enabled. The new service name will be used for all other external listeners.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>listener-name</em>-bootstrap</code></dt>
<dd>
<p>Bootstrap route for clients connecting from outside the Kubernetes cluster. This resource is created only when an external listener is enabled and set to type <code>route</code>. The new route name will be used for all other external listeners.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>listener-name</em>-<em>pod-id</em></code></dt>
<dd>
<p>Route for traffic from outside the Kubernetes cluster to individual pods. This resource is created only when an external listener is enabled and set to type <code>route</code>. The new route name will be used for all other external listeners.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-config</code></dt>
<dd>
<p>ConfigMap which contains the Kafka ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Secret with Kafka broker keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-kafka</code></dt>
<dd>
<p>Network policy managing access to the Kafka services.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>namespace-name</em>-<em>cluster-name</em>-kafka-init</code></dt>
<dd>
<p>Cluster role binding used by the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmx</code></dt>
<dd>
<p>Secret with JMX username and password used to secure the Kafka broker port. This resource is created only when JMX is enabled in Kafka.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource is created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume <code><em>id</em></code> used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource is created only if persistent storage is selected for JBOD volumes when provisioning persistent volumes to store data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Entity Operator</div>
<p>These resources are only created if the Entity Operator is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator</code></dt>
<dd>
<p>Name given to the following Entity Operator resources:</p>
<div class="ulist">
<ul>
<li>
<p>Deployment with Topic and User Operators.</p>
</li>
<li>
<p>Service account used by the Entity Operator.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Entity Operator deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-topic-operator-config</code></dt>
<dd>
<p>ConfigMap with ancillary configuration for Topic Operators.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-user-operator-config</code></dt>
<dd>
<p>ConfigMap with ancillary configuration for User Operators.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-topic-operator-certs</code></dt>
<dd>
<p>Secret with Topic Operator keys for communication with Kafka and ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-user-operator-certs</code></dt>
<dd>
<p>Secret with User Operator keys for communication with Kafka and ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-entity-topic-operator</code></dt>
<dd>
<p>Role binding used by the Entity Topic Operator.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-entity-user-operator</code></dt>
<dd>
<p>Role binding used by the Entity User Operator.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Kafka Exporter</div>
<p>These resources are only created if the Kafka Exporter is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter</code></dt>
<dd>
<p>Name given to the following Kafka Exporter resources:</p>
<div class="ulist">
<ul>
<li>
<p>Deployment with Kafka Exporter.</p>
</li>
<li>
<p>Service used to collect consumer lag metrics.</p>
</li>
<li>
<p>Service account used by the Kafka Exporter.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Kafka Exporter deployment.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Cruise Control</div>
<p>These resources are only created if Cruise Control was deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control</code></dt>
<dd>
<p>Name given to the following Cruise Control resources:</p>
<div class="ulist">
<ul>
<li>
<p>Deployment with Cruise Control.</p>
</li>
<li>
<p>Service used to communicate with Cruise Control.</p>
</li>
<li>
<p>Service account used by the Cruise Control.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Cruise Control deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-config</code></dt>
<dd>
<p>ConfigMap that contains the Cruise Control ancillary configuration, and is mounted as a volume by the Cruise Control pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-certs</code></dt>
<dd>
<p>Secret with Cruise Control keys for communication with Kafka and ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-cruise-control</code></dt>
<dd>
<p>Network policy managing access to the Cruise Control service.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">JMXTrans</div>
<p>These resources are only created if JMXTrans is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans</code></dt>
<dd>
<p>Name given to the following JMXTrans resources:</p>
<div class="ulist">
<ul>
<li>
<p>Deployment with JMXTrans.</p>
</li>
<li>
<p>Service account used by the JMXTrans.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the JMXTrans deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans-config</code></dt>
<dd>
<p>ConfigMap that contains the JMXTrans ancillary configuration, and is mounted as a volume by the JMXTrans pods.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-kafka-connect-str"><a class="link" href="#assembly-kafka-connect-str">2.2. Kafka Connect cluster configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure a Kafka Connect deployment using the <code>KafkaConnect</code> resource.
Kafka Connect is an integration toolkit for streaming data between Kafka brokers and other systems using connector plugins.
Kafka Connect provides a framework for integrating Kafka with an external data source or target, such as a database, for import or export of data using connectors.
Connectors are plugins that provide the connection configuration needed.</p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaConnect-reference"><code>KafkaConnect</code> schema reference</a> describes the full schema of the <code>KafkaConnect</code> resource.</p>
</div>
<div class="paragraph">
<p>For more information on deploying connector plugins, see <a href="./deploying.html#using-kafka-connect-with-plug-ins-str" target="_blank" rel="noopener">Extending Kafka Connect with connector plugins</a>.</p>
</div>
<div class="sect3">
<h4 id="proc-kafka-connect-config-str"><a class="link" href="#proc-kafka-connect-config-str">2.2.1. Configuring Kafka Connect</a></h4>
<div class="paragraph">
<p>Use Kafka Connect to set up external data connections to your Kafka cluster.
Use the properties of the <code>KafkaConnect</code> resource to configure your Kafka Connect deployment.</p>
</div>
<div class="paragraph">
<div class="title">KafkaConnector configuration</div>
<p><code>KafkaConnector</code> resources allow you to create and manage connector instances for Kafka Connect in a Kubernetes-native way.</p>
</div>
<div class="paragraph">
<p>In your Kafka Connect configuration, you enable KafkaConnectors for a Kafka Connect cluster by adding the <code>strimzi.io/use-connector-resources</code> annotation.
You can also add a <code>build</code> configuration so that Strimzi automatically builds a container image with the connector plugins you require for your data connections.
External configuration for Kafka Connect connectors is specified through the <code>externalConfiguration</code> property.</p>
</div>
<div class="paragraph">
<p>To manage connectors, you can use use <code>KafkaConnector</code> custom resources or the Kafka Connect REST API.
<code>KafkaConnector</code> resources must be deployed to the same namespace as the Kafka Connect cluster they link to.
For more information on using these methods to create, reconfigure, or delete connectors, see <a href="./deploying.html#using-kafka-connect-with-plug-ins-str" target="_blank" rel="noopener">Adding connectors</a>.</p>
</div>
<div class="paragraph">
<p>Connector configuration is passed to Kafka Connect as part of an HTTP request and stored within Kafka itself.
ConfigMaps and Secrets are standard Kubernetes resources used for storing configurations and confidential data.
You can use ConfigMaps and Secrets to configure certain elements of a connector.
You can then reference the configuration values in HTTP REST commands, which keeps the configuration separate and more secure, if needed.
This method applies especially to confidential data, such as usernames, passwords, or certificates.</p>
</div>
<div class="paragraph">
<div class="title">Handling high volumes of messages</div>
<p>You can tune the configuration to handle high volumes of messages.
For more information, see <a href="./configuring.html#con-high-volume-config-properties-str" target="_blank" rel="noopener">Handling high volumes of messages</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties of the <code>KafkaConnect</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect <b class="conum">(1)</b>
metadata:
  name: my-connect-cluster
  annotations:
    strimzi.io/use-connector-resources: "true" <b class="conum">(2)</b>
spec:
  replicas: 3 <b class="conum">(3)</b>
  authentication: <b class="conum">(4)</b>
    type: tls
    certificateAndKey:
      certificate: source.crt
      key: source.key
      secretName: my-user-source
  bootstrapServers: my-cluster-kafka-bootstrap:9092 <b class="conum">(5)</b>
  tls: <b class="conum">(6)</b>
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
      - secretName: my-cluster-cluster-cert
        certificate: ca2.crt
  config: <b class="conum">(7)</b>
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  build: <b class="conum">(8)</b>
    output: <b class="conum">(9)</b>
      type: docker
      image: my-registry.io/my-org/my-connect-cluster:latest
      pushSecret: my-registry-credentials
    plugins: <b class="conum">(10)</b>
      - name: debezium-postgres-connector
        artifacts:
          - type: tgz
            url: https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/2.1.1.Final/debezium-connector-postgres-2.1.1.Final-plugin.tar.gz
            sha512sum: 962a12151bdf9a5a30627eebac739955a4fd95a08d373b86bdcea2b4d0c27dd6e1edd5cb548045e115e33a9e69b1b2a352bee24df035a0447cb820077af00c03
      - name: camel-telegram
        artifacts:
          - type: tgz
            url: https://repo.maven.apache.org/maven2/org/apache/camel/kafkaconnector/camel-telegram-kafka-connector/0.9.0/camel-telegram-kafka-connector-0.9.0-package.tar.gz
            sha512sum: a9b1ac63e3284bea7836d7d24d84208c49cdf5600070e6bd1535de654f6920b74ad950d51733e8020bf4187870699819f54ef5859c7846ee4081507f48873479
  externalConfiguration: <b class="conum">(11)</b>
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey
  resources: <b class="conum">(12)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(13)</b>
    type: inline
    loggers:
      log4j.rootLogger: "INFO"
  readinessProbe: <b class="conum">(14)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  metricsConfig: <b class="conum">(15)</b>
    type: jmxPrometheusExporter
    valueFrom:
      configMapKeyRef:
        name: my-config-map
        key: my-key
  jvmOptions: <b class="conum">(16)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(17)</b>
  rack:
    topologyKey: topology.kubernetes.io/zone <b class="conum">(18)</b>
  template: <b class="conum">(19)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: <b class="conum">(20)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>KafkaConnect</code>.</p>
</li>
<li>
<p>Enables KafkaConnectors for the Kafka Connect cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a> for the workers that run tasks.</p>
</li>
<li>
<p>Authentication for the Kafka Connect cluster, specified as <a href="#type-KafkaClientAuthenticationTls-reference">mTLS</a>, <a href="#type-KafkaClientAuthenticationOAuth-reference">token-based OAuth</a>, SASL-based <a href="#type-KafkaClientAuthenticationScramSha256-reference">SCRAM-SHA-256</a>/<a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a>, or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a>.
By default, Kafka Connect connects to Kafka brokers using a plain text connection.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the Kafka Connect cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p><a href="#property-kafka-connect-config-reference">Kafka Connect configuration</a> of workers (not connectors).
Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</li>
<li>
<p><a href="#type-Build-reference">Build configuration properties</a> for building a container image with connector plugins automatically.</p>
</li>
<li>
<p>(Required) Configuration of the container registry where new images are pushed.</p>
</li>
<li>
<p>(Required) List of connector plugins and their artifacts to add to the new container image. Each plugin must be configured with at least one <code>artifact</code>.</p>
</li>
<li>
<p><a href="#type-ExternalConfiguration-reference">External configuration for Kafka connectors</a> using environment variables, as shown here, or volumes.
You can also use <em>configuration provider plugins</em> to <a href="#assembly-loading-config-with-providers-str">load configuration values from external sources</a>.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-connect-logging-reference">Kafka Connect loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Connect <code>log4j.rootLogger</code> logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a>, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under <code>metricsConfig.valueFrom.configMapKeyRef.key</code>.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka Connect.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p>SPECIALIZED OPTION: <a href="#type-Rack-reference">Rack awareness</a> configuration for the deployment. This is a specialized option intended for a deployment within the same location, not across regions. Use this option if you want connectors to consume from the closest replica rather than the leader replica. In certain cases, consuming from the closest replica can improve network utilization or reduce costs . The <code>topologyKey</code> must match a node label containing the rack ID. The example used in this configuration specifies a zone using the standard <code><a href="https://kubernetes.io/docs/reference/labels-annotations-taints/#topologykubernetesiozone" target="_blank" rel="noopener">topology.kubernetes.io/zone</a></code> label. To consume from the closest replica, enable the <code>RackAwareReplicaSelector</code>  in the Kafka broker configuration.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are set for distributed tracing.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>KAFKA-CONNECT-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
<li>
<p>If authorization is enabled for Kafka Connect, <a href="#proc-configuring-kafka-connect-user-authorization-str">configure Kafka Connect users to enable access to the Kafka Connect consumer group and topics</a>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#assembly-distributed-tracing-str" target="_blank" rel="noopener">Introducing distributed tracing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-connect-multiple-instances-str"><a class="link" href="#con-kafka-connect-multiple-instances-str">2.2.2. Configuring Kafka Connect for multiple instances</a></h4>
<div class="paragraph">
<p>If you are running multiple instances of Kafka Connect, you have to change the default configuration of the following <code>config</code> properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: connect-cluster <b class="conum">(1)</b>
    offset.storage.topic: connect-cluster-offsets <b class="conum">(2)</b>
    config.storage.topic: connect-cluster-configs <b class="conum">(3)</b>
    status.storage.topic: connect-cluster-status  <b class="conum">(4)</b>
    # ...
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Kafka Connect cluster ID within Kafka.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Values for the three topics must be the same for all Kafka Connect instances with the same <code>group.id</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless you change the default settings, each Kafka Connect instance connecting to the same Kafka cluster is deployed with the same values.
What happens, in effect, is all instances are coupled to run in a cluster and use the same topics.</p>
</div>
<div class="paragraph">
<p>If multiple Kafka Connect clusters try to use the same topics, Kafka Connect will not work as expected and generate errors.</p>
</div>
<div class="paragraph">
<p>If you wish to run multiple Kafka Connect instances, change the values of these properties for each instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-connect-user-authorization-str"><a class="link" href="#proc-configuring-kafka-connect-user-authorization-str">2.2.3. Configuring Kafka Connect user authorization</a></h4>
<div class="paragraph">
<p>This procedure describes how to authorize user access to Kafka Connect.</p>
</div>
<div class="paragraph">
<p>When any type of authorization is being used in Kafka, a Kafka Connect user requires read/write access rights to the consumer group
and the internal topics of Kafka Connect.</p>
</div>
<div class="paragraph">
<p>The properties for the consumer group and internal topics are automatically configured by Strimzi,
or they can be specified explicitly in the <code>spec</code> of the <code>KafkaConnect</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration properties in the <code>KafkaConnect</code> resource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster <b class="conum">(1)</b>
    offset.storage.topic: my-connect-cluster-offsets <b class="conum">(2)</b>
    config.storage.topic: my-connect-cluster-configs <b class="conum">(3)</b>
    status.storage.topic: my-connect-cluster-status <b class="conum">(4)</b>
    # ...
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Kafka Connect cluster ID within Kafka.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure shows how access is provided when <code>simple</code> authorization is being used.</p>
</div>
<div class="paragraph">
<p>Simple authorization uses ACL rules, handled by the Kafka <code>AclAuthorizer</code> plugin, to provide the right level of access.
For more information on configuring a <code>KafkaUser</code> resource to use simple authorization, see the <a href="#type-AclRule-reference"><code>AclRule</code> schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default values for the consumer group and topics will differ when <a href="#con-kafka-connect-multiple-instances-str">running multiple instances</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>authorization</code> property in the <code>KafkaUser</code> resource to provide access rights to the user.</p>
<div class="paragraph">
<p>In the following example, access rights are configured for the Kafka Connect topics and consumer group using <code>literal</code> name values:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offset.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-offsets</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-status</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-configs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster</code></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  authorization:
    type: simple
    acls:
      # access to offset.storage.topic
      - resource:
          type: topic
          name: connect-cluster-offsets
          patternType: literal
        operations:
          - Create
          - Describe
          - Read
          - Write
        host: "*"
      # access to status.storage.topic
      - resource:
          type: topic
          name: connect-cluster-status
          patternType: literal
        operations:
          - Create
          - Describe
          - Read
          - Write
        host: "*"
      # access to config.storage.topic
      - resource:
          type: topic
          name: connect-cluster-configs
          patternType: literal
        operations:
          - Create
          - Describe
          - Read
          - Write
        host: "*"
      # consumer group
      - resource:
          type: group
          name: connect-cluster
          patternType: literal
        operations:
          - Read
        host: "*"</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>KAFKA-USER-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-connect-resources-str"><a class="link" href="#ref-list-of-kafka-connect-resources-str">2.2.4. List of Kafka Connect cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Connect worker node pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-api</dt>
<dd>
<p>Service which exposes the REST interface for managing the Kafka Connect cluster.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Connect ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Connect worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-mirrormaker-str"><a class="link" href="#assembly-mirrormaker-str">2.3. Kafka MirrorMaker 2.0 cluster configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure a Kafka MirrorMaker 2.0 deployment using the <code>KafkaMirrorMaker2</code> resource.
MirrorMaker 2.0 replicates data between two or more Kafka clusters, within or across data centers.</p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code> schema reference</a> describes the full schema of the <code>KafkaMirrorMaker2</code> resource.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 resource configuration differs from the previous version of MirrorMaker.
If you choose to use MirrorMaker 2.0, there is currently no legacy support, so any resources must be manually converted into the new format.</p>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-str"><a class="link" href="#con-mirrormaker-str">2.3.1. MirrorMaker 2.0 data replication</a></h4>
<div class="paragraph _abstract">
<p>Data replication across clusters supports scenarios that require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Recovery of data in the event of a system failure</p>
</li>
<li>
<p>Aggregation of data for analysis</p>
</li>
<li>
<p>Restriction of data access to a specific cluster</p>
</li>
<li>
<p>Provision of data at a specific location to improve latency</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="con-overview-mm2-str"><a class="link" href="#con-overview-mm2-str">MirrorMaker 2.0 configuration</a></h5>
<div class="paragraph _abstract">
<p>MirrorMaker 2.0 consumes messages from a source Kafka cluster and writes them to a target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source cluster configuration to consume data from the source cluster</p>
</li>
<li>
<p>Target cluster configuration to output data to the target cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 is based on the Kafka Connect framework, <em>connectors</em> managing the transfer of data between clusters.</p>
</div>
<div class="paragraph">
<p>You configure MirrorMaker 2.0 to define the Kafka Connect deployment, including the connection details of the source and target clusters, and then run a set of MirrorMaker 2.0 connectors to make the connection.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 consists of the following connectors:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>MirrorSourceConnector</code></dt>
<dd>
<p>The source connector replicates topics from a source cluster to a target cluster. It also replicates ACLs and is necessary for the <code>MirrorCheckpointConnector</code> to run.</p>
</dd>
<dt class="hdlist1"><code>MirrorCheckpointConnector</code></dt>
<dd>
<p>The checkpoint connector periodically tracks offsets. If enabled, it also synchronizes consumer group offsets between the source and target cluster.</p>
</dd>
<dt class="hdlist1"><code>MirrorHeartbeatConnector</code></dt>
<dd>
<p>The heartbeat connector periodically checks connectivity between the source and target cluster.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using the User Operator to manage ACLs, ACL replication through the connector is not possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The process of <em>mirroring</em> data from a source cluster to a target cluster is asynchronous.
Each MirrorMaker 2.0 instance mirrors data from one source cluster to one target cluster.
You can use more than one MirrorMaker 2.0 instance to mirror data between any number of clusters.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mirrormaker.png" alt="MirrorMaker 2.0 replication">
</div>
<div class="title">Figure 1. Replication across two clusters</div>
</div>
<div class="paragraph">
<p>By default, a check for new topics in the source cluster is made every 10 minutes.
You can change the frequency by adding <code>refresh.topics.interval.seconds</code> to the source connector configuration.</p>
</div>
<div class="sect5">
<h6 id="cluster_configuration"><a class="link" href="#cluster_configuration">Cluster configuration</a></h6>
<div class="paragraph">
<p>You can use MirrorMaker 2.0 in <em>active/passive</em> or <em>active/active</em> cluster configurations.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">active/active cluster configuration</dt>
<dd>
<p>An active/active configuration has two active clusters replicating data bidirectionally. Applications can use either cluster. Each cluster can provide the same data. In this way,  you can make the same data available in different geographical locations. As consumer groups are active in both clusters, consumer offsets for replicated topics are not synchronized back to the source cluster.</p>
</dd>
<dt class="hdlist1">active/passive cluster configuration</dt>
<dd>
<p>An active/passive configuration has an active cluster replicating data to a passive cluster. The passive cluster remains on standby. You might use the passive cluster for data recovery in the event of system failure.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The expectation is that producers and consumers connect to active clusters only.
A MirrorMaker 2.0 cluster is required at each target destination.</p>
</div>
</div>
<div class="sect5">
<h6 id="bidirectional_replication_activeactive"><a class="link" href="#bidirectional_replication_activeactive">Bidirectional replication (active/active)</a></h6>
<div class="paragraph">
<p>The MirrorMaker 2.0 architecture supports bidirectional replication in an <em>active/active</em> cluster configuration.</p>
</div>
<div class="paragraph">
<p>Each cluster replicates the data of the other cluster using the concept of <em>source</em> and <em>remote</em> topics.
As the same topics are stored in each cluster, remote topics are automatically renamed by MirrorMaker 2.0 to represent the source cluster.
The name of the originating cluster is prepended to the name of the topic.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mirrormaker-renaming.png" alt="MirrorMaker 2.0 bidirectional architecture">
</div>
<div class="title">Figure 2. Topic renaming</div>
</div>
<div class="paragraph">
<p>By flagging the originating cluster, topics are not replicated back to that cluster.</p>
</div>
<div class="paragraph">
<p>The concept of replication through <em>remote</em> topics is useful when configuring an architecture that requires data aggregation.
Consumers can subscribe to source and remote topics within the same cluster, without the need for a separate aggregation cluster.</p>
</div>
</div>
<div class="sect5">
<h6 id="unidirectional_replication_activepassive"><a class="link" href="#unidirectional_replication_activepassive">Unidirectional replication (active/passive)</a></h6>
<div class="paragraph">
<p>The MirrorMaker 2.0 architecture supports unidirectional replication in an <em>active/passive</em> cluster configuration.</p>
</div>
<div class="paragraph">
<p>You can use an <em>active/passive</em> cluster configuration to make backups or migrate data to another cluster.
In this situation, you might not want automatic renaming of remote topics.</p>
</div>
<div class="paragraph">
<p>You can override automatic renaming by adding <code>IdentityReplicationPolicy</code> to the source connector configuration.
With this configuration applied, topics retain their original names.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="topic_configuration_synchronization"><a class="link" href="#topic_configuration_synchronization">Topic configuration synchronization</a></h5>
<div class="paragraph">
<p>MirrorMaker 2.0 supports topic configuration synchronization between source and target clusters.
You specify source topics in the MirrorMaker 2.0 configuration.
MirrorMaker 2.0 monitors the source topics.
MirrorMaker 2.0 detects and propagates changes to the source topics to the remote topics.
Changes might include automatically creating missing topics and partitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In most cases you write to local topics and read from remote topics. Though write operations are not prevented on remote topics, they should be avoided.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="offset_tracking"><a class="link" href="#offset_tracking">Offset tracking</a></h5>
<div class="paragraph">
<p>MirrorMaker 2.0 tracks offsets for consumer groups using internal topics.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>offset-syncs</code> topic</dt>
<dd>
<p>The <code>offset-syncs</code> topic maps the source and target offsets for replicated topic partitions from record metadata.</p>
</dd>
<dt class="hdlist1"><code>checkpoints</code> topic</dt>
<dd>
<p>The <code>checkpoints</code> topic maps the last committed offset in the source and target cluster for replicated topic partitions in each consumer group.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As they used internally by MirrorMaker 2.0, you do not interact directly with these topics.</p>
</div>
<div class="paragraph">
<p><code>MirrorCheckpointConnector</code> emits <em>checkpoints</em> for offset tracking.
Offsets for the <code>checkpoints</code> topic are tracked at predetermined intervals through configuration.
Both topics enable replication to be fully restored from the correct offset position on failover.</p>
</div>
<div class="paragraph">
<p>The location of the <code>offset-syncs</code> topic is the <code>source</code> cluster by default.
You can use the <code>offset-syncs.topic.location</code> connector configuration to change this to the <code>target</code> cluster.
You need read/write access to the cluster that contains the topic.
Using the target cluster as the location of the <code>offset-syncs</code> topic allows you to use MirrorMaker 2.0 even if you have only read access to the source cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="synchronizing_consumer_group_offsets"><a class="link" href="#synchronizing_consumer_group_offsets">Synchronizing consumer group offsets</a></h5>
<div class="paragraph">
<p>The <code>__consumer_offsets</code> topic stores information on committed offsets for each consumer group.
Offset synchronization periodically transfers the consumer offsets for the consumer groups of a source cluster into the consumer offsets topic of a target cluster.</p>
</div>
<div class="paragraph">
<p>Offset synchronization is particularly useful in an <em>active/passive</em> configuration.
If the active cluster goes down, consumer applications can switch to the passive (standby) cluster and pick up from the last transferred offset position.</p>
</div>
<div class="paragraph">
<p>To use topic offset synchronization, enable the synchronization by adding <code>sync.group.offsets.enabled</code> to the checkpoint connector configuration, and setting the property to <code>true</code>.
Synchronization is disabled by default.</p>
</div>
<div class="paragraph">
<p>When using the <code>IdentityReplicationPolicy</code> in the source connector, it also has to be configured in the checkpoint connector configuration.
This ensures that the mirrored consumer offsets will be applied for the correct topics.</p>
</div>
<div class="paragraph">
<p>Consumer offsets are only synchronized for consumer groups that are not active in the target cluster.
If the consumer groups are in the target cluster, the synchronization cannot be performed and an <code>UNKNOWN_MEMBER_ID</code> error is returned.</p>
</div>
<div class="paragraph">
<p>If enabled, the synchronization of offsets from the source cluster is made periodically.
You can change the frequency by adding <code>sync.group.offsets.interval.seconds</code> and <code>emit.checkpoints.interval.seconds</code> to the checkpoint connector configuration.
The properties specify the frequency in seconds that the consumer group offsets are synchronized, and the frequency of checkpoints emitted for offset tracking.
The default for both properties is 60 seconds.
You can also change the frequency of checks for new consumer groups using the <code>refresh.groups.interval.seconds</code> property, which is performed every 10 minutes by default.</p>
</div>
<div class="paragraph">
<p>Because the synchronization is time-based, any switchover by consumers to a passive cluster will likely result in some duplication of messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you have an application written in Java, you can use the <code>RemoteClusterUtils.java</code> utility to synchronize offsets through the application. The utility fetches remote offsets for a consumer group from the <code>checkpoints</code> topic.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="connectivity_checks"><a class="link" href="#connectivity_checks">Connectivity checks</a></h5>
<div class="paragraph">
<p><code>MirrorHeartbeatConnector</code> emits <em>heartbeats</em> to check connectivity between clusters.</p>
</div>
<div class="paragraph">
<p>An internal <code>heartbeat</code> topic is replicated from the source cluster.
Target clusters use the <code>heartbeat</code> topic to check the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connector managing connectivity between clusters is running</p>
</li>
<li>
<p>The source cluster is available</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-config-mirrormaker2-connectors-str"><a class="link" href="#con-config-mirrormaker2-connectors-str">2.3.2. Connector configuration</a></h4>
<div class="paragraph _abstract">
<p>Use Mirrormaker 2.0 connector configuration for the internal connectors that orchestrate the synchronization of data between Kafka clusters.</p>
</div>
<div class="paragraph">
<p>The following table describes connector properties and the connectors you configure to use them.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. MirrorMaker 2.0 connector configuration properties</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">sourceConnector</th>
<th class="tableblock halign-left valign-top">checkpointConnector</th>
<th class="tableblock halign-left valign-top">heartbeatConnector</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">admin.timeout.ms</dt>
<dd>
<p>Timeout for admin tasks, such as detecting new topics. Default is <code>60000</code> (1 minute).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">replication.policy.class</dt>
<dd>
<p>Policy to define the remote topic naming convention. Default is <code>org.apache.kafka.connect.mirror.DefaultReplicationPolicy</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">replication.policy.separator</dt>
<dd>
<p>The separator used for topic naming in the target cluster. Default is <code>.</code> (dot).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">consumer.poll.timeout.ms</dt>
<dd>
<p>Timeout when polling the source cluster. Default is <code>1000</code> (1 second).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">offset-syncs.topic.location</dt>
<dd>
<p>The location of the <code>offset-syncs</code> topic, which can be the <code>source</code> (default) or <code>target</code> cluster.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">topic.filter.class</dt>
<dd>
<p>Topic filter to select the topics to replicate. Default is <code>org.apache.kafka.connect.mirror.DefaultTopicFilter</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">config.property.filter.class</dt>
<dd>
<p>Topic filter to select the topic configuration properties to replicate. Default is <code>org.apache.kafka.connect.mirror.DefaultConfigPropertyFilter</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">config.properties.exclude</dt>
<dd>
<p>Topic configuration properties that should not be replicated. Supports comma-separated property names and regular expressions.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">offset.lag.max</dt>
<dd>
<p>Maximum allowable (out-of-sync) offset lag before a remote partition is synchronized. Default is <code>100</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">offset-syncs.topic.replication.factor</dt>
<dd>
<p>Replication factor for the internal <code>offset-syncs</code> topic. Default is <code>3</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">refresh.topics.enabled</dt>
<dd>
<p>Enables check for new topics and partitions. Default is <code>true</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">refresh.topics.interval.seconds</dt>
<dd>
<p>Frequency of topic refresh. Default is <code>600</code> (10 minutes).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">replication.factor</dt>
<dd>
<p>The replication factor for new topics. Default is <code>2</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.topic.acls.enabled</dt>
<dd>
<p>Enables synchronization of ACLs from the source cluster. Default is <code>true</code>. Not compatible with the User Operator.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.topic.acls.interval.seconds</dt>
<dd>
<p>Frequency of ACL synchronization. Default is <code>600</code> (10 minutes).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.topic.configs.enabled</dt>
<dd>
<p>Enables synchronization of topic configuration from the source cluster. Default is <code>true</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.topic.configs.interval.seconds</dt>
<dd>
<p>Frequency of topic configuration synchronization. Default <code>600</code> (10 minutes).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">checkpoints.topic.replication.factor</dt>
<dd>
<p>Replication factor for the internal <code>checkpoints</code> topic. Default is <code>3</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">emit.checkpoints.enabled</dt>
<dd>
<p>Enables synchronization of consumer offsets to the target cluster. Default is <code>true</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">emit.checkpoints.interval.seconds</dt>
<dd>
<p>Frequency of consumer offset synchronization. Default is <code>60</code> (1 minute).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">group.filter.class</dt>
<dd>
<p>Group filter to select the consumer groups to replicate. Default is <code>org.apache.kafka.connect.mirror.DefaultGroupFilter</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">refresh.groups.enabled</dt>
<dd>
<p>Enables check for new consumer groups. Default is <code>true</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">refresh.groups.interval.seconds</dt>
<dd>
<p>Frequency of consumer group refresh. Default is <code>600</code> (10 minutes).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.group.offsets.enabled</dt>
<dd>
<p>Enables synchronization of consumer group offsets to the target cluster <code>__consumer_offsets</code> topic. Default is <code>false</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">sync.group.offsets.interval.seconds</dt>
<dd>
<p>Frequency of consumer group offset synchronization. Default is <code>60</code> (1 minute).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">emit.heartbeats.enabled</dt>
<dd>
<p>Enables connectivity checks on the target cluster. Default is <code>true</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">emit.heartbeats.interval.seconds</dt>
<dd>
<p>Frequency of connectivity checks. Default is <code>1</code> (1 second).</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="dlist">
<dl>
<dt class="hdlist1">heartbeats.topic.replication.factor</dt>
<dd>
<p>Replication factor for the internal <code>heartbeats</code> topic. Default is <code>3</code>.</p>
</dd>
</dl>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-producers-consumers-str"><a class="link" href="#con-mirrormaker-producers-consumers-str">2.3.3. Connector producer and consumer configuration</a></h4>
<div class="paragraph _abstract">
<p>MirrorMaker 2.0 connectors use internal producers and consumers.
If needed, you can configure these producers and consumers to override the default settings.</p>
</div>
<div class="paragraph">
<p>For example, you can increase the <code>batch.size</code> for the source producer that sends topics to the target Kafka cluster to better accommodate large volumes of messages.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Producer and consumer configuration options depend on the MirrorMaker 2.0 implementation, and may be subject to change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following tables describe the producers and consumers for each of the connectors and where you can add configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Source connector producers and consumers</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Producer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sends topic messages to the target Kafka cluster. Consider tuning the configuration of this producer when it is handling large volumes of data.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.sourceConnector.config: producer.override.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Producer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Writes to the <code>offset-syncs</code> topic, which maps the source and target offsets for replicated topic partitions.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.sourceConnector.config: producer.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Retrieves topic messages from the source Kafka cluster.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.sourceConnector.config: consumer.*</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Checkpoint connector producers and consumers</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Producer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Emits consumer offset checkpoints.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.checkpointConnector.config: producer.override.*</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Loads the <code>offset-syncs</code> topic.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.checkpointConnector.config: consumer.*</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can set <code>offset-syncs.topic.location</code> to <code>target</code> to use the target Kafka cluster as the location of the <code>offset-syncs</code> topic.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Heartbeat connector producer</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Producer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Emits heartbeats.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mirrors.heartbeatConnector.config: producer.override.*</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows how you configure the producers and consumers.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for connector producers and consumers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  version: 3.3.2
  # ...
  mirrors:
  - sourceCluster: "my-cluster-source"
    targetCluster: "my-cluster-target"
    sourceConnector:
      tasksMax: 5
      config:
        producer.override.batch.size: 327680
        producer.override.linger.ms: 100
        producer.request.timeout.ms: 30000
        consumer.fetch.max.bytes: 52428800
        # ...
    checkpointConnector:
      config:
        producer.override.request.timeout.ms: 30000
        consumer.max.poll.interval.ms: 300000
        # ...
    heartbeatConnector:
      config:
        producer.override.request.timeout.ms: 30000
        # ...</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code> schema reference</a></p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference"><code>KafkaMirrorMaker2MirrorSpec</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-tasks-max-str"><a class="link" href="#con-mirrormaker-tasks-max-str">2.3.4. Specifying a maximum number of tasks</a></h4>
<div class="paragraph _abstract">
<p>Connectors create the tasks that are responsible for moving data in and out of Kafka.
Each connector comprises one or more tasks that are distributed across a group of worker pods that run the tasks.
Increasing the number of tasks can help with performance issues when replicating a large number of partitions or synchronizing the offsets of a large number of consumer groups.</p>
</div>
<div class="paragraph">
<p>Tasks run in parallel.
Workers are assigned one or more tasks.
A single task is handled by one worker pod, so you don&#8217;t need more worker pods than tasks.
If there are more tasks than workers, workers handle multiple tasks.</p>
</div>
<div class="paragraph">
<p>You can specify the maximum number of connector tasks in your MirrorMaker configuration using the <code>tasksMax</code> property.
Without specifying a maximum number of tasks, the default setting is a single task.</p>
</div>
<div class="paragraph">
<p>The heartbeat connector always uses a single task.</p>
</div>
<div class="paragraph">
<p>The number of tasks that are started for the source and checkpoint connectors is the lower value between the maximum number of possible tasks and the value for <code>tasksMax</code>.
For the source connector, the maximum number of tasks possible is one for each partition being replicated from the source cluster.
For the checkpoint connector, the maximum number of tasks possible is one for each consumer group being replicated from the source cluster.
When setting a maximum number of tasks, consider the number of partitions and the hardware resources that support the process.</p>
</div>
<div class="paragraph">
<p>If the infrastructure supports the processing overhead, increasing the number of tasks can improve throughput and latency.
For example, adding more tasks reduces the time taken to poll the source cluster when there is a high number of partitions or consumer groups.</p>
</div>
<div class="paragraph">
<p>Increasing the number of tasks for the checkpoint connector is useful when you have a large number of partitions.</p>
</div>
<div class="listingblock">
<div class="title">Increasing the number of tasks for the source connector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  # ...
  mirrors:
  - sourceCluster: "my-cluster-source"
    targetCluster: "my-cluster-target"
    sourceConnector:
      tasksMax: 10
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Increasing the number of tasks for the checkpoint connector is useful when you have a large number of consumer groups.</p>
</div>
<div class="listingblock">
<div class="title">Increasing the number of tasks for the checkpoint connector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  # ...
  mirrors:
  - sourceCluster: "my-cluster-source"
    targetCluster: "my-cluster-target"
    checkpointConnector:
      tasksMax: 10
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, MirrorMaker 2.0 checks for new consumer groups every 10 minutes.
You can adjust the <code>refresh.groups.interval.seconds</code> configuration to change the frequency.
Take care when adjusting lower.
More frequent checks can have a negative impact on performance.</p>
</div>
<div class="sect4">
<h5 id="checking_connector_task_operations"><a class="link" href="#checking_connector_task_operations">Checking connector task operations</a></h5>
<div class="paragraph">
<p>If you are using Prometheus and Grafana to monitor your deployment, you can check MirrorMaker 2.0 performance.
The example MirrorMaker 2.0 Grafana dashboard provided with Strimzi shows the following metrics related to tasks and latency.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The number of tasks</p>
</li>
<li>
<p>Replication latency</p>
</li>
<li>
<p>Offset synchronization latency</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#assembly-metrics-setup-str" target="_blank" rel="noopener">Grafana dashboards</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-acls-str"><a class="link" href="#con-mirrormaker-acls-str">2.3.5. ACL rules synchronization</a></h4>
<div class="paragraph">
<p>ACL access to remote topics is possible if you are <strong>not</strong> using the User Operator.</p>
</div>
<div class="paragraph">
<p>If <code>AclAuthorizer</code> is being used, without the User Operator, ACL rules that manage access to brokers also apply to remote topics.
Users that can read a source topic can read its remote equivalent.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
OAuth 2.0 authorization does not support access to remote topics in this way.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-mirrormaker-replication-str"><a class="link" href="#proc-mirrormaker-replication-str">2.3.6. Configuring Kafka MirrorMaker 2.0</a></h4>
<div class="paragraph _abstract">
<p>Use the properties of the <code>KafkaMirrorMaker2</code> resource to configure your Kafka MirrorMaker 2.0 deployment.
Use MirrorMaker 2.0 to synchronize data between Kafka clusters.</p>
</div>
<div class="paragraph">
<p>The configuration must specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Kafka cluster</p>
</li>
<li>
<p>Connection information for each cluster, including authentication</p>
</li>
<li>
<p>The replication flow and direction</p>
<div class="ulist">
<ul>
<li>
<p>Cluster to cluster</p>
</li>
<li>
<p>Topic to topic</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The previous version of MirrorMaker continues to be supported.
If you wish to use the resources configured for the previous version,
they must be updated to the format supported by MirrorMaker 2.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 provides default configuration values for properties such as replication factors.
A minimal configuration, with defaults left unchanged, would be something like this example:</p>
</div>
<div class="listingblock">
<div class="title">Minimal configuration for MirrorMaker 2.0</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  version: 3.3.2
  connectCluster: "my-cluster-target"
  clusters:
  - alias: "my-cluster-source"
    bootstrapServers: my-cluster-source-kafka-bootstrap:9092
  - alias: "my-cluster-target"
    bootstrapServers: my-cluster-target-kafka-bootstrap:9092
  mirrors:
  - sourceCluster: "my-cluster-source"
    targetCluster: "my-cluster-target"
    sourceConnector: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure access control for source and target clusters using mTLS or SASL authentication.
This procedure shows a configuration that uses TLS encryption and mTLS authentication for the source and target cluster.</p>
</div>
<div class="paragraph">
<p>You can specify the topics and consumer groups you wish to replicate from a source cluster in the <code>KafkaMirrorMaker2</code> resource.
You use the <code>topicsPattern</code> and <code>groupsPattern</code> properties to do this.
You can provide a list of names or use a regular expression.
By default, all topics and consumer groups are replicated if you do not set the <code>topicsPattern</code> and <code>groupsPattern</code> properties.
You can also replicate all topics and consumer groups by using <code>".*"</code> as a regular expression.
However, try to specify only the topics and consumer groups you need to avoid causing any unnecessary extra load on the cluster.</p>
</div>
<div class="paragraph">
<div class="title">Handling high volumes of messages</div>
<p>You can tune the configuration to handle high volumes of messages.
For more information, see <a href="./configuring.html#con-high-volume-config-properties-str" target="_blank" rel="noopener">Handling high volumes of messages</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi is running</p>
</li>
<li>
<p>Source and target Kafka clusters are available</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaMirrorMaker2</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  version: 3.3.2 # <b class="conum">(1)</b>
  replicas: 3 # <b class="conum">(2)</b>
  connectCluster: "my-cluster-target" # <b class="conum">(3)</b>
  clusters: # <b class="conum">(4)</b>
  - alias: "my-cluster-source" # <b class="conum">(5)</b>
    authentication: # <b class="conum">(6)</b>
      certificateAndKey:
        certificate: source.crt
        key: source.key
        secretName: my-user-source
      type: tls
    bootstrapServers: my-cluster-source-kafka-bootstrap:9092 # <b class="conum">(7)</b>
    tls: # <b class="conum">(8)</b>
      trustedCertificates:
      - certificate: ca.crt
        secretName: my-cluster-source-cluster-ca-cert
  - alias: "my-cluster-target" # <b class="conum">(9)</b>
    authentication: # <b class="conum">(10)</b>
      certificateAndKey:
        certificate: target.crt
        key: target.key
        secretName: my-user-target
      type: tls
    bootstrapServers: my-cluster-target-kafka-bootstrap:9092 # <b class="conum">(11)</b>
    config: # <b class="conum">(12)</b>
      config.storage.replication.factor: 1
      offset.storage.replication.factor: 1
      status.storage.replication.factor: 1
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" # <b class="conum">(13)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS # <b class="conum">(14)</b>
    tls: # <b class="conum">(15)</b>
      trustedCertificates:
      - certificate: ca.crt
        secretName: my-cluster-target-cluster-ca-cert
  mirrors: # <b class="conum">(16)</b>
  - sourceCluster: "my-cluster-source" # <b class="conum">(17)</b>
    targetCluster: "my-cluster-target" # <b class="conum">(18)</b>
    sourceConnector: # <b class="conum">(19)</b>
      tasksMax: 10 # <b class="conum">(20)</b>
      autoRestart: # <b class="conum">(21)</b>
        enabled: true
      config:
        replication.factor: 1 # <b class="conum">(22)</b>
        offset-syncs.topic.replication.factor: 1 # <b class="conum">(23)</b>
        sync.topic.acls.enabled: "false" # <b class="conum">(24)</b>
        refresh.topics.interval.seconds: 60 # <b class="conum">(25)</b>
        replication.policy.separator: "." # <b class="conum">(26)</b>
        replication.policy.class: "org.apache.kafka.connect.mirror.IdentityReplicationPolicy" # <b class="conum">(27)</b>
    heartbeatConnector: # <b class="conum">(28)</b>
      autoRestart:
        enabled: true
      config:
        heartbeats.topic.replication.factor: 1 # <b class="conum">(29)</b>
    checkpointConnector: # <b class="conum">(30)</b>
      autoRestart:
        enabled: true
      config:
        checkpoints.topic.replication.factor: 1 # <b class="conum">(31)</b>
        refresh.groups.interval.seconds: 600 # <b class="conum">(32)</b>
        sync.group.offsets.enabled: true # <b class="conum">(33)</b>
        sync.group.offsets.interval.seconds: 60 # <b class="conum">(34)</b>
        emit.checkpoints.interval.seconds: 60 # <b class="conum">(35)</b>
        replication.policy.class: "org.apache.kafka.connect.mirror.IdentityReplicationPolicy"
    topicsPattern: "topic1|topic2|topic3" # <b class="conum">(36)</b>
    groupsPattern: "group1|group2|group3" # <b class="conum">(37)</b>
  resources: # <b class="conum">(38)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: # <b class="conum">(39)</b>
    type: inline
    loggers:
      connect.root.logger.level: "INFO"
  readinessProbe: # <b class="conum">(40)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  jvmOptions: # <b class="conum">(41)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest # <b class="conum">(42)</b>
  rack:
    topologyKey: topology.kubernetes.io/zone # <b class="conum">(43)</b>
  template: # <b class="conum">(44)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: # <b class="conum">(45)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing:
    type: jaeger # <b class="conum">(46)</b>
  externalConfiguration: # <b class="conum">(47)</b>
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Kafka Connect and Mirror Maker 2.0 <a href="#type-KafkaConnectSpec-reference">version</a>, which will always be the same.</p>
</li>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a> for the workers that run tasks.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2Spec-reference">Kafka cluster alias</a> for Kafka Connect, which must specify the <strong>target</strong> Kafka cluster. The Kafka cluster is used by Kafka Connect for its internal topics.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Specification</a> for the Kafka clusters being synchronized.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Cluster alias</a> for the source Kafka cluster.</p>
</li>
<li>
<p>Authentication for the source cluster, specified as <a href="#type-KafkaClientAuthenticationTls-reference">mTLS</a>, <a href="#type-KafkaClientAuthenticationOAuth-reference">token-based OAuth</a>, SASL-based <a href="#type-KafkaClientAuthenticationScramSha256-reference">SCRAM-SHA-256</a>/<a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a>, or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the source Kafka cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the source Kafka cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Cluster alias</a> for the target Kafka cluster.</p>
</li>
<li>
<p>Authentication for the target Kafka cluster is configured in the same way as for the source Kafka cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the target Kafka cluster.</p>
</li>
<li>
<p><a href="#property-kafka-connect-config-reference">Kafka Connect configuration</a>.
Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>TLS encryption for the target Kafka cluster is configured in the same way as for the source Kafka cluster.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">MirrorMaker 2.0 connectors</a>.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">Cluster alias</a> for the source cluster used by the MirrorMaker 2.0 connectors.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">Cluster alias</a> for the target cluster used by the MirrorMaker 2.0 connectors.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorSourceConnector</code></a> that creates remote topics. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>The maximum number of tasks that the connector may create. Tasks handle the data replication and run in parallel. If the infrastructure supports the processing overhead, increasing this value can improve throughput. Kafka Connect distributes the tasks between members of the cluster. If there are more tasks than workers, workers are assigned multiple tasks. For sink connectors, aim to have one task for each topic partition consumed. For source connectors, the number of tasks that can run in parallel may also depend on the external system. The connector creates fewer than the maximum number of tasks if it cannot achieve the parallelism.</p>
</li>
<li>
<p>Enables automatic restarts of failed connectors and tasks. Up to seven restart attempts are made, after which restarts must be made manually.</p>
</li>
<li>
<p>Replication factor for mirrored topics created at the target cluster.</p>
</li>
<li>
<p>Replication factor for the <code>MirrorSourceConnector</code> <code>offset-syncs</code> internal topic that maps the offsets of the source and target clusters.</p>
</li>
<li>
<p>When <a href="#con-mirrormaker-acls-str">ACL rules synchronization</a> is enabled, ACLs are applied to synchronized topics. The default is <code>true</code>. This feature is not compatible with the User Operator. If you are using the User Operator, set this property to <code>false</code>.</p>
</li>
<li>
<p>Optional setting to change the frequency of checks for new topics. The default is for a check every 10 minutes.</p>
</li>
<li>
<p>Defines the separator used for the renaming of remote topics.</p>
</li>
<li>
<p>Adds a policy that overrides the automatic renaming of remote topics. Instead of prepending the name with the name of the source cluster, the topic retains its original name. This optional setting is useful for active/passive backups and data migration.
To configure topic offset synchronization, this property must also be set for the <code>checkpointConnector.config</code>.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorHeartbeatConnector</code></a> that performs connectivity checks. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>Replication factor for the heartbeat topic created at the target cluster.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorCheckpointConnector</code></a> that tracks offsets. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>Replication factor for the checkpoints topic created at the target cluster.</p>
</li>
<li>
<p>Optional setting to change the frequency of checks for new consumer groups. The default is for a check every 10 minutes.</p>
</li>
<li>
<p>Optional setting to synchronize consumer group offsets, which is useful for recovery in an active/passive configuration. Synchronization is not enabled by default.</p>
</li>
<li>
<p>If the synchronization of consumer group offsets is enabled, you can adjust the frequency of the synchronization.</p>
</li>
<li>
<p>Adjusts the frequency of checks for offset tracking. If you change the frequency of offset synchronization, you might also need to adjust the frequency of these checks.</p>
</li>
<li>
<p>Topic replication from the source cluster <a href="#type-KafkaMirrorMaker2MirrorSpec-reference">defined as a comma-separated list or regular expression pattern</a>. The source connector replicates the specified topics. The checkpoint connector tracks offsets for the specified topics. Here we request three topics by name.</p>
</li>
<li>
<p>Consumer group replication from the source cluster <a href="#type-KafkaMirrorMaker2MirrorSpec-reference">defined as a comma-separated list or regular expression pattern</a>. The checkpoint connector replicates the specified consumer groups. Here we request three consumer groups by name.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-connect-logging-reference">Kafka Connect loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Connect <code>log4j.rootLogger</code> logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka MirrorMaker.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p>SPECIALIZED OPTION: <a href="#type-Rack-reference">Rack awareness</a> configuration for the deployment. This is a specialized option intended for a deployment within the same location, not across regions. Use this option if you want connectors to consume from the closest replica rather than the leader replica. In certain cases, consuming from the closest replica can improve network utilization or reduce costs . The <code>topologyKey</code> must match a node label containing the rack ID. The example used in this configuration specifies a zone using the standard <code><a href="https://kubernetes.io/docs/reference/labels-annotations-taints/#topologykubernetesiozone" target="_blank" rel="noopener">topology.kubernetes.io/zone</a></code> label. To consume from the closest replica, enable the <code>RackAwareReplicaSelector</code>  in the Kafka broker configuration.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are set for distributed tracing.</p>
</li>
<li>
<p>Distributed tracing is enabled for Jaeger.</p>
</li>
<li>
<p><a href="#type-ExternalConfiguration-reference">External configuration</a> for a Kubernetes Secret mounted to Kafka MirrorMaker as an environment variable.
You can also use <em>configuration provider plugins</em> to <a href="#assembly-loading-config-with-providers-str">load configuration values from external sources</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>MIRRORMAKER-CONFIGURATION-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#assembly-distributed-tracing-str" target="_blank" rel="noopener">Introducing distributed tracing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-config-mirrormaker2-securing-connection-str"><a class="link" href="#proc-config-mirrormaker2-securing-connection-str">2.3.7. Securing a Kafka MirrorMaker 2.0 deployment</a></h4>
<div class="paragraph _abstract">
<p>This procedure describes in outline the configuration required to secure a MirrorMaker 2.0 deployment.</p>
</div>
<div class="paragraph">
<p>You need separate configuration for the source Kafka cluster and the target Kafka cluster.
You also need separate user configuration to provide the credentials required for MirrorMaker to connect to the source and target Kafka clusters.</p>
</div>
<div class="paragraph">
<p>For the Kafka clusters, you specify internal listeners for secure connections within a Kubernetes cluster and external listeners for connections outside the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>You can configure authentication and authorization mechanisms.
The security options implemented for the source and target Kafka clusters must be compatible with the security options implemented for MirrorMaker 2.0.</p>
</div>
<div class="paragraph">
<p>After you have created the cluster and user authentication credentials, you specify them in your MirrorMaker configuration for secure connections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this procedure, the certificates generated by the Cluster Operator are used, but you can replace them by <a href="#installing-your-own-ca-certificates-str">installing your own certificates</a>.
You can also configure your listener to <a href="./deploying.html#proc-installing-certs-per-listener-str">use a Kafka listener certificate managed by an external CA (certificate authority)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>Before starting this procedure, take a look at the <a href="./deploying.html#deploy-examples-str" target="_blank" rel="noopener">example configuration files</a> provided by Strimzi.
They include examples for securing a deployment of MirrorMaker 2.0 using mTLS or SCRAM-SHA-512 authentication.
The examples specify internal listeners for connecting within a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>The examples provide the configuration for full authorization, including all the ACLs needed by MirrorMaker 2.0 to allow operations on the source and target Kafka clusters.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi is running</p>
</li>
<li>
<p>Separate namespaces for source and target clusters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The procedure assumes that the source and target Kafka clusters are installed to separate namespaces
If you want to use the Topic Operator, you&#8217;ll need to do this.
The Topic Operator only watches a single cluster in a specified namespace.</p>
</div>
<div class="paragraph">
<p>By separating the clusters into namespaces, you will need to copy the cluster secrets so they can be accessed outside the namespace.
You need to reference the secrets in the MirrorMaker configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure two <code>Kafka</code> resources, one to secure the source Kafka cluster and one to secure the target Kafka cluster.</p>
<div class="paragraph">
<p>You can add listener configuration for authentication and enable authorization.</p>
</div>
<div class="paragraph">
<p>In this example, an internal listener is configured for a Kafka cluster with TLS encryption and mTLS authentication.
Kafka <code>simple</code> authorization is enabled.</p>
</div>
<div class="listingblock">
<div class="title">Example source Kafka cluster configuration with TLS encryption and mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-source-cluster
spec:
  kafka:
    version: 3.3.2
    replicas: 1
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
    authorization:
      type: simple
    config:
      offsets.topic.replication.factor: 1
      transaction.state.log.replication.factor: 1
      transaction.state.log.min.isr: 1
      default.replication.factor: 1
      min.insync.replicas: 1
      inter.broker.protocol.version: "3.3"
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
  zookeeper:
    replicas: 1
    storage:
      type: persistent-claim
      size: 100Gi
      deleteClaim: false
  entityOperator:
    topicOperator: {}
    userOperator: {}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example target Kafka cluster configuration with TLS encryption and mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-target-cluster
spec:
  kafka:
    version: 3.3.2
    replicas: 1
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
    authorization:
      type: simple
    config:
      offsets.topic.replication.factor: 1
      transaction.state.log.replication.factor: 1
      transaction.state.log.min.isr: 1
      default.replication.factor: 1
      min.insync.replicas: 1
      inter.broker.protocol.version: "3.3"
    storage:
      type: jbod
      volumes:
        - id: 0
          type: persistent-claim
          size: 100Gi
          deleteClaim: false
  zookeeper:
    replicas: 1
    storage:
      type: persistent-claim
      size: 100Gi
      deleteClaim: false
  entityOperator:
    topicOperator: {}
    userOperator: {}</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the <code>Kafka</code> resources in separate namespaces.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em> -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Cluster Operator creates the listeners and sets up the cluster and client certificate authority (CA) certificates to enable authentication within the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The certificates are created in the secret <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code>.</p>
</div>
</li>
<li>
<p>Configure two <code>KafkaUser</code> resources, one for a user of the source Kafka cluster and one for a user of the target Kafka cluster.</p>
<div class="openblock">
<div class="content">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Configure the same authentication and authorization types as the corresponding source and target Kafka cluster.
For example, if you used <code>tls</code> authentication and the <code>simple</code> authorization type in the <code>Kafka</code> configuration for the source Kafka cluster, use the same in the <code>KafkaUser</code> configuration.</p>
</li>
<li>
<p>Configure the ACLs needed by MirrorMaker 2.0 to allow operations on the source and target Kafka clusters.</p>
<div class="paragraph">
<p>The ACLs are used by the internal MirrorMaker connectors, and by the underlying Kafka Connect framework.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">Example source user configuration for mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-source-user
  labels:
    strimzi.io/cluster: my-source-cluster
spec:
  authentication:
    type: tls
  authorization:
    type: simple
    acls:
      # MirrorSourceConnector
      - resource: # Not needed if offset-syncs.topic.location=target
          type: topic
          name: mm2-offset-syncs.my-target-cluster.internal
        operations:
          - Create
          - DescribeConfigs
          - Read
          - Write
      - resource: # Needed for every topic which is mirrored
          type: topic
          name: "*"
        operations:
          - DescribeConfigs
          - Read
      # MirrorCheckpointConnector
      - resource:
          type: cluster
        operations:
          - Describe
      - resource: # Needed for every group for which offsets are synced
          type: group
          name: "*"
        operations:
          - Describe
      - resource: # Not needed if offset-syncs.topic.location=target
          type: topic
          name: mm2-offset-syncs.my-target-cluster.internal
        operations:
          - Read</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example target user configuration for mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-target-user
  labels:
    strimzi.io/cluster: my-target-cluster
spec:
  authentication:
    type: tls
  authorization:
    type: simple
    acls:
      # Underlying Kafka Connect internal topics to store configuration, offsets, or status
      - resource:
          type: group
          name: mirrormaker2-cluster
        operations:
          - Read
      - resource:
          type: topic
          name: mirrormaker2-cluster-configs
        operations:
          - Create
          - Describe
          - DescribeConfigs
          - Read
          - Write
      - resource:
          type: topic
          name: mirrormaker2-cluster-status
        operations:
          - Create
          - Describe
          - DescribeConfigs
          - Read
          - Write
      - resource:
          type: topic
          name: mirrormaker2-cluster-offsets
        operations:
          - Create
          - Describe
          - DescribeConfigs
          - Read
          - Write
      # MirrorSourceConnector
      - resource: # Needed for every topic which is mirrored
          type: topic
          name: "*"
        operations:
          - Create
          - Alter
          - AlterConfigs
          - Write
      # MirrorCheckpointConnector
      - resource:
          type: cluster
        operations:
          - Describe
      - resource:
          type: topic
          name: my-source-cluster.checkpoints.internal
        operations:
          - Create
          - Describe
          - Read
          - Write
      - resource: # Needed for every group for which the offset is synced
          type: group
          name: "*"
        operations:
          - Read
          - Describe
      # MirrorHeartbeatConnector
      - resource:
          type: topic
          name: heartbeats
        operations:
          - Create
          - Describe
          - Write</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can use a certificate issued outside the User Operator by setting <code>type</code> to <code>tls-external</code>.
For more information, see <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code> schema reference</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create or update a <code>KafkaUser</code> resource in each of the namespaces you created for the source and target Kafka clusters.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_user_configuration_file&gt;</em> -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The User Operator creates the users representing the client (MirrorMaker), and the security credentials used for client authentication, based on the chosen authentication type.</p>
</div>
<div class="paragraph">
<p>The User Operator creates a new secret with the same name as the <code>KafkaUser</code> resource.
The secret contains a private and public key for mTLS authentication.
The public key is contained in a user certificate, which is signed by the clients CA.</p>
</div>
</li>
<li>
<p>Configure a <code>KafkaMirrorMaker2</code> resource with the authentication details to connect to the source and target Kafka clusters.</p>
<div class="listingblock">
<div class="title">Example MirrorMaker 2.0 configuration with TLS encryption and mTLS authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker-2
spec:
  version: 3.3.2
  replicas: 1
  connectCluster: "my-target-cluster"
  clusters:
    - alias: "my-source-cluster"
      bootstrapServers: my-source-cluster-kafka-bootstrap:9093
      tls: # <b class="conum">(1)</b>
        trustedCertificates:
          - secretName: my-source-cluster-cluster-ca-cert
            certificate: ca.crt
      authentication: # <b class="conum">(2)</b>
        type: tls
        certificateAndKey:
          secretName: my-source-user
          certificate: user.crt
          key: user.key
    - alias: "my-target-cluster"
      bootstrapServers: my-target-cluster-kafka-bootstrap:9093
      tls: # <b class="conum">(3)</b>
        trustedCertificates:
          - secretName: my-target-cluster-cluster-ca-cert
            certificate: ca.crt
      authentication: # <b class="conum">(4)</b>
        type: tls
        certificateAndKey:
          secretName: my-target-user
          certificate: user.crt
          key: user.key
      config:
        # -1 means it will use the default replication factor configured in the broker
        config.storage.replication.factor: -1
        offset.storage.replication.factor: -1
        status.storage.replication.factor: -1
  mirrors:
    - sourceCluster: "my-source-cluster"
      targetCluster: "my-target-cluster"
      sourceConnector:
        config:
          replication.factor: 1
          offset-syncs.topic.replication.factor: 1
          sync.topic.acls.enabled: "false"
      heartbeatConnector:
        config:
          heartbeats.topic.replication.factor: 1
      checkpointConnector:
        config:
          checkpoints.topic.replication.factor: 1
          sync.group.offsets.enabled: "true"
      topicsPattern: "topic1|topic2|topic3"
      groupsPattern: "group1|group2|group3"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The TLS certificates for the source Kafka cluster. If they are in a separate namespace, copy the cluster secrets from the namespace of the Kafka cluster.</p>
</li>
<li>
<p>The user authentication for accessing the source Kafka cluster using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>.</p>
</li>
<li>
<p>The TLS certificates for the target Kafka cluster.</p>
</li>
<li>
<p>The user authentication for accessing the target Kafka cluster.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the <code>KafkaMirrorMaker2</code> resource in the same namespace as the target Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;mirrormaker2_configuration_file&gt;</em> -n <em>&lt;namespace_of_target_cluster&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>type-KafkaMirrorMaker2ClusterSpec-reference[]</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-restart-mirrormaker2-connector-str"><a class="link" href="#proc-manual-restart-mirrormaker2-connector-str">2.3.8. Performing a restart of a Kafka MirrorMaker 2.0 connector</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a restart of a Kafka MirrorMaker 2.0 connector by using a Kubernetes annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>KafkaMirrorMaker2</code> custom resource that controls the Kafka MirrorMaker 2.0 connector you want to restart:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get KafkaMirrorMaker2</code></pre>
</div>
</div>
</li>
<li>
<p>Find the name of the Kafka MirrorMaker 2.0 connector to be restarted from the <code>KafkaMirrorMaker2</code> custom resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe KafkaMirrorMaker2 <em>KAFKAMIRRORMAKER-2-NAME</em></code></pre>
</div>
</div>
</li>
<li>
<p>To restart the connector, annotate the <code>KafkaMirrorMaker2</code> resource in Kubernetes.
In this example, <code>kubectl annotate</code> restarts a connector named <code>my-source-&gt;my-target.MirrorSourceConnector</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate KafkaMirrorMaker2 <em>KAFKAMIRRORMAKER-2-NAME</em> "strimzi.io/restart-connector=my-source-&gt;my-target.MirrorSourceConnector"</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).</p>
<div class="paragraph">
<p>The Kafka MirrorMaker 2.0 connector is restarted, as long as the annotation was detected by the reconciliation process.
When the restart request is accepted, the annotation is removed from the <code>KafkaMirrorMaker2</code> custom resource.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-mirrormaker-str">Kafka MirrorMaker 2.0 cluster configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-restart-mirrormaker2-connector-task-str"><a class="link" href="#proc-manual-restart-mirrormaker2-connector-task-str">2.3.9. Performing a restart of a Kafka MirrorMaker 2.0 connector task</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a restart of a Kafka MirrorMaker 2.0 connector task by using a Kubernetes annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>KafkaMirrorMaker2</code> custom resource that controls the Kafka MirrorMaker 2.0 connector you want to restart:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get KafkaMirrorMaker2</code></pre>
</div>
</div>
</li>
<li>
<p>Find the name of the Kafka MirrorMaker 2.0 connector and the ID of the task to be restarted from the <code>KafkaMirrorMaker2</code> custom resource.
Task IDs are non-negative integers, starting from 0.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe KafkaMirrorMaker2 <em>KAFKAMIRRORMAKER-2-NAME</em></code></pre>
</div>
</div>
</li>
<li>
<p>To restart the connector task, annotate the <code>KafkaMirrorMaker2</code> resource in Kubernetes.
In this example, <code>kubectl annotate</code> restarts task <em>0</em> of a connector named <code>my-source-&gt;my-target.MirrorSourceConnector</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate KafkaMirrorMaker2 <em>KAFKAMIRRORMAKER-2-NAME</em> "strimzi.io/restart-connector-task=my-source-&gt;my-target.MirrorSourceConnector:0"</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).</p>
<div class="paragraph">
<p>The Kafka MirrorMaker 2.0 connector task is restarted, as long as the annotation was detected by the reconciliation process.
When the restart task request is accepted, the annotation is removed from the <code>KafkaMirrorMaker2</code> custom resource.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-mirrormaker-str">Kafka MirrorMaker 2.0 cluster configuration</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-mirror-maker-str"><a class="link" href="#assembly-deployment-configuration-kafka-mirror-maker-str">2.4. Kafka MirrorMaker cluster configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure a Kafka MirrorMaker deployment using the <code>KafkaMirrorMaker</code> resource.
KafkaMirrorMaker replicates data between Kafka clusters.</p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code> schema reference</a> describes the full schema of the <code>KafkaMirrorMaker</code> resource.</p>
</div>
<div class="paragraph">
<p>You can use Strimzi with MirrorMaker or <a href="#assembly-mirrormaker-str">MirrorMaker 2.0</a>.
MirrorMaker 2.0 is the latest version, and offers a more efficient way to mirror data between Kafka clusters.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Kafka MirrorMaker 1 (referred to as just <em>MirrorMaker</em> in the documentation) has been deprecated in Apache Kafka 3.0.0 and will be removed in Apache Kafka 4.0.0.
As a result, the <code>KafkaMirrorMaker</code> custom resource which is used to deploy Kafka MirrorMaker 1 has been deprecated in Strimzi as well.
The <code>KafkaMirrorMaker</code> resource will be removed from Strimzi when we adopt Apache Kafka 4.0.0.
As a replacement, use the <code>KafkaMirrorMaker2</code> custom resource with the <a href="#unidirectional_replication_activepassive"><code>IdentityReplicationPolicy</code></a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-kafka-mirror-maker-str"><a class="link" href="#configuring-kafka-mirror-maker-str">2.4.1. Configuring Kafka MirrorMaker</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>KafkaMirrorMaker</code> resource to configure your Kafka MirrorMaker deployment.</p>
</div>
<div class="paragraph">
<p>You can configure access control for producers and consumers using TLS or SASL authentication.
This procedure shows a configuration that uses TLS encryption and mTLS authentication on the consumer and producer side.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on running a:</p>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Source and target Kafka clusters must be available</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaMirrorMaker</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker
metadata:
  name: my-mirror-maker
spec:
  replicas: 3 <b class="conum">(1)</b>
  consumer:
    bootstrapServers: my-source-cluster-kafka-bootstrap:9092 <b class="conum">(2)</b>
    groupId: "my-group" <b class="conum">(3)</b>
    numStreams: 2 <b class="conum">(4)</b>
    offsetCommitInterval: 120000 <b class="conum">(5)</b>
    tls: <b class="conum">(6)</b>
      trustedCertificates:
      - secretName: my-source-cluster-ca-cert
        certificate: ca.crt
    authentication: <b class="conum">(7)</b>
      type: tls
      certificateAndKey:
        secretName: my-source-secret
        certificate: public.crt
        key: private.key
    config: <b class="conum">(8)</b>
      max.poll.records: 100
      receive.buffer.bytes: 32768
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(9)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(10)</b>
  producer:
    bootstrapServers: my-target-cluster-kafka-bootstrap:9092
    abortOnSendFailure: false <b class="conum">(11)</b>
    tls:
      trustedCertificates:
      - secretName: my-target-cluster-ca-cert
        certificate: ca.crt
    authentication:
      type: tls
      certificateAndKey:
        secretName: my-target-secret
        certificate: public.crt
        key: private.key
    config:
      compression.type: gzip
      batch.size: 8192
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(12)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(13)</b>
  include: "my-topic|other-topic" <b class="conum">(14)</b>
  resources: <b class="conum">(15)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(16)</b>
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  readinessProbe: <b class="conum">(17)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  metricsConfig: <b class="conum">(18)</b>
   type: jmxPrometheusExporter
   valueFrom:
     configMapKeyRef:
       name: my-config-map
       key: my-key
  jvmOptions: <b class="conum">(19)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(20)</b>
  template: <b class="conum">(21)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: <b class="conum">(22)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing: <b class="conum">(23)</b>
    type: jaeger</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap servers</a> for consumer and producer.</p>
</li>
<li>
<p><a href="#property-consumer-group-reference">Group ID for the consumer</a>.</p>
</li>
<li>
<p><a href="#property-consumer-streams-reference">The number of consumer streams</a>.</p>
</li>
<li>
<p><a href="#property-consumer-offset-autocommit-reference">The offset auto-commit interval in milliseconds</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for consumer or producer. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p>Authentication for consumer or producer, specified as <a href="#type-KafkaClientAuthenticationTls-reference">mTLS</a>, <a href="#type-KafkaClientAuthenticationOAuth-reference">token-based OAuth</a>, SASL-based <a href="#type-KafkaClientAuthenticationScramSha256-reference">SCRAM-SHA-256</a>/<a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a>, or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a>.</p>
</li>
<li>
<p>Kafka configuration options for <a href="#property-consumer-config-reference">consumer</a> and <a href="#property-producer-config-reference">producer</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMakerConsumerSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>If the <a href="#property-producer-abort-on-send-reference"><code>abortOnSendFailure</code> property</a> is set to <code>true</code>, Kafka MirrorMaker will exit and the container will restart following a send failure for a message.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMakerProducerSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>A <a href="#property-mm-include-reference">included topics</a> mirrored from source to target Kafka cluster.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-mm-loggers-reference">loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. MirrorMaker has a single logger called <code>mirrormaker.root.logger</code>. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a>, which are enabled by referencing a ConfigMap containing configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using a reference to a ConfigMap containing an empty file under <code>metricsConfig.valueFrom.configMapKeyRef.key</code>.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka MirrorMaker.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are set for distributed tracing.</p>
</li>
<li>
<p>Distributed tracing is enabled for Jaeger.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
With the <code>abortOnSendFailure</code> property set to <code>false</code>, the producer attempts to send the next message in a topic. The original message might be lost, as there is no attempt to resend a failed message.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;your-file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#assembly-distributed-tracing-str" target="_blank" rel="noopener">Introducing distributed tracing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-mirror-maker-resources-str"><a class="link" href="#ref-list-of-kafka-mirror-maker-resources-str">2.4.2. List of Kafka MirrorMaker cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Deployment which is responsible for creating the Kafka MirrorMaker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-config</dt>
<dd>
<p>ConfigMap which contains ancillary configuration for the Kafka MirrorMaker, and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka MirrorMaker worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-config-kafka-bridge-str"><a class="link" href="#assembly-config-kafka-bridge-str">2.5. Kafka Bridge cluster configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure a Kafka Bridge deployment using the <code>KafkaBridge</code> resource.
Kafka Bridge provides an API for integrating HTTP-based clients with a Kafka cluster.</p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaBridge-reference"><code>KafkaBridge</code> schema reference</a> describes the full schema of the <code>KafkaBridge</code> resource.</p>
</div>
<div class="sect3">
<h4 id="proc-config-kafka-bridge-str"><a class="link" href="#proc-config-kafka-bridge-str">2.5.1. Configuring the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Use the Kafka Bridge to make HTTP-based requests to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Use the properties of the <code>KafkaBridge</code> resource to configure your Kafka Bridge deployment.</p>
</div>
<div class="paragraph">
<p>In order to prevent issues arising when client consumer requests are processed by different Kafka Bridge instances, address-based routing must be employed to ensure that requests are routed to the right Kafka Bridge instance.
Additionally, each independent Kafka Bridge instance must have a replica.
A Kafka Bridge instance has its own state which is not shared with another instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <em>Deploying and Upgrading Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaBridge</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  replicas: 3 <b class="conum">(1)</b>
  bootstrapServers: <em>&lt;cluster_name&gt;</em>-cluster-kafka-bootstrap:9092 <b class="conum">(2)</b>
  tls: <b class="conum">(3)</b>
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
      - secretName: my-cluster-cluster-cert
        certificate: ca2.crt
  authentication: <b class="conum">(4)</b>
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: public.crt
      key: private.key
  http: <b class="conum">(5)</b>
    port: 8080
    cors: <b class="conum">(6)</b>
      allowedOrigins: "https://strimzi.io"
      allowedMethods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  consumer: <b class="conum">(7)</b>
    config:
      auto.offset.reset: earliest
  producer: <b class="conum">(8)</b>
    config:
      delivery.timeout.ms: 300000
  resources: <b class="conum">(9)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(10)</b>
    type: inline
    loggers:
      logger.bridge.level: "INFO"
      # enabling DEBUG just for send operation
      logger.send.name: "http.openapi.operation.send"
      logger.send.level: "DEBUG"
  jvmOptions: <b class="conum">(11)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  readinessProbe: <b class="conum">(12)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  image: my-org/my-image:latest <b class="conum">(13)</b>
  template: <b class="conum">(14)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    bridgeContainer: <b class="conum">(15)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the target Kafka cluster. Use the name of the Kafka cluster as the <em>&lt;cluster_name&gt;</em>.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the source Kafka cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p>Authentication for the Kafka Bridge cluster, specified as <a href="#type-KafkaClientAuthenticationTls-reference">mTLS</a>, <a href="#type-KafkaClientAuthenticationOAuth-reference">token-based OAuth</a>, SASL-based <a href="#type-KafkaClientAuthenticationScramSha256-reference">SCRAM-SHA-256</a>/<a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a>, or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a>.
By default, the Kafka Bridge connects to Kafka brokers without authentication.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeHttpConfig-reference">HTTP access</a> to Kafka brokers.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeHttpConfig-reference">CORS access</a> specifying selected resources and access methods. Additional HTTP headers in requests describe the origins that are permitted access to the Kafka cluster.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeConsumerSpec-reference">Consumer configuration</a> options.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeProducerSpec-reference">Producer configuration</a> options.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-bridge-logging-reference">Kafka Bridge loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Bridge loggers, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running the Kafka Bridge.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p>Optional: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are set for distributed tracing.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>KAFKA-BRIDGE-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Using the Strimzi Kafka Bridge</a></p>
</li>
<li>
<p><a href="./deploying.html#assembly-distributed-tracing-str" target="_blank" rel="noopener">Introducing distributed tracing</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-bridge-resources-str"><a class="link" href="#ref-list-of-kafka-bridge-resources-str">2.5.2. List of Kafka Bridge cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Bridge worker node pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-service</dt>
<dd>
<p>Service which exposes the REST interface of the Kafka Bridge cluster.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Bridge ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Bridge worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-customizing-kubernetes-resources-str"><a class="link" href="#assembly-customizing-kubernetes-resources-str">2.6. Customizing Kubernetes resources</a></h3>
<div class="paragraph _abstract">
<p>A Strimzi deployment creates Kubernetes resources, such as <code>Deployments</code>, <code>StatefulSets</code>, <code>Pods</code>, and <code>Services</code>.
These resources are managed by Strimzi operators.
Only the operator that is responsible for managing a particular Kubernetes resource can change that resource.
If you try to manually change an operator-managed Kubernetes resource, the operator will revert your changes back.</p>
</div>
<div class="paragraph">
<p>Changing an operator-managed Kubernetes resource can be useful if you want to perform certain tasks, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding custom labels or annotations that control how <code>Pods</code> are treated by Istio or other services</p>
</li>
<li>
<p>Managing how <code>Loadbalancer</code>-type Services are created by the cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can make the changes using the <code>template</code> property in the Strimzi custom resources.
The <code>template</code> property is supported in the following resources.
The API reference provides more details about the customizable fields.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Kafka.spec.kafka</code></dt>
<dd>
<p>See <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.zookeeper</code></dt>
<dd>
<p>See <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.entityOperator</code></dt>
<dd>
<p>See <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.kafkaExporter</code></dt>
<dd>
<p>See <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.cruiseControl</code></dt>
<dd>
<p>See <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.jmxTrans</code></dt>
<dd>
<p>See <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaConnect.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaMirrorMaker.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaMirrorMaker2.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaBridge.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaUser.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code> schema reference</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the following example, the <code>template</code> property is used to modify the labels in a Kafka broker&#8217;s pod.</p>
</div>
<div class="listingblock">
<div class="title">Example template customization</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
  labels:
    app: my-cluster
spec:
  kafka:
    # ...
    template:
      pod:
        metadata:
          labels:
            mylabel: myvalue
    # ...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-image-pull-policy-str"><a class="link" href="#con-customizing-image-pull-policy-str">2.6.1. Customizing the image pull policy</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the image pull policy for containers in all pods deployed by the Cluster Operator.
The image pull policy is configured using the environment variable <code>STRIMZI_IMAGE_PULL_POLICY</code> in the Cluster Operator deployment.
The <code>STRIMZI_IMAGE_PULL_POLICY</code> environment variable can be set to three different values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Always</code></dt>
<dd>
<p>Container images are pulled from the registry every time the pod is started or restarted.</p>
</dd>
<dt class="hdlist1"><code>IfNotPresent</code></dt>
<dd>
<p>Container images are pulled from the registry only when they were not pulled before.</p>
</dd>
<dt class="hdlist1"><code>Never</code></dt>
<dd>
<p>Container images are never pulled from the registry.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The image pull policy can be currently customized only for all Kafka, Kafka Connect, and Kafka MirrorMaker clusters at once.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Cluster Operator configuration, see <a href="#using-the-cluster-operator-str">Using the Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about Image Pull Policies, see <a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images" target="_blank" rel="noopener">Disruptions</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-applying-termination-grace-period-str"><a class="link" href="#con-applying-termination-grace-period-str">2.6.2. Applying a termination grace period</a></h4>
<div class="paragraph _abstract">
<p>Apply a termination grace period to give a Kafka cluster enough time to shut down cleanly.</p>
</div>
<div class="paragraph">
<p>Specify the time using the <code>terminationGracePeriodSeconds</code> property.
Add the property to the <code>template.pod</code> configuration of the <code>Kafka</code> custom resource.</p>
</div>
<div class="paragraph">
<p>The time you add will depend on the size of your Kafka cluster.
The Kubernetes default for the termination grace period is 30 seconds.
If you observe that your clusters are not shutting down cleanly, you can increase the termination grace period.</p>
</div>
<div class="paragraph">
<p>A termination grace period is applied every time a pod is restarted.
The period begins when Kubernetes sends a <em>term</em> (termination) signal to the processes running in the pod.
The period should reflect the amount of time required to transfer the processes of the terminating pod to another pod before they are stopped.
After the period ends, a <em>kill</em> signal stops any processes still running in the pod.</p>
</div>
<div class="paragraph">
<p>The following example adds a termination grace period of 120 seconds to the <code>Kafka</code> custom resource.
You can also specify the configuration in the custom resources of other Kafka components.</p>
</div>
<div class="listingblock">
<div class="title">Example termination grace period configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    template:
      pod:
        terminationGracePeriodSeconds: 120
        # ...
    # ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-scheduling-str"><a class="link" href="#assembly-scheduling-str">2.7. Configuring pod scheduling</a></h3>
<div class="paragraph">
<p>When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.</p>
</div>
<div class="sect3">
<h4 id="affinity-str"><a class="link" href="#affinity-str">2.7.1. Specifying affinity, tolerations, and topology spread constraints</a></h4>
<div class="paragraph">
<p>Use affinity, tolerations and topology spread constraints to schedule the pods of kafka resources onto nodes.
Affinity, tolerations and topology spread constraints are configured using the <code>affinity</code>, <code>tolerations</code>, and <code>topologySpreadConstraint</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker2.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code>, <code>tolerations</code>, and <code>topologySpreadConstraint</code> properties follows the Kubernetes specification.
The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/" target="_blank" rel="noopener">Kubernetes Topology Spread Constraints</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="con-scheduling-based-on-other-pods-str"><a class="link" href="#con-scheduling-based-on-other-pods-str">Use pod anti-affinity to avoid critical applications sharing nodes</a></h5>
<div class="paragraph">
<p>Use pod anti-affinity to ensure that critical applications are never scheduled on the same disk.
When running a Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share nodes with other workloads, such as databases.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-scheduling-to-specific-nodes-str"><a class="link" href="#con-scheduling-to-specific-nodes-str">Use node affinity to schedule workloads onto specific nodes</a></h5>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-dedicated-nodes-str"><a class="link" href="#con-dedicated-nodes-str">Use node affinity and tolerations for dedicated nodes</a></h5>
<div class="paragraph">
<p>Use taints to create dedicated nodes, then schedule Kafka pods on the dedicated nodes by configuring node affinity and tolerations.</p>
</div>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-pod-anti-affinity-to-schedule-each-kafka-broker-on-a-different-worker-node-str"><a class="link" href="#configuring-pod-anti-affinity-to-schedule-each-kafka-broker-on-a-different-worker-node-str">2.7.2. Configuring pod anti-affinity to schedule each Kafka broker on a different worker node</a></h4>
<div class="paragraph">
<p>Many Kafka brokers or ZooKeeper nodes can run on the same Kubernetes worker node.
If the worker node fails, they will all become unavailable at the same time.
To improve reliability, you can use <code>podAntiAffinity</code> configuration to schedule each Kafka broker or ZooKeeper node on a different Kubernetes worker node.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
To make sure that no worker nodes are shared by Kafka brokers or ZooKeeper nodes, use the <code>strimzi.io/name</code> label.
Set the <code>topologyKey</code> to <code>kubernetes.io/hostname</code> to specify that the selected pods are not scheduled on nodes with the same hostname.
This will still allow the same worker node to be shared by a single Kafka broker and a single ZooKeeper node.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: strimzi.io/name
                      operator: In
                      values:
                        - <em>CLUSTER-NAME</em>-kafka
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: strimzi.io/name
                      operator: In
                      values:
                        - <em>CLUSTER-NAME</em>-zookeeper
                topologyKey: "kubernetes.io/hostname"
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>CLUSTER-NAME</em></code> is the name of your Kafka custom resource.</p>
</div>
</li>
<li>
<p>If you even want to make sure that a Kafka broker and ZooKeeper node do not share the same worker node, use the <code>strimzi.io/cluster</code> label.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: strimzi.io/cluster
                      operator: In
                      values:
                        - <em>CLUSTER-NAME</em>
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: strimzi.io/cluster
                      operator: In
                      values:
                        - <em>CLUSTER-NAME</em>
                topologyKey: "kubernetes.io/hostname"
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>CLUSTER-NAME</em></code> is the name of your Kafka custom resource.</p>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-pod-anti-affinity-in-kafka-components-str"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-str">2.7.3. Configuring pod anti-affinity in Kafka components</a></h4>
<div class="paragraph">
<p>Pod anti-affinity configuration helps with the stability and performance of Kafka brokers. By using <code>podAntiAffinity</code>, Kubernetes will not schedule Kafka brokers on the same nodes as other workloads.
Typically, you want to avoid Kafka running on the same worker node as other network or storage intensive applications such as databases, storage or other messaging platforms.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-node-affinity-str"><a class="link" href="#proc-configuring-node-affinity-str">2.7.4. Configuring node affinity in Kafka components</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl label node <em>NAME-OF-NODE</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-dedicated-nodes-str"><a class="link" href="#proc-dedicated-nodes-str">2.7.5. Setting up dedicated nodes and scheduling pods on them</a></h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl taint node <em>NAME-OF-NODE</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl label node <em>NAME-OF-NODE</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-logging_str"><a class="link" href="#external-logging_str">2.8. Logging configuration</a></h3>
<div class="paragraph _abstract">
<p>Configure logging levels in the custom resources of Kafka components and Strimzi Operators.
You can specify the logging levels directly in the <code>spec.logging</code> property of the custom resource.
Or you can define the logging properties in a ConfigMap that&#8217;s referenced in the custom resource using the <code>configMapKeyRef</code> property.</p>
</div>
<div class="paragraph">
<p>The advantages of using a ConfigMap are that the logging properties are maintained in one place and are accessible to more than one resource.
You can also reuse the ConfigMap for more than one resource.
If you are using a ConfigMap to specify loggers for Strimzi Operators, you can also append the logging specification to add filters.</p>
</div>
<div class="paragraph">
<p>You specify a logging <code>type</code> in your logging specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>inline</code> when specifying logging levels directly</p>
</li>
<li>
<p><code>external</code> when referencing a ConfigMap</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>inline</code> logging configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">spec:
  # ...
  logging:
    type: inline
    loggers:
      kafka.root.logger.level: "INFO"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>external</code> logging configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: my-config-map
        key: my-config-map-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>Values for the <code>name</code> and <code>key</code> of the ConfigMap are mandatory.
Default logging is used if the <code>name</code> or <code>key</code> is not set.</p>
</div>
<div class="sect3">
<h4 id="logging_options_for_kafka_components_and_operators"><a class="link" href="#logging_options_for_kafka_components_and_operators">2.8.1. Logging options for Kafka components and operators</a></h4>
<div class="paragraph">
<p>For more information on configuring logging for specific Kafka components or operators, see the following sections.</p>
</div>
<div class="ulist">
<div class="title">Kafka component logging</div>
<ul>
<li>
<p><a href="#property-kafka-logging-reference">Kafka logging</a></p>
</li>
<li>
<p><a href="#property-zookeeper-logging-reference">ZooKeeper logging</a></p>
</li>
<li>
<p><a href="#property-kafka-connect-logging-reference">Kafka Connect and Mirror Maker 2.0 logging</a></p>
</li>
<li>
<p><a href="#property-mm-loggers-reference">MirrorMaker logging</a></p>
</li>
<li>
<p><a href="#property-kafka-bridge-logging-reference">Kafka Bridge logging</a></p>
</li>
<li>
<p><a href="#property-cruise-control-logging-reference">Cruise Control logging</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Operator logging</div>
<ul>
<li>
<p><a href="#ref-operator-cluster-logging-configmap-str">Cluster Operator logging</a></p>
</li>
<li>
<p><a href="#property-topic-operator-logging-reference">Topic Operator logging</a></p>
</li>
<li>
<p><a href="#property-user-operator-logging-reference">User Operator logging</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="creating-configmap_str"><a class="link" href="#creating-configmap_str">2.8.2. Creating a ConfigMap for logging</a></h4>
<div class="paragraph _abstract">
<p>To use a ConfigMap to define logging properties, you create the ConfigMap and then reference it as part of the logging definition in the <code>spec</code> of a resource.</p>
</div>
<div class="paragraph">
<p>The ConfigMap must contain the appropriate logging configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j.properties</code> for Kafka components, ZooKeeper, and the Kafka Bridge</p>
</li>
<li>
<p><code>log4j2.properties</code> for the Topic Operator and User Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The configuration must be placed under these properties.</p>
</div>
<div class="paragraph">
<p>In this procedure a ConfigMap defines a root logger for a Kafka resource.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the ConfigMap.</p>
<div class="paragraph">
<p>You can create the ConfigMap as a YAML file or from a properties file.</p>
</div>
<div class="paragraph">
<p>ConfigMap example with a root logger definition for Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: logging-configmap
data:
  log4j.properties:
    kafka.root.logger.level="INFO"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a properties file, specify the file at the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create configmap logging-configmap --from-file=log4j.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties file defines the logging configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text"># Define the logger
kafka.root.logger.level="INFO"
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Define <em>external</em> logging in the <code>spec</code> of the resource, setting the <code>logging.valueFrom.configMapKeyRef.name</code> to the name of the ConfigMap and <code>logging.valueFrom.configMapKeyRef.key</code> to the key in this ConfigMap.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: logging-configmap
        key: log4j.properties</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-logging-filters_str"><a class="link" href="#creating-logging-filters_str">2.8.3. Adding logging filters to Operators</a></h4>
<div class="paragraph _abstract">
<p>If you are using a ConfigMap to configure the (log4j2) logging levels for Strimzi Operators,
you can also define logging filters to limit what&#8217;s returned in the log.</p>
</div>
<div class="paragraph">
<p>Logging filters are useful when you have a large number of logging messages.
Suppose you set the log level for the logger as DEBUG (<code>rootLogger.level="DEBUG"</code>).
Logging filters reduce the number of logs returned for the logger at that level, so you can focus on a specific resource.
When the filter is set, only log messages matching the filter are logged.</p>
</div>
<div class="paragraph">
<p>Filters use <em>markers</em> to specify what to include in the log.
You specify a kind, namespace and name for the marker.
For example, if a Kafka cluster is failing, you can isolate the logs by specifying the kind as <code>Kafka</code>, and use the namespace and name of the failing cluster.</p>
</div>
<div class="paragraph">
<p>This example shows a marker filter for a Kafka cluster named <code>my-kafka-cluster</code>.</p>
</div>
<div class="listingblock">
<div class="title">Basic logging filter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">rootLogger.level="INFO"
appender.console.filter.filter1.type=MarkerFilter <b class="conum">(1)</b>
appender.console.filter.filter1.onMatch=ACCEPT <b class="conum">(2)</b>
appender.console.filter.filter1.onMismatch=DENY <b class="conum">(3)</b>
appender.console.filter.filter1.marker=Kafka(my-namespace/my-kafka-cluster) <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>MarkerFilter</code> type compares a specified marker for filtering.</p>
</li>
<li>
<p>The <code>onMatch</code> property accepts the log if the marker matches.</p>
</li>
<li>
<p>The <code>onMismatch</code> property rejects the log if the marker does not match.</p>
</li>
<li>
<p>The marker used for filtering is in the format <em>KIND(NAMESPACE/NAME-OF-RESOURCE)</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can create one or more filters.
Here, the log is filtered for two Kafka clusters.</p>
</div>
<div class="listingblock">
<div class="title">Multiple logging filter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">appender.console.filter.filter1.type=MarkerFilter
appender.console.filter.filter1.onMatch=ACCEPT
appender.console.filter.filter1.onMismatch=DENY
appender.console.filter.filter1.marker=Kafka(my-namespace/my-kafka-cluster-1)
appender.console.filter.filter2.type=MarkerFilter
appender.console.filter.filter2.onMatch=ACCEPT
appender.console.filter.filter2.onMismatch=DENY
appender.console.filter.filter2.marker=Kafka(my-namespace/my-kafka-cluster-2)</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Adding filters to the Cluster Operator</div>
<p>To add filters to the Cluster Operator, update its logging ConfigMap YAML file (<code>install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</code>).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the <code>050-ConfigMap-strimzi-cluster-operator.yaml</code> file to add the filter properties to the ConfigMap.</p>
<div class="paragraph">
<p>In this example, the filter properties return logs only for the <code>my-kafka-cluster</code> Kafka cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: strimzi-cluster-operator
data:
  log4j2.properties:
    #...
    appender.console.filter.filter1.type=MarkerFilter
    appender.console.filter.filter1.onMatch=ACCEPT
    appender.console.filter.filter1.onMismatch=DENY
    appender.console.filter.filter1.marker=Kafka(my-namespace/my-kafka-cluster)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, edit the <code>ConfigMap</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit configmap strimzi-cluster-operator</code></pre>
</div>
</div>
</li>
<li>
<p>If you updated the YAML file instead of editing the <code>ConfigMap</code> directly, apply the changes by deploying the ConfigMap:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Adding filters to the Topic Operator or User Operator</div>
<p>To add filters to the Topic Operator or User Operator, create or edit a logging ConfigMap.</p>
</div>
<div class="paragraph">
<p>In this procedure a logging ConfigMap is created with filters for the Topic Operator.
The same approach is used for the User Operator.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the ConfigMap.</p>
<div class="paragraph">
<p>You can create the ConfigMap as a YAML file or from a properties file.</p>
</div>
<div class="paragraph">
<p>In this example, the filter properties return logs only for the <code>my-topic</code> topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: logging-configmap
data:
  log4j2.properties:
    rootLogger.level="INFO"
    appender.console.filter.filter1.type=MarkerFilter
    appender.console.filter.filter1.onMatch=ACCEPT
    appender.console.filter.filter1.onMismatch=DENY
    appender.console.filter.filter1.marker=KafkaTopic(my-namespace/my-topic)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using a properties file, specify the file at the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create configmap logging-configmap --from-file=log4j2.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties file defines the logging configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text"># Define the logger
rootLogger.level="INFO"
# Set the filters
appender.console.filter.filter1.type=MarkerFilter
appender.console.filter.filter1.onMatch=ACCEPT
appender.console.filter.filter1.onMismatch=DENY
appender.console.filter.filter1.marker=KafkaTopic(my-namespace/my-topic)
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Define <em>external</em> logging in the <code>spec</code> of the resource, setting the <code>logging.valueFrom.configMapKeyRef.name</code> to the name of the ConfigMap and <code>logging.valueFrom.configMapKeyRef.key</code> to the key in this ConfigMap.</p>
<div class="paragraph">
<p>For the Topic Operator, logging is specified in the <code>topicOperator</code> configuration of the <code>Kafka</code> resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">spec:
  # ...
  entityOperator:
    topicOperator:
      logging:
        type: external
        valueFrom:
          configMapKeyRef:
            name: logging-configmap
            key: log4j2.properties</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the changes by deploying the Cluster Operator:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">create -f install/cluster-operator -n my-cluster-operator-namespace</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-config-kafka-str">Configuring Kafka</a></p>
</li>
<li>
<p><a href="#ref-operator-cluster-logging-configmap-str">Cluster Operator logging</a></p>
</li>
<li>
<p><a href="#property-topic-operator-logging-reference">Topic Operator logging</a></p>
</li>
<li>
<p><a href="#property-user-operator-logging-reference">User Operator logging</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-loading-config-with-providers-str"><a class="link" href="#assembly-loading-config-with-providers-str">3. Loading configuration values from external sources</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Use configuration provider plugins to load configuration data from external sources.
The providers operate independently of Strimzi.
You can use them to load configuration data for all Kafka components, including producers and consumers.
Use them, for example, to provide the credentials for Kafka Connect connector configuration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Kubernetes Configuration Provider</dt>
<dd>
<p>The Kubernetes Configuration Provider plugin loads configuration data from Kubernetes secrets or ConfigMaps.</p>
<div class="paragraph">
<p>Suppose you have a <code>Secret</code> object that&#8217;s managed outside the Kafka namespace, or outside the Kafka cluster.
The Kubernetes Configuration Provider allows you to reference the values of the secret in your configuration without extracting the files.
You just need to tell the provider what secret to use and provide access rights.
The provider loads the data without needing to restart the Kafka component, even when using a new <code>Secret</code> or <code>ConfigMap</code> object.
This capability avoids disruption when a Kafka Connect instance hosts multiple connectors.</p>
</div>
</dd>
<dt class="hdlist1">Environment Variables Configuration Provider</dt>
<dd>
<p>The Environment Variables Configuration Provider plugin loads configuration data from environment variables.</p>
<div class="paragraph">
<p>The values for the environment variables can be mapped from secrets or ConfigMaps.
You can use the Environment Variables Configuration Provider, for example, to load certificates or JAAS configuration from environment variables mapped from Kubernetes secrets.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Kubernetes Configuration Provider can&#8217;t use mounted files.
For example, it can&#8217;t load values that need the location of a truststore or keystore.
Instead, you can mount ConfigMaps or secrets into a Kafka Connect pod as environment variables or volumes.
You can use the Environment Variables Configuration Provider to load values for environment variables.
You add configuration using the <a href="#type-ExternalConfiguration-reference"><code>externalConfiguration</code> property</a> in <code>KafkaConnect.spec</code>.
You don&#8217;t need to set up access rights with this approach.
However, Kafka Connect will need a restart when using a new <code>Secret</code> or <code>ConfigMap</code> for a connector.
This will cause disruption to all the Kafka Connect instance&#8217;s connectors.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="proc-loading-config-from-config-map-str"><a class="link" href="#proc-loading-config-from-config-map-str">3.1. Loading configuration values from a ConfigMap</a></h3>
<div class="paragraph _abstract">
<p>This procedure shows how to use the Kubernetes Configuration Provider plugin.</p>
</div>
<div class="paragraph">
<p>In the procedure, an external <code>ConfigMap</code> object provides configuration properties for a connector.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>A Kafka cluster is running.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>ConfigMap</code> or <code>Secret</code> that contains the configuration properties.</p>
<div class="paragraph">
<p>In this example, a <code>ConfigMap</code> object named <code>my-connector-configuration</code> contains connector properties:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ConfigMap</code> with connector properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: my-connector-configuration
data:
  option1: value1
  option2: value2</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the Kubernetes Configuration Provider in the Kafka Connect configuration.</p>
<div class="paragraph">
<p>The specification shown here can support loading values from secrets and ConfigMaps.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration to enable the Kubernetes Configuration Provider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
  annotations:
    strimzi.io/use-connector-resources: "true"
spec:
  # ...
  config:
    # ...
    config.providers: secrets,configmaps # <b class="conum">(1)</b>
    config.providers.secrets.class: io.strimzi.kafka.KubernetesSecretConfigProvider # <b class="conum">(2)</b>
    config.providers.configmaps.class: io.strimzi.kafka.KubernetesConfigMapConfigProvider # <b class="conum">(3)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The alias for the configuration provider is used to define other configuration parameters.
The provider parameters use the alias from <code>config.providers</code>, taking the form <code>config.providers.${alias}.class</code>.</p>
</li>
<li>
<p><code>KubernetesSecretConfigProvider</code> provides values from secrets.</p>
</li>
<li>
<p><code>KubernetesConfigMapConfigProvider</code> provides values from config maps.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource to enable the provider.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_connect_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create a role that permits access to the values in the external config map.</p>
<div class="listingblock">
<div class="title">Example role to access values from a config map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: connector-configuration-role
rules:
- apiGroups: [""]
  resources: ["configmaps"]
  resourceNames: ["my-connector-configuration"]
  verbs: ["get"]
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rule gives the role permission to access the <code>my-connector-configuration</code> config map.</p>
</div>
</li>
<li>
<p>Create a role binding to permit access to the namespace that contains the config map.</p>
<div class="listingblock">
<div class="title">Example role binding to access the namespace that contains the config map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: connector-configuration-role-binding
subjects:
- kind: ServiceAccount
  name: my-connect-connect
  namespace: my-project
roleRef:
  kind: Role
  name: connector-configuration-role
  apiGroup: rbac.authorization.k8s.io
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The role binding gives the role permission to access the <code>my-project</code> namespace.</p>
</div>
<div class="paragraph">
<p>The service account must be the same one used by the Kafka Connect deployment.
The service account name format is <em>&lt;cluster_name&gt;</em>-connect, where <em>&lt;cluster_name&gt;</em> is the name of the <code>KafkaConnect</code> custom resource.</p>
</div>
</li>
<li>
<p>Reference the config map in the connector configuration.</p>
<div class="listingblock">
<div class="title">Example connector configuration referencing the config map</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: my-connector
  labels:
    strimzi.io/cluster: my-connect
spec:
  # ...
  config:
    option: ${configmaps:my-project/my-connector-configuration:option1}
    # ...
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Placeholders for the property values in the config map are referenced in the connector configuration.
The placeholder structure is <code>configmaps:<em>&lt;path_and_file_name&gt;</em>:<em>&lt;property&gt;</em></code>.
<code>KubernetesConfigMapConfigProvider</code> reads and extracts the <em>option1</em> property value from the external config map.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-loading-config-from-env-vars-str"><a class="link" href="#proc-loading-config-from-env-vars-str">3.2. Loading configuration values from environment variables</a></h3>
<div class="paragraph _abstract">
<p>This procedure shows how to use the Environment Variables Configuration Provider plugin.</p>
</div>
<div class="paragraph">
<p>In the procedure, environment variables provide configuration properties for a connector.
A database password is specified as an environment variable.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>A Kafka cluster is running.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Specify the Environment Variables Configuration Provider in the Kafka Connect configuration.</p>
<div class="paragraph">
<p>Define environment variables using the <a href="#type-ExternalConfiguration-reference"><code>externalConfiguration</code> property</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration to enable the Environment Variables Configuration Provider</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
  annotations:
    strimzi.io/use-connector-resources: "true"
spec:
  # ...
  config:
    # ...
    config.providers: env # <b class="conum">(1)</b>
    config.providers.env.class: io.strimzi.kafka.EnvVarConfigProvider # <b class="conum">(2)</b>
  # ...
  externalConfiguration:
    env:
      - name: DB_PASSWORD # <b class="conum">(3)</b>
        valueFrom:
          secretKeyRef:
            name: db-creds # <b class="conum">(4)</b>
            key: dbPassword # <b class="conum">(5)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The alias for the configuration provider is used to define other configuration parameters.
The provider parameters use the alias from <code>config.providers</code>, taking the form <code>config.providers.${alias}.class</code>.</p>
</li>
<li>
<p><code>EnvVarConfigProvider</code> provides values from environment variables.</p>
</li>
<li>
<p>The <code>DB_PASSWORD</code> environment variable takes a  password value from a secret.</p>
</li>
<li>
<p>The name of the secret containing the predefined password.</p>
</li>
<li>
<p>The key for the password stored inside the secret.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource to enable the provider.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_connect_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Reference the environment variable in the connector configuration.</p>
<div class="listingblock">
<div class="title">Example connector configuration referencing the environment variable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: my-connector
  labels:
    strimzi.io/cluster: my-connect
spec:
  # ...
  config:
    option: ${env:DB_PASSWORD}
    # ...
# ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-security-providers-str"><a class="link" href="#assembly-security-providers-str">4. Applying security context to Strimzi pods and containers</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Security context defines constraints on pods and containers.
By specifying a security context, pods and containers only have the permissions they need.
For example, permissions can control runtime operations or access to resources.</p>
</div>
<div class="sect2">
<h3 id="con-config-security-providers-str"><a class="link" href="#con-config-security-providers-str">4.1. How to configure security context</a></h3>
<div class="paragraph _abstract">
<p>Use security provider plugins or template configuration to apply security context to Strimzi pods and containers.</p>
</div>
<div class="paragraph">
<p>Apply security context at the pod or container level:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Pod-level security context</dt>
<dd>
<p>Pod-level security context is applied to all containers in a specific pod.</p>
</dd>
<dt class="hdlist1">Container-level security context</dt>
<dd>
<p>Container-level security context is applied to a specific container.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>With Strimzi, security context is applied through one or both of the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Template configuration</dt>
<dd>
<p>Use <code>template</code> configuration of Strimzi custom resources to specify security context at the pod or container level.</p>
</dd>
<dt class="hdlist1">Pod security provider plugins</dt>
<dd>
<p>Use pod security provider plugins to automatically set security context across all pods and containers using preconfigured settings.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Pod security providers offer a simpler alternative to specifying security context through <code>template</code> configuration.
You can use both approaches.
The <code>template</code> approach has a higher priority.
Security context configured through <code>template</code> properties overrides the configuration set by pod security providers.
So you might use pod security providers to automatically configure the security context for most containers.
And also use <code>template</code> configuration to set container-specific security context where needed.</p>
</div>
<div class="paragraph">
<p>The <code>template</code> approach provides flexibility, but it also means you have to configure security context in numerous places to capture the security you want for all pods and containers.
For example, you&#8217;ll need to apply the configuration to each pod in a Kafka cluster, as well as the pods for deployments of other Kafka components.</p>
</div>
<div class="paragraph">
<p>To avoid repeating the same configuration, you can use the following pod security provider plugins so that the security configuration is in one place.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Baseline Provider</dt>
<dd>
<p>The Baseline Provider is based on the Kubernetes <em>baseline</em> security profile. The baseline profile prevents privilege escalations and defines other standard access controls and limitations.</p>
</dd>
<dt class="hdlist1">Restricted Provider</dt>
<dd>
<p>The Restricted Provider is based on the Kubernetes <em>restricted</em> security profile. The restricted profile is more restrictive than the baseline profile, and is used where security needs to be tighter.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For more information on the Kubernetes security profiles, see <a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/" target="_blank" rel="noopener">Pod security standards</a>.</p>
</div>
<div class="sect3">
<h4 id="template_configuration_for_security_context"><a class="link" href="#template_configuration_for_security_context">4.1.1. Template configuration for security context</a></h4>
<div class="paragraph">
<p>In the following example, security context is configured for Kafka brokers in the <code>template</code> configuration of the <code>Kafka</code> resource.
Security context is specified at the pod and container level.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>template</code> configuration for security context</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: {KafkaApiVersion}
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  kafka:
    template:
      pod: # <b class="conum">(1)</b>
        securityContext:
          runAsUser: 1000001
          fsGroup: 0
      kafkaContainer: # <b class="conum">(2)</b>
        securityContext:
          runAsUser: 2000
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Pod security context</p>
</li>
<li>
<p>Container security context of the Kafka broker container</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="baseline_provider_for_pod_security"><a class="link" href="#baseline_provider_for_pod_security">4.1.2. Baseline Provider for pod security</a></h4>
<div class="paragraph">
<p>The Baseline Provider is the default pod security provider.
It configures the pods managed by Strimzi with a baseline security profile.
The baseline profile is compatible with previous versions of Strimzi.</p>
</div>
<div class="paragraph">
<p>The Baseline Provider is enabled by default if you don&#8217;t specify a provider.
Though you can enable it explicitly by setting the <code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code> environment variable to <code>baseline</code> when <a href="#ref-operator-cluster-str">configuring the Cluster Operator</a>.</p>
</div>
<div class="listingblock">
<div class="title">Configuration for the Baseline Provider</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml"># ...
env:
  # ...
  - name: STRIMZI_POD_SECURITY_PROVIDER_CLASS
    value: baseline
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of specifying <code>baseline</code> as the value, you can specify the <code>io.strimzi.plugin.security.profiles.impl.BaselinePodSecurityProvider</code> fully-qualified domain name.</p>
</div>
</div>
<div class="sect3">
<h4 id="restricted_provider_for_pod_security"><a class="link" href="#restricted_provider_for_pod_security">4.1.3. Restricted Provider for pod security</a></h4>
<div class="paragraph">
<p>The Restricted Provider provides a higher level of security than the Baseline Provider.
It configures the pods managed by Strimzi with a restricted security profile.</p>
</div>
<div class="paragraph">
<p>You enable the Restricted Provider by setting the <code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code> environment variable to <code>restricted</code> when <a href="#ref-operator-cluster-str">configuring the Cluster Operator</a>.</p>
</div>
<div class="listingblock">
<div class="title">Configuration for the Restricted Provider</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml"># ...
env:
  # ...
  - name: STRIMZI_POD_SECURITY_PROVIDER_CLASS
    value: restricted
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of specifying <code>restricted</code> as the value, you can specify the <code>io.strimzi.plugin.security.profiles.impl.RestrictedPodSecurityProvider</code> fully-qualified domain name.</p>
</div>
<div class="paragraph">
<p>If you change to the Restricted Provider from the default Baseline Provider, the following restrictions are implemented in addition to the constraints defined in the baseline security profile:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Limits allowed volume types</p>
</li>
<li>
<p>Disallows privilege escalation</p>
</li>
<li>
<p>Requires applications to run under a non-root user</p>
</li>
<li>
<p>Requires <code>seccomp</code> (secure computing mode) profiles to be set as <code>RuntimeDefault</code> or <code>Localhost</code></p>
</li>
<li>
<p>Limits container capabilities to use only the <code>NET_BIND_SERVICE</code> capability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the Restricted Provider enabled, containers created by the Cluster Operator are set with the following security context.</p>
</div>
<div class="listingblock">
<div class="title">Cluster Operator with restricted security context configuration</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml"># ...
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Container capabilities and <code>seccomp</code> are Linux kernel features that support container security.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Capabilities add fine-grained privileges for processes running on a container. The <code>NET_BIND_SERVICE</code> capability allows non-root user applications to bind to ports below 1024.</p>
</li>
<li>
<p><code>seccomp</code> profiles limit the processes running in a container to only a subset of system calls.
The <code>RuntimeDefault</code> profile provides a default set of system calls.
A <code>LocalHost</code> profile uses a profile defined in a file on the node.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener">Security context</a> on Kubernetes</p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/security/pod-security-standards/" target="_blank" rel="noopener">Pod security standards</a> on Kubernetes (including profile descriptions)</p>
</li>
<li>
<p><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-config-restricted-security-providers-str"><a class="link" href="#proc-config-restricted-security-providers-str">4.2. Enabling the Restricted Provider for the Cluster Operator</a></h3>
<div class="paragraph _abstract">
<p>Security pod providers configure the security context constraints of the pods and containers created by the Cluster Operator.
The Baseline Provider is the default pod security provider used by Strimzi.
You can switch to the Restricted Provider by changing the <code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code> environment variable in the Cluster Operator configuration.</p>
</div>
<div class="paragraph">
<p>To make the required changes, configure the <code>060-Deployment-strimzi-cluster-operator.yaml</code> Cluster Operator installation file located in <code>install/cluster-operator/</code>.</p>
</div>
<div class="paragraph">
<p>By enabling a new pod security provider, any pods or containers created by the Cluster Operator are subject to the limitations it imposes.
Pods and containers that are already running are restarted for the changes to take affect.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You need an account with permission to create and manage <code>CustomResourceDefinition</code> and RBAC (<code>ClusterRole</code>, and <code>RoleBinding</code>) resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Edit the <code>Deployment</code> resource that is used to deploy the Cluster Operator, which is defined in the <code>060-Deployment-strimzi-cluster-operator.yaml</code> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add or amend the <code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code> environment variable with a value of <code>restricted</code>.</p>
<div class="listingblock">
<div class="title">Cluster Operator configuration for the Restricted Provider</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml"># ...
env:
  # ...
  - name: STRIMZI_POD_SECURITY_PROVIDER_CLASS
    value: restricted
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can specify the <code>io.strimzi.plugin.security.profiles.impl.RestrictedPodSecurityProvider</code> fully-qualified domain name.</p>
</div>
</li>
<li>
<p>Deploy the Cluster Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator -n myproject</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Use <code>template</code> configuration to set security context for specific components at the pod or container level.</p>
<div class="listingblock">
<div class="title">Adding security context through <code>template</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">template:
  pod:
    securityContext:
      runAsUser: 1000001
      fsGroup: 0
  kafkaContainer:
    securityContext:
    runAsUser: 2000
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you apply specific security context for a component using <code>template</code> configuration, it takes priority over the general configuration provided by the pod security provider.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="con-config-custom-security-providers-str"><a class="link" href="#con-config-custom-security-providers-str">4.3. Implementing a custom pod security provider</a></h3>
<div class="paragraph _abstract">
<p>If Strimzi&#8217;s Baseline Provider and Restricted Provider don&#8217;t quite match your needs, you can develop a custom pod security provider to deliver all-encompassing pod and container security context constraints.</p>
</div>
<div class="paragraph">
<p>Implement a custom pod security provider to apply your own security context profile.
You can decide what applications and privileges to include in the profile.</p>
</div>
<div class="paragraph">
<p>Your custom pod security provider can implement the <code>PodSecurityProvider.java</code> interface that gets the security context for pods and containers; or it can extend the Baseline Provider or Restricted Provider classes.</p>
</div>
<div class="paragraph">
<p>The pod security provider plugins use the Java Service Provider Interface, so your custom pod security provider also requires a provider configuration file for service discovery.</p>
</div>
<div class="paragraph">
<p>To implement your own provider, the general steps include the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build the JAR file for the provider.</p>
</li>
<li>
<p>Add the JAR file to the Cluster Operator image.</p>
</li>
<li>
<p>Specify the custom pod security provider when setting the Cluster Operator environment variable <code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/strimzi/strimzi-kafka-operator/blob/main/api/src/main/java/io/strimzi/plugin/security/profiles/PodSecurityProvider.java" target="_blank" rel="noopener">Pod security provider interface</a></p>
</li>
<li>
<p><a href="https://github.com/strimzi/strimzi-kafka-operator/tree/main/api/src/main/java/io/strimzi/plugin/security/profiles/impl" target="_blank" rel="noopener">Baseline Provider and Restricted Provider classes</a></p>
</li>
<li>
<p><a href="https://github.com/strimzi/strimzi-kafka-operator/blob/main/api/src/main/resources/META-INF/services/io.strimzi.plugin.security.profiles.PodSecurityProvider" target="_blank" rel="noopener">Provider configuration file</a></p>
</li>
<li>
<p><a href="https://www.baeldung.com/java-spi" target="_blank" rel="noopener">Java Service Provider Interface</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-config-openshift-security-providers-str"><a class="link" href="#con-config-openshift-security-providers-str">4.4. Handling of security context by Kubernetes platform</a></h3>
<div class="paragraph _abstract">
<p>Handling of security context depends on the tooling of the Kubernetes platform you are using.</p>
</div>
<div class="paragraph">
<p>For example, OpenShift uses built-in security context constraints (SCCs) to control permissions.
SCCs are the settings and strategies that control the security features a pod has access to.</p>
</div>
<div class="paragraph">
<p>By default, OpenShift injects security context configuration automatically.
In most cases, this means you don&#8217;t need to configure security context for the pods and containers created by the Cluster Operator.
Although you can still create and manage your own SCCs.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://docs.openshift.com" target="_blank" rel="noopener">OpenShift documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operators-str"><a class="link" href="#assembly-operators-str">5. Using Strimzi Operators</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the Strimzi operators to manage your Kafka cluster, and Kafka topics and users.</p>
</div>
<div class="sect2">
<h3 id="con-operators-namespaces-str"><a class="link" href="#con-operators-namespaces-str">5.1. Watching namespaces with Strimzi operators</a></h3>
<div class="paragraph _abstract">
<p>Operators watch and manage Strimzi resources in namespaces.
The Cluster Operator can watch a single namespace, multiple namespaces, or all namespaces in a Kubernetes cluster.
The Topic Operator and User Operator can watch a single namespace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Cluster Operator watches for <code>Kafka</code> resources</p>
</li>
<li>
<p>The Topic Operator watches for <code>KafkaTopic</code> resources</p>
</li>
<li>
<p>The User Operator watches for <code>KafkaUser</code> resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Topic Operator and the User Operator can only watch a single Kafka cluster in a namespace.
And they can only be connected to a single Kafka cluster.</p>
</div>
<div class="paragraph">
<p>If multiple Topic Operators watch the same namespace, name collisions and topic deletion can occur.
This is because each Kafka cluster uses Kafka topics that have the same name (such as <code>__consumer_offsets</code>).
Make sure that only one Topic Operator watches a given namespace.</p>
</div>
<div class="paragraph">
<p>When using multiple User Operators with a single namespace, a user with a given username can exist in more than one Kafka cluster.</p>
</div>
<div class="paragraph">
<p>If you deploy the Topic Operator and User Operator using the Cluster Operator, they watch the Kafka cluster deployed by the Cluster Operator by default.
You can also specify a namespace using <code>watchedNamespace</code> in the operator configuration.</p>
</div>
<div class="paragraph">
<p>For a standalone deployment of each operator, you specify a namespace and connection to the Kafka cluster to watch in the configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-cluster-operator-str"><a class="link" href="#using-the-cluster-operator-str">5.2. Using the Cluster Operator</a></h3>
<div class="paragraph _abstract">
<p>The Cluster Operator is used to deploy a Kafka cluster and other Kafka components.</p>
</div>
<div class="paragraph">
<p>For information on deploying the Cluster Operator, see <a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Deploying the Cluster Operator</a>.</p>
</div>
<div class="sect3">
<h4 id="ref-operator-cluster-rbac-resources-str"><a class="link" href="#ref-operator-cluster-rbac-resources-str">5.2.1. Role-Based Access Control (RBAC) resources</a></h4>
<div class="paragraph _abstract">
<p>The Cluster Operator creates and manages RBAC resources for Strimzi components that need access to Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>For the Cluster Operator to function, it needs permission within the Kubernetes cluster to interact with Kafka resources, such as <code>Kafka</code> and <code>KafkaConnect</code>, as well as managed resources like <code>ConfigMap</code>, <code>Pod</code>, <code>Deployment</code>, <code>StatefulSet</code>, and <code>Service</code>.</p>
</div>
<div class="paragraph">
<p>Permission is specified through Kubernetes role-based access control (RBAC) resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceAccount</code></p>
</li>
<li>
<p><code>Role</code> and <code>ClusterRole</code></p>
</li>
<li>
<p><code>RoleBinding</code> and <code>ClusterRoleBinding</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="delegated-privileges-str"><a class="link" href="#delegated-privileges-str">Delegating privileges to Strimzi components</a></h5>
<div class="paragraph">
<p>The Cluster Operator runs under a service account called <code>strimzi-cluster-operator</code>.
It is assigned cluster roles that give it permission to create the RBAC resources for Strimzi components.
Role bindings associate the cluster roles with the service account.</p>
</div>
<div class="paragraph">
<p>Kubernetes prevents components operating under one <code>ServiceAccount</code> from granting another <code>ServiceAccount</code> privileges that the granting <code>ServiceAccount</code> does not have.
Because the Cluster Operator creates the <code>RoleBinding</code> and <code>ClusterRoleBinding</code> RBAC resources needed by the resources it manages, it requires a role that gives it the same privileges.</p>
</div>
<div class="paragraph">
<p>The following tables describe the RBAC resources created by the Cluster Operator.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <code>ServiceAccount</code> resources</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Used by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-kafka</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka broker pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-zookeeper</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZooKeeper pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-cluster-connect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connect pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-mirror-maker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MirrorMaker pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-mirrormaker2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MirrorMaker 2.0 pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-bridge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Bridge pods</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-entity-operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Entity Operator</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. <code>ClusterRole</code> resources</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Used by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-namespaced</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-global</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-leader-election</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-kafka-broker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, rack feature (when used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-entity-operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, Topic Operator, User Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-kafka-client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, Kafka clients for rack awareness</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. <code>ClusterRoleBinding</code> resources</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Used by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-kafka-broker-delegation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, Kafka brokers for rack awareness</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-kafka-client-delegation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, Kafka clients for rack awareness</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. <code>RoleBinding</code> resources</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Used by</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi-cluster-operator-kafka-broker-delegation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Operator, Kafka brokers for rack awareness</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="running_the_cluster_operator_using_a_serviceaccount"><a class="link" href="#running_the_cluster_operator_using_a_serviceaccount">Running the Cluster Operator using a <code>ServiceAccount</code></a></h5>
<div class="paragraph">
<p>The Cluster Operator is best run using a <code>ServiceAccount</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ServiceAccount</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: ServiceAccount
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Deployment</code> of the operator then needs to specify this in its <code>spec.template.spec.serviceAccountName</code>:</p>
</div>
<div class="listingblock">
<div class="title">Partial example of <code>Deployment</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
spec:
  replicas: 1
  selector:
    matchLabels:
      name: strimzi-cluster-operator
      strimzi.io/kind: cluster-operator
  template:
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note line 12, where <code>strimzi-cluster-operator</code> is specified as the <code>serviceAccountName</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="clusterrole_resources"><a class="link" href="#clusterrole_resources"><code>ClusterRole</code> resources</a></h5>
<div class="paragraph">
<p>The Cluster Operator uses <code>ClusterRole</code> resources to provide the necessary access to resources.
Depending on the Kubernetes cluster setup, a cluster administrator might be needed to create the cluster roles.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cluster administrator rights are only needed for the creation of <code>ClusterRole</code> resources.
The Cluster Operator will not run under a cluster admin account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ClusterRole</code> resources follow the <em>principle of least privilege</em> and contain only those privileges needed by the Cluster Operator to operate the cluster of the Kafka component. The first set of assigned privileges allow the Cluster Operator to manage Kubernetes resources such as <code>StatefulSet</code>, <code>Deployment</code>, <code>Pod</code>, and <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>All cluster roles are required by the Cluster Operator in order to delegate privileges.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator uses the <code>strimzi-cluster-operator-namespaced</code> and <code>strimzi-cluster-operator-global</code> cluster roles to grant permission at the namespace-scoped resources level and cluster-scoped resources level.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with namespaced resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-namespaced
  labels:
    app: strimzi
rules:
  # Resources in this role are used by the operator based on an operand being deployed in some namespace. When needed, you
  # can deploy the operator as a cluster-wide operator. But grant the rights listed in this role only on the namespaces
  # where the operands will be deployed. That way, you can limit the access the operator has to other namespaces where it
  # does not manage any clusters.
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      # The cluster operator needs to access and manage rolebindings to grant Strimzi components cluster permissions
      - rolebindings
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      # The cluster operator needs to access and manage roles to grant the entity operator permissions
      - roles
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - ""
    resources:
      # The cluster operator needs to access and delete pods, this is to allow it to monitor pod health and coordinate rolling updates
      - pods
      # The cluster operator needs to access and manage service accounts to grant Strimzi components cluster permissions
      - serviceaccounts
      # The cluster operator needs to access and manage config maps for Strimzi components configuration
      - configmaps
      # The cluster operator needs to access and manage services and endpoints to expose Strimzi components to network traffic
      - services
      - endpoints
      # The cluster operator needs to access and manage secrets to handle credentials
      - secrets
      # The cluster operator needs to access and manage persistent volume claims to bind them to Strimzi components for persistent data
      - persistentvolumeclaims
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "apps"
    resources:
      # The cluster operator needs to access and manage deployments to run deployment based Strimzi components
      - deployments
      - deployments/scale
      - deployments/status
      # The cluster operator needs to access and manage stateful sets to run stateful sets based Strimzi components
      - statefulsets
      # The cluster operator needs to access replica-sets to manage Strimzi components and to determine error states
      - replicasets
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "" # legacy core events api, used by topic operator
      - "events.k8s.io" # new events api, used by cluster operator
    resources:
      # The cluster operator needs to be able to create events and delegate permissions to do so
      - events
    verbs:
      - create
  - apiGroups:
      # Kafka Connect Build on OpenShift requirement
      - build.openshift.io
    resources:
      - buildconfigs
      - buildconfigs/instantiate
      - builds
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - networking.k8s.io
    resources:
      # The cluster operator needs to access and manage network policies to lock down communication between Strimzi components
      - networkpolicies
      # The cluster operator needs to access and manage ingresses which allow external access to the services in a cluster
      - ingresses
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - route.openshift.io
    resources:
      # The cluster operator needs to access and manage routes to expose Strimzi components for external access
      - routes
      - routes/custom-host
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - image.openshift.io
    resources:
      # The cluster operator needs to verify the image stream when used for Kafka Connect image build
      - imagestreams
    verbs:
      - get
  - apiGroups:
      - policy
    resources:
      # The cluster operator needs to access and manage pod disruption budgets this limits the number of concurrent disruptions
      # that a Strimzi component experiences, allowing for higher availability
      - poddisruptionbudgets
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with cluster-scoped resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-global
  labels:
    app: strimzi
rules:
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      # The cluster operator needs to create and manage cluster role bindings in the case of an install where a user
      # has specified they want their cluster role bindings generated
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - storage.k8s.io
    resources:
      # The cluster operator requires "get" permissions to view storage class details
      # This is because only a persistent volume of a supported storage class type can be resized
      - storageclasses
    verbs:
      - get
  - apiGroups:
      - ""
    resources:
      # The cluster operator requires "list" permissions to view all nodes in a cluster
      # The listing is used to determine the node addresses when NodePort access is configured
      # These addresses are then exposed in the custom resource states
      - nodes
    verbs:
      - list</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-cluster-operator-leader-election</code> cluster role represents the permissions needed for the leader election.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with leader election permissions</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-leader-election
  labels:
    app: strimzi
rules:
  - apiGroups:
      - coordination.k8s.io
    resources:
      # The cluster operator needs to access and manage leases for leader election
      # The "create" verb cannot be used with "resourceNames"
      - leases
    verbs:
      - create
  - apiGroups:
      - coordination.k8s.io
    resources:
      # The cluster operator needs to access and manage leases for leader election
      - leases
    resourceNames:
      # The default RBAC files give the operator only access to the Lease resource names strimzi-cluster-operator
      # If you want to use another resource name or resource namespace, you have to configure the RBAC resources accordingly
      - strimzi-cluster-operator
    verbs:
      - get
      - list
      - watch
      - delete
      - patch
      - update</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-kafka-broker</code> cluster role represents the access needed by the init container in Kafka pods that use rack awareness.</p>
</div>
<div class="paragraph">
<p>A role binding named <code>strimzi-<em>&lt;cluster_name&gt;</em>-kafka-init</code> grants the <code><em>&lt;cluster_name&gt;</em>-kafka</code> service account access to nodes within a cluster using the <code>strimzi-kafka-broker</code> role.
If the rack feature is not used and the cluster is not exposed through <code>nodeport</code>, no binding is created.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to Kubernetes nodes to the Kafka broker pods</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-kafka-broker
  labels:
    app: strimzi
rules:
  - apiGroups:
      - ""
    resources:
      # The Kafka Brokers require "get" permissions to view the node they are on
      # This information is used to generate a Rack ID that is used for High Availability configurations
      - nodes
    verbs:
      - get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-entity-operator</code> cluster role represents the access needed by the Topic Operator and User Operator.</p>
</div>
<div class="paragraph">
<p>The Topic Operator produces Kubernetes events with status information, so the <code><em>&lt;cluster_name&gt;</em>-entity-operator</code> service account is bound to the <code>strimzi-entity-operator</code> role, which grants this access via the <code>strimzi-entity-operator</code> role binding.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to events to the Topic and User Operators</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-entity-operator
  labels:
    app: strimzi
rules:
  - apiGroups:
      - "kafka.strimzi.io"
    resources:
      # The entity operator runs the KafkaTopic assembly operator, which needs to access and manage KafkaTopic resources
      - kafkatopics
      - kafkatopics/status
      # The entity operator runs the KafkaUser assembly operator, which needs to access and manage KafkaUser resources
      - kafkausers
      - kafkausers/status
    verbs:
      - get
      - list
      - watch
      - create
      - patch
      - update
      - delete
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      # The entity operator needs to be able to create events
      - create
  - apiGroups:
      - ""
    resources:
      # The entity operator user-operator needs to access and manage secrets to store generated credentials
      - secrets
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-kafka-client</code> cluster role represents the access needed by Kafka clients that use rack awareness.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to Kubernetes nodes to the Kafka client-based pods</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-kafka-client
  labels:
    app: strimzi
rules:
  - apiGroups:
      - ""
    resources:
      # The Kafka clients (Connect, Mirror Maker, etc.) require "get" permissions to view the node they are on
      # This information is used to generate a Rack ID (client.rack option) that is used for consuming from the closest
      # replicas when enabled
      - nodes
    verbs:
      - get</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="clusterrolebinding_resources"><a class="link" href="#clusterrolebinding_resources"><code>ClusterRoleBinding</code> resources</a></h5>
<div class="paragraph">
<p>The Cluster Operator uses <code>ClusterRoleBinding</code> and <code>RoleBinding</code> resources to associate its <code>ClusterRole</code> with its <code>ServiceAccount</code>:
Cluster role bindings are required by cluster roles containing cluster-scoped resources.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-global
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cluster role bindings are also needed for the cluster roles used in delegating privileges:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator and Kafka broker rack awareness</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator-kafka-broker-delegation
  labels:
    app: strimzi
# The Kafka broker cluster role must be bound to the cluster operator service account so that it can delegate the cluster role to the Kafka brokers.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-kafka-broker
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator and Kafka client rack awareness</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator-kafka-client-delegation
  labels:
    app: strimzi
# The Kafka clients cluster role must be bound to the cluster operator service account so that it can delegate the
# cluster role to the Kafka clients using it for consuming from closest replica.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-kafka-client
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cluster roles containing only namespaced resources are bound using role bindings only.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>RoleBinding</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-namespaced
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>RoleBinding</code> for the Cluster Operator and Kafka broker rack awareness</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator-entity-operator-delegation
  labels:
    app: strimzi
# The Entity Operator cluster role must be bound to the cluster operator service account so that it can delegate the cluster role to the Entity Operator.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-entity-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-operator-cluster-logging-configmap-str"><a class="link" href="#ref-operator-cluster-logging-configmap-str">5.2.2. ConfigMap for Cluster Operator logging</a></h4>
<div class="paragraph _abstract">
<p>Cluster Operator logging is configured through a <code>ConfigMap</code> named <code>strimzi-cluster-operator</code>.</p>
</div>
<div class="paragraph">
<p>A <code>ConfigMap</code> containing logging configuration is created when installing the Cluster Operator.
This <code>ConfigMap</code> is described in the file <code>install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</code>.
You configure Cluster Operator logging by changing the data field <code>log4j2.properties</code> in this <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>To update the logging configuration, you can edit the <code>050-ConfigMap-strimzi-cluster-operator.yaml</code> file and then run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f <em>install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, edit the <code>ConfigMap</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit configmap strimzi-cluster-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the frequency of the reload interval, set a time in seconds in the <code>monitorInterval</code> option in the created <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>ConfigMap</code> is missing when the Cluster Operator is deployed, the default logging values are used.</p>
</div>
<div class="paragraph">
<p>If the <code>ConfigMap</code> is accidentally deleted after the Cluster Operator is deployed, the most recently loaded logging configuration is used.
Create a new <code>ConfigMap</code> to load a new logging configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Do not remove the <code>monitorInterval</code> option from the <code>ConfigMap</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ref-operator-cluster-str"><a class="link" href="#ref-operator-cluster-str">5.2.3. Configuring the Cluster Operator with environment variables</a></h4>
<div class="paragraph _abstract">
<p>You can configure the Cluster Operator using environment variables.
The supported environment variables are listed here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The environment variables relate to the container configuration for the deployment of the Cluster Operator image.
For more information on <code>image</code> configuration, see, <a href="#con-common-configuration-images-reference"><code>image</code></a>.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_NAMESPACE</code></dt>
<dd>
<p>A comma-separated list of namespaces that the operator operates in.
When not set, set to empty string, or set to <code>*</code>, the Cluster Operator operates in all namespaces.</p>
<div class="paragraph">
<p>The Cluster Operator deployment might use the downward API to set this automatically to the namespace the Cluster Operator is deployed in.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for Cluster Operator namespaces</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></dt>
<dd>
<p>Optional, default is 120000 ms.
The interval between <a href="#ref-operator-cluster-periodic-reconciliation-str">periodic reconciliations</a>, in milliseconds.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATION_TIMEOUT_MS</code></dt>
<dd>
<p>Optional, default 300000 ms.
The timeout for internal operations, in milliseconds. Increase this value when using Strimzi on clusters where regular Kubernetes operations take longer than usual (because of slow downloading of Docker images, for example).</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_ZOOKEEPER_ADMIN_SESSION_TIMEOUT_MS</code></dt>
<dd>
<p>Optional, default 10000 ms.
The session timeout for the Cluster Operator&#8217;s ZooKeeper admin client, in milliseconds.
Increase the value if ZooKeeper requests from the Cluster Operator are regularly failing due to timeout issues.
There is a maximum allowed session time set on the ZooKeeper server side via the <code>maxSessionTimeout</code> config.
By default, the maximum session timeout value is 20 times the default <code>tickTime</code> (whose default is 2000) at 40000 ms.
If you require a higher timeout, change the <code>maxSessionTimeout</code> ZooKeeper server configuration value.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATIONS_THREAD_POOL_SIZE</code></dt>
<dd>
<p>Optional, default 10.
The worker thread pool size, which is used for various asynchronous and blocking operations that are run by the Cluster Operator.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATOR_NAME</code></dt>
<dd>
<p>Optional, defaults to the pod&#8217;s hostname.
The operator name identifies the Strimzi instance when <a href="./deploying.html#proc-operator-restart-events-str" target="_blank" rel="noopener">emitting Kubernetes events</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATOR_NAMESPACE</code></dt>
<dd>
<p>The name of the namespace where the Cluster Operator is running.
Do not configure this variable manually. Use the downward API.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_OPERATOR_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATOR_NAMESPACE_LABELS</code></dt>
<dd>
<p>Optional.
The labels of the namespace where the Strimzi Cluster Operator is running.
Use namespace labels to configure the namespace selector in <a href="#ref-operator-cluster-network-policy-str">network policies</a>.
Network policies allow the Strimzi Cluster Operator access only to the operands from the namespace with these labels.
When not set, the namespace selector in network policies is configured to allow access to the Cluster Operator from any namespace in the Kubernetes cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_OPERATOR_NAMESPACE_LABELS
    value: label1=value1,label2=value2</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_LABELS_EXCLUSION_PATTERN</code></dt>
<dd>
<p>Optional, default regex pattern is <code>^app.kubernetes.io/(?!part-of).*</code>.
The regex exclusion pattern used to filter labels propagation from the main custom resource to its subresources.
The labels exclusion filter is not applied to labels in template sections such as <code>spec.kafka.template.pod.metadata.labels</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_LABELS_EXCLUSION_PATTERN
    value: "^key1.*"</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_CUSTOM_{COMPONENT_NAME}_LABELS</code></dt>
<dd>
<p>Optional.
One or more custom labels to apply to all the pods created by the <code>{COMPONENT_NAME}</code> custom resource.
The Cluster Operator labels the pods when the custom resource is created or is next reconciled.</p>
<div class="paragraph">
<p>Labels can be applied to the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KAFKA</code></p>
</li>
<li>
<p><code>KAFKA_CONNECT</code></p>
</li>
<li>
<p><code>KAFKA_CONNECT_BUILD</code></p>
</li>
<li>
<p><code>ZOOKEEPER</code></p>
</li>
<li>
<p><code>ENTITY_OPERATOR</code></p>
</li>
<li>
<p><code>KAFKA_MIRROR_MAKER2</code></p>
</li>
<li>
<p><code>KAFKA_MIRROR_MAKER</code></p>
</li>
<li>
<p><code>CRUISE_CONTROL</code></p>
</li>
<li>
<p><code>KAFKA_BRIDGE</code></p>
</li>
<li>
<p><code>KAFKA_EXPORTER</code></p>
</li>
<li>
<p><code>JMX_TRANS</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_CUSTOM_RESOURCE_SELECTOR</code></dt>
<dd>
<p>Optional.
The label selector to filter the custom resources handled by the Cluster Operator.
The operator will operate only on those custom resources that have the specified labels set.
Resources without these labels will not be seen by the operator.
The label selector applies to <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaBridge</code>, <code>KafkaMirrorMaker</code>, and <code>KafkaMirrorMaker2</code> resources.
<code>KafkaRebalance</code> and <code>KafkaConnector</code> resources are operated only when their corresponding Kafka and Kafka Connect clusters have the matching labels.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_CUSTOM_RESOURCE_SELECTOR
    value: label1=value1,label2=value2</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_IMAGES</code></dt>
<dd>
<p>Required.
The mapping from the Kafka version to the corresponding Docker image containing a Kafka broker for that version.
The required syntax is whitespace or comma-separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>3.2.3=quay.io/strimzi/kafka:latest-kafka-3.2.3, 3.3.2=quay.io/strimzi/kafka:latest-kafka-3.3.2</code>.
This is used when a <code>Kafka.spec.kafka.version</code> property is specified but not the <code>Kafka.spec.kafka.image</code> in the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code></dt>
<dd>
<p>Optional, default <code>quay.io/strimzi/operator:latest</code>.
The image name to use as default for the init container if no image is specified as the <code>kafka-init-image</code> in the <code>Kafka</code> resource.
The init container is started before the broker for initial configuration work, such as rack support.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_CONNECT_IMAGES</code></dt>
<dd>
<p>Required.
The mapping from the Kafka version to the corresponding Docker image of Kafka Connect for that version.
The required syntax is whitespace or comma-separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>3.2.3=quay.io/strimzi/kafka:latest-kafka-3.2.3, 3.3.2=quay.io/strimzi/kafka:latest-kafka-3.3.2</code>.
This is used when a <code>KafkaConnect.spec.version</code> property is specified but not the <code>KafkaConnect.spec.image</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_MIRROR_MAKER_IMAGES</code></dt>
<dd>
<p>Required.
The mapping from the Kafka version to the corresponding Docker image of MirrorMaker for that version.
The required syntax is whitespace or comma-separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>3.2.3=quay.io/strimzi/kafka:latest-kafka-3.2.3, 3.3.2=quay.io/strimzi/kafka:latest-kafka-3.3.2</code>.
This is used when a <code>KafkaMirrorMaker.spec.version</code> property is specified but not the <code>KafkaMirrorMaker.spec.image</code>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>quay.io/strimzi/operator:latest</code>.
The image name to use as the default when deploying the Topic Operator
if no image is specified as the <code>Kafka.spec.entityOperator.topicOperator.image</code> in the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>quay.io/strimzi/operator:latest</code>.
The image name to use as the default when deploying the User Operator
if no image is specified as the <code>Kafka.spec.entityOperator.userOperator.image</code> in the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>quay.io/strimzi/kafka:latest-kafka-3.3.2</code>.
The image name to use as the default when deploying the sidecar container for the Entity Operator if
no image is specified as the <code>Kafka.spec.entityOperator.tlsSidecar.image</code> in the <code>Kafka</code> resource.
The sidecar provides TLS support.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_POLICY</code></dt>
<dd>
<p>Optional.
The <code>ImagePullPolicy</code> that is applied to containers in all pods managed by the Cluster Operator.
The valid values are <code>Always</code>, <code>IfNotPresent</code>, and <code>Never</code>.
If not specified, the Kubernetes defaults are used.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_SECRETS</code></dt>
<dd>
<p>Optional.
A comma-separated list of <code>Secret</code> names.
The secrets referenced here contain the credentials to the container registries where the container images are pulled from.
The secrets are specified in the <code>imagePullSecrets</code> property for all pods created by the Cluster Operator.
Changing this list results in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KUBERNETES_VERSION</code></dt>
<dd>
<p>Optional.
Overrides the Kubernetes version information detected from the API server.</p>
<div class="listingblock">
<div class="title">Example configuration for Kubernetes version override</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_KUBERNETES_VERSION
    value: |
           major=1
           minor=16
           gitVersion=v1.16.2
           gitCommit=c97fe5036ef3df2967d086711e6c0c405941e14b
           gitTreeState=clean
           buildDate=2019-10-15T19:09:08Z
           goVersion=go1.12.10
           compiler=gc
           platform=linux/amd64</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>KUBERNETES_SERVICE_DNS_DOMAIN</code></dt>
<dd>
<p>Optional.
Overrides the default Kubernetes DNS domain name suffix.</p>
<div class="paragraph">
<p>By default, services assigned in the Kubernetes cluster have a DNS domain name that uses the default suffix <code>cluster.local</code>.</p>
</div>
<div class="paragraph">
<p>For example, for broker <em>kafka-0</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"><em>&lt;cluster-name&gt;</em>-kafka-0.<em>&lt;cluster-name&gt;</em>-kafka-brokers.<em>&lt;namespace&gt;</em>.svc.<em>cluster.local</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DNS domain name is added to the Kafka broker certificates used for hostname verification.</p>
</div>
<div class="paragraph">
<p>If you are using a different DNS domain name suffix in your cluster, change the <code>KUBERNETES_SERVICE_DNS_DOMAIN</code> environment variable from the default to the one you are using in order to establish a connection with the Kafka brokers.</p>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_CONNECT_BUILD_TIMEOUT_MS</code></dt>
<dd>
<p>Optional, default 300000 ms.
The timeout for building new Kafka Connect images with additional connectors, in milliseconds.
Consider increasing this value when using Strimzi to build container images containing many connectors or using a slow container registry.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_NETWORK_POLICY_GENERATION</code></dt>
<dd>
<p>Optional, default <code>true</code>.
Network policy for resources.
Network policies allow connections between Kafka components.</p>
<div class="paragraph">
<p>Set this environment variable to <code>false</code> to disable network policy generation. You might do this, for example, if you want to use custom network policies. Custom network policies allow more control over maintaining the connections between components.</p>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_DNS_CACHE_TTL</code></dt>
<dd>
<p>Optional, default <code>30</code>.
Number of seconds to cache successful name lookups in local DNS resolver. Any negative value means cache forever. Zero means do not cache, which can be useful for avoiding connection errors due to long caching policies being applied.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_POD_SET_RECONCILIATION_ONLY</code></dt>
<dd>
<p>Optional, default <code>false</code>.
When set to <code>true</code>, the Cluster Operator reconciles only the <code>StrimziPodSet</code> resources and any changes to the other custom resources (<code>Kafka</code>, <code>KafkaConnect</code>, and so on) are ignored.
This mode is useful for ensuring that your pods are recreated if needed, but no other changes happen to the clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_FEATURE_GATES</code></dt>
<dd>
<p>Optional.
Enables or disables the features and functionality controlled by <a href="#ref-operator-cluster-feature-gates-str">feature gates</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_POD_SECURITY_PROVIDER_CLASS</code></dt>
<dd>
<p>Optional.
Configuration for the pluggable <code>PodSecurityProvider</code> class, which can be used to provide the security context configuration for Pods and containers.</p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="ref-operator-cluster-leader-election-str"><a class="link" href="#ref-operator-cluster-leader-election-str">Leader election environment variables</a></h5>
<div class="paragraph">
<p>Use leader election environment variables when <a href="#assembly-using-multiple-cluster-operator-replicas-str">running additional Cluster Operator replicas</a>.
You might run additional replicas to safeguard against disruption caused by major failure.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_ENABLED</code></dt>
<dd>
<p>Optional, disabled (<code>false</code>) by default.
Enables or disables leader election, which allows additional Cluster Operator replicas to run on standby.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Leader election is disabled by default.
It is only enabled when applying this environment variable on installation.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_LEASE_NAME</code></dt>
<dd>
<p>Required when leader election is enabled.
The name of the Kubernetes <code>Lease</code> resource that is used for the leader election.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_LEASE_NAMESPACE</code></dt>
<dd>
<p>Required when leader election is enabled.
The namespace where the Kubernetes <code>Lease</code> resource used for leader election is created.
You can use the downward API to configure it to the namespace where the Cluster Operator is deployed.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_LEADER_ELECTION_LEASE_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_IDENTITY</code></dt>
<dd>
<p>Required when leader election is enabled.
Configures the identity of a given Cluster Operator instance used during the leader election.
The identity must be unique for each operator instance.
You can use the downward API to configure it to the name of the pod where the Cluster Operator is deployed.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_LEADER_ELECTION_IDENTITY
    valueFrom:
      fieldRef:
        fieldPath: metadata.name</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_LEASE_DURATION_MS</code></dt>
<dd>
<p>Optional, default 15000 ms.
Specifies the duration the acquired lease is valid.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_RENEW_DEADLINE_MS</code></dt>
<dd>
<p>Optional, default 10000 ms.
Specifies the period the leader should try to maintain leadership.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_LEADER_ELECTION_RETRY_PERIOD_MS</code></dt>
<dd>
<p>Optional, default 2000 ms.
Specifies the frequency of updates to the lease lock by the leader.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="ref-operator-cluster-network-policy-str"><a class="link" href="#ref-operator-cluster-network-policy-str">Restricting Cluster Operator access with network policy</a></h5>
<div class="paragraph">
<p>Use the <code>STRIMZI_OPERATOR_NAMESPACE_LABELS</code> environment variable to establish network policy for the Cluster Operator using namespace labels.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator can run in the same namespace as the resources it manages, or in a separate namespace.
By default, the <code>STRIMZI_OPERATOR_NAMESPACE</code> environment variable is configured to use the downward API to find the namespace the Cluster Operator is running in.
If the Cluster Operator is running in the same namespace as the resources, only local access is required and allowed by Strimzi.</p>
</div>
<div class="paragraph">
<p>If the Cluster Operator is running in a separate namespace to the resources it manages, any namespace in the Kubernetes cluster is allowed access to the Cluster Operator unless network policy is configured.
By adding namespace labels, access to the Cluster Operator is restricted to the namespaces specified.</p>
</div>
<div class="listingblock">
<div class="title">Network policy configured for the Cluster Operator deployment</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">#...
env:
  # ...
  - name: STRIMZI_OPERATOR_NAMESPACE_LABELS
    value: label1=value1,label2=value2
  #...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-operator-cluster-periodic-reconciliation-str"><a class="link" href="#ref-operator-cluster-periodic-reconciliation-str">Setting the time interval for periodic reconciliation</a></h5>
<div class="paragraph">
<p>Use the <code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code> variable to set the time interval for periodic reconciliations.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator reacts to all notifications about applicable cluster resources received from the Kubernetes cluster.
If the operator is not running, or if a notification is not received for any reason, resources will get out of sync with the state of the running Kubernetes cluster.
In order to handle failovers properly, a periodic reconciliation process is executed by the Cluster Operator so that it can compare the state of the resources with the current cluster deployments in order to have a consistent state across all of them.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api" target="_blank" rel="noopener">Downward API</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-proxy-config-cluster-operator-str"><a class="link" href="#proc-configuring-proxy-config-cluster-operator-str">5.2.4. Configuring the Cluster Operator with default proxy settings</a></h4>
<div class="paragraph _abstract">
<p>If you are running a Kafka cluster behind a HTTP proxy, you can still pass data in and out of the cluster.
For example, you can run Kafka Connect with connectors that push and pull data from outside the proxy.
Or you can use a proxy to connect with an authorization server.</p>
</div>
<div class="paragraph">
<p>Configure the Cluster Operator deployment to specify the proxy environment variables.
The Cluster Operator accepts standard proxy configuration (<code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code> and <code>NO_PROXY</code>) as environment variables.
The proxy settings are applied to all Strimzi containers.</p>
</div>
<div class="paragraph">
<p>The format for a proxy address is <em>http://IP-ADDRESS:PORT-NUMBER</em>.
To set up a proxy with a name and password, the format is <em>http://USERNAME:PASSWORD@IP-ADDRESS:PORT-NUMBER</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You need an account with permission to create and manage <code>CustomResourceDefinition</code> and RBAC (<code>ClusterRole</code>, and <code>RoleBinding</code>) resources.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To add proxy environment variables to the Cluster Operator, update its <code>Deployment</code> configuration (<code>install/cluster-operator/060-Deployment-strimzi-cluster-operator.yaml</code>).</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example proxy configuration for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      serviceAccountName: strimzi-cluster-operator
      containers:
        # ...
        env:
        # ...
        - name: "HTTP_PROXY"
          value: "http://proxy.com" <b class="conum">(1)</b>
        - name: "HTTPS_PROXY"
          value: "https://proxy.com" <b class="conum">(2)</b>
        - name: "NO_PROXY"
          value: "internal.com, other.domain.com" <b class="conum">(3)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Address of the proxy server.</p>
</li>
<li>
<p>Secure address of the proxy server.</p>
</li>
<li>
<p>Addresses for servers that are accessed directly as exceptions to the proxy server. The URLs are comma-separated.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, edit the <code>Deployment</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit deployment strimzi-cluster-operator</code></pre>
</div>
</div>
</li>
<li>
<p>If you updated the YAML file instead of editing the <code>Deployment</code> directly, apply the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/060-Deployment-strimzi-cluster-operator.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#property-hostaliases-config-reference">Host aliases</a></p>
</li>
<li>
<p><a href="./deploying.html#adding-users-the-strimzi-admin-role-str" target="_blank" rel="noopener">Designating Strimzi administrators</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="assembly-using-multiple-cluster-operator-replicas-str"><a class="link" href="#assembly-using-multiple-cluster-operator-replicas-str">5.2.5. Running multiple Cluster Operator replicas with leader election</a></h4>
<div class="paragraph _abstract">
<p>The default Cluster Operator configuration enables <a href="#ref-operator-cluster-leader-election-str">leader election</a>.
Use leader election to run multiple parallel replicas of the Cluster Operator.
One replica is elected as the active leader and operates the deployed resources.
The other replicas run in standby mode.
When the leader stops or fails, one of the standby replicas is elected as the new leader and starts operating the deployed resources.</p>
</div>
<div class="paragraph">
<p>By default, Strimzi runs with a single Cluster Operator replica that is always the leader replica.
When a single Cluster Operator replica stops or fails, Kubernetes starts a new replica.</p>
</div>
<div class="paragraph">
<p>Running the Cluster Operator with multiple replicas is not essential.
But it&#8217;s useful to have replicas on standby in case of large-scale disruptions.
For example, suppose multiple worker nodes or an entire availability zone fails.
This failure might cause the Cluster Operator pod and many Kafka pods to go down at the same time.
If subsequent pod scheduling causes congestion through lack of resources, this can delay operations when running a single Cluster Operator.</p>
</div>
<div class="sect4">
<h5 id="assembly-configuring-proxy-config-cluster-operator-str"><a class="link" href="#assembly-configuring-proxy-config-cluster-operator-str">Configuring Cluster Operator replicas</a></h5>
<div class="paragraph _abstract">
<p>To run additional Cluster Operator replicas in standby mode, you will need to increase the number of replicas and enable leader election.
To configure leader election, use the leader election environment variables.</p>
</div>
<div class="paragraph">
<p>To make the required changes, configure the following Cluster Operator installation files located in <code>install/cluster-operator/</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>060-Deployment-strimzi-cluster-operator.yaml</p>
</li>
<li>
<p>022-ClusterRole-strimzi-cluster-operator-role.yaml</p>
</li>
<li>
<p>022-RoleBinding-strimzi-cluster-operator.yaml</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Leader election has its own <code>ClusterRole</code> and <code>RoleBinding</code> RBAC resources that target the namespace where the Cluster Operator is running, rather than the namespace it is watching.</p>
</div>
<div class="paragraph">
<p>The default deployment configuration creates a <code>Lease</code> resource called <code>strimzi-cluster-operator</code> in the same namespace as the Cluster Operator.
The Cluster Operator uses leases to manage leader election.
The RBAC resources provide the permissions to use the <code>Lease</code> resource.
If you use a different <code>Lease</code> name or namespace, update the <code>ClusterRole</code> and <code>RoleBinding</code> files accordingly.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You need an account with permission to create and manage <code>CustomResourceDefinition</code> and RBAC (<code>ClusterRole</code>, and <code>RoleBinding</code>) resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Edit the <code>Deployment</code> resource that is used to deploy the Cluster Operator, which is defined in the <code>060-Deployment-strimzi-cluster-operator.yaml</code> file.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the <code>replicas</code> property from the default (1) to a value that matches the required number of replicas.</p>
<div class="listingblock">
<div class="title">Increasing the number of Cluster Operator replicas</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
spec:
  replicas: 3</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the leader election <code>env</code> properties are set.</p>
<div class="paragraph">
<p>If they are not set, configure them.</p>
</div>
<div class="paragraph">
<p>To enable leader election, <code>STRIMZI_LEADER_ELECTION_ENABLED</code> must be set to <code>true</code> (default).</p>
</div>
<div class="paragraph">
<p>In this example, the name of the lease is changed to <code>my-strimzi-cluster-operator</code>.</p>
</div>
<div class="listingblock">
<div class="title">Configuring leader election environment variables for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml"># ...
spec
  containers:
    - name: strimzi-cluster-operator
      # ...
      env:
        - name: STRIMZI_LEADER_ELECTION_ENABLED
          value: "true"
        - name: STRIMZI_LEADER_ELECTION_LEASE_NAME
          value: "my-strimzi-cluster-operator"
        - name: STRIMZI_LEADER_ELECTION_LEASE_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
        - name: STRIMZI_LEADER_ELECTION_IDENTITY
            valueFrom:
              fieldRef:
                fieldPath: metadata.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a description of the available environment variables, see <a href="#ref-operator-cluster-leader-election-str">Leader election environment variables</a>.</p>
</div>
<div class="paragraph">
<p>If you specified a different name or namespace for the <code>Lease</code> resource used in leader election, update the RBAC resources.</p>
</div>
</li>
<li>
<p>(optional) Edit the <code>ClusterRole</code> resource in the <code>022-ClusterRole-strimzi-cluster-operator-role.yaml</code> file.</p>
<div class="paragraph">
<p>Update <code>resourceNames</code> with the name of the <code>Lease</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Updating the ClusterRole references to the lease</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-leader-election
  labels:
    app: strimzi
rules:
  - apiGroups:
      - coordination.k8s.io
    resourceNames:
      - my-strimzi-cluster-operator
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>(optional) Edit the <code>RoleBinding</code> resource in the <code>022-RoleBinding-strimzi-cluster-operator.yaml</code> file.</p>
<div class="paragraph">
<p>Update <code>subjects.name</code> and <code>subjects.namespace</code> with the name of the <code>Lease</code> resource and the namespace where it was created.</p>
</div>
<div class="listingblock">
<div class="title">Updating the RoleBinding references to the lease</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator-leader-election
  labels:
    app: strimzi
subjects:
  - kind: ServiceAccount
    name: my-strimzi-cluster-operator
    namespace: myproject
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator -n myproject</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get deployments -n myproject</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output shows the deployment name and readiness</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                      READY  UP-TO-DATE  AVAILABLE
strimzi-cluster-operator  3/3    3           3</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>READY</code> shows the number of replicas that are ready/expected.
The deployment is successful when the <code>AVAILABLE</code> output shows the correct number of replicas.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-fips-support-str"><a class="link" href="#assembly-fips-support-str">5.2.6. FIPS support</a></h4>
<div class="paragraph _abstract">
<p>Federal Information Processing Standards (FIPS) are standards for computer security and interoperability.
When running Strimzi on a FIPS-enabled Kubernetes cluster, the OpenJDK used in Strimzi container images automatically switches to FIPS mode.
From version 0.33, Strimzi can run on FIPS-enabled Kubernetes clusters without any changes or special configuration.
It uses only the FIPS-compliant security libraries from the OpenJDK.</p>
</div>
<div class="paragraph">
<div class="title">Minimum password length</div>
<p>When running in the FIPS mode, SCRAM-SHA-512 passwords need to be at least 32 characters long.
From Strimzi 0.33, the default password length in Strimzi User Operator is set to 32 characters as well.
If you have a Kafka cluster with custom configuration that uses a password length that is less than 32 characters, you need to update your configuration.
If you have any users with passwords shorter than 32 characters, you need to regenerate a password with the required length.
You can do that, for example, by deleting the user secret and waiting for the User Operator to create a new password with the appropriate length.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://www.nist.gov/standardsgov/compliance-faqs-federal-information-processing-standards-fips" target="_blank" rel="noopener">What are Federal Information Processing Standards (FIPS)</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="proc-disabling-fips-mode-cluster-operator-str"><a class="link" href="#proc-disabling-fips-mode-cluster-operator-str">Disabling FIPS mode</a></h5>
<div class="paragraph _abstract">
<p>Strimzi automatically switches to FIPS mode when running on a FIPS-enabled Kubernetes cluster.
Disable FIPS mode by setting the <code>FIPS_MODE</code> environment variable to <code>disabled</code> in the deployment configuration for the Cluster Operator.
With FIPS mode disabled, Strimzi automatically disables FIPS in the OpenJDK for all components.
With FIPS mode disabled, Strimzi is not FIPS compliant.
The Strimzi operators, as well as all operands, run in the same way as if they were running on an Kubernetes cluster without FIPS enabled.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To disable the FIPS mode in the Cluster Operator, update its <code>Deployment</code> configuration (<code>install/cluster-operator/060-Deployment-strimzi-cluster-operator.yaml</code>) and add the <code>FIPS_MODE</code> environment variable.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example FIPS configuration for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
spec:
  # ...
  template:
    spec:
      serviceAccountName: strimzi-cluster-operator
      containers:
        # ...
        env:
        # ...
        - name: "FIPS_MODE"
          value: "disabled" # <b class="conum">(1)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Disables the FIPS mode.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, edit the <code>Deployment</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit deployment strimzi-cluster-operator</code></pre>
</div>
</div>
</li>
<li>
<p>If you updated the YAML file instead of editing the <code>Deployment</code> directly, apply the changes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f install/cluster-operator/060-Deployment-strimzi-cluster-operator.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-topic-operator-str"><a class="link" href="#using-the-topic-operator-str">5.3. Using the Topic Operator</a></h3>
<div class="paragraph _abstract">
<p>When you create, modify or delete a topic using the <code>KafkaTopic</code> resource,
the Topic Operator ensures those changes are reflected in the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>For more information on the <code>KafkaTopic</code> resource, see the <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<div class="title">Deploying the Topic Operator</div>
<p>You can deploy the Topic Operator using the Cluster Operator or as a standalone operator.
You would use a standalone Topic Operator with a Kafka cluster that is not managed by the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>For deployment instructions, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#deploying-the-topic-operator-using-the-cluster-operator-str" target="_blank" rel="noopener">Deploying the Topic Operator using the Cluster Operator (recommended)</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-the-topic-operator-standalone-str" target="_blank" rel="noopener">Deploying the standalone Topic Operator</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To deploy the standalone Topic Operator, you need to set environment variables to connect to a Kafka cluster.
These environment variables do not need to be set if you are deploying the Topic Operator using the Cluster Operator as they will be set by the Cluster Operator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ref-operator-topic-str"><a class="link" href="#ref-operator-topic-str">5.3.1. Kafka topic resource</a></h4>
<div class="paragraph">
<p>The <code>KafkaTopic</code> resource is used to configure topics, including the number of partitions and replicas.</p>
</div>
<div class="paragraph">
<p>The full schema for <code>KafkaTopic</code> is described in <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code> schema reference</a>.</p>
</div>
<div class="sect4">
<h5 id="identifying_a_kafka_cluster_for_topic_handling"><a class="link" href="#identifying_a_kafka_cluster_for_topic_handling">Identifying a Kafka cluster for topic handling</a></h5>
<div class="paragraph">
<p>A <code>KafkaTopic</code> resource includes a label that specifies the name of the Kafka cluster (derived from the name of the <code>Kafka</code> resource) to which it belongs.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: topic-name-1
  labels:
    strimzi.io/cluster: my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label is used by the Topic Operator to identify the <code>KafkaTopic</code> resource and create a new topic, and also in subsequent handling of the topic.</p>
</div>
<div class="paragraph">
<p>If the label does not match the Kafka cluster, the Topic Operator cannot identify the <code>KafkaTopic</code> and the topic is not created.</p>
</div>
</div>
<div class="sect4">
<h5 id="kafka_topic_usage_recommendations"><a class="link" href="#kafka_topic_usage_recommendations">Kafka topic usage recommendations</a></h5>
<div class="paragraph">
<p>When working with topics, be consistent.
Always operate on either <code>KafkaTopic</code> resources or topics directly in Kubernetes.
Avoid routinely switching between both methods for a given topic.</p>
</div>
<div class="paragraph">
<p>Use topic names that reflect the nature of the topic, and remember that names cannot be changed later.</p>
</div>
<div class="paragraph">
<p>If creating a topic in Kafka, use a name that is a valid Kubernetes resource name,
otherwise the Topic Operator will need to create the corresponding <code>KafkaTopic</code> with a name that conforms to the Kubernetes rules.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For information on the requirements for identifiers and names in Kubernetes, refer to <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names" target="_blank" rel="noopener">Object Names and IDs</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="kafka_topic_naming_conventions"><a class="link" href="#kafka_topic_naming_conventions">Kafka topic naming conventions</a></h5>
<div class="paragraph">
<p>Kafka and Kubernetes impose their own validation rules for the naming of topics in Kafka and <code>KafkaTopic.metadata.name</code> respectively.
There are valid names for each which are invalid in the other.</p>
</div>
<div class="paragraph">
<p>Using the <code>spec.topicName</code> property, it is possible to create a valid topic in Kafka with a name that would be invalid for the Kafka topic in Kubernetes.</p>
</div>
<div class="paragraph">
<p>The <code>spec.topicName</code> property inherits Kafka naming validation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name must not be longer than 249 characters.</p>
</li>
<li>
<p>Valid characters for Kafka topics are ASCII alphanumerics, <code>.</code>, <code>_</code>, and <code>-</code>.</p>
</li>
<li>
<p>The name cannot be <code>.</code> or <code>..</code>, though <code>.</code> can be used in a name, such as <code>exampleTopic.</code> or <code>.exampleTopic</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>spec.topicName</code> must not be changed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: topicName-1 <b class="conum">(1)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Upper case is invalid in Kubernetes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>cannot be changed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: name-2
  # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Some Kafka client applications, such as Kafka Streams, can create topics in Kafka programmatically.
If those topics have names that are invalid Kubernetes resource names, the Topic Operator gives them a valid <code>metadata.name</code> based on the Kafka name.
Invalid characters are replaced and a hash is appended to the name.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: mytopic---c55e57fe2546a33f9e603caf57165db4072e827e
spec:
  topicName: myTopic
  # ...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-topic-operator-store-str"><a class="link" href="#ref-topic-operator-store-str">5.3.2. Topic Operator topic store</a></h4>
<div class="paragraph _abstract">
<p>The Topic Operator uses Kafka to store topic metadata describing topic configuration as key-value pairs.
The <em>topic store</em> is based on the Kafka Streams key-value mechanism, which uses Kafka topics to persist the state.</p>
</div>
<div class="paragraph">
<p>Topic metadata is cached in-memory and accessed locally within the Topic Operator.
Updates from operations applied to the local in-memory cache are persisted to a backup topic store on disk.
The topic store is continually synchronized with updates from Kafka topics or Kubernetes <code>KafkaTopic</code> custom resources.
Operations are handled rapidly with the topic store set up this way,
but should the in-memory cache crash it is automatically repopulated from the persistent storage.</p>
</div>
<div class="sect4">
<h5 id="internal_topic_store_topics"><a class="link" href="#internal_topic_store_topics">Internal topic store topics</a></h5>
<div class="paragraph">
<p>Internal topics support the handling of topic metadata in the topic store.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>__strimzi_store_topic</code></dt>
<dd>
<p>Input topic for storing the topic metadata</p>
</dd>
<dt class="hdlist1"><code>__strimzi-topic-operator-kstreams-topic-store-changelog</code></dt>
<dd>
<p>Retains a log of compacted topic store values</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not delete these topics, as they are essential to the running of the Topic Operator.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="migrating_topic_metadata_from_zookeeper"><a class="link" href="#migrating_topic_metadata_from_zookeeper">Migrating topic metadata from ZooKeeper</a></h5>
<div class="paragraph">
<p>In previous releases of Strimzi, topic metadata was stored in ZooKeeper.
The new process removes this requirement, bringing the metadata into the Kafka cluster, and under the control of the Topic Operator.</p>
</div>
<div class="paragraph">
<p>When upgrading to Strimzi latest, the transition to Topic Operator control of the topic store is seamless.
Metadata is found and migrated from ZooKeeper, and the old store is deleted.</p>
</div>
</div>
<div class="sect4">
<h5 id="downgrading_to_a_strimzi_version_that_uses_zookeeper_to_store_topic_metadata"><a class="link" href="#downgrading_to_a_strimzi_version_that_uses_zookeeper_to_store_topic_metadata">Downgrading to a Strimzi version that uses ZooKeeper to store topic metadata</a></h5>
<div class="paragraph">
<p>If you are reverting back to a version of Strimzi earlier than 0.22, which uses ZooKeeper for the storage of topic metadata,
you still downgrade your Cluster Operator to the previous version,
then downgrade Kafka brokers and client applications to the previous Kafka version as standard.</p>
</div>
<div class="paragraph">
<p>However, you must also delete the topics that were created for the topic store using a <code>kafka-admin</code> command, specifying the bootstrap address of the Kafka cluster.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl run kafka-admin -ti --image=quay.io/strimzi/kafka:latest-kafka-3.3.2 --rm=true --restart=Never -- ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic __strimzi-topic-operator-kstreams-topic-store-changelog --delete &amp;&amp; ./bin/kafka-topics.sh --bootstrap-server localhost:9092 --topic __strimzi_store_topic --delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command must correspond to the type of listener and authentication used to access the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The Topic Operator will reconstruct the ZooKeeper topic metadata from the state of the topics in Kafka.</p>
</div>
</div>
<div class="sect4">
<h5 id="topic_operator_topic_replication_and_scaling"><a class="link" href="#topic_operator_topic_replication_and_scaling">Topic Operator topic replication and scaling</a></h5>
<div class="paragraph">
<p>The recommended configuration for topics managed by the Topic Operator is a topic replication factor of 3, and a minimum of 2 in-sync replicas.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10 <b class="conum">(1)</b>
  replicas: 3 <b class="conum">(2)</b>
  config:
    min.insync.replicas: 2 <b class="conum">(3)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The number of partitions for the topic.</p>
</li>
<li>
<p>The number of replica topic partitions. Currently, this cannot be changed in the <code>KafkaTopic</code> resource, but it can be changed using the <code>kafka-reassign-partitions.sh</code> tool.</p>
</li>
<li>
<p>The minimum number of replica partitions that a message must be successfully written to, or an exception is raised.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In-sync replicas are used in conjunction with the <code>acks</code> configuration for producer applications.
The <code>acks</code> configuration determines the number of follower partitions a message must be replicated to before the message is acknowledged as successfully received.
The Topic Operator runs with <code>acks=all</code>, whereby messages must be acknowledged by all in-sync replicas.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When scaling Kafka clusters by adding or removing brokers, replication factor configuration is not changed and replicas are not reassigned automatically.
However, you can use the <code>kafka-reassign-partitions.sh</code> tool to change the replication factor, and manually reassign replicas to brokers.</p>
</div>
<div class="paragraph">
<p>Alternatively, though the integration of Cruise Control for Strimzi cannot change the replication factor for topics,
the optimization proposals it generates for rebalancing Kafka include commands that transfer partition replicas and change partition leadership.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling_changes_to_topics"><a class="link" href="#handling_changes_to_topics">Handling changes to topics</a></h5>
<div class="paragraph">
<p>A fundamental problem that the Topic Operator needs to solve is that there is no single source of truth:
both the <code>KafkaTopic</code> resource and the Kafka topic can be modified independently of the Topic Operator.
Complicating this, the Topic Operator might not always be able to observe changes at each end in real time.
For example, when the Topic Operator is down.</p>
</div>
<div class="paragraph">
<p>To resolve this, the Topic Operator maintains information about each topic in the topic store.
When a change happens in the Kafka cluster or Kubernetes, it looks at both the state of the other system and the topic store in order to determine what needs to change to keep everything in sync.
The same thing happens whenever the Topic Operator starts, and periodically while it is running.</p>
</div>
<div class="paragraph">
<p>For example, suppose the Topic Operator is not running, and a <code>KafkaTopic</code> called <em>my-topic</em> is created.
When the Topic Operator starts, the topic store does not contain information on my-topic, so it can infer that the <code>KafkaTopic</code> was created after it was last running.
The Topic Operator creates the topic corresponding to my-topic, and also stores metadata for my-topic in the topic store.</p>
</div>
<div class="paragraph">
<p>If you update Kafka topic configuration or apply a change through the <code>KafkaTopic</code> custom resource,
the topic store is updated after the Kafka cluster is reconciled.</p>
</div>
<div class="paragraph">
<p>The topic store also allows the Topic Operator to manage scenarios where the topic configuration is changed in Kafka topics <em>and</em> updated through Kubernetes <code>KafkaTopic</code> custom resources,
as long as the changes are not incompatible.
For example, it is possible to make changes to the same topic config key, but to different values.
For incompatible changes, the Kafka configuration takes priority, and the <code>KafkaTopic</code> is updated accordingly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also use the <code>KafkaTopic</code> resource to delete topics using a <code>kubectl delete -f <em>KAFKA-TOPIC-CONFIG-FILE</em></code> command.
To be able to do this, <code>delete.topic.enable</code> must be set to <code>true</code> (default) in the <code>spec.kafka.config</code> of the Kafka resource.
</td>
</tr>
</table>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#assembly-downgrade-str" target="_blank" rel="noopener">Downgrading Strimzi</a></p>
</li>
<li>
<p><a href="#con-partition-reassignment-str">Scaling cluster and partition reassignment</a></p>
</li>
<li>
<p><a href="#cruise-control-concepts-str">Cruise Control for cluster rebalancing</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-topic-str"><a class="link" href="#proc-configuring-kafka-topic-str">5.3.3. Configuring Kafka topics</a></h4>
<div class="paragraph _abstract">
<p>Use the properties of the <code>KafkaTopic</code> resource to configure Kafka topics.</p>
</div>
<div class="paragraph">
<p>You can use <code>kubectl apply</code> to create or modify topics, and <code>kubectl delete</code> to delete existing topics.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubectl apply -f <em>&lt;topic_config_file&gt;</em></code></p>
</li>
<li>
<p><code>kubectl delete KafkaTopic <em>&lt;topic_name&gt;</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure shows how to create a topic with 10 partitions and 2 replicas.</p>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>It is important that you consider the following before making your changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka does not support decreasing the number of partitions.</p>
</li>
<li>
<p>Increasing <code>spec.partitions</code> for topics with keys will change how records are partitioned, which can be particularly problematic when the topic uses <em>semantic partitioning</em>.</p>
</li>
<li>
<p>Strimzi does not support making the following changes through the <code>KafkaTopic</code> resource:</p>
<div class="ulist">
<ul>
<li>
<p>Using <code>spec.replicas</code> to change the number of replicas that were initially specified</p>
</li>
<li>
<p>Changing topic names using <code>spec.topicName</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster configured with a Kafka broker listener using mTLS authentication and TLS encryption.</p>
</li>
<li>
<p>A running Topic Operator (typically <a href="#assembly-kafka-entity-operator-str">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>For deleting a topic, <code>delete.topic.enable=true</code> (default) in the <code>spec.kafka.config</code> of the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>KafkaTopic</code> resource.</p>
<div class="listingblock">
<div class="title">Example Kafka topic configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: orders
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10
  replicas: 2</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When modifying a topic, you can get the current version of the resource using <code>kubectl get kafkatopic orders -o yaml</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the <code>KafkaTopic</code> resource in Kubernetes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;topic_config_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the ready status of the topic to change to <code>True</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkatopics -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Kafka topic status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME         CLUSTER     PARTITIONS  REPLICATION FACTOR READY
my-topic-1   my-cluster  10          3                  True
my-topic-2   my-cluster  10          3
my-topic-3   my-cluster  10          3                  True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Topic creation is successful when the <code>READY</code> output shows <code>True</code>.</p>
</div>
</li>
<li>
<p>If the <code>READY</code> column stays blank, get more details on the status from the resource YAML or from the Topic Operator logs.</p>
<div class="paragraph">
<p>Messages provide details on the reason for the current status.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">oc get kafkatopics my-topic-2 -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Details on a topic with a <code>NotReady</code> status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
status:
  conditions:
  - lastTransitionTime: "2022-06-13T10:14:43.351550Z"
    message: Number of partitions cannot be decreased
    reason: PartitionDecreaseException
    status: "True"
    type: NotReady</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the reason the topic is not ready is because the original number of partitions was reduced in the <code>KafkaTopic</code> configuration.
Kafka does not support this.</p>
</div>
<div class="paragraph">
<p>After resetting the topic configuration, the status shows the topic is ready.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkatopics my-topic-2 -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Status update of the topic</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME         CLUSTER     PARTITIONS  REPLICATION FACTOR READY
my-topic-2   my-cluster  10          3                  True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fetching the details shows no messages</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkatopics my-topic-2 -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Details on a topic with a <code>READY</code> status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
status:
  conditions:
  - lastTransitionTime: '2022-06-13T10:15:03.761084Z'
    status: 'True'
    type: Ready</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-topic-operator-with-resource-requests-limits-str"><a class="link" href="#proc-topic-operator-with-resource-requests-limits-str">5.3.4. Configuring the Topic Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the Topic Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit kafka <em>MY-CLUSTER</em></code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.topicOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the Topic Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # Kafka and ZooKeeper sections...
  entityOperator:
    topicOperator:
      resources:
        requests:
          cpu: "1"
          memory: 500Mi
        limits:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-using-the-user-operator-str"><a class="link" href="#assembly-using-the-user-operator-str">5.4. Using the User Operator</a></h3>
<div class="paragraph _abstract">
<p>When you create, modify or delete a user using the <code>KafkaUser</code> resource,
the User Operator ensures those changes are reflected in the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>For more information on the <code>KafkaUser</code> resource, see the <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<div class="title">Deploying the User Operator</div>
<p>You can deploy the User Operator using the Cluster Operator or as a standalone operator.
You would use a standalone User Operator with a Kafka cluster that is not managed by the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>For deployment instructions, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#deploying-the-user-operator-using-the-cluster-operator-str" target="_blank" rel="noopener">Deploying the User Operator using the Cluster Operator (recommended)</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-the-user-operator-standalone-str" target="_blank" rel="noopener">Deploying the standalone User Operator</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To deploy the standalone User Operator, you need to set environment variables to connect to a Kafka cluster.
These environment variables do not need to be set if you are deploying the User Operator using the Cluster Operator as they will be set by the Cluster Operator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-user-str"><a class="link" href="#proc-configuring-kafka-user-str">5.4.1. Configuring Kafka users</a></h4>
<div class="paragraph _abstract">
<p>Use the properties of the <code>KafkaUser</code> resource to configure Kafka users.</p>
</div>
<div class="paragraph">
<p>You can use <code>kubectl apply</code> to create or modify users, and <code>kubectl delete</code> to delete existing users.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubectl apply -f <em>&lt;user_config_file&gt;</em></code></p>
</li>
<li>
<p><code>kubectl delete KafkaUser <em>&lt;user_name&gt;</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users represent Kafka clients.
When you configure Kafka users, you enable the user authentication and authorization mechanisms required by clients to access Kafka.
The mechanism used must match the equivalent <code>Kafka</code> configuration.
For more information on using <code>Kafka</code> and <code>KafkaUser</code> resources to secure access to Kafka brokers, see <a href="./deploying.html#assembly-securing-kafka-str" target="_blank" rel="noopener">Securing access to Kafka brokers</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster configured with a Kafka broker listener using mTLS authentication and TLS encryption.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-str">deployed with the Entity Operator</a>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>KafkaUser</code> resource.</p>
<div class="paragraph">
<p>This example specifies mTLS authentication and simple authorization using ACLs.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka user configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  authorization:
    type: simple
    acls:
      # Example consumer Acls for topic my-topic using consumer group my-group
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operations:
          - Describe
          - Read
        host: "*"
      - resource:
          type: group
          name: my-group
          patternType: literal
        operations:
          - Read
        host: "*"
      # Example Producer Acls for topic my-topic
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operations:
          - Create
          - Describe
          - Write
        host: "*"</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>KafkaUser</code> resource in Kubernetes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;user_config_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the ready status of the user to change to <code>True</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkausers -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Kafka user status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME       CLUSTER     AUTHENTICATION  AUTHORIZATION READY
my-user-1  my-cluster  tls             simple        True
my-user-2  my-cluster  tls             simple
my-user-3  my-cluster  tls             simple        True</code></pre>
</div>
</div>
<div class="paragraph">
<p>User creation is successful when the <code>READY</code> output shows <code>True</code>.</p>
</div>
</li>
<li>
<p>If the <code>READY</code> column stays blank, get more details on the status from the resource YAML or User Operator logs.</p>
<div class="paragraph">
<p>Messages provide details on the reason for the current status.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkausers my-user-2 -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Details on a user with a <code>NotReady</code> status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
status:
  conditions:
  - lastTransitionTime: "2022-06-10T10:07:37.238065Z"
    message: Simple authorization ACL rules are configured but not supported in the
      Kafka cluster configuration.
    reason: InvalidResourceException
    status: "True"
    type: NotReady</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the reason the user is not ready is because simple authorization is not enabled in the <code>Kafka</code> configuration.</p>
</div>
<div class="listingblock">
<div class="title">Kafka configuration for simple authorization</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">  apiVersion: kafka.strimzi.io/v1beta2
  kind: Kafka
  metadata:
    name: my-cluster
  spec:
    kafka:
      # ...
      authorization:
        type: simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>After updating the Kafka configuration, the status shows the user is ready.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkausers my-user-2 -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Status update of the user</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME       CLUSTER     AUTHENTICATION  AUTHORIZATION READY
my-user-2  my-cluster  tls             simple        True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fetching the details shows no messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkausers my-user-2 -o yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Details on a user with a <code>READY</code> status</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># ...
status:
  conditions:
  - lastTransitionTime: "2022-06-10T10:33:40.166846Z"
    status: "True"
    type: Ready</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-user-operator-with-resource-requests-limits-str"><a class="link" href="#proc-user-operator-with-resource-requests-limits-str">5.4.2. Configuring the User Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the User Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit kafka <em>MY-CLUSTER</em></code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.userOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the User Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # Kafka and ZooKeeper sections...
  entityOperator:
    userOperator:
      resources:
        requests:
          cpu: "1"
          memory: 500Mi
        limits:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file and exit the editor.
The Cluster Operator applies the changes automatically.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ref-operator-cluster-feature-gates-str"><a class="link" href="#ref-operator-cluster-feature-gates-str">5.5. Configuring feature gates</a></h3>
<div class="paragraph _abstract">
<p>Strimzi operators support <em>feature gates</em> to enable or disable certain features and functionality.
Enabling a feature gate changes the behavior of the relevant operator and introduces the feature to your Strimzi deployment.</p>
</div>
<div class="paragraph">
<p>Feature gates have a default state of either <em>enabled</em> or <em>disabled</em>.</p>
</div>
<div class="paragraph">
<p>To modify a feature gate&#8217;s default state, use the <code>STRIMZI_FEATURE_GATES</code> environment variable in the operator&#8217;s configuration.
You can modify multiple feature gates using this single environment variable.
Specify a comma-separated list of feature gate names and prefixes.
A <code>+</code> prefix enables the feature gate and a <code>-</code> prefix  disables it.</p>
</div>
<div class="listingblock">
<div class="title">Example feature gate configuration that enables <code>FeatureGate1</code> and disables <code>FeatureGate2</code></div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">env:
  - name: STRIMZI_FEATURE_GATES
    value: +FeatureGate1,-FeatureGate2</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="controlplanelistener_feature_gate"><a class="link" href="#controlplanelistener_feature_gate">5.5.1. ControlPlaneListener feature gate</a></h4>
<div class="paragraph">
<p>The <code>ControlPlaneListener</code> feature gate has moved to GA, which means it is now permanently enabled and cannot be disabled.
With <code>ControlPlaneListener</code> enabled, the connections between the Kafka controller and brokers use an internal <em>control plane listener</em> on port 9090.
Replication of data between brokers, as well as internal connections from Strimzi operators, Cruise Control, or the Kafka Exporter use the <em>replication listener</em> on port 9091.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
With the <code>ControlPlaneListener</code> feature gate permanently enabled, it is no longer possible to upgrade or downgrade directly between Strimzi 0.22 and earlier and Strimzi 0.32 and newer.
You have to upgrade or downgrade through one of the Strimzi versions in between.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="serviceaccountpatching_feature_gate"><a class="link" href="#serviceaccountpatching_feature_gate">5.5.2. ServiceAccountPatching feature gate</a></h4>
<div class="paragraph">
<p>The <code>ServiceAccountPatching</code> feature gate has moved to GA, which means it is now permanently enabled and cannot be disabled.
With <code>ServiceAccountPatching</code> enabled, the Cluster Operator always reconciles service accounts and updates them when needed.
For example, when you change service account labels or annotations using the <code>template</code> property of a custom resource, the operator automatically updates them on the existing service account resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-operator-use-strimzi-pod-sets-feature-gate-str"><a class="link" href="#ref-operator-use-strimzi-pod-sets-feature-gate-str">5.5.3. UseStrimziPodSets feature gate</a></h4>
<div class="paragraph">
<p>The <code>UseStrimziPodSets</code> feature gate has a default state of <em>enabled</em>.</p>
</div>
<div class="paragraph">
<p>The <code>UseStrimziPodSets</code> feature gate introduces a resource for managing pods called <code>StrimziPodSet</code>.
When the feature gate is enabled, this resource is used instead of the StatefulSets.
Strimzi handles the creation and management of pods instead of Kubernetes.
Using StrimziPodSets instead of StatefulSets provides more control over the functionality.</p>
</div>
<div class="paragraph">
<p>When this feature gate is disabled, Strimzi relies on StatefulSets to create and manage pods for the ZooKeeper and Kafka clusters.
Strimzi creates the StatefulSet and Kubernetes creates the pods according to the StatefulSet definition.
When a pod is deleted, Kubernetes is responsible for recreating it.
The use of StatefulSets has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pods are always created or removed based on their index numbers</p>
</li>
<li>
<p>All pods in the StatefulSet need to have a similar configuration</p>
</li>
<li>
<p>Changing storage configuration for the Pods in the StatefulSet is complicated</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Disabling the UseStrimziPodSets feature gate</div>
<p>To disable the <code>UseStrimziPodSets</code> feature gate, specify <code>-UseStrimziPodSets</code> in the <code>STRIMZI_FEATURE_GATES</code> environment variable in the Cluster Operator configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>UseStrimziPodSets</code> feature gate must be disabled when downgrading to Strimzi 0.27 and earlier versions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ref-operator-use-kraft-feature-gate-str"><a class="link" href="#ref-operator-use-kraft-feature-gate-str">5.5.4. (Preview) UseKRaft feature gate</a></h4>
<div class="paragraph">
<p>The <code>UseKRaft</code> feature gate has a default state of <em>disabled</em>.</p>
</div>
<div class="paragraph">
<p>The <code>UseKRaft</code> feature gate deploys the Kafka cluster in the KRaft (Kafka Raft metadata) mode without ZooKeeper.
This feature gate is currently intended only for development and testing.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>The KRaft mode is not ready for production in Apache Kafka or in Strimzi.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the <code>UseKRaft</code> feature gate is enabled, the Kafka cluster is deployed without ZooKeeper.
<strong>The <code>.spec.zookeeper</code> properties in the Kafka custom resource will be ignored, but still need to be present.</strong>
The <code>UseKRaft</code> feature gate provides an API that configures Kafka cluster nodes and their roles.
The API is still in development and is expected to change before the KRaft mode is production-ready.</p>
</div>
<div class="paragraph">
<p>Currently, the KRaft mode in Strimzi has the following major limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moving from Kafka clusters with ZooKeeper to KRaft clusters or the other way around is not supported.</p>
</li>
<li>
<p>Upgrades and downgrades of Apache Kafka versions or the Strimzi operator are not supported.
Users might need to delete the cluster, upgrade the operator and deploy a new Kafka cluster.</p>
</li>
<li>
<p>The Topic Operator is not supported.
The <code>spec.entityOperator.topicOperator</code> property <strong>must be removed</strong> from the <code>Kafka</code> custom resource.</p>
</li>
<li>
<p>SCRAM-SHA-512 authentication is not supported.</p>
</li>
<li>
<p>JBOD storage is not supported.
The <code>type: jbod</code> storage can be used, but the JBOD array can contain only one disk.</p>
</li>
<li>
<p>All Kafka nodes have both the <code>controller</code> and <code>broker</code> KRaft roles.
Kafka clusters with separate <code>controller</code> and <code>broker</code> nodes are not supported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Enabling the UseStrimziPodSets feature gate</div>
<p>To enable the <code>UseKRaft</code> feature gate, specify <code>+UseKRaft</code> in the <code>STRIMZI_FEATURE_GATES</code> environment variable in the Cluster Operator configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>UseKRaft</code> feature gate depends on the <code>UseStrimziPodSets</code> feature gate.
When enabling the <code>UseKRaft</code> feature gate, make sure that the <code>USeStrimziPodSets</code> feature gate is enabled as well.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ref-operator-cluster-feature-gate-releases-str"><a class="link" href="#ref-operator-cluster-feature-gate-releases-str">5.5.5. Feature gate releases</a></h4>
<div class="paragraph _abstract">
<p>Feature gates have three stages of maturity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Alpha  typically disabled by default</p>
</li>
<li>
<p>Beta  typically enabled by default</p>
</li>
<li>
<p>General Availability (GA)  typically always enabled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Alpha stage features might be experimental or unstable, subject to change, or not sufficiently tested for production use.
Beta stage features are well tested and their functionality is not likely to change.
GA stage features are stable and should not change in the future.
Alpha and beta stage features are removed if they do not prove to be useful.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>ControlPlaneListener</code> feature gate moved to GA stage in Strimzi 0.32. It is now permanently enabled and cannot be disabled.</p>
</li>
<li>
<p>The <code>ServiceAccountPatching</code> feature gate moved to GA stage in Strimzi 0.30. It is now permanently enabled and cannot be disabled.</p>
</li>
<li>
<p>The <code>UseStrimziPodSets</code> feature gate moved to beta stage in Strimzi 0.30.
It moves to GA in Strimzi 0.35 when the support for StatefulSets is completely removed.</p>
</li>
<li>
<p>The <code>UseKRaft</code> feature gate is available for development only and does not currently have a planned release for moving to the beta phase.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Feature gates might be removed when they reach GA. This means that the feature was incorporated into the Strimzi core features and can no longer be disabled.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 9. Feature gates and the Strimzi versions when they moved to alpha, beta, or GA</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature gate</th>
<th class="tableblock halign-left valign-top">Alpha</th>
<th class="tableblock halign-left valign-top">Beta</th>
<th class="tableblock halign-left valign-top">GA</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControlPlaneListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceAccountPatching</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.30</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UseStrimziPodSets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.35 (planned)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UseKRaft</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a feature gate is enabled, you may need to disable it before upgrading or downgrading from a specific Strimzi version.
The following table shows which feature gates you need to disable when upgrading or downgrading Strimzi versions.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 10. Feature gates to disable when upgrading or downgrading Strimzi</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Disable Feature gate</th>
<th class="tableblock halign-left valign-top">Upgrading from Strimzi version</th>
<th class="tableblock halign-left valign-top">Downgrading to Strimzi version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ControlPlaneListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.22 and earlier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.22 and earlier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UseStrimziPodSets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.27 and earlier</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-operators-prometheus-metrics-str"><a class="link" href="#con-operators-prometheus-metrics-str">5.6. Monitoring operators using Prometheus metrics</a></h3>
<div class="paragraph">
<p>Strimzi operators expose Prometheus metrics.
The metrics are automatically enabled and contain information about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of reconciliations</p>
</li>
<li>
<p>Number of Custom Resources the operator is processing</p>
</li>
<li>
<p>Duration of reconciliations</p>
</li>
<li>
<p>JVM metrics from the operators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, we provide an example Grafana dashboard.</p>
</div>
<div class="paragraph">
<p>For more information about Prometheus, see the <a href="./deploying.html#assembly-metrics-str">Introducing Metrics to Kafka</a> in the <em>Deploying and Upgrading Strimzi</em> guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cruise-control-concepts-str"><a class="link" href="#cruise-control-concepts-str">6. Cruise Control for cluster rebalancing</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Cruise Control is an open source system that supports the following Kafka operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitoring cluster workload</p>
</li>
<li>
<p>Rebalancing a cluster based on predefined constraints</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The operations help with running a more balanced Kafka cluster that uses broker pods more efficiently.</p>
</div>
<div class="paragraph">
<p>A typical cluster can become unevenly loaded over time.
Partitions that handle large amounts of message traffic might not be evenly distributed across the available brokers.
To rebalance the cluster, administrators must monitor the load on brokers and manually reassign busy partitions to brokers with spare capacity.</p>
</div>
<div class="paragraph">
<p>Cruise Control automates the cluster rebalancing process.
It constructs a <em>workload model</em> of resource utilization for the cluster&#8212;&#8203;based on CPU, disk, and network load&#8212;&#8203;and generates optimization proposals (that you can approve or reject) for more balanced partition assignments.
A set of configurable optimization goals is used to calculate these proposals.</p>
</div>
<div class="paragraph">
<p>You can generate optimization proposals in specific modes.
The default <code>full</code> mode rebalances partitions across all brokers.
You can also use the <code>add-brokers</code> and <code>remove-brokers</code> modes to accommodate changes when scaling a cluster up or down.</p>
</div>
<div class="paragraph">
<p>When you approve an optimization proposal, Cruise Control applies it to your Kafka cluster.
You configure and generate optimization proposals using a <code>KafkaRebalance</code> resource.
You can configure the resource using an annotation so that optimization proposals are approved automatically or manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi provides <a href="./deploying.html#deploy-examples-str">example configuration files for Cruise Control</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-cruise-control-overview-str"><a class="link" href="#con-cruise-control-overview-str">6.1. Cruise Control components and features</a></h3>
<div class="paragraph _abstract">
<p>Cruise Control consists of four main components&#8212;&#8203;the Load Monitor, the Analyzer, the Anomaly Detector, and the Executor&#8212;&#8203;and a REST API for client interactions.
Strimzi utilizes the REST API to support the following Cruise Control features:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Generating optimization proposals from optimization goals.</p>
</li>
<li>
<p>Rebalancing a Kafka cluster based on an optimization proposal.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Optimization goals</dt>
<dd>
<p>An optimization goal describes a specific objective to achieve from a rebalance.
For example, a goal might be to distribute topic replicas across brokers more evenly.
You can change what goals to include through configuration.
A goal is defined as a hard goal or soft goal.
You can add hard goals through Cruise Control deployment configuration.
You also have main, default, and user-provided goals that fit into each of these categories.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Hard goals</strong> are preset and must be satisfied for an optimization proposal to be successful.</p>
</li>
<li>
<p><strong>Soft goals</strong> do not need to be satisfied for an optimization proposal to be successful.
They can be set aside if it means that all hard goals are met.</p>
</li>
<li>
<p><strong>Main goals</strong> are inherited from Cruise Control. Some are preset as hard goals.
Main goals are used in optimization proposals by default.</p>
</li>
<li>
<p><strong>Default goals</strong> are the same as the main goals by default.
You can specify your own set of default goals.</p>
</li>
<li>
<p><strong>User-provided goals</strong> are a subset of default goals that are configured for generating a specific optimization proposal.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Optimization proposals</dt>
<dd>
<p>Optimization proposals comprise the goals you want to achieve from a rebalance.
You generate an optimization proposal to create a summary of proposed changes and the results that are possible with the rebalance.
The goals are assessed in a specific order of priority.
You can then choose to approve or reject the proposal.
You can reject the proposal to run it again with an adjusted set of goals.</p>
<div class="paragraph">
<p>You can generate an optimization proposal in one of three modes.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong><code>full</code></strong> is the default mode and runs a full rebalance.</p>
</li>
<li>
<p><strong><code>add-brokers</code></strong> is the mode you use after adding brokers when scaling up a Kafka cluster.</p>
</li>
<li>
<p><strong><code>remove-brokers</code></strong> is the mode you use before removing brokers when scaling down a Kafka cluster.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Other Cruise Control features are not currently supported, including self healing, notifications, write-your-own goals, and changing the topic replication factor.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/linkedin/cruise-control/wiki/Configurations" target="_blank" rel="noopener">Cruise Control documentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-optimization-goals-str"><a class="link" href="#con-optimization-goals-str">6.2. Optimization goals overview</a></h3>
<div class="paragraph _abstract">
<p>Optimization goals are constraints on workload redistribution and resource utilization across a Kafka cluster.
To rebalance a Kafka cluster, Cruise Control uses optimization goals to generate <a href="#con-optimization-proposals-str">optimization proposals</a>, which you can approve or reject.</p>
</div>
<div class="sect3">
<h4 id="goals_order_of_priority"><a class="link" href="#goals_order_of_priority">6.2.1. Goals order of priority</a></h4>
<div class="paragraph">
<p>Strimzi supports most of the optimization goals developed in the Cruise Control project.
The supported goals, in the default descending order of priority, are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rack-awareness</p>
</li>
<li>
<p>Minimum number of leader replicas per broker for a set of topics</p>
</li>
<li>
<p>Replica capacity</p>
</li>
<li>
<p>Capacity goals</p>
<div class="ulist">
<ul>
<li>
<p>Disk capacity</p>
</li>
<li>
<p>Network inbound capacity</p>
</li>
<li>
<p>Network outbound capacity</p>
</li>
<li>
<p>CPU capacity</p>
</li>
</ul>
</div>
</li>
<li>
<p>Replica distribution</p>
</li>
<li>
<p>Potential network output</p>
</li>
<li>
<p>Resource distribution goals</p>
<div class="ulist">
<ul>
<li>
<p>Disk utilization distribution</p>
</li>
<li>
<p>Network inbound utilization distribution</p>
</li>
<li>
<p>Network outbound utilization distribution</p>
</li>
<li>
<p>CPU utilization distribution</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leader bytes-in rate distribution</p>
</li>
<li>
<p>Topic replica distribution</p>
</li>
<li>
<p>Leader replica distribution</p>
</li>
<li>
<p>Preferred leader election</p>
</li>
<li>
<p>Intra-broker disk capacity</p>
</li>
<li>
<p>Intra-broker disk usage distribution</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on each optimization goal, see <a href="https://github.com/linkedin/cruise-control/wiki/Pluggable-Components#goals" target="_blank" rel="noopener">Goals</a> in the Cruise Control Wiki.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
"Write your own" goals and Kafka assigner goals are not yet supported.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="goals_configuration_in_strimzi_custom_resources"><a class="link" href="#goals_configuration_in_strimzi_custom_resources">6.2.2. Goals configuration in Strimzi custom resources</a></h4>
<div class="paragraph">
<p>You configure optimization goals in <code>Kafka</code> and <code>KafkaRebalance</code> custom resources.
Cruise Control has configurations for hard optimization goals that must be satisfied, as well as main, default, and user-provided optimization goals.</p>
</div>
<div class="paragraph">
<p>You can specify optimization goals in the following configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main goals</strong>&#8201;&#8212;&#8201;<code>Kafka.spec.cruiseControl.config.goals</code></p>
</li>
<li>
<p><strong>Hard goals</strong>&#8201;&#8212;&#8201;<code>Kafka.spec.cruiseControl.config.hard.goals</code></p>
</li>
<li>
<p><strong>Default goals</strong>&#8201;&#8212;&#8201;<code>Kafka.spec.cruiseControl.config.default.goals</code></p>
</li>
<li>
<p><strong>User-provided goals</strong>&#8201;&#8212;&#8201;<code>KafkaRebalance.spec.goals</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Resource distribution goals are subject to <a href="#property-cruise-control-broker-capacity-reference">capacity limits</a> on broker resources.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="hard-soft-goals"><a class="link" href="#hard-soft-goals">6.2.3. Hard and soft optimization goals</a></h4>
<div class="paragraph">
<p>Hard goals are goals that <em>must</em> be satisfied in optimization proposals.
Goals that are not configured as hard goals are known as <em>soft goals</em>.
You can think of soft goals as <em>best effort</em> goals: they do <em>not</em> need to be satisfied in optimization proposals, but are included in optimization calculations.
An optimization proposal that violates one or more soft goals, but satisfies all hard goals, is valid.</p>
</div>
<div class="paragraph">
<p>Cruise Control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order).
An optimization proposal that does <em>not</em> satisfy all the hard goals is rejected by Cruise Control and not sent to the user for approval.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For example, you might have a soft goal to distribute a topic&#8217;s replicas evenly across the cluster (the topic replica distribution goal).
Cruise Control will ignore this goal if doing so enables all the configured hard goals to be met.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Cruise Control, the following <a href="#main-goals">main optimization goals</a> are preset as hard goals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">RackAwareGoal; MinTopicLeadersPerBrokerGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal</code></pre>
</div>
</div>
<div class="paragraph">
<p>You configure hard goals in the Cruise Control deployment configuration, by editing the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To inherit the preset hard goals from Cruise Control, do not specify the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code></p>
</li>
<li>
<p>To change the preset hard goals, specify the desired goals in the <code>hard.goals</code> property, using their fully-qualified domain names.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> configuration for hard optimization goals</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}
  cruiseControl:
    brokerCapacity:
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
    config:
      hard.goals: &gt;
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Increasing the number of configured hard goals will reduce the likelihood of Cruise Control generating valid optimization proposals.</p>
</div>
<div class="paragraph">
<p>If <code>skipHardGoalCheck: true</code> is specified in the <code>KafkaRebalance</code> custom resource, Cruise Control does <em>not</em> check that the list of user-provided optimization goals (in <code>KafkaRebalance.spec.goals</code>) contains <em>all</em> the configured hard goals (<code>hard.goals</code>).
Therefore, if some, but not all, of the user-provided optimization goals are in the <code>hard.goals</code> list, Cruise Control will still treat them as hard goals even if <code>skipHardGoalCheck: true</code> is specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="main-goals"><a class="link" href="#main-goals">6.2.4. Main optimization goals</a></h4>
<div class="paragraph">
<p>The <em>main optimization goals</em> are available to all users.
Goals that are not listed in the main optimization goals are not available for use in Cruise Control operations.</p>
</div>
<div class="paragraph">
<p>Unless you change the Cruise Control <a href="#proc-configuring-deploying-cruise-control-str">deployment configuration</a>, Strimzi will inherit the following main optimization goals from Cruise Control, in descending priority order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal; ReplicaDistributionGoal; PotentialNwOutGoal; DiskUsageDistributionGoal; NetworkInboundUsageDistributionGoal; NetworkOutboundUsageDistributionGoal; CpuUsageDistributionGoal; TopicReplicaDistributionGoal; LeaderReplicaDistributionGoal; LeaderBytesInDistributionGoal; PreferredLeaderElectionGoal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some of these goals are preset as <a href="#hard-soft-goals">hard goals</a>.</p>
</div>
<div class="paragraph">
<p>To reduce complexity, we recommend that you use the inherited main optimization goals, unless you need to <em>completely</em> exclude one or more goals from use in <code>KafkaRebalance</code> resources. The priority order of the main optimization goals can be modified, if desired, in the configuration for <a href="#default-goals">default optimization goals</a>.</p>
</div>
<div class="paragraph">
<p>You configure main optimization goals, if necessary, in the Cruise Control deployment configuration: <code>Kafka.spec.cruiseControl.config.goals</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>To accept the inherited main optimization goals, do not specify the <code>goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>If you need to modify the inherited main optimization goals, specify a list of goals, in descending priority order, in the <code>goals</code> configuration option.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you change the inherited main optimization goals, you must ensure that the hard goals, if configured in the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>, are a subset of the main optimization goals that you configured. Otherwise, errors will occur when generating optimization proposals.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="default-goals"><a class="link" href="#default-goals">6.2.5. Default optimization goals</a></h4>
<div class="paragraph">
<p>Cruise Control uses the <em>default optimization goals</em> to generate the <em>cached optimization proposal</em>.
For more information about the cached optimization proposal, see <a href="#con-optimization-proposals-str">Optimization proposals overview</a>.</p>
</div>
<div class="paragraph">
<p>You can override the default optimization goals by setting <a href="#user-provided-goals">user-provided optimization goals</a> in a <code>KafkaRebalance</code> custom resource.</p>
</div>
<div class="paragraph">
<p>Unless you specify <code>default.goals</code> in the Cruise Control <a href="#proc-configuring-deploying-cruise-control-str">deployment configuration</a>, the main optimization goals are used as the default optimization goals.
In this case, the cached optimization proposal is generated using the main optimization goals.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use the main optimization goals as the default goals, do not specify the <code>default.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>To modify the default optimization goals, edit the <code>default.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.
You must use a subset of the main optimization goals.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> configuration for default optimization goals</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}
  cruiseControl:
    brokerCapacity:
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
    config:
      default.goals: &gt;
        com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskCapacityGoal
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no default optimization goals are specified, the cached proposal is generated using the main optimization goals.</p>
</div>
</div>
<div class="sect3">
<h4 id="user-provided-goals"><a class="link" href="#user-provided-goals">6.2.6. User-provided optimization goals</a></h4>
<div class="paragraph">
<p><em>User-provided optimization goals</em> narrow down the configured default goals for a particular optimization proposal.
You can set them, as required, in <code>spec.goals</code> in a <code>KafkaRebalance</code> custom resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>KafkaRebalance.spec.goals</pre>
</div>
</div>
<div class="paragraph">
<p>User-provided optimization goals can generate optimization proposals for different scenarios.
For example, you might want to optimize leader replica distribution across the Kafka cluster without considering disk capacity or disk utilization.
So, you create a <code>KafkaRebalance</code> custom resource containing a single user-provided goal for leader replica distribution.</p>
</div>
<div class="paragraph">
<p>User-provided optimization goals must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Include all configured <a href="#hard-soft-goals">hard goals</a>, or an error occurs</p>
</li>
<li>
<p>Be a subset of the main optimization goals</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ignore the configured hard goals when generating an optimization proposal, add the <code>skipHardGoalCheck: true</code> property to the <code>KafkaRebalance</code> custom resource. See <a href="#proc-generating-optimization-proposals-str">Generating optimization proposals</a>.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-configuring-deploying-cruise-control-str">Configuring and deploying Cruise Control with Kafka</a></p>
</li>
<li>
<p><a href="https://github.com/linkedin/cruise-control/wiki/Configurations" target="_blank" rel="noopener">Configurations</a> in the Cruise Control Wiki.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-optimization-proposals-str"><a class="link" href="#con-optimization-proposals-str">6.3. Optimization proposals overview</a></h3>
<div class="paragraph _abstract">
<p>Configure a <code>KafkaRebalance</code> resource to generate optimization proposals and apply the suggested changes.
An <em>optimization proposal</em> is a summary of proposed changes that would produce a more balanced Kafka cluster, with partition workloads distributed more evenly among the brokers.</p>
</div>
<div class="paragraph">
<p>Each optimization proposal is based on the set of <a href="#con-optimization-goals-str">optimization goals</a> that was used to generate it, subject to any configured <a href="#property-cruise-control-broker-capacity-reference">capacity limits on broker resources</a>.</p>
</div>
<div class="paragraph">
<p>All optimization proposals are <em>estimates</em> of the impact of a proposed rebalance.
You can approve or reject a proposal.
You cannot approve a cluster rebalance without first generating the optimization proposal.</p>
</div>
<div class="paragraph">
<p>You can run optimization proposals in one of the following rebalancing modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>full</code></p>
</li>
<li>
<p><code>add-brokers</code></p>
</li>
<li>
<p><code>remove-brokers</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-optimization-proposals-modes-str"><a class="link" href="#con-optimization-proposals-modes-str">6.3.1. Rebalancing modes</a></h4>
<div class="paragraph">
<p>You specify a rebalancing mode using the <code>spec.mode</code> property of the <code>KafkaRebalance</code> custom resource.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>full</code></dt>
<dd>
<p>The <code>full</code> mode runs a full rebalance by moving replicas across all the brokers in the cluster.
This is the default mode if the <code>spec.mode</code> property is not defined in the <code>KafkaRebalance</code> custom resource.</p>
</dd>
<dt class="hdlist1"><code>add-brokers</code></dt>
<dd>
<p>The <code>add-brokers</code> mode is used after scaling up a Kafka cluster by adding one or more brokers.
Normally, after scaling up a Kafka cluster, new brokers are used to host only the partitions of newly created topics.
If no new topics are created, the newly added brokers are not used and the existing brokers remain under the same load.
By using the <code>add-brokers</code> mode immediately after adding brokers to the cluster, the rebalancing operation moves replicas from existing brokers to the newly added brokers.
You specify the new brokers as a list using the <code>spec.brokers</code> property of the <code>KafkaRebalance</code> custom resource.</p>
</dd>
<dt class="hdlist1"><code>remove-brokers</code></dt>
<dd>
<p>The <code>remove-brokers</code> mode is used before scaling down a Kafka cluster by removing one or more brokers.
If you scale down a Kafka cluster, brokers are shut down even if they host replicas.
This can lead to under-replicated partitions and possibly result in some partitions being under their minimum ISR (in-sync replicas).
To avoid this potential problem, the <code>remove-brokers</code> mode moves replicas off the brokers that are going to be removed.
When these brokers are not hosting replicas anymore, you can safely run the scaling down operation.
You specify the brokers you&#8217;re removing as a list in the <code>spec.brokers</code> property in the <code>KafkaRebalance</code> custom resource.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In general, use the <code>full</code> rebalance mode to rebalance a Kafka cluster by spreading the load across brokers.
Use the <code>add-brokers</code> and <code>remove-brokers</code> modes only if you want to scale your cluster up or down and rebalance the replicas accordingly.</p>
</div>
<div class="paragraph">
<p>The procedure to run a rebalance is actually the same across the three different modes.
The only difference is with specifying a mode through the <code>spec.mode</code> property and, if needed, listing brokers that have been added or will be removed through the <code>spec.brokers</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="contents-optimization-proposals"><a class="link" href="#contents-optimization-proposals">6.3.2. The results of an optimization proposal</a></h4>
<div class="paragraph">
<p>When an optimization proposal is generated, a summary and broker load is returned.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Summary</dt>
<dd>
<p>The summary is contained in the <code>KafkaRebalance</code> resource. The summary provides an overview of the proposed cluster rebalance and indicates the scale of the changes involved.
A summary of a successfully generated optimization proposal is contained in the <code>Status.OptimizationResult</code> property of the <code>KafkaRebalance</code> resource.
The information provided is a summary of the full optimization proposal.</p>
</dd>
<dt class="hdlist1">Broker load</dt>
<dd>
<p>The broker load is stored in a ConfigMap that contains data as a JSON string. The broker load shows before and after values for the proposed rebalance, so you can see the impact on each of the brokers in the cluster.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="manually_approving_or_rejecting_an_optimization_proposal"><a class="link" href="#manually_approving_or_rejecting_an_optimization_proposal">6.3.3. Manually approving or rejecting an optimization proposal</a></h4>
<div class="paragraph">
<p>An optimization proposal summary shows the proposed scope of changes.</p>
</div>
<div class="paragraph">
<p>You can use the name of the <code>KafkaRebalance</code> resource to return a summary from the command line.</p>
</div>
<div class="listingblock">
<div class="title">Returning an optimization proposal summary</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe kafkarebalance <em>&lt;kafka_rebalance_resource_name&gt;</em> -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>jq</code> command line JSON parser tool.</p>
</div>
<div class="listingblock">
<div class="title">Returning an optimization proposal summary using jq</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"><code>kubectl get kafkarebalance -o json | jq <em>&lt;jq_query&gt;</em></code>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the summary to decide whether to approve or reject an optimization proposal.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Approving an optimization proposal</dt>
<dd>
<p>You approve the optimization proposal by setting the <code>strimzi.io/rebalance</code> annotation of the <code>KafkaRebalance</code> resource to <code>approve</code>.
Cruise Control applies the proposal to the Kafka cluster and starts a cluster rebalance operation.</p>
</dd>
<dt class="hdlist1">Rejecting an optimization proposal</dt>
<dd>
<p>If you choose not to approve an optimization proposal,
you can <a href="#proc-generating-optimization-proposals-str">change the optimization goals</a> or <a href="#rebalance_tuning_options">update any of the rebalance performance tuning options</a>, and then generate another proposal.
You can use the <code>strimzi.io/refresh</code> annotation to generate a new optimization proposal for a <code>KafkaRebalance</code> resource.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use optimization proposals to assess the movements required for a rebalance.
For example, a summary describes inter-broker and intra-broker movements.
Inter-broker rebalancing moves data between separate brokers.
Intra-broker rebalancing moves data between disks on the same broker when you are using a JBOD storage configuration.
Such information can be useful even if you don&#8217;t go ahead and approve the proposal.</p>
</div>
<div class="paragraph">
<p>You might reject an optimization proposal, or delay its approval, because of the additional load on a Kafka cluster when rebalancing.</p>
</div>
<div class="paragraph">
<p>In the following example, the proposal suggests the rebalancing of data between separate brokers.
The rebalance involves the movement of 55 partition replicas, totaling 12MB of data, across the brokers.
Though the inter-broker movement of partition replicas has a high impact on performance, the total amount of data is not large.
If the total data was much larger, you could reject the proposal, or time when to approve the rebalance to limit the impact on the performance of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Rebalance performance tuning options can help reduce the impact of data movement.
If you can extend the rebalance period, you can divide the rebalance into smaller batches.
Fewer data movements at a single time reduces the load on the cluster.</p>
</div>
<div class="listingblock">
<div class="title">Example optimization proposal summary</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Name:         my-rebalance
Namespace:    myproject
Labels:       strimzi.io/cluster=my-cluster
Annotations:  API Version:  kafka.strimzi.io/v1alpha1
Kind:         KafkaRebalance
Metadata:
# ...
Status:
  Conditions:
    Last Transition Time:  2022-04-05T14:36:11.900Z
    Status:                ProposalReady
    Type:                  State
  Observed Generation:     1
  Optimization Result:
    Data To Move MB:  0
    Excluded Brokers For Leadership:
    Excluded Brokers For Replica Move:
    Excluded Topics:
    Intra Broker Data To Move MB:         12
    Monitored Partitions Percentage:      100
    Num Intra Broker Replica Movements:   0
    Num Leader Movements:                 24
    Num Replica Movements:                55
    On Demand Balancedness Score After:   82.91290759174306
    On Demand Balancedness Score Before:  78.01176356230222
    Recent Windows:                       5
  Session Id:                             a4f833bd-2055-4213-bfdd-ad21f95bf184</code></pre>
</div>
</div>
<div class="paragraph">
<p>The proposal will also move 24 partition leaders to different brokers.
This requires a change to the ZooKeeper configuration, which has a low impact on performance.</p>
</div>
<div class="paragraph">
<p>The balancedness scores are measurements of the overall balance of the Kafka cluster before and after the optimization proposal is approved.
A balancedness score is based on optimization goals.
If all goals are satisfied, the score is 100.
The score is reduced for each goal that will not be met.
Compare the balancedness scores to see whether the Kafka cluster is less balanced than it could be following a rebalance.</p>
</div>
</div>
<div class="sect3">
<h4 id="automatically_approving_an_optimization_proposal"><a class="link" href="#automatically_approving_an_optimization_proposal">6.3.4. Automatically approving an optimization proposal</a></h4>
<div class="paragraph">
<p>To save time, you can automate the process of approving optimization proposals.
With automation, when you generate an optimization proposal it goes straight into a cluster rebalance.</p>
</div>
<div class="paragraph">
<p>To enable the optimization proposal auto-approval mechanism, create the <code>KafkaRebalance</code> resource with the <code>strimzi.io/rebalance-auto-approval</code> annotation set to <code>true</code>.
If the annotation is not set or set to <code>false</code>, the optimization proposal requires manual approval.</p>
</div>
<div class="listingblock">
<div class="title">Example rebalance request with auto-approval mechanism enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
  annotations:
    strimzi.io/rebalance-auto-approval: "true"
spec:
  mode: # any mode
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can still check the status when automatically approving an optimization proposal.
The status of the <code>KafkaRebalance</code> resource moves to <code>Ready</code> when the rebalance is complete.</p>
</div>
</div>
<div class="sect3">
<h4 id="optimization_proposal_summary_properties"><a class="link" href="#optimization_proposal_summary_properties">6.3.5. Optimization proposal summary properties</a></h4>
<div class="paragraph">
<p>The following table explains the properties contained in the optimization proposal&#8217;s summary section.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 11. Properties contained in an optimization proposal summary</caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numIntraBrokerReplicaMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of partition replicas that will be transferred between the disks of the cluster&#8217;s brokers.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively high, but lower than <code>numReplicaMovements</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedBrokersForLeadership</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet supported. An empty list is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numReplicaMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of partition replicas that will be moved between separate brokers.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively high.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onDemandBalancednessScoreBefore, onDemandBalancednessScoreAfter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A measurement of the overall <em>balancedness</em> of a Kafka Cluster, before and after the optimization proposal was generated.</p>
<p class="tableblock">The score is calculated by subtracting the sum of the <code>BalancednessScore</code> of each violated soft goal from 100. Cruise Control assigns a <code>BalancednessScore</code> to every optimization goal based on several factors, including priority&#8212;&#8203;the goal&#8217;s position in the list of <code>default.goals</code> or user-provided goals.</p>
<p class="tableblock">The <code>Before</code> score is based on the current configuration of the Kafka cluster.
The <code>After</code> score is based on the generated optimization proposal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intraBrokerDataToMoveMB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the size of each partition replica that will be moved between disks on the same broker (see also <code>numIntraBrokerReplicaMovements</code>).</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Variable. The larger the number, the longer the cluster rebalance will take to complete. Moving a large amount of data between disks on the same broker has less impact than between separate brokers (see <code>dataToMoveMB</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recentWindows</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of metrics windows upon which the optimization proposal is based.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataToMoveMB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the size of each partition replica that will be moved to a separate broker (see also <code>numReplicaMovements</code>).</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Variable. The larger the number, the longer the cluster rebalance will take to complete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitoredPartitionsPercentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of partitions in the Kafka cluster covered by the optimization proposal. Affected by the number of <code>excludedTopics</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedTopics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you specified a regular expression in the <code>spec.excludedTopicsRegex</code> property in the <code>KafkaRebalance</code> resource, all topic names matching that expression are listed here.
These topics are excluded from the calculation of partition replica/leader movements in the optimization proposal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numLeaderMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of partitions whose leaders will be switched to different replicas. This involves a change to ZooKeeper configuration.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively low.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedBrokersForReplicaMove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet supported. An empty list is returned.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="broker_load_properties"><a class="link" href="#broker_load_properties">6.3.6. Broker load properties</a></h4>
<div class="paragraph">
<p>The broker load is stored in a ConfigMap (with the same name as the KafkaRebalance custom resource) as a JSON formatted string. This JSON string consists of a JSON object with keys for each broker IDs linking to a number of metrics for each broker.
Each metric consist of three values.
The first is the metric value before the optimization proposal is applied, the second is the expected value of the metric after the proposal is applied, and the third is the difference between the first two values (after minus before).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The ConfigMap appears when the KafkaRebalance resource is in the <code>ProposalReady</code> state and remains after the rebalance is complete.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the name of the ConfigMap to view its data from the command line.</p>
</div>
<div class="listingblock">
<div class="title">Returning ConfigMap data</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe configmaps <em>&lt;my_rebalance_configmap_name&gt;</em> -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the <code>jq</code> command line JSON parser tool to extract the JSON string from the ConfigMap.</p>
</div>
<div class="listingblock">
<div class="title">Extracting the JSON string from the ConfigMap using jq</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get configmaps <em>&lt;my_rebalance_configmap_name&gt;</em> -o json | jq '.["data"]["brokerLoad.json"]|fromjson|.'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table explains the properties contained in the optimization proposal&#8217;s broker load ConfigMap:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>leaders</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of replicas on this broker that are partition leaders.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replicas</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of replicas on this broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpuPercentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CPU utilization as a percentage of the defined capacity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskUsedPercentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The disk utilization as a percentage of the defined capacity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskUsedMB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The absolute disk usage in MB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>networkOutRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total network output rate for the broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>leaderNetworkInRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The network input rate for all partition leader replicas on this broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>followerNetworkInRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The network input rate for all follower replicas on this broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>potentialMaxNetworkOutRate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hypothetical maximum network output rate that would be realized if this broker became the leader of all the replicas it currently hosts.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="cached_optimization_proposal"><a class="link" href="#cached_optimization_proposal">6.3.7. Cached optimization proposal</a></h4>
<div class="paragraph">
<p>Cruise Control maintains a <em>cached optimization proposal</em> based on the configured default optimization goals.
Generated from the workload model, the cached optimization proposal is updated every 15 minutes to reflect the current state of the Kafka cluster.
If you generate an optimization proposal using the default optimization goals, Cruise Control returns the most recent cached proposal.</p>
</div>
<div class="paragraph">
<p>To change the cached optimization proposal refresh interval, edit the <code>proposal.expiration.ms</code> setting in the Cruise Control deployment configuration.
Consider a shorter interval for fast changing clusters, although this increases the load on the Cruise Control server.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-goals-str">Optimization goals overview</a></p>
</li>
<li>
<p><a href="#proc-generating-optimization-proposals-str">Generating optimization proposals</a></p>
</li>
<li>
<p><a href="#proc-approving-optimization-proposal-str">Approving an optimization proposal</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-rebalance-str"><a class="link" href="#con-rebalance-str">6.4. Rebalance performance tuning overview</a></h3>
<div class="paragraph">
<p>You can adjust several performance tuning options for cluster rebalances.
These options control how partition replica and leadership movements in a rebalance are executed, as well as the bandwidth that is allocated to a rebalance operation.</p>
</div>
<div class="sect3">
<h4 id="partition_reassignment_commands"><a class="link" href="#partition_reassignment_commands">6.4.1. Partition reassignment commands</a></h4>
<div class="paragraph">
<p><a href="#con-optimization-proposals-str">Optimization proposals</a> are comprised of separate partition reassignment commands.
When you <a href="#proc-approving-optimization-proposal-str">approve</a> a proposal, the Cruise Control server applies these commands to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>A partition reassignment command consists of either of the following types of operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms:</p>
<div class="ulist">
<ul>
<li>
<p>Inter-broker movement: The partition replica is moved to a log directory on a different broker.</p>
</li>
<li>
<p>Intra-broker movement: The partition replica is moved to a different log directory on the same broker.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leadership movement: This involves switching the leader of the partition&#8217;s replicas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cruise Control issues partition reassignment commands to the Kafka cluster in batches.
The performance of the cluster during the rebalance is affected by the number of each type of movement contained in each batch.</p>
</div>
</div>
<div class="sect3">
<h4 id="replica_movement_strategies"><a class="link" href="#replica_movement_strategies">6.4.2. Replica movement strategies</a></h4>
<div class="paragraph">
<p>Cluster rebalance performance is also influenced by the <em>replica movement strategy</em> that is applied to the batches of partition reassignment commands.
By default, Cruise Control uses the <code>BaseReplicaMovementStrategy</code>, which simply applies the commands in the order they were generated.
However, if there are some very large partition reassignments early in the proposal, this strategy can slow down the application of the other reassignments.</p>
</div>
<div class="paragraph">
<p>Cruise Control provides four alternative replica movement strategies that can be applied to optimization proposals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PrioritizeSmallReplicaMovementStrategy</code>: Order reassignments in order of ascending size.</p>
</li>
<li>
<p><code>PrioritizeLargeReplicaMovementStrategy</code>: Order reassignments in order of descending size.</p>
</li>
<li>
<p><code>PostponeUrpReplicaMovementStrategy</code>: Prioritize reassignments for replicas of partitions which have no out-of-sync replicas.</p>
</li>
<li>
<p><code>PrioritizeMinIsrWithOfflineReplicasStrategy</code>: Prioritize reassignments with (At/Under)MinISR partitions with offline replicas.  This strategy will only work if <code>cruiseControl.config.concurrency.adjuster.min.isr.check.enabled</code> is set to <code>true</code> in the <code>Kafka</code> custom resource&#8217;s spec.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These strategies can be configured as a sequence.
The first strategy attempts to compare two partition reassignments using its internal logic.
If the reassignments are equivalent, then it passes them to the next strategy in the sequence to decide the order, and so on.</p>
</div>
</div>
<div class="sect3">
<h4 id="intra_broker_disk_balancing"><a class="link" href="#intra_broker_disk_balancing">6.4.3. Intra-broker disk balancing</a></h4>
<div class="paragraph">
<p>Moving a large amount of data between disks on the same broker has less impact than between separate brokers.
If you are running a Kafka deployment that uses JBOD storage with multiple disks on the same broker, Cruise Control can balance partitions between the disks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using JBOD storage with a single disk, intra-broker disk balancing will result in a proposal with 0 partition movements since there are no disks to balance between.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To perform an intra-broker disk balance, set <code>rebalanceDisk</code> to <code>true</code> under the <code>KafkaRebalance.spec</code>.
When setting <code>rebalanceDisk</code> to <code>true</code>, do not set a <code>goals</code> field in the <code>KafkaRebalance.spec</code>, as Cruise Control will automatically set the intra-broker goals and ignore the inter-broker goals.
Cruise Control does not perform inter-broker and intra-broker balancing at the same time.</p>
</div>
</div>
<div class="sect3">
<h4 id="rebalance_tuning_options"><a class="link" href="#rebalance_tuning_options">6.4.4. Rebalance tuning options</a></h4>
<div class="paragraph">
<p>Cruise Control provides several configuration options for tuning the rebalance parameters discussed above.
You can set these tuning options when <a href="#proc-configuring-deploying-cruise-control-str">configuring and deploying Cruise Control with Kafka</a> or <a href="#proc-generating-optimization-proposals-str">optimization proposal</a> levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Cruise Control server setting can be set in the Kafka custom resource under <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>The individual rebalance performance configurations can be set under <code>KafkaRebalance.spec</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The relevant configurations are summarized in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Rebalance performance tuning configuration</caption>
<colgroup>
<col style="width: 36.3636%;">
<col style="width: 36.3636%;">
<col style="width: 9.0909%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Cruise Control properties</th>
<th class="tableblock halign-left valign-top">KafkaRebalance properties</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>num.concurrent.partition.movements.per.broker</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>concurrentPartitionMovementsPerBroker</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of inter-broker partition movements in each partition reassignment batch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>num.concurrent.intra.broker.partition.movements</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>concurrentIntraBrokerPartitionMovements</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of intra-broker partition movements in each partition reassignment batch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>num.concurrent.leader.movements</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>concurrentLeaderMovements</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of partition leadership changes in each partition reassignment batch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>default.replication.throttle</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>replicationThrottle</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null (no limit)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bandwidth (in bytes per second) to assign to partition reassignment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>default.replica.movement.strategies</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>replicaMovementStrategies</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BaseReplicaMovementStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of strategies (in priority order) used to determine the order in which partition reassignment commands are executed for generated proposals.
  For the server setting, use a comma separated string with the fully qualified names of the strategy class (add <code>com.linkedin.kafka.cruisecontrol.executor.strategy.</code> to the start of each class name).
  For the <code>KafkaRebalance</code> resource setting use a YAML array of strategy class names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>rebalanceDisk</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables intra-broker disk balancing, which balances disk space utilization between disks on the same broker. Only applies to Kafka deployments that use JBOD storage with multiple disks.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changing the default settings affects the length of time that the rebalance takes to complete, as well as the load placed on the Kafka cluster during the rebalance.
Using lower values reduces the load but increases the amount of time taken, and vice versa.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code> schema reference</a>.</p>
</li>
<li>
<p><a href="#type-KafkaRebalanceSpec-reference"><code>KafkaRebalanceSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-configuring-deploying-cruise-control-str"><a class="link" href="#proc-configuring-deploying-cruise-control-str">6.5. Configuring and deploying Cruise Control with Kafka</a></h3>
<div class="paragraph _abstract">
<p>Configure a <code>Kafka</code> resource to deploy Cruise Control alongside a Kafka cluster.
You can use the <code>cruiseControl</code> properties of the <code>Kafka</code> resource to configure the deployment.
Deploy one instance of Cruise Control per Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Use <code>goals</code> configuration in the Cruise Control <code>config</code> to specify optimization goals for generating optimization proposals.
You can use <code>brokerCapacity</code> to change the default capacity limits for goals related to resource distribution.
If brokers are running on nodes with heterogeneous network resources, you can use <code>overrides</code> to set network capacity limits for each broker.</p>
</div>
<div class="paragraph">
<p>If an empty object (<code>{}</code>) is used for the <code>cruiseControl</code> configuration, all properties use their default values.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>cruiseControl</code> property for the <code>Kafka</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    brokerCapacity: # <b class="conum">(1)</b>
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
      overrides: # <b class="conum">(2)</b>
      - brokers: [0]
        inboundNetwork: 20000KiB/s
        outboundNetwork: 20000KiB/s
      - brokers: [1, 2]
        inboundNetwork: 30000KiB/s
        outboundNetwork: 30000KiB/s
      # ...
    config: # <b class="conum">(3)</b>
      default.goals: &gt; # <b class="conum">(4)</b>
        com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskCapacityGoal
        # ...
      hard.goals: &gt;
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal
        # ...
      cpu.balance.threshold: 1.1
      metadata.max.age.ms: 300000
      send.buffer.bytes: 131072
      webserver.http.cors.enabled: true # <b class="conum">(5)</b>
      webserver.http.cors.origin: "*"
      webserver.http.cors.exposeheaders: "User-Task-ID,Content-Type"
      # ...
    resources: # <b class="conum">(6)</b>
      requests:
        cpu: 1
        memory: 512Mi
      limits:
        cpu: 2
        memory: 2Gi
    logging: # <b class="conum">(7)</b>
        type: inline
        loggers:
          rootLogger.level: "INFO"
    template: # <b class="conum">(8)</b>
      pod:
        metadata:
          labels:
            label1: value1
        securityContext:
          runAsUser: 1000001
          fsGroup: 0
        terminationGracePeriodSeconds: 120
    readinessProbe: # <b class="conum">(9)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    metricsConfig: # <b class="conum">(10)</b>
      type: jmxPrometheusExporter
      valueFrom:
        configMapKeyRef:
          name: cruise-control-metrics
          key: metrics-config.yml
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#property-cruise-control-broker-capacity-reference">Capacity limits for broker resources</a>.</p>
</li>
<li>
<p><a href="#property-cruise-control-capacity-overrides-reference">Overrides set network capacity limits</a> for specific brokers when running on nodes with heterogeneous network resources.</p>
</li>
<li>
<p>Cruise Control configuration. <a href="#property-cruise-control-config-reference">Standard Cruise Control configuration may be provided, restricted to those properties not managed directly by Strimzi</a>.</p>
</li>
<li>
<p><a href="#con-optimization-goals-str">Optimization goals configuration</a>, which can include configuration for default optimization goals (<code>default.goals</code>), main optimization goals (<code>goals</code>), and hard goals (<code>hard.goals</code>).</p>
</li>
<li>
<p><a href="#property-cruise-control-config-cors-reference">CORS enabled and configured</a> for read-only access to the Cruise Control API.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p><a href="#property-cruise-control-logging-reference">Cruise Control loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> key. Cruise Control has a single logger named <code>rootLogger.level</code>. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with additional security attributes.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a> enabled. In this example, metrics are configured for the Prometheus JMX Exporter (the default metrics exporter).</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_configuration_file&gt;</em></code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get deployments -n <em>&lt;my_cluster_operator_namespace&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output shows the deployment name and readiness</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                      READY  UP-TO-DATE  AVAILABLE
my-cluster-cruise-control 1/1    1           1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>my-cluster</code> is the name of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p><code>READY</code> shows the number of replicas that are ready/expected.
The deployment is successful when the <code>AVAILABLE</code> output shows <code>1</code>.</p>
</div>
</li>
</ol>
</div>
<h4 id="auto_created_topics" class="discrete">Auto-created topics</h4>
<div class="paragraph">
<p>The following table shows the three topics that are automatically created when Cruise Control is deployed. These topics are required for Cruise Control to work properly and must not be deleted or changed. You can change the name of the topic using the specified configuration option.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 13. Auto-created topics</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Auto-created topic configuration</th>
<th class="tableblock halign-left valign-top">Default topic name</th>
<th class="tableblock halign-left valign-top">Created by</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metric.reporter.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strimzi Metrics Reporter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the raw metrics from the Metrics Reporter in each Kafka broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>partition.metric.sample.store.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.partitionmetricsamples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cruise Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the derived metrics for each partition. These are created by the <a href="https://github.com/linkedin/cruise-control/wiki/Overview#metric-sample-aggregator" target="_blank" rel="noopener">Metric Sample Aggregator</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>broker.metric.sample.store.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.modeltrainingsamples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cruise Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the metrics samples used to create the <a href="https://github.com/linkedin/cruise-control/wiki/Overview#cluster-workload-model" target="_blank" rel="noopener">Cluster Workload Model</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To prevent the removal of records that are needed by Cruise Control, log compaction is disabled in the auto-created topics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the names of the auto-created topics are changed in a Kafka cluster that already has Cruise Control enabled, the old topics will not be deleted and should be manually removed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After configuring and deploying Cruise Control, you can <a href="#proc-generating-optimization-proposals-str">generate optimization proposals</a>.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-goals-str">Optimization goals overview</a></p>
</li>
<li>
<p><a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-generating-optimization-proposals-str"><a class="link" href="#proc-generating-optimization-proposals-str">6.6. Generating optimization proposals</a></h3>
<div class="paragraph _abstract">
<p>When you create or update a <code>KafkaRebalance</code> resource, Cruise Control generates an <a href="#con-optimization-proposals-str">optimization proposal</a> for the Kafka cluster based on the configured <a href="#con-optimization-goals-str">optimization goals</a>.
Analyze the information in the optimization proposal and decide whether to approve it.
You can use the results of the optimization proposal to rebalance your Kafka cluster.</p>
</div>
<div class="paragraph">
<p>You can run the optimization proposal in one of the following modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>full</code> (default)</p>
</li>
<li>
<p><code>add-brokers</code></p>
</li>
<li>
<p><code>remove-brokers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mode you use depends on whether you are rebalancing across all the brokers already running in the Kafka cluster;
or you want to rebalance after scaling up or before scaling down your Kafka cluster.
For more information, see <a href="#con-optimization-proposals-modes-str">Rebalancing modes with broker scaling</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-configuring-deploying-cruise-control-str">deployed Cruise Control</a> to your Strimzi cluster.</p>
</li>
<li>
<p>You have configured <a href="#con-optimization-goals-str">optimization goals</a> and, optionally, <a href="#property-cruise-control-broker-capacity-reference">capacity limits on broker resources</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>KafkaRebalance</code> resource and specify the appropriate mode.</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>full</code> mode (default)</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To use the <em>default optimization goals</em> defined in the <code>Kafka</code> resource, leave the <code>spec</code> property empty.
Cruise Control rebalances a Kafka cluster in <code>full</code> mode by default.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration with full rebalancing by default</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also run a full rebalance by specifying the <code>full</code> mode through the <code>spec.mode</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration specifying <code>full</code> mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  mode: full</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>add-brokers</code> mode</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If you want to rebalance a Kafka cluster after scaling up, specify the <code>add-brokers</code> mode.</p>
</div>
<div class="paragraph">
<p>In this mode, existing replicas are moved to the newly added brokers.
You need to specify the brokers as a list.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration specifying <code>add-brokers</code> mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  mode: add-brokers
  brokers: [3, 4] <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>List of newly added brokers added by the scale up operation. This property is mandatory.</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>remove-brokers</code> mode</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If you want to rebalance a Kafka cluster before scaling down, specify the <code>remove-brokers</code> mode.</p>
</div>
<div class="paragraph">
<p>In this mode, replicas are moved off the brokers that are going to be removed.
You need to specify the brokers that are being removed as a list.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration specifying <code>remove-brokers</code> mode</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  mode: remove-brokers
  brokers: [3, 4] <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>List of brokers to be removed by the scale down operation. This property is mandatory.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The following steps and the steps to approve or stop a rebalance are the same regardless of the rebalance mode you are using.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>To configure <em>user-provided optimization goals</em> instead of using the default goals, add the <code>goals</code> property and enter one or more goals.</p>
<div class="paragraph">
<p>In the following example, rack awareness and replica capacity are configured as user-provided optimization goals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  goals:
    - RackAwareGoal
    - ReplicaCapacityGoal</code></pre>
</div>
</div>
</li>
<li>
<p>To ignore the configured hard goals, add the <code>skipHardGoalCheck: true</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  goals:
    - RackAwareGoal
    - ReplicaCapacityGoal
  skipHardGoalCheck: true</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) To approve the optimization proposal automatically, set the <code>strimzi.io/rebalance-auto-approval</code> annotation to <code>true</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
  annotations:
    strimzi.io/rebalance-auto-approval: "true"
spec:
  goals:
    - RackAwareGoal
    - ReplicaCapacityGoal
  skipHardGoalCheck: true</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f <em>&lt;kafka_rebalance_configuration_file&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Cluster Operator requests the optimization proposal from Cruise Control.
This might take a few minutes depending on the size of the Kafka cluster.</p>
</div>
</li>
<li>
<p>If you used the automatic approval mechanism, wait for the status of the optimization proposal to change to <code>Ready</code>.
If you haven&#8217;t enabled the automatic approval mechanism, wait for the status of the optimization proposal to change to <code>ProposalReady</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkarebalance -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>PendingProposal</code></dt>
<dd>
<p>A <code>PendingProposal</code> status means the rebalance operator is polling the Cruise Control API to check if the optimization proposal is ready.</p>
</dd>
<dt class="hdlist1"><code>ProposalReady</code></dt>
<dd>
<p>A <code>ProposalReady</code> status means the optimization proposal is ready for review and approval.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>When the status changes to <code>ProposalReady</code>, the optimization proposal is ready to approve.</p>
</div>
</li>
<li>
<p>Review the optimization proposal.</p>
<div class="paragraph">
<p>The optimization proposal is contained in the <code>Status.Optimization Result</code> property of the <code>KafkaRebalance</code> resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe kafkarebalance <em>&lt;kafka_rebalance_resource_name&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example optimization proposal</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Status:
  Conditions:
    Last Transition Time:  2020-05-19T13:50:12.533Z
    Status:                ProposalReady
    Type:                  State
  Observed Generation:     1
  Optimization Result:
    Data To Move MB:  0
    Excluded Brokers For Leadership:
    Excluded Brokers For Replica Move:
    Excluded Topics:
    Intra Broker Data To Move MB:         0
    Monitored Partitions Percentage:      100
    Num Intra Broker Replica Movements:   0
    Num Leader Movements:                 0
    Num Replica Movements:                26
    On Demand Balancedness Score After:   81.8666802863978
    On Demand Balancedness Score Before:  78.01176356230222
    Recent Windows:                       1
  Session Id:                             05539377-ca7b-45ef-b359-e13564f1458c</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties in the <code>Optimization Result</code> section describe the pending cluster rebalance operation.
For descriptions of each property, see <a href="#contents-optimization-proposals">Contents of optimization proposals</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Insufficient CPU capacity</div>
<p>If a Kafka cluster is overloaded in terms of CPU utilization, you might see an insufficient CPU capacity error in the <code>KafkaRebalance</code> status.
It&#8217;s worth noting that this utilization value is unaffected by the <code>excludedTopics</code> configuration.
Although optimization proposals will not reassign replicas of excluded topics, their load is still considered in the utilization calculation.</p>
</div>
<div class="listingblock">
<div class="title">Example CPU utilization error</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">com.linkedin.kafka.cruisecontrol.exception.OptimizationFailureException:
        [CpuCapacityGoal] Insufficient capacity for cpu (Utilization 615.21,
        Allowed Capacity 420.00, Threshold: 0.70). Add at least 3 brokers with
        the same cpu capacity (100.00) as broker-0. Add at least 3 brokers with
        the same cpu capacity (100.00) as broker-0.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The error shows CPU capacity as a percentage rather than the number of CPU cores.
For this reason, it does not directly map to the number of CPUs configured in the Kafka custom resource.
It is like having a single <em>virtual</em> CPU per broker, which has the cycles of the CPUs configured in <code>Kafka.spec.kafka.resources.limits.cpu</code>.
This has no effect on the rebalance behavior, since the ratio between CPU utilization and capacity remains the same.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p><a href="#proc-approving-optimization-proposal-str">Approving an optimization proposal</a></p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-approving-optimization-proposal-str"><a class="link" href="#proc-approving-optimization-proposal-str">6.7. Approving an optimization proposal</a></h3>
<div class="paragraph">
<p>You can approve an <a href="#con-optimization-proposals-str">optimization proposal</a> generated by Cruise Control, if its status is <code>ProposalReady</code>.
Cruise Control will then apply the optimization proposal to the Kafka cluster, reassigning partitions to brokers and changing partition leadership.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>This is not a dry run.</strong> Before you approve an optimization proposal, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refresh the proposal in case it has become out of date.</p>
</li>
<li>
<p>Carefully review the <a href="#contents-optimization-proposals">contents of the proposal</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-generating-optimization-proposals-str">generated an optimization proposal</a> from Cruise Control.</p>
</li>
<li>
<p>The <code>KafkaRebalance</code> custom resource status is <code>ProposalReady</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform these steps for the optimization proposal that you want to approve.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unless the optimization proposal is newly generated, check that it is based on current information about the state of the Kafka cluster.
To do so, refresh the optimization proposal to make sure it uses the latest cluster metrics:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes with <code>strimzi.io/rebalance=refresh</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate kafkarebalance <em>&lt;kafka_rebalance_resource_name&gt;</em> strimzi.io/rebalance=refresh</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Wait for the status of the optimization proposal to change to <code>ProposalReady</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkarebalance -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>PendingProposal</code></dt>
<dd>
<p>A <code>PendingProposal</code> status means the rebalance operator is polling the Cruise Control API to check if the optimization proposal is ready.</p>
</dd>
<dt class="hdlist1"><code>ProposalReady</code></dt>
<dd>
<p>A <code>ProposalReady</code> status means the optimization proposal is ready for review and approval.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>When the status changes to <code>ProposalReady</code>, the optimization proposal is ready to approve.</p>
</div>
</li>
<li>
<p>Approve the optimization proposal that you want Cruise Control to apply.</p>
<div class="paragraph">
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes with <code>strimzi.io/rebalance=approve</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate kafkarebalance <em>&lt;kafka_rebalance_resource_name&gt;</em> strimzi.io/rebalance=approve</code></pre>
</div>
</div>
</li>
<li>
<p>The Cluster Operator detects the annotated resource and instructs Cruise Control to rebalance the Kafka cluster.</p>
</li>
<li>
<p>Wait for the status of the optimization proposal to change to <code>Ready</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafkarebalance -o wide -w -n <em>&lt;namespace&gt;</em></code></pre>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Rebalancing</code></dt>
<dd>
<p>A <code>Rebalancing</code> status means the rebalancing is in progress.</p>
</dd>
<dt class="hdlist1"><code>Ready</code></dt>
<dd>
<p>A <code>Ready</code> status means the rebalance is complete.</p>
</dd>
<dt class="hdlist1"><code>NotReady</code></dt>
<dd>
<p>A <code>NotReady</code> status means an error occurred&#8212;&#8203;see <a href="#proc-fixing-problems-with-kafkarebalance-str">Fixing problems with a <code>KafkaRebalance</code> resource</a>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="paragraph">
<p>When the status changes to <code>Ready</code>, the rebalance is complete.</p>
</div>
<div class="paragraph">
<p>To use the same <code>KafkaRebalance</code> custom resource to generate another optimization proposal, apply the <code>refresh</code> annotation to the custom resource.
This moves the custom resource to the <code>PendingProposal</code> or <code>ProposalReady</code> state. You can then review the optimization proposal and approve it, if desired.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
<li>
<p><a href="#proc-stopping-cluster-rebalance-str">Stopping a cluster rebalance</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-stopping-cluster-rebalance-str"><a class="link" href="#proc-stopping-cluster-rebalance-str">6.8. Stopping a cluster rebalance</a></h3>
<div class="paragraph">
<p>Once started, a cluster rebalance operation might take some time to complete and affect the overall performance of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>If you want to stop a cluster rebalance operation that is in progress, apply the <code>stop</code> annotation to the <code>KafkaRebalance</code> custom resource.
This instructs Cruise Control to finish the current batch of partition reassignments and then stop the rebalance.
When the rebalance has stopped, completed partition reassignments have already been applied; therefore, the state of the Kafka cluster is different when compared to prior to the start of the rebalance operation.
If further rebalancing is required, you should generate a new optimization proposal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The performance of the Kafka cluster in the intermediate (stopped) state might be worse than in the initial state.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-approving-optimization-proposal-str">approved the optimization proposal</a> by annotating the <code>KafkaRebalance</code> custom resource with <code>approve</code>.</p>
</li>
<li>
<p>The status of the <code>KafkaRebalance</code> custom resource is <code>Rebalancing</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=stop</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the status changes to <code>Stopped</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-fixing-problems-with-kafkarebalance-str"><a class="link" href="#proc-fixing-problems-with-kafkarebalance-str">6.9. Fixing problems with a <code>KafkaRebalance</code> resource</a></h3>
<div class="paragraph">
<p>If an issue occurs when creating a <code>KafkaRebalance</code> resource or interacting with Cruise Control, the error is reported in the resource status, along with details of how to fix it.
The resource also moves to the <code>NotReady</code> state.</p>
</div>
<div class="paragraph">
<p>To continue with the cluster rebalance operation, you must fix the problem in the <code>KafkaRebalance</code> resource itself or with the overall Cruise Control deployment.
Problems might include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A misconfigured parameter in the <code>KafkaRebalance</code> resource.</p>
</li>
<li>
<p>The <code>strimzi.io/cluster</code> label for specifying the Kafka cluster in the <code>KafkaRebalance</code> resource is missing.</p>
</li>
<li>
<p>The Cruise Control server is not deployed as the <code>cruiseControl</code> property in the <code>Kafka</code> resource is missing.</p>
</li>
<li>
<p>The Cruise Control server is not reachable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After fixing the issue, you need to add the <code>refresh</code> annotation to the <code>KafkaRebalance</code> resource.
During a refresh, a new optimization proposal is requested from the Cruise Control server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-approving-optimization-proposal-str">approved an optimization proposal</a>.</p>
</li>
<li>
<p>The status of the <code>KafkaRebalance</code> custom resource for the rebalance operation is <code>NotReady</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get information about the error from the <code>KafkaRebalance</code> status:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Attempt to resolve the issue in the <code>KafkaRebalance</code> resource.</p>
</li>
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=refresh</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the status changes to <code>PendingProposal</code>, or directly to <code>ProposalReady</code>.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-str"><a class="link" href="#security-str">7. Managing TLS certificates</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Strimzi supports TLS for encrypted communication between Kafka and Strimzi components.</p>
</div>
<div class="paragraph">
<p>Communication is always encrypted between the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Communication between Kafka and ZooKeeper</p>
</li>
<li>
<p>Interbroker communication between Kafka brokers</p>
</li>
<li>
<p>Internodal communication between ZooKeeper nodes</p>
</li>
<li>
<p>Strimzi operator communication with Kafka brokers and ZooKeeper nodes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Communication between Kafka clients and Kafka brokers is encrypted according to how the cluster is configured.
For the Kafka and Strimzi components, TLS certificates are also used for authentication.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator automatically sets up and renews TLS certificates to enable encryption and authentication within your cluster.
It also sets up other TLS certificates if you want to enable encryption or mTLS authentication between Kafka brokers and clients.</p>
</div>
<div class="paragraph">
<p>CA (certificate authority) certificates are generated by the Cluster Operator to verify the identities of components and clients.
If you don&#8217;t want to use the CAs generated by the Cluster Operator, you can <a href="#installing-your-own-ca-certificates-str">install your own cluster and clients CA certificates</a>.</p>
</div>
<div class="paragraph">
<p>You can also <a href="./deploying.html#proc-installing-certs-per-listener-str">provide <em>Kafka listener certificates</em></a> for TLS listeners or external listeners that have TLS encryption enabled.
Use Kafka listener certificates to incorporate the security infrastructure you already have in place.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Any certificates you provide are not renewed by the Cluster Operator.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/secure_communication.png" alt="Secure Communication">
</div>
<div class="title">Figure 3. Example architecture of the communication secured by TLS</div>
</div>
<div class="sect2">
<h3 id="certificate-authorities-str"><a class="link" href="#certificate-authorities-str">7.1. Internal cluster CA and clients CA</a></h3>
<div class="paragraph _abstract">
<p>To support encryption, each Strimzi component needs its own private keys and public key certificates.
All component certificates are signed by an internal CA (certificate authority) called the <em>cluster CA</em>.</p>
</div>
<div class="paragraph">
<p>Similarly, each Kafka client application connecting to Strimzi using mTLS needs to use private keys and certificates.
A second internal CA, named the <em>clients CA</em>, is used to sign certificates for the Kafka clients.</p>
</div>
<div class="paragraph">
<p>Both the cluster CA and clients CA have a self-signed public key certificate.</p>
</div>
<div class="paragraph">
<p>Kafka brokers are configured to trust certificates signed by either the cluster CA or clients CA.
Components that clients do not need to connect to, such as ZooKeeper, only trust certificates signed by the cluster CA.
Unless TLS encryption for external listeners is disabled, client applications must trust certificates signed by the cluster CA.
This is also true for client applications that perform mTLS authentication.</p>
</div>
<div class="paragraph">
<p>By default, Strimzi automatically generates and renews CA certificates issued by the cluster CA or clients CA.
You can configure the management of these CA certificates in the <code>Kafka.spec.clusterCa</code> and <code>Kafka.spec.clientsCa</code> objects.</p>
</div>
<div class="paragraph">
<p>You can replace the CA certificates for the cluster CA or clients CA with your own.
For more information, see <a href="#installing-your-own-ca-certificates-str">Installing your own CA certificates and private keys</a>.
If you provide your own CA certificates, you must renew them before they expire.</p>
</div>
</div>
<div class="sect2">
<h3 id="certificates-and-secrets-str"><a class="link" href="#certificates-and-secrets-str">7.2. Secrets generated by the operators</a></h3>
<div class="paragraph _abstract">
<p>Secrets are created when custom resources are deployed, such as <code>Kafka</code> and <code>KafkaUser</code>.
Strimzi uses these secrets to store private and public key certificates for Kafka clusters, clients, and users.
The secrets are used for establishing TLS encrypted connections between Kafka brokers, and between brokers and clients.
They are also used for mTLS authentication.</p>
</div>
<div class="paragraph">
<p>Cluster and clients secrets are always pairs: one contains the public key and one contains the private key.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster secret</dt>
<dd>
<p>A cluster secret contains the <em>cluster CA</em> to sign Kafka broker certificates.
Connecting clients use the certificate to establish a TLS encrypted connection with a Kafka cluster. The certificate verifies broker identity.</p>
</dd>
<dt class="hdlist1">Client secret</dt>
<dd>
<p>A client secret contains the <em>clients CA</em> for a user to sign its own client certificate.
This allows mutual authentication against the Kafka cluster. The broker validates a client&#8217;s identity through the certificate.</p>
</dd>
<dt class="hdlist1">User secret</dt>
<dd>
<p>A user secret contains a private key and certificate. The secret is created and signed by the clients CA when a new user is created. The key and certificate are used to authenticate and authorize the user when accessing the cluster.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="certificates-and-secrets-formats-str"><a class="link" href="#certificates-and-secrets-formats-str">7.2.1. TLS authentication using keys and certificates in PEM or PKCS #12 format</a></h4>
<div class="paragraph">
<p>The secrets created by Strimzi provide private keys and certificates in PEM (Privacy Enhanced Mail) and PKCS #12 (Public-Key Cryptography Standards) formats.
PEM and PKCS #12 are OpenSSL-generated key formats for TLS communications using the SSL protocol.</p>
</div>
<div class="paragraph">
<p>You can configure mutual TLS (mTLS) authentication that uses the credentials contained in the secrets generated for a Kafka cluster and user.</p>
</div>
<div class="paragraph">
<p>To set up mTLS, you must first do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#con-securing-kafka-authentication-str">Configure your Kafka cluster with a listener that uses mTLS</a></p>
</li>
<li>
<p><a href="./deploying.html#con-securing-client-authentication-str">Create a <code>KafkaUser</code> that provides client credentials for mTLs</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you deploy a Kafka cluster, a <code>&lt;cluster_name&gt;-cluster-ca-cert</code> secret is created with public key to verify the cluster.
You use the public key to configure a truststore for the client.</p>
</div>
<div class="paragraph">
<p>When you create a <code>KafkaUser</code>, a <code>&lt;kafka_user_name&gt;</code> secret is created with the keys and certificates to verify the user (client).
Use these credentials to configure a keystore for the client.</p>
</div>
<div class="paragraph">
<p>With the Kafka cluster and client set up to use mTLS, you extract credentials from the secrets and add them to your client configuration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">PEM keys and certificates</dt>
<dd>
<p>For PEM, you add the following to your client configuration:</p>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Truststore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>ca.crt</code> from the <code>&lt;cluster_name&gt;-cluster-ca-cert</code> secret, which is the CA certificate for the cluster.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Keystore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>user.crt</code> from the <code>&lt;kafka_user_name&gt;</code> secret, which is the public certificate of the user.</p>
</li>
<li>
<p><code>user.key</code> from the <code>&lt;kafka_user_name&gt;</code> secret, which is the private key of the user.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">PKCS #12 keys and certificates</dt>
<dd>
<p>For PKCS #12, you add the following to your client configuration:</p>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Truststore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>ca.p12</code> from the <code>&lt;cluster_name&gt;-cluster-ca-cert</code> secret, which is the CA certificate for the cluster.</p>
</li>
<li>
<p><code>ca.password</code> from the <code>&lt;cluster_name&gt;-cluster-ca-cert</code> secret, which is the password to access the public cluster CA certificate.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Keystore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>user.p12</code> from the <code>&lt;kafka_user_name&gt;</code> secret, which is the public key certificate of the user.</p>
</li>
<li>
<p><code>user.password</code> from the <code>&lt;kafka_user_name&gt;</code> secret, which is the password to access the public key certificate of the Kafka user.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>PKCS #12 is supported by Java, so you can add the values of the certificates directly to your Java client configuration.
You can also reference the certificates from a secure storage location.
With PEM files, you must add the certificates directly to the client configuration in single-line format.
Choose a format that&#8217;s suitable for establishing TLS connections between your Kafka cluster and client.
Use PKCS #12 if you are unfamiliar with PEM.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All keys are 2048 bits in size and, by default, are valid for 365 days from the initial generation.
You can <a href="#con-certificate-renewal-str">change the validity period</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-certificates-str"><a class="link" href="#con-certificates-str">7.2.2. Secrets generated by the Cluster Operator</a></h4>
<div class="paragraph">
<p>The Cluster Operator generates the following certificates, which are saved as secrets in the Kubernetes cluster.
Strimzi uses these secrets by default.</p>
</div>
<div class="paragraph">
<p>The cluster CA and clients CA have separate secrets for the private key and public key.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-cluster-ca</code></dt>
<dd>
<p>Contains the private key of the cluster CA. Strimzi and Kafka components use the private key to sign server certificates.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code></dt>
<dd>
<p>Contains the public key of the cluster CA. Kafka clients use the public key to verify the identity of the Kafka brokers they are connecting to with TLS server authentication.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-clients-ca</code></dt>
<dd>
<p>Contains the private key of the clients CA. Kafka clients use the private key to sign new user certificates for mTLS authentication when connecting to Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-clients-ca-cert</code></dt>
<dd>
<p>Contains the public key of the clients CA. Kafka brokers use the public key to verify the identity of clients accessing the Kafka brokers when mTLS authentication is used.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Secrets for communication between Strimzi components contain a private key and a public key certificate signed by the cluster CA.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-kafka-brokers</code></dt>
<dd>
<p>Contains the private and public keys for Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-zookeeper-nodes</code></dt>
<dd>
<p>Contains the private and public keys for ZooKeeper nodes.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-cluster-operator-certs</code></dt>
<dd>
<p>Contains the private and public keys for encrypting communication between the Cluster Operator and Kafka or ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-entity-topic-operator-certs</code></dt>
<dd>
<p>Contains the private and public keys for encrypting communication between the Topic Operator and Kafka or ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-entity-user-operator-certs</code></dt>
<dd>
<p>Contains the private and public keys for encrypting communication between the User Operator and Kafka or ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-cruise-control-certs</code></dt>
<dd>
<p>Contains the private and public keys for encrypting communication between Cruise Control and Kafka or ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>&lt;cluster_name&gt;</em>-kafka-exporter-certs</code></dt>
<dd>
<p>Contains the private and public keys for encrypting communication between Kafka Exporter and Kafka or ZooKeeper.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can <a href="./deploying.html#proc-installing-certs-per-listener-str">provide your own server certificates and private keys</a> to connect to Kafka brokers using <em>Kafka listener certificates</em> rather than certificates signed by the cluster CA.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cluster_ca_secrets"><a class="link" href="#cluster_ca_secrets">7.2.3. Cluster CA secrets</a></h4>
<div class="paragraph">
<p>Cluster CA secrets are managed by the Cluster Operator in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Only the <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> secret is required by clients.
All other cluster secrets are accessed by Strimzi components.
You can enforce this using Kubernetes role-based access controls, if necessary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The CA certificates in <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> must be trusted by Kafka client applications so that they validate the Kafka broker certificates when connecting to Kafka brokers over TLS.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 14. Fields in the <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code> secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the cluster CA.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 15. Fields in the <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the cluster CA.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 16. Fields in the <code><em>&lt;cluster_name&gt;</em>-kafka-brokers</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-kafka-<em>&lt;num&gt;</em>.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-kafka-<em>&lt;num&gt;</em>.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-kafka-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for a Kafka broker pod <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-kafka-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for a Kafka broker pod <code><em>&lt;num&gt;</em></code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 17. Fields in the <code><em>&lt;cluster_name&gt;</em>-zookeeper-nodes</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the  PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for ZooKeeper node <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster_name&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for ZooKeeper pod <code><em>&lt;num&gt;</em></code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 18. Fields in the <code><em>&lt;cluster_name&gt;</em>-cluster-operator-certs</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-operator.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-operator.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-operator.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for mTLS communication between the Cluster Operator and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster-operator.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for mTLS communication between the Cluster Operator and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 19. Fields in the <code><em>&lt;cluster_name&gt;</em>-entity-topic-operator-certs</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for mTLS communication between the Topic Operator and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for mTLS communication between the Topic Operator and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 20. Fields in the <code><em>&lt;cluster_name&gt;</em>-entity-user-operator-certs</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for mTLS communication between the User Operator and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for mTLS communication between the User Operator and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 21. Fields in the <code><em>&lt;cluster_name&gt;</em>-cruise-control-certs</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cruise-control.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cruise-control.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cruise-control.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for mTLS communication between Cruise Control and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cruise-control.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for mTLS communication between the Cruise Control and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 22. Fields in the <code><em>&lt;cluster_name&gt;</em>-kafka-exporter-certs</code> secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka-exporter.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka-exporter.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka-exporter.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for mTLS communication between Kafka Exporter and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster_name&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kafka-exporter.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for mTLS communication between the Kafka Exporter and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="clients_ca_secrets"><a class="link" href="#clients_ca_secrets">7.2.4. Clients CA secrets</a></h4>
<div class="paragraph">
<p>Clients CA secrets are managed by the Cluster Operator in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The certificates in <code><em>&lt;cluster_name&gt;</em>-clients-ca-cert</code> are those which the Kafka brokers trust.</p>
</div>
<div class="paragraph">
<p>The <code><em>&lt;cluster_name&gt;</em>-clients-ca</code> secret is used to sign the certificates of client applications.
This secret must be accessible to the Strimzi components and for administrative access if you are intending to issue application certificates without using the User Operator.
You can enforce this using Kubernetes role-based access controls, if necessary.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 23. Fields in the <code><em>&lt;cluster_name&gt;</em>-clients-ca</code> secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the clients CA.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 24. Fields in the <code><em>&lt;cluster_name&gt;</em>-clients-ca-cert</code> secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the clients CA.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="user_secrets_generated_by_the_user_operator"><a class="link" href="#user_secrets_generated_by_the_user_operator">7.2.5. User secrets generated by the User Operator</a></h4>
<div class="paragraph">
<p>User secrets are managed by the User Operator.</p>
</div>
<div class="paragraph">
<p>When a user is created using the User Operator, a secret is generated using the name of the user.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Fields in the <code><em>user_name</em></code> secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Secret name</th>
<th class="tableblock halign-left valign-top">Field within secret</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code><em>&lt;user_name&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 store for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for the user, signed by the clients CA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for the user</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="adding_labels_and_annotations_to_cluster_ca_secrets"><a class="link" href="#adding_labels_and_annotations_to_cluster_ca_secrets">7.2.6. Adding labels and annotations to cluster CA secrets</a></h4>
<div class="paragraph">
<p>By configuring the <code>clusterCaCert</code> template property in the <code>Kafka</code> custom resource, you can add custom labels and annotations to the Cluster CA secrets created by the Cluster Operator.
Labels and annotations are useful for identifying objects and adding contextual information.
You configure template properties in Strimzi custom resources.</p>
</div>
<div class="listingblock">
<div class="title">Example template customization to add labels and annotations to secrets</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    template:
      clusterCaCert:
        metadata:
          labels:
            label1: value1
            label2: value2
          annotations:
            annotation1: value1
            annotation2: value2
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on configuring template properties, see <a href="#assembly-customizing-kubernetes-resources-str">Customizing Kubernetes resources</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="disabling_ownerreference_in_the_ca_secrets"><a class="link" href="#disabling_ownerreference_in_the_ca_secrets">7.2.7. Disabling <code>ownerReference</code> in the CA secrets</a></h4>
<div class="paragraph">
<p>By default, the cluster and clients CA secrets are created with an <code>ownerReference</code> property that is set to the <code>Kafka</code> custom resource.
This means that, when the <code>Kafka</code> custom resource is deleted, the CA secrets are also deleted (garbage collected) by Kubernetes.</p>
</div>
<div class="paragraph">
<p>If you want to reuse the CA for a new cluster, you can disable the <code>ownerReference</code> by setting the <code>generateSecretOwnerReference</code> property for the cluster and clients CA secrets to <code>false</code> in the <code>Kafka</code> configuration.
When the <code>ownerReference</code> is disabled, CA secrets are not deleted by Kubernetes when the corresponding <code>Kafka</code> custom resource is deleted.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka configuration with disabled <code>ownerReference</code> for cluster and clients CAs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
# ...
spec:
# ...
  clusterCa:
    generateSecretOwnerReference: false
  clientsCa:
    generateSecretOwnerReference: false
# ...</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-certificate-renewal-str"><a class="link" href="#con-certificate-renewal-str">7.3. Certificate renewal and validity periods</a></h3>
<div class="paragraph _abstract">
<p>Cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.
This is usually defined as a number of days since the certificate was generated.</p>
</div>
<div class="paragraph">
<p>For CA certificates automatically created by the Cluster Operator, you can configure the validity period of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster CA certificates in <code>Kafka.spec.clusterCa.validityDays</code></p>
</li>
<li>
<p>Clients CA certificates in <code>Kafka.spec.clientsCa.validityDays</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default validity period for both certificates is 365 days.
Manually-installed CA certificates should have their own validity periods defined.</p>
</div>
<div class="paragraph">
<p>When a CA certificate expires, components and clients that still trust that certificate will not accept connections from peers whose certificates were signed by the CA private key.
The components and clients need to trust the <em>new</em> CA certificate instead.</p>
</div>
<div class="paragraph">
<p>To allow the renewal of CA certificates without a loss of service, the Cluster Operator initiates certificate renewal before the old CA certificates expire.</p>
</div>
<div class="paragraph">
<p>You can configure the renewal period of the certificates created by the Cluster Operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster CA certificates in <code>Kafka.spec.clusterCa.renewalDays</code></p>
</li>
<li>
<p>Clients CA certificates in <code>Kafka.spec.clientsCa.renewalDays</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default renewal period for both certificates is 30 days.</p>
</div>
<div class="paragraph">
<p>The renewal period is measured backwards, from the expiry date of the current certificate.</p>
</div>
<div class="listingblock">
<div class="title">Validity period against renewal period</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Not Before                                     Not After
    |                                              |
    |&lt;--------------- validityDays ---------------&gt;|
                              &lt;--- renewalDays ---&gt;|</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a change to the validity and renewal periods after creating the Kafka cluster, you configure and apply the <code>Kafka</code> custom resource,
and <a href="#proc-renewing-ca-certs-manually-str">manually renew the CA certificates</a>.
If you do not manually renew the certificates, the new periods will be used the next time the certificate is renewed automatically.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka configuration for certificate validity and renewal periods</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
# ...
spec:
# ...
  clusterCa:
    renewalDays: 30
    validityDays: 365
    generateCertificateAuthority: true
  clientsCa:
    renewalDays: 30
    validityDays: 365
    generateCertificateAuthority: true
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the Cluster Operator during the renewal period depends on the settings for the <code>generateCertificateAuthority</code> certificate generation properties for the cluster CA and clients CA.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>true</code></dt>
<dd>
<p>If the properties are set to <code>true</code>, a CA certificate is generated automatically by the Cluster Operator, and renewed automatically within the renewal period.</p>
</dd>
<dt class="hdlist1"><code>false</code></dt>
<dd>
<p>If the properties are set to <code>false</code>, a CA certificate is not generated by the Cluster Operator. Use this option if you are <a href="#installing-your-own-ca-certificates-str">installing your own certificates</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="renewal_process_with_automatically_generated_ca_certificates"><a class="link" href="#renewal_process_with_automatically_generated_ca_certificates">7.3.1. Renewal process with automatically generated CA certificates</a></h4>
<div class="paragraph">
<p>The Cluster Operator performs the following processes in this order when renewing CA certificates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generates a new CA certificate, but retains the existing key.</p>
<div class="paragraph">
<p>The new certificate replaces the old one with the name <code>ca.crt</code> within the corresponding <code>Secret</code>.</p>
</div>
</li>
<li>
<p>Generates new client certificates (for ZooKeeper nodes, Kafka brokers, and the Entity Operator).</p>
<div class="paragraph">
<p>This is not strictly necessary because the signing key has not changed, but it keeps the validity period of the client certificate in sync with the CA certificate.</p>
</div>
</li>
<li>
<p>Restarts ZooKeeper nodes so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restarts Kafka brokers so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restarts the Topic and User Operators so that they will trust the new CA certificate and use the new client certificates.</p>
<div class="paragraph">
<p>User certificates are signed by the clients CA.
User certificates generated by the User Operator are renewed when the clients CA is renewed.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="client_certificate_renewal"><a class="link" href="#client_certificate_renewal">7.3.2. Client certificate renewal</a></h4>
<div class="paragraph">
<p>The Cluster Operator is not aware of the client applications using the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>When connecting to the cluster, and to ensure they operate correctly, client applications must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trust the cluster CA certificate published in the <em>&lt;cluster&gt;</em>-cluster-ca-cert Secret.</p>
</li>
<li>
<p>Use the credentials published in their <em>&lt;user-name&gt;</em> Secret to connect to the cluster.</p>
<div class="paragraph">
<p>The User Secret provides credentials in PEM and PKCS #12 format, or it can provide a password when using SCRAM-SHA authentication.
The User Operator creates the user credentials when a user is created.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You must ensure clients continue to work after certificate renewal.
The renewal process depends on how the clients are configured.</p>
</div>
<div class="paragraph">
<p>If you are provisioning client certificates and keys manually, you must generate new client certificates and ensure the new certificates are used by clients within the renewal period.
Failure to do this by the end of the renewal period could result in client applications being unable to connect to the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For workloads running inside the same Kubernetes cluster and namespace, Secrets can be mounted as a volume so the client Pods construct their keystores and truststores from the current state of the Secrets.
For more details on this procedure, see <a href="#configuring-internal-clients-to-trust-cluster-ca-str">Configuring internal clients to trust the cluster CA</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-renewing-ca-certs-manually-str"><a class="link" href="#proc-renewing-ca-certs-manually-str">7.3.3. Manually renewing the CA certificates generated by the Cluster Operator</a></h4>
<div class="paragraph">
<p>Cluster and clients CA certificates generated by the Cluster Operator auto-renew at the start of their respective certificate renewal periods.
However, you can use the <code>strimzi.io/force-renew</code> annotation to manually renew one or both of these certificates before the certificate renewal period starts.
You might do this for security reasons, or if you have <a href="#con-certificate-renewal-str">changed the renewal or validity periods for the certificates</a>.</p>
</div>
<div class="paragraph">
<p>A renewed certificate uses the same private key as the old certificate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using your own CA certificates, the <code>force-renew</code> annotation cannot be used.
Instead, follow the procedure for <a href="#renewing-your-own-ca-certificates-str">renewing your own CA certificates</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>strimzi.io/force-renew</code> annotation to the <code>Secret</code> that contains the CA certificate that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 26. Annotation for the Secret that forces renewal of certificates</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will generate a new CA certificate for the <code>Secret</code> that you annotated.
If maintenance time windows are configured, the Cluster Operator will generate the new CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
</li>
<li>
<p>Check the period the CA certificate is valid:</p>
<div class="paragraph">
<p>For example, using an <code>openssl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>CA-CERTIFICATE-SECRET</em> -o 'jsonpath={.data.<em>CA-CERTIFICATE</em>}' | base64 -d | openssl x509 -subject -issuer -startdate -enddate -noout</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE</em> is the name of the CA certificate, such as <code>jsonpath={.data.ca\.crt}</code>.</p>
</div>
<div class="paragraph">
<p>The command returns a <code>notBefore</code> and <code>notAfter</code> date, which is the validity period for the CA certificate.</p>
</div>
<div class="paragraph">
<p>For example, for a cluster CA certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">subject=O = io.strimzi, CN = cluster-ca v0
issuer=O = io.strimzi, CN = cluster-ca v0
notBefore=Jun 30 09:43:54 2020 GMT
notAfter=Jun 30 09:43:54 2021 GMT</code></pre>
</div>
</div>
</li>
<li>
<p>Delete old certificates from the Secret.</p>
<div class="paragraph">
<p>When components are using the new certificates, older certificates might still be active.
Delete the old certificates to remove any potential security risk.</p>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets generated by the operators</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-str">Maintenance time windows for rolling updates</a></p>
</li>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-replacing-private-keys-str"><a class="link" href="#proc-replacing-private-keys-str">7.3.4. Replacing private keys used by the CA certificates generated by the Cluster Operator</a></h4>
<div class="paragraph">
<p>You can replace the private keys used by the cluster CA and clients CA certificates generated by the Cluster Operator.
When a private key is replaced, the Cluster Operator generates a new CA certificate for the new private key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using your own CA certificates, the <code>force-replace</code> annotation cannot be used.
Instead, follow the procedure for <a href="#renewing-your-own-ca-certificates-str">renewing your own CA certificates</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-replace</code> annotation to the <code>Secret</code> that contains the private key that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 27. Commands for replacing private keys</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Private key for</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CLUSTER-NAME</em>-cluster-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>CLUSTER-NAME</em>-cluster-ca strimzi.io/force-replace=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CLUSTER-NAME</em>-clients-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>CLUSTER-NAME</em>-clients-ca strimzi.io/force-replace=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new private key for the <code>Secret</code> that you annotated</p>
</li>
<li>
<p>Generate a new CA certificate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will generate the new private key and CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets generated by the operators</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-str">Maintenance time windows for rolling updates</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tls-connections-str"><a class="link" href="#tls-connections-str">7.4. TLS connections</a></h3>
<div class="sect3">
<h4 id="zookeeper_communication"><a class="link" href="#zookeeper_communication">7.4.1. ZooKeeper communication</a></h4>
<div class="paragraph">
<p>Communication between the ZooKeeper nodes on all ports, as well as between clients and ZooKeeper, is encrypted using TLS.</p>
</div>
<div class="paragraph">
<p>Communication between Kafka brokers and ZooKeeper nodes is also encrypted.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_inter_broker_communication"><a class="link" href="#kafka_inter_broker_communication">7.4.2. Kafka inter-broker communication</a></h4>
<div class="paragraph">
<p>Communication between Kafka brokers is always encrypted using TLS.
The connections between the Kafka controller and brokers use an internal <em>control plane listener</em> on port 9090.
Replication of data between brokers, as well as internal connections from Strimzi operators, Cruise Control, or the Kafka Exporter use the <em>replication listener</em> on port 9091.
These internal listeners are not available to Kafka clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="topic_and_user_operators"><a class="link" href="#topic_and_user_operators">7.4.3. Topic and User Operators</a></h4>
<div class="paragraph">
<p>All Operators use encryption for communication with both Kafka and ZooKeeper.
In Topic and User Operators, a TLS sidecar is used when communicating with ZooKeeper.</p>
</div>
</div>
<div class="sect3">
<h4 id="cruise_control"><a class="link" href="#cruise_control">7.4.4. Cruise Control</a></h4>
<div class="paragraph">
<p>Cruise Control uses encryption for communication with both Kafka and ZooKeeper.
A TLS sidecar is used when communicating with ZooKeeper.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_client_connections"><a class="link" href="#kafka_client_connections">7.4.5. Kafka Client connections</a></h4>
<div class="paragraph">
<p>Encrypted or unencrypted communication between Kafka brokers and clients is configured using the <code>tls</code> property for <code>spec.kafka.listeners</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-internal-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-internal-clients-to-trust-cluster-ca-str">7.5. Configuring internal clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides inside the Kubernetes cluster  connecting to a TLS listener  to trust the cluster CA certificate.</p>
</div>
<div class="paragraph">
<p>The easiest way to achieve this for an internal client is to use a volume mount to access the <code>Secrets</code> containing the necessary certificates and keys.</p>
</div>
<div class="paragraph">
<p>Follow the steps to configure trust certificates that are signed by the cluster CA for Java-based Kafka Producer, Consumer, and Streams APIs.</p>
</div>
<div class="paragraph">
<p>Choose the steps to follow according to the certificate format of the cluster CA: PKCS #12 (<code>.p12</code>) or PEM (<code>.crt</code>).</p>
</div>
<div class="paragraph">
<p>The steps describe how to mount the Cluster Secret that verifies the identity of the Kafka cluster to the client pod.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator must be running.</p>
</li>
<li>
<p>There needs to be a <code>Kafka</code> resource within the Kubernetes cluster.</p>
</li>
<li>
<p>You need a Kafka client application inside the Kubernetes cluster that will connect using TLS, and needs to trust the cluster CA certificate.</p>
</li>
<li>
<p>The client application must be running in the same namespace as the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Using PKCS #12 format (.p12)</div>
<ol class="arabic">
<li>
<p>Mount the cluster Secret as a volume when defining the client pod.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kind: Pod
apiVersion: v1
metadata:
  name: client-pod
spec:
  containers:
  - name: client-name
    image: client-name
    volumeMounts:
    - name: secret-volume
      mountPath: /data/p12
    env:
    - name: SECRET_PASSWORD
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: my-password
  volumes:
  - name: secret-volume
    secret:
      secretName: my-cluster-cluster-ca-cert</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;re mounting the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PKCS #12 file into an exact path, which can be configured</p>
</li>
<li>
<p>The password into an environment variable, where it can be used for Java configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the Kafka client with the following properties:</p>
<div class="ulist">
<ul>
<li>
<p>A security protocol option:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS for encryption (with or without mTLS authentication).</p>
</li>
<li>
<p><code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ssl.truststore.location</code> with the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code> with the password for accessing the truststore.</p>
</li>
<li>
<p><code>ssl.truststore.type=PKCS12</code> to identify the truststore type.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Using PEM format (.crt)</div>
<ol class="arabic">
<li>
<p>Mount the cluster Secret as a volume when defining the client pod.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kind: Pod
apiVersion: v1
metadata:
  name: client-pod
spec:
  containers:
  - name: client-name
    image: client-name
    volumeMounts:
    - name: secret-volume
      mountPath: /data/crt
  volumes:
  - name: secret-volume
    secret:
      secretName: my-cluster-cluster-ca-cert</code></pre>
</div>
</div>
</li>
<li>
<p>Use the extracted certificate to configure a TLS connection in clients that use certificates in X.509 format.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-external-clients-to-trust-cluster-ca-str">7.6. Configuring external clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides outside the Kubernetes cluster  connecting to an <code>external</code> listener  to trust the cluster CA certificate.
Follow this procedure when setting up the client and during the renewal period, when the old clients CA certificate is replaced.</p>
</div>
<div class="paragraph">
<p>Follow the steps to configure trust certificates that are signed by the cluster CA for Java-based Kafka Producer, Consumer, and Streams APIs.</p>
</div>
<div class="paragraph">
<p>Choose the steps to follow according to the certificate format of the cluster CA: PKCS #12 (<code>.p12</code>) or PEM (<code>.crt</code>).</p>
</div>
<div class="paragraph">
<p>The steps describe how to obtain the certificate from the Cluster Secret that verifies the identity of the Kafka cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> secret contains more than one CA certificate during the CA certificate renewal period.
Clients must add <em>all</em> of them to their truststores.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator must be running.</p>
</li>
<li>
<p>There needs to be a <code>Kafka</code> resource within the Kubernetes cluster.</p>
</li>
<li>
<p>You need a Kafka client application outside the Kubernetes cluster that will connect using TLS, and needs to trust the cluster CA certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Using PKCS #12 format (.p12)</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate and password from the <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> Secret of the Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;cluster_name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.p12}' | base64 -d &gt; ca.p12</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;cluster_name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.password}' | base64 -d &gt; ca.password</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;cluster_name&gt;</em> with the name of the Kafka cluster.</p>
</div>
</li>
<li>
<p>Configure the Kafka client with the following properties:</p>
<div class="ulist">
<ul>
<li>
<p>A security protocol option:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS.</p>
</li>
<li>
<p><code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ssl.truststore.location</code> with the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code> with the password for accessing the truststore. This property can be omitted if it is not needed by the truststore.</p>
</li>
<li>
<p><code>ssl.truststore.type=PKCS12</code> to identify the truststore type.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Using PEM format (.crt)</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate from the <code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code> secret of the Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get secret <em>&lt;cluster_name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Use the extracted certificate to configure a TLS connection in clients that use certificates in X.509 format.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="security-using-your-own-certificates-str"><a class="link" href="#security-using-your-own-certificates-str">7.7. Using your own CA certificates and private keys</a></h3>
<div class="paragraph _abstract">
<p>Install and use your own CA certificates and private keys instead of using the defaults generated by the Cluster Operator.
You can replace the cluster and clients CA certificates and private keys.</p>
</div>
<div class="paragraph">
<p>You can switch to using your own CA certificates and private keys in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install your own CA certificates and private keys before deploying your Kafka cluster</p>
</li>
<li>
<p>Replace the default CA certificates and private keys with your own after deploying a Kafka cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The steps to replace the default CA certificates and private keys after deploying a Kafka cluster are the same as those used to renew your own CA certificates and private keys.</p>
</div>
<div class="paragraph">
<p>If you use your own certificates, they won&#8217;t be renewed automatically.
You need to renew the CA certificates and private keys before they expire.</p>
</div>
<div class="paragraph">
<p>Renewal options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Renew the CA certificates only</p>
</li>
<li>
<p>Renew CA certificates and private keys (or replace the defaults)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="installing-your-own-ca-certificates-str"><a class="link" href="#installing-your-own-ca-certificates-str">7.7.1. Installing your own CA certificates and private keys</a></h4>
<div class="paragraph _abstract">
<p>Install your own CA certificates and private keys instead of using the cluster and clients CA certificates and private keys generated by the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>By default, Strimzi uses the following <a href="#con-certificates-str">cluster CA and clients CA secrets</a>, which are renewed automatically.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster CA secrets</p>
<div class="ulist">
<ul>
<li>
<p><code><em>&lt;cluster_name&gt;</em>-cluster-ca</code></p>
</li>
<li>
<p><code><em>&lt;cluster_name&gt;</em>-cluster-ca-cert</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Clients CA secrets</p>
<div class="ulist">
<ul>
<li>
<p><code><em>&lt;cluster_name&gt;</em>-clients-ca</code></p>
</li>
<li>
<p><code><em>&lt;cluster_name&gt;</em>-clients-ca-cert</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To install your own certificates, use the same names.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster is not yet deployed.</p>
<div class="paragraph">
<p>If you have already deployed a Kafka cluster, you can <a href="#proc-replacing-your-own-private-keys-str">replace the default CA certificates with your own</a>.</p>
</div>
</li>
<li>
<p>Your own X.509 certificates and keys in PEM format for the cluster CA or clients CA.</p>
<div class="ulist">
<ul>
<li>
<p>If you want to use a cluster or clients CA which is not a Root CA, you have to include the whole chain in the certificate file.
The chain should be in the following order:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The cluster or clients CA</p>
</li>
<li>
<p>One or more intermediate CAs</p>
</li>
<li>
<p>The root CA</p>
</li>
</ol>
</div>
</li>
<li>
<p>All CAs in the chain should be configured using the X509v3 Basic Constraints extension. Basic Constraints limit the path length of a certificate chain.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The OpenSSL TLS management tool for converting certificates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Before you begin</div>
<p>The Cluster Operator generates keys and certificates in PEM (Privacy Enhanced Mail) and PKCS #12 (Public-Key Cryptography Standards) formats.
You can add your own certificates in either format.</p>
</div>
<div class="paragraph">
<p>Some applications cannot use PEM certificates and support only PKCS #12 certificates.
If you don&#8217;t have a cluster certificate in PKCS #12 format, use the OpenSSL TLS management tool to generate one from your <code>ca.crt</code> file.</p>
</div>
<div class="listingblock">
<div class="title">Example certificate generation command</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">openssl pkcs12 -export -in ca.crt -nokeys -out ca.p12 -password pass:<em>&lt;P12_password&gt;</em> -caname ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;P12_password&gt;</em> with your own password.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new secret that contains the CA certificate.</p>
<div class="listingblock">
<div class="title">Client secret creation with a certificate in PEM format only</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>&lt;cluster_name&gt;</em>-clients-ca-cert --from-file=ca.crt=ca.crt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Cluster secret creation with certificates in PEM and PKCS #12 format</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>&lt;cluster_name&gt;</em>-cluster-ca-cert \
  --from-file=ca.crt=ca.crt \
  --from-file=ca.p12=ca.p12 \
  --from-literal=ca.password=<em>P12-PASSWORD</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>&lt;cluster_name&gt;</em> with the name of your Kafka cluster.</p>
</div>
</li>
<li>
<p>Create a new secret that contains the private key.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>CA-KEY-SECRET</em> --from-file=ca.key=ca.key</code></pre>
</div>
</div>
</li>
<li>
<p>Label the secrets.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl label secret <em>CA-CERTIFICATE-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>&lt;cluster_name&gt;</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl label secret <em>CA-KEY-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>&lt;cluster_name&gt;</em></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Label <code>strimzi.io/kind=Kafka</code> identifies the Kafka custom resource.</p>
</li>
<li>
<p>Label <code>strimzi.io/cluster=<em>&lt;cluster_name&gt;</em></code> identifies the Kafka cluster.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Annotate the secrets</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate secret <em>CA-CERTIFICATE-SECRET</em> strimzi.io/ca-cert-generation=<em>CA-CERTIFICATE-GENERATION</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate secret <em>CA-KEY-SECRET</em> strimzi.io/ca-key-generation=<em>CA-KEY-GENERATION</em></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotation <code>strimzi.io/ca-cert-generation=<em>CA-CERTIFICATE-GENERATION</em></code> defines the generation of a new CA certificate.</p>
</li>
<li>
<p>Annotation <code>strimzi.io/ca-key-generation=<em>CA-KEY-GENERATION</em></code> defines the generation of a new CA key.</p>
<div class="paragraph">
<p>Start from 0 (zero) as the incremental value (<code>strimzi.io/ca-cert-generation=0</code>) for your own CA certificate. Set a higher incremental value when you renew the certificates.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create the <code>Kafka</code> resource for your cluster, configuring either the <code>Kafka.spec.clusterCa</code> or the <code>Kafka.spec.clientsCa</code> object to <em>not</em> use generated CAs.</p>
<div class="listingblock">
<div class="title">Example fragment <code>Kafka</code> resource configuring the cluster CA to use certificates you supply for yourself</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Kafka
version: kafka.strimzi.io/v1beta2
spec:
  # ...
  clusterCa:
    generateCertificateAuthority: false</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#renewing-your-own-ca-certificates-str">Renewing your own CA certificates</a>.</p>
</li>
<li>
<p><a href="#proc-replacing-your-own-private-keys-str">Renewing or replacing CA certificates and private keys with your own</a>.</p>
</li>
<li>
<p><a href="./deploying.html#proc-installing-certs-per-listener-str" target="_blank" rel="noopener">Providing your own Kafka listener certificates for TLS encryption</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="renewing-your-own-ca-certificates-str"><a class="link" href="#renewing-your-own-ca-certificates-str">7.7.2. Renewing your own CA certificates</a></h4>
<div class="paragraph _abstract">
<p>If you are using your own CA certificates, you need to renew them manually.
The Cluster Operator will not renew them automatically.
Renew the CA certificates in the renewal period before they expire.</p>
</div>
<div class="paragraph">
<p>Perform the steps in this procedure when you are renewing CA certificates and continuing with the same private key.
If you are renewing your own CA certificates <em>and</em> private keys, see <a href="#proc-replacing-your-own-private-keys-str">Renewing or replacing CA certificates and private keys with your own</a>.</p>
</div>
<div class="paragraph">
<p>The procedure describes the renewal of CA certificates in PEM format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>You have new cluster or clients X.509 certificates in PEM format.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the <code>Secret</code> for the CA certificate.</p>
<div class="paragraph">
<p>Edit the existing secret to add the new CA certificate and update the certificate generation annotation value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit secret <em>&lt;ca_certificate_secret_name&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>&lt;ca_certificate_secret_name&gt;</em> is the name of the <code>Secret</code>, which is <code><em>&lt;kafka_cluster_name&gt;</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>&lt;kafka_cluster_name&gt;</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p>The following example shows a secret for a cluster CA certificate that&#8217;s associated with a Kafka cluster named <code>my-cluster</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example secret configuration for a cluster CA certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0F... <b class="conum">(1)</b>
metadata:
  annotations:
    strimzi.io/ca-cert-generation: "0" <b class="conum">(2)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca-cert
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Current base64-encoded CA certificate</p>
</li>
<li>
<p>Current CA certificate generation annotation value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Encode your new CA certificate into base64.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat <em>&lt;path_to_new_certificate&gt;</em> | base64</code></pre>
</div>
</div>
</li>
<li>
<p>Update the CA certificate.</p>
<div class="paragraph">
<p>Copy the base64-encoded CA certificate from the previous step as the value for the <code>ca.crt</code> property under <code>data</code>.</p>
</div>
</li>
<li>
<p>Increase the value of the CA certificate generation annotation.</p>
<div class="paragraph">
<p>Update the <code>strimzi.io/ca-cert-generation</code> annotation with a higher incremental value.
For example, change <code>strimzi.io/ca-cert-generation=0</code> to <code>strimzi.io/ca-cert-generation=1</code>.
If the <code>Secret</code> is missing the annotation, the value is treated as <code>0</code>, so add the annotation with a value of <code>1</code>.</p>
</div>
<div class="paragraph">
<p>When Strimzi generates certificates, the certificate generation annotation is automatically incremented by the Cluster Operator.
For your own CA certificates, set the annotations with a higher incremental value.
The annotation needs a higher value than the one from the current secret so that the Cluster Operator can roll the pods and update the certificates.
The <code>strimzi.io/ca-cert-generation</code> has to be incremented on each CA certificate renewal.</p>
</div>
</li>
<li>
<p>Save the secret with the new CA certificate and certificate generation annotation value.</p>
<div class="listingblock">
<div class="title">Example secret configuration updated with a new CA certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.crt: GCa6LS3RTHeKFiFDGBOUDYFAZ0F... <b class="conum">(1)</b>
metadata:
  annotations:
    strimzi.io/ca-cert-generation: "1" <b class="conum">(2)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca-cert
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>New base64-encoded CA certificate</p>
</li>
<li>
<p>New CA certificate generation annotation value</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the next reconciliation, the Cluster Operator performs a rolling update of ZooKeeper, Kafka, and other components to trust the new CA certificate.</p>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will roll the pods at the first reconciliation within the next maintenance time window.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-replacing-your-own-private-keys-str"><a class="link" href="#proc-replacing-your-own-private-keys-str">7.7.3. Renewing or replacing CA certificates and private keys with your own</a></h4>
<div class="paragraph _abstract">
<p>If you are using your own CA certificates and private keys, you need to renew them manually.
The Cluster Operator will not renew them automatically.
Renew the CA certificates in the renewal period before they expire.
You can also use the same procedure to replace the CA certificates and private keys generated by the Strimzi operators with your own.</p>
</div>
<div class="paragraph">
<p>Perform the steps in this procedure when you are renewing or replacing CA certificates and private keys.
If you are only renewing your own CA certificates, see <a href="#renewing-your-own-ca-certificates-str">Renewing your own CA certificates</a>.</p>
</div>
<div class="paragraph">
<p>The procedure describes the renewal of CA certificates and private keys in PEM format.</p>
</div>
<div class="paragraph">
<p>Before going through the following steps, make sure that the CN (Common Name) of the new CA certificate is different from the current one.
For example, when the Cluster Operator renews certificates automatically it adds a <em>v&lt;version_number&gt;</em> suffix to identify a version.
Do the same with your own CA certificate by adding a different suffix on each renewal.
By using a different key to generate a new CA certificate, you retain the current CA certificate stored in the <code>Secret</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>You have new cluster or clients X.509 certificates and keys in PEM format.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Pause the reconciliation of the <code>Kafka</code> custom resource.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Annotate the custom resource in Kubernetes, setting the <code>pause-reconciliation</code> annotation to <code>true</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate Kafka <em>&lt;name_of_custom_resource&gt;</em> strimzi.io/pause-reconciliation="true"</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, for a <code>Kafka</code> custom resource named <code>my-cluster</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate Kafka my-cluster strimzi.io/pause-reconciliation="true"</code></pre>
</div>
</div>
</li>
<li>
<p>Check that the status conditions of the custom resource show a change to <code>ReconciliationPaused</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl describe Kafka <em>&lt;name_of_custom_resource&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> condition changes to <code>ReconciliationPaused</code> at the <code>lastTransitionTime</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update the <code>Secret</code> for the CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the existing secret to add the new CA certificate and update the certificate generation annotation value.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit secret <em>&lt;ca_certificate_secret_name&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>&lt;ca_certificate_secret_name&gt;</em> is the name of the <code>Secret</code>, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p>The following example shows a secret for a cluster CA certificate that&#8217;s associated with a Kafka cluster named <code>my-cluster</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example secret configuration for a cluster CA certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0F... <b class="conum">(1)</b>
metadata:
  annotations:
    strimzi.io/ca-cert-generation: "0" <b class="conum">(2)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca-cert
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Current base64-encoded CA certificate</p>
</li>
<li>
<p>Current CA certificate generation annotation value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Rename the current CA certificate to retain it.</p>
<div class="paragraph">
<p>Rename the current <code>ca.crt</code> property under <code>data</code> as <code>ca-<em>&lt;date&gt;</em>.crt</code>, where <em>&lt;date&gt;</em> is the certificate expiry date in the format <em>YEAR-MONTH-DAYTHOUR-MINUTE-SECONDZ</em>.
For example <code>ca-2022-01-26T17-32-00Z.crt:</code>.
Leave the value for the property as it is to retain the current CA certificate.</p>
</div>
</li>
<li>
<p>Encode your new CA certificate into base64.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat <em>&lt;path_to_new_certificate&gt;</em> | base64</code></pre>
</div>
</div>
</li>
<li>
<p>Update the CA certificate.</p>
<div class="paragraph">
<p>Create a new <code>ca.crt</code> property under <code>data</code> and copy the base64-encoded CA certificate from the previous step as the value for <code>ca.crt</code> property.</p>
</div>
</li>
<li>
<p>Increase the value of the CA certificate generation annotation.</p>
<div class="paragraph">
<p>Update the <code>strimzi.io/ca-cert-generation</code> annotation with a higher incremental value.
For example, change <code>strimzi.io/ca-cert-generation=0</code> to <code>strimzi.io/ca-cert-generation=1</code>.
If the <code>Secret</code> is missing the annotation, the value is treated as <code>0</code>, so add the annotation with a value of <code>1</code>.</p>
</div>
<div class="paragraph">
<p>When Strimzi generates certificates, the certificate generation annotation is automatically incremented by the Cluster Operator.
For your own CA certificates, set the annotations with a higher incremental value.
The annotation needs a higher value than the one from the current secret so that the Cluster Operator can roll the pods and update the certificates.
The <code>strimzi.io/ca-cert-generation</code> has to be incremented on each CA certificate renewal.</p>
</div>
</li>
<li>
<p>Save the secret with the new CA certificate and certificate generation annotation value.</p>
<div class="listingblock">
<div class="title">Example secret configuration updated with a new CA certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.crt: GCa6LS3RTHeKFiFDGBOUDYFAZ0F... <b class="conum">(1)</b>
  ca-2022-01-26T17-32-00Z.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0F... <b class="conum">(2)</b>
metadata:
  annotations:
    strimzi.io/ca-cert-generation: "1" <b class="conum">(3)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca-cert
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>New base64-encoded CA certificate</p>
</li>
<li>
<p>Old base64-encoded CA certificate</p>
</li>
<li>
<p>New CA certificate generation annotation value</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update the <code>Secret</code> for the CA key used to sign your new CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the existing secret to add the new CA key and update the key generation annotation value.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl edit secret <em>&lt;ca_key_name&gt;</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>&lt;ca_key_name&gt;</em> is the name of CA key, which is <code><em>&lt;kafka_cluster_name&gt;</em>-cluster-ca</code> for the cluster CA key and <code><em>&lt;kafka_cluster_name&gt;</em>-clients-ca</code> for the clients CA key.</p>
</div>
<div class="paragraph">
<p>The following example shows a secret for a cluster CA key that&#8217;s associated with a Kafka cluster named <code>my-cluster</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example secret configuration for a cluster CA key</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.key: SA1cKF1GFDzOIiPOIUQBHDNFGDFS... <b class="conum">(1)</b>
metadata:
  annotations:
    strimzi.io/ca-key-generation: "0" <b class="conum">(2)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Current base64-encoded CA key</p>
</li>
<li>
<p>Current CA key generation annotation value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Encode the CA key into base64.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">cat <em>&lt;path_to_new_key&gt;</em> | base64</code></pre>
</div>
</div>
</li>
<li>
<p>Update the CA key.</p>
<div class="paragraph">
<p>Copy the base64-encoded CA key from the previous step as the value for the <code>ca.key</code> property under <code>data</code>.</p>
</div>
</li>
<li>
<p>Increase the value of the CA key generation annotation.</p>
<div class="paragraph">
<p>Update the <code>strimzi.io/ca-key-generation</code> annotation with a higher incremental value.
For example, change <code>strimzi.io/ca-key-generation=0</code> to <code>strimzi.io/ca-key-generation=1</code>.
If the <code>Secret</code> is missing the annotation, it is treated as <code>0</code>, so add the annotation with a value of <code>1</code>.</p>
</div>
<div class="paragraph">
<p>When Strimzi generates certificates, the key generation annotation is automatically incremented by the Cluster Operator.
For your own CA certificates together with a new CA key, set the annotation with a higher incremental value.
The annotation needs a higher value than the one from the current secret so that the Cluster Operator can roll the pods and update the certificates and keys.
The <code>strimzi.io/ca-key-generation</code> has to be incremented on each CA certificate renewal.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save the secret with the new CA key and key generation annotation value.</p>
<div class="listingblock">
<div class="title">Example secret configuration updated with a new CA key</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
data:
  ca.key: AB0cKF1GFDzOIiPOIUQWERZJQ0F... <b class="conum">(1)</b>
metadata:
  annotations:
    strimzi.io/ca-key-generation: "1" <b class="conum">(2)</b>
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/kind: Kafka
  name: my-cluster-cluster-ca
  #...
type: Opaque</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>New base64-encoded CA key</p>
</li>
<li>
<p>New CA key generation annotation value</p>
</li>
</ol>
</div>
</li>
<li>
<p>Resume from the pause.</p>
<div class="paragraph">
<p>To resume the <code>Kafka</code> custom resource reconciliation, set the <code>pause-reconciliation</code> annotation to <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate --overwrite Kafka <em>&lt;name_of_custom_resource&gt;</em> strimzi.io/pause-reconciliation="false"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also do the same by removing the <code>pause-reconciliation</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl annotate Kafka <em>&lt;name_of_custom_resource&gt;</em> strimzi.io/pause-reconciliation-</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>On the next reconciliation, the Cluster Operator performs a rolling update of ZooKeeper, Kafka, and other components to trust the new CA certificate.
When the rolling update is complete, the Cluster Operator will start a new one to generate new server certificates signed by the new CA key.</p>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will roll the pods at the first reconciliation within the next maintenance time window.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api_reference-str"><a class="link" href="#api_reference-str">8. Custom resource API reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="con-common-configuration-properties-reference"><a class="link" href="#con-common-configuration-properties-reference">8.1. Common configuration properties</a></h3>
<div class="paragraph">
<p>Common configuration properties apply to more than one resource.</p>
</div>
<div class="sect3">
<h4 id="con-common-configuration-replicas-reference"><a class="link" href="#con-common-configuration-replicas-reference">8.1.1. <code>replicas</code></a></h4>
<div class="paragraph">
<p>Use the <code>replicas</code> property to configure replicas.</p>
</div>
<div class="paragraph">
<p>The type of replication depends on the resource.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KafkaTopic</code> uses a replication factor to configure the number of replicas of each partition within a Kafka cluster.</p>
</li>
<li>
<p>Kafka components use replicas to configure the number of pods in a deployment to provide better availability and scalability.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When running a Kafka component on Kubernetes it may not be necessary to run multiple replicas for high availability.
When the node where the component is deployed crashes, Kubernetes will automatically reschedule the Kafka component pod to a different node.
However, running Kafka components with multiple replicas can provide faster failover times as the other nodes will be up and running.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-bootstrap-reference"><a class="link" href="#con-common-configuration-bootstrap-reference">8.1.2. <code>bootstrapServers</code></a></h4>
<div class="paragraph">
<p>Use the <code>bootstrapServers</code> property to configure a list of bootstrap servers.</p>
</div>
<div class="paragraph">
<p>The bootstrap server lists can refer to Kafka clusters that are not deployed in the same Kubernetes cluster.
They can also refer to a Kafka cluster not deployed by Strimzi.</p>
</div>
<div class="paragraph">
<p>If on the same Kubernetes cluster, each list must ideally contain the Kafka cluster bootstrap service which is named <code><em>CLUSTER-NAME</em>-kafka-bootstrap</code> and a port number.
If deployed by Strimzi but on different Kubernetes clusters, the list content depends on the approach used for exposing the clusters (routes, ingress, nodeports or loadbalancers).</p>
</div>
<div class="paragraph">
<p>When using Kafka with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the given cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-ssl-reference"><a class="link" href="#con-common-configuration-ssl-reference">8.1.3. <code>ssl</code></a></h4>
<div class="paragraph">
<p>Use the three allowed <code>ssl</code> configuration options for client connection using a specific <em>cipher suite</em> for a TLS version.
A cipher suite combines algorithms for secure connection and data transfer.</p>
</div>
<div class="paragraph">
<p>You can also configure the <code>ssl.endpoint.identification.algorithm</code> property to enable or disable hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">Example SSL configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
spec:
  config:
    ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(1)</b>
    ssl.enabled.protocols: "TLSv1.2" <b class="conum">(2)</b>
    ssl.protocol: "TLSv1.2" <b class="conum">(3)</b>
    ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(4)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The cipher suite for TLS using a combination of <code>ECDHE</code> key exchange mechanism, <code>RSA</code> authentication algorithm,
<code>AES</code> bulk encyption algorithm and <code>SHA384</code> MAC algorithm.</p>
</li>
<li>
<p>The SSl protocol <code>TLSv1.2</code> is enabled.</p>
</li>
<li>
<p>Specifies the <code>TLSv1.2</code> protocol to generate the SSL context.
Allowed values are <code>TLSv1.1</code> and <code>TLSv1.2</code>.</p>
</li>
<li>
<p>Hostname verification is enabled by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-trusted-certificates-reference"><a class="link" href="#con-common-configuration-trusted-certificates-reference">8.1.4. <code>trustedCertificates</code></a></h4>
<div class="paragraph">
<p>Having set <code>tls</code> to configure TLS encryption, use the <code>trustedCertificates</code> property to provide a list of secrets with key names under which the certificates are stored in X.509 format.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the Cluster Operator for the Kafka cluster,
or you can create your own TLS certificate file, then create a <code>Secret</code> from the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>MY-SECRET</em> \
--from-file=<em>MY-TLS-CERTIFICATE-FILE.crt</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example TLS encryption configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tls:
  trustedCertificates:
    - secretName: my-cluster-cluster-cert
      certificate: ca.crt
    - secretName: my-cluster-cluster-cert
      certificate: ca2.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If certificates are stored in the same secret, it can be listed multiple times.</p>
</div>
<div class="paragraph">
<p>If you want to enable TLS encryption, but use the default set of public certification authorities shipped with Java,
you can specify <code>trustedCertificates</code> as an empty array:</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling TLS with the default Java certificates</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">tls:
  trustedCertificates: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on configuring mTLS authentication, see the <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code> schema reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-resources-reference"><a class="link" href="#con-common-configuration-resources-reference">8.1.5. <code>resources</code></a></h4>
<div class="paragraph">
<p>Configure resource <em>requests</em> and <em>limits</em> to control resources for Strimzi containers.
You can specify requests and limits for <code>memory</code> and <code>cpu</code> resources.
The requests should be enough to ensure a stable performance of Kafka.</p>
</div>
<div class="paragraph">
<p>How you configure resources in a production environment depends on a number of factors.
For example, applications are likely to be sharing resources in your Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>For Kafka, the following aspects of a deployment can impact the resources you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Throughput and size of messages</p>
</li>
<li>
<p>The number of network threads handling messages</p>
</li>
<li>
<p>The number of producers and consumers</p>
</li>
<li>
<p>The number of topics and partitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values specified for resource requests are reserved and always available to the container.
Resource limits specify the maximum resources that can be consumed by a given container.
The amount between the request and limit is not reserved and might not be always available.
A container can use the resources up to the limit only when they are available.
Resource limits are temporary and can be reallocated.</p>
</div>
<div class="paragraph">
<div class="title">Resource requests and limits</div>
<p><span class="image"><img src="images/common-config-resources.png" alt="Boundaries of a resource requests and limits"></span></p>
</div>
<div class="paragraph">
<p>If you set limits without requests or vice versa, Kubernetes uses the same value for both.
Setting equal requests and limits for resources guarantees quality of service, as
Kubernetes will not kill containers unless they exceed their limits.</p>
</div>
<div class="paragraph">
<p>You can configure resource requests and limits for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    #...
    resources:
      requests:
        memory: 64Gi
        cpu: "8"
      limits:
        memory: 64Gi
        cpu: "12"
  entityOperator:
    #...
    topicOperator:
      #...
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Resource requests and limits for the Topic Operator and User Operator are set in the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi uses the Kubernetes syntax for specifying <code>memory</code> and <code>cpu</code> resources.
For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Memory resources</dt>
<dd>
<p>When configuring memory resources, consider the total requirements of the components.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Kafka runs inside a JVM and uses an operating system page cache to store message data before writing to disk.
The memory request for Kafka should fit the JVM heap and page cache.
You can <a href="#con-common-configuration-jvm-reference">configure the <code>jvmOptions</code> property</a> to control the minimum and maximum heap size.</p>
</div>
<div class="paragraph">
<p>Other components don&#8217;t rely on the page cache.
You can configure memory resources without configuring the <code>jvmOptions</code> to control the heap size.</p>
</div>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.
Use the following suffixes in the specification:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>M</code> for megabytes</p>
</li>
<li>
<p><code>G</code> for gigabytes</p>
</li>
<li>
<p><code>Mi</code> for mebibytes</p>
</li>
<li>
<p><code>Gi</code> for gibibytes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example resources using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">CPU resources</dt>
<dd>
<p>A CPU request should be enough to give a reliable performance at any time.
CPU requests and limits are specified as <em>cores</em> or <em>millicpus</em>/<em>millicores</em>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>CPU cores are specified as integers (<code>5</code> CPU core) or decimals (<code>2.5</code> CPU core).
1000 <em>millicores</em> is the same as <code>1</code> CPU core.</p>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.</p>
</div>
<div class="paragraph">
<p>For more information on CPU specification, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-images-reference"><a class="link" href="#con-common-configuration-images-reference">8.1.6. <code>image</code></a></h4>
<div class="paragraph">
<p>Use the <code>image</code> property to configure the container image used by the component.</p>
</div>
<div class="paragraph">
<p>Overriding container images is recommended only in special situations where you need to use a different container registry or a customized image.</p>
</div>
<div class="paragraph">
<p>For example, if your network does not allow access to the container repository used by Strimzi, you can copy the Strimzi images or build them from the source.
However, if the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="paragraph">
<p>A copy of the container image might also be customized and used for debugging.</p>
</div>
<div class="paragraph">
<p>You can specify which container image to use for a component using the <code>image</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.jmxTrans</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker2.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring the <code>image</code> property for Kafka, Kafka Connect, and Kafka MirrorMaker</strong></p>
</div>
<div class="paragraph">
<p>Kafka, Kafka Connect, and Kafka MirrorMaker support multiple versions of Kafka.
Each component requires its own image.
The default images for the different Kafka versions are configured in the following environment variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STRIMZI_KAFKA_IMAGES</code></p>
</li>
<li>
<p><code>STRIMZI_KAFKA_CONNECT_IMAGES</code></p>
</li>
<li>
<p><code>STRIMZI_KAFKA_MIRROR_MAKER_IMAGES</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These environment variables contain mappings between the Kafka versions and their corresponding images.
The mappings are used together with the <code>image</code> and <code>version</code> properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>image</code> nor <code>version</code> are given in the custom resource then the <code>version</code> will default to the Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the environment variable.</p>
</li>
<li>
<p>If <code>image</code> is given but <code>version</code> is not, then the given image is used and the <code>version</code> is assumed to be the Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>version</code> is given but <code>image</code> is not, then the image that corresponds to the given version in the environment variable is used.</p>
</li>
<li>
<p>If both <code>version</code> and <code>image</code> are given, then the given image is used. The image is assumed to contain a Kafka image with the given version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>image</code> and <code>version</code> for the different components can be configured in the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka in <code>spec.kafka.image</code> and <code>spec.kafka.version</code>.</p>
</li>
<li>
<p>For Kafka Connect and Kafka MirrorMaker in <code>spec.image</code> and <code>spec.version</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is recommended to provide only the <code>version</code> and leave the <code>image</code> property unspecified.
This reduces the chance of making a mistake when configuring the custom resource.
If you need to change the images used for different versions of Kafka, it is preferable to configure the Cluster Operator&#8217;s environment variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring the <code>image</code> property in other resources</strong></p>
</div>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/kafka:latest-kafka-3.3.2</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Exporter:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_EXPORTER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/kafka:latest-kafka-3.3.2</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Bridge:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_BRIDGE_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/kafka-bridge:0.24.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka broker initializer:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka jmxTrans:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_JMXTRANS_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/jmxtrans:latest</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-healthchecks-reference"><a class="link" href="#con-common-configuration-healthchecks-reference">8.1.7. <code>livenessProbe</code> and <code>readinessProbe</code> healthchecks</a></h4>
<div class="paragraph">
<p>Use the <code>livenessProbe</code> and <code>readinessProbe</code> properties to configure healthcheck probes supported in Strimzi.</p>
</div>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.</p>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see the <a href="#type-Probe-reference">Probe schema reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-prometheus-reference"><a class="link" href="#con-common-configuration-prometheus-reference">8.1.8. <code>metricsConfig</code></a></h4>
<div class="paragraph">
<p>Use the <code>metricsConfig</code> property to enable and configure Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>The <code>metricsConfig</code> property contains a reference to a ConfigMap that has additional configurations for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX Exporter</a>.
Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>To enable Prometheus metrics export without further configuration, you can reference a ConfigMap containing an empty file under <code>metricsConfig.valueFrom.configMapKeyRef.key</code>.
When referencing an empty file, all metrics are exposed as long as they have not been renamed.</p>
</div>
<div class="listingblock">
<div class="title">Example ConfigMap with metrics configuration for Kafka</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: my-configmap
data:
  my-key: |
    lowercaseOutputName: true
    rules:
    # Special cases and very specific rules
    - pattern: kafka.server&lt;type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)&gt;&lt;&gt;Value
      name: kafka_server_$1_$2
      type: GAUGE
      labels:
       clientId: "$3"
       topic: "$4"
       partition: "$5"
    # further configuration</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example metrics configuration for Kafka</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metricsConfig:
      type: jmxPrometheusExporter
      valueFrom:
        configMapKeyRef:
          name: my-config-map
          key: my-key
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>When the <code>metricsConfig</code> (or deprecated <code>metrics</code>) property is not defined in the resource, the Prometheus metrics are disabled.</p>
</div>
<div class="paragraph">
<p>For more information about setting up and deploying Prometheus and Grafana, see <a href="./deploying.html#assembly-metrics-setup-str">Introducing Metrics to Kafka</a> in the <em>Deploying and Upgrading Strimzi</em> guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-jvm-reference"><a class="link" href="#con-common-configuration-jvm-reference">8.1.9. <code>jvmOptions</code></a></h4>
<div class="paragraph">
<p>The following Strimzi components run inside a Java Virtual Machine (JVM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache ZooKeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka MirrorMaker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To optimize their performance on different platforms and architectures, you configure the <code>jvmOptions</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.cruiseControl</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker2.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify the following options in your configuration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Xms</code></dt>
<dd>
<p>Minimum initial allocation heap size when the JVM starts</p>
</dd>
<dt class="hdlist1"><code>-Xmx</code></dt>
<dd>
<p>Maximum heap size</p>
</dd>
<dt class="hdlist1"><code>-XX</code></dt>
<dd>
<p>Advanced runtime options for the JVM</p>
</dd>
<dt class="hdlist1"><code>javaSystemProperties</code></dt>
<dd>
<p>Additional system properties</p>
</dd>
<dt class="hdlist1"><code>gcLoggingEnabled</code></dt>
<dd>
<p><a href="#con-common-configuration-garbage-collection-reference">Enables garbage collector logging</a></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings, such as <code>-Xmx</code> and <code>-Xms</code>, are the same units accepted by the JDK <code>java</code> binary in the corresponding image.
Therefore, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is different from the units used for <a href="#con-common-configuration-resources-reference">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title"><code>-Xms</code> and <code>-Xmx</code> options</div>
<p>In addition to setting memory request and limit values for your containers, you can use the <code>-Xms</code> and <code>-Xmx</code> JVM options to set specific heap sizes for your JVM.
Use the <code>-Xms</code> option to set an initial heap size and the <code>-Xmx</code> option to set a maximum heap size.</p>
</div>
<div class="paragraph">
<p>Specify heap size to have more control over the memory allocated to your JVM.
Heap sizes should make the best use of a container&#8217;s <a href="#con-common-configuration-resources-reference">memory limit (and request)</a> without exceeding it.
Heap size and any other memory requirements need to fit within a specified memory limit.
If you don&#8217;t specify heap size in your configuration, but you configure a memory resource limit (and request), the Cluster Operator imposes default heap sizes automatically.
The Cluster Operator sets default maximum and minimum heap values based on a percentage of the memory resource configuration.</p>
</div>
<div class="paragraph">
<p>The following table shows the default heap values.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Default heap settings for components</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Percent of available memory allocated to the heap</th>
<th class="tableblock halign-left valign-top">Maximum limit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZooKeeper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MirrorMaker 2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MirrorMaker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cruise Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">75%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31 Gi</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a memory limit (and request) is not specified, a JVM&#8217;s minimum heap size is set to <code>128M</code>.
The JVM&#8217;s maximum heap size is not defined to allow the memory to increase as needed.
This is ideal for single node environments in test and development.</p>
</div>
<div class="paragraph">
<p>Setting an appropriate memory request can prevent the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes killing a container if there is pressure on memory from other pods running on the node.</p>
</li>
<li>
<p>Kubernetes scheduling a container to a node with insufficient memory.
If <code>-Xms</code> is set to <code>-Xmx</code>, the container will crash immediately; if not, the container will crash at a later time.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this example, the JVM uses 2 GiB (=2,147,483,648 bytes) for its heap.
Total JVM memory usage can be a lot more than the maximum heap size.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>-Xmx</code> and <code>-Xms</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers performing lots of disk I/O, such as Kafka broker containers, require available memory for use as an operating system page cache.
For such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">-XX option</div>
<p><code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>-XX</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JVM options resulting from the <code>-XX</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When no <code>-XX</code> options are specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title"><code>javaSystemProperties</code></div>
<p><code>javaSystemProperties</code> are used to configure additional Java system properties, such as debugging utilities.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>javaSystemProperties</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jvmOptions:
  javaSystemProperties:
    - name: javax.net.debug
      value: ssl</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>jvmOptions</code>, see the <a href="#type-JvmOptions-reference"><code>JvmOptions</code> schema reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-garbage-collection-reference"><a class="link" href="#con-common-configuration-garbage-collection-reference">8.1.10. Garbage collector logging</a></h4>
<div class="paragraph">
<p>The <code>jvmOptions</code> property also allows you to enable and disable garbage collector (GC) logging.
GC logging is disabled by default.
To enable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example GC logging configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
jvmOptions:
  gcLoggingEnabled: true
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema_properties"><a class="link" href="#schema_properties">8.2. Schema properties</a></h3>
<div class="sect3">
<h4 id="type-Kafka-reference"><a class="link" href="#type-Kafka-reference">8.2.1. <code>Kafka</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka and ZooKeeper clusters, and Topic Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka and ZooKeeper clusters, and Topic Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaSpec-reference"><a class="link" href="#type-KafkaSpec-reference">8.2.2. <code>KafkaSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeper</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the ZooKeeper cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entityOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the Entity Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the cluster certificate authority.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientsCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the clients certificate authority.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cruiseControl</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration for Cruise Control deployment. Deploys a Cruise Control instance when specified.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxTrans</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>jmxTrans</code> property has been deprecated.</strong> JMXTrans is deprecated and will be removed in Strimzi 0.35.0 Configuration for JmxTrans. When the property is present a JmxTrans deployment is created for gathering JMX metrics from each Kafka broker. For more information see <a href="https://github.com/jmxtrans/jmxtrans">JmxTrans GitHub</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaExporter</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the Kafka Exporter. Kafka Exporter can provide additional metrics, for example lag of consumer group at topic/partition.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maintenanceTimeWindows</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of time windows for maintenance tasks (that is, certificates renewal). Each time window is defined by a cron expression.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaClusterSpec-reference"><a class="link" href="#type-KafkaClusterSpec-reference">8.2.3. <code>KafkaClusterSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClusterSpec-schema-reference">Full list of <code>KafkaClusterSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka cluster.</p>
</div>
<div class="sect4">
<h5 id="property-kafka-listeners-reference"><a class="link" href="#property-kafka-listeners-reference"><code>listeners</code></a></h5>
<div class="paragraph">
<p>Use the <code>listeners</code> property to configure listeners to provide access to Kafka brokers.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration of a plain (unencrypted) listener without authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-kafka-config-reference"><a class="link" href="#property-kafka-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka broker options as keys.</p>
</div>
<div class="paragraph">
<p>Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Broker ID configuration</p>
</li>
<li>
<p>Configuration of log data directories</p>
</li>
<li>
<p>Inter-broker communication</p>
</li>
<li>
<p>ZooKeeper connectivity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#brokerconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> with the exception of those options that are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>advertised.</code></p>
</li>
<li>
<p><code>broker.</code></p>
</li>
<li>
<p><code>listener.</code></p>
</li>
<li>
<p><code>host.name</code></p>
</li>
<li>
<p><code>port</code></p>
</li>
<li>
<p><code>inter.broker.listener.name</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>password.</code></p>
</li>
<li>
<p><code>principal.builder.class</code></p>
</li>
<li>
<p><code>log.dir</code></p>
</li>
<li>
<p><code>zookeeper.connect</code></p>
</li>
<li>
<p><code>zookeeper.set.acl</code></p>
</li>
<li>
<p><code>authorizer.</code></p>
</li>
<li>
<p><code>super.user</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other supported options are passed to Kafka.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also configure the <code>zookeeper.connection.timeout.ms</code> property to set the maximum time allowed for establishing a ZooKeeper connection.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka broker configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    config:
      num.partitions: 1
      num.recovery.threads.per.data.dir: 1
      default.replication.factor: 3
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 1
      log.retention.hours: 168
      log.segment.bytes: 1073741824
      log.retention.check.interval.ms: 300000
      num.network.threads: 3
      num.io.threads: 8
      socket.send.buffer.bytes: 102400
      socket.receive.buffer.bytes: 102400
      socket.request.max.bytes: 104857600
      group.initial.rebalance.delay.ms: 0
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      zookeeper.connection.timeout.ms: 6000
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-kafka-brokerRackInitImage-reference"><a class="link" href="#property-kafka-brokerRackInitImage-reference"><code>brokerRackInitImage</code></a></h5>
<div class="paragraph">
<p>When rack awareness is enabled, Kafka broker pods use init container to collect the labels from the Kubernetes cluster nodes.
The container image used for this container can be configured using the <code>brokerRackInitImage</code> property.
When the <code>brokerRackInitImage</code> field is missing, the following images are used in order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in <code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code> environment variable in the Cluster Operator configuration.</p>
</li>
<li>
<p><code>quay.io/strimzi/operator:latest</code> container image.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example <code>brokerRackInitImage</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    rack:
      topologyKey: topology.kubernetes.io/zone
    brokerRackInitImage: my-org/my-image:latest
    # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container registry used by Strimzi. In this case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="property-kafka-logging-reference"><a class="link" href="#property-kafka-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>Kafka has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j.logger.org.I0Itec.zkclient.ZkClient</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.zookeeper</code></p>
</li>
<li>
<p><code>log4j.logger.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.request.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.Processor</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.server.KafkaApis</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.RequestChannel$</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.controller</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.log.LogCleaner</code></p>
</li>
<li>
<p><code>log4j.logger.state.change.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.authorizer.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kafka uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # ...
  kafka:
    # ...
    logging:
      type: inline
      loggers:
        kafka.root.logger.level: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: customConfigMap
        key: kafka-log4j.properties
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any available loggers that are not configured have their level set to <code>OFF</code>.</p>
</div>
<div class="paragraph">
<p>If Kafka was deployed using the Cluster Operator,
changes to Kafka logging levels are applied dynamically.</p>
</div>
<div class="paragraph">
<p>If you use external logging, a rolling update is triggered when logging appenders are changed.</p>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClusterSpec-schema-reference"><a class="link" href="#type-KafkaClusterSpec-schema-reference"><code>KafkaClusterSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The kafka broker version. Defaults to 3.3.2. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods. The default value depends on the configured <code>Kafka.spec.kafka.version</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures listeners of Kafka brokers.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka broker config properties with the following prefixes cannot be set: listeners, advertised., broker., listener., host.name, port, inter.broker.listener.name, sasl., ssl., security., password., log.dir, zookeeper.connect, zookeeper.set.acl, zookeeper.ssl, zookeeper.clientCnxnSocket, authorizer., super.user, cruise.control.metrics.topic, cruise.control.metrics.reporter.bootstrap.servers,node.id, process.roles, controller. (with the exception of: zookeeper.connection.timeout.ms, sasl.server.max.receive.size,ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols, ssl.secure.random.implementation,cruise.control.metrics.topic.num.partitions, cruise.control.metrics.topic.replication.factor, cruise.control.metrics.topic.retention.ms,cruise.control.metrics.topic.auto.create.retries, cruise.control.metrics.topic.auto.create.timeout.ms,cruise.control.metrics.topic.min.insync.replicas,controller.quorum.election.backoff.max.ms, controller.quorum.election.timeout.ms, controller.quorum.fetch.timeout.ms).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim, jbod].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>, <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authorization configuration for Kafka brokers. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple, opa, keycloak, custom].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>, <a href="#type-KafkaAuthorizationCustom-reference"><code>KafkaAuthorizationCustom</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the <code>broker.rack</code> broker config.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image of the init container used for initializing the <code>broker.rack</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JMX Options for Kafka brokers.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for Kafka. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka cluster resources. The template allows users to specify how the <code>StatefulSet</code>, <code>Pods</code>, and <code>Services</code> are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-GenericKafkaListener-reference"><a class="link" href="#type-GenericKafkaListener-reference">8.2.4. <code>GenericKafkaListener</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-GenericKafkaListener-schema-reference">Full list of <code>GenericKafkaListener</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures listeners to connect to Kafka brokers within and outside Kubernetes.</p>
</div>
<div class="paragraph">
<p>You configure the listeners in the <code>Kafka</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> resource showing listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    #...
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
      - name: external1
        port: 9094
        type: route
        tls: true
      - name: external2
        port: 9095
        type: ingress
        tls: true
        authentication:
          type: tls
        configuration:
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
    #...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="property-generic-listeners-reference"><a class="link" href="#property-generic-listeners-reference"><code>listeners</code></a></h5>
<div class="paragraph">
<p>You configure Kafka broker listeners using the <code>listeners</code> property in the <code>Kafka</code> resource.
Listeners are defined as an array.</p>
</div>
<div class="listingblock">
<div class="title">Example listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  - name: plain
    port: 9092
    type: internal
    tls: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name and port must be unique within the Kafka cluster.
The name can be up to 25 characters long, comprising lower-case letters and numbers.
Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX.</p>
</div>
<div class="paragraph">
<p>By specifying a unique name and port for each listener,
you can configure multiple listeners.</p>
</div>
</div>
<div class="sect4">
<h5 id="type"><a class="link" href="#type"><code>type</code></a></h5>
<div class="paragraph">
<p>The type is set as <code>internal</code>,
or for external listeners, as <code>route</code>, <code>loadbalancer</code>, <code>nodeport</code>, <code>ingress</code> or <code>cluster-ip</code>.
You can also configure a <code>cluster-ip</code> listener, a type of internal listener you can use to build custom access mechanisms.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">internal</dt>
<dd>
<p>You can configure internal listeners with or without encryption using the <code>tls</code> property.</p>
<div class="listingblock">
<div class="title">Example <code>internal</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">route</dt>
<dd>
<p>Configures an external listener to expose Kafka using OpenShift <code>Routes</code> and the HAProxy router.</p>
<div class="paragraph">
<p>A dedicated <code>Route</code> is created for every Kafka broker pod.
An additional <code>Route</code> is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Routes</code> to connect to Kafka on port 443.
The client connects on port 443, the default router port, but traffic is then routed to the port you configure,
which is <code>9094</code> in this example.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>route</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external1
        port: 9094
        type: route
        tls: true
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">ingress</dt>
<dd>
<p>Configures an external listener to expose Kafka using Kubernetes <code>Ingress</code> and the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">Ingress NGINX Controller for Kubernetes</a>.</p>
<div class="paragraph">
<p>A dedicated <code>Ingress</code> resource is created for every Kafka broker pod.
An additional <code>Ingress</code> resource is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Ingress</code> resources to connect to Kafka on port 443.
The client connects on port 443, the default controller port, but traffic is then routed to the port you configure,
which is <code>9095</code> in the following example.</p>
</div>
<div class="paragraph">
<p>You must specify the hostnames used by the bootstrap and per-broker services
using <a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code></a>
and <a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code></a> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ingress</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external2
        port: 9095
        type: ingress
        tls: true
        authentication:
          type: tls
        configuration:
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
  #...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
External listeners using <code>Ingress</code> are currently only tested with the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">Ingress NGINX Controller for Kubernetes</a>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">loadbalancer</dt>
<dd>
<p>Configures an external listener to expose Kafka using a <code>Loadbalancer</code> type <code>Service</code>.</p>
<div class="paragraph">
<p>A new loadbalancer service is created for every Kafka broker pod.
An additional loadbalancer is created to serve as a Kafka <em>bootstrap</em> address.
Loadbalancers listen to the specified port number, which is port <code>9094</code> in the following example.</p>
</div>
<div class="paragraph">
<p>You can use the <code>loadBalancerSourceRanges</code> property to configure <a href="#property-listener-config-source-ranges-reference">source ranges</a> to restrict access to the specified IP addresses.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>loadbalancer</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      - name: external3
        port: 9094
        type: loadbalancer
        tls: true
        configuration:
          loadBalancerSourceRanges:
            - 10.0.0.0/8
            - 88.208.76.87/32
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">nodeport</dt>
<dd>
<p>Configures an external listener to expose Kafka using a <code>NodePort</code> type <code>Service</code>.</p>
<div class="paragraph">
<p>Kafka clients connect directly to the nodes of Kubernetes.
An additional <code>NodePort</code> type of service is created to serve as a Kafka bootstrap address.</p>
</div>
<div class="paragraph">
<p>When configuring the advertised addresses for the Kafka broker pods, Strimzi uses the address of the node on which the given pod is running.
You can use <code>preferredNodePortAddressType</code> property to configure the <a href="#property-listener-config-preferredNodePortAddressType-reference">first address type checked as the node address</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>nodeport</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external4
        port: 9095
        type: nodeport
        tls: false
        configuration:
          preferredNodePortAddressType: InternalDNS
    #...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS hostname verification is not currently supported when exposing Kafka clusters using node ports.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">cluster-ip</dt>
<dd>
<p>Configures an internal listener to expose Kafka using a per-broker <code>ClusterIP</code> type <code>Service</code>.</p>
<div class="paragraph">
<p>The listener does not use a headless service and its DNS names to route traffic to Kafka brokers.
You can use this type of listener to expose a Kafka cluster when using the headless service is unsuitable.
You might use it with a custom access mechanism, such as one that uses a specific Ingress controller or the Kubernetes Gateway API.</p>
</div>
<div class="paragraph">
<p>A new <code>ClusterIP</code> service is created for each Kafka broker pod.
The service is assigned a <code>ClusterIP</code> address to serve as a Kafka <em>bootstrap</em> address with a per-broker port number.
For example, you can configure the listener to expose a Kafka cluster over an Nginx Ingress Controller with TCP port configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>cluster-ip</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">#...
spec:
  kafka:
    #...
    listeners:
      - name: external-cluster-ip
        type: cluster-ip
        tls: false
        port: 9096
    #...</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-port-reference"><a class="link" href="#property-listener-port-reference"><code>port</code></a></h5>
<div class="paragraph">
<p>The port number is the port used in the Kafka cluster, which might not be the same port used for access by a client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>loadbalancer</code> listeners use the specified port number, as do <code>internal</code> and <code>cluster-ip</code> listeners</p>
</li>
<li>
<p><code>ingress</code> and <code>route</code> listeners use port 443 for access</p>
</li>
<li>
<p><code>nodeport</code> listeners use the port number assigned by Kubernetes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection, use the address and port for the bootstrap service of the listener.
You can retrieve this from the status of the <code>Kafka</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example command to retrieve the address and port for client connection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get kafka <em>&lt;kafka_cluster_name&gt;</em> -o=jsonpath='{.status.listeners[?(@.name=="<em>&lt;listener_name&gt;</em>")].bootstrapServers}{"\n"}'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Listeners cannot be configured to use the ports set aside for interbroker communication (9090 and 9091) and metrics (9404).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-tls-reference"><a class="link" href="#property-listener-tls-reference"><code>tls</code></a></h5>
<div class="paragraph">
<p>The TLS property is required.</p>
</div>
<div class="paragraph">
<p>By default, TLS encryption is not enabled.
To enable it, set the <code>tls</code> property to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>For <code>route</code> and <code>ingress</code> type listeners, TLS encryption must be enabled.</p>
</div>
</div>
<div class="sect4">
<h5 id="authentication"><a class="link" href="#authentication"><code>authentication</code></a></h5>
<div class="paragraph">
<p>Authentication for the listener can be specified as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mTLS (<code>tls</code>)</p>
</li>
<li>
<p>SCRAM-SHA-512 (<code>scram-sha-512</code>)</p>
</li>
<li>
<p>Token-based OAuth 2.0 (<code>oauth</code>)</p>
</li>
<li>
<p><a href="#type-KafkaListenerAuthenticationCustom-reference">Custom (<code>custom</code>)</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="configuration-listener-network-policy-reference"><a class="link" href="#configuration-listener-network-policy-reference"><code>networkPolicyPeers</code></a></h5>
<div class="paragraph">
<p>Use <code>networkPolicyPeers</code> to configure network policies that restrict access to a listener at the network level.
The following example shows a <code>networkPolicyPeers</code> configuration for a <code>plain</code> and a <code>tls</code> listener.</p>
</div>
<div class="paragraph">
<p>In the following example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only application pods matching the labels <code>app: kafka-sasl-consumer</code> and <code>app: kafka-sasl-producer</code> can connect to the <code>plain</code> listener.
The application pods must be running in the same namespace as the Kafka broker.</p>
</li>
<li>
<p>Only application pods running in namespaces matching the labels <code>project: myproject</code> and <code>project: myproject2</code> can connect to the <code>tls</code> listener.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax of the <code>networkPolicyPeers</code> property is the same as the <code>from</code> property in <code>NetworkPolicy</code> resources.</p>
</div>
<div class="listingblock">
<div class="title">Exanmple network policy configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: plain
    port: 9092
    type: internal
    tls: true
    authentication:
      type: scram-sha-512
    networkPolicyPeers:
      - podSelector:
          matchLabels:
            app: kafka-sasl-consumer
      - podSelector:
          matchLabels:
            app: kafka-sasl-producer
  - name: tls
    port: 9093
    type: internal
    tls: true
    authentication:
      type: tls
    networkPolicyPeers:
      - namespaceSelector:
          matchLabels:
            project: myproject
      - namespaceSelector:
          matchLabels:
            project: myproject2
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-GenericKafkaListener-schema-reference"><a class="link" href="#type-GenericKafkaListener-schema-reference"><code>GenericKafkaListener</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of the listener. The name will be used to identify the listener and the related Kubernetes objects. The name has to be unique within given a Kafka cluster. The name can consist of lowercase characters and numbers and be up to 11 characters long.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Port number used by the listener inside Kafka. The port number has to be unique within a given Kafka cluster. Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX. Depending on the listener type, the port number might not be the same as the port number that connects Kafka clients.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Type of the listener. Currently the supported types are <code>internal</code>, <code>route</code>, <code>loadbalancer</code>, <code>nodeport</code> and <code>ingress</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>internal</code> type exposes Kafka internally only within the Kubernetes cluster.</p>
</li>
<li>
<p><code>route</code> type uses OpenShift Routes to expose Kafka.</p>
</li>
<li>
<p><code>loadbalancer</code> type uses LoadBalancer type services to expose Kafka.</p>
</li>
<li>
<p><code>nodeport</code> type uses NodePort type services to expose Kafka.</p>
</li>
<li>
<p><code>ingress</code> type uses Kubernetes Nginx Ingress to expose Kafka with TLS passthrough.</p>
</li>
<li>
<p><code>cluster-ip</code> type uses a per-broker <code>ClusterIP</code> service.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [ingress, internal, route, loadbalancer, cluster-ip, nodeport])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enables TLS encryption on the listener. This is a required property.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for this listener. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth, custom].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationCustom-reference"><code>KafkaListenerAuthenticationCustom</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Additional listener configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#networkpolicypeer-v1-networking-k8s-io">external documentation for networking.k8s.io/v1 networkpolicypeer</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaListenerAuthenticationTls-reference"><a class="link" href="#type-KafkaListenerAuthenticationTls-reference">8.2.5. <code>KafkaListenerAuthenticationTls</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaListenerAuthenticationTls</code> type from <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationCustom-reference"><code>KafkaListenerAuthenticationCustom</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaListenerAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>tls</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaListenerAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaListenerAuthenticationScramSha512-reference">8.2.6. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaListenerAuthenticationScramSha512</code> type from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationCustom-reference"><code>KafkaListenerAuthenticationCustom</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaListenerAuthenticationScramSha512</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>scram-sha-512</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaListenerAuthenticationOAuth-reference"><a class="link" href="#type-KafkaListenerAuthenticationOAuth-reference">8.2.7. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaListenerAuthenticationOAuth</code> type from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationCustom-reference"><code>KafkaListenerAuthenticationCustom</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaListenerAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessTokenIsJwt</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configure whether the access token is treated as JWT. This must be set to <code>false</code> if the authorization server returns opaque tokens. Defaults to <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkAccessTokenType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configure whether the access token type check is performed or not. This should be set to <code>false</code> if the authorization server does not include 'typ' claim in JWT token. Defaults to <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkAudience</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable audience checking. Audience checks identify the recipients of tokens. If audience checking is enabled, the OAuth Client ID also has to be configured using the <code>clientId</code> property. The Kafka broker will reject tokens that do not have its <code>clientId</code> in their <code>aud</code> (audience) claim.Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkIssuer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable issuer checking. By default issuer is checked using the value configured by <code>validIssuerUri</code>. Default value is <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientAudience</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The audience to use when making requests to the authorization server&#8217;s token endpoint. Used for inter-broker authentication and for configuring OAuth 2.0 over PLAIN using the <code>clientId</code> and <code>secret</code> method.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>OAuth Client ID which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientScope</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The scope to use when making requests to the authorization server&#8217;s token endpoint. Used for inter-broker authentication and for configuring OAuth 2.0 over PLAIN using the <code>clientId</code> and <code>secret</code> method.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Link to Kubernetes Secret containing the OAuth client secret which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The connect timeout in seconds when connecting to authorization server. If not set, the effective connect timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">customClaimCheck</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JsonPath filter query to be applied to the JWT token or to the response of the introspection endpoint for additional token validation. Not set by default.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable TLS hostname verification. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableECDSA</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>enableECDSA</code> property has been deprecated.</strong> Enable or disable ECDSA support by installing BouncyCastle crypto provider. ECDSA support is always enabled. The BouncyCastle libraries are no longer packaged with Strimzi. Value is ignored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable OAuth metrics. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableOauthBearer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable OAuth authentication over SASL_OAUTHBEARER. Default value is <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enablePlain</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable OAuth authentication over SASL_PLAIN. There is no re-authentication support when this mechanism is used. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failFast</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable termination of Kafka broker processes due to potentially recoverable runtime errors during startup. Default value is <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallbackUserNameClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The fallback username claim to be used for the user id if the claim specified by <code>userNameClaim</code> is not present. This is useful when <code>client_credentials</code> authentication only results in the client id being provided in another claim. It only takes effect if <code>userNameClaim</code> is set.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallbackUserNamePrefix</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The prefix to use with the value of <code>fallbackUserNameClaim</code> to construct the user id. This only takes effect if <code>fallbackUserNameClaim</code> is true, and the value is present for the claim. Mapping usernames and client ids into the same user id space is useful in preventing name collisions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JsonPath query used to extract groups for the user during authentication. Extracted groups can be used by a custom authorizer. By default no groups are extracted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsClaimDelimiter</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A delimiter used to parse groups when they are extracted as a single String value rather than a JSON array. Default value is ',' (comma).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">introspectionEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URI of the token introspection endpoint which can be used to validate opaque non-JWT tokens.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URI of the JWKS certificate endpoint, which can be used for local JWT validation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksExpirySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures how often are the JWKS certificates considered valid. The expiry interval has to be at least 60 seconds longer then the refresh interval specified in <code>jwksRefreshSeconds</code>. Defaults to 360 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksIgnoreKeyUse</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Flag to ignore the 'use' attribute of <code>key</code> declarations in a JWKS endpoint response. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksMinRefreshPauseSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The minimum pause between two consecutive refreshes. When an unknown signing key is encountered the refresh is scheduled immediately, but will always wait for this minimum pause. Defaults to 1 second.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksRefreshSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures how often are the JWKS certificates refreshed. The refresh interval has to be at least 60 seconds shorter then the expiry interval specified in <code>jwksExpirySeconds</code>. Defaults to 300 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxSecondsWithoutReauthentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maximum number of seconds the authenticated session remains valid without re-authentication. This enables Apache Kafka re-authentication feature, and causes sessions to expire when the access token expires. If the access token expires before max time or if max time is reached, the client has to re-authenticate, otherwise the server will drop the connection. Not set by default - the authenticated session does not expire when the access token expires. This option only applies to SASL_OAUTHBEARER authentication mechanism (when <code>enableOauthBearer</code> is <code>true</code>).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The read timeout in seconds when connecting to authorization server. If not set, the effective read timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Trusted certificates for TLS connection to the OAuth server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URI of the Token Endpoint to use with SASL_PLAIN mechanism when the client authenticates with <code>clientId</code> and a <code>secret</code>. If set, the client can authenticate over SASL_PLAIN by either setting <code>username</code> to <code>clientId</code>, and setting <code>password</code> to client <code>secret</code>, or by setting <code>username</code> to account username, and <code>password</code> to access token prefixed with <code>$accessToken:</code>. If this option is not set, the <code>password</code> is always interpreted as an access token (without a prefix), and <code>username</code> as the account username (a so called 'no-client-credentials' mode).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>oauth</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userInfoEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URI of the User Info Endpoint to use as a fallback to obtaining the user id when the Introspection Endpoint does not return information that can be used for the user id.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userNameClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response which will be used to extract the user id. Defaults to <code>sub</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validIssuerUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URI of the token issuer used for authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validTokenType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Valid value for the <code>token_type</code> attribute returned by the Introspection Endpoint. No default value, and not checked by default.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-GenericSecretSource-reference"><a class="link" href="#type-GenericSecretSource-reference">8.2.8. <code>GenericSecretSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationCustom-reference"><code>KafkaListenerAuthenticationCustom</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The key under which the secret value is stored in the Kubernetes Secret.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the Kubernetes Secret containing the secret value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-CertSecretSource-reference"><a class="link" href="#type-CertSecretSource-reference">8.2.9. <code>CertSecretSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ClientTls-reference"><code>ClientTls</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the file certificate in the Secret.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the Secret containing the certificate.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaListenerAuthenticationCustom-reference"><a class="link" href="#type-KafkaListenerAuthenticationCustom-reference">8.2.10. <code>KafkaListenerAuthenticationCustom</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaListenerAuthenticationCustom-schema-reference">Full list of <code>KafkaListenerAuthenticationCustom</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure custom authentication, set the <code>type</code> property to <code>custom</code>.</p>
</div>
<div class="paragraph">
<p>Custom authentication allows for any type of kafka-supported authentication to be used.</p>
</div>
<div class="listingblock">
<div class="title">Example custom OAuth authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  kafka:
    config:
      principal.builder.class: SimplePrincipal.class
    listeners:
      - name: oauth-bespoke
        port: 9093
        type: internal
        tls: true
        authentication:
          type: custom
          sasl: true
          listenerConfig:
            oauthbearer.sasl.client.callback.handler.class: client.class
            oauthbearer.sasl.server.callback.handler.class: server.class
            oauthbearer.sasl.login.callback.handler.class: login.class
            oauthbearer.connections.max.reauth.ms: 999999999
            sasl.enabled.mechanisms: oauthbearer
            oauthbearer.sasl.jaas.config: |
              org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required ;
          secrets:
            - name: example</code></pre>
</div>
</div>
<div class="paragraph">
<p>A protocol map is generated that uses the <code>sasl</code> and <code>tls</code> values to determine which protocol to map to the listener.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SASL = True, TLS = True &#8594; SASL_SSL</p>
</li>
<li>
<p>SASL = False, TLS = True &#8594; SSL</p>
</li>
<li>
<p>SASL = True, TLS = False &#8594; SASL_PLAINTEXT</p>
</li>
<li>
<p>SASL = False, TLS = False &#8594; PLAINTEXT</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="listenerconfig"><a class="link" href="#listenerconfig"><code>listenerConfig</code></a></h5>
<div class="paragraph">
<p>Listener configuration specified using <code>listenerConfig</code> is prefixed with <code>listener.name.<em>&lt;listener_name&gt;-&lt;port&gt;</em></code>.
For example, <code>sasl.enabled.mechanisms</code> becomes <code>listener.name.<em>&lt;listener_name&gt;-&lt;port&gt;</em>.sasl.enabled.mechanisms</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="secrets"><a class="link" href="#secrets"><code>secrets</code></a></h5>
<div class="paragraph">
<p>Secrets are mounted to <code>/opt/kafka/custom-authn-secrets/custom-listener-<em>&lt;listener_name&gt;-&lt;port&gt;</em>/<em>&lt;secret_name&gt;</em></code> in the Kafka broker nodes' containers.</p>
</div>
<div class="paragraph">
<p>For example, the mounted secret (<code>example</code>) in the example configuration would be located at <code>/opt/kafka/custom-authn-secrets/custom-listener-oauth-bespoke-9093/example</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="principal_builder"><a class="link" href="#principal_builder">Principal builder</a></h5>
<div class="paragraph">
<p>You can set a custom principal builder in the Kafka cluster configuration.
However, the principal builder is subject to the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The specified principal builder class must exist on the image.
<em>Before</em> building your own, check if one already exists.
You&#8217;ll need to rebuild the Strimzi images with the required classes.</p>
</li>
<li>
<p>No other listener is using <code>oauth</code> type authentication.
This is because an OAuth listener appends its own principle builder to the Kafka configuration.</p>
</li>
<li>
<p>The specified principal builder is compatible with Strimzi.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom principal builders must support peer certificates for authentication, as Strimzi uses these to manage the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>A custom OAuth principal builder might be identical or very similar to the Strimzi <a href="https://github.com/strimzi/strimzi-kafka-oauth/blob/main/oauth-server/src/main/java/io/strimzi/kafka/oauth/server/OAuthKafkaPrincipalBuilder.java">OAuth principal builder</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/security/authenticator/DefaultKafkaPrincipalBuilder.java#L73-L79">Kafka&#8217;s default principal builder class</a> supports the building of principals based on the names of peer certificates.
The custom principal builder should provide a principal of type <code>user</code> using the name of the SSL peer certificate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example shows a custom principal builder that satisfies the OAuth requirements of Strimzi.</p>
</div>
<div class="listingblock">
<div class="title">Example principal builder for custom OAuth configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public final class CustomKafkaPrincipalBuilder implements KafkaPrincipalBuilder {

    public KafkaPrincipalBuilder() {}

    @Override
    public KafkaPrincipal build(AuthenticationContext context) {
        if (context instanceof SslAuthenticationContext) {
            SSLSession sslSession = ((SslAuthenticationContext) context).session();
            try {
                return new KafkaPrincipal(
                    KafkaPrincipal.USER_TYPE, sslSession.getPeerPrincipal().getName());
            } catch (SSLPeerUnverifiedException e) {
                throw new IllegalArgumentException("Cannot use an unverified peer for authentication", e);
            }
        }

        // Create your own KafkaPrincipal here
        ...
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaListenerAuthenticationCustom-schema-reference"><a class="link" href="#type-KafkaListenerAuthenticationCustom-schema-reference"><code>KafkaListenerAuthenticationCustom</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaListenerAuthenticationCustom</code> type from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>.
It must have the value <code>custom</code> for the type <code>KafkaListenerAuthenticationCustom</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listenerConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration to be used for a specific listener. All values are prefixed with listener.name.<em>&lt;listener_name&gt;</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sasl</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable SASL on this listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secrets</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Secrets to be mounted to /opt/kafka/custom-authn-secrets/custom-listener-<em>&lt;listener_name&gt;-&lt;port&gt;</em>/<em>&lt;secret_name&gt;</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>custom</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-GenericKafkaListenerConfiguration-reference"><a class="link" href="#type-GenericKafkaListenerConfiguration-reference">8.2.11. <code>GenericKafkaListenerConfiguration</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-GenericKafkaListenerConfiguration-schema-reference">Full list of <code>GenericKafkaListenerConfiguration</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configuration for Kafka listeners.</p>
</div>
<div class="sect4">
<h5 id="property-listener-config-brokerCertChainAndKey-reference"><a class="link" href="#property-listener-config-brokerCertChainAndKey-reference"><code>brokerCertChainAndKey</code></a></h5>
<div class="paragraph">
<p>The <code>brokerCertChainAndKey</code> property is only used with listeners that have TLS encryption enabled.
You can use the property to provide your own Kafka listener certificates.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for a <code>loadbalancer</code> external listener with TLS encryption enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      brokerCertChainAndKey:
        secretName: my-secret
        certificate: my-listener-certificate.crt
        key: my-listener-key.key
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-traffic-policy-reference"><a class="link" href="#property-listener-config-traffic-policy-reference"><code>externalTrafficPolicy</code></a></h5>
<div class="paragraph">
<p>The <code>externalTrafficPolicy</code> property is used with <code>loadbalancer</code> and <code>nodeport</code> listeners.
When exposing Kafka outside of Kubernetes you can choose <code>Local</code> or <code>Cluster</code>.
<code>Local</code> avoids hops to other nodes and preserves the client IP, whereas <code>Cluster</code> does neither.
The default is <code>Cluster</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-source-ranges-reference"><a class="link" href="#property-listener-config-source-ranges-reference"><code>loadBalancerSourceRanges</code></a></h5>
<div class="paragraph">
<p>The <code>loadBalancerSourceRanges</code> property is only used with <code>loadbalancer</code> listeners.
When exposing Kafka outside of Kubernetes use source ranges, in addition to labels and annotations, to customize how a service is created.</p>
</div>
<div class="listingblock">
<div class="title">Example source ranges configured for a loadbalancer listener</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: false
    configuration:
      externalTrafficPolicy: Local
      loadBalancerSourceRanges:
        - 10.0.0.0/8
        - 88.208.76.87/32
      # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-class-reference"><a class="link" href="#property-listener-config-class-reference"><code>class</code></a></h5>
<div class="paragraph">
<p>The <code>class</code> property is only used with <code>ingress</code> listeners.
You can configure the <code>Ingress</code> class using the <code>class</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>ingress</code> using <code>Ingress</code> class <code>nginx-internal</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: ingress
    tls: true
    configuration:
      class: nginx-internal
    # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-preferredNodePortAddressType-reference"><a class="link" href="#property-listener-config-preferredNodePortAddressType-reference"><code>preferredNodePortAddressType</code></a></h5>
<div class="paragraph">
<p>The <code>preferredNodePortAddressType</code> property is only used with <code>nodeport</code> listeners.</p>
</div>
<div class="paragraph">
<p>Use the <code>preferredNodePortAddressType</code> property in your listener configuration to specify the first address type checked as the node address.
This property is useful, for example, if your deployment does not have DNS support, or you only want to expose a broker internally through an internal DNS or IP address.
If an address of this type is found, it is used.
If the preferred address type is not found, Strimzi proceeds through the types in the standard order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ExternalDNS</p>
</li>
<li>
<p>ExternalIP</p>
</li>
<li>
<p>Hostname</p>
</li>
<li>
<p>InternalDNS</p>
</li>
<li>
<p>InternalIP</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with a preferred node port address type</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: nodeport
    tls: false
    configuration:
      preferredNodePortAddressType: InternalDNS
      # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-dns-reference"><a class="link" href="#property-listener-config-dns-reference"><code>useServiceDnsDomain</code></a></h5>
<div class="paragraph">
<p>The <code>useServiceDnsDomain</code> property is only used with <code>internal</code> and <code>cluster-ip</code> listeners.
It defines whether the fully-qualified DNS names that include the cluster service suffix (usually <code>.cluster.local</code>) are used.
With <code>useServiceDnsDomain</code> set as <code>false</code>, the advertised addresses are generated without the service suffix; for example, <code>my-cluster-kafka-0.my-cluster-kafka-brokers.myproject.svc</code>.
With <code>useServiceDnsDomain</code> set as <code>true</code>, the advertised addresses are generated with the service suffix; for example, <code>my-cluster-kafka-0.my-cluster-kafka-brokers.myproject.svc.cluster.local</code>.
Default is <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of an internal listener configured to use the Service DNS domain</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: plain
    port: 9092
    type: internal
    tls: false
    configuration:
      useServiceDnsDomain: true
      # ...
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your Kubernetes cluster uses a different service suffix than <code>.cluster.local</code>, you can configure the suffix using the <code>KUBERNETES_SERVICE_DNS_DOMAIN</code> environment variable in the Cluster Operator configuration.
See <a href="#ref-operator-cluster-str">Configuring the Cluster Operator with environment variables</a> for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-GenericKafkaListenerConfiguration-schema-reference"><a class="link" href="#type-GenericKafkaListenerConfiguration-schema-reference"><code>GenericKafkaListenerConfiguration</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the certificate and private key pair which will be used for this listener. The certificate can optionally contain the whole chain. This field can be used only with listeners with enabled TLS encryption.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalTrafficPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies whether the service routes external traffic to node-local or cluster-wide endpoints. <code>Cluster</code> may cause a second hop to another node and obscures the client source IP. <code>Local</code> avoids a second hop for LoadBalancer and Nodeport type services and preserves the client source IP (when supported by the infrastructure). If unspecified, Kubernetes will use <code>Cluster</code> as the default.This field can be used only with <code>loadbalancer</code> or <code>nodeport</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Local, Cluster])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerSourceRanges</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of CIDR ranges (for example <code>10.0.0.0/8</code> or <code>130.211.204.1/32</code>) from which clients can connect to load balancer type listeners. If supported by the platform, traffic through the loadbalancer is restricted to the specified CIDR ranges. This field is applicable only for loadbalancer type services and is ignored if the cloud provider does not support the feature. This field can be used only with <code>loadbalancer</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Bootstrap configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Per-broker configurations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipFamilyPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the IP Family Policy used by the service. Available options are <code>SingleStack</code>, <code>PreferDualStack</code> and <code>RequireDualStack</code>. <code>SingleStack</code> is for a single IP family. <code>PreferDualStack</code> is for two IP families on dual-stack configured clusters or a single IP family on single-stack clusters. <code>RequireDualStack</code> fails unless there are two IP families on dual-stack configured clusters. If unspecified, Kubernetes will choose the default value based on the service type. Available on Kubernetes 1.20 and newer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [RequireDualStack, SingleStack, PreferDualStack])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipFamilies</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the IP Families used by the service. Available options are <code>IPv4</code> and <code>IPv6. If unspecified, Kubernetes will choose the default value based on the `ipFamilyPolicy</code> setting. Available on Kubernetes 1.20 and newer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one or more of [IPv6, IPv4]) array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">createBootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether to create the bootstrap service or not. The bootstrap service is created by default (if not specified differently). This field can be used with the <code>loadBalancer</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures a specific class for <code>Ingress</code> and <code>LoadBalancer</code> that defines which controller will be used. This field can only be used with <code>ingress</code> and <code>loadbalancer</code> type listeners. If not specified, the default controller is used. For an <code>ingress</code> listener, set the <code>ingressClassName</code> property in the <code>Ingress</code> resources. For a <code>loadbalancer</code> listener, set the <code>loadBalancerClass</code> property  in the <code>Service</code> resources.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">finalizers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of finalizers which will be configured for the <code>LoadBalancer</code> type Services created for this listener. If supported by the platform, the finalizer <code>service.kubernetes.io/load-balancer-cleanup</code> to make sure that the external load balancer is deleted together with the service.For more information, see <a href="https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#garbage-collecting-load-balancers" class="bare">https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#garbage-collecting-load-balancers</a>. This field can be used only with <code>loadbalancer</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxConnectionCreationRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum connection creation rate we allow in this listener at any time. New connections will be throttled if the limit is reached.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxConnections</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum number of connections we allow for this listener in the broker at any time. New connections are blocked if the limit is reached.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferredNodePortAddressType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Defines which address type should be used as the node address. Available types are: <code>ExternalDNS</code>, <code>ExternalIP</code>, <code>InternalDNS</code>, <code>InternalIP</code> and <code>Hostname</code>. By default, the addresses will be used in the following order (the first one found will be used):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ExternalDNS</code></p>
</li>
<li>
<p><code>ExternalIP</code></p>
</li>
<li>
<p><code>InternalDNS</code></p>
</li>
<li>
<p><code>InternalIP</code></p>
</li>
<li>
<p><code>Hostname</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This field is used to select the preferred address type, which is checked first. If no address is found for this address type, the other types are checked in the default order. This field can only be used with <code>nodeport</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [ExternalDNS, ExternalIP, Hostname, InternalIP, InternalDNS])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useServiceDnsDomain</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures whether the Kubernetes service DNS domain should be used or not. If set to <code>true</code>, the generated addresses will contain the service DNS domain suffix (by default <code>.cluster.local</code>, can be configured using environment variable <code>KUBERNETES_SERVICE_DNS_DOMAIN</code>). Defaults to <code>false</code>.This field can be used only with <code>internal</code> and <code>cluster-ip</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-CertAndKeySecretSource-reference"><a class="link" href="#type-CertAndKeySecretSource-reference">8.2.12. <code>CertAndKeySecretSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a>, <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the file certificate in the Secret.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the private key in the Secret.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the Secret containing the certificate.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-GenericKafkaListenerConfigurationBootstrap-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBootstrap-reference">8.2.13. <code>GenericKafkaListenerConfigurationBootstrap</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-GenericKafkaListenerConfigurationBootstrap-schema-reference">Full list of <code>GenericKafkaListenerConfigurationBootstrap</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Broker service equivalents of <code>nodePort</code>, <code>host</code>, <code>loadBalancerIP</code> and <code>annotations</code> properties are configured in the <a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code> schema</a>.</p>
</div>
<div class="sect4">
<h5 id="property-listener-config-altnames-reference"><a class="link" href="#property-listener-config-altnames-reference"><code>alternativeNames</code></a></h5>
<div class="paragraph">
<p>You can specify alternative names for the bootstrap service.
The names are added to the broker certificates and can be used for TLS hostname verification.
The <code>alternativeNames</code> property is applicable to all types of listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external <code>route</code> listener configured with an additional bootstrap address</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        alternativeNames:
          - example.hostname1
          - example.hostname2
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-host-reference"><a class="link" href="#property-listener-config-host-reference"><code>host</code></a></h5>
<div class="paragraph">
<p>The <code>host</code> property is used with <code>route</code> and <code>ingress</code> listeners to specify the hostnames used by the bootstrap and per-broker services.</p>
</div>
<div class="paragraph">
<p>A <code>host</code> property value is mandatory for <code>ingress</code> listener configuration, as the Ingress controller does not assign any hostnames automatically.
Make sure that the hostnames resolve to the Ingress endpoints.
Strimzi will not perform any validation that the requested hosts are available and properly routed to the Ingress endpoints.</p>
</div>
<div class="listingblock">
<div class="title">Example of host configuration for an ingress listener</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: ingress
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        host: bootstrap.myingress.com
      brokers:
      - broker: 0
        host: broker-0.myingress.com
      - broker: 1
        host: broker-1.myingress.com
      - broker: 2
        host: broker-2.myingress.com
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>route</code> listener hosts are automatically assigned by OpenShift.
However, you can override the assigned route hosts by specifying hosts.</p>
</div>
<div class="paragraph">
<p>Strimzi does not perform any validation that the requested hosts are available.
You must ensure that they are free and can be used.</p>
</div>
<div class="listingblock">
<div class="title">Example of host configuration for a route listener</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        host: bootstrap.myrouter.com
      brokers:
      - broker: 0
        host: broker-0.myrouter.com
      - broker: 1
        host: broker-1.myrouter.com
      - broker: 2
        host: broker-2.myrouter.com
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-nodeport-reference"><a class="link" href="#property-listener-config-nodeport-reference"><code>nodePort</code></a></h5>
<div class="paragraph">
<p>By default, the port numbers used for the bootstrap and broker services are automatically assigned by Kubernetes.
You can override the assigned node ports for <code>nodeport</code> listeners by specifying the requested port numbers.</p>
</div>
<div class="paragraph">
<p>Strimzi does not perform any validation on the requested ports.
You must ensure that they are free and available for use.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with overrides for node ports</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: nodeport
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        nodePort: 32100
      brokers:
      - broker: 0
        nodePort: 32000
      - broker: 1
        nodePort: 32001
      - broker: 2
        nodePort: 32002
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-lb-ip-reference"><a class="link" href="#property-listener-config-lb-ip-reference"><code>loadBalancerIP</code></a></h5>
<div class="paragraph">
<p>Use the <code>loadBalancerIP</code> property to request a specific IP address when creating a loadbalancer.
Use this property when you need to use a loadbalancer with a specific IP address.
The <code>loadBalancerIP</code> field is ignored if the cloud provider does not support the feature.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> with specific loadbalancer IP address requests</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        loadBalancerIP: 172.29.3.10
      brokers:
      - broker: 0
        loadBalancerIP: 172.29.3.1
      - broker: 1
        loadBalancerIP: 172.29.3.2
      - broker: 2
        loadBalancerIP: 172.29.3.3
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-listener-config-annotations-reference"><a class="link" href="#property-listener-config-annotations-reference"><code>annotations</code></a></h5>
<div class="paragraph">
<p>Use the <code>annotations</code> property to add annotations to Kubernetes resources related to the listeners.
You can use these annotations, for example, to instrument DNS tooling such as <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener">External DNS</a>, which automatically assigns DNS names to the loadbalancer services.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> using <code>annotations</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-bootstrap.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      brokers:
      - broker: 0
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-0.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 1
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-1.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 2
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-2.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-GenericKafkaListenerConfigurationBootstrap-schema-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBootstrap-schema-reference"><code>GenericKafkaListenerConfigurationBootstrap</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alternativeNames</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Additional alternative names for the bootstrap service. The alternative names will be added to the list of subject alternative names of the TLS certificates.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The bootstrap host. This field will be used in the Ingress resource or in the Route resource to specify the desired hostname. This field can be used only with <code>route</code> (optional) or <code>ingress</code> (required) type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Node port for the bootstrap service. This field can be used only with <code>nodeport</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.This field can be used only with <code>loadbalancer</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Annotations that will be added to the <code>Ingress</code>, <code>Route</code>, or <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, <code>route</code>, or <code>ingress</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Labels that will be added to the <code>Ingress</code>, <code>Route</code>, or <code>Service</code> resource. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, <code>route</code>, or <code>ingress</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-GenericKafkaListenerConfigurationBroker-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBroker-reference">8.2.14. <code>GenericKafkaListenerConfigurationBroker</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-GenericKafkaListenerConfigurationBroker-schema-reference">Full list of <code>GenericKafkaListenerConfigurationBroker</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>You can see example configuration for the <code>nodePort</code>, <code>host</code>, <code>loadBalancerIP</code> and <code>annotations</code> properties in the <a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code> schema</a>,
which configures bootstrap service overrides.</p>
</div>
<div id="property-listener-config-broker-reference" class="paragraph">
<div class="title">Advertised addresses for brokers</div>
<p>By default, Strimzi tries to automatically determine the hostnames and ports that your Kafka cluster advertises to its clients.
This is not sufficient in all situations, because the infrastructure on which Strimzi is running might not provide the right hostname or port through which Kafka can be accessed.</p>
</div>
<div class="paragraph">
<p>You can specify a broker ID and customize the advertised hostname and port in the <code>configuration</code> property of the listener.
Strimzi will then automatically configure the advertised address in the Kafka brokers and add it to the broker certificates so it can be used for TLS hostname verification.
Overriding the advertised host and ports is available for all types of listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external <code>route</code> listener configured with overrides for advertised addresses</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      brokers:
      - broker: 0
        advertisedHost: example.hostname.0
        advertisedPort: 12340
      - broker: 1
        advertisedHost: example.hostname.1
        advertisedPort: 12341
      - broker: 2
        advertisedHost: example.hostname.2
        advertisedPort: 12342
# ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-GenericKafkaListenerConfigurationBroker-schema-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBroker-schema-reference"><code>GenericKafkaListenerConfigurationBroker</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>ID of the kafka broker (broker identifier). Broker IDs start from 0 and correspond to the number of broker replicas.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The host name which will be used in the brokers' <code>advertised.brokers</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The port number which will be used in the brokers' <code>advertised.brokers</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The broker host. This field will be used in the Ingress resource or in the Route resource to specify the desired hostname. This field can be used only with <code>route</code> (optional) or <code>ingress</code> (required) type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Node port for the per-broker service. This field can be used only with <code>nodeport</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.This field can be used only with <code>loadbalancer</code> type listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Annotations that will be added to the <code>Ingress</code> or <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, or <code>ingress</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Labels that will be added to the <code>Ingress</code>, <code>Route</code>, or <code>Service</code> resource. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, <code>route</code>, or <code>ingress</code> type listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-EphemeralStorage-reference"><a class="link" href="#type-EphemeralStorage-reference">8.2.15. <code>EphemeralStorage</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>EphemeralStorage</code> type from <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>ephemeral</code> for the type <code>EphemeralStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLimit</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>When type=ephemeral, defines the total amount of local storage required for this EmptyDir volume (for example 1Gi).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>ephemeral</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-PersistentClaimStorage-reference"><a class="link" href="#type-PersistentClaimStorage-reference">8.2.16. <code>PersistentClaimStorage</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>PersistentClaimStorage</code> type from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>.
It must have the value <code>persistent-claim</code> for the type <code>PersistentClaimStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>persistent-claim</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>When type=persistent-claim, defines the size of the persistent volume claim (i.e 1Gi). Mandatory when type=persistent-claim.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies a specific persistent volume to use. It contains key:value pairs representing labels for selecting such a volume.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies if the persistent volume claim has to be deleted when the cluster is un-deployed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The storage class to use for dynamic volume allocation.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Overrides for individual brokers. The <code>overrides</code> field allows to specify a different configuration for different brokers.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PersistentClaimStorageOverride-reference"><code>PersistentClaimStorageOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-PersistentClaimStorageOverride-reference"><a class="link" href="#type-PersistentClaimStorageOverride-reference">8.2.17. <code>PersistentClaimStorageOverride</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The storage class to use for dynamic volume allocation for this broker.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Id of the kafka broker (broker identifier).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JbodStorage-reference"><a class="link" href="#type-JbodStorage-reference">8.2.18. <code>JbodStorage</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>JbodStorage</code> type from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>jbod</code> for the type <code>JbodStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>jbod</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of volumes as Storage objects representing the JBOD disks array.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaAuthorizationSimple-reference"><a class="link" href="#type-KafkaAuthorizationSimple-reference">8.2.19. <code>KafkaAuthorizationSimple</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaAuthorizationSimple-schema-reference">Full list of <code>KafkaAuthorizationSimple</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Simple authorization in Strimzi uses the <code>AclAuthorizer</code> plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.
ACLs allow you to define which users have access to which resources at a granular level.</p>
</div>
<div class="paragraph">
<p>Configure the <code>Kafka</code> custom resource to use simple authorization.
Set the <code>type</code> property in the <code>authorization</code> section to the value <code>simple</code>,
and configure a list of super users.</p>
</div>
<div class="paragraph">
<p>Access rules are configured for the <code>KafkaUser</code>, as described in the <a href="#type-AclRule-reference">ACLRule schema reference</a>.</p>
</div>
<div class="sect4">
<h5 id="property-simple-authorization-superusers-reference"><a class="link" href="#property-simple-authorization-superusers-reference"><code>superUsers</code></a></h5>
<div class="paragraph">
<p>A list of user principals treated as super users, so that they are always allowed without querying ACL rules.</p>
</div>
<div class="listingblock">
<div class="title">An example of simple authorization configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
  namespace: myproject
spec:
  kafka:
    # ...
    authorization:
      type: simple
      superUsers:
        - CN=client_1
        - user_2
        - CN=client_3
    # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>super.user</code> configuration option in the <code>config</code> property in <code>Kafka.spec.kafka</code> is ignored.
Designate super users in the <code>authorization</code> property instead.
For more information, see <a href="#type-KafkaClusterSpec-reference">Kafka broker configuration</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaAuthorizationSimple-schema-reference"><a class="link" href="#type-KafkaAuthorizationSimple-schema-reference"><code>KafkaAuthorizationSimple</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaAuthorizationSimple</code> type from <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>, <a href="#type-KafkaAuthorizationCustom-reference"><code>KafkaAuthorizationCustom</code></a>.
It must have the value <code>simple</code> for the type <code>KafkaAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>simple</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of super users. Should contain list of user principals which should get unlimited access rights.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaAuthorizationOpa-reference"><a class="link" href="#type-KafkaAuthorizationOpa-reference">8.2.20. <code>KafkaAuthorizationOpa</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaAuthorizationOpa-schema-reference">Full list of <code>KafkaAuthorizationOpa</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To use <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener">Open Policy Agent</a> authorization, set the <code>type</code> property in the <code>authorization</code> section to the value <code>opa</code>,
and configure OPA properties as required.
Strimzi uses Open Policy Agent plugin for Kafka authorization as the authorizer.
For more information about the format of the input data and policy examples, see <a href="https://github.com/anderseknert/opa-kafka-plugin" target="_blank" rel="noopener">Open Policy Agent plugin for Kafka authorization</a>.</p>
</div>
<div class="sect4">
<h5 id="url"><a class="link" href="#url"><code>url</code></a></h5>
<div class="paragraph">
<p>The URL used to connect to the Open Policy Agent server.
The URL has to include the policy which will be queried by the authorizer.
<strong>Required.</strong></p>
</div>
</div>
<div class="sect4">
<h5 id="allowonerror"><a class="link" href="#allowonerror"><code>allowOnError</code></a></h5>
<div class="paragraph">
<p>Defines whether a Kafka client should be allowed or denied by default when the authorizer fails to query the Open Policy Agent, for example, when it is temporarily unavailable.
Defaults to <code>false</code> - all actions will be denied.</p>
</div>
</div>
<div class="sect4">
<h5 id="initialcachecapacity"><a class="link" href="#initialcachecapacity"><code>initialCacheCapacity</code></a></h5>
<div class="paragraph">
<p>Initial capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request.
Defaults to <code>5000</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="maximumcachesize"><a class="link" href="#maximumcachesize"><code>maximumCacheSize</code></a></h5>
<div class="paragraph">
<p>Maximum capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request.
Defaults to <code>50000</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="expireafterms"><a class="link" href="#expireafterms"><code>expireAfterMs</code></a></h5>
<div class="paragraph">
<p>The expiration of the records kept in the local cache to avoid querying the Open Policy Agent for every request.
Defines how often the cached authorization decisions are reloaded from the Open Policy Agent server.
In milliseconds.
Defaults to <code>3600000</code> milliseconds (1 hour).</p>
</div>
</div>
<div class="sect4">
<h5 id="tlstrustedcertificates"><a class="link" href="#tlstrustedcertificates"><code>tlsTrustedCertificates</code></a></h5>
<div class="paragraph">
<p>Trusted certificates for TLS connection to the OPA server.</p>
</div>
</div>
<div class="sect4">
<h5 id="superusers"><a class="link" href="#superusers"><code>superUsers</code></a></h5>
<div class="paragraph">
<p>A list of user principals treated as super users, so that they are always allowed without querying the open Policy Agent policy.</p>
</div>
<div class="listingblock">
<div class="title">An example of Open Policy Agent authorizer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
  namespace: myproject
spec:
  kafka:
    # ...
    authorization:
      type: opa
      url: http://opa:8181/v1/data/kafka/allow
      allowOnError: false
      initialCacheCapacity: 1000
      maximumCacheSize: 10000
      expireAfterMs: 60000
      superUsers:
        - CN=fred
        - sam
        - CN=edward
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaAuthorizationOpa-schema-reference"><a class="link" href="#type-KafkaAuthorizationOpa-schema-reference"><code>KafkaAuthorizationOpa</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaAuthorizationOpa</code> type from <a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>, <a href="#type-KafkaAuthorizationCustom-reference"><code>KafkaAuthorizationCustom</code></a>.
It must have the value <code>opa</code> for the type <code>KafkaAuthorizationOpa</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>opa</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The URL used to connect to the Open Policy Agent server. The URL has to include the policy which will be queried by the authorizer. This option is required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowOnError</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Defines whether a Kafka client should be allowed or denied by default when the authorizer fails to query the Open Policy Agent, for example, when it is temporarily unavailable). Defaults to <code>false</code> - all actions will be denied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialCacheCapacity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Initial capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request Defaults to <code>5000</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximumCacheSize</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maximum capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request. Defaults to <code>50000</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expireAfterMs</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The expiration of the records kept in the local cache to avoid querying the Open Policy Agent for every request. Defines how often the cached authorization decisions are reloaded from the Open Policy Agent server. In milliseconds. Defaults to <code>3600000</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Trusted certificates for TLS connection to the OPA server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of super users, which is specifically a list of user principals that have unlimited access rights.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Defines whether the Open Policy Agent authorizer plugin should provide metrics. Defaults to <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaAuthorizationKeycloak-reference"><a class="link" href="#type-KafkaAuthorizationKeycloak-reference">8.2.21. <code>KafkaAuthorizationKeycloak</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaAuthorizationKeycloak</code> type from <a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationCustom-reference"><code>KafkaAuthorizationCustom</code></a>.
It must have the value <code>keycloak</code> for the type <code>KafkaAuthorizationKeycloak</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>keycloak</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>OAuth Client ID which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authorization server token endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Trusted certificates for TLS connection to the OAuth server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable TLS hostname verification. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegateToKafkaAcls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether authorization decision should be delegated to the 'Simple' authorizer if DENIED by Keycloak Authorization Services policies. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grantsRefreshPeriodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The time between two consecutive grants refresh runs in seconds. The default value is 60.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grantsRefreshPoolSize</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of threads to use to refresh grants for active sessions. The more threads, the more parallelism, so the sooner the job completes. However, using more threads places a heavier load on the authorization server. The default value is 5.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of super users. Should contain list of user principals which should get unlimited access rights.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The connect timeout in seconds when connecting to authorization server. If not set, the effective connect timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The read timeout in seconds when connecting to authorization server. If not set, the effective read timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable OAuth metrics. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaAuthorizationCustom-reference"><a class="link" href="#type-KafkaAuthorizationCustom-reference">8.2.22. <code>KafkaAuthorizationCustom</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaAuthorizationCustom-schema-reference">Full list of <code>KafkaAuthorizationCustom</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To use custom authorization in Strimzi, you can configure your own <code>Authorizer</code> plugin to define Access Control Lists (ACLs).</p>
</div>
<div class="paragraph">
<p>ACLs allow you to define which users have access to which resources at a granular level.</p>
</div>
<div class="paragraph">
<p>Configure the <code>Kafka</code> custom resource to use custom authorization.
Set the <code>type</code> property in the <code>authorization</code> section to the value <code>custom</code>,
and the set following properties.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The custom authorizer must implement the <code>org.apache.kafka.server.authorizer.Authorizer</code> interface, and support configuration of <code>super.users</code> using the super.users configuration property.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="property-custom-authorization-authorizerclass-reference"><a class="link" href="#property-custom-authorization-authorizerclass-reference"><code>authorizerClass</code></a></h5>
<div class="paragraph">
<p>(Required) Java class that implements the <code>org.apache.kafka.server.authorizer.Authorizer</code> interface to support custom ACLs.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-custom-authorization-superusers-reference"><a class="link" href="#property-custom-authorization-superusers-reference"><code>superUsers</code></a></h5>
<div class="paragraph">
<p>A list of user principals treated as super users, so that they are always allowed without querying ACL rules.</p>
</div>
<div class="paragraph">
<p>You can add configuration for initializing the custom authorizer using <code>Kafka.spec.kafka.config</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of custom authorization configuration under <code>Kafka.spec</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
  namespace: myproject
spec:
  kafka:
    # ...
    authorization:
      type: custom
      authorizerClass: io.mycompany.CustomAuthorizer
      superUsers:
        - CN=client_1
        - user_2
        - CN=client_3
    # ...
    config:
      authorization.custom.property1=value1
      authorization.custom.property2=value2
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the <code>Kafka</code> custom resource configuration, the JAR file containing the custom authorizer class along with its dependencies must be available on the classpath of the Kafka broker.</p>
</div>
<div class="paragraph">
<p>The Strimzi Maven build process provides a mechanism to add custom third-party libraries to the generated Kafka broker container image by adding them as dependencies in the <code>pom.xml</code> file under the <code>docker-images/kafka/kafka-thirdparty-libs</code> directory. The directory contains different folders for different Kafka versions. Choose the appropriate folder. Before modifying the <code>pom.xml</code> file, the third-party library must be available in a Maven repository, and that Maven repository must be accessible to the Strimzi build process.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>super.user</code> configuration option in the <code>config</code> property in <code>Kafka.spec.kafka</code> is ignored.
Designate super users in the <code>authorization</code> property instead.
For more information, see <a href="#type-KafkaClusterSpec-reference">Kafka broker configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Custom authorization can make use of group membership information extracted from the JWT token during authentication when using <code>oauth</code> authentication and configuring <code>groupsClaim</code> configuration attribute. Groups are available on the <code>OAuthKafkaPrincipal</code> object during authorize() call as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    public List&lt;AuthorizationResult&gt; authorize(AuthorizableRequestContext requestContext, List&lt;Action&gt; actions) {

        KafkaPrincipal principal = requestContext.principal();
        if (principal instanceof OAuthKafkaPrincipal) {
            OAuthKafkaPrincipal p = (OAuthKafkaPrincipal) principal;

            for (String group: p.getGroups()) {
                System.out.println("Group: " + group);
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaAuthorizationCustom-schema-reference"><a class="link" href="#type-KafkaAuthorizationCustom-schema-reference"><code>KafkaAuthorizationCustom</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaAuthorizationCustom</code> type from <a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>.
It must have the value <code>custom</code> for the type <code>KafkaAuthorizationCustom</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>custom</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorizerClass</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authorization implementation class, which must be available in classpath.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of super users, which are user principals with unlimited access rights.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">supportsAdminApi</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Indicates whether the custom authorizer supports the APIs for managing ACLs using the Kafka Admin API. Defaults to <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-Rack-reference"><a class="link" href="#type-Rack-reference">8.2.23. <code>Rack</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-Rack-schema-reference">Full list of <code>Rack</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>The <code>rack</code> option configures rack awareness.
A <em>rack</em> can represent an availability zone, data center, or an actual rack in your data center.
The <em>rack</em> is configured through a <code>topologyKey</code>.
<code>topologyKey</code> identifies a label on Kubernetes nodes that contains the name of the topology in its value.
An example of such a label is <code>topology.kubernetes.io/zone</code> (or <code>failure-domain.beta.kubernetes.io/zone</code> on older Kubernetes versions), which contains the name of the availability zone in which the Kubernetes node runs.
You can configure your Kafka cluster to be aware of the <em>rack</em> in which it runs, and enable additional features such as spreading partition replicas across different racks or consuming messages from the closest replicas.</p>
</div>
<div class="paragraph">
<p>For more information about Kubernetes node labels, see <a href="https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints/" target="_blank" rel="noopener">Well-Known Labels, Annotations and Taints</a>.
Consult your Kubernetes administrator regarding the node label that represents the zone or rack into which the node is deployed.</p>
</div>
<div class="sect4">
<h5 id="spreading_partition_replicas_across_racks"><a class="link" href="#spreading_partition_replicas_across_racks">Spreading partition replicas across racks</a></h5>
<div class="paragraph">
<p>When rack awareness is configured, Strimzi will set <code>broker.rack</code> configuration for each Kafka broker.
The <code>broker.rack</code> configuration assigns a rack ID to each broker.
When <code>broker.rack</code> is configured, Kafka brokers will spread partition replicas across as many different racks as possible.
When replicas are spread across multiple racks, the probability that multiple replicas will fail at the same time is lower than if they would be in the same rack.
Spreading replicas improves resiliency, and is important for availability and reliability.
To enable rack awareness in Kafka, add the <code>rack</code> option to the <code>.spec.kafka</code> section of the <code>Kafka</code> custom resource as shown in the example below.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>rack</code> configuration for Kafka</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    rack:
      topologyKey: topology.kubernetes.io/zone
    # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <em>rack</em> in which brokers are running can change in some cases when the pods are deleted or restarted.
As a result, the replicas running in different racks might then share the same rack.
Use Cruise Control and the <code>KafkaRebalance</code> resource with the <code>RackAwareGoal</code> to make sure that replicas remain distributed across different racks.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When rack awareness is enabled in the <code>Kafka</code> custom resource, Strimzi will automatically add the Kubernetes <code>preferredDuringSchedulingIgnoredDuringExecution</code> affinity rule to distribute the Kafka brokers across the different racks.
However, the <em>preferred</em> rule does not guarantee that the brokers will be spread.
Depending on your exact Kubernetes and Kafka configurations, you should add additional <code>affinity</code> rules or configure <code>topologySpreadConstraints</code> for both ZooKeeper and Kafka to make sure the nodes are properly distributed accross as many racks as possible.
For more information see <a href="#assembly-scheduling-str">Configuring pod scheduling</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="consuming_messages_from_the_closest_replicas"><a class="link" href="#consuming_messages_from_the_closest_replicas">Consuming messages from the closest replicas</a></h5>
<div class="paragraph">
<p>Rack awareness can also be used in consumers to fetch data from the closest replica.
This is useful for reducing the load on your network when a Kafka cluster spans multiple datacenters and can also reduce costs when running Kafka in public clouds.
However, it can lead to increased latency.</p>
</div>
<div class="paragraph">
<p>In order to be able to consume from the closest replica, rack awareness has to be configured in the Kafka cluster, and the <code>RackAwareReplicaSelector</code> has to be enabled.
The replica selector plugin provides the logic that enables clients to consume from the nearest replica.
The default implementation uses <code>LeaderSelector</code> to always select the leader replica for the client.
Specify <code>RackAwareReplicaSelector</code> for the <code>replica.selector.class</code> to switch from the default implementation.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>rack</code> configuration with enabled replica-aware selector</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    rack:
      topologyKey: topology.kubernetes.io/zone
    config:
      # ...
      replica.selector.class: org.apache.kafka.common.replica.RackAwareReplicaSelector
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to the Kafka broker configuration, you also need to specify the <code>client.rack</code> option in your consumers.
The <code>client.rack</code> option should specify the <em>rack ID</em> in which the consumer is running.
<code>RackAwareReplicaSelector</code> associates matching <code>broker.rack</code> and <code>client.rack</code> IDs, to find the nearest replica and consume from it.
If there are multiple replicas in the same rack, <code>RackAwareReplicaSelector</code> always selects the most up-to-date replica.
If the rack ID is not specified, or if it cannot find a replica with the same rack ID, it will fall back to the leader replica.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rack-config-availability-zones.png" alt="consuming from replicas in the same availability zone">
</div>
<div class="title">Figure 4. Example showing client consuming from replicas in the same availability zone</div>
</div>
<div class="paragraph">
<p>You can also configure Kafka Connect, MirrorMaker 2.0 and Kafka Bridge so that connectors consume messages from the closest replicas.
You enable rack awareness in the <code>KafkaConnect</code>, <code>KafkaMirrorMaker2</code>, and <code>KafkaBridge</code> custom resources.
The configuration does does not set affinity rules, but you can also configure <code>affinity</code> or <code>topologySpreadConstraints</code>.
For more information see <a href="#assembly-scheduling-str">Configuring pod scheduling</a>.</p>
</div>
<div class="paragraph">
<p>When deploying Kafka Connect using Strimzi, you can use the <code>rack</code> section in the <code>KafkaConnect</code> custom resource to automatically configure the <code>client.rack</code> option.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>rack</code> configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
# ...
spec:
  # ...
  rack:
    topologyKey: topology.kubernetes.io/zone
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying MirrorMaker 2 using Strimzi, you can use the <code>rack</code> section in the <code>KafkaMirrorMaker2</code> custom resource to automatically configure the <code>client.rack</code> option.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>rack</code> configuration for MirrorMaker 2.0</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
# ...
spec:
  # ...
  rack:
    topologyKey: topology.kubernetes.io/zone
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying Kafka Bridge using Strimzi, you can use the <code>rack</code> section in the <code>KafkaBridge</code> custom resource to automatically configure the <code>client.rack</code> option.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>rack</code> configuration for Kafka Bridge</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
# ...
spec:
  # ...
  rack:
    topologyKey: topology.kubernetes.io/zone
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-Rack-schema-reference"><a class="link" href="#type-Rack-schema-reference"><code>Rack</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topologyKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A key that matches labels assigned to the Kubernetes cluster nodes. The value of the label is used to set a broker&#8217;s <code>broker.rack</code> config, and the <code>client.rack</code> config for Kafka Connect or MirrorMaker 2.0.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-Probe-reference"><a class="link" href="#type-Probe-reference">8.2.24. <code>Probe</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Minimum consecutive failures for the probe to be considered failed after having succeeded. Defaults to 3. Minimum value is 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialDelaySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The initial delay before first the health is first checked. Default to 15 seconds. Minimum value is 0.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">periodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The timeout for each attempted health check. Default to 5 seconds. Minimum value is 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JvmOptions-reference"><a class="link" href="#type-JvmOptions-reference">8.2.25. <code>JvmOptions</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A map of -XX options to the JVM.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xms</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>-Xms option to to the JVM.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xmx</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>-Xmx option to to the JVM.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcLoggingEnabled</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies whether the Garbage Collection logging is enabled. The default is false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaSystemProperties</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A map of additional system properties which will be passed using the <code>-D</code> option to the JVM.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-SystemProperty-reference"><code>SystemProperty</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-SystemProperty-reference"><a class="link" href="#type-SystemProperty-reference">8.2.26. <code>SystemProperty</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The system property name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The system property value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaJmxOptions-reference"><a class="link" href="#type-KafkaJmxOptions-reference">8.2.27. <code>KafkaJmxOptions</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaJmxOptions-schema-reference">Full list of <code>KafkaJmxOptions</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures JMX connection options.</p>
</div>
<div class="paragraph">
<p>Get JMX metrics from Kafka brokers, ZooKeeper nodes, Kafka Connect, and MirrorMaker 2.0. by connecting to port 9999.
Use the <code>jmxOptions</code> property to configure a password-protected or an unprotected JMX port.
Using password protection prevents unauthorized pods from accessing the port.</p>
</div>
<div class="paragraph">
<p>You can then obtain metrics about the component.</p>
</div>
<div class="paragraph">
<p>For example, for each Kafka broker you can obtain bytes-per-second usage data from clients,
or the request rate of the network of the broker.</p>
</div>
<div class="paragraph">
<p>To enable security for the JMX port, set the <code>type</code> parameter in the <code>authentication</code> field to <code>password</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example password-protected JMX configuration for Kafka brokers and ZooKeeper nodes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jmxOptions:
      authentication:
        type: "password"
    # ...
  zookeeper:
    # ...
    jmxOptions:
      authentication:
        type: "password"
    #...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then deploy a pod into a cluster and obtain JMX metrics using the headless
service by specifying which broker you want to address.</p>
</div>
<div class="paragraph">
<p>For example, to get JMX metrics from broker <em>0</em> you specify:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">"<em>CLUSTER-NAME</em>-kafka-0.<em>CLUSTER-NAME</em>-kafka-brokers"</code></pre>
</div>
</div>
<div class="paragraph">
<p><code><em>CLUSTER-NAME</em>-kafka-0</code> is name of the broker pod, and <code><em>CLUSTER-NAME</em>-kafka-brokers</code> is the name of the headless service to return the IPs of the broker pods.</p>
</div>
<div class="paragraph">
<p>If the JMX port is secured, you can get the username and password by referencing them from the JMX Secret in the
deployment of your pod.</p>
</div>
<div class="paragraph">
<p>For an unprotected JMX port, use an empty object <code>{}</code> to open the JMX port on the headless service.
You deploy a pod and obtain metrics in the same way as for the protected port, but in this case any pod can read from the JMX port.</p>
</div>
<div class="listingblock">
<div class="title">Example open port JMX configuration for Kafka brokers and ZooKeeper nodes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jmxOptions: {}
    # ...
  zookeeper:
    # ...
    jmxOptions: {}
    # ...</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on the Kafka component metrics exposed using JMX, see the <a href="https://kafka.apache.org/documentation/" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="type-KafkaJmxOptions-schema-reference"><a class="link" href="#type-KafkaJmxOptions-schema-reference"><code>KafkaJmxOptions</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for connecting to the JMX port. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [password].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxAuthenticationPassword-reference"><code>KafkaJmxAuthenticationPassword</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaJmxAuthenticationPassword-reference"><a class="link" href="#type-KafkaJmxAuthenticationPassword-reference">8.2.28. <code>KafkaJmxAuthenticationPassword</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaJmxAuthenticationPassword</code> type from other subtypes which may be added in the future.
It must have the value <code>password</code> for the type <code>KafkaJmxAuthenticationPassword</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>password</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JmxPrometheusExporterMetrics-reference"><a class="link" href="#type-JmxPrometheusExporterMetrics-reference">8.2.29. <code>JmxPrometheusExporterMetrics</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>JmxPrometheusExporterMetrics</code> type from other subtypes which may be added in the future.
It must have the value <code>jmxPrometheusExporter</code> for the type <code>JmxPrometheusExporterMetrics</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>jmxPrometheusExporter</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>ConfigMap entry where the Prometheus JMX Exporter configuration is stored. For details of the structure of this configuration, see the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX Exporter</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationReference-reference"><code>ExternalConfigurationReference</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ExternalConfigurationReference-reference"><a class="link" href="#type-ExternalConfigurationReference-reference">8.2.30. <code>ExternalConfigurationReference</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a>, <a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMapKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the key in the ConfigMap containing the configuration. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapkeyselector-v1-core">external documentation for core/v1 configmapkeyselector</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapkeyselector-v1-core">ConfigMapKeySelector</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-InlineLogging-reference"><a class="link" href="#type-InlineLogging-reference">8.2.31. <code>InlineLogging</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>InlineLogging</code> type from <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a>.
It must have the value <code>inline</code> for the type <code>InlineLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>inline</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A Map from logger name to logger level.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ExternalLogging-reference"><a class="link" href="#type-ExternalLogging-reference">8.2.32. <code>ExternalLogging</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>ExternalLogging</code> type from <a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>.
It must have the value <code>external</code> for the type <code>ExternalLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>external</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>ConfigMap</code> entry where the logging configuration is stored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationReference-reference"><code>ExternalConfigurationReference</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaClusterTemplate-reference"><a class="link" href="#type-KafkaClusterTemplate-reference">8.2.33. <code>KafkaClusterTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka <code>StatefulSet</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka bootstrap <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokersService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka broker <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka external bootstrap <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka per-pod <code>Services</code> used for access from outside of Kubernetes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka external bootstrap <code>Route</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka per-pod <code>Routes</code> used for access from outside of OpenShift.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka external bootstrap <code>Ingress</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka per-pod <code>Ingress</code> used for access from outside of Kubernetes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for all Kafka <code>PersistentVolumeClaims</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka broker container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka init container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterCaCert</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Secret with Kafka Cluster certificate public key.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Secret of the Kafka Cluster JMX authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterRoleBinding</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka ClusterRoleBinding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podSet</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka <code>StrimziPodSet</code> resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-StatefulSetTemplate-reference"><a class="link" href="#type-StatefulSetTemplate-reference">8.2.34. <code>StatefulSetTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata applied to the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podManagementPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>PodManagementPolicy which will be used for this StatefulSet. Valid values are <code>Parallel</code> and <code>OrderedReady</code>. Defaults to <code>Parallel</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [OrderedReady, Parallel])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-MetadataTemplate-reference"><a class="link" href="#type-MetadataTemplate-reference">8.2.35. <code>MetadataTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-BuildConfigTemplate-reference"><code>BuildConfigTemplate</code></a>, <a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a>, <a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a>, <a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a>, <a href="#type-PodTemplate-reference"><code>PodTemplate</code></a>, <a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a>, <a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-MetadataTemplate-schema-reference">Full list of <code>MetadataTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p><code>Labels</code> and <code>Annotations</code> are used to identify and organize resources, and are configured in the <code>metadata</code> property.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
template:
  pod:
    metadata:
      labels:
        label1: value1
        label2: value2
      annotations:
        annotation1: value1
        annotation2: value2
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>labels</code> and <code>annotations</code> fields can contain any labels or annotations that do not contain the reserved string <code>strimzi.io</code>.
Labels and annotations containing <code>strimzi.io</code> are used internally by Strimzi and cannot be configured.</p>
</div>
<div class="sect4">
<h5 id="type-MetadataTemplate-schema-reference"><a class="link" href="#type-MetadataTemplate-schema-reference"><code>MetadataTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Labels added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Annotations added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-PodTemplate-reference"><a class="link" href="#type-PodTemplate-reference">8.2.36. <code>PodTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-PodTemplate-schema-reference">Full list of <code>PodTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures the template for Kafka pods.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>PodTemplate</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
template:
  pod:
    metadata:
      labels:
        label1: value1
      annotations:
        anno1: value1
    imagePullSecrets:
      - name: my-docker-credentials
    securityContext:
      runAsUser: 1000001
      fsGroup: 0
    terminationGracePeriodSeconds: 120
# ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="property-hostaliases-config-reference"><a class="link" href="#property-hostaliases-config-reference"><code>hostAliases</code></a></h5>
<div class="paragraph">
<p>Use the <code>hostAliases</code> property to a specify a list of hosts and IP addresses,
which are injected into the <code>/etc/hosts</code> file of the pod.</p>
</div>
<div class="paragraph">
<p>This configuration is especially useful for Kafka Connect or MirrorMaker when a connection outside of the cluster is also requested by users.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>hostAliases</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
#...
spec:
  # ...
  template:
    pod:
      hostAliases:
      - ip: "192.168.1.86"
        hostnames:
        - "my-host-1"
        - "my-host-2"
      #...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-PodTemplate-schema-reference"><a class="link" href="#type-PodTemplate-schema-reference"><code>PodTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata applied to the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullSecrets</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of references to secrets in the same namespace to use for pulling any of the images used by this Pod. When the <code>STRIMZI_IMAGE_PULL_SECRETS</code> environment variable in Cluster Operator and the <code>imagePullSecrets</code> option are specified, only the <code>imagePullSecrets</code> variable is used and the <code>STRIMZI_IMAGE_PULL_SECRETS</code> variable is ignored. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#localobjectreference-v1-core">external documentation for core/v1 localobjectreference</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#localobjectreference-v1-core">LocalObjectReference</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityContext</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures pod-level security attributes and common container settings. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core">external documentation for core/v1 podsecuritycontext</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core">PodSecurityContext</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminationGracePeriodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The grace period is the duration in seconds after the processes running in the pod are sent a termination signal, and the time when the processes are forcibly halted with a kill signal. Set this value to longer than the expected cleanup time for your process. Value must be a non-negative integer. A zero value indicates delete immediately. You might need to increase the grace period for very large Kafka clusters, so that the Kafka brokers have enough time to transfer their work to another broker before they are terminated. Defaults to 30 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The pod&#8217;s affinity rules. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#affinity-v1-core">external documentation for core/v1 affinity</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The pod&#8217;s tolerations. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#toleration-v1-core">external documentation for core/v1 toleration</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priorityClassName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the priority class used to assign priority to the pods. For more information about priority classes, see <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption" target="_blank" rel="noopener">Pod Priority and Preemption</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schedulerName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the scheduler used to dispatch this <code>Pod</code>. If not specified, the default scheduler will be used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hostAliases</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The pod&#8217;s HostAliases. HostAliases is an optional list of hosts and IPs that will be injected into the Pod&#8217;s hosts file if specified. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#hostalias-v1-core">external documentation for core/v1 hostalias</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#hostalias-v1-core">HostAlias</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tmpDirSizeLimit</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Defines the total amount (for example <code>1Gi</code>) of local storage required for temporary EmptyDir volume (<code>/tmp</code>). Default value is <code>5Mi</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableServiceLinks</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Indicates whether information about services should be injected into Pod&#8217;s environment variables.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topologySpreadConstraints</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The pod&#8217;s topology spread constraints. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#topologyspreadconstraint-v1-core">external documentation for core/v1 topologyspreadconstraint</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#topologyspreadconstraint-v1-core">TopologySpreadConstraint</a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-InternalServiceTemplate-reference"><a class="link" href="#type-InternalServiceTemplate-reference">8.2.37. <code>InternalServiceTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata applied to the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipFamilyPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the IP Family Policy used by the service. Available options are <code>SingleStack</code>, <code>PreferDualStack</code> and <code>RequireDualStack</code>. <code>SingleStack</code> is for a single IP family. <code>PreferDualStack</code> is for two IP families on dual-stack configured clusters or a single IP family on single-stack clusters. <code>RequireDualStack</code> fails unless there are two IP families on dual-stack configured clusters. If unspecified, Kubernetes will choose the default value based on the service type. Available on Kubernetes 1.20 and newer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [RequireDualStack, SingleStack, PreferDualStack])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipFamilies</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the IP Families used by the service. Available options are <code>IPv4</code> and <code>IPv6. If unspecified, Kubernetes will choose the default value based on the `ipFamilyPolicy</code> setting. Available on Kubernetes 1.20 and newer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one or more of [IPv6, IPv4]) array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ResourceTemplate-reference"><a class="link" href="#type-ResourceTemplate-reference">8.2.38. <code>ResourceTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata applied to the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-PodDisruptionBudgetTemplate-reference"><a class="link" href="#type-PodDisruptionBudgetTemplate-reference">8.2.39. <code>PodDisruptionBudgetTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-PodDisruptionBudgetTemplate-schema-reference">Full list of <code>PodDisruptionBudgetTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Strimzi creates a <code>PodDisruptionBudget</code> for every new <code>StatefulSet</code> or <code>Deployment</code>.
By default, pod disruption budgets only allow a single pod to be unavailable at a given time.
You can increase the amount of unavailable pods allowed by changing the default value of the <code>maxUnavailable</code> property.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>PodDisruptionBudget</code> template</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
template:
  podDisruptionBudget:
    metadata:
      labels:
        key1: label1
        key2: label2
      annotations:
        key1: label1
        key2: label2
    maxUnavailable: 1
# ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-PodDisruptionBudgetTemplate-schema-reference"><a class="link" href="#type-PodDisruptionBudgetTemplate-schema-reference"><code>PodDisruptionBudgetTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata to apply to the <code>PodDisruptionBudgetTemplate</code> resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxUnavailable</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maximum number of unavailable pods to allow automatic Pod eviction. A Pod eviction is allowed when the <code>maxUnavailable</code> number of pods or fewer are unavailable after the eviction. Setting this value to 0 prevents all voluntary evictions, so the pods must be evicted manually. Defaults to 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-ContainerTemplate-reference"><a class="link" href="#type-ContainerTemplate-reference">8.2.40. <code>ContainerTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-ContainerTemplate-schema-reference">Full list of <code>ContainerTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>You can set custom security context and environment variables for a container.</p>
</div>
<div class="paragraph">
<p>The environment variables are defined under the <code>env</code> property as a list of objects with <code>name</code> and <code>value</code> fields.
The following example shows two custom environment variables and a custom security context set for the Kafka broker containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
template:
  kafkaContainer:
    env:
    - name: EXAMPLE_ENV_1
      value: example.env.one
    - name: EXAMPLE_ENV_2
      value: example.env.two
    securityContext:
      runAsUser: 2000
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment variables prefixed with <code>KAFKA_</code> are internal to Strimzi and should be avoided.
If you set a custom environment variable that is already in use by Strimzi, it is ignored and a warning is recorded in the log.</p>
</div>
<div class="sect4">
<h5 id="type-ContainerTemplate-schema-reference"><a class="link" href="#type-ContainerTemplate-schema-reference"><code>ContainerTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Environment variables which should be applied to the container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerEnvVar-reference"><code>ContainerEnvVar</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityContext</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Security context for the container. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core">external documentation for core/v1 securitycontext</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core">SecurityContext</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-ContainerEnvVar-reference"><a class="link" href="#type-ContainerEnvVar-reference">8.2.41. <code>ContainerEnvVar</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The environment variable key.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The environment variable value.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ZookeeperClusterSpec-reference"><a class="link" href="#type-ZookeeperClusterSpec-reference">8.2.42. <code>ZookeeperClusterSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-ZookeeperClusterSpec-schema-reference">Full list of <code>ZookeeperClusterSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a ZooKeeper cluster.</p>
</div>
<div class="sect4">
<h5 id="property-zookeeper-config-reference"><a class="link" href="#property-zookeeper-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure ZooKeeper options as keys.</p>
</div>
<div class="paragraph">
<p>Standard Apache ZooKeeper configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Configuration of data directories</p>
</li>
<li>
<p>ZooKeeper cluster composition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://zookeeper.apache.org/doc/r3.6.3/" target="_blank" rel="noopener">ZooKeeper documentation</a> with the exception of those managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server.</code></p>
</li>
<li>
<p><code>dataDir</code></p>
</li>
<li>
<p><code>dataLogDir</code></p>
</li>
<li>
<p><code>clientPort</code></p>
</li>
<li>
<p><code>authProvider</code></p>
</li>
<li>
<p><code>quorum.auth</code></p>
</li>
<li>
<p><code>requireClientAuthScheme</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other supported options are passed to ZooKeeper.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example ZooKeeper configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    config:
      autopurge.snapRetainCount: 3
      autopurge.purgeInterval: 1
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-zookeeper-logging-reference"><a class="link" href="#property-zookeeper-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>ZooKeeper has a configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zookeeper.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ZooKeeper uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # ...
  zookeeper:
    # ...
    logging:
      type: inline
      loggers:
        zookeeper.root.logger: "INFO"
    # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
spec:
  # ...
  zookeeper:
    # ...
    logging:
      type: external
      valueFrom:
        configMapKeyRef:
          name: customConfigMap
          key: zookeeper-log4j.properties
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-ZookeeperClusterSpec-schema-reference"><a class="link" href="#type-ZookeeperClusterSpec-schema-reference"><code>ZookeeperClusterSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The ZooKeeper broker config. Properties with the following prefixes cannot be set: server., dataDir, dataLogDir, clientPort, authProvider, quorum.auth, requireClientAuthScheme, snapshot.trust.empty, standaloneEnabled, reconfigEnabled, 4lw.commands.whitelist, secureClientPort, ssl., serverCnxnFactory, sslQuorum (with the exception of: ssl.protocol, ssl.quorum.protocol, ssl.enabledProtocols, ssl.quorum.enabledProtocols, ssl.ciphersuites, ssl.quorum.ciphersuites, ssl.hostnameVerification, ssl.quorum.hostnameVerification).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JMX Options for Zookeeper nodes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for ZooKeeper. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper cluster resources. The template allows users to specify how the <code>StatefulSet</code>, <code>Pods</code>, and <code>Services</code> are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-ZookeeperClusterTemplate-reference"><a class="link" href="#type-ZookeeperClusterTemplate-reference">8.2.43. <code>ZookeeperClusterTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper <code>StatefulSet</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper client <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodesService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper nodes <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for all ZooKeeper <code>PersistentVolumeClaims</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the ZooKeeper container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the ZooKeeper service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Secret of the Zookeeper Cluster JMX authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podSet</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for ZooKeeper <code>StrimziPodSet</code> resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-EntityOperatorSpec-reference"><a class="link" href="#type-EntityOperatorSpec-reference">8.2.44. <code>EntityOperatorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the Topic Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the User Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS sidecar configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Entity Operator resources. The template allows users to specify how a <code>Deployment</code> and <code>Pod</code> is generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-EntityTopicOperatorSpec-reference"><a class="link" href="#type-EntityTopicOperatorSpec-reference">8.2.45. <code>EntityTopicOperatorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-EntityTopicOperatorSpec-schema-reference">Full list of <code>EntityTopicOperatorSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures the Topic Operator.</p>
</div>
<div class="sect4">
<h5 id="property-topic-operator-logging-reference"><a class="link" href="#property-topic-operator-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>The Topic Operator has a configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Topic Operator uses the Apache <code>log4j2</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property in the <code>entityOperator.topicOperator</code> field of the Kafka resource <code>Kafka</code> resource to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j2.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: external
        valueFrom:
          configMapKeyRef:
            name: customConfigMap
            key: topic-operator-log4j2.properties
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-EntityTopicOperatorSpec-schema-reference"><a class="link" href="#type-EntityTopicOperatorSpec-schema-reference"><code>EntityTopicOperatorSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The namespace the Topic Operator should watch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image to use for the Topic Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Interval between periodic reconciliations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Timeout for the ZooKeeper session.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startupProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod startup checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicMetadataMaxAttempts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of attempts at getting topic metadata.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-EntityUserOperatorSpec-reference"><a class="link" href="#type-EntityUserOperatorSpec-reference">8.2.46. <code>EntityUserOperatorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-EntityUserOperatorSpec-schema-reference">Full list of <code>EntityUserOperatorSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures the User Operator.</p>
</div>
<div class="sect4">
<h5 id="property-user-operator-logging-reference"><a class="link" href="#property-user-operator-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>The User Operator has a configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The User Operator uses the Apache <code>log4j2</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property in the <code>entityOperator.userOperator</code> field of the <code>Kafka</code> resource to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j2.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    userOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    userOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: external
        valueFrom:
          configMapKeyRef:
            name: customConfigMap
            key: user-operator-log4j2.properties
   # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-EntityUserOperatorSpec-schema-reference"><a class="link" href="#type-EntityUserOperatorSpec-schema-reference"><code>EntityUserOperatorSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The namespace the User Operator should watch.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image to use for the User Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Interval between periodic reconciliations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>zookeeperSessionTimeoutSeconds</code> property has been deprecated.</strong> This property has been deprecated because ZooKeeper is not used anymore by the User Operator. Timeout for the ZooKeeper session.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretPrefix</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The prefix that will be added to the KafkaUser name to be used as the Secret name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-TlsSidecar-reference"><a class="link" href="#type-TlsSidecar-reference">8.2.47. <code>TlsSidecar</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-TlsSidecar-schema-reference">Full list of <code>TlsSidecar</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a TLS sidecar, which is a container that runs in a pod, but serves a supporting purpose.
In Strimzi, the TLS sidecar uses TLS to encrypt and decrypt communication between components and ZooKeeper.</p>
</div>
<div class="paragraph">
<p>The TLS sidecar is used in the Entity Operator.</p>
</div>
<div class="paragraph">
<p>The TLS sidecar is configured using the <code>tlsSidecar</code> property in <code>Kafka.spec.entityOperator</code>.</p>
</div>
<div class="paragraph">
<p>The TLS sidecar supports the following additional options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>image</code></p>
</li>
<li>
<p><code>resources</code></p>
</li>
<li>
<p><code>logLevel</code></p>
</li>
<li>
<p><code>readinessProbe</code></p>
</li>
<li>
<p><code>livenessProbe</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>resources</code> property specifies the <a href="#con-common-configuration-resources-reference">memory and CPU resources</a> allocated for the TLS sidecar.</p>
</div>
<div class="paragraph">
<p>The <code>image</code> property configures the <a href="#con-common-configuration-images-reference">container image</a> which will be used.</p>
</div>
<div class="paragraph">
<p>The <code>readinessProbe</code> and <code>livenessProbe</code> properties configure <a href="#con-common-configuration-healthchecks-reference">healthcheck probes</a> for the TLS sidecar.</p>
</div>
<div class="paragraph">
<p>The <code>logLevel</code> property specifies the logging level.
The following logging levels are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>emerg</p>
</li>
<li>
<p>alert</p>
</li>
<li>
<p>crit</p>
</li>
<li>
<p>err</p>
</li>
<li>
<p>warning</p>
</li>
<li>
<p>notice</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>debug</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default value is <em>notice</em>.</p>
</div>
<div class="listingblock">
<div class="title">Example TLS sidecar configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  entityOperator:
    # ...
    tlsSidecar:
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
    # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-TlsSidecar-schema-reference"><a class="link" href="#type-TlsSidecar-schema-reference"><code>TlsSidecar</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logLevel</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The log level for the TLS sidecar. Default value is <code>notice</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [emerg, debug, crit, err, alert, warning, notice, info])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-EntityOperatorTemplate-reference"><a class="link" href="#type-EntityOperatorTemplate-reference">8.2.48. <code>EntityOperatorTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Entity Operator <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Entity Operator <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Topic Operator container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity User Operator container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Operator TLS sidecar container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Operator service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entityOperatorRole</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Operator Role.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperatorRoleBinding</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Topic Operator RoleBinding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperatorRoleBinding</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Entity Topic Operator RoleBinding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-DeploymentTemplate-reference"><a class="link" href="#type-DeploymentTemplate-reference">8.2.49. <code>DeploymentTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-DeploymentTemplate-schema-reference">Full list of <code>DeploymentTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Use <code>deploymentStrategy</code> to specify the strategy used to replace old pods with new ones when deployment configuration changes.</p>
</div>
<div class="paragraph">
<p>Use one of the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RollingUpdate</code>: Pods are restarted with zero downtime.</p>
</li>
<li>
<p><code>Recreate</code>: Pods are terminated before new ones are created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the <code>Recreate</code> deployment strategy has the advantage of not requiring spare resources, but the disadvantage is the application downtime.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the deployment strategy set to <code>Recreate</code>.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
template:
  deployment:
    deploymentStrategy: Recreate
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration change does not cause a rolling update.</p>
</div>
<div class="sect4">
<h5 id="type-DeploymentTemplate-schema-reference"><a class="link" href="#type-DeploymentTemplate-schema-reference"><code>DeploymentTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata applied to the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploymentStrategy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod replacement strategy for deployment configuration changes. Valid values are <code>RollingUpdate</code> and <code>Recreate</code>. Defaults to <code>RollingUpdate</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [RollingUpdate, Recreate])</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-CertificateAuthority-reference"><a class="link" href="#type-CertificateAuthority-reference">8.2.50. <code>CertificateAuthority</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configuration of how TLS certificates are used within the cluster. This applies to certificates used for both internal communication within the cluster and to certificates used for client access via <code>Kafka.spec.kafka.listeners.tls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generateCertificateAuthority</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>If true then Certificate Authority certificates will be generated automatically. Otherwise the user will need to provide a Secret with the CA certificate. Default is true.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generateSecretOwnerReference</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>If <code>true</code>, the Cluster and Client CA Secrets are configured with the <code>ownerReference</code> set to the <code>Kafka</code> resource. If the <code>Kafka</code> resource is deleted when <code>true</code>, the CA Secrets are also deleted. If <code>false</code>, the <code>ownerReference</code> is disabled. If the <code>Kafka</code> resource is deleted when <code>false</code>, the CA Secrets are retained and available for reuse. Default is <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validityDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of days generated certificates should be valid for. The default is 365.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">renewalDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of days in the certificate renewal period. This is the number of days before the a certificate expires during which renewal actions may be performed. When <code>generateCertificateAuthority</code> is true, this will cause the generation of a new certificate. When <code>generateCertificateAuthority</code> is true, this will cause extra logging at WARN level about the pending certificate expiry. Default is 30.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateExpirationPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>How should CA certificate expiration be handled when <code>generateCertificateAuthority=true</code>. The default is for a new CA certificate to be generated reusing the existing private key.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [replace-key, renew-certificate])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-CruiseControlSpec-reference"><a class="link" href="#type-CruiseControlSpec-reference">8.2.51. <code>CruiseControlSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-CruiseControlSpec-schema-reference">Full list of <code>CruiseControlSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a Cruise Control cluster.</p>
</div>
<div class="paragraph">
<p>Configuration options relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Goals configuration</p>
</li>
<li>
<p>Capacity limits for resource distribution goals</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="property-cruise-control-config-reference"><a class="link" href="#property-cruise-control-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Cruise Control options as keys.</p>
</div>
<div class="paragraph">
<p>Standard Cruise Control configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Connection to the Kafka cluster</p>
</li>
<li>
<p>Client ID configuration</p>
</li>
<li>
<p>ZooKeeper connectivity</p>
</li>
<li>
<p>Web server configuration</p>
</li>
<li>
<p>Self healing</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://github.com/linkedin/cruise-control/wiki/Configurations" target="_blank" rel="noopener">Cruise Control documentation</a> with the exception of those options that are managed directly by Strimzi.
See the description of the <code>config</code> property for a list of forbidden prefixes.</p>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other supported options are passed to Cruise Control.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also configure <code>webserver</code> properties to enable Cross-Origin Resource Sharing (CORS).</p>
</div>
<div class="listingblock">
<div class="title">Example Cruise Control configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    config:
      default.goals: &gt;
        com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal
      cpu.balance.threshold: 1.1
      metadata.max.age.ms: 300000
      send.buffer.bytes: 131072
      webserver.http.cors.enabled: true
      webserver.http.cors.origin: "*"
      webserver.http.cors.exposeheaders: "User-Task-ID,Content-Type"
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-cruise-control-config-cors-reference"><a class="link" href="#property-cruise-control-config-cors-reference">Cross-Origin Resource Sharing (CORS)</a></h5>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) is a HTTP mechanism for controlling access to REST APIs.
Restrictions can be on access methods or originating URLs of client applications.
You can enable CORS with Cruise Control using the <code>webserver.http.cors.enabled</code> property in the <code>config</code>.
When enabled, CORS permits read access to the Cruise Control REST API from applications that have different originating URLs than Strimzi.
This allows applications from specified origins to use <code>GET</code> requests to fetch information about the Kafka cluster through the Cruise Control API.
For example, applications can fetch information on the current cluster load or the most recent optimization proposal.
<code>POST</code> requests are not permitted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For more information on using CORS with Cruise Control, see <a href="https://github.com/linkedin/cruise-control/wiki/REST-APIs" target="_blank" rel="noopener">REST APIs in the Cruise Control Wiki</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Enabling CORS for Cruise Control</div>
<p>You enable and configure CORS in <code>Kafka.spec.cruiseControl.config</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    config:
      webserver.http.cors.enabled: true # <b class="conum">(1)</b>
      webserver.http.cors.origin: "*" # <b class="conum">(2)</b>
      webserver.http.cors.exposeheaders: "User-Task-ID,Content-Type" # <b class="conum">(3)</b>

    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Enables CORS.</p>
</li>
<li>
<p>Specifies permitted origins for the <code>Access-Control-Allow-Origin</code> HTTP response header. You can use a wildcard or specify a single origin as a URL. If you use a wildcard, a response is returned following requests from any origin.</p>
</li>
<li>
<p>Exposes specified header names for the <code>Access-Control-Expose-Headers</code> HTTP response header. Applications in permitted origins can read responses with the specified headers.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="cruise_control_rest_api_security"><a class="link" href="#cruise_control_rest_api_security">Cruise Control REST API security</a></h5>
<div class="paragraph">
<p>The Cruise Control REST API is secured with HTTP Basic authentication and SSL to protect the cluster against potentially destructive Cruise Control operations, such as decommissioning Kafka brokers.
We recommend that Cruise Control in Strimzi is <strong>only used with these settings enabled</strong>.</p>
</div>
<div class="paragraph">
<p>However, it is possible to disable these settings by specifying the following Cruise Control configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To disable the built-in HTTP Basic authentication, set <code>webserver.security.enable</code> to <code>false</code>.</p>
</li>
<li>
<p>To disable the built-in SSL, set <code>webserver.ssl.enable</code> to <code>false</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Cruise Control configuration to disable API authorization, authentication, and SSL</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    config:
      webserver.security.enable: false
      webserver.ssl.enable: false
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-cruise-control-broker-capacity-reference"><a class="link" href="#property-cruise-control-broker-capacity-reference">brokerCapacity</a></h5>
<div class="paragraph">
<p>Cruise Control uses capacity limits to determine if optimization goals for resource distribution are being broken.
There are four goals of this type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiskUsageDistributionGoal</code>            - Disk utilization distribution</p>
</li>
<li>
<p><code>CpuUsageDistributionGoal</code>             - CPU utilization distribution</p>
</li>
<li>
<p><code>NetworkInboundUsageDistributionGoal</code>  - Network inbound utilization distribution</p>
</li>
<li>
<p><code>NetworkOutboundUsageDistributionGoal</code> - Network outbound utilization distribution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You specify capacity limits for Kafka broker resources in the <code>brokerCapacity</code> property in <code>Kafka.spec.cruiseControl</code> .
They are enabled by default and you can change their default values.
Capacity limits can be set for the following broker resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code>             - CPU resource in millicores or CPU cores (Default: 1)</p>
</li>
<li>
<p><code>inboundNetwork</code>  - Inbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
<li>
<p><code>outboundNetwork</code> - Outbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For network throughput, use an integer value with standard Kubernetes byte units (K, M, G) or their bibyte (power of two) equivalents (Ki, Mi, Gi) per second.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Disk and CPU capacity limits are automatically generated by Strimzi, so you do not need to set them.
In order to guarantee accurate rebalance proposals when using CPU goals, you can set CPU requests equal to CPU limits in <code>Kafka.spec.kafka.resources</code>.
That way, all CPU resources are reserved upfront and are always available.
This configuration allows Cruise Control to properly evaluate the CPU utilization when preparing the rebalance proposals based on CPU goals.
In cases where you cannot set CPU requests equal to CPU limits in <code>Kafka.spec.kafka.resources</code>, you can set the CPU capacity manually for the same accuracy.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Cruise Control brokerCapacity configuration using bibyte units</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    brokerCapacity:
      cpu: "2"
      inboundNetwork: 10000KiB/s
      outboundNetwork: 10000KiB/s
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-cruise-control-capacity-overrides-reference"><a class="link" href="#property-cruise-control-capacity-overrides-reference">Capacity overrides</a></h5>
<div class="paragraph">
<p>Brokers might be running on nodes with heterogeneous network or CPU resources.
If that&#8217;s the case, specify <code>overrides</code> that set the network capacity and CPU limits for each broker.
The overrides ensure an accurate rebalance between the brokers.
Override capacity limits can be set for the following broker resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code>             - CPU resource in millicores or CPU cores (Default: 1)</p>
</li>
<li>
<p><code>inboundNetwork</code>  - Inbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
<li>
<p><code>outboundNetwork</code> - Outbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of Cruise Control capacity overrides configuration using bibyte units</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    brokerCapacity:
      cpu: "1"
      inboundNetwork: 10000KiB/s
      outboundNetwork: 10000KiB/s
      overrides:
      - brokers: [0]
        cpu: "2.755"
        inboundNetwork: 20000KiB/s
        outboundNetwork: 20000KiB/s
      - brokers: [1, 2]
        cpu: 3000m
        inboundNetwork: 30000KiB/s
        outboundNetwork: 30000KiB/s</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, refer to the <a href="#type-BrokerCapacity-reference">BrokerCapacity schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-cruise-control-logging-reference"><a class="link" href="#property-cruise-control-logging-reference">Logging configuration</a></h5>
<div class="paragraph">
<p>Cruise Control has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cruise Control uses the Apache <code>log4j2</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
# ...
spec:
  cruiseControl:
    # ...
    logging:
      type: inline
      loggers:
        rootLogger.level: "INFO"
    # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
# ...
spec:
  cruiseControl:
    # ...
    logging:
      type: external
      valueFrom:
        configMapKeyRef:
          name: customConfigMap
          key: cruise-control-log4j.properties
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-CruiseControlSpec-schema-reference"><a class="link" href="#type-CruiseControlSpec-schema-reference"><code>CruiseControlSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>tlsSidecar</code> property has been deprecated.</strong> TLS sidecar configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve for the Cruise Control container. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking for the Cruise Control container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking for the Cruise Control container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for the Cruise Control container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration (Log4j 2) for Cruise Control. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template to specify how Cruise Control resources, <code>Deployments</code> and <code>Pods</code>, are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCapacity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Cruise Control <code>brokerCapacity</code> configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-BrokerCapacity-reference"><code>BrokerCapacity</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Cruise Control configuration. For a full list of configuration options refer to <a href="https://github.com/linkedin/cruise-control/wiki/Configurations" class="bare">https://github.com/linkedin/cruise-control/wiki/Configurations</a>. Note that properties with the following prefixes cannot be set: bootstrap.servers, client.id, zookeeper., network., security., failed.brokers.zk.path,webserver.http., webserver.api.urlprefix, webserver.session.path, webserver.accesslog., two.step., request.reason.required,metric.reporter.sampler.bootstrap.servers, capacity.config.file, self.healing., ssl., kafka.broker.failure.detection.enable, topic.config.provider.class (with the exception of: ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols, webserver.http.cors.enabled, webserver.http.cors.origin, webserver.http.cors.exposeheaders, webserver.security.enable, webserver.ssl.enable).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-CruiseControlTemplate-reference"><a class="link" href="#type-CruiseControlTemplate-reference">8.2.52. <code>CruiseControlTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Cruise Control <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Cruise Control <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Cruise Control API <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Cruise Control <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cruiseControlContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Cruise Control container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>tlsSidecarContainer</code> property has been deprecated.</strong> Template for the Cruise Control TLS sidecar container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Cruise Control service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-BrokerCapacity-reference"><a class="link" href="#type-BrokerCapacity-reference">8.2.53. <code>BrokerCapacity</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disk</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>disk</code> property has been deprecated.</strong> The Cruise Control disk capacity setting has been deprecated, is ignored, and will be removed in the future Broker capacity for disk in bytes. Use a number value with either standard Kubernetes byte units (K, M, G, or T), their bibyte (power of two) equivalents (Ki, Mi, Gi, or Ti), or a byte value with or without E notation. For example, 100000M, 100000Mi, 104857600000, or 1e+11.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpuUtilization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>cpuUtilization</code> property has been deprecated.</strong> The Cruise Control CPU capacity setting has been deprecated, is ignored, and will be removed in the future Broker capacity for CPU resource utilization as a percentage (0 - 100).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for CPU resource in cores or millicores. For example, 1, 1.500, 1500m. For more information on valid CPU resource units see <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu" class="bare">https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for inbound network throughput in bytes per second. Use an integer value with standard Kubernetes byte units (K, M, G) or their bibyte (power of two) equivalents (Ki, Mi, Gi) per second. For example, 10000KiB/s.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for outbound network throughput in bytes per second. Use an integer value with standard Kubernetes byte units (K, M, G) or their bibyte (power of two) equivalents (Ki, Mi, Gi) per second. For example, 10000KiB/s.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Overrides for individual brokers. The <code>overrides</code> property lets you specify a different capacity configuration for different brokers.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-BrokerCapacityOverride-reference"><code>BrokerCapacityOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-BrokerCapacityOverride-reference"><a class="link" href="#type-BrokerCapacityOverride-reference">8.2.54. <code>BrokerCapacityOverride</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-BrokerCapacity-reference"><code>BrokerCapacity</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of Kafka brokers (broker identifiers).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for CPU resource in cores or millicores. For example, 1, 1.500, 1500m. For more information on valid CPU resource units see <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu" class="bare">https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for inbound network throughput in bytes per second. Use an integer value with standard Kubernetes byte units (K, M, G) or their bibyte (power of two) equivalents (Ki, Mi, Gi) per second. For example, 10000KiB/s.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Broker capacity for outbound network throughput in bytes per second. Use an integer value with standard Kubernetes byte units (K, M, G) or their bibyte (power of two) equivalents (Ki, Mi, Gi) per second. For example, 10000KiB/s.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JmxTransSpec-reference"><a class="link" href="#type-JmxTransSpec-reference">8.2.55. <code>JmxTransSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image to use for the JmxTrans.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputDefinitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Defines the output hosts that will be referenced later on. For more information on these properties see, <a href="#type-JmxTransOutputDefinitionTemplate-reference"><code>JmxTransOutputDefinitionTemplate</code> schema reference</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransOutputDefinitionTemplate-reference"><code>JmxTransOutputDefinitionTemplate</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logLevel</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Sets the logging level of the JmxTrans deployment.For more information see, <a href="https://github.com/jmxtrans/jmxtrans-agent/wiki/Troubleshooting">JmxTrans Logging Level</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaQueries</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Queries to send to the Kafka brokers to define what data should be read from each broker. For more information on these properties see, <a href="#type-JmxTransQueryTemplate-reference"><code>JmxTransQueryTemplate</code> schema reference</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransQueryTemplate-reference"><code>JmxTransQueryTemplate</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for JmxTrans resources.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JmxTransOutputDefinitionTemplate-reference"><a class="link" href="#type-JmxTransOutputDefinitionTemplate-reference">8.2.56. <code>JmxTransOutputDefinitionTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for setting the format of the data that will be pushed.For more information see <a href="https://github.com/jmxtrans/jmxtrans/wiki/OutputWriters">JmxTrans OutputWriters</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The DNS/hostname of the remote host that the data is pushed to.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The port of the remote host that the data is pushed to.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushDelayInSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>How many seconds the JmxTrans waits before pushing a new set of data out.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">typeNames</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for filtering data to be included in response to a wildcard query. For more information see <a href="https://github.com/jmxtrans/jmxtrans/wiki/Queries">JmxTrans queries</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for setting the name of the output definition. This is used to identify where to send the results of queries should be sent.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JmxTransQueryTemplate-reference"><a class="link" href="#type-JmxTransQueryTemplate-reference">8.2.57. <code>JmxTransQueryTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetMBean</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>If using wildcards instead of a specific MBean then the data is gathered from multiple MBeans. Otherwise if specifying an MBean then data is gathered from that specified MBean.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attributes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Determine which attributes of the targeted MBean should be included.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputs</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of the names of output definitions specified in the spec.kafka.jmxTrans.outputDefinitions that have defined where JMX metrics are pushed to, and in which data format.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JmxTransTemplate-reference"><a class="link" href="#type-JmxTransTemplate-reference">8.2.58. <code>JmxTransTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for JmxTrans <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for JmxTrans <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for JmxTrans container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the JmxTrans service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaExporterSpec-reference"><a class="link" href="#type-KafkaExporterSpec-reference">8.2.59. <code>KafkaExporterSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Regular expression to specify which consumer groups to collect. Default value is <code>.*</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Regular expression to specify which topics to collect. Default value is <code>.*</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Only log messages with the given severity or above. Valid levels: [<code>info</code>, <code>debug</code>, <code>trace</code>]. Default log level is <code>info</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableSaramaLogging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable Sarama logging, a Go client library used by the Kafka Exporter.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Customization of deployment templates and pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness check.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness check.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaExporterTemplate-reference"><a class="link" href="#type-KafkaExporterTemplate-reference">8.2.60. <code>KafkaExporterTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Exporter <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Exporter <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>service</code> property has been deprecated.</strong> The Kafka Exporter service has been removed. Template for Kafka Exporter <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Exporter container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Exporter service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaStatus-reference"><a class="link" href="#type-KafkaStatus-reference">8.2.61. <code>KafkaStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Addresses of the internal and external listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka cluster Id.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-Condition-reference"><a class="link" href="#type-Condition-reference">8.2.62. <code>Condition</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a>, <a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code></a>, <a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a>, <a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a>, <a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a>, <a href="#type-KafkaRebalanceStatus-reference"><code>KafkaRebalanceStatus</code></a>, <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a>, <a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a>, <a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The unique identifier of a condition, used to distinguish between other conditions in the resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the condition, either True, False or Unknown.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastTransitionTime</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Last time the condition of a type changed from one status to another. The required format is 'yyyy-MM-ddTHH:mm:ssZ', in the UTC time zone.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reason</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The reason for the condition&#8217;s last transition (a single word in CamelCase).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Human-readable message indicating details about the condition&#8217;s last transition.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ListenerStatus-reference"><a class="link" href="#type-ListenerStatus-reference">8.2.63. <code>ListenerStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>type</code> property has been deprecated, and should now be configured using <code>name</code>.</strong> The name of the listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addresses</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of the addresses for this listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerAddress-reference"><code>ListenerAddress</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A comma-separated list of <code>host:port</code> pairs for connecting to the Kafka cluster using this listener.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of TLS certificates which can be used to verify the identity of the server when connecting to the given listener. Set only for <code>tls</code> and <code>external</code> listeners.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ListenerAddress-reference"><a class="link" href="#type-ListenerAddress-reference">8.2.64. <code>ListenerAddress</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The DNS name or IP address of the Kafka bootstrap service.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The port of the Kafka bootstrap service.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnect-reference"><a class="link" href="#type-KafkaConnect-reference">8.2.65. <code>KafkaConnect</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka Connect cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka Connect cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnectSpec-reference"><a class="link" href="#type-KafkaConnectSpec-reference">8.2.66. <code>KafkaConnectSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaConnectSpec-schema-reference">Full list of <code>KafkaConnectSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka Connect cluster.</p>
</div>
<div class="sect4">
<h5 id="property-kafka-connect-config-reference"><a class="link" href="#property-kafka-connect-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka options as keys.</p>
</div>
<div class="paragraph">
<p>Standard Apache Kafka Connect configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener / REST interface configuration</p>
</li>
<li>
<p>Plugin path configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> with the exception of those options that are managed directly by Strimzi.
Specifically, configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>plugin.path</code></p>
</li>
<li>
<p><code>rest.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka Connect.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Connect cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaConnect.spec.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Connect nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group.id</code> with default value <code>connect-cluster</code></p>
</li>
<li>
<p><code>offset.storage.topic</code> with default value <code>connect-cluster-offsets</code></p>
</li>
<li>
<p><code>config.storage.topic</code> with default value <code>connect-cluster-configs</code></p>
</li>
<li>
<p><code>status.storage.topic</code> with default value <code>connect-cluster-status</code></p>
</li>
<li>
<p><code>key.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
<li>
<p><code>value.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured in case they are not present in the <code>KafkaConnect.spec.config</code> properties.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
You can use three allowed <code>ssl</code> configuration options for client connection using a specific <em>cipher suite</em> for a TLS version.
A cipher suite combines algorithms for secure connection and data transfer.
You can also configure the <code>ssl.endpoint.identification.algorithm</code> property to enable or disable hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
    ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
    ssl.enabled.protocols: "TLSv1.2"
    ssl.protocol: "TLSv1.2"
    ssl.endpoint.identification.algorithm: HTTPS
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-kafka-connect-logging-reference"><a class="link" href="#property-kafka-connect-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>Kafka Connect has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connect.root.logger.level</code></p>
</li>
<li>
<p><code>log4j.logger.org.reflections</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further loggers are added depending on the Kafka Connect plugins running.</p>
</div>
<div class="paragraph">
<p>Use a curl request to get a complete list of Kafka Connect loggers running from any Kafka broker pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-curl hljs" data-lang="curl">curl -s http://&lt;connect-cluster-name&gt;-connect-api:8083/admin/loggers/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka Connect uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
spec:
  # ...
  logging:
    type: inline
    loggers:
      connect.root.logger.level: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: customConfigMap
        key: connect-logging.log4j
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any available loggers that are not configured have their level set to <code>OFF</code>.</p>
</div>
<div class="paragraph">
<p>If Kafka Connect was deployed using the Cluster Operator,
changes to Kafka Connect logging levels are applied dynamically.</p>
</div>
<div class="paragraph">
<p>If you use external logging, a rolling update is triggered when logging appenders are changed.</p>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaConnectSpec-schema-reference"><a class="link" href="#type-KafkaConnectSpec-schema-reference"><code>KafkaConnectSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka Connect version. Defaults to 3.3.2. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the Kafka Connect group.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Bootstrap servers to connect to. This should be given as a comma separated list of <em>&lt;hostname&gt;</em>:_&lt;port&gt;_ pairs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ClientTls-reference"><code>ClientTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for Kafka Connect. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-256, scram-sha-512, plain, oauth].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka Connect configuration. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum limits for CPU and memory resources and the requested initial resources. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JMX Options.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image of the init container used for initializing the <code>client.rack</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the node label which will be used as the <code>client.rack</code> consumer configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger, opentelemetry].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a>, <a href="#type-OpenTelemetryTracing-reference"><code>OpenTelemetryTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect and Kafka Mirror Maker 2 resources. The template allows users to specify how the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">build</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures how the Connect container image should be built. Optional.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Build-reference"><code>Build</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-ClientTls-reference"><a class="link" href="#type-ClientTls-reference">8.2.67. <code>ClientTls</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-ClientTls-schema-reference">Full list of <code>ClientTls</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures TLS trusted certificates for connecting KafkaConnect, KafkaBridge, KafkaMirror, KafkaMirrorMaker2 to the cluster.</p>
</div>
<div class="sect4">
<h5 id="trustedcertificates"><a class="link" href="#trustedcertificates"><code>trustedCertificates</code></a></h5>
<div class="paragraph">
<p>Provide a list of secrets using the <a href="#con-common-configuration-trusted-certificates-reference"><code>trustedCertificates</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-ClientTls-schema-reference"><a class="link" href="#type-ClientTls-schema-reference"><code>ClientTls</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Trusted certificates for TLS connection.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaClientAuthenticationTls-reference"><a class="link" href="#type-KafkaClientAuthenticationTls-reference">8.2.68. <code>KafkaClientAuthenticationTls</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClientAuthenticationTls-schema-reference">Full list of <code>KafkaClientAuthenticationTls</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure mTLS authentication, set the <code>type</code> property to the value <code>tls</code>.
mTLS uses a TLS certificate to authenticate.</p>
</div>
<div class="sect4">
<h5 id="certificateandkey"><a class="link" href="#certificateandkey"><code>certificateAndKey</code></a></h5>
<div class="paragraph">
<p>The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from a Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator,
or you can create your own TLS certificate file, with the keys used for authentication, then create a <code>Secret</code> from the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>MY-SECRET</em> \
--from-file=<em>MY-PUBLIC-TLS-CERTIFICATE-FILE.crt</em> \
--from-file=<em>MY-PRIVATE.key</em></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
mTLS authentication can only be used with TLS connections.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example mTLS configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: tls
  certificateAndKey:
    secretName: my-secret
    certificate: my-public-tls-certificate-file.crt
    key: private.key</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClientAuthenticationTls-schema-reference"><a class="link" href="#type-KafkaClientAuthenticationTls-schema-reference"><code>KafkaClientAuthenticationTls</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaClientAuthenticationTls</code> type from <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaClientAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the certificate and private key pair.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>tls</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaClientAuthenticationScramSha256-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha256-reference">8.2.69. <code>KafkaClientAuthenticationScramSha256</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClientAuthenticationScramSha256-schema-reference">Full list of <code>KafkaClientAuthenticationScramSha256</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based SCRAM-SHA-256 authentication, set the <code>type</code> property to <code>scram-sha-256</code>.
The SCRAM-SHA-256 authentication mechanism requires a username and password.</p>
</div>
<div class="sect4">
<h5 id="username"><a class="link" href="#username"><code>username</code></a></h5>
<div class="paragraph">
<p>Specify the username in the <code>username</code> property.</p>
</div>
</div>
<div class="sect4">
<h5 id="passwordsecret"><a class="link" href="#passwordsecret"><code>passwordSecret</code></a></h5>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator.</p>
</div>
<div class="paragraph">
<p>If required, you can create a text file that contains the password, in cleartext, to use for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">echo -n <em>PASSWORD</em> &gt; <em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create a <code>Secret</code> from the text file, setting your own field name (key) for the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>MY-CONNECT-SECRET-NAME</em> --from-file=<em>MY-PASSWORD-FIELD-NAME</em>=./<em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Secret for SCRAM-SHA-256 client authentication for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: my-connect-secret-name
type: Opaque
data:
  my-connect-password-field: LFTIyFRFlMmU2N2Tm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secretName</code> property contains the name of the <code>Secret</code>, and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example SASL-based SCRAM-SHA-256 client authentication configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: scram-sha-256
  username: my-connect-username
  passwordSecret:
    secretName: my-connect-secret-name
    password: my-connect-password-field</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClientAuthenticationScramSha256-schema-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha256-schema-reference"><code>KafkaClientAuthenticationScramSha256</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the password.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>scram-sha-256</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Username used for the authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-PasswordSecretSource-reference"><a class="link" href="#type-PasswordSecretSource-reference">8.2.70. <code>PasswordSecretSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the key in the Secret under which the password is stored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the Secret containing the password.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaClientAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha512-reference">8.2.71. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClientAuthenticationScramSha512-schema-reference">Full list of <code>KafkaClientAuthenticationScramSha512</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
The SCRAM-SHA-512 authentication mechanism requires a username and password.</p>
</div>
<div class="sect4">
<h5 id="username_2"><a class="link" href="#username_2"><code>username</code></a></h5>
<div class="paragraph">
<p>Specify the username in the <code>username</code> property.</p>
</div>
</div>
<div class="sect4">
<h5 id="passwordsecret_2"><a class="link" href="#passwordsecret_2"><code>passwordSecret</code></a></h5>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator.</p>
</div>
<div class="paragraph">
<p>If required, you can create a text file that contains the password, in cleartext, to use for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">echo -n <em>PASSWORD</em> &gt; <em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create a <code>Secret</code> from the text file, setting your own field name (key) for the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>MY-CONNECT-SECRET-NAME</em> --from-file=<em>MY-PASSWORD-FIELD-NAME</em>=./<em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Secret for SCRAM-SHA-512 client authentication for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: my-connect-secret-name
type: Opaque
data:
  my-connect-password-field: LFTIyFRFlMmU2N2Tm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secretName</code> property contains the name of the <code>Secret</code>, and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example SASL-based SCRAM-SHA-512 client authentication configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: scram-sha-512
  username: my-connect-username
  passwordSecret:
    secretName: my-connect-secret-name
    password: my-connect-password-field</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClientAuthenticationScramSha512-schema-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha512-schema-reference"><code>KafkaClientAuthenticationScramSha512</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the password.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>scram-sha-512</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Username used for the authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaClientAuthenticationPlain-reference"><a class="link" href="#type-KafkaClientAuthenticationPlain-reference">8.2.72. <code>KafkaClientAuthenticationPlain</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClientAuthenticationPlain-schema-reference">Full list of <code>KafkaClientAuthenticationPlain</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
SASL PLAIN authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="username_3"><a class="link" href="#username_3"><code>username</code></a></h5>
<div class="paragraph">
<p>Specify the username in the <code>username</code> property.</p>
</div>
</div>
<div class="sect4">
<h5 id="passwordsecret_3"><a class="link" href="#passwordsecret_3"><code>passwordSecret</code></a></h5>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator.</p>
</div>
<div class="paragraph">
<p>If required, create a text file that contains the password, in cleartext, to use for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">echo -n <em>PASSWORD</em> &gt; <em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create a <code>Secret</code> from the text file, setting your own field name (key) for the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create secret generic <em>MY-CONNECT-SECRET-NAME</em> --from-file=<em>MY-PASSWORD-FIELD-NAME</em>=./<em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Secret for PLAIN client authentication for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: my-connect-secret-name
type: Opaque
data:
  my-password-field-name: LFTIyFRFlMmU2N2Tm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: plain
  username: my-connect-username
  passwordSecret:
    secretName: my-connect-secret-name
    password: my-password-field-name</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClientAuthenticationPlain-schema-reference"><a class="link" href="#type-KafkaClientAuthenticationPlain-schema-reference"><code>KafkaClientAuthenticationPlain</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaClientAuthenticationPlain</code> type from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>plain</code> for the type <code>KafkaClientAuthenticationPlain</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the password.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>plain</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Username used for the authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaClientAuthenticationOAuth-reference"><a class="link" href="#type-KafkaClientAuthenticationOAuth-reference">8.2.73. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaClientAuthenticationOAuth-schema-reference">Full list of <code>KafkaClientAuthenticationOAuth</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>To configure OAuth client authentication, set the <code>type</code> property to <code>oauth</code>.</p>
</div>
<div class="paragraph">
<p>OAuth authentication can be configured using one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID and secret</p>
</li>
<li>
<p>Client ID and refresh token</p>
</li>
<li>
<p>Access token</p>
</li>
<li>
<p>Username and password</p>
</li>
<li>
<p>TLS</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Client ID and secret</div>
<p>You can configure the address of your authorization server in the <code>tokenEndpointUri</code> property together with the client ID and client secret used in authentication.
The OAuth client will connect to the OAuth server, authenticate using the client ID and secret and get an access token which it will use to authenticate with the Kafka broker.
In the <code>clientSecret</code> property, specify a link to a <code>Secret</code> containing the client secret.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using client ID and client secret</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  clientSecret:
    secretName: my-client-oauth-secret
    key: client-secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, <code>scope</code> and <code>audience</code> can be specified if needed.</p>
</div>
<div class="paragraph">
<div class="title">Client ID and refresh token</div>
<p>You can configure the address of your OAuth server in the <code>tokenEndpointUri</code> property together with the OAuth client ID and refresh token.
The OAuth client will connect to the OAuth server, authenticate using the client ID and refresh token and get an access token which it will use to authenticate with the Kafka broker.
In the <code>refreshToken</code> property, specify a link to a <code>Secret</code> containing the refresh token.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using client ID and refresh token</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Access token</div>
<p>You can configure the access token used for authentication with the Kafka broker directly.
In this case, you do not specify the <code>tokenEndpointUri</code>.
In the <code>accessToken</code> property, specify a link to a <code>Secret</code> containing the access token.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using only an access token</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  accessToken:
    secretName: my-access-token-secret
    key: access-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Username and password</div>
<p>OAuth username and password configuration uses the OAuth <em>Resource Owner Password Grant</em> mechanism. The mechanism is deprecated, and is only supported to enable integration in environments where client credentials (ID and secret) cannot be used. You might need to use user accounts if your access management system does not support another approach or user accounts are required for authentication.</p>
</div>
<div class="paragraph">
<p>A typical approach is to create a special user account in your authorization server that represents your client application. You then give the account a long randomly generated password and a very limited set of permissions. For example, the account can only connect to your Kafka cluster, but is not allowed to use any other services or login to the user interface.</p>
</div>
<div class="paragraph">
<p>Consider using a refresh token mechanism first.</p>
</div>
<div class="paragraph">
<p>You can configure the address of your authorization server in the <code>tokenEndpointUri</code> property together with the client ID, username and the password used in authentication.
The OAuth client will connect to the OAuth server, authenticate using the username, the password, the client ID, and optionally even the client secret to obtain an access token which it will use to authenticate with the Kafka broker.</p>
</div>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>Normally, you also have to configure a <code>clientId</code> using a public OAuth client.
If you are using a confidential OAuth client, you also have to configure a <code>clientSecret</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using username and a password with a public client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  username: my-username
  passwordSecret:
    secretName: my-password-secret-name
    password: my-password-field-name
  clientId: my-public-client-id</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using a username and a password with a confidential client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  username: my-username
  passwordSecret:
    secretName: my-password-secret-name
    password: my-password-field-name
  clientId: my-confidential-client-id
  clientSecret:
    secretName: my-confidential-client-oauth-secret
    key: client-secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, <code>scope</code> and <code>audience</code> can be specified if needed.</p>
</div>
<div class="paragraph">
<div class="title">TLS</div>
<p>Accessing the OAuth server using the HTTPS protocol does not require any additional configuration as long as the TLS certificates used by it are signed by a trusted certification authority and its hostname is listed in the certificate.</p>
</div>
<div class="paragraph">
<p>If your OAuth server is using certificates which are self-signed or are signed by a certification authority which is not trusted, you can configure a list of trusted certificates in the custom resource.
The <code>tlsTrustedCertificates</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example of TLS certificates provided</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  tlsTrustedCertificates:
    - secretName: oauth-server-ca
      certificate: tls.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OAuth client will by default verify that the hostname of your OAuth server matches either the certificate subject or one of the alternative DNS names.
If it is not required, you can disable the hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">An example of disabled TLS hostname verification</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  disableTlsHostnameVerification: true</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaClientAuthenticationOAuth-schema-reference"><a class="link" href="#type-KafkaClientAuthenticationOAuth-schema-reference"><code>KafkaClientAuthenticationOAuth</code> schema properties</a></h5>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaClientAuthenticationOAuth</code> type from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaClientAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Link to Kubernetes Secret containing the access token which was obtained from the authorization server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessTokenIsJwt</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configure whether access token should be treated as JWT. This should be set to <code>false</code> if the authorization server returns opaque tokens. Defaults to <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">audience</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>OAuth audience to use when authenticating against the authorization server. Some authorization servers require the audience to be explicitly set. The possible values depend on how the authorization server is configured. By default, <code>audience</code> is not specified when performing the token endpoint request.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>OAuth Client ID which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Link to Kubernetes Secret containing the OAuth client secret which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The connect timeout in seconds when connecting to authorization server. If not set, the effective connect timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable TLS hostname verification. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable or disable OAuth metrics. Default value is <code>false</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxTokenExpirySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Set or limit time-to-live of the access tokens to the specified number of seconds. This should be set if the authorization server returns opaque tokens.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to the <code>Secret</code> which holds the password.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The read timeout in seconds when connecting to authorization server. If not set, the effective read timeout is 60 seconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">refreshToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Link to Kubernetes Secret containing the refresh token which can be used to obtain access token from the authorization server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>OAuth scope to use when authenticating against the authorization server. Some authorization servers require this to be set. The possible values depend on how authorization server is configured. By default <code>scope</code> is not specified when doing the token endpoint request.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Trusted certificates for TLS connection to the OAuth server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authorization server token endpoint URI.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>oauth</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Username used for the authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-JaegerTracing-reference"><a class="link" href="#type-JaegerTracing-reference">8.2.74. <code>JaegerTracing</code> schema reference</a></h4>
<div class="paragraph">
<p><strong>The type <code>JaegerTracing</code> has been deprecated.</strong></p>
</div>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>JaegerTracing</code> type from <a href="#type-OpenTelemetryTracing-reference"><code>OpenTelemetryTracing</code></a>.
It must have the value <code>jaeger</code> for the type <code>JaegerTracing</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>jaeger</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-OpenTelemetryTracing-reference"><a class="link" href="#type-OpenTelemetryTracing-reference">8.2.75. <code>OpenTelemetryTracing</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>OpenTelemetryTracing</code> type from <a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a>.
It must have the value <code>opentelemetry</code> for the type <code>OpenTelemetryTracing</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>opentelemetry</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnectTemplate-reference"><a class="link" href="#type-KafkaConnectTemplate-reference">8.2.76. <code>KafkaConnectTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect API <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka init container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterRoleBinding</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect ClusterRoleBinding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildPod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect Build <code>Pods</code>. The build pod is used only on Kubernetes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect Build container. The build container is used only on Kubernetes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect BuildConfig used to build new container images. The BuildConfig is used only on OpenShift.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-BuildConfigTemplate-reference"><code>BuildConfigTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildServiceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Connect Build service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Secret of the Kafka Connect Cluster JMX authentication.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-BuildConfigTemplate-reference"><a class="link" href="#type-BuildConfigTemplate-reference">8.2.77. <code>BuildConfigTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metadata to apply to the <code>PodDisruptionBudgetTemplate</code> resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pullSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Container Registry Secret with the credentials for pulling the base image.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ExternalConfiguration-reference"><a class="link" href="#type-ExternalConfiguration-reference">8.2.78. <code>ExternalConfiguration</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-ExternalConfiguration-schema-reference">Full list of <code>ExternalConfiguration</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures external storage properties that define configuration options for Kafka Connect connectors.</p>
</div>
<div class="paragraph">
<p>You can mount ConfigMaps or Secrets into a Kafka Connect pod as environment variables or volumes.
Volumes and environment variables are configured in the <code>externalConfiguration</code> property in <code>KafkaConnect.spec</code>.</p>
</div>
<div class="paragraph">
<p>When applied, the environment variables and volumes are available for use when developing your connectors.</p>
</div>
<div class="sect4">
<h5 id="property-kafka-connect-external-env-reference"><a class="link" href="#property-kafka-connect-external-env-reference"><code>env</code></a></h5>
<div class="paragraph">
<p>Use the <code>env</code> property to specify one or more environment variables.
These variables can contain a value from either a ConfigMap or a Secret.</p>
</div>
<div class="listingblock">
<div class="title">Example Secret containing values for environment variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: aws-creds
type: Opaque
data:
  awsAccessKey: QUtJQVhYWFhYWFhYWFhYWFg=
  awsSecretAccessKey: Ylhsd1lYTnpkMjl5WkE=</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The names of user-defined environment variables cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mount a value from a Secret to an environment variable, use the <code>valueFrom</code> property and the <code>secretKeyRef</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example environment variables set to values from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
<div class="paragraph">
<p>A common use case for mounting Secrets is for a connector to communicate with Amazon AWS.
The connector needs to be able to read the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code>.</p>
</div>
<div class="paragraph">
<p>To mount a value from a ConfigMap to an environment variable, use <code>configMapKeyRef</code> in the <code>valueFrom</code> property as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example environment variables set to values from a ConfigMap</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          configMapKeyRef:
            name: my-config-map
            key: my-key</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-kafka-connect-external-volumes-reference"><a class="link" href="#property-kafka-connect-external-volumes-reference"><code>volumes</code></a></h5>
<div class="paragraph">
<p>Use volumes to mount ConfigMaps or Secrets to a Kafka Connect pod.</p>
</div>
<div class="paragraph">
<p>Using volumes instead of environment variables is useful in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mounting a properties file that is used to configure Kafka Connect connectors</p>
</li>
<li>
<p>Mounting truststores or keystores with TLS certificates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Volumes are mounted inside the Kafka Connect containers on the path <code>/opt/kafka/external-configuration/<em>&lt;volume-name&gt;</em></code>.
For example, the files from a volume named <code>connector-config</code> will appear in the directory <code>/opt/kafka/external-configuration/connector-config</code>.</p>
</div>
<div class="paragraph">
<p>Configuration <em>providers</em> load values from outside the configuration.
Use a provider mechanism to avoid passing restricted information over the Kafka Connect REST interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FileConfigProvider</code> loads configuration values from properties in a file.</p>
</li>
<li>
<p><code>DirectoryConfigProvider</code> loads configuration values from separate files within a directory structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use a comma-separated list if you want to add more than one provider, including custom providers.
You can use custom providers to load values from other file locations.</p>
</div>
<div class="paragraph">
<div class="title">Using <code>FileConfigProvider</code> to load property values</div>
<p>In this example, a Secret named <code>mysecret</code> contains connector properties that specify a database name and password:</p>
</div>
<div class="listingblock">
<div class="title">Example Secret with database properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData:
  connector.properties: |- <b class="conum">(1)</b>
    dbUsername: my-username <b class="conum">(2)</b>
    dbPassword: my-password</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The connector configuration in properties file format.</p>
</li>
<li>
<p>Database username and password properties used in the configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Secret and the <code>FileConfigProvider</code> configuration provider are specified in the Kafka Connect configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Secret is mounted to a volume named <code>connector-config</code>.</p>
</li>
<li>
<p><code>FileConfigProvider</code> is given the alias <code>file</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example external volumes set to values from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    config.providers: file <b class="conum">(1)</b>
    config.providers.file.class: org.apache.kafka.common.config.provider.FileConfigProvider <b class="conum">(2)</b>
  #...
  externalConfiguration:
    volumes:
      - name: connector-config <b class="conum">(3)</b>
        secret:
          secretName: mysecret <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The alias for the configuration provider is used to define other configuration parameters.</p>
</li>
<li>
<p><code>FileConfigProvider</code> provides values from properties files.
The parameter uses the alias from <code>config.providers</code>, taking the form <code>config.providers.${alias}.class</code>.</p>
</li>
<li>
<p>The name of the volume containing the Secret. Each volume must specify a name in the <code>name</code> property and a reference to a ConfigMap or Secret.</p>
</li>
<li>
<p>The name of the Secret.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Placeholders for the property values in the Secret are referenced in the connector configuration.
The placeholder structure is <code>file:<em>PATH-AND-FILE-NAME</em>:<em>PROPERTY</em></code>.
<code>FileConfigProvider</code> reads and extracts the database <em>username</em> and <em>password</em> property values from the mounted Secret in connector configurations.</p>
</div>
<div class="listingblock">
<div class="title">Example connector configuration showing placeholders for external values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: my-source-connector
  labels:
    strimzi.io/cluster: my-connect-cluster
spec:
  class: io.debezium.connector.mysql.MySqlConnector
  tasksMax: 2
  config:
    database.hostname: 192.168.99.1
    database.port: "3306"
    database.user: "${file:/opt/kafka/external-configuration/connector-config/mysecret:dbUsername}"
    database.password: "${file:/opt/kafka/external-configuration/connector-config/mysecret:dbPassword}"
    database.server.id: "184054"
    #...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Using <code>DirectoryConfigProvider</code> to load property values from separate files</div>
<p>In this example, a <code>Secret</code> contains TLS truststore and keystore user credentials in separate files.</p>
</div>
<div class="listingblock">
<div class="title">Example Secret with user credentials</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: my-user
  labels:
    strimzi.io/kind: KafkaUser
    strimzi.io/cluster: my-cluster
type: Opaque
data:
  ca.crt: <em>&lt;public_key&gt;</em> # Public key of the clients CA
  user.crt: <em>&lt;user_certificate&gt;</em> # Public key of the user
  user.key: <em>&lt;user_private_key&gt;</em> # Private key of the user
  user.p12: <em>&lt;store&gt;</em> # PKCS #12 store for user certificates and keys
  user.password: <em>&lt;password_for_store&gt;</em> # Protects the PKCS #12 store</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Secret and the <code>DirectoryConfigProvider</code> configuration provider are specified in the Kafka Connect configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Secret is mounted to a volume named <code>connector-config</code>.</p>
</li>
<li>
<p><code>DirectoryConfigProvider</code> is given the alias <code>directory</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example external volumes set for user credentials files</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    config.providers: directory
    config.providers.directory.class: org.apache.kafka.common.config.provider.DirectoryConfigProvider <b class="conum">(1)</b>
  #...
  externalConfiguration:
    volumes:
      - name: cluster-ca
        secret:
          secretName: my-cluster-cluster-ca-cert
      - name: my-user
        secret:
          secretName: my-user</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>DirectoryConfigProvider</code> provides values from files in a directory. The parameter uses the alias from <code>config.providers</code>, taking the form <code>config.providers.${alias}.class</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Placeholders for the credentials are referenced in the connector configuration.
The placeholder structure is <code>directory:<em>PATH</em>:<em>FILE-NAME</em></code>.
<code>DirectoryConfigProvider</code> reads and extracts the credentials from the mounted Secret in connector configurations.</p>
</div>
<div class="listingblock">
<div class="title">Example connector configuration showing placeholders for external values</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: my-source-connector
  labels:
    strimzi.io/cluster: my-connect-cluster
spec:
  class: io.debezium.connector.mysql.MySqlConnector
  tasksMax: 2
  config:
    # ...
    database.history.producer.security.protocol: SSL
    database.history.producer.ssl.truststore.type: PEM
    database.history.producer.ssl.truststore.certificates: "${directory:/opt/kafka/external-configuration/cluster-ca:ca.crt}"
    database.history.producer.ssl.keystore.type: PEM
    database.history.producer.ssl.keystore.certificate.chain: "${directory:/opt/kafka/external-configuration/my-user:user.crt}"
    database.history.producer.ssl.keystore.key: "${directory:/opt/kafka/external-configuration/my-user:user.key}"
    #...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-ExternalConfiguration-schema-reference"><a class="link" href="#type-ExternalConfiguration-schema-reference"><code>ExternalConfiguration</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Makes data from a Secret or ConfigMap available in the Kafka Connect pods as environment variables.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Makes data from a Secret or ConfigMap available in the Kafka Connect pods as volumes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationVolumeSource-reference"><code>ExternalConfigurationVolumeSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-ExternalConfigurationEnv-reference"><a class="link" href="#type-ExternalConfigurationEnv-reference">8.2.79. <code>ExternalConfigurationEnv</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of the environment variable which will be passed to the Kafka Connect pods. The name of the environment variable cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Value of the environment variable which will be passed to the Kafka Connect pods. It can be passed either as a reference to Secret or ConfigMap field. The field has to specify exactly one Secret or ConfigMap.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnvVarSource-reference"><code>ExternalConfigurationEnvVarSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ExternalConfigurationEnvVarSource-reference"><a class="link" href="#type-ExternalConfigurationEnvVarSource-reference">8.2.80. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMapKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to a key in a ConfigMap. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapkeyselector-v1-core">external documentation for core/v1 configmapkeyselector</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapkeyselector-v1-core">ConfigMapKeySelector</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to a key in a Secret. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretkeyselector-v1-core">external documentation for core/v1 secretkeyselector</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretkeyselector-v1-core">SecretKeySelector</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ExternalConfigurationVolumeSource-reference"><a class="link" href="#type-ExternalConfigurationVolumeSource-reference">8.2.81. <code>ExternalConfigurationVolumeSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to a key in a ConfigMap. Exactly one Secret or ConfigMap has to be specified. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapvolumesource-v1-core">external documentation for core/v1 configmapvolumesource</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmapvolumesource-v1-core">ConfigMapVolumeSource</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of the volume which will be added to the Kafka Connect pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Reference to a key in a Secret. Exactly one Secret or ConfigMap has to be specified. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretvolumesource-v1-core">external documentation for core/v1 secretvolumesource</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretvolumesource-v1-core">SecretVolumeSource</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-Build-reference"><a class="link" href="#type-Build-reference">8.2.82. <code>Build</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-Build-schema-reference">Full list of <code>Build</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures additional connectors for Kafka Connect deployments.</p>
</div>
<div class="sect4">
<h5 id="output"><a class="link" href="#output"><code>output</code></a></h5>
<div class="paragraph">
<p>To build new container images with additional connector plugins, Strimzi requires a container registry where the images can be pushed to, stored, and pulled from.
Strimzi does not run its own container registry, so a registry must be provided.
Strimzi supports private container registries as well as public registries such as <a href="https://quay.io/" target="_blank" rel="noopener">Quay</a> or <a href="https://hub.docker.com//" target="_blank" rel="noopener">Docker Hub</a>.
The container registry is configured in the <code>.spec.build.output</code> section of the <code>KafkaConnect</code> custom resource.
The <code>output</code> configuration, which is required, supports two types: <code>docker</code> and <code>imagestream</code>.</p>
</div>
<div class="paragraph">
<div class="title">Using Docker registry</div>
<p>To use a Docker registry, you have to specify the <code>type</code> as <code>docker</code>, and the <code>image</code> field with the full name of the new container image.
The full name must include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The address of the registry</p>
</li>
<li>
<p>Port number (if listening on a non-standard port)</p>
</li>
<li>
<p>The tag of the new container image</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example valid container image names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>docker.io/my-org/my-image/my-tag</code></p>
</li>
<li>
<p><code>quay.io/my-org/my-image/my-tag</code></p>
</li>
<li>
<p><code>image-registry.image-registry.svc:5000/myproject/kafka-connect-build:latest</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each Kafka Connect deployment must use a separate image, which can mean different tags at the most basic level.</p>
</div>
<div class="paragraph">
<p>If the registry requires authentication, use the <code>pushSecret</code> to set a name of the Secret with the registry credentials.
For the Secret, use the <code>kubernetes.io/dockerconfigjson</code> type and a <code>.dockerconfigjson</code> file to contain the Docker credentials.
For more information on pulling an image from a private registry, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/#registry-secret-existing-credentials" target="_blank" rel="noopener">Create a Secret based on existing Docker credentials</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>output</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      type: docker <b class="conum">(1)</b>
      image: my-registry.io/my-org/my-connect-cluster:latest <b class="conum">(2)</b>
      pushSecret: my-registry-credentials <b class="conum">(3)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of output used by Strimzi.</p>
</li>
<li>
<p>(Required) Full name of the image used, including the repository and tag.</p>
</li>
<li>
<p>(Optional) Name of the secret with the container registry credentials.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Using OpenShift ImageStream</div>
<p>Instead of Docker, you can use OpenShift ImageStream to store a new container image.
The ImageStream has to be created manually before deploying Kafka Connect.
To use ImageStream, set the <code>type</code> to <code>imagestream</code>, and use the <code>image</code> property to specify the name of the ImageStream and the tag used.
For example, <code>my-connect-image-stream:latest</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>output</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      type: imagestream # <b class="conum">(1)</b>
      image: my-connect-build:latest # <b class="conum">(2)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of output used by Strimzi.</p>
</li>
<li>
<p>(Required) Name of the ImageStream and tag.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="plugins"><a class="link" href="#plugins"><code>plugins</code></a></h5>
<div class="paragraph">
<p>Connector plugins are a set of files that define the implementation required to connect to certain types of external system.
The connector plugins required for a container image must be configured using the <code>.spec.build.plugins</code> property of the <code>KafkaConnect</code> custom resource.
Each connector plugin must have a name which is unique within the Kafka Connect deployment.
Additionally, the plugin artifacts must be listed.
These artifacts are downloaded by Strimzi, added to the new container image, and used in the Kafka Connect deployment.
The connector plugin artifacts can also include additional components, such as (de)serializers.
Each connector plugin is downloaded into a separate directory so that the different connectors and their dependencies are properly <em>sandboxed</em>.
Each plugin must be configured with at least one <code>artifact</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>plugins</code> configuration with two connector plugins</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      #...
    plugins: <b class="conum">(1)</b>
      - name: debezium-postgres-connector
        artifacts:
          - type: tgz
            url: https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/2.1.1.Final/debezium-connector-postgres-2.1.1.Final-plugin.tar.gz
            sha512sum: 962a12151bdf9a5a30627eebac739955a4fd95a08d373b86bdcea2b4d0c27dd6e1edd5cb548045e115e33a9e69b1b2a352bee24df035a0447cb820077af00c03
      - name: camel-telegram
        artifacts:
          - type: tgz
            url: https://repo.maven.apache.org/maven2/org/apache/camel/kafkaconnector/camel-telegram-kafka-connector/0.9.0/camel-telegram-kafka-connector-0.9.0-package.tar.gz
            sha512sum: a9b1ac63e3284bea7836d7d24d84208c49cdf5600070e6bd1535de654f6920b74ad950d51733e8020bf4187870699819f54ef5859c7846ee4081507f48873479
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) List of connector plugins and their artifacts.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Strimzi supports the following types of artifacts:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>JAR files, which are downloaded and used directly</p>
</li>
<li>
<p>TGZ archives, which are downloaded and unpacked</p>
</li>
<li>
<p>ZIP archives, which are downloaded and unpacked</p>
</li>
<li>
<p>Maven artifacts, which uses Maven coordinates</p>
</li>
<li>
<p>Other artifacts, which are downloaded and used directly</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Strimzi does not perform any security scanning of the downloaded artifacts.
For security reasons, you should first verify the artifacts manually, and configure the checksum verification to make sure the same artifact is used in the automated build and in the Kafka Connect deployment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Using JAR artifacts</div>
<p>JAR artifacts represent a JAR file that is downloaded and added to a container image.
To use a JAR artifacts, set the <code>type</code> property to <code>jar</code>, and specify the download location using the <code>url</code> property.</p>
</div>
<div class="paragraph">
<p>Additionally, you can specify a SHA-512 checksum of the artifact.
If specified, Strimzi will verify the checksum of the artifact while building the new container image.</p>
</div>
<div class="listingblock">
<div class="title">Example JAR artifact</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      #...
    plugins:
      - name: my-plugin
        artifacts:
          - type: jar <b class="conum">(1)</b>
            url: https://my-domain.tld/my-jar.jar <b class="conum">(2)</b>
            sha512sum: 589...ab4 <b class="conum">(3)</b>
          - type: jar
            url: https://my-domain.tld/my-jar2.jar
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of artifact.</p>
</li>
<li>
<p>(Required) URL from which the artifact is downloaded.</p>
</li>
<li>
<p>(Optional) SHA-512 checksum to verify the artifact.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Using TGZ artifacts</div>
<p>TGZ artifacts are used to download TAR archives that have been compressed using Gzip compression.
The TGZ artifact can contain the whole Kafka Connect connector, even when comprising multiple different files.
The TGZ artifact is automatically downloaded and unpacked by Strimzi while building the new container image.
To use TGZ artifacts, set the <code>type</code> property to <code>tgz</code>, and specify the download location using the <code>url</code> property.</p>
</div>
<div class="paragraph">
<p>Additionally, you can specify a SHA-512 checksum of the artifact.
If specified, Strimzi will verify the checksum before unpacking it and building the new container image.</p>
</div>
<div class="listingblock">
<div class="title">Example TGZ artifact</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      #...
    plugins:
      - name: my-plugin
        artifacts:
          - type: tgz <b class="conum">(1)</b>
            url: https://my-domain.tld/my-connector-archive.tgz <b class="conum">(2)</b>
            sha512sum: 158...jg10 <b class="conum">(3)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of artifact.</p>
</li>
<li>
<p>(Required) URL from which the archive is downloaded.</p>
</li>
<li>
<p>(Optional) SHA-512 checksum to verify the artifact.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Using ZIP artifacts</div>
<p>ZIP artifacts are used to download ZIP compressed archives.
Use ZIP artifacts in the same way as the TGZ artifacts described in the previous section.
The only difference is you specify <code>type: zip</code> instead of  <code>type: tgz</code>.</p>
</div>
<div class="paragraph">
<div class="title">Using Maven artifacts</div>
<p><code>maven</code> artifacts are used to specify connector plugin artifacts as Maven coordinates.
The Maven coordinates identify plugin artifacts and dependencies so that they can be located and fetched from a Maven repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Maven repository must be accessible for the connector build process to add the artifacts to the container image.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Maven artifact</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      #...
    plugins:
      - name: my-plugin
        artifacts:
          - type: maven <b class="conum">(1)</b>
            repository: https://mvnrepository.com <b class="conum">(2)</b>
            group: org.apache.camel.kafkaconnector <b class="conum">(3)</b>
            artifact: camel-kafka-connector <b class="conum">(4)</b>
            version: 0.11.0 <b class="conum">(5)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of artifact.</p>
</li>
<li>
<p>(Optional) Maven repository to download the artifacts from. If you do not specify a repository, <a href="https://mvnrepository.com/repos/central" target="_blank" rel="noopener">Maven Central repository</a> is used by default.</p>
</li>
<li>
<p>(Required) Maven group ID.</p>
</li>
<li>
<p>(Required) Maven artifact type.</p>
</li>
<li>
<p>(Required) Maven version number.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Using <code>other</code> artifacts</div>
<p><code>other</code> artifacts represent any kind of file that is downloaded and added to a container image.
If you want to use a specific name for the artifact in the resulting container image, use the <code>fileName</code> field.
If a file name is not specified, the file is named based on the URL hash.</p>
</div>
<div class="paragraph">
<p>Additionally, you can specify a SHA-512 checksum of the artifact.
If specified, Strimzi will verify the checksum of the artifact while building the new container image.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>other</code> artifact</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  build:
    output:
      #...
    plugins:
      - name: my-plugin
        artifacts:
          - type: other  <b class="conum">(1)</b>
            url: https://my-domain.tld/my-other-file.ext  <b class="conum">(2)</b>
            sha512sum: 589...ab4  <b class="conum">(3)</b>
            fileName: name-the-file.ext  <b class="conum">(4)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Type of artifact.</p>
</li>
<li>
<p>(Required) URL from which the artifact is downloaded.</p>
</li>
<li>
<p>(Optional) SHA-512 checksum to verify the artifact.</p>
</li>
<li>
<p>(Optional) The name under which the file is stored in the resulting container image.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="type-Build-schema-reference"><a class="link" href="#type-Build-schema-reference"><code>Build</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures where should the newly built image be stored. Required. The type depends on the value of the <code>output.type</code> property within the given object, which must be one of [docker, imagestream].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DockerOutput-reference"><code>DockerOutput</code></a>, <a href="#type-ImageStreamOutput-reference"><code>ImageStreamOutput</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve for the build. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of connector plugins which should be added to the Kafka Connect. Required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Plugin-reference"><code>Plugin</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-DockerOutput-reference"><a class="link" href="#type-DockerOutput-reference">8.2.83. <code>DockerOutput</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Build-reference"><code>Build</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>DockerOutput</code> type from <a href="#type-ImageStreamOutput-reference"><code>ImageStreamOutput</code></a>.
It must have the value <code>docker</code> for the type <code>DockerOutput</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The full name which should be used for tagging and pushing the newly built image. For example <code>quay.io/my-organization/my-custom-connect:latest</code>. Required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pushSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Container Registry Secret with the credentials for pushing the newly built image.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">additionalKanikoOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configures additional options which will be passed to the Kaniko executor when building the new Connect image. Allowed options are: --customPlatform, --insecure, --insecure-pull, --insecure-registry, --log-format, --log-timestamp, --registry-mirror, --reproducible, --single-snapshot, --skip-tls-verify, --skip-tls-verify-pull, --skip-tls-verify-registry, --verbosity, --snapshotMode, --use-new-run. These options will be used only on Kubernetes where the Kaniko executor is used. They will be ignored on OpenShift. The options are described in the <a href="https://github.com/GoogleContainerTools/kaniko" target="_blank" rel="noopener">Kaniko GitHub repository</a>. Changing this field does not trigger new build of the Kafka Connect image.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>docker</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ImageStreamOutput-reference"><a class="link" href="#type-ImageStreamOutput-reference">8.2.84. <code>ImageStreamOutput</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Build-reference"><code>Build</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>ImageStreamOutput</code> type from <a href="#type-DockerOutput-reference"><code>DockerOutput</code></a>.
It must have the value <code>imagestream</code> for the type <code>ImageStreamOutput</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name and tag of the ImageStream where the newly built image will be pushed. For example <code>my-custom-connect:latest</code>. Required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>imagestream</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-Plugin-reference"><a class="link" href="#type-Plugin-reference">8.2.85. <code>Plugin</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Build-reference"><code>Build</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The unique name of the connector plugin. Will be used to generate the path where the connector artifacts will be stored. The name has to be unique within the KafkaConnect resource. The name has to follow the following pattern: <code>^[a-z][-_a-z0-9]*[a-z]$</code>. Required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifacts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of artifacts which belong to this connector plugin. Required.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JarArtifact-reference"><code>JarArtifact</code></a>, <a href="#type-TgzArtifact-reference"><code>TgzArtifact</code></a>, <a href="#type-ZipArtifact-reference"><code>ZipArtifact</code></a>, <a href="#type-MavenArtifact-reference"><code>MavenArtifact</code></a>, <a href="#type-OtherArtifact-reference"><code>OtherArtifact</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-JarArtifact-reference"><a class="link" href="#type-JarArtifact-reference">8.2.86. <code>JarArtifact</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Plugin-reference"><code>Plugin</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URL of the artifact which will be downloaded. Strimzi does not do any security scanning of the downloaded artifacts. For security reasons, you should first verify the artifacts manually and configure the checksum verification to make sure the same artifact is used in the automated build. Required for <code>jar</code>, <code>zip</code>, <code>tgz</code> and <code>other</code> artifacts. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>SHA512 checksum of the artifact. Optional. If specified, the checksum will be verified while building the new container. If not specified, the downloaded artifact will not be verified. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>By default, connections using TLS are verified to check they are secure. The server certificate used must be valid, trusted, and contain the server name. By setting this option to <code>true</code>, all TLS verification is disabled and the artifact will be downloaded, even when the server is considered insecure.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>jar</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-TgzArtifact-reference"><a class="link" href="#type-TgzArtifact-reference">8.2.87. <code>TgzArtifact</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Plugin-reference"><code>Plugin</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URL of the artifact which will be downloaded. Strimzi does not do any security scanning of the downloaded artifacts. For security reasons, you should first verify the artifacts manually and configure the checksum verification to make sure the same artifact is used in the automated build. Required for <code>jar</code>, <code>zip</code>, <code>tgz</code> and <code>other</code> artifacts. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>SHA512 checksum of the artifact. Optional. If specified, the checksum will be verified while building the new container. If not specified, the downloaded artifact will not be verified. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>By default, connections using TLS are verified to check they are secure. The server certificate used must be valid, trusted, and contain the server name. By setting this option to <code>true</code>, all TLS verification is disabled and the artifact will be downloaded, even when the server is considered insecure.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>tgz</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ZipArtifact-reference"><a class="link" href="#type-ZipArtifact-reference">8.2.88. <code>ZipArtifact</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Plugin-reference"><code>Plugin</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URL of the artifact which will be downloaded. Strimzi does not do any security scanning of the downloaded artifacts. For security reasons, you should first verify the artifacts manually and configure the checksum verification to make sure the same artifact is used in the automated build. Required for <code>jar</code>, <code>zip</code>, <code>tgz</code> and <code>other</code> artifacts. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>SHA512 checksum of the artifact. Optional. If specified, the checksum will be verified while building the new container. If not specified, the downloaded artifact will not be verified. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>By default, connections using TLS are verified to check they are secure. The server certificate used must be valid, trusted, and contain the server name. By setting this option to <code>true</code>, all TLS verification is disabled and the artifact will be downloaded, even when the server is considered insecure.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>zip</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-MavenArtifact-reference"><a class="link" href="#type-MavenArtifact-reference">8.2.89. <code>MavenArtifact</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Plugin-reference"><code>Plugin</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>MavenArtifact</code> type from <a href="#type-JarArtifact-reference"><code>JarArtifact</code></a>, <a href="#type-TgzArtifact-reference"><code>TgzArtifact</code></a>, <a href="#type-ZipArtifact-reference"><code>ZipArtifact</code></a>, <a href="#type-OtherArtifact-reference"><code>OtherArtifact</code></a>.
It must have the value <code>maven</code> for the type <code>MavenArtifact</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repository</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maven repository to download the artifact from. Applicable to the <code>maven</code> artifact type only.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">group</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maven group id. Applicable to the <code>maven</code> artifact type only.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">artifact</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maven artifact id. Applicable to the <code>maven</code> artifact type only.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Maven version number. Applicable to the <code>maven</code> artifact type only.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>maven</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-OtherArtifact-reference"><a class="link" href="#type-OtherArtifact-reference">8.2.90. <code>OtherArtifact</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Plugin-reference"><code>Plugin</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>URL of the artifact which will be downloaded. Strimzi does not do any security scanning of the downloaded artifacts. For security reasons, you should first verify the artifacts manually and configure the checksum verification to make sure the same artifact is used in the automated build. Required for <code>jar</code>, <code>zip</code>, <code>tgz</code> and <code>other</code> artifacts. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sha512sum</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>SHA512 checksum of the artifact. Optional. If specified, the checksum will be verified while building the new container. If not specified, the downloaded artifact will not be verified. Not applicable to the <code>maven</code> artifact type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fileName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name under which the artifact will be stored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>By default, connections using TLS are verified to check they are secure. The server certificate used must be valid, trusted, and contain the server name. By setting this option to <code>true</code>, all TLS verification is disabled and the artifact will be downloaded, even when the server is considered insecure.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>other</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnectStatus-reference"><a class="link" href="#type-KafkaConnectStatus-reference">8.2.91. <code>KafkaConnectStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPlugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The list of connector plugins available in this Kafka Connect deployment.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ConnectorPlugin-reference"><code>ConnectorPlugin</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Label selector for pods providing this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The current number of pods being used to provide this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-ConnectorPlugin-reference"><a class="link" href="#type-ConnectorPlugin-reference">8.2.92. <code>ConnectorPlugin</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a>, <a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The type of the connector plugin. The available types are <code>sink</code> and <code>source</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The version of the connector plugin.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The class of the connector plugin.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaTopic-reference"><a class="link" href="#type-KafkaTopic-reference">8.2.93. <code>KafkaTopic</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicSpec-reference"><code>KafkaTopicSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the topic.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaTopicSpec-reference"><a class="link" href="#type-KafkaTopicSpec-reference">8.2.94. <code>KafkaTopicSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">partitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of partitions the topic should have. This cannot be decreased after topic creation. It can be increased after topic creation, but it is important to understand the consequences that has, especially for topics with semantic partitioning. When absent this will default to the broker configuration for <code>num.partitions</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of replicas the topic should have. When absent this will default to the broker configuration for <code>default.replication.factor</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The topic configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the topic. When absent this will default to the metadata.name of the topic. It is recommended to not set this unless the topic name is not a valid Kubernetes resource name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaTopicStatus-reference"><a class="link" href="#type-KafkaTopicStatus-reference">8.2.95. <code>KafkaTopicStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Topic name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUser-reference"><a class="link" href="#type-KafkaUser-reference">8.2.96. <code>KafkaUser</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka User.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserSpec-reference"><a class="link" href="#type-KafkaUserSpec-reference">8.2.97. <code>KafkaUserSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication mechanism enabled for this Kafka user. The supported authentication mechanisms are <code>scram-sha-512</code>, <code>tls</code>, and <code>tls-external</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scram-sha-512</code> generates a secret with SASL SCRAM-SHA-512 credentials.</p>
</li>
<li>
<p><code>tls</code> generates a secret with user certificate for mutual TLS authentication.</p>
</li>
<li>
<p><code>tls-external</code> does not generate a user certificate.   But prepares the user for using mutual TLS authentication using a user certificate generated outside the User Operator.
ACLs and quotas set for this user are configured in the <code>CN=&lt;username&gt;</code> format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Authentication is optional. If authentication is not configured, no credentials are generated. ACLs and quotas set for the user are configured in the <code>&lt;username&gt;</code> format suitable for SASL authentication. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, tls-external, scram-sha-512].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>, <a href="#type-KafkaUserTlsExternalClientAuthentication-reference"><code>KafkaUserTlsExternalClientAuthentication</code></a>, <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authorization rules for this Kafka user. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quotas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Quotas on requests to control the broker resources used by clients. Network bandwidth and request rate quotas can be enforced.Kafka documentation for Kafka User quotas can be found at <a href="http://kafka.apache.org/documentation/#design_quotas" class="bare">http://kafka.apache.org/documentation/#design_quotas</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserQuotas-reference"><code>KafkaUserQuotas</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template to specify how Kafka User <code>Secrets</code> are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserTlsClientAuthentication-reference"><a class="link" href="#type-KafkaUserTlsClientAuthentication-reference">8.2.98. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaUserTlsClientAuthentication</code> type from <a href="#type-KafkaUserTlsExternalClientAuthentication-reference"><code>KafkaUserTlsExternalClientAuthentication</code></a>, <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaUserTlsClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>tls</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserTlsExternalClientAuthentication-reference"><a class="link" href="#type-KafkaUserTlsExternalClientAuthentication-reference">8.2.99. <code>KafkaUserTlsExternalClientAuthentication</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaUserTlsExternalClientAuthentication</code> type from <a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>, <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a>.
It must have the value <code>tls-external</code> for the type <code>KafkaUserTlsExternalClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>tls-external</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserScramSha512ClientAuthentication-reference"><a class="link" href="#type-KafkaUserScramSha512ClientAuthentication-reference">8.2.100. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaUserScramSha512ClientAuthentication</code> type from <a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>, <a href="#type-KafkaUserTlsExternalClientAuthentication-reference"><code>KafkaUserTlsExternalClientAuthentication</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaUserScramSha512ClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specify the password for the user. If not set, a new password is generated by the User Operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Password-reference"><code>Password</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>scram-sha-512</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-Password-reference"><a class="link" href="#type-Password-reference">8.2.101. <code>Password</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Secret from which the password should be read.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSource-reference"><code>PasswordSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-PasswordSource-reference"><a class="link" href="#type-PasswordSource-reference">8.2.102. <code>PasswordSource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-Password-reference"><code>Password</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Selects a key of a Secret in the resource&#8217;s namespace. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretkeyselector-v1-core">external documentation for core/v1 secretkeyselector</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#secretkeyselector-v1-core">SecretKeySelector</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserAuthorizationSimple-reference"><a class="link" href="#type-KafkaUserAuthorizationSimple-reference">8.2.103. <code>KafkaUserAuthorizationSimple</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>KafkaUserAuthorizationSimple</code> type from other subtypes which may be added in the future.
It must have the value <code>simple</code> for the type <code>KafkaUserAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>simple</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of ACL rules which should be applied to this user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRule-reference"><code>AclRule</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AclRule-reference"><a class="link" href="#type-AclRule-reference">8.2.104. <code>AclRule</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-AclRule-schema-reference">Full list of <code>AclRule</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures access control rules for a <code>KafkaUser</code> when brokers are using the <code>AclAuthorizer</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaUser</code> configuration with authorization</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operations:
          - Read
          - Describe
      - resource:
          type: group
          name: my-group
          patternType: prefix
        operations:
          - Read</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="property-acl-resource-reference"><a class="link" href="#property-acl-resource-reference"><code>resource</code></a></h5>
<div class="paragraph">
<p>Use the <code>resource</code> property to specify the resource that the rule applies to.</p>
</div>
<div class="paragraph">
<p>Simple authorization supports four resource types, which are specified in the <code>type</code> property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topics (<code>topic</code>)</p>
</li>
<li>
<p>Consumer Groups (<code>group</code>)</p>
</li>
<li>
<p>Clusters (<code>cluster</code>)</p>
</li>
<li>
<p>Transactional IDs (<code>transactionalId</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Topic, Group, and Transactional ID resources you can specify the name of the resource the rule applies to in the <code>name</code> property.</p>
</div>
<div class="paragraph">
<p>Cluster type resources have no name.</p>
</div>
<div class="paragraph">
<p>A name is specified as a <code>literal</code> or a <code>prefix</code> using the <code>patternType</code> property.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literal names are taken exactly as they are specified in the <code>name</code> field.</p>
</li>
<li>
<p>Prefix names use the <code>name</code> value as a prefix and then apply the rule to all resources with names starting with that value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When <code>patternType</code> is set as <code>literal</code>, you can set the name to <code>*</code> to indicate that the rule applies to all resources.</p>
</div>
<div class="listingblock">
<div class="title">Example ACL rule that allows the user to read messages from all topics</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    acls:
      - resource:
          type: topic
          name: "*"
          patternType: literal
        operations:
          - Read</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="property-acl-type-reference"><a class="link" href="#property-acl-type-reference"><code>type</code></a></h5>
<div class="paragraph">
<p>The <code>type</code> of rule, which is to <code>allow</code> or <code>deny</code> (not currently supported) an operations.</p>
</div>
<div class="paragraph">
<p>The <code>type</code> field is optional.
If <code>type</code> is unspecified, the ACL rule is treated as an <code>allow</code> rule.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-acl-operation-reference"><a class="link" href="#property-acl-operation-reference"><code>operations</code></a></h5>
<div class="paragraph">
<p>Specify a list of <code>operations</code> for the rule to allow or deny.</p>
</div>
<div class="paragraph">
<p>The following operations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read</p>
</li>
<li>
<p>Write</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Alter</p>
</li>
<li>
<p>Describe</p>
</li>
<li>
<p>All</p>
</li>
<li>
<p>IdempotentWrite</p>
</li>
<li>
<p>ClusterAction</p>
</li>
<li>
<p>Create</p>
</li>
<li>
<p>AlterConfigs</p>
</li>
<li>
<p>DescribeConfigs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only certain operations work with each resource.</p>
</div>
<div class="paragraph">
<p>For more details about <code>AclAuthorizer</code>, ACLs and supported combinations of resources and operations, see <a href="http://kafka.apache.org/documentation/#security_authz" target="_blank" rel="noopener">Authorization and ACLs</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-acl-host-reference"><a class="link" href="#property-acl-host-reference"><code>host</code></a></h5>
<div class="paragraph">
<p>Use the <code>host</code> property to specify a remote host from which the rule is allowed or denied.</p>
</div>
<div class="paragraph">
<p>Use an asterisk (<code>*</code>) to allow or deny the operation from all hosts.
The <code>host</code> field is optional. If <code>host</code> is unspecified, the <code>*</code> value is used by default.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-AclRule-schema-reference"><a class="link" href="#type-AclRule-schema-reference"><code>AclRule</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The host from which the action described in the ACL rule is allowed or denied.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>operation</code> property has been deprecated, and should now be configured using <code>spec.authorization.acls[*].operations</code>.</strong> Operation which will be allowed or denied. Supported operations are: Read, Write, Create, Delete, Alter, Describe, ClusterAction, AlterConfigs, DescribeConfigs, IdempotentWrite and All.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Read, Write, Delete, Alter, Describe, All, IdempotentWrite, ClusterAction, Create, AlterConfigs, DescribeConfigs])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of operations which will be allowed or denied. Supported operations are: Read, Write, Create, Delete, Alter, Describe, ClusterAction, AlterConfigs, DescribeConfigs, IdempotentWrite and All.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one or more of [Read, Write, Delete, Alter, Describe, All, IdempotentWrite, ClusterAction, Create, AlterConfigs, DescribeConfigs]) array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Indicates the resource for which given ACL rule applies. The type depends on the value of the <code>resource.type</code> property within the given object, which must be one of [topic, group, cluster, transactionalId].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The type of the rule. Currently the only supported type is <code>allow</code>. ACL rules with type <code>allow</code> are used to allow user to execute the specified operations. Default value is <code>allow</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [allow, deny])</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-AclRuleTopicResource-reference"><a class="link" href="#type-AclRuleTopicResource-reference">8.2.105. <code>AclRuleTopicResource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>AclRuleTopicResource</code> type from <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>topic</code> for the type <code>AclRuleTopicResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>topic</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AclRuleGroupResource-reference"><a class="link" href="#type-AclRuleGroupResource-reference">8.2.106. <code>AclRuleGroupResource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>AclRuleGroupResource</code> type from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>group</code> for the type <code>AclRuleGroupResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>group</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AclRuleClusterResource-reference"><a class="link" href="#type-AclRuleClusterResource-reference">8.2.107. <code>AclRuleClusterResource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>AclRuleClusterResource</code> type from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>cluster</code> for the type <code>AclRuleClusterResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>cluster</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AclRuleTransactionalIdResource-reference"><a class="link" href="#type-AclRuleTransactionalIdResource-reference">8.2.108. <code>AclRuleTransactionalIdResource</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes use of the <code>AclRuleTransactionalIdResource</code> type from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>.
It must have the value <code>transactionalId</code> for the type <code>AclRuleTransactionalIdResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Must be <code>transactionalId</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaUserQuotas-reference"><a class="link" href="#type-KafkaUserQuotas-reference">8.2.109. <code>KafkaUserQuotas</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaUserQuotas-schema-reference">Full list of <code>KafkaUserQuotas</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Kafka allows a user to set <code>quotas</code> to control the use of resources by clients.</p>
</div>
<div class="sect4">
<h5 id="quotas"><a class="link" href="#quotas"><code>quotas</code></a></h5>
<div class="paragraph">
<p>You can configure your clients to use the following types of quotas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Network usage</em> quotas specify the byte rate threshold for each group of clients sharing a quota.</p>
</li>
<li>
<p><em>CPU utilization</em> quotas specify a window for broker requests from clients. The window is the percentage of time for clients to make requests. A client makes requests on the I/O threads and network threads of the broker.</p>
</li>
<li>
<p><em>Partition mutation</em> quotas limit the number of partition mutations which clients are allowed to make per second.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A partition mutation quota prevents Kafka clusters from being overwhelmed by concurrent topic operations.
Partition mutations occur in response to the following types of user requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating partitions for a new topic</p>
</li>
<li>
<p>Adding partitions to an existing topic</p>
</li>
<li>
<p>Deleting partitions from a topic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure a partition mutation quota to control the rate at which mutations are accepted for user requests.</p>
</div>
<div class="paragraph">
<p>Using quotas for Kafka clients might be useful in a number of situations.
Consider a wrongly configured Kafka producer which is sending requests at too high a rate.
Such misconfiguration can cause a denial of service to other clients, so the problematic client ought to be blocked.
By using a network limiting quota, it is possible to prevent this situation from significantly impacting other clients.</p>
</div>
<div class="paragraph">
<p>Strimzi supports user-level quotas, but not client-level quotas.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka user quota configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  quotas:
    producerByteRate: 1048576
    consumerByteRate: 2097152
    requestPercentage: 55
    controllerMutationRate: 10</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about Kafka user quotas, refer to the <a href="http://kafka.apache.org/documentation/#design_quotas" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaUserQuotas-schema-reference"><a class="link" href="#type-KafkaUserQuotas-schema-reference"><code>KafkaUserQuotas</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumerByteRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A quota on the maximum bytes per-second that each client group can fetch from a broker before the clients in the group are throttled. Defined on a per-broker basis.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">controllerMutationRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A quota on the rate at which mutations are accepted for the create topics request, the create partitions request and the delete topics request. The rate is accumulated by the number of partitions created or deleted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producerByteRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A quota on the maximum bytes per-second that each client group can publish to a broker before the clients in the group are throttled. Defined on a per-broker basis.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestPercentage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A quota on the maximum CPU utilization of each client group as a percentage of network and I/O threads.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaUserTemplate-reference"><a class="link" href="#type-KafkaUserTemplate-reference">8.2.110. <code>KafkaUserTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaUserTemplate-schema-reference">Full list of <code>KafkaUserTemplate</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Specify additional labels and annotations for the secret created by the User Operator.</p>
</div>
<div class="listingblock">
<div class="title">An example showing the <code>KafkaUserTemplate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  template:
    secret:
      metadata:
        labels:
          label1: value1
        annotations:
          anno1: value1
  # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaUserTemplate-schema-reference"><a class="link" href="#type-KafkaUserTemplate-schema-reference"><code>KafkaUserTemplate</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for KafkaUser resources. The template allows users to specify how the <code>Secret</code> with password or TLS certificates is generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaUserStatus-reference"><a class="link" href="#type-KafkaUserStatus-reference">8.2.111. <code>KafkaUserStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Username.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of <code>Secret</code> where the credentials are stored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker-reference"><a class="link" href="#type-KafkaMirrorMaker-reference">8.2.112. <code>KafkaMirrorMaker</code> schema reference</a></h4>
<div class="paragraph">
<p><strong>The type <code>KafkaMirrorMaker</code> has been deprecated.</strong>
Please use <a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code></a> instead.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of Kafka MirrorMaker.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of Kafka MirrorMaker.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMakerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerSpec-reference">8.2.113. <code>KafkaMirrorMakerSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMakerSpec-schema-reference">Full list of <code>KafkaMirrorMakerSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures Kafka MirrorMaker.</p>
</div>
<div class="sect4">
<h5 id="property-mm-include-reference"><a class="link" href="#property-mm-include-reference"><code>include</code></a></h5>
<div class="paragraph">
<p>Use the <code>include</code> property to configure a list of topics that Kafka MirrorMaker mirrors from the source to the target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The property allows any regular expression from the simplest case with a single topic name to complex patterns.
For example, you can mirror topics A and B using <code>A|B</code> or all topics using <code>*</code>.
You can also pass multiple regular expressions separated by commas to the Kafka MirrorMaker.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-mm-producer-consumer-reference"><a class="link" href="#property-mm-producer-consumer-reference"><code>KafkaMirrorMakerConsumerSpec</code> and <code>KafkaMirrorMakerProducerSpec</code></a></h5>
<div class="paragraph">
<p>Use the <code>KafkaMirrorMakerConsumerSpec</code> and <code>KafkaMirrorMakerProducerSpec</code> to configure source (consumer) and target (producer) clusters.</p>
</div>
<div class="paragraph">
<p>Kafka MirrorMaker always works together with two Kafka clusters (source and target).
To establish a connection, the bootstrap servers for the source and the target Kafka clusters are specified as comma-separated lists of <code><em>HOSTNAME:PORT</em></code> pairs.
Each comma-separated list contains one or more Kafka brokers or a <code>Service</code> pointing to Kafka brokers specified as a <code><em>HOSTNAME:PORT</em></code> pair.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-mm-loggers-reference"><a class="link" href="#property-mm-loggers-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>Kafka MirrorMaker has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mirrormaker.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MirrorMaker uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>. Both <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory. A ConfigMap using the exact logging configuration specified is created with the custom resource when the Cluster Operator is running, then recreated after each reconciliation. If you do not specify a custom ConfigMap, default logging settings are used. If a specific logger value is not set, upper-level logger settings are inherited for that logger.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: customConfigMap
        key: mirror-maker-log4j.properties
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaMirrorMakerSpec-schema-reference"><a class="link" href="#type-KafkaMirrorMakerSpec-schema-reference"><code>KafkaMirrorMakerSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka MirrorMaker version. Defaults to 3.3.2. Consult the documentation to understand the process required to upgrade or downgrade the version.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of source cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of target cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">whitelist</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>whitelist</code> property has been deprecated, and should now be configured using <code>spec.include</code>.</strong> List of topics which are included for mirroring. This option allows any regular expression using Java-style regular expressions. Mirroring two topics named A and B is achieved by using the expression <code>A|B</code>. Or, as a special case, you can mirror all topics using the regular expression <code>*</code>. You can also specify multiple regular expressions separated by commas.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">include</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of topics which are included for mirroring. This option allows any regular expression using Java-style regular expressions. Mirroring two topics named A and B is achieved by using the expression <code>A|B</code>. Or, as a special case, you can mirror all topics using the regular expression <code>*</code>. You can also specify multiple regular expressions separated by commas.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for MirrorMaker. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The configuration of tracing in Kafka MirrorMaker. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger, opentelemetry].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a>, <a href="#type-OpenTelemetryTracing-reference"><code>OpenTelemetryTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template to specify how Kafka MirrorMaker resources, <code>Deployments</code> and <code>Pods</code>, are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMakerConsumerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerConsumerSpec-reference">8.2.114. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMakerConsumerSpec-schema-reference">Full list of <code>KafkaMirrorMakerConsumerSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a MirrorMaker consumer.</p>
</div>
<div class="sect4">
<h5 id="property-consumer-streams-reference"><a class="link" href="#property-consumer-streams-reference"><code>numStreams</code></a></h5>
<div class="paragraph">
<p>Use the <code>consumer.numStreams</code> property to configure the number of streams for the consumer.</p>
</div>
<div class="paragraph">
<p>You can increase the throughput in mirroring topics by increasing the number of consumer threads.
Consumer threads belong to the consumer group specified for Kafka MirrorMaker.
Topic partitions are assigned across the consumer threads, which consume messages in parallel.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-consumer-offset-autocommit-reference"><a class="link" href="#property-consumer-offset-autocommit-reference"><code>offsetCommitInterval</code></a></h5>
<div class="paragraph">
<p>Use the <code>consumer.offsetCommitInterval</code> property to configure an offset auto-commit interval for the consumer.</p>
</div>
<div class="paragraph">
<p>You can specify the regular time interval at which an offset is committed after Kafka MirrorMaker has consumed data from the source Kafka cluster.
The time interval is set in milliseconds, with a default value of 60,000.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-consumer-config-reference"><a class="link" href="#property-consumer-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>consumer.config</code> properties to configure Kafka options for the consumer.</p>
</div>
<div class="paragraph">
<p>The <code>config</code> property contains the Kafka MirrorMaker consumer configuration options as keys, with values set in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
<div class="paragraph">
<p><strong>Exceptions</strong></p>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#consumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a>.</p>
</div>
<div class="paragraph">
<p>However, there are exceptions for options automatically configured and managed directly by Strimzi related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (encryption, authentication, and authorization)</p>
</li>
<li>
<p>Consumer group identifier</p>
</li>
<li>
<p>Interceptors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
<li>
<p><code>interceptor.classes</code></p>
</li>
<li>
<p><code>ssl.</code> (<a href="#con-common-configuration-ssl-reference">not including specific exceptions</a>)</p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka MirrorMaker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When an invalid configuration is provided, the Kafka MirrorMaker might not start or might become unstable.
In such cases, the configuration in the <code>KafkaMirrorMaker.spec.consumer.config</code> object should be fixed and the Cluster Operator will roll out the new configuration for Kafka MirrorMaker.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="property-consumer-group-reference"><a class="link" href="#property-consumer-group-reference"><code>groupId</code></a></h5>
<div class="paragraph">
<p>Use the <code>consumer.groupId</code> property to configure a consumer group identifier for the consumer.</p>
</div>
<div class="paragraph">
<p>Kafka MirrorMaker uses a Kafka consumer to consume messages, behaving like any other Kafka consumer client.
Messages consumed from the source Kafka cluster are mirrored to a target Kafka cluster.
A group identifier is required, as the consumer needs to be part of a consumer group for the assignment of partitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaMirrorMakerConsumerSpec-schema-reference"><a class="link" href="#type-KafkaMirrorMakerConsumerSpec-schema-reference"><code>KafkaMirrorMakerConsumerSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numStreams</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the number of consumer stream threads to create.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offsetCommitInterval</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Specifies the offset auto-commit interval in ms. Default value is 60000.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A unique string that identifies the consumer group this consumer belongs to.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-256, scram-sha-512, plain, oauth].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The MirrorMaker consumer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security., interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS configuration for connecting MirrorMaker to the cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ClientTls-reference"><code>ClientTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMakerProducerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerProducerSpec-reference">8.2.115. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMakerProducerSpec-schema-reference">Full list of <code>KafkaMirrorMakerProducerSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a MirrorMaker producer.</p>
</div>
<div class="sect4">
<h5 id="property-producer-abort-on-send-reference"><a class="link" href="#property-producer-abort-on-send-reference"><code>abortOnSendFailure</code></a></h5>
<div class="paragraph">
<p>Use the <code>producer.abortOnSendFailure</code> property to configure how to handle message send failure from the producer.</p>
</div>
<div class="paragraph">
<p>By default, if an error occurs when sending a message from Kafka MirrorMaker to a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka MirrorMaker container is terminated in Kubernetes.</p>
</li>
<li>
<p>The container is then recreated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>abortOnSendFailure</code> option is set to <code>false</code>, message sending errors are ignored.</p>
</div>
</div>
<div class="sect4">
<h5 id="property-producer-config-reference"><a class="link" href="#property-producer-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>producer.config</code> properties to configure Kafka options for the producer.</p>
</div>
<div class="paragraph">
<p>The <code>config</code> property contains the Kafka MirrorMaker producer configuration options as keys, with values set in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
<div class="paragraph">
<p><strong>Exceptions</strong></p>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a>.</p>
</div>
<div class="paragraph">
<p>However, there are exceptions for options automatically configured and managed directly by Strimzi related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (encryption, authentication, and authorization)</p>
</li>
<li>
<p>Interceptors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>interceptor.classes</code></p>
</li>
<li>
<p><code>ssl.</code> (<a href="#con-common-configuration-ssl-reference">not including specific exceptions</a>)</p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka MirrorMaker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When an invalid configuration is provided, the Kafka MirrorMaker might not start or might become unstable.
In such cases, the configuration in the <code>KafkaMirrorMaker.spec.producer.config</code> object should be fixed and the Cluster Operator will roll out the new configuration for Kafka MirrorMaker.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaMirrorMakerProducerSpec-schema-reference"><a class="link" href="#type-KafkaMirrorMakerProducerSpec-schema-reference"><code>KafkaMirrorMakerProducerSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abortOnSendFailure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Flag to set the MirrorMaker to exit on a failed send. Default value is <code>true</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-256, scram-sha-512, plain, oauth].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The MirrorMaker producer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security., interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS configuration for connecting MirrorMaker to the cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ClientTls-reference"><code>ClientTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMakerTemplate-reference"><a class="link" href="#type-KafkaMirrorMakerTemplate-reference">8.2.116. <code>KafkaMirrorMakerTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka MirrorMaker <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka MirrorMaker <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka MirrorMaker <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mirrorMakerContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka MirrorMaker container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka MirrorMaker service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMakerStatus-reference"><a class="link" href="#type-KafkaMirrorMakerStatus-reference">8.2.117. <code>KafkaMirrorMakerStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Label selector for pods providing this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The current number of pods being used to provide this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaBridge-reference"><a class="link" href="#type-KafkaBridge-reference">8.2.118. <code>KafkaBridge</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka Bridge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka Bridge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeSpec-reference"><a class="link" href="#type-KafkaBridgeSpec-reference">8.2.119. <code>KafkaBridgeSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaBridgeSpec-schema-reference">Full list of <code>KafkaBridgeSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka Bridge cluster.</p>
</div>
<div class="paragraph">
<p>Configuration options relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Consumer configuration</p>
</li>
<li>
<p>Producer configuration</p>
</li>
<li>
<p>HTTP configuration</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="property-kafka-bridge-logging-reference"><a class="link" href="#property-kafka-bridge-logging-reference"><code>logging</code></a></h5>
<div class="paragraph">
<p>Kafka Bridge has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logger.bridge</code></p>
</li>
<li>
<p><code>logger.<em>&lt;operation-id&gt;</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can replace <code><em>&lt;operation-id&gt;</em></code> in the <code>logger.<em>&lt;operation-id&gt;</em></code> logger to set log levels for specific operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createConsumer</code></p>
</li>
<li>
<p><code>deleteConsumer</code></p>
</li>
<li>
<p><code>subscribe</code></p>
</li>
<li>
<p><code>unsubscribe</code></p>
</li>
<li>
<p><code>poll</code></p>
</li>
<li>
<p><code>assign</code></p>
</li>
<li>
<p><code>commit</code></p>
</li>
<li>
<p><code>send</code></p>
</li>
<li>
<p><code>sendToPartition</code></p>
</li>
<li>
<p><code>seekToBeginning</code></p>
</li>
<li>
<p><code>seekToEnd</code></p>
</li>
<li>
<p><code>seek</code></p>
</li>
<li>
<p><code>healthy</code></p>
</li>
<li>
<p><code>ready</code></p>
</li>
<li>
<p><code>openapi</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each operation is defined according OpenAPI specification, and has a corresponding API endpoint through which the bridge receives requests from HTTP clients.
You can change the log level on each endpoint to create fine-grained logging information about the incoming and outgoing HTTP requests.</p>
</div>
<div class="paragraph">
<p>Each logger has to be configured assigning it a <code>name</code> as <code>http.openapi.operation.<em>&lt;operation-id&gt;</em></code>.
For example, configuring the logging level for the <code>send</code> operation logger means defining the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logger.send.name = http.openapi.operation.send
logger.send.level = DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka Bridge uses the Apache <code>log4j2</code> logger implementation.
Loggers are defined in the <code>log4j2.properties</code> file, which has the following default configuration for <code>healthy</code> and <code>ready</code> endpoints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logger.healthy.name = http.openapi.operation.healthy
logger.healthy.level = WARN
logger.ready.name = http.openapi.operation.ready
logger.ready.level = WARN</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log level of all other operations is set to <code>INFO</code> by default.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.valueFrom.configMapKeyRef.name</code> property to the name of the ConfigMap containing the external logging configuration.
The <code>logging.valueFrom.configMapKeyRef.name</code> and <code>logging.valueFrom.configMapKeyRef.key</code> properties are mandatory.
Default logging is used if the <code>name</code> or <code>key</code> is not set.
Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
spec:
  # ...
  logging:
    type: inline
    loggers:
      logger.bridge.level: "INFO"
      # enabling DEBUG just for send operation
      logger.send.name: "http.openapi.operation.send"
      logger.send.level: "DEBUG"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
spec:
  # ...
  logging:
    type: external
    valueFrom:
      configMapKeyRef:
        name: customConfigMap
        key: bridge-logj42.properties
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any available loggers that are not configured have their level set to <code>OFF</code>.</p>
</div>
<div class="paragraph">
<p>If the Kafka Bridge was deployed using the Cluster Operator,
changes to Kafka Bridge logging levels are applied dynamically.</p>
</div>
<div class="paragraph">
<p>If you use external logging, a rolling update is triggered when logging appenders are changed.</p>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaBridgeSpec-schema-reference"><a class="link" href="#type-KafkaBridgeSpec-schema-reference"><code>KafkaBridgeSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS configuration for connecting Kafka Bridge to the cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ClientTls-reference"><code>ClientTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-256, scram-sha-512, plain, oauth].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The HTTP related configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeHttpConfig-reference"><code>KafkaBridgeHttpConfig</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">adminClient</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka AdminClient related configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeAdminClientSpec-reference"><code>KafkaBridgeAdminClientSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka consumer related configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeConsumerSpec-reference"><code>KafkaBridgeConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka producer related configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeProducerSpec-reference"><code>KafkaBridgeProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CPU and memory resources to reserve. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>Currently not supported</strong> JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for Kafka Bridge. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image of the init container used for initializing the <code>client.rack</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the node label which will be used as the client.rack consumer configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enable the metrics for the Kafka Bridge. Default is false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Bridge resources. The template allows users to specify how a <code>Deployment</code> and <code>Pod</code> is generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The configuration of tracing in Kafka Bridge. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger, opentelemetry].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a>, <a href="#type-OpenTelemetryTracing-reference"><code>OpenTelemetryTracing</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeHttpConfig-reference"><a class="link" href="#type-KafkaBridgeHttpConfig-reference">8.2.120. <code>KafkaBridgeHttpConfig</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaBridgeHttpConfig-schema-reference">Full list of <code>KafkaBridgeHttpConfig</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures HTTP access to a Kafka cluster for the Kafka Bridge.</p>
</div>
<div class="paragraph">
<p>The default HTTP configuration is for the Kafka Bridge to listen on port 8080.</p>
</div>
<div class="sect4">
<h5 id="property-kafka-bridge-cors-config-reference"><a class="link" href="#property-kafka-bridge-cors-config-reference"><code>cors</code></a></h5>
<div class="paragraph">
<p>As well as enabling HTTP access to a Kafka cluster, HTTP properties provide the capability to enable and define access control for the Kafka Bridge through Cross-Origin Resource Sharing (CORS).
CORS is a HTTP mechanism that allows browser access to selected resources from more than one origin.
To configure CORS, you define a list of allowed resource origins and HTTP access methods.
For the origins, you can use a URL or a Java regular expression.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge HTTP configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  http:
    port: 8080
    cors:
      allowedOrigins: "https://strimzi.io"
      allowedMethods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaBridgeHttpConfig-schema-reference"><a class="link" href="#type-KafkaBridgeHttpConfig-schema-reference"><code>KafkaBridgeHttpConfig</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The port which is the server listening on.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>CORS configuration for the HTTP Bridge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeHttpCors-reference"><code>KafkaBridgeHttpCors</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeHttpCors-reference"><a class="link" href="#type-KafkaBridgeHttpCors-reference">8.2.121. <code>KafkaBridgeHttpCors</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeHttpConfig-reference"><code>KafkaBridgeHttpConfig</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedOrigins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of allowed origins. Java regular expressions can be used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedMethods</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of allowed HTTP methods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeAdminClientSpec-reference"><a class="link" href="#type-KafkaBridgeAdminClientSpec-reference">8.2.122. <code>KafkaBridgeAdminClientSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka AdminClient configuration used for AdminClient instances created by the bridge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeConsumerSpec-reference"><a class="link" href="#type-KafkaBridgeConsumerSpec-reference">8.2.123. <code>KafkaBridgeConsumerSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaBridgeConsumerSpec-schema-reference">Full list of <code>KafkaBridgeConsumerSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures consumer options for the Kafka Bridge as keys.</p>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#consumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message will be printed to the Cluster Operator log file.
All other options will be passed to Kafka</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object.
If an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
Fix the configuration so that the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge consumer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  consumer:
    config:
      auto.offset.reset: earliest
      enable.auto.commit: true
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS
    # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaBridgeConsumerSpec-schema-reference"><a class="link" href="#type-KafkaBridgeConsumerSpec-schema-reference"><code>KafkaBridgeConsumerSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka consumer configuration used for consumer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security. (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeProducerSpec-reference"><a class="link" href="#type-KafkaBridgeProducerSpec-reference">8.2.124. <code>KafkaBridgeProducerSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaBridgeProducerSpec-schema-reference">Full list of <code>KafkaBridgeProducerSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures producer options for the Kafka Bridge as keys.</p>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="https://kafka.apache.org/documentation/#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message will be printed to the Cluster Operator log file.
All other options will be passed to Kafka</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object.
If an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
Fix the configuration so that the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge producer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  producer:
    config:
      acks: 1
      delivery.timeout.ms: 300000
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS
    # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaBridgeProducerSpec-schema-reference"><a class="link" href="#type-KafkaBridgeProducerSpec-schema-reference"><code>KafkaBridgeProducerSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka producer configuration used for producer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security. (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeTemplate-reference"><a class="link" href="#type-KafkaBridgeTemplate-reference">8.2.125. <code>KafkaBridgeTemplate</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Bridge <code>Deployment</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-DeploymentTemplate-reference"><code>DeploymentTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Bridge <code>Pods</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Bridge API <code>Service</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InternalServiceTemplate-reference"><code>InternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Bridge <code>PodDisruptionBudget</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bridgeContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Bridge container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterRoleBinding</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Bridge ClusterRoleBinding.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serviceAccount</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Bridge service account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for the Kafka Bridge init container.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaBridgeStatus-reference"><a class="link" href="#type-KafkaBridgeStatus-reference">8.2.126. <code>KafkaBridgeStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The URL at which external client applications can access the Kafka Bridge.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Label selector for pods providing this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The current number of pods being used to provide this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnector-reference"><a class="link" href="#type-KafkaConnector-reference">8.2.127. <code>KafkaConnector</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectorSpec-reference"><code>KafkaConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaConnectorSpec-reference"><a class="link" href="#type-KafkaConnectorSpec-reference">8.2.128. <code>KafkaConnectorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnector-reference"><code>KafkaConnector</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Class for the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum number of tasks for the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoRestart</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Automatic restart of connector and tasks configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AutoRestart-reference"><code>AutoRestart</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka Connector configuration. The following properties cannot be set: connector.class, tasks.max.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pause</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether the connector should be paused. Defaults to false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AutoRestart-reference"><a class="link" href="#type-AutoRestart-reference">8.2.129. <code>AutoRestart</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectorSpec-reference"><code>KafkaConnectorSpec</code></a>, <a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-AutoRestart-schema-reference">Full list of <code>AutoRestart</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures automatic restarts for connectors and tasks that are in a <code>FAILED</code> state.</p>
</div>
<div class="paragraph">
<p>When enabled, a back-off algorithm applies the automatic restart to each failed connector and its tasks.</p>
</div>
<div class="paragraph">
<p>The operator attempts an automatic restart on reconciliation.
If the first attempt fails, the operator makes up to six more attempts.
The duration between each restart attempt increases from 2 to 30 minutes.
After each restart, failed connectors and tasks transit from <code>FAILED</code> to <code>RESTARTING</code>.
If the restart fails after the final attempt, there is likely to be a problem with the connector configuration.
The connector and tasks remain in a <code>FAILED</code> state and you have to restart them manually.
You can do this by annotating the <code>KafKaConnector</code> custom resource with <code>strimzi.io/restart: "true"</code>.</p>
</div>
<div class="paragraph">
<p>For Kafka Connect connectors, use the <code>autoRestart</code> property of the <code>KafkaConnector</code> resource to enable automatic restarts of failed connectors and tasks.</p>
</div>
<div class="listingblock">
<div class="title">Enabling automatic restarts of failed connectors for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaConnector
metadata:
  name: my-source-connector
spec:
  autoRestart:
    enabled: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>For MirrorMaker 2.0, use the <code>autoRestart</code> property of connectors in the <code>KafkaMirrorMaker2</code> resource to enable automatic restarts of failed connectors and tasks.</p>
</div>
<div class="listingblock">
<div class="title">Enabling automatic restarts of failed connectors for MirrorMaker 2.0</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaMirrorMaker2
metadata:
  name: my-mm2-cluster
spec:
  mirrors:
  - sourceConnector:
      autoRestart:
        enabled: true
      # ...
    heartbeatConnector:
      autoRestart:
        enabled: true
      # ...
    checkpointConnector:
      autoRestart:
        enabled: true
      # ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="type-AutoRestart-schema-reference"><a class="link" href="#type-AutoRestart-schema-reference"><code>AutoRestart</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether automatic restart for failed connectors and tasks should be enabled or disabled.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaConnectorStatus-reference"><a class="link" href="#type-KafkaConnectorStatus-reference">8.2.130. <code>KafkaConnectorStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnector-reference"><code>KafkaConnector</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoRestart</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The auto restart status.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AutoRestartStatus-reference"><code>AutoRestartStatus</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorStatus</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The connector status, as reported by the Kafka Connect REST API.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum number of tasks for the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The list of topics used by the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-AutoRestartStatus-reference"><a class="link" href="#type-AutoRestartStatus-reference">8.2.131. <code>AutoRestartStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code></a>, <a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of times the connector or task is restarted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The name of the connector being restarted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastRestartTimestamp</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The last time the automatic restart was attempted. The required format is 'yyyy-MM-ddTHH:mm:ssZ' in the UTC time zone.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2-reference"><a class="link" href="#type-KafkaMirrorMaker2-reference">8.2.132. <code>KafkaMirrorMaker2</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka MirrorMaker 2.0 cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka MirrorMaker 2.0 cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2Spec-reference"><a class="link" href="#type-KafkaMirrorMaker2Spec-reference">8.2.133. <code>KafkaMirrorMaker2Spec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka Connect version. Defaults to 3.3.2. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The number of pods in the Kafka Connect group.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The docker image for the pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The cluster alias used for Kafka Connect. The alias must match a cluster in the list at <code>spec.clusters</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusters</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Kafka clusters for mirroring.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mirrors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the MirrorMaker 2.0 connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2MirrorSpec-reference"><code>KafkaMirrorMaker2MirrorSpec</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum limits for CPU and memory resources and the requested initial resources. For more information, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">external documentation for core/v1 resourcerequirements</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod liveness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pod readiness checking.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JVM Options for pods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>JMX Options.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The image of the init container used for initializing the <code>client.rack</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Configuration of the node label which will be used as the <code>client.rack</code> consumer configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger, opentelemetry].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a>, <a href="#type-OpenTelemetryTracing-reference"><code>OpenTelemetryTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Template for Kafka Connect and Kafka Mirror Maker 2 resources. The template allows users to specify how the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> are generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metricsConfig</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Metrics configuration. The type depends on the value of the <code>metricsConfig.type</code> property within the given object, which must be one of [jmxPrometheusExporter].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxPrometheusExporterMetrics-reference"><code>JmxPrometheusExporterMetrics</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2ClusterSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2ClusterSpec-reference">8.2.134. <code>KafkaMirrorMaker2ClusterSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<div class="paragraph">
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-schema-reference">Full list of <code>KafkaMirrorMaker2ClusterSpec</code> schema properties</a></p>
</div>
<div class="paragraph">
<p>Configures Kafka clusters for mirroring.</p>
</div>
<div class="sect4">
<h5 id="property-mirrormaker2-config-reference"><a class="link" href="#property-mirrormaker2-config-reference"><code>config</code></a></h5>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka options.</p>
</div>
<div class="paragraph">
<p>Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
</div>
<div class="sect4">
<h5 id="type-KafkaMirrorMaker2ClusterSpec-schema-reference"><a class="link" href="#type-KafkaMirrorMaker2ClusterSpec-schema-reference"><code>KafkaMirrorMaker2ClusterSpec</code> schema properties</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Alias used to reference the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A comma-separated list of <code>host:port</code> pairs for establishing the connection to the Kafka cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>TLS configuration for connecting MirrorMaker 2.0 connectors to a cluster.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ClientTls-reference"><code>ClientTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-256, scram-sha-512, plain, oauth].</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha256-reference"><code>KafkaClientAuthenticationScramSha256</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The MirrorMaker 2.0 cluster config. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2MirrorSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2MirrorSpec-reference">8.2.135. <code>KafkaMirrorMaker2MirrorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The alias of the source cluster used by the Kafka MirrorMaker 2.0 connectors. The alias must match a cluster in the list at <code>spec.clusters</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The alias of the target cluster used by the Kafka MirrorMaker 2.0 connectors. The alias must match a cluster in the list at <code>spec.clusters</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka MirrorMaker 2.0 source connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heartbeatConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka MirrorMaker 2.0 heartbeat connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpointConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka MirrorMaker 2.0 checkpoint connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicsPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A regular expression matching the topics to be mirrored, for example, "topic1|topic2|topic3". Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicsBlacklistPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>topicsBlacklistPattern</code> property has been deprecated, and should now be configured using <code>.spec.mirrors.topicsExcludePattern</code>.</strong> A regular expression matching the topics to exclude from mirroring. Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicsExcludePattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A regular expression matching the topics to exclude from mirroring. Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A regular expression matching the consumer groups to be mirrored. Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsBlacklistPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><strong>The <code>groupsBlacklistPattern</code> property has been deprecated, and should now be configured using <code>.spec.mirrors.groupsExcludePattern</code>.</strong> A regular expression matching the consumer groups to exclude from mirroring. Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsExcludePattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A regular expression matching the consumer groups to exclude from mirroring. Comma-separated lists are also supported.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2ConnectorSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2ConnectorSpec-reference">8.2.136. <code>KafkaMirrorMaker2ConnectorSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2MirrorSpec-reference"><code>KafkaMirrorMaker2MirrorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The maximum number of tasks for the Kafka Connector.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The Kafka Connector configuration. The following properties cannot be set: connector.class, tasks.max.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoRestart</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Automatic restart of connector and tasks configuration.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AutoRestart-reference"><code>AutoRestart</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pause</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether the connector should be paused. Defaults to false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaMirrorMaker2Status-reference"><a class="link" href="#type-KafkaMirrorMaker2Status-reference">8.2.137. <code>KafkaMirrorMaker2Status</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoRestartStatuses</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of MirrorMaker 2.0 connector auto restart statuses.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AutoRestartStatus-reference"><code>AutoRestartStatus</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPlugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The list of connector plugins available in this Kafka Connect deployment.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ConnectorPlugin-reference"><code>ConnectorPlugin</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of MirrorMaker 2.0 connector statuses, as reported by the Kafka Connect REST API.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Label selector for pods providing this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The current number of pods being used to provide this resource.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaRebalance-reference"><a class="link" href="#type-KafkaRebalance-reference">8.2.138. <code>KafkaRebalance</code> schema reference</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The specification of the Kafka rebalance.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaRebalanceSpec-reference"><code>KafkaRebalanceSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The status of the Kafka rebalance.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaRebalanceStatus-reference"><code>KafkaRebalanceStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaRebalanceSpec-reference"><a class="link" href="#type-KafkaRebalanceSpec-reference">8.2.139. <code>KafkaRebalanceSpec</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaRebalance-reference"><code>KafkaRebalance</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Mode to run the rebalancing. The supported modes are <code>full</code>, <code>add-brokers</code>, <code>remove-brokers</code>.
If not specified, the <code>full</code> mode is used by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>full</code> mode runs the rebalancing across all the brokers in the cluster.</p>
</li>
<li>
<p><code>add-brokers</code> mode can be used after scaling up the cluster to move some replicas to the newly added brokers.</p>
</li>
<li>
<p><code>remove-brokers</code> mode can be used before scaling down the cluster to move replicas out of the brokers to be removed.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [remove-brokers, full, add-brokers])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The list of newly added brokers in case of scaling up or the ones to be removed in case of scaling down to use for rebalancing. This list can be used only with rebalancing mode <code>add-brokers</code> and <code>removed-brokers</code>. It is ignored with <code>full</code> mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">goals</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of goals, ordered by decreasing priority, to use for generating and executing the rebalance proposal. The supported goals are available at <a href="https://github.com/linkedin/cruise-control#goals" class="bare">https://github.com/linkedin/cruise-control#goals</a>. If an empty goals list is provided, the goals declared in the default.goals Cruise Control configuration parameter are used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skipHardGoalCheck</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Whether to allow the hard goals specified in the Kafka CR to be skipped in optimization proposal generation. This can be useful when some of those hard goals are preventing a balance solution being found. Default is false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rebalanceDisk</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>Enables intra-broker disk balancing, which balances disk space utilization between disks on the same broker. Only applies to Kafka deployments that use JBOD storage with multiple disks. When enabled, inter-broker balancing is disabled. Default is false.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludedTopics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A regular expression where any matching topics will be excluded from the calculation of optimization proposals. This expression will be parsed by the java.util.regex.Pattern class; for more information on the supported format consult the documentation for that class.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentPartitionMovementsPerBroker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The upper bound of ongoing partition replica movements going into/out of each broker. Default is 5.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentIntraBrokerPartitionMovements</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The upper bound of ongoing partition replica movements between disks within each broker. Default is 2.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentLeaderMovements</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The upper bound of ongoing partition leadership movements. Default is 1000.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicationThrottle</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The upper bound, in bytes per second, on the bandwidth used to move replicas. There is no limit by default.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicaMovementStrategies</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A list of strategy class names used to determine the execution order for the replica movements in the generated optimization proposal. By default BaseReplicaMovementStrategy is used, which will execute the replica movements in the order that they were generated.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="type-KafkaRebalanceStatus-reference"><a class="link" href="#type-KafkaRebalanceStatus-reference">8.2.140. <code>KafkaRebalanceStatus</code> schema reference</a></h4>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaRebalance-reference"><code>KafkaRebalance</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>List of status conditions.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The generation of the CRD that was last reconciled by the operator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>The session identifier for requests to Cruise Control pertaining to this KafkaRebalance resource. This is used by the Kafka Rebalance operator to track the status of ongoing rebalancing operations.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimizationResult</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p>A JSON object describing the optimization result.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-02-08 00:34:09 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>
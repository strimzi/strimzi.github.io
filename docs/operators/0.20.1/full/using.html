<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Using Strimzi</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Using Strimzi</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-str">1. Overview of Strimzi</a>
<ul class="sectlevel2">
<li><a href="#key-features-kafka_str">1.1. Kafka capabilities</a></li>
<li><a href="#kafka_use_cases">1.2. Kafka use cases</a></li>
<li><a href="#key-features-product_str">1.3. How Strimzi supports Kafka</a></li>
<li><a href="#overview-components_str">1.4. Strimzi Operators</a>
<ul class="sectlevel3">
<li><a href="#overview-components-cluster-operator-str">1.4.1. Cluster Operator</a></li>
<li><a href="#overview-concepts-topic-operator-str">1.4.2. Topic Operator</a></li>
<li><a href="#overview-concepts-user-operator-str">1.4.3. User Operator</a></li>
</ul>
</li>
<li><a href="#assembly-custom-resources-str">1.5. Strimzi custom resources</a>
<ul class="sectlevel3">
<li><a href="#con-custom-resources-example-str">1.5.1. Strimzi custom resource example</a></li>
</ul>
</li>
<li><a href="#configuration-points-listeners-str">1.6. Listener configuration</a></li>
<li><a href="#document-conventions-str">1.7. Document Conventions</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-str">2. Deployment configuration</a>
<ul class="sectlevel2">
<li><a href="#assembly-deployment-configuration-kafka-str">2.1. Kafka cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">2.1.1. Sample Kafka YAML configuration</a></li>
<li><a href="#considerations-for-data-storage-deployment-configuration-kafka">2.1.2. Data storage considerations</a></li>
<li><a href="#assembly-storage-deployment-configuration-kafka">2.1.3. Kafka and ZooKeeper storage types</a></li>
<li><a href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">2.1.4. Kafka broker replicas</a></li>
<li><a href="#assembly-kafka-broker-configuration-deployment-configuration-kafka">2.1.5. Kafka broker configuration</a></li>
<li><a href="#configuration-points-listeners-deployment-configuration-kafka">2.1.6. Listener configuration</a></li>
<li><a href="#assembly-zookeeper-replicas-deployment-configuration-kafka">2.1.7. ZooKeeper replicas</a></li>
<li><a href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">2.1.8. ZooKeeper configuration</a></li>
<li><a href="#assembly-zookeeper-connection-deployment-configuration-kafka">2.1.9. ZooKeeper connection</a></li>
<li><a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">2.1.10. Entity Operator</a></li>
<li><a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">2.1.11. CPU and memory resources</a></li>
<li><a href="#con-kafka-logging-deployment-configuration-kafka">2.1.12. Kafka loggers</a></li>
<li><a href="#assembly-kafka-rack-deployment-configuration-kafka">2.1.13. Kafka rack awareness</a></li>
<li><a href="#assembly-healthchecks-deployment-configuration-kafka">2.1.14. Healthchecks</a></li>
<li><a href="#assembly-metrics-deployment-configuration-kafka">2.1.15. Prometheus metrics</a></li>
<li><a href="#assembly-jmx-options-deployment-configuration-kafka">2.1.16. JMX Options</a></li>
<li><a href="#assembly-jmxtrans-deployment-configuration-kafka">2.1.17. Retrieving JMX metrics with JMXTrans</a></li>
<li><a href="#assembly-jvm-options-deployment-configuration-kafka">2.1.18. JVM Options</a></li>
<li><a href="#assembly-configuring-container-images-deployment-configuration-kafka">2.1.19. Container images</a></li>
<li><a href="#assembly-tls-sidecar-deployment-configuration-kafka">2.1.20. TLS sidecar</a></li>
<li><a href="#assembly-scheduling-deployment-configuration-kafka">2.1.21. Configuring pod scheduling</a></li>
<li><a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">2.1.22. Kafka Exporter</a></li>
<li><a href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">2.1.23. Performing a rolling update of a Kafka cluster</a></li>
<li><a href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">2.1.24. Performing a rolling update of a ZooKeeper cluster</a></li>
<li><a href="#scaling-clusters-deployment-configuration-kafka">2.1.25. Scaling clusters</a></li>
<li><a href="#proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka">2.1.26. Deleting Kafka nodes manually</a></li>
<li><a href="#proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka">2.1.27. Deleting ZooKeeper nodes manually</a></li>
<li><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">2.1.28. Maintenance time windows for rolling updates</a></li>
<li><a href="#proc-renewing-ca-certs-manually-deployment-configuration-kafka">2.1.29. Renewing CA certificates manually</a></li>
<li><a href="#proc-replacing-private-keys-deployment-configuration-kafka">2.1.30. Replacing private keys</a></li>
<li><a href="#ref-list-of-kafka-cluster-resources-deployment-configuration-kafka">2.1.31. List of resources created as part of Kafka cluster</a></li>
</ul>
</li>
<li><a href="#assembly-kafka-connect-str">2.2. Kafka Connect/S2I cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#proc-kafka-connect-config-str">2.2.1. Configuring Kafka Connect</a></li>
<li><a href="#con-kafka-connect-multiple-instances-str">2.2.2. Kafka Connect configuration for multiple instances</a></li>
<li><a href="#proc-configuring-kafka-connect-user-authorization-str">2.2.3. Configuring Kafka Connect user authorization</a></li>
<li><a href="#ref-list-of-kafka-connect-resources-str">2.2.4. List of Kafka Connect cluster resources</a></li>
<li><a href="#ref-list-of-kafka-connect-s2i-resources-str">2.2.5. List of Kafka Connect (S2I) cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-deployment-configuration-kafka-mirror-maker-str">2.3. Kafka MirrorMaker cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#configuring-kafka-mirror-maker-str">2.3.1. Configuring Kafka MirrorMaker</a></li>
<li><a href="#ref-list-of-kafka-mirror-maker-resources-str">2.3.2. List of Kafka MirrorMaker cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-mirrormaker-str">2.4. Kafka MirrorMaker 2.0 cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#con-mirrormaker-str">2.4.1. MirrorMaker 2.0 data replication</a></li>
<li><a href="#cluster_configuration">2.4.2. Cluster configuration</a></li>
<li><a href="#con-mirrormaker-acls-str">2.4.3. ACL rules synchronization</a></li>
<li><a href="#proc-mirrormaker-replication-str">2.4.4. Synchronizing data between Kafka clusters using MirrorMaker 2.0</a></li>
</ul>
</li>
<li><a href="#assembly-config-kafka-bridge-str">2.5. Kafka Bridge cluster configuration</a>
<ul class="sectlevel3">
<li><a href="#proc-config-kafka-bridge-str">2.5.1. Configuring the Kafka Bridge</a></li>
<li><a href="#ref-list-of-kafka-bridge-resources-str">2.5.2. List of Kafka Bridge cluster resources</a></li>
</ul>
</li>
<li><a href="#assembly-customizing-kubernetes-resources-str">2.6. Customizing Kubernetes resources</a>
<ul class="sectlevel3">
<li><a href="#con-customizing-image-pull-policy-str">2.6.1. Customizing the image pull policy</a></li>
</ul>
</li>
<li><a href="#external-logging_str">2.7. External logging</a>
<ul class="sectlevel3">
<li><a href="#creating-configmap_str">2.7.1. Creating a ConfigMap for logging</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-configuring-external-listeners-str">3. Configuring external listeners</a>
<ul class="sectlevel2">
<li><a href="#proc-accessing-kafka-using-nodeports-str">3.1. Accessing Kafka using node ports</a></li>
<li><a href="#proc-accessing-kafka-using-loadbalancers-str">3.2. Accessing Kafka using loadbalancers</a></li>
<li><a href="#proc-accessing-kafka-using-ingress-str">3.3. Accessing Kafka using ingress</a></li>
<li><a href="#proc-accessing-kafka-using-routes-str">3.4. Accessing Kafka using OpenShift routes</a></li>
</ul>
</li>
<li><a href="#assembly-securing-access-str">4. Managing secure access to Kafka</a>
<ul class="sectlevel2">
<li><a href="#assembly-securing-kafka-brokers-str">4.1. Security options for Kafka</a>
<ul class="sectlevel3">
<li><a href="#con-securing-kafka-authentication-str">4.1.1. Listener authentication</a></li>
<li><a href="#con-securing-kafka-authorization-str">4.1.2. Kafka authorization</a></li>
</ul>
</li>
<li><a href="#assembly-securing-kafka-clients-str">4.2. Security options for Kafka clients</a>
<ul class="sectlevel3">
<li><a href="#con-securing-client-labels-str">4.2.1. Identifying a Kafka cluster for user handling</a></li>
<li><a href="#con-securing-client-authentication-str">4.2.2. User authentication</a></li>
<li><a href="#con-securing-client-authorization-str">4.2.3. User authorization</a></li>
</ul>
</li>
<li><a href="#assembly-securing-kafka-str">4.3. Securing access to Kafka brokers</a>
<ul class="sectlevel3">
<li><a href="#proc-securing-kafka-str">4.3.1. Securing Kafka brokers</a></li>
<li><a href="#proc-configuring-kafka-user-str">4.3.2. Securing user access to Kafka</a></li>
<li><a href="#proc-restricting-access-to-listeners-using-network-policies-str">4.3.3. Restricting access to Kafka listeners using network policies</a></li>
</ul>
</li>
<li><a href="#assembly-oauth-authentication_str">4.4. Using OAuth 2.0 token-based authentication</a>
<ul class="sectlevel3">
<li><a href="#con-oauth-authentication-flow-str">4.4.1. OAuth 2.0 authentication mechanism</a></li>
<li><a href="#con-oauth-authentication-broker-str">4.4.2. OAuth 2.0 Kafka broker configuration</a></li>
<li><a href="#con-oauth-reauthentication-str">4.4.3. Session re-authentication for Kafka brokers</a></li>
<li><a href="#con-oauth-authentication-client-str">4.4.4. OAuth 2.0 Kafka client configuration</a></li>
<li><a href="#con-oauth-authentication-client-options-str">4.4.5. OAuth 2.0 client authentication flow</a></li>
<li><a href="#con-oauth-strimzi-config-str">4.4.6. Configuring OAuth 2.0 authentication</a></li>
<li><a href="#con-oauth-server-examples-str">4.4.7. Authorization server examples</a></li>
</ul>
</li>
<li><a href="#assembly-oauth-authorization_str">4.5. Using OAuth 2.0 token-based authorization</a>
<ul class="sectlevel3">
<li><a href="#con-oauth-authorization-mechanism_str">4.5.1. OAuth 2.0 authorization mechanism</a></li>
<li><a href="#proc-oauth-authorization-broker-config-str">4.5.2. Configuring OAuth 2.0 authorization support</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-operators-str">5. Using Strimzi Operators</a>
<ul class="sectlevel2">
<li><a href="#using-the-cluster-operator-str">5.1. Using the Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#ref-operator-cluster-str">5.1.1. Cluster Operator configuration</a></li>
<li><a href="#provisioning_role_based_access_control_rbac">5.1.2. Provisioning Role-Based Access Control (RBAC)</a></li>
</ul>
</li>
<li><a href="#using-the-topic-operator-str">5.2. Using the Topic Operator</a>
<ul class="sectlevel3">
<li><a href="#ref-operator-topic-str">5.2.1. Kafka topic resource</a></li>
<li><a href="#proc-configuring-kafka-topic-str">5.2.2. Configuring a Kafka topic</a></li>
<li><a href="#proc-topic-operator-with-resource-requests-limits-str">5.2.3. Configuring the Topic Operator with resource requests and limits</a></li>
</ul>
</li>
<li><a href="#assembly-using-the-user-operator-str">5.3. Using the User Operator</a>
<ul class="sectlevel3">
<li><a href="#proc-user-operator-with-resource-requests-limits-str">5.3.1. Configuring the User Operator with resource requests and limits</a></li>
</ul>
</li>
<li><a href="#con-operators-prometheus-metrics-str">5.4. Monitoring operators using Prometheus metrics</a></li>
</ul>
</li>
<li><a href="#kafka-bridge-concepts-str">6. Kafka Bridge</a>
<ul class="sectlevel2">
<li><a href="#assembly-kafka-bridge-overview-str">6.1. Kafka Bridge overview</a>
<ul class="sectlevel3">
<li><a href="#overview-components-kafka-bridge_kafka-bridge-overview">6.1.1. Kafka Bridge interface</a></li>
<li><a href="#con-overview-components-kafka-bridge-clients_kafka-bridge-overview">6.1.2. Supported clients for the Kafka Bridge</a></li>
<li><a href="#con-securing-kafka-bridge-kafka-bridge-overview">6.1.3. Securing the Kafka Bridge</a></li>
<li><a href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">6.1.4. Accessing the Kafka Bridge outside of Kubernetes</a></li>
<li><a href="#con-requests-kafka-bridge-kafka-bridge-overview">6.1.5. Requests to the Kafka Bridge</a></li>
<li><a href="#con-requests-kafka-bridge-cors-kafka-bridge-overview">6.1.6. CORS</a></li>
<li><a href="#ref-api-resources-kafka-bridge-kafka-bridge-overview">6.1.7. Kafka Bridge API resources</a></li>
<li><a href="#con-deployment-kafka-bridge-kafka-bridge-overview">6.1.8. Kafka Bridge deployment</a></li>
</ul>
</li>
<li><a href="#assembly-kafka-bridge-quickstart-str">6.2. Kafka Bridge quickstart</a>
<ul class="sectlevel3">
<li><a href="#proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart">6.2.1. Deploying the Kafka Bridge to your Kubernetes cluster</a></li>
<li><a href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">6.2.2. Exposing the Kafka Bridge service to your local machine</a></li>
<li><a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">6.2.3. Producing messages to topics and partitions</a></li>
<li><a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">6.2.4. Creating a Kafka Bridge consumer</a></li>
<li><a href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">6.2.5. Subscribing a Kafka Bridge consumer to topics</a></li>
<li><a href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">6.2.6. Retrieving the latest messages from a Kafka Bridge consumer</a></li>
<li><a href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">6.2.7. Commiting offsets to the log</a></li>
<li><a href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">6.2.8. Seeking to offsets for a partition</a></li>
<li><a href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">6.2.9. Deleting a Kafka Bridge consumer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cruise-control-concepts-str">7. Cruise Control for cluster rebalancing</a>
<ul class="sectlevel2">
<li><a href="#con-cruise-control-overview-str">7.1. Why use Cruise Control?</a></li>
<li><a href="#con-optimization-goals-str">7.2. Optimization goals overview</a></li>
<li><a href="#con-optimization-proposals-str">7.3. Optimization proposals overview</a></li>
<li><a href="#con-rebalance-str">7.4. Rebalance performance tuning overview</a></li>
<li><a href="#ref-cruise-control-configuration-str">7.5. Cruise Control configuration</a></li>
<li><a href="#proc-deploying-cruise-control-str">7.6. Deploying Cruise Control</a></li>
<li><a href="#proc-generating-optimization-proposals-str">7.7. Generating optimization proposals</a></li>
<li><a href="#proc-approving-optimization-proposal-str">7.8. Approving an optimization proposal</a></li>
<li><a href="#proc-stopping-cluster-rebalance-str">7.9. Stopping a cluster rebalance</a></li>
<li><a href="#proc-fixing-problems-with-kafkarebalance-str">7.10. Fixing problems with a <code>KafkaRebalance</code> resource</a></li>
</ul>
</li>
<li><a href="#assembly-distributed-tracing-str">8. Distributed tracing</a>
<ul class="sectlevel2">
<li><a href="#con-overview-opentracing-jaeger-str">8.1. Overview of OpenTracing and Jaeger</a></li>
<li><a href="#assembly-setting-up-tracing-kafka-clients-str">8.2. Setting up tracing for Kafka clients</a>
<ul class="sectlevel3">
<li><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">8.2.1. Initializing a Jaeger tracer for Kafka clients</a></li>
<li><a href="#ref-tracing-environment-variables-str">8.2.2. Environment variables for tracing</a></li>
</ul>
</li>
<li><a href="#assembly-instrumenting-kafka-clients-tracers-str">8.3. Instrumenting Kafka clients with tracers</a>
<ul class="sectlevel3">
<li><a href="#proc-instrumenting-producers-consumers-for-opentracing-str">8.3.1. Instrumenting producers and consumers for tracing</a></li>
<li><a href="#proc-instrumenting-kafka-streams-with-tracers-str">8.3.2. Instrumenting Kafka Streams applications for tracing</a></li>
</ul>
</li>
<li><a href="#assembly-setting-up-tracing-mirror-maker-connect-bridge-str">8.4. Setting up tracing for MirrorMaker, Kafka Connect, and the Kafka Bridge</a>
<ul class="sectlevel3">
<li><a href="#proc-enabling-tracing-in-connect-mirror-maker-bridge-resources-str">8.4.1. Enabling tracing in MirrorMaker, Kafka Connect, and Kafka Bridge resources</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#security-str">9. Managing TLS certificates</a>
<ul class="sectlevel2">
<li><a href="#certificate-authorities-str">9.1. Certificate Authorities</a>
<ul class="sectlevel3">
<li><a href="#ca_certificates">9.1.1. CA certificates</a></li>
<li><a href="#installing-your-own-ca-certificates-str">9.1.2. Installing your own CA certificates</a></li>
</ul>
</li>
<li><a href="#certificates-and-secrets-str">9.2. Secrets</a>
<ul class="sectlevel3">
<li><a href="#pkcs_12_storage">9.2.1. PKCS #12 storage</a></li>
<li><a href="#cluster_ca_secrets">9.2.2. Cluster CA Secrets</a></li>
<li><a href="#client_ca_secrets">9.2.3. Client CA Secrets</a></li>
<li><a href="#user_secrets">9.2.4. User Secrets</a></li>
</ul>
</li>
<li><a href="#con-certificate-renewal-str">9.3. Certificate renewal and validity periods</a>
<ul class="sectlevel3">
<li><a href="#renewal_process_with_generated_cas">9.3.1. Renewal process with generated CAs</a></li>
<li><a href="#client_applications">9.3.2. Client applications</a></li>
<li><a href="#proc-renewing-ca-certs-manually-str">9.3.3. Renewing CA certificates manually</a></li>
<li><a href="#renewing-your-own-ca-certificates-str">9.3.4. Renewing your own CA certificates</a></li>
</ul>
</li>
<li><a href="#proc-replacing-private-keys-str">9.4. Replacing private keys</a></li>
<li><a href="#tls-connections-str">9.5. TLS connections</a>
<ul class="sectlevel3">
<li><a href="#zookeeper_communication">9.5.1. ZooKeeper communication</a></li>
<li><a href="#kafka_interbroker_communication">9.5.2. Kafka interbroker communication</a></li>
<li><a href="#topic_and_user_operators">9.5.3. Topic and User Operators</a></li>
<li><a href="#cruise_control">9.5.4. Cruise Control</a></li>
<li><a href="#kafka_client_connections">9.5.5. Kafka Client connections</a></li>
</ul>
</li>
<li><a href="#configuring-internal-clients-to-trust-cluster-ca-str">9.6. Configuring internal clients to trust the cluster CA</a></li>
<li><a href="#configuring-external-clients-to-trust-cluster-ca-str">9.7. Configuring external clients to trust the cluster CA</a></li>
<li><a href="#kafka-listener-certificates-str">9.8. Kafka listener certificates</a>
<ul class="sectlevel3">
<li><a href="#proc-installing-certs-per-listener-str">9.8.1. Providing your own Kafka listener certificates</a></li>
<li><a href="#ref-alternative-subjects-certs-for-listeners-str">9.8.2. Alternative subjects in server certificates for Kafka listeners</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#management-tasks-str">10. Managing Strimzi</a>
<ul class="sectlevel2">
<li><a href="#working-with-resources-str">10.1. Working with custom resources</a>
<ul class="sectlevel3">
<li><a href="#con-custom-resources-info-str">10.1.1. Performing <code>kubectl</code> operations on custom resources</a></li>
<li><a href="#con-custom-resources-status-str">10.1.2. Strimzi custom resource status information</a></li>
<li><a href="#proc-accessing-resource-status-str">10.1.3. Finding the status of a custom resource</a></li>
</ul>
</li>
<li><a href="#proc-add-service-discovery-str">10.2. Discovering services using labels and annotations</a>
<ul class="sectlevel3">
<li><a href="#returning_connection_details_on_services">10.2.1. Returning connection details on services</a></li>
</ul>
</li>
<li><a href="#cluster-recovery-str">10.3. Recovering a cluster from persistent volumes</a>
<ul class="sectlevel3">
<li><a href="#namespace-deletion_str">10.3.1. Recovery from namespace deletion</a></li>
<li><a href="#cluster-loss_str">10.3.2. Recovery from loss of a Kubernetes cluster</a></li>
<li><a href="#cluster-recovery-volume_str">10.3.3. Recovering a deleted cluster from persistent volumes</a></li>
</ul>
</li>
<li><a href="#assembly-client-config-str">10.4. Tuning client configuration</a>
<ul class="sectlevel3">
<li><a href="#con-producer-config-properties-str">10.4.1. Kafka producer configuration tuning</a></li>
<li><a href="#con-consumer-config-properties-str">10.4.2. Kafka consumer configuration tuning</a></li>
</ul>
</li>
<li><a href="#uninstalling-str">10.5. Uninstalling Strimzi</a></li>
</ul>
</li>
<li><a href="#appendix-faq_str">Appendix A: Frequently asked questions</a>
<ul class="sectlevel2">
<li><a href="#questions_related_to_the_cluster_operator">A.1. Questions related to the Cluster Operator</a>
<ul class="sectlevel3">
<li><a href="#co-faq-admin-privileges_str">A.1.1. Why do I need cluster administrator privileges to install Strimzi?</a></li>
<li><a href="#co-faq-cluster-role-bindings_str">A.1.2. Why does the Cluster Operator need to create <code>ClusterRoleBindings</code>?</a></li>
<li><a href="#co-faq-standard-users_str">A.1.3. Can standard Kubernetes users create Kafka custom resources?</a></li>
<li><a href="#what_do_the_failed_to_acquire_lock_warnings_in_the_log_mean">A.1.4. What do the <em>failed to acquire lock</em> warnings in the log mean?</a></li>
<li><a href="#why_is_hostname_verification_failing_when_connecting_to_nodeports_using_tls">A.1.5. Why is hostname verification failing when connecting to NodePorts using TLS?</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#api_reference-str">Appendix B: Custom Resource API Reference</a>
<ul class="sectlevel2">
<li><a href="#con-common-configuration-properties-reference">B.1. Common configuration properties</a>
<ul class="sectlevel3">
<li><a href="#con-common-configuration-replicas-reference">B.1.1. <code>replicas</code></a></li>
<li><a href="#con-common-configuration-bootstrap-reference">B.1.2. <code>bootstrapServers</code></a></li>
<li><a href="#con-common-configuration-ssl-reference">B.1.3. <code>ssl</code></a></li>
<li><a href="#con-common-configuration-trusted-certificates-reference">B.1.4. <code>trustedCertificates</code></a></li>
<li><a href="#con-common-configuration-resources-reference">B.1.5. <code>resources</code></a></li>
<li><a href="#con-common-configuration-images-reference">B.1.6. <code>image</code></a></li>
<li><a href="#con-common-configuration-healthchecks-reference">B.1.7. <code>livenessProbe</code> and <code>readinessProbe</code> healthchecks</a></li>
<li><a href="#con-common-configuration-prometheus-reference">B.1.8. <code>metrics</code></a></li>
<li><a href="#con-common-configuration-jvm-reference">B.1.9. <code>jvmOptions</code></a></li>
<li><a href="#con-common-configuration-garbage-collection-reference">B.1.10. Garbage collector logging</a></li>
</ul>
</li>
<li><a href="#type-Kafka-reference">B.2. <code>Kafka</code> schema reference</a></li>
<li><a href="#type-KafkaSpec-reference">B.3. <code>KafkaSpec</code> schema reference</a></li>
<li><a href="#type-KafkaClusterSpec-reference">B.4. <code>KafkaClusterSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-kafka-listeners-reference">B.4.1. <code>listeners</code></a></li>
<li><a href="#property-kafka-config-reference">B.4.2. <code>config</code></a></li>
</ul>
</li>
<li><a href="#type-EphemeralStorage-reference">B.5. <code>EphemeralStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorage-reference">B.6. <code>PersistentClaimStorage</code> schema reference</a></li>
<li><a href="#type-PersistentClaimStorageOverride-reference">B.7. <code>PersistentClaimStorageOverride</code> schema reference</a></li>
<li><a href="#type-JbodStorage-reference">B.8. <code>JbodStorage</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListener-reference">B.9. <code>GenericKafkaListener</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-generic-listeners-reference">B.9.1. <code>listeners</code></a></li>
<li><a href="#type">B.9.2. <code>type</code></a></li>
<li><a href="#property-listener-port-reference">B.9.3. <code>port</code></a></li>
<li><a href="#property-listener-tls-reference">B.9.4. <code>tls</code></a></li>
<li><a href="#authentication">B.9.5. <code>authentication</code></a></li>
<li><a href="#configuration-listener-network-policy-reference">B.9.6. <code>networkPolicyPeers</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaListenerAuthenticationTls-reference">B.10. <code>KafkaListenerAuthenticationTls</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationScramSha512-reference">B.11. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></li>
<li><a href="#type-KafkaListenerAuthenticationOAuth-reference">B.12. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-GenericSecretSource-reference">B.13. <code>GenericSecretSource</code> schema reference</a></li>
<li><a href="#type-CertSecretSource-reference">B.14. <code>CertSecretSource</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListenerConfiguration-reference">B.15. <code>GenericKafkaListenerConfiguration</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-listener-config-brokerCertChainAndKey-reference">B.15.1. <code>brokerCertChainAndKey</code></a></li>
<li><a href="#property-listener-config-traffic-policy-reference">B.15.2. <code>externalTrafficPolicy</code></a></li>
<li><a href="#property-listener-config-source-ranges-reference">B.15.3. <code>loadBalancerSourceRanges</code></a></li>
<li><a href="#property-listener-config-class-reference">B.15.4. <code>class</code></a></li>
<li><a href="#property-listener-config-preferredNodePortAddressType-reference">B.15.5. <code>preferredNodePortAddressType</code></a></li>
<li><a href="#property-listener-config-dns-reference">B.15.6. <code>useServiceDnsDomain</code></a></li>
</ul>
</li>
<li><a href="#type-CertAndKeySecretSource-reference">B.16. <code>CertAndKeySecretSource</code> schema reference</a></li>
<li><a href="#type-GenericKafkaListenerConfigurationBootstrap-reference">B.17. <code>GenericKafkaListenerConfigurationBootstrap</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-listener-config-altnames-reference">B.17.1. <code>alternativeNames</code></a></li>
<li><a href="#property-listener-config-host-reference">B.17.2. <code>host</code></a></li>
<li><a href="#property-listener-config-nodeport-reference">B.17.3. <code>nodePort</code></a></li>
<li><a href="#property-listener-config-lb-ip-reference">B.17.4. <code>loadBalancerIP</code></a></li>
<li><a href="#property-listener-config-annotations-reference">B.17.5. <code>annotations</code></a></li>
</ul>
</li>
<li><a href="#type-GenericKafkaListenerConfigurationBroker-reference">B.18. <code>GenericKafkaListenerConfigurationBroker</code> schema reference</a></li>
<li><a href="#type-KafkaListeners-reference">B.19. <code>KafkaListeners</code> schema reference</a></li>
<li><a href="#type-KafkaListenerPlain-reference">B.20. <code>KafkaListenerPlain</code> schema reference</a></li>
<li><a href="#type-KafkaListenerTls-reference">B.21. <code>KafkaListenerTls</code> schema reference</a></li>
<li><a href="#type-TlsListenerConfiguration-reference">B.22. <code>TlsListenerConfiguration</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalRoute-reference">B.23. <code>KafkaListenerExternalRoute</code> schema reference</a></li>
<li><a href="#type-RouteListenerOverride-reference">B.24. <code>RouteListenerOverride</code> schema reference</a></li>
<li><a href="#type-RouteListenerBootstrapOverride-reference">B.25. <code>RouteListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-RouteListenerBrokerOverride-reference">B.26. <code>RouteListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalConfiguration-reference">B.27. <code>KafkaListenerExternalConfiguration</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalLoadBalancer-reference">B.28. <code>KafkaListenerExternalLoadBalancer</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerOverride-reference">B.29. <code>LoadBalancerListenerOverride</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerBootstrapOverride-reference">B.30. <code>LoadBalancerListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-LoadBalancerListenerBrokerOverride-reference">B.31. <code>LoadBalancerListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalNodePort-reference">B.32. <code>KafkaListenerExternalNodePort</code> schema reference</a></li>
<li><a href="#type-NodePortListenerOverride-reference">B.33. <code>NodePortListenerOverride</code> schema reference</a></li>
<li><a href="#type-NodePortListenerBootstrapOverride-reference">B.34. <code>NodePortListenerBootstrapOverride</code> schema reference</a></li>
<li><a href="#type-NodePortListenerBrokerOverride-reference">B.35. <code>NodePortListenerBrokerOverride</code> schema reference</a></li>
<li><a href="#type-NodePortListenerConfiguration-reference">B.36. <code>NodePortListenerConfiguration</code> schema reference</a></li>
<li><a href="#type-KafkaListenerExternalIngress-reference">B.37. <code>KafkaListenerExternalIngress</code> schema reference</a></li>
<li><a href="#type-IngressListenerConfiguration-reference">B.38. <code>IngressListenerConfiguration</code> schema reference</a></li>
<li><a href="#type-IngressListenerBootstrapConfiguration-reference">B.39. <code>IngressListenerBootstrapConfiguration</code> schema reference</a></li>
<li><a href="#type-IngressListenerBrokerConfiguration-reference">B.40. <code>IngressListenerBrokerConfiguration</code> schema reference</a></li>
<li><a href="#type-KafkaAuthorizationSimple-reference">B.41. <code>KafkaAuthorizationSimple</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-simple-authorization-superusers-reference">B.41.1. <code>superUsers</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaAuthorizationOpa-reference">B.42. <code>KafkaAuthorizationOpa</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#url">B.42.1. <code>url</code></a></li>
<li><a href="#allowonerror">B.42.2. <code>allowOnError</code></a></li>
<li><a href="#initialcachecapacity">B.42.3. <code>initialCacheCapacity</code></a></li>
<li><a href="#maximumcachesize">B.42.4. <code>maximumCacheSize</code></a></li>
<li><a href="#expireafterms">B.42.5. <code>expireAfterMs</code></a></li>
<li><a href="#superusers">B.42.6. <code>superUsers</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaAuthorizationKeycloak-reference">B.43. <code>KafkaAuthorizationKeycloak</code> schema reference</a></li>
<li><a href="#type-Rack-reference">B.44. <code>Rack</code> schema reference</a></li>
<li><a href="#type-Probe-reference">B.45. <code>Probe</code> schema reference</a></li>
<li><a href="#type-JvmOptions-reference">B.46. <code>JvmOptions</code> schema reference</a></li>
<li><a href="#type-SystemProperty-reference">B.47. <code>SystemProperty</code> schema reference</a></li>
<li><a href="#type-KafkaJmxOptions-reference">B.48. <code>KafkaJmxOptions</code> schema reference</a></li>
<li><a href="#type-KafkaJmxAuthenticationPassword-reference">B.49. <code>KafkaJmxAuthenticationPassword</code> schema reference</a></li>
<li><a href="#type-InlineLogging-reference">B.50. <code>InlineLogging</code> schema reference</a></li>
<li><a href="#type-ExternalLogging-reference">B.51. <code>ExternalLogging</code> schema reference</a></li>
<li><a href="#type-TlsSidecar-reference">B.52. <code>TlsSidecar</code> schema reference</a></li>
<li><a href="#type-KafkaClusterTemplate-reference">B.53. <code>KafkaClusterTemplate</code> schema reference</a></li>
<li><a href="#type-StatefulSetTemplate-reference">B.54. <code>StatefulSetTemplate</code> schema reference</a></li>
<li><a href="#type-MetadataTemplate-reference">B.55. <code>MetadataTemplate</code> schema reference</a></li>
<li><a href="#type-PodTemplate-reference">B.56. <code>PodTemplate</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-hostaliases-config-reference">B.56.1. <code>hostAliases</code></a></li>
</ul>
</li>
<li><a href="#type-ResourceTemplate-reference">B.57. <code>ResourceTemplate</code> schema reference</a></li>
<li><a href="#type-ExternalServiceTemplate-reference">B.58. <code>ExternalServiceTemplate</code> schema reference</a></li>
<li><a href="#type-PodDisruptionBudgetTemplate-reference">B.59. <code>PodDisruptionBudgetTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerTemplate-reference">B.60. <code>ContainerTemplate</code> schema reference</a></li>
<li><a href="#type-ContainerEnvVar-reference">B.61. <code>ContainerEnvVar</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterSpec-reference">B.62. <code>ZookeeperClusterSpec</code> schema reference</a></li>
<li><a href="#type-ZookeeperClusterTemplate-reference">B.63. <code>ZookeeperClusterTemplate</code> schema reference</a></li>
<li><a href="#type-TopicOperatorSpec-reference">B.64. <code>TopicOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityOperatorSpec-reference">B.65. <code>EntityOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityTopicOperatorSpec-reference">B.66. <code>EntityTopicOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityUserOperatorSpec-reference">B.67. <code>EntityUserOperatorSpec</code> schema reference</a></li>
<li><a href="#type-EntityOperatorTemplate-reference">B.68. <code>EntityOperatorTemplate</code> schema reference</a></li>
<li><a href="#type-CertificateAuthority-reference">B.69. <code>CertificateAuthority</code> schema reference</a></li>
<li><a href="#type-CruiseControlSpec-reference">B.70. <code>CruiseControlSpec</code> schema reference</a></li>
<li><a href="#type-CruiseControlTemplate-reference">B.71. <code>CruiseControlTemplate</code> schema reference</a></li>
<li><a href="#type-BrokerCapacity-reference">B.72. <code>BrokerCapacity</code> schema reference</a></li>
<li><a href="#type-JmxTransSpec-reference">B.73. <code>JmxTransSpec</code> schema reference</a></li>
<li><a href="#type-JmxTransOutputDefinitionTemplate-reference">B.74. <code>JmxTransOutputDefinitionTemplate</code> schema reference</a></li>
<li><a href="#type-JmxTransQueryTemplate-reference">B.75. <code>JmxTransQueryTemplate</code> schema reference</a></li>
<li><a href="#type-JmxTransTemplate-reference">B.76. <code>JmxTransTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaExporterSpec-reference">B.77. <code>KafkaExporterSpec</code> schema reference</a></li>
<li><a href="#type-KafkaExporterTemplate-reference">B.78. <code>KafkaExporterTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaStatus-reference">B.79. <code>KafkaStatus</code> schema reference</a></li>
<li><a href="#type-Condition-reference">B.80. <code>Condition</code> schema reference</a></li>
<li><a href="#type-ListenerStatus-reference">B.81. <code>ListenerStatus</code> schema reference</a></li>
<li><a href="#type-ListenerAddress-reference">B.82. <code>ListenerAddress</code> schema reference</a></li>
<li><a href="#type-KafkaConnect-reference">B.83. <code>KafkaConnect</code> schema reference</a></li>
<li><a href="#type-KafkaConnectSpec-reference">B.84. <code>KafkaConnectSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-kafka-connect-config-reference">B.84.1. <code>config</code></a></li>
<li><a href="#property-kafka-connect-logging-reference">B.84.2. <code>logging</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaConnectTls-reference">B.85. <code>KafkaConnectTls</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#trustedcertificates">B.85.1. <code>trustedCertificates</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaClientAuthenticationTls-reference">B.86. <code>KafkaClientAuthenticationTls</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#certificateandkey">B.86.1. <code>certificateAndKey</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaClientAuthenticationScramSha512-reference">B.87. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#username">B.87.1. <code>username</code></a></li>
<li><a href="#passwordsecret">B.87.2. <code>passwordSecret</code></a></li>
</ul>
</li>
<li><a href="#type-PasswordSecretSource-reference">B.88. <code>PasswordSecretSource</code> schema reference</a></li>
<li><a href="#type-KafkaClientAuthenticationPlain-reference">B.89. <code>KafkaClientAuthenticationPlain</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#username_2">B.89.1. <code>username</code></a></li>
<li><a href="#passwordsecret_2">B.89.2. <code>passwordSecret</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaClientAuthenticationOAuth-reference">B.90. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></li>
<li><a href="#type-JaegerTracing-reference">B.91. <code>JaegerTracing</code> schema reference</a></li>
<li><a href="#type-KafkaConnectTemplate-reference">B.92. <code>KafkaConnectTemplate</code> schema reference</a></li>
<li><a href="#type-ExternalConfiguration-reference">B.93. <code>ExternalConfiguration</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-kafka-connect-external-env-reference">B.93.1. <code>env</code></a></li>
<li><a href="#property-kafka-connect-external-volumes-reference">B.93.2. <code>volumes</code></a></li>
</ul>
</li>
<li><a href="#type-ExternalConfigurationEnv-reference">B.94. <code>ExternalConfigurationEnv</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationEnvVarSource-reference">B.95. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></li>
<li><a href="#type-ExternalConfigurationVolumeSource-reference">B.96. <code>ExternalConfigurationVolumeSource</code> schema reference</a></li>
<li><a href="#type-KafkaConnectStatus-reference">B.97. <code>KafkaConnectStatus</code> schema reference</a></li>
<li><a href="#type-ConnectorPlugin-reference">B.98. <code>ConnectorPlugin</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2I-reference">B.99. <code>KafkaConnectS2I</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2ISpec-reference">B.100. <code>KafkaConnectS2ISpec</code> schema reference</a></li>
<li><a href="#type-KafkaConnectS2IStatus-reference">B.101. <code>KafkaConnectS2IStatus</code> schema reference</a></li>
<li><a href="#type-KafkaTopic-reference">B.102. <code>KafkaTopic</code> schema reference</a></li>
<li><a href="#type-KafkaTopicSpec-reference">B.103. <code>KafkaTopicSpec</code> schema reference</a></li>
<li><a href="#type-KafkaTopicStatus-reference">B.104. <code>KafkaTopicStatus</code> schema reference</a></li>
<li><a href="#type-KafkaUser-reference">B.105. <code>KafkaUser</code> schema reference</a></li>
<li><a href="#type-KafkaUserSpec-reference">B.106. <code>KafkaUserSpec</code> schema reference</a></li>
<li><a href="#type-KafkaUserTlsClientAuthentication-reference">B.107. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserScramSha512ClientAuthentication-reference">B.108. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></li>
<li><a href="#type-KafkaUserAuthorizationSimple-reference">B.109. <code>KafkaUserAuthorizationSimple</code> schema reference</a></li>
<li><a href="#type-AclRule-reference">B.110. <code>AclRule</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-acl-resource-reference">B.110.1. <code>resource</code></a></li>
<li><a href="#property-acl-type-reference">B.110.2. <code>type</code></a></li>
<li><a href="#property-acl-operation-reference">B.110.3. <code>operation</code></a></li>
<li><a href="#property-acl-host-reference">B.110.4. <code>host</code></a></li>
</ul>
</li>
<li><a href="#type-AclRuleTopicResource-reference">B.111. <code>AclRuleTopicResource</code> schema reference</a></li>
<li><a href="#type-AclRuleGroupResource-reference">B.112. <code>AclRuleGroupResource</code> schema reference</a></li>
<li><a href="#type-AclRuleClusterResource-reference">B.113. <code>AclRuleClusterResource</code> schema reference</a></li>
<li><a href="#type-AclRuleTransactionalIdResource-reference">B.114. <code>AclRuleTransactionalIdResource</code> schema reference</a></li>
<li><a href="#type-KafkaUserQuotas-reference">B.115. <code>KafkaUserQuotas</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#quotas">B.115.1. <code>quotas</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaUserTemplate-reference">B.116. <code>KafkaUserTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaUserStatus-reference">B.117. <code>KafkaUserStatus</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker-reference">B.118. <code>KafkaMirrorMaker</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerSpec-reference">B.119. <code>KafkaMirrorMakerSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-mm-whitelist-reference">B.119.1. <code>whitelist</code></a></li>
<li><a href="#property-mm-producer-consumer-reference">B.119.2. <code>KafkaMirrorMakerConsumerSpec</code> and <code>KafkaMirrorMakerProducerSpec</code></a></li>
<li><a href="#property-mm-loggers-reference">B.119.3. <code>logging</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaMirrorMakerConsumerSpec-reference">B.120. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-consumer-streams-reference">B.120.1. <code>numStreams</code></a></li>
<li><a href="#property-consumer-offset-autocommit-reference">B.120.2. <code>offsetCommitInterval</code></a></li>
<li><a href="#property-consumer-config-reference">B.120.3. <code>config</code></a></li>
<li><a href="#property-consumer-group-reference">B.120.4. <code>groupId</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaMirrorMakerTls-reference">B.121. <code>KafkaMirrorMakerTls</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#trustedcertificates_2">B.121.1. <code>trustedCertificates</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaMirrorMakerProducerSpec-reference">B.122. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-producer-abort-on-send-reference">B.122.1. <code>abortOnSendFailure</code></a></li>
<li><a href="#property-producer-config-reference">B.122.2. <code>config</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaMirrorMakerTemplate-reference">B.123. <code>KafkaMirrorMakerTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMakerStatus-reference">B.124. <code>KafkaMirrorMakerStatus</code> schema reference</a></li>
<li><a href="#type-KafkaBridge-reference">B.125. <code>KafkaBridge</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeSpec-reference">B.126. <code>KafkaBridgeSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-kafka-bridge-logging-reference">B.126.1. <code>logging</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaBridgeTls-reference">B.127. <code>KafkaBridgeTls</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeHttpConfig-reference">B.128. <code>KafkaBridgeHttpConfig</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-kafka-bridge-cors-config-reference">B.128.1. <code>cors</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaBridgeHttpCors-reference">B.129. <code>KafkaBridgeHttpCors</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeConsumerSpec-reference">B.130. <code>KafkaBridgeConsumerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeProducerSpec-reference">B.131. <code>KafkaBridgeProducerSpec</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeTemplate-reference">B.132. <code>KafkaBridgeTemplate</code> schema reference</a></li>
<li><a href="#type-KafkaBridgeStatus-reference">B.133. <code>KafkaBridgeStatus</code> schema reference</a></li>
<li><a href="#type-KafkaConnector-reference">B.134. <code>KafkaConnector</code> schema reference</a></li>
<li><a href="#type-KafkaConnectorSpec-reference">B.135. <code>KafkaConnectorSpec</code> schema reference</a></li>
<li><a href="#type-KafkaConnectorStatus-reference">B.136. <code>KafkaConnectorStatus</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2-reference">B.137. <code>KafkaMirrorMaker2</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2Spec-reference">B.138. <code>KafkaMirrorMaker2Spec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">B.139. <code>KafkaMirrorMaker2ClusterSpec</code> schema reference</a>
<ul class="sectlevel3">
<li><a href="#property-mirrormaker2-config-reference">B.139.1. <code>config</code></a></li>
</ul>
</li>
<li><a href="#type-KafkaMirrorMaker2Tls-reference">B.140. <code>KafkaMirrorMaker2Tls</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">B.141. <code>KafkaMirrorMaker2MirrorSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">B.142. <code>KafkaMirrorMaker2ConnectorSpec</code> schema reference</a></li>
<li><a href="#type-KafkaMirrorMaker2Status-reference">B.143. <code>KafkaMirrorMaker2Status</code> schema reference</a></li>
<li><a href="#type-KafkaRebalance-reference">B.144. <code>KafkaRebalance</code> schema reference</a></li>
<li><a href="#type-KafkaRebalanceSpec-reference">B.145. <code>KafkaRebalanceSpec</code> schema reference</a></li>
<li><a href="#type-KafkaRebalanceStatus-reference">B.146. <code>KafkaRebalanceStatus</code> schema reference</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview-str"><a class="link" href="#overview-str">1. Overview of Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi simplifies the process of running Apache Kafka in a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>This guide provides instructions for configuring Kafka components and using Strimzi Operators.
Procedures relate to how you might want to modify your deployment and introduce additional features, such as Cruise Control or distributed tracing.</p>
</div>
<div class="paragraph">
<p>You can configure your deployment using <a href="#assembly-custom-resources-str">Strimzi custom resources</a>.
The <a href="#api_reference-str">Custom resource API reference</a> describes the properties you can use in your configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Looking to get started with Strimzi?
For step-by-step deployment instructions, see the <a href="./deploying.html" target="_blank" rel="noopener"><em>Deploying Strimzi</em> guide</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="key-features-kafka_str"><a class="link" href="#key-features-kafka_str">1.1. Kafka capabilities</a></h3>
<div class="paragraph">
<p>The underlying data stream-processing capabilities and component architecture of Kafka can deliver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Microservices and other applications to share data with extremely high throughput and low latency</p>
</li>
<li>
<p>Message ordering guarantees</p>
</li>
<li>
<p>Message rewind/replay from data storage to reconstruct an application state</p>
</li>
<li>
<p>Message compaction to remove old records when using a key-value log</p>
</li>
<li>
<p>Horizontal scalability in a cluster configuration</p>
</li>
<li>
<p>Replication of data to control fault tolerance</p>
</li>
<li>
<p>Retention of high volumes of data for immediate access</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kafka_use_cases"><a class="link" href="#kafka_use_cases">1.2. Kafka use cases</a></h3>
<div class="paragraph">
<p>Kafka&#8217;s capabilities make it suitable for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Event-driven architectures</p>
</li>
<li>
<p>Event sourcing to capture changes to the state of an application as a log of events</p>
</li>
<li>
<p>Message brokering</p>
</li>
<li>
<p>Website activity tracking</p>
</li>
<li>
<p>Operational monitoring through metrics</p>
</li>
<li>
<p>Log collection and aggregation</p>
</li>
<li>
<p>Commit logs for distributed systems</p>
</li>
<li>
<p>Stream processing so that applications can respond to data in real time</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="key-features-product_str"><a class="link" href="#key-features-product_str">1.3. How Strimzi supports Kafka</a></h3>
<div class="paragraph">
<p>Strimzi provides container images and Operators for running Kafka on Kubernetes.
Strimzi Operators are fundamental to the running of Strimzi.
The Operators provided with Strimzi are purpose-built with specialist operational knowledge to effectively manage Kafka.</p>
</div>
<div class="paragraph">
<p>Operators simplify the process of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploying and running Kafka clusters</p>
</li>
<li>
<p>Deploying and running Kafka components</p>
</li>
<li>
<p>Configuring access to Kafka</p>
</li>
<li>
<p>Securing access to Kafka</p>
</li>
<li>
<p>Upgrading Kafka</p>
</li>
<li>
<p>Managing brokers</p>
</li>
<li>
<p>Creating and managing topics</p>
</li>
<li>
<p>Creating and managing users</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="overview-components_str"><a class="link" href="#overview-components_str">1.4. Strimzi Operators</a></h3>
<div class="paragraph">
<p>Strimzi supports Kafka using <em>Operators</em> to deploy and manage the components and dependencies of Kafka to Kubernetes.</p>
</div>
<div class="paragraph">
<p>Operators are a method of packaging, deploying, and managing a Kubernetes application.
Strimzi Operators extend Kubernetes functionality, automating common and complex tasks related to a Kafka deployment.
By implementing knowledge of Kafka operations in code, Kafka administration tasks are simplified and require less manual intervention.</p>
</div>
<h4 id="key-features-operators_str" class="discrete">Operators</h4>
<div class="paragraph">
<p>Strimzi provides Operators for managing a Kafka cluster running within a Kubernetes cluster.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster Operator</dt>
<dd>
<p>Deploys and manages Apache Kafka clusters, Kafka Connect, Kafka MirrorMaker, Kafka Bridge, Kafka Exporter, and the Entity Operator</p>
</dd>
<dt class="hdlist1">Entity Operator</dt>
<dd>
<p>Comprises the Topic Operator and User Operator</p>
</dd>
<dt class="hdlist1">Topic Operator</dt>
<dd>
<p>Manages Kafka topics</p>
</dd>
<dt class="hdlist1">User Operator</dt>
<dd>
<p>Manages Kafka users</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Cluster Operator can deploy the Topic Operator and User Operator as part of an <strong>Entity Operator</strong> configuration at the same time as a Kafka cluster.</p>
</div>
<div class="paragraph">
<div class="title">Operators within the Strimzi architecture</div>
<p><span class="image"><img src="images/operators.png" alt="Operators within the Strimzi architecture"></span></p>
</div>
<div class="sect3">
<h4 id="overview-components-cluster-operator-str"><a class="link" href="#overview-components-cluster-operator-str">1.4.1. Cluster Operator</a></h4>
<div class="paragraph">
<p>Strimzi uses the Cluster Operator to deploy and manage clusters for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka (including ZooKeeper, Entity Operator, Kafka Exporter, and Cruise Control)</p>
</li>
<li>
<p>Kafka Connect</p>
</li>
<li>
<p>Kafka MirrorMaker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Custom resources are used to deploy the clusters.</p>
</div>
<div class="paragraph">
<p>For example, to deploy a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Kafka</code> resource with the cluster configuration is created within the Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator deploys a corresponding Kafka cluster, based on what is declared in the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Cluster Operator can also deploy (through configuration of the <code>Kafka</code> resource):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Topic Operator to provide operator-style topic management through <code>KafkaTopic</code> custom resources</p>
</li>
<li>
<p>A User Operator to provide operator-style user management through <code>KafkaUser</code> custom resources</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Topic Operator and User Operator function within the Entity Operator on deployment.</p>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Cluster Operator</div>
<p><span class="image"><img src="images/cluster-operator.png" alt="The Cluster Operator creates and deploys Kafka and ZooKeeper clusters"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="overview-concepts-topic-operator-str"><a class="link" href="#overview-concepts-topic-operator-str">1.4.2. Topic Operator</a></h4>
<div class="paragraph">
<p>The Topic Operator provides a way of managing topics in a Kafka cluster through Kubernetes resources.</p>
</div>
<div class="paragraph">
<div class="title">Example architecture for the Topic Operator</div>
<p><span class="image"><img src="images/topic-operator.png" alt="The Topic Operator manages topics for a Kafka cluster via KafkaTopic resources"></span></p>
</div>
<div class="paragraph">
<p>The role of the Topic Operator is to keep a set of <code>KafkaTopic</code> Kubernetes resources describing Kafka topics in-sync with corresponding Kafka topics.</p>
</div>
<div class="paragraph">
<p>Specifically, if a <code>KafkaTopic</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created, the Topic Operator creates the topic</p>
</li>
<li>
<p>Deleted, the Topic Operator deletes the topic</p>
</li>
<li>
<p>Changed, the Topic Operator updates the topic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Working in the other direction, if a topic is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created within the Kafka cluster, the Operator creates a <code>KafkaTopic</code></p>
</li>
<li>
<p>Deleted from the Kafka cluster, the Operator deletes the <code>KafkaTopic</code></p>
</li>
<li>
<p>Changed in the Kafka cluster, the Operator updates the <code>KafkaTopic</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows you to declare a <code>KafkaTopic</code> as part of your application&#8217;s deployment and the Topic Operator will take care of creating the topic for you.
Your application just needs to deal with producing or consuming from the necessary topics.</p>
</div>
<div class="paragraph">
<p>If the topic is reconfigured or reassigned to different Kafka nodes, the <code>KafkaTopic</code> will always be up to date.</p>
</div>
</div>
<div class="sect3">
<h4 id="overview-concepts-user-operator-str"><a class="link" href="#overview-concepts-user-operator-str">1.4.3. User Operator</a></h4>
<div class="paragraph">
<p>The User Operator manages Kafka users for a Kafka cluster by watching for <code>KafkaUser</code> resources that describe Kafka users,
and ensuring that they are configured properly in the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>For example, if a <code>KafkaUser</code> is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Created, the User Operator creates the user it describes</p>
</li>
<li>
<p>Deleted, the User Operator deletes the user it describes</p>
</li>
<li>
<p>Changed, the User Operator updates the user it describes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike the Topic Operator, the User Operator does not sync any changes from the Kafka cluster with the Kubernetes resources.
Kafka topics can be created by applications directly in Kafka, but it is not expected that the users will be managed directly in the Kafka cluster in parallel with the User Operator.</p>
</div>
<div class="paragraph">
<p>The User Operator allows you to declare a <code>KafkaUser</code> resource as part of your application&#8217;s deployment.
You can specify the authentication and authorization mechanism for the user.
You can also configure <em>user quotas</em> that control usage of Kafka resources to ensure, for example, that a user does not monopolize access to a broker.</p>
</div>
<div class="paragraph">
<p>When the user is created, the user credentials are created in a <code>Secret</code>.
Your application needs to use the user and its credentials for authentication and to produce or consume messages.</p>
</div>
<div class="paragraph">
<p>In addition to managing credentials for authentication, the User Operator also manages authorization rules by including a description of the user&#8217;s access rights in the <code>KafkaUser</code> declaration.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-custom-resources-str"><a class="link" href="#assembly-custom-resources-str">1.5. Strimzi custom resources</a></h3>
<div class="paragraph">
<p>A deployment of Kafka components to a Kubernetes cluster using Strimzi is highly configurable through the application of custom resources.
Custom resources are created as instances of APIs added by Custom resource definitions (CRDs) to extend Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>CRDs act as configuration instructions to describe the custom resources in a Kubernetes cluster,
and are provided with Strimzi for each Kafka component used in a deployment, as well as users and topics.
CRDs and custom resources are defined as YAML files.
Example YAML files are provided with the Strimzi distribution.</p>
</div>
<div class="paragraph">
<p>CRDs also allow Strimzi resources to benefit from native Kubernetes features like CLI accessibility and configuration validation.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/" target="_blank" rel="noopener">Extend the Kubernetes API with CustomResourceDefinitions</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-custom-resources-example-str"><a class="link" href="#con-custom-resources-example-str">1.5.1. Strimzi custom resource example</a></h4>
<div class="paragraph">
<p>CRDs require a one-time installation in a cluster to define the schemas used to instantiate and manage Strimzi-specific resources.</p>
</div>
<div class="paragraph">
<p>After a new custom resource type is added to your cluster by installing a CRD, you can create instances of the resource based on its specification.</p>
</div>
<div class="paragraph">
<p>Depending on the cluster setup, installation typically requires cluster admin privileges.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Access to manage custom resources is limited to Strimzi administrators.
For more information, see <a href="./deploying.html#adding-users-the-strimzi-admin-role-str" target="_blank" rel="noopener">Designating Strimzi administrators</a> in the <em>Deploying Strimzi</em> guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A CRD defines a new <code>kind</code> of resource, such as <code>kind:Kafka</code>, within a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>The Kubernetes API server allows custom resources to be created based on the <code>kind</code> and understands from the CRD how to validate and store the custom resource when it is added to the Kubernetes cluster.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When CRDs are deleted, custom resources of that type are also deleted. Additionally, the resources created by the custom resource, such as pods and statefulsets are also deleted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each Strimzi-specific custom resource conforms to the schema defined by the CRD for the resource&#8217;s <code>kind</code>.
The custom resources for Strimzi components have common configuration properties, which are defined under <code>spec</code>.</p>
</div>
<div class="paragraph">
<p>To understand the relationship between a CRD and a custom resource, let&#8217;s look at a sample of the CRD for a Kafka topic.</p>
</div>
<div class="listingblock">
<div class="title">Kafka topic CRD</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: CustomResourceDefinition
metadata: <b class="conum">(1)</b>
  name: kafkatopics.kafka.strimzi.io
  labels:
    app: strimzi
spec: <b class="conum">(2)</b>
  group: kafka.strimzi.io
  versions:
    v1beta1
  scope: Namespaced
  names:
    # ...
    singular: kafkatopic
    plural: kafkatopics
    shortNames:
    - kt <b class="conum">(3)</b>
  additionalPrinterColumns: <b class="conum">(4)</b>
      # ...
  subresources:
    status: {} <b class="conum">(5)</b>
  validation: <b class="conum">(6)</b>
    openAPIV3Schema:
      properties:
        spec:
          type: object
          properties:
            partitions:
              type: integer
              minimum: 1
            replicas:
              type: integer
              minimum: 1
              maximum: 32767
      # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The metadata for the topic CRD, its name and a label to identify the CRD.</p>
</li>
<li>
<p>The specification for this CRD, including the group (domain) name, the plural name and the supported schema version, which are used in the URL to access the API of the topic. The other names are used to identify instance resources in the CLI. For example, <code>kubectl get kafkatopic my-topic</code> or <code>kubectl get kafkatopics</code>.</p>
</li>
<li>
<p>The shortname can be used in CLI commands. For example, <code>kubectl get kt</code> can be used as an abbreviation instead of <code>kubectl get kafkatopic</code>.</p>
</li>
<li>
<p>The information presented when using a <code>get</code> command on the custom resource.</p>
</li>
<li>
<p>The current status of the CRD as described in the <a href="./using.html#type-Kafka-reference" target="_blank" rel="noopener">schema reference</a> for the resource.</p>
</li>
<li>
<p>openAPIV3Schema validation provides validation for the creation of topic custom resources. For example, a topic requires at least one partition and one replica.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can identify the CRD YAML files supplied with the Strimzi installation files, because the file names contain an index number followed by Crd.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a corresponding example of a <code>KafkaTopic</code> custom resource.</p>
</div>
<div class="listingblock">
<div class="title">Kafka topic custom resource</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic <b class="conum">(1)</b>
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster <b class="conum">(2)</b>
spec: <b class="conum">(3)</b>
  partitions: 1
  replicas: 1
  config:
    retention.ms: 7200000
    segment.bytes: 1073741824
status:
  conditions: <b class="conum">(4)</b>
    lastTransitionTime: "2019-08-20T11:37:00.706Z"
    status: "True"
    type: Ready
  observedGeneration: 1
  / ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>kind</code> and <code>apiVersion</code> identify the CRD of which the custom resource is an instance.</p>
</li>
<li>
<p>A label, applicable only to <code>KafkaTopic</code> and <code>KafkaUser</code> resources, that defines the name of the Kafka cluster (which is same as the name of the <code>Kafka</code> resource) to which a topic or user belongs.</p>
</li>
<li>
<p>The spec shows the number of partitions and replicas for the topic as well as the configuration parameters for the topic itself. In this example, the retention period for a message to remain in the topic and the segment file size for the log are specified.</p>
</li>
<li>
<p>Status conditions for the <code>KafkaTopic</code> resource. The <code>type</code> condition changed to <code>Ready</code> at the <code>lastTransitionTime</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Custom resources can be applied to a cluster through the platform CLI.
When the custom resource is created, it uses the same validation as the built-in resources of the Kubernetes API.</p>
</div>
<div class="paragraph">
<p>After a <code>KafkaTopic</code> custom resource is created, the Topic Operator is notified and corresponding Kafka topics are created in Strimzi.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-points-listeners-str"><a class="link" href="#configuration-points-listeners-str">1.6. Listener configuration</a></h3>
<div class="paragraph">
<p>Listeners are used to connect to Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Strimzi provides a generic <code>GenericKafkaListener</code> schema with properties to configure listeners through the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>The <code>GenericKafkaListener</code> provides a flexible approach to listener configuration.</p>
</div>
<div class="paragraph">
<p>You can specify properties to configure <em>internal</em> listeners for connecting within the Kubernetes cluster, or <em>external</em> listeners for connecting outside the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<div class="title">Generic listener configuration</div>
<p>Each listener is <a href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">defined as an array in the <code>Kafka</code> resource</a>.</p>
</div>
<div class="paragraph">
<p>For more information on listener configuration, see the <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<p>Generic listener configuration replaces the previous approach to listener configuration using the <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>,
which is <strong>deprecated</strong>.
However, you can <a href="#property-listener-bwc-reference">convert the old format into the new format</a> with backwards compatibility.</p>
</div>
<div class="paragraph">
<p>The <code>KafkaListeners</code> schema uses sub-properties for <code>plain</code>, <code>tls</code> and <code>external</code> listeners, with fixed ports for each.
Because of the limits inherent in the architecture of the schema, it is only possible to configure three listeners, with configuration options limited to the type of listener.</p>
</div>
<div class="paragraph">
<p>With the <code>GenericKafkaListener</code> schema, you can configure as many listeners as required,
as long as their names and ports are unique.</p>
</div>
<div class="paragraph">
<p>You might want to configure multiple external listeners, for example, to handle access from networks that require different authentication mechanisms.
Or you might need to join your Kubernetes network to an outside network.
In which case, you can configure internal listeners (using the <code>useServiceDnsDomain</code> property) so that the Kubernetes service DNS domain (typically <code>.cluster.local</code>) is not used.</p>
</div>
<div class="paragraph">
<div class="title">Configuring listeners to secure access to Kafka brokers</div>
<p>You can configure listeners for secure connection using authentication.
For more information on securing access to Kafka brokers, see <a href="#assembly-securing-kafka-str">Managing access to Kafka</a>.</p>
</div>
<div class="paragraph">
<div class="title">Configuring external listeners for client access outside Kubernetes</div>
<p>You can configure external listeners for client access outside a Kubernetes environment using a specified connection mechanism, such as a loadbalancer.
For more information on the configuration options for connecting an external client, see <a href="#assembly-configuring-external-listeners-str">Configuring external listeners</a>.</p>
</div>
<div class="paragraph">
<div class="title">Listener certificates</div>
<p>You can provide your own server certificates, called <em>Kafka listener certificates</em>, for TLS listeners or external listeners which have TLS encryption enabled.
For more information, see <a href="#kafka-listener-certificates-str">Kafka listener certificates</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions-str"><a class="link" href="#document-conventions-str">1.7. Document Conventions</a></h3>
<div class="paragraph">
<div class="title">Replaceables</div>
<p>In this document, replaceable text is styled in <code>monospace</code>, with italics, uppercase, and hyphens.</p>
</div>
<div class="paragraph">
<p>For example, in the following code, you will want to replace <code><em>MY-NAMESPACE</em></code> with the name of your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>MY-NAMESPACE</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-deployment-configuration-str"><a class="link" href="#assembly-deployment-configuration-str">2. Deployment configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to configure different aspects of the supported deployments using custom resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka clusters</p>
</li>
<li>
<p>Kafka Connect clusters</p>
</li>
<li>
<p>Kafka Connect clusters with <em>Source2Image</em> support</p>
</li>
<li>
<p>Kafka MirrorMaker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
<li>
<p>Cruise Control</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Labels applied to a custom resource are also applied to the Kubernetes resources comprising Kafka MirrorMaker.
This provides a convenient mechanism for resources to be labeled as required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>Deploying Strimzi</em> guide describes how to <a href="./deploying.html#assembly-metrics-str" target="_blank" rel="noopener">monitor your Strimzi deployment</a>.</p>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-str"><a class="link" href="#assembly-deployment-configuration-kafka-str">2.1. Kafka cluster configuration</a></h3>
<div class="paragraph">
<p>The full schema of the <code>Kafka</code> resource is described in the <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.
All labels that are applied to the desired <code>Kafka</code> resource will also be applied to the Kubernetes resources making up the Kafka cluster.
This provides a convenient mechanism for resources to be labeled as required.</p>
</div>
<div class="sect3">
<h4 id="ref-sample-kafka-resource-config-deployment-configuration-kafka"><a class="link" href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">2.1.1. Sample Kafka YAML configuration</a></h4>
<div class="paragraph">
<p>For help in understanding the configuration options available for your Kafka deployment, refer to sample YAML file provided here.</p>
</div>
<div class="paragraph">
<p>The sample shows only some of the possible configuration options, but those that are particularly important include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource requests (CPU / Memory)</p>
</li>
<li>
<p>JVM options for maximum and minimum memory allocation</p>
</li>
<li>
<p>Listeners (and authentication)</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Storage</p>
</li>
<li>
<p>Rack awareness</p>
</li>
<li>
<p>Metrics</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    replicas: 3 <b class="conum">(1)</b>
    version: 0.20.1 <b class="conum">(2)</b>
    resources: <b class="conum">(3)</b>
      requests:
        memory: 64Gi
        cpu: "8"
      limits: <b class="conum">(4)</b>
        memory: 64Gi
        cpu: "12"
    jvmOptions: <b class="conum">(5)</b>
      -Xms: 8192m
      -Xmx: 8192m
    listeners: <b class="conum">(6)</b>
      - name: plain <b class="conum">(7)</b>
        port: 9092 <b class="conum">(8)</b>
        type: internal <b class="conum">(9)</b>
        tls: false <b class="conum">(10)</b>
        configuration:
          useServiceDnsDomain: true <b class="conum">(11)</b>
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication: <b class="conum">(12)</b>
          type: tls
      - name: external <b class="conum">(13)</b>
        port: 9094
        type: route
        tls: true
        configuration:
          brokerCertChainAndKey: <b class="conum">(14)</b>
            secretName: my-secret
            certificate: my-certificate.crt
            key: my-key.key
    authorization: <b class="conum">(15)</b>
      type: simple
    config: <b class="conum">(16)</b>
      auto.create.topics.enable: "false"
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 2
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(17)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
    storage: <b class="conum">(18)</b>
      type: persistent-claim <b class="conum">(19)</b>
      size: 10000Gi <b class="conum">(20)</b>
    rack: <b class="conum">(21)</b>
      topologyKey: topology.kubernetes.io/zone
    metrics: <b class="conum">(22)</b>
      lowercaseOutputName: true
      rules: <b class="conum">(23)</b>
      # Special cases and very specific rules
      - pattern : kafka.server&lt;type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)&gt;&lt;&gt;Value
        name: kafka_server_$1_$2
        type: GAUGE
        labels:
          clientId: "$3"
          topic: "$4"
          partition: "$5"
        # ...
  zookeeper: <b class="conum">(24)</b>
    replicas: 3
    resources:
      requests:
        memory: 8Gi
        cpu: "2"
      limits:
        memory: 8Gi
        cpu: "2"
    jvmOptions:
      -Xms: 4096m
      -Xmx: 4096m
    storage:
      type: persistent-claim
      size: 1000Gi
    metrics:
      # ...
  entityOperator: <b class="conum">(25)</b>
    topicOperator:
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
    userOperator:
      resources:
        requests:
          memory: 512Mi
          cpu: "1"
        limits:
          memory: 512Mi
          cpu: "1"
  kafkaExporter: <b class="conum">(26)</b>
    # ...
  cruiseControl: <b class="conum">(27)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Replicas <a href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">specifies the number of broker nodes</a>.</p>
</li>
<li>
<p>Kafka version, which can be changed by following <a href="./deploying.html#assembly-upgrade-str">the upgrade procedure</a>.</p>
</li>
<li>
<p>Resource requests <a href="#ref-resource-limits-and-requests-deployment-configuration-kafka">specify the resources to reserve for a given container</a>.</p>
</li>
<li>
<p>Resource limits specify the maximum resources that can be consumed by a container.</p>
</li>
<li>
<p>JVM options can <a href="#ref-jvm-options-deployment-configuration-kafka">specify the minimum (<code>-Xms</code>) and maximum (<code>-Xmx</code>) memory allocation for JVM</a>.</p>
</li>
<li>
<p>Listeners configure how clients connect to the Kafka cluster via bootstrap addresses. Listeners are <a href="#assembly-securing-kafka-brokers-str">configured as <em>internal</em> or <em>external</em> listeners for connection inside or outside the Kubernetes cluster</a>.</p>
</li>
<li>
<p>Name to identify the listener. Must be unique within the Kafka cluster.</p>
</li>
<li>
<p>Port number used by the listener inside Kafka. The port number has to be unique within a given Kafka cluster. Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX. Depending on the listener type, the port number might not be the same as the port number that connects Kafka clients.</p>
</li>
<li>
<p>Listener type specified as <code>internal</code>, or for external listeners, as <code>route</code>, <code>loadbalancer</code>, <code>nodeport</code> or <code>ingress</code>.</p>
</li>
<li>
<p>Enables TLS encryption for each listener. Default is <code>false</code>. TLS encryption is not required for <code>route</code> listeners.</p>
</li>
<li>
<p>Defines whether the fully-qualified DNS names including the cluster service suffix (usually <code>.cluster.local</code>) are assigned.</p>
</li>
<li>
<p>Listener authentication mechanism <a href="#assembly-securing-kafka-brokers-str">specified as mutual TLS, SCRAM-SHA-512 or token-based OAuth 2.0</a>.</p>
</li>
<li>
<p>External listener configuration specifies <a href="#assembly-configuring-external-listeners-str">how the Kafka cluster is exposed outside Kubernetes, such as through a <code>route</code>, <code>loadbalancer</code> or <code>nodeport</code></a>.</p>
</li>
<li>
<p>Optional configuration for a <a href="#kafka-listener-certificates-str">Kafka listener certificate</a> managed by an external Certificate Authority. The <code>brokerCertChainAndKey</code> property specifies a <code>Secret</code> that holds a server certificate and a private key. Kafka listener certificates can also be configured for TLS listeners.</p>
</li>
<li>
<p>Authorization <a href="#con-securing-kafka-authorization-str">enables simple, OAUTH 2.0 or OPA authorization on the Kafka broker.</a> Simple authorization uses the <code>AclAuthorizer</code> Kafka plugin.</p>
</li>
<li>
<p>Config specifies the broker configuration. <a href="#type-KafkaClusterSpec-reference">Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi</a>.</p>
</li>
<li>
<p><a href="#type-KafkaClusterSpec-reference">SSL properties for external listeners to run with a specific <em>cipher suite</em> for a TLS version</a>.</p>
</li>
<li>
<p>Storage is <a href="#assembly-storage-deployment-configuration-kafka">configured as <code>ephemeral</code>, <code>persistent-claim</code> or <code>jbod</code></a>.</p>
</li>
<li>
<p>Storage size for <a href="#proc-resizing-persistent-volumes-deployment-configuration-kafka">persistent volumes may be increased</a> and additional <a href="#proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka">volumes may be added to JBOD storage</a>.</p>
</li>
<li>
<p>Persistent storage has <a href="#ref-persistent-storage-deployment-configuration-kafka">additional configuration options</a>, such as a storage <code>id</code> and <code>class</code> for dynamic volume provisioning.</p>
</li>
<li>
<p>Rack awareness is configured to <a href="#assembly-kafka-rack-deployment-configuration-kafka">spread replicas across different racks</a>. A <code>topology</code> key must match the label of a cluster node.</p>
</li>
<li>
<p>Kafka <a href="./deploying.html#assembly-metrics-setup-str">metrics configuration for use with Prometheus</a>.</p>
</li>
<li>
<p>Kafka rules for exporting metrics to a Grafana dashboard through the JMX Exporter. A set of rules provided with Strimzi may be copied to your Kafka resource configuration.</p>
</li>
<li>
<p><a href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">ZooKeeper-specific configuration</a>, which contains properties similar to the Kafka configuration.</p>
</li>
<li>
<p>Entity Operator configuration, which <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">specifies the configuration for the Topic Operator and User Operator</a>.</p>
</li>
<li>
<p>Kafka Exporter configuration, which is used <a href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">to expose data as Prometheus metrics</a>.</p>
</li>
<li>
<p>Cruise Control configuration, which is used <a href="#cruise-control-concepts-str">to rebalance the Kafka cluster</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="considerations-for-data-storage-deployment-configuration-kafka"><a class="link" href="#considerations-for-data-storage-deployment-configuration-kafka">2.1.2. Data storage considerations</a></h4>
<div class="paragraph">
<p>An efficient data storage infrastructure is essential to the optimal performance of Strimzi.</p>
</div>
<div class="paragraph">
<p>Block storage is required.
File storage, such as NFS, does not work with Kafka.</p>
</div>
<div class="paragraph">
<p>For your block storage, you can choose, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cloud-based block storage solutions, such as <a href="https://aws.amazon.com/ebs/" target="_blank" rel="noopener">Amazon Elastic Block Store (EBS)</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/storage/volumes/#local" target="_blank" rel="noopener">Local persistent volumes</a></p>
</li>
<li>
<p>Storage Area Network (SAN) volumes accessed by a protocol such as <em>Fibre Channel</em> or <em>iSCSI</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi does not require Kubernetes raw block volumes.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="file_systems"><a class="link" href="#file_systems">File systems</a></h5>
<div class="paragraph">
<p>It is recommended that you configure your storage system to use the <em>XFS</em> file system.
Strimzi is also compatible with the <em>ext4</em> file system, but this might require additional configuration for best results.</p>
</div>
</div>
<div class="sect4">
<h5 id="apache_kafka_and_zookeeper_storage"><a class="link" href="#apache_kafka_and_zookeeper_storage">Apache Kafka and ZooKeeper storage</a></h5>
<div class="paragraph">
<p>Use separate disks for Apache Kafka and ZooKeeper.</p>
</div>
<div class="paragraph">
<p>Three types of data storage are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ephemeral (Recommended for development only)</p>
</li>
<li>
<p>Persistent</p>
</li>
<li>
<p>JBOD  (Just a Bunch of Disks, suitable for Kafka only)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="#assembly-storage-deployment-configuration-kafka">Kafka and ZooKeeper storage</a>.</p>
</div>
<div class="paragraph">
<p>Solid-state drives (SSDs), though not essential, can improve the performance of Kafka in large clusters where data is sent to and received from multiple topics asynchronously. SSDs are particularly effective with ZooKeeper, which requires fast, low latency data access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You do not need to provision replicated storage because Kafka and ZooKeeper both have built-in data replication.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-storage-deployment-configuration-kafka"><a class="link" href="#assembly-storage-deployment-configuration-kafka">2.1.3. Kafka and ZooKeeper storage types</a></h4>
<div class="paragraph">
<p>As stateful applications, Kafka and ZooKeeper need to store data on disk. Strimzi supports three storage types for this data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ephemeral</p>
</li>
<li>
<p>Persistent</p>
</li>
<li>
<p>JBOD storage</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
JBOD storage is supported only for Kafka, not for ZooKeeper.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When configuring a <code>Kafka</code> resource, you can specify the type of storage used by the Kafka broker and its corresponding ZooKeeper node. You configure the storage type using the <code>storage</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The storage type is configured in the <code>type</code> field.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The storage type cannot be changed after a Kafka cluster is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about ephemeral storage, see <a href="#type-EphemeralStorage-reference">ephemeral storage schema reference</a>.</p>
</li>
<li>
<p>For more information about persistent storage, see <a href="#type-PersistentClaimStorage-reference">persistent storage schema reference</a>.</p>
</li>
<li>
<p>For more information about JBOD storage, see <a href="#type-JbodStorage-reference">JBOD schema reference</a>.</p>
</li>
<li>
<p>For more information about the schema for <code>Kafka</code>, see <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-ephemeral-storage-deployment-configuration-kafka"><a class="link" href="#ref-ephemeral-storage-deployment-configuration-kafka">Ephemeral storage</a></h5>
<div class="paragraph">
<p>Ephemeral storage uses the <code><a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener">emptyDir</a></code> volumes to store data.
To use ephemeral storage, the <code>type</code> field should be set to <code>ephemeral</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>emptyDir</code> volumes are not persistent and the data stored in them will be lost when the Pod is restarted.
After the new pod is started, it has to recover all data from other nodes of the cluster.
Ephemeral storage is not suitable for use with single node ZooKeeper clusters and for Kafka topics with replication factor 1, because it will lead to data loss.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example of Ephemeral storage</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: ephemeral
    # ...
  zookeeper:
    # ...
    storage:
      type: ephemeral
    # ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="log_directories"><a class="link" href="#log_directories">Log directories</a></h6>
<div class="paragraph">
<p>The ephemeral volume will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>idx</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ref-persistent-storage-deployment-configuration-kafka"><a class="link" href="#ref-persistent-storage-deployment-configuration-kafka">Persistent storage</a></h5>
<div class="paragraph">
<p>Persistent storage uses <a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/" target="_blank" rel="noopener">Persistent Volume Claims</a> to provision persistent volumes for storing data.
Persistent Volume Claims can be used to provision volumes of many different types, depending on the <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">Storage Class</a> which will provision the volume.
The data types which can be used with persistent volume claims include many types of SAN storage as well as <a href="https://kubernetes.io/docs/concepts/storage/volumes/#local" target="_blank" rel="noopener">Local persistent volumes</a>.</p>
</div>
<div class="paragraph">
<p>To use persistent storage, the <code>type</code> has to be set to <code>persistent-claim</code>.
Persistent storage supports additional configuration options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>id</code> (optional)</dt>
<dd>
<p>Storage identification number. This option is mandatory for storage volumes defined in a JBOD storage declaration.
Default is <code>0</code>.</p>
</dd>
<dt class="hdlist1"><code>size</code> (required)</dt>
<dd>
<p>Defines the size of the persistent volume claim, for example, "1000Gi".</p>
</dd>
<dt class="hdlist1"><code>class</code> (optional)</dt>
<dd>
<p>The Kubernetes <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">Storage Class</a> to use for dynamic volume provisioning.</p>
</dd>
<dt class="hdlist1"><code>selector</code> (optional)</dt>
<dd>
<p>Allows selecting a specific persistent volume to use.
It contains key:value pairs representing labels for selecting such a volume.</p>
</dd>
<dt class="hdlist1"><code>deleteClaim</code> (optional)</dt>
<dd>
<p>Boolean value which specifies if the Persistent Volume Claim has to be deleted when the cluster is undeployed.
Default is <code>false</code>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Increasing the size of persistent volumes in an existing Strimzi cluster is only supported in Kubernetes versions that support persistent volume resizing. The persistent volume to be resized must use a storage class that supports volume expansion.
For other versions of Kubernetes and storage classes which do not support volume expansion, you must decide the necessary storage size before deploying the cluster.
Decreasing the size of existing persistent volumes is not possible.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with 1000Gi <code>size</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1000Gi
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates the use of a storage class.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with specific Storage Class</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1Gi
  class: my-storage-class
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, a <code>selector</code> can be used to select a specific labeled persistent volume to provide needed features such as an SSD.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment of persistent storage configuration with selector</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: persistent-claim
  size: 1Gi
  selector:
    hdd-type: ssd
  deleteClaim: true
# ...</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="storage_class_overrides"><a class="link" href="#storage_class_overrides">Storage class overrides</a></h6>
<div class="paragraph">
<p>You can specify a different storage class for one or more Kafka brokers or ZooKeeper nodes, instead of using the default storage class.
This is useful if, for example, storage classes are restricted to different availability zones or data centers.
You can use the <code>overrides</code> field for this purpose.</p>
</div>
<div class="paragraph">
<p>In this example, the default storage class is named <code>my-storage-class</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example Strimzi cluster using storage class overrides</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  labels:
    app: my-cluster
  name: my-cluster
  namespace: myproject
spec:
  # ...
  kafka:
    replicas: 3
    storage:
      deleteClaim: true
      size: 100Gi
      type: persistent-claim
      class: my-storage-class
      overrides:
        - broker: 0
          class: my-storage-class-zone-1a
        - broker: 1
          class: my-storage-class-zone-1b
        - broker: 2
          class: my-storage-class-zone-1c
  # ...
  zookeeper:
    replicas: 3
    storage:
      deleteClaim: true
      size: 100Gi
      type: persistent-claim
      class: my-storage-class
      overrides:
        - broker: 0
          class: my-storage-class-zone-1a
        - broker: 1
          class: my-storage-class-zone-1b
        - broker: 2
          class: my-storage-class-zone-1c
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result of the configured <code>overrides</code> property, the volumes use the following storage classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The persistent volumes of ZooKeeper node 0 will use <code>my-storage-class-zone-1a</code>.</p>
</li>
<li>
<p>The persistent volumes of ZooKeeper node 1 will use <code>my-storage-class-zone-1b</code>.</p>
</li>
<li>
<p>The persistent volumes of ZooKeeepr node 2 will use <code>my-storage-class-zone-1c</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 0 will use <code>my-storage-class-zone-1a</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 1 will use <code>my-storage-class-zone-1b</code>.</p>
</li>
<li>
<p>The persistent volumes of Kafka broker 2 will use <code>my-storage-class-zone-1c</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>overrides</code> property is currently used only to override storage class configurations. Overriding other storage configuration fields is not currently supported.
Other fields from the storage configuration are currently not supported.</p>
</div>
</div>
<div class="sect5">
<h6 id="pvc-naming"><a class="link" href="#pvc-naming">Persistent Volume Claim naming</a></h6>
<div class="paragraph">
<p>When persistent storage is used, it creates Persistent Volume Claims with the following names:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the ZooKeeper node pod <code><em>idx</em></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="log_directories_2"><a class="link" href="#log_directories_2">Log directories</a></h6>
<div class="paragraph">
<p>The persistent volume will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>idx</em></code> is the Kafka broker pod index. For example <code>/var/lib/kafka/data/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-resizing-persistent-volumes-deployment-configuration-kafka"><a class="link" href="#proc-resizing-persistent-volumes-deployment-configuration-kafka">Resizing persistent volumes</a></h5>
<div class="paragraph">
<p>You can provision increased storage capacity by increasing the size of the persistent volumes used by an existing Strimzi cluster.
Resizing persistent volumes is supported in clusters that use either a single persistent volume or multiple persistent volumes in a JBOD storage configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can increase but not decrease the size of persistent volumes.
Decreasing the size of persistent volumes is not currently supported in Kubernetes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster with support for volume resizing.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster using persistent volumes created using a storage class that supports volume expansion.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a <code>Kafka</code> resource, increase the size of the persistent volume allocated to the Kafka cluster, the ZooKeeper cluster, or both.</p>
<div class="ulist">
<ul>
<li>
<p>To increase the volume size allocated to the Kafka cluster, edit the <code>spec.kafka.storage</code> property.</p>
</li>
<li>
<p>To increase the volume size allocated to the ZooKeeper cluster, edit the <code>spec.zookeeper.storage</code> property.</p>
<div class="paragraph">
<p>For example, to increase the volume size from <code>1000Gi</code> to <code>2000Gi</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: persistent-claim
      size: 2000Gi
      class: my-storage-class
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes increases the capacity of the selected persistent volumes in response to a request from the Cluster Operator.
When the resizing is complete, the Cluster Operator restarts all pods that use the resized persistent volumes.
This happens automatically.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about resizing persistent volumes in Kubernetes, see <a href="https://kubernetes.io/blog/2018/07/12/resizing-persistent-volumes-using-kubernetes/" target="_blank" rel="noopener">Resizing Persistent Volumes using Kubernetes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ref-jbod-storage-deployment-configuration-kafka"><a class="link" href="#ref-jbod-storage-deployment-configuration-kafka">JBOD storage overview</a></h5>
<div class="paragraph">
<p>You can configure Strimzi to use JBOD, a data storage configuration of multiple disks or volumes. JBOD is one approach to providing increased data storage for Kafka brokers. It can also improve performance.</p>
</div>
<div class="paragraph">
<p>A JBOD configuration is described by one or more volumes, each of which can be either <a href="#ref-ephemeral-storage-deployment-configuration-kafka">ephemeral</a> or <a href="#ref-persistent-storage-deployment-configuration-kafka">persistent</a>. The rules and constraints for JBOD volume declarations are the same as those for ephemeral and persistent storage. For example, you cannot change the size of a persistent storage volume after it has been provisioned.</p>
</div>
<div class="sect5">
<h6 id="jbod_configuration"><a class="link" href="#jbod_configuration">JBOD configuration</a></h6>
<div class="paragraph">
<p>To use JBOD with Strimzi, the storage <code>type</code> must be set to <code>jbod</code>. The <code>volumes</code> property allows you to describe the disks that make up your JBOD storage array or configuration. The following fragment shows an example JBOD configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
storage:
  type: jbod
  volumes:
  - id: 0
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
  - id: 1
    type: persistent-claim
    size: 100Gi
    deleteClaim: false
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ids cannot be changed once the JBOD volumes are created.</p>
</div>
<div class="paragraph">
<p>Users can add or remove volumes from the JBOD configuration.</p>
</div>
</div>
<div class="sect5">
<h6 id="jbod-pvc"><a class="link" href="#jbod-pvc">JBOD and Persistent Volume Claims</a></h6>
<div class="paragraph">
<p>When persistent storage is used to declare JBOD volumes, the naming scheme of the resulting Persistent Volume Claims is as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Where <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod <code><em>idx</em></code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="log_directories_3"><a class="link" href="#log_directories_3">Log directories</a></h6>
<div class="paragraph">
<p>The JBOD volumes will be used by the Kafka brokers as log directories mounted into the following path:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>/var/lib/kafka/data-<em>id</em>/kafka-log_idx_</code></dt>
<dd>
<p>Where <code><em>id</em></code> is the ID of the volume used for storing data for Kafka broker pod <code><em>idx</em></code>. For example <code>/var/lib/kafka/data-0/kafka-log0</code>.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka"><a class="link" href="#proc-adding-volumes-to-jbod-storage-deployment-configuration-kafka">Adding volumes to JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to add volumes to a Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When adding a new volume under an <code>id</code> which was already used in the past and removed, you have to make sure that the previously used <code>PersistentVolumeClaims</code> have been deleted.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Add the new volumes to the <code>volumes</code> array.
For example, add the new volume with id <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 1
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
      - id: 2
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create new topics or reassign existing partitions to the new disks.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-removing-volumes-from-jbod-storage-deployment-configuration-kafka"><a class="link" href="#proc-removing-volumes-from-jbod-storage-deployment-configuration-kafka">Removing volumes from JBOD storage</a></h5>
<div class="paragraph">
<p>This procedure describes how to remove volumes from Kafka cluster configured to use JBOD storage.
It cannot be applied to Kafka clusters configured to use any other storage type.
The JBOD storage always has to contain at least one volume.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
To avoid data loss, you have to move all partitions before removing the volumes.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with JBOD storage with two or more volumes</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Reassign all partitions from the disks which are you going to remove.
Any data in partitions still assigned to the disks which are going to be removed might be lost.</p>
</li>
<li>
<p>Edit the <code>spec.kafka.storage.volumes</code> property in the <code>Kafka</code> resource.
Remove one or more volumes from the <code>volumes</code> array.
For example, remove the volumes with ids <code>1</code> and <code>2</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about reassigning topics, see <a href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-broker-replicas-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-replicas-deployment-configuration-kafka">2.1.4. Kafka broker replicas</a></h4>
<div class="paragraph">
<p>A Kafka cluster can run with many brokers.
You can configure the number of brokers used for the Kafka cluster in <code>Kafka.spec.kafka.replicas</code>.
The best number of brokers for your cluster has to be determined based on your specific use case.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-broker-replicas-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-broker-replicas-deployment-configuration-kafka">Configuring the number of broker nodes</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure the number of Kafka broker nodes in a new cluster.
It only applies to new clusters with no partitions.
If your cluster already has topics defined, see
<a href="#scaling-clusters-deployment-configuration-kafka">Scaling clusters</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A Kafka cluster with no topics defined yet</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>replicas</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    replicas: 3
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>If your cluster already has topics defined, see
<a href="#scaling-clusters-deployment-configuration-kafka">Scaling clusters</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-broker-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-broker-configuration-deployment-configuration-kafka">2.1.5. Kafka broker configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of the Kafka brokers in your Kafka cluster.
You can specify and configure most of the options listed in the "Broker Configs" section of the <a href="http://kafka.apache.org/documentation/#brokerconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a>. You cannot configure options that are related to the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Broker ID configuration</p>
</li>
<li>
<p>Configuration of log data directories</p>
</li>
<li>
<p>Inter-broker communication</p>
</li>
<li>
<p>ZooKeeper connectivity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="paragraph">
<p>For more information on broker configuration, see the <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code> schema</a>.</p>
</div>
<div class="paragraph">
<div class="title">Listener configuration</div>
<p>You configure listeners for connecting to Kafka brokers.
For more information on configuring listeners, see <a href="#configuration-points-listeners-deployment-configuration-kafka">Listener configuration</a></p>
</div>
<div class="paragraph">
<div class="title">Authorizing access to Kafka</div>
<p>You can configure your Kafka cluster to allow or decline actions executed by users.
For more information on securing access to Kafka brokers, see <a href="#assembly-securing-kafka-str">Managing access to Kafka</a>.</p>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-brokers-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-brokers-deployment-configuration-kafka">Configuring Kafka brokers</a></h5>
<div class="paragraph">
<p>You can configure an existing Kafka broker, or create a new Kafka broker with a specified configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.kafka.config</code> property in the <code>Kafka</code> resource, enter one or more Kafka configuration settings. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    config:
      default.replication.factor: 3
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 1
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration-points-listeners-deployment-configuration-kafka"><a class="link" href="#configuration-points-listeners-deployment-configuration-kafka">2.1.6. Listener configuration</a></h4>
<div class="paragraph">
<p>Listeners are used to connect to Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Strimzi provides a generic <code>GenericKafkaListener</code> schema with properties to configure listeners through the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>The <code>GenericKafkaListener</code> provides a flexible approach to listener configuration.</p>
</div>
<div class="paragraph">
<p>You can specify properties to configure <em>internal</em> listeners for connecting within the Kubernetes cluster, or <em>external</em> listeners for connecting outside the Kubernetes cluster.</p>
</div>
<div class="paragraph">
<div class="title">Generic listener configuration</div>
<p>Each listener is <a href="#ref-sample-kafka-resource-config-deployment-configuration-kafka">defined as an array in the <code>Kafka</code> resource</a>.</p>
</div>
<div class="paragraph">
<p>For more information on listener configuration, see the <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<p>Generic listener configuration replaces the previous approach to listener configuration using the <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code> schema reference</a>,
which is <strong>deprecated</strong>.
However, you can <a href="#property-listener-bwc-reference">convert the old format into the new format</a> with backwards compatibility.</p>
</div>
<div class="paragraph">
<p>The <code>KafkaListeners</code> schema uses sub-properties for <code>plain</code>, <code>tls</code> and <code>external</code> listeners, with fixed ports for each.
Because of the limits inherent in the architecture of the schema, it is only possible to configure three listeners, with configuration options limited to the type of listener.</p>
</div>
<div class="paragraph">
<p>With the <code>GenericKafkaListener</code> schema, you can configure as many listeners as required,
as long as their names and ports are unique.</p>
</div>
<div class="paragraph">
<p>You might want to configure multiple external listeners, for example, to handle access from networks that require different authentication mechanisms.
Or you might need to join your Kubernetes network to an outside network.
In which case, you can configure internal listeners (using the <code>useServiceDnsDomain</code> property) so that the Kubernetes service DNS domain (typically <code>.cluster.local</code>) is not used.</p>
</div>
<div class="paragraph">
<div class="title">Configuring listeners to secure access to Kafka brokers</div>
<p>You can configure listeners for secure connection using authentication.
For more information on securing access to Kafka brokers, see <a href="#assembly-securing-kafka-str">Managing access to Kafka</a>.</p>
</div>
<div class="paragraph">
<div class="title">Configuring external listeners for client access outside Kubernetes</div>
<p>You can configure external listeners for client access outside a Kubernetes environment using a specified connection mechanism, such as a loadbalancer.
For more information on the configuration options for connecting an external client, see <a href="#assembly-configuring-external-listeners-str">Configuring external listeners</a>.</p>
</div>
<div class="paragraph">
<div class="title">Listener certificates</div>
<p>You can provide your own server certificates, called <em>Kafka listener certificates</em>, for TLS listeners or external listeners which have TLS encryption enabled.
For more information, see <a href="#kafka-listener-certificates-str">Kafka listener certificates</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-replicas-deployment-configuration-kafka">2.1.7. ZooKeeper replicas</a></h4>
<div class="paragraph">
<p>ZooKeeper clusters or ensembles usually run with an odd number of nodes, typically three, five, or seven.</p>
</div>
<div class="paragraph">
<p>The majority of nodes must be available in order to maintain an effective quorum. If the ZooKeeper cluster loses its quorum, it will stop responding to clients and the Kafka brokers will stop working. Having a stable and highly available ZooKeeper cluster is crucial for Strimzi.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Three-node cluster</dt>
<dd>
<p>A three-node ZooKeeper cluster requires at least two nodes to be up and running in order to maintain the quorum.
It can tolerate only one node being unavailable.</p>
</dd>
<dt class="hdlist1">Five-node cluster</dt>
<dd>
<p>A five-node ZooKeeper cluster requires at least three nodes to be up and running in order to maintain the quorum.
It can tolerate two nodes being unavailable.</p>
</dd>
<dt class="hdlist1">Seven-node cluster</dt>
<dd>
<p>A seven-node ZooKeeper cluster requires at least four nodes to be up and running in order to maintain the quorum.
It can tolerate three nodes being unavailable.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For development purposes, it is also possible to run ZooKeeper with a single node.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Having more nodes does not necessarily mean better performance, as the costs to maintain the quorum will rise with the number of nodes in the cluster.
Depending on your availability requirements, you can decide for the number of nodes to use.</p>
</div>
<div class="sect4">
<h5 id="ref-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#ref-zookeeper-replicas-deployment-configuration-kafka">Number of ZooKeeper nodes</a></h5>
<div class="paragraph">
<p>The number of ZooKeeper nodes can be configured using the <code>replicas</code> property in <code>Kafka.spec.zookeeper</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example showing replicas configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    replicas: 3
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-zookeeper-replicas-deployment-configuration-kafka"><a class="link" href="#proc-configuring-zookeeper-replicas-deployment-configuration-kafka">Changing the number of ZooKeeper replicas</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.zookeeper.replicas</code> property in the <code>Kafka</code> resource, enter the number of replicated ZooKeeper servers.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    replicas: 3
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-node-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-node-configuration-deployment-configuration-kafka">2.1.8. ZooKeeper configuration</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the configuration of Apache ZooKeeper nodes.
You can specify and configure most of the options listed in the <a href="https://zookeeper.apache.org/doc/r3.5.8/zookeeperAdmin.html" target="_blank" rel="noopener">ZooKeeper documentation</a>.</p>
</div>
<div class="paragraph">
<p>Options which cannot be configured are those related to the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener configuration</p>
</li>
<li>
<p>Configuration of data directories</p>
</li>
<li>
<p>ZooKeeper cluster composition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured by Strimzi.</p>
</div>
<div class="sect4">
<h5 id="ref-zookeeper-node-configuration-deployment-configuration-kafka"><a class="link" href="#ref-zookeeper-node-configuration-deployment-configuration-kafka">ZooKeeper configuration</a></h5>
<div class="paragraph">
<p>ZooKeeper nodes are configured using the <code>config</code> property in <code>Kafka.spec.zookeeper</code>.
This property contains the ZooKeeper configuration options as keys.
The values can be described using one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can specify and configure the options listed in <a href="https://zookeeper.apache.org/doc/r3.5.8/zookeeperAdmin.html" target="_blank" rel="noopener">ZooKeeper documentation</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server.</code></p>
</li>
<li>
<p><code>dataDir</code></p>
</li>
<li>
<p><code>dataLogDir</code></p>
</li>
<li>
<p><code>clientPort</code></p>
</li>
<li>
<p><code>authProvider</code></p>
</li>
<li>
<p><code>quorum.auth</code></p>
</li>
<li>
<p><code>requireClientAuthScheme</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to ZooKeeper.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When invalid configuration is provided, the ZooKeeper cluster might not start or might become unstable.
In such cases, the configuration in the <code>Kafka.spec.zookeeper.config</code> object should be fixed and the Cluster Operator will roll out the new configuration to all ZooKeeper nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Selected options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>timeTick</code> with default value <code>2000</code></p>
</li>
<li>
<p><code>initLimit</code> with default value <code>5</code></p>
</li>
<li>
<p><code>syncLimit</code> with default value <code>2</code></p>
</li>
<li>
<p><code>autopurge.purgeInterval</code> with default value <code>1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options will be automatically configured when they are not present in the <code>Kafka.spec.zookeeper.config</code> property.</p>
</div>
<div class="paragraph">
<p>Use the three allowed <code>ssl</code> configuration options for client connection using a specific <em>cipher suite</em> for a TLS version.
A cipher suite combines algorithms for secure connection and data transfer.</p>
</div>
<div class="listingblock">
<div class="title">Example ZooKeeper configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    config:
      autopurge.snapRetainCount: 3
      autopurge.purgeInterval: 1
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(1)</b>
      ssl.enabled.protocols: "TLSv1.2" <b class="conum">(2)</b>
      ssl.protocol: "TLSv1.2" <b class="conum">(3)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The cipher suite for TLS using a combination of <code>ECDHE</code> key exchange mechanism, <code>RSA</code> authentication algorithm,
<code>AES</code> bulk encyption algorithm and <code>SHA384</code> MAC algorithm.</p>
</li>
<li>
<p>The SSl protocol <code>TLSv1.2</code> is enabled.</p>
</li>
<li>
<p>Specifies the <code>TLSv1.2</code> protocol to generate the SSL context.
Allowed values are <code>TLSv1.1</code> and <code>TLSv1.2</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-zookeeper-nodes-deployment-configuration-kafka"><a class="link" href="#proc-configuring-zookeeper-nodes-deployment-configuration-kafka">Configuring ZooKeeper</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the YAML configuration file that contains the <code>Kafka</code> resource specifying the cluster deployment.</p>
</li>
<li>
<p>In the <code>spec.zookeeper.config</code> property in the <code>Kafka</code> resource, enter one or more ZooKeeper configuration settings. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    config:
      autopurge.snapRetainCount: 3
      autopurge.purgeInterval: 1
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>kafka.yaml</em></code> is the YAML configuration file for the resource that you want to configure; for example, <code>kafka-persistent.yaml</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-zookeeper-connection-deployment-configuration-kafka"><a class="link" href="#assembly-zookeeper-connection-deployment-configuration-kafka">2.1.9. ZooKeeper connection</a></h4>
<div class="paragraph">
<p>ZooKeeper services are secured with encryption and authentication and are not intended to be used by external applications that are not part of Strimzi.</p>
</div>
<div class="paragraph">
<p>However, if you want to use Kafka CLI tools that require a connection to ZooKeeper, you can use a terminal inside a ZooKeeper container and connect to <code>localhost:12181</code> as the ZooKeeper address.</p>
</div>
<div class="sect4">
<h5 id="proc-connnecting-to-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-connnecting-to-zookeeper-deployment-configuration-kafka">Connecting to ZooKeeper from a terminal</a></h5>
<div class="paragraph">
<p>Most Kafka CLI tools can connect directly to Kafka.
So you should under normal circumstances not need to connect to ZooKeeper.
In case it is needed, you can follow this procedure.
Open a terminal inside a ZooKeeper container to use Kafka CLI tools that require a ZooKeeper connection.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster is available.</p>
</li>
<li>
<p>A Kafka cluster is running.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the terminal using the Kubernetes console or run the <code>exec</code> command from your CLI.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec -it <em>my-cluster</em>-zookeeper-0 -- bin/kafka-topics.sh --list --zookeeper localhost:12181</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to use <code>localhost:12181</code>.</p>
</div>
<div class="paragraph">
<p>You can now run Kafka commands to ZooKeeper.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-entity-operator-deployment-configuration-kafka">2.1.10. Entity Operator</a></h4>
<div class="paragraph">
<p>The Entity Operator is responsible for managing Kafka-related entities in a running Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The Entity Operator comprises the:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#overview-concepts-topic-operator-str">Topic Operator</a> to manage Kafka topics</p>
</li>
<li>
<p><a href="#overview-concepts-user-operator-str">User Operator</a> to manage Kafka users</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Through <code>Kafka</code> resource configuration, the Cluster Operator can deploy the Entity Operator, including one or both operators, when deploying a Kafka cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When deployed, the Entity Operator contains the operators according to the deployment configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The operators are automatically configured to manage the topics and users of the Kafka cluster.</p>
</div>
<div class="sect4">
<h5 id="ref-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#ref-kafka-entity-operator-deployment-configuration-kafka">Entity Operator configuration properties</a></h5>
<div class="paragraph">
<p>Use the <code>entityOperator</code> property in <code>Kafka.spec</code> to configure the Entity Operator.</p>
</div>
<div class="paragraph">
<p>The <code>entityOperator</code> property supports several sub-properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>tlsSidecar</code></p>
</li>
<li>
<p><code>topicOperator</code></p>
</li>
<li>
<p><code>userOperator</code></p>
</li>
<li>
<p><code>template</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>tlsSidecar</code> property contains the configuration of the TLS sidecar container, which is used to communicate with ZooKeeper.
For more information on configuring the TLS sidecar, see <a href="#assembly-tls-sidecar-deployment-configuration-kafka">TLS sidecar</a>.</p>
</div>
<div class="paragraph">
<p>The <code>template</code> property contains the configuration of the Entity Operator pod, such as labels, annotations, affinity, and tolerations.
For more information on configuring templates, see <a href="#assembly-customizing-kubernetes-resources-str">Customizing Kubernetes resources</a>.</p>
</div>
<div class="paragraph">
<p>The <code>topicOperator</code> property contains the configuration of the Topic Operator.
When this option is missing, the Entity Operator is deployed without the Topic Operator.</p>
</div>
<div class="paragraph">
<p>The <code>userOperator</code> property contains the configuration of the User Operator.
When this option is missing, the Entity Operator is deployed without the User Operator.</p>
</div>
<div class="paragraph">
<p>For more information on the properties to configure the Entity Operator, see the <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of basic configuration enabling both operators</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an empty object (<code>{}</code>) is used for the <code>topicOperator</code> and <code>userOperator</code>, all properties use their default values.</p>
</div>
<div class="paragraph">
<p>When both <code>topicOperator</code> and <code>userOperator</code> properties are missing, the Entity Operator is not deployed.</p>
</div>
</div>
<div class="sect4">
<h5 id="topic-operator-deployment-configuration-kafka"><a class="link" href="#topic-operator-deployment-configuration-kafka">Topic Operator configuration properties</a></h5>
<div class="paragraph">
<p>Topic Operator deployment can be configured using additional options inside the <code>topicOperator</code> object.
The following properties are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the topic operator watches for <code>KafkaTopics</code>.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>90</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperSessionTimeoutSeconds</code></dt>
<dd>
<p>The ZooKeeper session timeout in seconds.
Default <code>20</code>.</p>
</dd>
<dt class="hdlist1"><code>topicMetadataMaxAttempts</code></dt>
<dd>
<p>The number of attempts at getting topic metadata from Kafka.
The time between each attempt is defined as an exponential back-off.
Consider increasing this value when topic creation could take more time due to the number of partitions or replicas.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the Topic Operator.
For more details about resource request and limit configuration, see <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources</a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the Topic Operator.
For more details, see <a href="#con-entity-operator-logging-deployment-configuration-kafka">Operator loggers</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example of Topic Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="user-operator-deployment-configuration-kafka"><a class="link" href="#user-operator-deployment-configuration-kafka">User Operator configuration properties</a></h5>
<div class="paragraph">
<p>User Operator deployment can be configured using additional options inside the <code>userOperator</code> object.
The following properties are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>watchedNamespace</code></dt>
<dd>
<p>The Kubernetes namespace in which the user operator watches for <code>KafkaUsers</code>.
Default is the namespace where the Kafka cluster is deployed.</p>
</dd>
<dt class="hdlist1"><code>reconciliationIntervalSeconds</code></dt>
<dd>
<p>The interval between periodic reconciliations in seconds.
Default <code>120</code>.</p>
</dd>
<dt class="hdlist1"><code>zookeeperSessionTimeoutSeconds</code></dt>
<dd>
<p>The ZooKeeper session timeout in seconds.
Default <code>6</code>.</p>
</dd>
<dt class="hdlist1"><code>image</code></dt>
<dd>
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>resources</code></dt>
<dd>
<p>The <code>resources</code> property configures the amount of resources allocated to the User Operator.
For more details about resource request and limit configuration, see <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources</a>.</p>
</dd>
<dt class="hdlist1"><code>logging</code></dt>
<dd>
<p>The <code>logging</code> property configures the logging of the User Operator.
For more details, see <a href="#con-entity-operator-logging-deployment-configuration-kafka">Operator loggers</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example of User Operator configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    userOperator:
      watchedNamespace: my-user-namespace
      reconciliationIntervalSeconds: 60
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-entity-operator-logging-deployment-configuration-kafka"><a class="link" href="#con-entity-operator-logging-deployment-configuration-kafka">Operator loggers</a></h5>
<div class="paragraph">
<p>The Topic Operator and User Operator have a configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rootLogger.level</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The operators use the Apache <code>log4j2</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property in the <code>Kafka</code> resource to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j2.properties</code>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
    # ...
    userOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
# ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
      logging:
        type: external
        name: customConfigMap
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information about GC logging, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</li>
<li>
<p>For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-entity-operator-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-entity-operator-deployment-configuration-kafka">Configuring the Entity Operator</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>entityOperator</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator:
      watchedNamespace: my-topic-namespace
      reconciliationIntervalSeconds: 60
    userOperator:
      watchedNamespace: my-user-namespace
      reconciliationIntervalSeconds: 60</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">2.1.11. CPU and memory resources</a></h4>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports two types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU</p>
</li>
<li>
<p>Memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying CPU and memory resources.</p>
</div>
<div class="sect4">
<h5 id="ref-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#ref-resource-limits-and-requests-deployment-configuration-kafka">Resource limits and requests</a></h5>
<div class="paragraph">
<p>Resource limits and requests are configured using the <code>resources</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.kafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="resource_requests"><a class="link" href="#resource_requests">Resource requests</a></h6>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Resources requests are specified in the <code>requests</code> property.
Resources requests currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="listingblock">
<div class="title">Example resource request configuration with all resources</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="resource_limits"><a class="link" href="#resource_limits">Resource limits</a></h6>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>Resource limits are specified in the <code>limits</code> property.
Resource limits currently supported by Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="listingblock">
<div class="title">Example resource limits configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  limits:
    cpu: 12
    memory: 64Gi
# ...</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="supported_cpu_formats"><a class="link" href="#supported_cpu_formats">Supported CPU formats</a></h6>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example CPU units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    cpu: 500m
  limits:
    cpu: 2.5
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="supported_memory_formats"><a class="link" href="#supported_memory_formats">Supported memory formats</a></h6>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">An example of using different memory units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
resources:
  requests:
    memory: 512Mi
  limits:
    memory: 2Gi
# ...</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-resource-limits-and-requests-deployment-configuration-kafka"><a class="link" href="#proc-configuring-resource-limits-and-requests-deployment-configuration-kafka">Configuring resource requests and limits</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>resources</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    resources:
      requests:
        cpu: "8"
        memory: 64Gi
      limits:
        cpu: "12"
        memory: 128Gi
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core" target="_blank" rel="noopener">ResourceRequirements API reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-logging-deployment-configuration-kafka"><a class="link" href="#con-kafka-logging-deployment-configuration-kafka">2.1.12. Kafka loggers</a></h4>
<div class="paragraph">
<p>Kafka has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j.logger.org.I0Itec.zkclient.ZkClient</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.zookeeper</code></p>
</li>
<li>
<p><code>log4j.logger.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.org.apache.kafka</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.request.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.Processor</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.server.KafkaApis</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.network.RequestChannel$</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.controller</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.log.LogCleaner</code></p>
</li>
<li>
<p><code>log4j.logger.state.change.logger</code></p>
</li>
<li>
<p><code>log4j.logger.kafka.authorizer.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ZooKeeper also has a configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zookeeper.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kafka and ZooKeeper use the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Operators use the Apache <code>log4j2</code> logger implementation, so the logging configuration is described inside the ConfigMap using <code>log4j2.properties</code>.
For more information, see <a href="#con-entity-operator-logging-deployment-configuration-kafka">Operator loggers</a>.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # ...
  kafka:
    # ...
    logging:
      type: inline
      loggers:
        kafka.root.logger.level: "INFO"
  # ...
  zookeeper:
    # ...
    logging:
      type: inline
      loggers:
        zookeeper.root.logger: "INFO"
  # ...
  entityOperator:
    # ...
    topicOperator:
      # ...
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
    # ...
    userOperator:
      # ...
      logging:
        type: inline
        loggers:
          rootLogger.level: INFO
    # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changes to both external and inline logging levels will be applied to Kafka brokers without a restart.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Garbage collector (GC) logging can also be enabled (or disabled). For more information on garbage collection, see <a href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></p>
</li>
<li>
<p>For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-rack-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-rack-deployment-configuration-kafka">2.1.13. Kafka rack awareness</a></h4>
<div class="paragraph">
<p>The rack awareness feature in Strimzi helps to spread the Kafka broker pods and Kafka topic replicas across different racks.
Enabling rack awareness helps to improve availability of Kafka brokers and the topics they are hosting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
"Rack" might represent an availability zone, data center, or an actual rack in your data center.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="proc-configuring-kafka-rack-awareness-deployment-configuration-kafka"><a class="link" href="#proc-configuring-kafka-rack-awareness-deployment-configuration-kafka">Configuring rack awareness in Kafka brokers</a></h5>
<div class="paragraph">
<p>Kafka rack awareness can be configured in the <code>rack</code> property of <code>Kafka.spec.kafka</code>.
The <code>rack</code> object has one mandatory field named <code>topologyKey</code>.
This key needs to match one of the labels assigned to the Kubernetes cluster nodes.
The label is used by Kubernetes when scheduling the Kafka broker pods to nodes.
If the Kubernetes cluster is running on a cloud provider platform, that label should represent the availability zone where the node is running.
Usually, the nodes are labeled with <code>topology.kubernetes.io/zone</code> label (or <code>failure-domain.beta.kubernetes.io/zone</code> on older Kubernetes versions) that can be used as the <code>topologyKey</code> value.
For more information about Kubernetes node labels, see <a href="https://kubernetes.io/docs/reference/kubernetes-api/labels-annotations-taints/" target="_blank" rel="noopener">Well-Known Labels, Annotations and Taints</a>.
This has the effect of spreading the broker pods across zones, and also setting the brokers' <code>broker.rack</code> configuration parameter inside Kafka broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Consult your Kubernetes administrator regarding the node label that represents the zone / rack into which the node is deployed.</p>
</li>
<li>
<p>Edit the <code>rack</code> property in the <code>Kafka</code> resource using the label as the topology key.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    rack:
      topologyKey: topology.kubernetes.io/zone
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For information about Configuring init container image for Kafka rack awareness, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-healthchecks-deployment-configuration-kafka"><a class="link" href="#assembly-healthchecks-deployment-configuration-kafka">2.1.14. Healthchecks</a></h4>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>Kubernetes supports two types of Healthcheck probes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Liveness probes</p>
</li>
<li>
<p>Readiness probes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.
Both types of probes are used in Strimzi components.</p>
</div>
<div class="paragraph">
<p>Users can configure selected options for liveness and readiness probes.</p>
</div>
<div class="sect4">
<h5 id="ref-healthchecks-deployment-configuration-kafka"><a class="link" href="#ref-healthchecks-deployment-configuration-kafka">Healthcheck configurations</a></h5>
<div class="paragraph">
<p>Liveness and readiness probes can be configured using the <code>livenessProbe</code> and <code>readinessProbe</code> properties in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.kafkaExporter</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference"><code>Probe</code> schema reference</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-healthchecks-deployment-configuration-kafka"><a class="link" href="#proc-configuring-healthchecks-deployment-configuration-kafka">Configuring healthchecks</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>livenessProbe</code> or <code>readinessProbe</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    readinessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe:
      initialDelaySeconds: 15
      timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-metrics-deployment-configuration-kafka"><a class="link" href="#assembly-metrics-deployment-configuration-kafka">2.1.15. Prometheus metrics</a></h4>
<div class="paragraph">
<p>Strimzi supports Prometheus metrics using <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a> to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.
When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>For more information about setting up and deploying Prometheus and Grafana, see <a href="./deploying.html#assembly-metrics-setup-str">Introducing Metrics to Kafka</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
<div class="sect4">
<h5 id="ref-metrics-deployment-configuration-kafka"><a class="link" href="#ref-metrics-deployment-configuration-kafka">Metrics configuration</a></h5>
<div class="paragraph">
<p>Prometheus metrics are enabled by configuring the <code>metrics</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics will be disabled.
To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics without any further configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property might contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling metrics with additional Prometheus JMX Exporter configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    metrics:
      lowercaseOutputName: true
      rules:
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
        - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*, topic=(.+)&gt;&lt;&gt;Count"
          name: "kafka_server_$1_$2_total"
          labels:
            topic: "$3"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-metrics-deployment-configuration-kafka"><a class="link" href="#proc-configuring-metrics-deployment-configuration-kafka">Configuring Prometheus metrics</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>metrics</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
    metrics:
      lowercaseOutputName: true
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jmx-options-deployment-configuration-kafka"><a class="link" href="#assembly-jmx-options-deployment-configuration-kafka">2.1.16. JMX Options</a></h4>
<div class="paragraph">
<p>Strimzi supports obtaining JMX metrics from the Kafka brokers by opening a JMX port on 9999.
You can obtain various metrics about each Kafka broker, for example, usage data such as the <code>BytesPerSecond</code> value
or the request rate of the network of the broker.
Strimzi supports opening a password and username protected JMX port or a non-protected JMX port.</p>
</div>
<div class="sect4">
<h5 id="proc-kafka-jmx-options-deployment-configuration-kafka"><a class="link" href="#proc-kafka-jmx-options-deployment-configuration-kafka">Configuring JMX options</a></h5>
<div class="paragraph">
<p>Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure JMX options by using the <code>jmxOptions</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure username and password protection for the JMX port that is opened on the Kafka brokers.</p>
</div>
<div class="paragraph">
<div class="title">Securing the JMX Port</div>
<p>You can secure the JMX port to prevent unauthorized pods from accessing the port.
Currently the JMX port can only be secured using a username and password.
To enable security for the JMX port, set the <code>type</code> parameter in the <code>authentication</code> field to <code>password</code>.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jmxOptions:
      authentication:
        type: "password"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to deploy a pod internally into a cluster and obtain JMX metrics by using the headless
service and specifying which broker you want to address.
To get JMX metrics from broker <em>0</em> we address the headless service appending broker <em>0</em> in front of the headless service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">"<em>&lt;cluster-name&gt;</em>-kafka-0-<em>&lt;cluster-name&gt;</em>-<em>&lt;headless-service-name&gt;</em>"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the JMX port is secured, you can get the username and password by referencing them from the JMX secret in the
deployment of your pod.</p>
</div>
<div class="paragraph">
<div class="title">Using an open JMX port</div>
<p>To disable security for the JMX port, do not fill in the <code>authentication</code> field</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jmxOptions: {}
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will just open the JMX Port on the headless service and you can follow a similar approach as described above
to deploy a pod into the cluster.
The only difference is that any pod will be able to read from the JMX port.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jmxtrans-deployment-configuration-kafka"><a class="link" href="#assembly-jmxtrans-deployment-configuration-kafka">2.1.17. Retrieving JMX metrics with JMXTrans</a></h4>
<div class="paragraph">
<p>JmxTrans is a way of retrieving JMX metrics data from Java processes and pushing that data in various formats to remote sinks inside or outside of the cluster.
JmxTrans can communicate with a secure JMX port.
Strimzi supports using JmxTrans to read JMX data from Kafka brokers.</p>
</div>
<div class="sect4">
<h5 id="con-jmxtrans-deployment-configuration-kafka"><a class="link" href="#con-jmxtrans-deployment-configuration-kafka">Jmxtrans</a></h5>
<div class="paragraph">
<p>JmxTrans reads JMX metrics data from secure or insecure Kafka brokers and pushes the data to remote sinks in various data formats.
An example use case of the Jmxtrans would be to obtain JMX metrics about the request rate of each Kafka broker&#8217;s network
and push it to a Logstash database outside of the Kubernetes cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-jmxtrans-deployment-deployment-configuration-kafka"><a class="link" href="#proc-jmxtrans-deployment-deployment-configuration-kafka">Configuring a JMXTrans deployment</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kubernetes cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure a JmxTrans deployment by using the <code>Kafka.spec.jmxTrans</code> property.
A JmxTrans deployment can read from a secure or insecure Kafka broker.
To configure a JmxTrans deployment, define the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.jmxTrans.outputDefinitions</code></p>
</li>
<li>
<p><code>Kafka.spec.jmxTrans.kafkaQueries</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on these properties see, <a href="#type-JmxTransSpec-reference">JmxTransSpec schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
JmxTrans will not come up enable you specify that JmxOptions on the Kafka broker.
For more information see, <a href="#assembly-jmx-options-deployment-configuration-kafka">Kafka Jmx Options</a>
.Configuring JmxTrans output definitions
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Output definitions specify where JMX metrics are pushed to, and in which data format.
For information about supported data formats, see <a href="https://github.com/jmxtrans/jmxtrans/wiki/OutputWriters" target="_blank" rel="noopener">Data formats</a>.
How many seconds JmxTrans agent waits for before pushing new data can be configured through the <code>flushDelay</code> property.
The <code>host</code> and <code>port</code> properties define the target host address and target port the data is pushed to.
The <code>name</code> property is a required property that is referenced by the <code>Kafka.spec.jmxTrans.kafkaQueries</code> property.</p>
</div>
<div class="paragraph">
<p>Here is an example configuration pushing JMX data in the Graphite format every 5 seconds to a Logstash database on http://myLogstash:9999, and another pushing to <code>standardOut</code> (standard output):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  jmxTrans:
    outputDefinitions:
      - outputType: "com.googlecode.jmxtrans.model.output.GraphiteWriter"
        host: "http://myLogstash"
        port: 9999
        flushDelay: 5
        name: "logstash"
      - outputType: "com.googlecode.jmxtrans.model.output.StdOutWriter"
        name: "standardOut"
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Configuring JmxTrans queries</div>
<p>JmxTrans queries specify what JMX metrics are read from the Kafka brokers.
Currently JmxTrans queries can only be sent to the Kafka Brokers.
Configure the <code>targetMBean</code> property to specify which target MBean on the Kafka broker is addressed.
Configuring the <code>attributes</code> property specifies which MBean attribute is read as JMX metrics from the target MBean.
JmxTrans supports wildcards to read from target MBeans, and filter by specifying the <code>typenames</code>.
The <code>outputs</code> property defines where the metrics are pushed to by specifying the name of the output definitions.</p>
</div>
<div class="paragraph">
<p>The following JmxTrans deployment reads from all MBeans that match the pattern <code>kafka.server:type=BrokerTopicMetrics,name=*</code> and have <code>name</code> in the target MBean&#8217;s name.
From those Mbeans, it obtains JMX metrics about the <code>Count</code> attribute and pushes the metrics to standard output as defined by <code>outputs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  jmxTrans:
    kafkaQueries:
      - targetMBean: "kafka.server:type=BrokerTopicMetrics,*"
        typeNames: ["name"]
        attributes:  ["Count"]
        outputs: ["standardOut"]
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="additional_resources"><a class="link" href="#additional_resources">Additional resources</a></h5>
<div class="paragraph">
<p>For more information about the Jmxtrans see <a href="https://github.com/jmxtrans/jmxtrans">Jmxtrans github</a></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-jvm-options-deployment-configuration-kafka"><a class="link" href="#assembly-jvm-options-deployment-configuration-kafka">2.1.18. JVM Options</a></h4>
<div class="paragraph">
<p>The following components of Strimzi run inside a Virtual Machine (VM):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Kafka</p>
</li>
<li>
<p>Apache ZooKeeper</p>
</li>
<li>
<p>Apache Kafka Connect</p>
</li>
<li>
<p>Apache Kafka MirrorMaker</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JVM configuration options optimize the performance for different platforms and architectures.
Strimzi allows you to configure some of these options.</p>
</div>
<div class="sect4">
<h5 id="ref-jvm-options-deployment-configuration-kafka"><a class="link" href="#ref-jvm-options-deployment-configuration-kafka">JVM configuration</a></h5>
<div class="paragraph">
<p>Use the <code>jvmOptions</code> property to <a href="#con-common-configuration-jvm-reference">configure supported options for the JVM</a> on which the component is running.</p>
</div>
<div class="paragraph">
<p>Supported JVM options help to optimize performance for different platforms and architectures.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-jvm-options-deployment-configuration-kafka"><a class="link" href="#proc-configuring-jvm-options-deployment-configuration-kafka">Configuring JVM options</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>jvmOptions</code> property in the <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    jvmOptions:
      "-Xmx": "8g"
      "-Xms": "8g"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#assembly-configuring-container-images-deployment-configuration-kafka">2.1.19. Container images</a></h4>
<div class="paragraph">
<p>Strimzi allows you to configure container images which will be used for its components.
Overriding container images is recommended only in special situations, where you need to use a different container registry.
For example, because your network does not allow access to the container repository used by Strimzi.
In such a case, you should either copy the Strimzi images or build them from the source.
If the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="sect4">
<h5 id="ref-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#ref-configuring-container-images-deployment-configuration-kafka">Container image configurations</a></h5>
<div class="paragraph">
<p>Use the <code>image</code> property to <a href="#con-common-configuration-images-reference">specify which container image to use</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Overriding container images is recommended only in special situations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-container-images-deployment-configuration-kafka"><a class="link" href="#proc-configuring-container-images-deployment-configuration-kafka">Configuring container images</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>image</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#assembly-tls-sidecar-deployment-configuration-kafka">2.1.20. TLS sidecar</a></h4>
<div class="paragraph">
<p>A sidecar is a container that runs in a pod but serves a supporting purpose.
In Strimzi, the TLS sidecar uses TLS to encrypt and decrypt all communication between the various components and ZooKeeper.</p>
</div>
<div class="paragraph">
<p>The TLS sidecar is used in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Entity Operator</p>
</li>
<li>
<p>Cruise Control</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#ref-tls-sidecar-deployment-configuration-kafka">TLS sidecar configuration</a></h5>
<div class="paragraph">
<p>The TLS sidecar can be configured using the <code>tlsSidecar</code> property in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The TLS sidecar supports the following additional options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>image</code></p>
</li>
<li>
<p><code>resources</code></p>
</li>
<li>
<p><code>logLevel</code></p>
</li>
<li>
<p><code>readinessProbe</code></p>
</li>
<li>
<p><code>livenessProbe</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>resources</code> property can be used to specify the <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">memory and CPU resources</a> allocated for the TLS sidecar.</p>
</div>
<div class="paragraph">
<p>The <code>image</code> property can be used to configure the container image which will be used.
For more details about configuring custom container images, see <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</div>
<div class="paragraph">
<p>The <code>logLevel</code> property is used to specify the logging level.
Following logging levels are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>emerg</p>
</li>
<li>
<p>alert</p>
</li>
<li>
<p>crit</p>
</li>
<li>
<p>err</p>
</li>
<li>
<p>warning</p>
</li>
<li>
<p>notice</p>
</li>
<li>
<p>info</p>
</li>
<li>
<p>debug</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default value is <em>notice</em>.</p>
</div>
<div class="paragraph">
<p>For more information about configuring the <code>readinessProbe</code> and <code>livenessProbe</code> properties for the healthchecks, see <a href="#ref-healthchecks-deployment-configuration-kafka">Healthcheck configurations</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example of TLS sidecar configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    tlsSidecar:
      image: my-org/my-image:latest
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
      logLevel: debug
      readinessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 5
      livenessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 5
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-tls-sidecar-deployment-configuration-kafka"><a class="link" href="#proc-configuring-tls-sidecar-deployment-configuration-kafka">Configuring TLS sidecar</a></h5>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>tlsSidecar</code> property in the <code>Kafka</code> resource.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    # ...
    tlsSidecar:
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
    # ...
  cruiseControl:
    # ...
    tlsSidecar:
      resources:
        requests:
          cpu: 200m
          memory: 64Mi
        limits:
          cpu: 500m
          memory: 128Mi
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-scheduling-deployment-configuration-kafka"><a class="link" href="#assembly-scheduling-deployment-configuration-kafka">2.1.21. Configuring pod scheduling</a></h4>
<div id="con-scheduling-deployment-configuration-kafka" class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When two applications are scheduled to the same Kubernetes node, both applications might use the same resources like disk I/O and impact performance.
That can lead to performance degradation.
Scheduling Kafka pods in a way that avoids sharing nodes with other critical workloads, using the right nodes or dedicated a set of nodes only for Kafka are the best ways how to avoid such problems.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#assembly-scheduling-pods-based-on-other-applications-deployment-configuration-kafka-scheduling-based-on-pods">Scheduling pods based on other applications</a></h5>
<div class="sect5">
<h6 id="con-scheduling-based-on-other-pods-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#con-scheduling-based-on-other-pods-deployment-configuration-kafka-scheduling-based-on-pods">Avoid critical applications to share the node</a></h6>
<div class="paragraph">
<p>Pod anti-affinity can be used to ensure that critical applications are never scheduled on the same disk.
When running Kafka cluster, it is recommended to use pod anti-affinity to ensure that the Kafka brokers do not share the nodes with other workloads like databases.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#affinity-deployment-configuration-kafka-scheduling-based-on-pods">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-scheduling-based-on-pods"><a class="link" href="#configuring-pod-anti-affinity-in-kafka-components-deployment-configuration-kafka-scheduling-based-on-pods">Configuring pod anti-affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
Use labels to specify the pods which should not be scheduled on the same nodes.
The <code>topologyKey</code> should be set to <code>kubernetes.io/hostname</code> to specify that the selected pods should not be scheduled on nodes with the same hostname.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          podAntiAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              - labelSelector:
                  matchExpressions:
                    - key: application
                      operator: In
                      values:
                        - postgresql
                        - mongodb
                topologyKey: "kubernetes.io/hostname"
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-node-scheduling-deployment-configuration-kafka-node-scheduling"><a class="link" href="#assembly-node-scheduling-deployment-configuration-kafka-node-scheduling">Scheduling pods to specific nodes</a></h5>
<div class="sect5">
<h6 id="con-scheduling-to-specific-nodes-deployment-configuration-kafka-node-scheduling"><a class="link" href="#con-scheduling-to-specific-nodes-deployment-configuration-kafka-node-scheduling">Node scheduling</a></h6>
<div class="paragraph">
<p>The Kubernetes cluster usually consists of many different types of worker nodes.
Some are optimized for CPU heavy workloads, some for memory, while other might be optimized for storage (fast local SSDs) or network.
Using different nodes helps to optimize both costs and performance.
To achieve the best possible performance, it is important to allow scheduling of Strimzi components to use the right nodes.</p>
</div>
<div class="paragraph">
<p>Kubernetes uses node affinity to schedule workloads onto specific nodes.
Node affinity allows you to create a scheduling constraint for the node on which the pod will be scheduled.
The constraint is specified as a label selector.
You can specify the label using either the built-in node label like <code>beta.kubernetes.io/instance-type</code> or custom labels to select the right node.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-node-scheduling"><a class="link" href="#affinity-deployment-configuration-kafka-node-scheduling">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-configuring-node-affinity-deployment-configuration-kafka-node-scheduling"><a class="link" href="#proc-configuring-node-affinity-deployment-configuration-kafka-node-scheduling">Configuring node affinity in Kafka components</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Label the nodes where Strimzi components should be scheduled.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> node-type=fast-network</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, some of the existing labels might be reused.</p>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> property in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
                - matchExpressions:
                  - key: node-type
                    operator: In
                    values:
                    - fast-network
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="assembly-dedidcated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#assembly-dedidcated-nodes-deployment-configuration-kafka-dedicated-nodes">Using dedicated nodes</a></h5>
<div class="sect5">
<h6 id="con-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#con-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes">Dedicated nodes</a></h6>
<div class="paragraph">
<p>Cluster administrators can mark selected Kubernetes nodes as tainted.
Nodes with taints are excluded from regular scheduling and normal pods will not be scheduled to run on them.
Only services which can tolerate the taint set on the node can be scheduled on it.
The only other services running on such nodes will be system services such as log collectors or software defined networks.</p>
</div>
<div class="paragraph">
<p>Taints can be used to create dedicated nodes.
Running Kafka and its components on dedicated nodes can have many advantages.
There will be no other applications running on the same nodes which could cause disturbance or consume the resources needed for Kafka.
That can lead to improved performance and stability.</p>
</div>
<div class="paragraph">
<p>To schedule Kafka pods on the dedicated nodes, configure <a href="#affinity-deployment-configuration-kafka-dedicated-nodes">node affinity</a> and <a href="#tolerations-deployment-configuration-kafka-dedicated-nodes">tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="affinity-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#affinity-deployment-configuration-kafka-dedicated-nodes">Affinity</a></h6>
<div class="paragraph">
<p>Affinity can be configured using the <code>affinity</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The affinity configuration can include different types of affinity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pod affinity and anti-affinity</p>
</li>
<li>
<p>Node affinity</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>affinity</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/" target="_blank" rel="noopener">Kubernetes node and pod affinity documentation</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="tolerations-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#tolerations-deployment-configuration-kafka-dedicated-nodes">Tolerations</a></h6>
<div class="paragraph">
<p>Tolerations can be configured using the <code>tolerations</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper.template.pod</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnect.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec.template.pod</code></p>
</li>
<li>
<p><code>KafkaBridge.spec.template.pod</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The format of the <code>tolerations</code> property follows the Kubernetes specification.
For more details, see the <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/" target="_blank" rel="noopener">Kubernetes taints and tolerations</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="proc-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes"><a class="link" href="#proc-dedicated-nodes-deployment-configuration-kafka-dedicated-nodes">Setting up dedicated nodes and scheduling pods on them</a></h6>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the nodes which should be used as dedicated.</p>
</li>
<li>
<p>Make sure there are no workloads scheduled on these nodes.</p>
</li>
<li>
<p>Set the taints on the selected nodes:</p>
<div class="paragraph">
<p>This can be done using <code>kubectl taint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl taint node <em>your-node</em> dedicated=Kafka:NoSchedule</code></pre>
</div>
</div>
</li>
<li>
<p>Additionally, add a label to the selected nodes as well.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl label</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label node <em>your-node</em> dedicated=Kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>affinity</code> and <code>tolerations</code> properties in the resource specifying the cluster deployment.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    template:
      pod:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "Kafka"
            effect: "NoSchedule"
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: dedicated
                  operator: In
                  values:
                  - Kafka
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="assembly-kafka-exporter-configuration-deployment-configuration-kafka"><a class="link" href="#assembly-kafka-exporter-configuration-deployment-configuration-kafka">2.1.22. Kafka Exporter</a></h4>
<div class="paragraph">
<p>You can configure the <code>Kafka</code> resource to automatically deploy Kafka Exporter in your cluster.</p>
</div>
<div class="paragraph">
<p>Kafka Exporter extracts data for analysis as Prometheus metrics, primarily data relating to offsets, consumer groups, consumer lag and topics.</p>
</div>
<div class="paragraph">
<p>For information on setting up Kafka Exporter and why it is important to monitor consumer lag for performance, see <a href="./deploying.html#assembly-metrics-kafka-exporter-str">Kafka Exporter</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-rolling-update-kafka-deployment-configuration-kafka"><a class="link" href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">2.1.23. Performing a rolling update of a Kafka cluster</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a rolling update of an existing Kafka cluster by using a Kubernetes annotation.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>StatefulSet</code> that controls the Kafka pods you want to manually update.</p>
<div class="paragraph">
<p>For example, if your Kafka cluster is named <em>my-cluster</em>, the corresponding <code>StatefulSet</code> is named <em>my-cluster-kafka</em>.</p>
</div>
</li>
<li>
<p>Annotate the <code>StatefulSet</code> resource in Kubernetes. For example, using <code>kubectl annotate</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate statefulset <em>cluster-name</em>-kafka strimzi.io/manual-rolling-update=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).
A rolling update of all pods within the annotated <code>StatefulSet</code> is triggered, as long as the annotation was detected by the reconciliation process.
When the rolling update of all the pods is complete, the annotation is removed from the <code>StatefulSet</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-rolling-update-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">2.1.24. Performing a rolling update of a ZooKeeper cluster</a></h4>
<div class="paragraph">
<p>This procedure describes how to manually trigger a rolling update of an existing ZooKeeper cluster by using a Kubernetes annotation.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>StatefulSet</code> that controls the ZooKeeper pods you want to manually update.</p>
<div class="paragraph">
<p>For example, if your Kafka cluster is named <em>my-cluster</em>, the corresponding <code>StatefulSet</code> is named <em>my-cluster-zookeeper</em>.</p>
</div>
</li>
<li>
<p>Annotate the <code>StatefulSet</code> resource in Kubernetes. For example, using <code>kubectl annotate</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate statefulset <em>cluster-name</em>-zookeeper strimzi.io/manual-rolling-update=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation to occur (every two minutes by default).
A rolling update of all pods within the annotated <code>StatefulSet</code> is triggered, as long as the annotation was detected by the reconciliation process.
When the rolling update of all the pods is complete, the annotation is removed from the <code>StatefulSet</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="scaling-clusters-deployment-configuration-kafka"><a class="link" href="#scaling-clusters-deployment-configuration-kafka">2.1.25. Scaling clusters</a></h4>
<div class="sect4">
<h5 id="con-scaling-kafka-clusters-deployment-configuration-kafka"><a class="link" href="#con-scaling-kafka-clusters-deployment-configuration-kafka">Scaling Kafka clusters</a></h5>
<div class="sect5">
<h6 id="adding_brokers_to_a_cluster"><a class="link" href="#adding_brokers_to_a_cluster">Adding brokers to a cluster</a></h6>
<div class="paragraph">
<p>The primary way of increasing throughput for a topic is to increase the number of partitions for that topic.
That works because the extra partitions allow the load of the topic to be shared between the different brokers in the cluster.
However, in situations where every broker is constrained by a particular resource (typically I/O) using more partitions will not result in increased throughput.
Instead, you need to add brokers to the cluster.</p>
</div>
<div class="paragraph">
<p>When you add an extra broker to the cluster, Kafka does not assign any partitions to it automatically.
You must decide which partitions to move from the existing brokers to the new broker.</p>
</div>
<div class="paragraph">
<p>Once the partitions have been redistributed between all the brokers, the resource utilization of each broker should be reduced.</p>
</div>
</div>
<div class="sect5">
<h6 id="removing_brokers_from_a_cluster"><a class="link" href="#removing_brokers_from_a_cluster">Removing brokers from a cluster</a></h6>
<div class="paragraph">
<p>Because Strimzi uses <code>StatefulSets</code> to manage broker pods, you cannot remove <em>any</em> pod from the cluster.
You can only remove one or more of the highest numbered pods from the cluster.
For example, in a cluster of 12 brokers the pods are named <code><em>cluster-name</em>-kafka-0</code> up to <code><em>cluster-name</em>-kafka-11</code>.
If you decide to scale down by one broker, the <code><em>cluster-name</em>-kafka-11</code> will be removed.</p>
</div>
<div class="paragraph">
<p>Before you remove a broker from a cluster, ensure that it is not assigned to any partitions.
You should also decide which of the remaining brokers will be responsible for each of the partitions on the broker being decommissioned.
Once the broker has no assigned partitions, you can scale the cluster down safely.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-partition-reassignment-deployment-configuration-kafka"><a class="link" href="#con-partition-reassignment-deployment-configuration-kafka">Partition reassignment</a></h5>
<div class="paragraph">
<p>The Topic Operator does not currently support reassigning replicas to different brokers, so it is necessary to connect directly to broker pods to reassign replicas to brokers.</p>
</div>
<div class="paragraph">
<p>Within a broker pod, the <code>kafka-reassign-partitions.sh</code> utility allows you to reassign partitions to different brokers.</p>
</div>
<div class="paragraph">
<p>It has three different modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--generate</code></dt>
<dd>
<p>Takes a set of topics and brokers and generates a <em>reassignment JSON file</em> which will result in the partitions of those topics being assigned to those brokers.
Because this operates on whole topics, it cannot be used when you just need to reassign some of the partitions of some topics.</p>
</dd>
<dt class="hdlist1"><code>--execute</code></dt>
<dd>
<p>Takes a <em>reassignment JSON file</em> and applies it to the partitions and brokers in the cluster.
Brokers that gain partitions as a result become followers of the partition leader.
For a given partition, once the new broker has caught up and joined the ISR (in-sync replicas) the old broker will stop being a follower and will delete its replica.</p>
</dd>
<dt class="hdlist1"><code>--verify</code></dt>
<dd>
<p>Using the same <em>reassignment JSON file</em> as the <code>--execute</code> step, <code>--verify</code> checks whether all of the partitions in the file have been moved to their intended brokers.
If the reassignment is complete, --verify also removes any <a href="#con-reassignment-throttles-deployment-configuration-kafka">throttles</a> that are in effect.
Unless removed, throttles will continue to affect the cluster even after the reassignment has finished.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It is only possible to have one reassignment running in a cluster at any given time, and it is not possible to cancel a running reassignment.
If you need to cancel a reassignment, wait for it to complete and then perform another reassignment to revert the effects of the first reassignment.
The <code>kafka-reassign-partitions.sh</code> will print the reassignment JSON for this reversion as part of its output.
Very large reassignments should be broken down into a number of smaller reassignments in case there is a need to stop in-progress reassignment.</p>
</div>
<div class="sect5">
<h6 id="reassignment_json_file"><a class="link" href="#reassignment_json_file">Reassignment JSON file</a></h6>
<div class="paragraph">
<p>The <em>reassignment JSON file</em> has a specific structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "version": 1,
  "partitions": [
    <em>&lt;PartitionObjects&gt;</em>
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>&lt;PartitionObjects&gt;</em> is a comma-separated list of objects like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Although Kafka also supports a <code>"log_dirs"</code> property this should not be used in Strimzi.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example reassignment JSON file that assigns topic <code>topic-a</code>, partition <code>4</code> to brokers <code>2</code>, <code>4</code> and <code>7</code>, and topic <code>topic-b</code> partition <code>2</code> to brokers <code>1</code>, <code>5</code> and <code>7</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "version": 1,
  "partitions": [
    {
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7]
    },
    {
      "topic": "topic-b",
      "partition": 2,
      "replicas": [1,5,7]
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Partitions not included in the JSON are not changed.</p>
</div>
</div>
<div class="sect5">
<h6 id="reassigning_partitions_between_jbod_volumes"><a class="link" href="#reassigning_partitions_between_jbod_volumes">Reassigning partitions between JBOD volumes</a></h6>
<div class="paragraph">
<p>When using JBOD storage in your Kafka cluster, you can choose to reassign the partitions between specific volumes and their log directories (each volume has a single log directory).
To reassign a partition to a specific volume, add the <code>log_dirs</code> option to <em>&lt;PartitionObjects&gt;</em> in the reassignment JSON file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>,
  "partition": <em>&lt;Partition&gt;</em>,
  "replicas": [ <em>&lt;AssignedBrokerIds&gt;</em> ],
  "log_dirs": [ <em>&lt;AssignedLogDirs&gt;</em> ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>log_dirs</code> object should contain the same number of log directories as the number of replicas specified in the <code>replicas</code> object.
The value should be either an absolute path to the log directory, or the <code>any</code> keyword.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
      "topic": "topic-a",
      "partition": 4,
      "replicas": [2,4,7].
      "log_dirs": [ "/var/lib/kafka/data-0/kafka-log2", "/var/lib/kafka/data-0/kafka-log4", "/var/lib/kafka/data-0/kafka-log7" ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="proc-generating-reassignment-json-files-deployment-configuration-kafka"><a class="link" href="#proc-generating-reassignment-json-files-deployment-configuration-kafka">Generating reassignment JSON files</a></h5>
<div class="paragraph">
<p>This procedure describes how to generate a reassignment JSON file that reassigns all the partitions for a given set of topics using the <code>kafka-reassign-partitions.sh</code> tool.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Cluster Operator</p>
</li>
<li>
<p>A <code>Kafka</code> resource</p>
</li>
<li>
<p>A set of topics to reassign the partitions of</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a JSON file named <code><em>topics.json</em></code> that lists the topics to move.
It must have the following structure:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "version": 1,
  "topics": [
    <em>&lt;TopicObjects&gt;</em>
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>&lt;TopicObjects&gt;</em> is a comma-separated list of objects like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">{
  "topic": <em>&lt;TopicName&gt;</em>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example if you want to reassign all the partitions of <code>topic-a</code> and <code>topic-b</code>, you would need to prepare a <code><em>topics.json</em></code> file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "version": 1,
  "topics": [
    { "topic": "topic-a"},
    { "topic": "topic-b"}
  ]
}</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code><em>topics.json</em></code> file to one of the broker pods:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">cat <em>topics.json</em> | kubectl exec -c kafka <em>&lt;BrokerPod&gt;</em> -i -- \
  /bin/bash -c \
  'cat &gt; /tmp/topics.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>kafka-reassign-partitions.sh</code> command to generate the reassignment JSON.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">kubectl exec <em>&lt;BrokerPod&gt;</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --topics-to-move-json-file /tmp/topics.json \
  --broker-list <em>&lt;BrokerList&gt;</em> \
  --generate</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to move all the partitions of <code>topic-a</code> and <code>topic-b</code> to brokers <code>4</code> and <code>7</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>&lt;BrokerPod&gt;</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --topics-to-move-json-file /tmp/topics.json \
  --broker-list 4,7 \
  --generate</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="creating_reassignment_json_files_manually"><a class="link" href="#creating_reassignment_json_files_manually">Creating reassignment JSON files manually</a></h5>
<div class="paragraph">
<p>You can manually create the reassignment JSON file if you want to move specific partitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-reassignment-throttles-deployment-configuration-kafka"><a class="link" href="#con-reassignment-throttles-deployment-configuration-kafka">Reassignment throttles</a></h5>
<div class="paragraph">
<p>Partition reassignment can be a slow process because it involves transferring large amounts of data between brokers.
To avoid a detrimental impact on clients, you can throttle the reassignment process.
This might cause the reassignment to take longer to complete.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the throttle is too low then the newly assigned brokers will not be able to keep up with records being published and the reassignment will never complete.</p>
</li>
<li>
<p>If the throttle is too high then clients will be impacted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, for producers, this could manifest as higher than normal latency waiting for acknowledgement. For consumers, this could manifest as a drop in throughput caused by higher latency between polls.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-up-a-kafka-cluster-deployment-configuration-kafka"><a class="link" href="#proc-scaling-up-a-kafka-cluster-deployment-configuration-kafka">Scaling up a Kafka cluster</a></h5>
<div class="paragraph">
<p>This procedure describes how to increase the number of brokers in a Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster.</p>
</li>
<li>
<p>A <em>reassignment JSON file</em> named <code><em>reassignment.json</em></code> that describes how partitions should be reassigned to brokers in the enlarged cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add as many new brokers as you need by increasing the <code>Kafka.spec.kafka.replicas</code> configuration option.</p>
</li>
<li>
<p>Verify that the new broker pods have started.</p>
</li>
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the broker pod on which you will later execute the commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec <em>broker-pod</em> -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec my-cluster-kafka-0 -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the partition reassignment using the <code>kafka-reassign-partitions.sh</code> command line tool from the same broker pod.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are going to throttle replication you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
</li>
<li>
<p>If you need to change the throttle during reassignment you can use the same command line with a different throttled rate. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Periodically verify whether the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods. This is the same command as the previous step but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
</li>
<li>
<p>The reassignment has finished when the <code>--verify</code> command reports each of  the partitions being moved as completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.
You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="proc-scaling-down-a-kafka-cluster-deployment-configuration-kafka"><a class="link" href="#proc-scaling-down-a-kafka-cluster-deployment-configuration-kafka">Scaling down a Kafka cluster</a></h5>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>This procedure describes how to decrease the number of brokers in a Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An existing Kafka cluster.</p>
</li>
<li>
<p>A <em>reassignment JSON file</em> named <code><em>reassignment.json</em></code> describing how partitions should be reassigned to brokers in the cluster once the broker(s) in the highest numbered <code>Pod(s)</code> have been removed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the <code><em>reassignment.json</em></code> file to the broker pod on which you will later execute the commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec <em>broker-pod</em> -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cat <em>reassignment.json</em> | \
  kubectl exec my-cluster-kafka-0 -c kafka -i -- /bin/bash -c \
  'cat &gt; /tmp/reassignment.json'</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the partition reassignment using the <code>kafka-reassign-partitions.sh</code> command line tool from the same broker pod.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are going to throttle replication you can also pass the <code>--throttle</code> option with an inter-broker throttled rate in bytes per second. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 5000000 \
  --execute</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will print out two reassignment JSON objects.
The first records the current assignment for the partitions being moved.
You should save this to a local file (not a file in the pod) in case you need to revert the reassignment later on.
The second JSON object is the target reassignment you have passed in your reassignment JSON file.</p>
</div>
</li>
<li>
<p>If you need to change the throttle during reassignment you can use the same command line with a different throttled rate. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --throttle 10000000 \
  --execute</code></pre>
</div>
</div>
</li>
<li>
<p>Periodically verify whether the reassignment has completed using the <code>kafka-reassign-partitions.sh</code> command line tool from any of the broker pods. This is the same command as the previous step but with the <code>--verify</code> option instead of the <code>--execute</code> option.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec <em>broker-pod</em> -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  bin/kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file /tmp/reassignment.json \
  --verify</code></pre>
</div>
</div>
</li>
<li>
<p>The reassignment has finished when the <code>--verify</code> command reports each of  the partitions being moved as completed successfully.
This final <code>--verify</code> will also have the effect of removing any reassignment throttles.
You can now delete the revert file if you saved the JSON for reverting the assignment to their original brokers.</p>
</li>
<li>
<p>Once all the partition reassignments have finished, the broker(s) being removed should not have responsibility for any of the partitions in the cluster.
You can verify this by checking that the broker&#8217;s data log directory does not contain any live partition logs.
If the log directory on the broker contains a directory that does not match the extended regular expression <code>[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$</code> then the broker still has live partitions and it should not be stopped.</p>
<div class="paragraph">
<p>You can check this by executing the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec my-cluster-kafka-0 -c kafka -it -- \
  /bin/bash -c \
  "ls -l /var/lib/kafka/kafka-log_&lt;N&gt;_ | grep -E '^d' | grep -vE '[a-zA-Z0-9.-]+\.[a-z0-9]+-delete$'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <em>N</em> is the number of the <code>Pod(s)</code> being deleted.</p>
</div>
<div class="paragraph">
<p>If the above command prints any output then the broker still has live partitions.
In this case, either the reassignment has not finished, or the reassignment JSON file was incorrect.</p>
</div>
</li>
<li>
<p>Once you have confirmed that the broker has no live partitions you can edit the <code>Kafka.spec.kafka.replicas</code> of your <code>Kafka</code> resource, which will scale down the <code>StatefulSet</code>, deleting the highest numbered broker <code>Pod(s)</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka"><a class="link" href="#proc-manual-delete-pod-pvc-kafka-deployment-configuration-kafka">2.1.26. Deleting Kafka nodes manually</a></h4>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>This procedure describes how to delete an existing Kafka node by using a Kubernetes annotation.
Deleting a Kafka node consists of deleting both the <code>Pod</code> on which the Kafka broker is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>For example, if the cluster is named <em>cluster-name</em>, the pods are named <em>cluster-name</em>-kafka-<em>index</em>, where <em>index</em> starts at zero and ends at the total number of replicas.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate pod <em>cluster-name</em>-kafka-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka"><a class="link" href="#proc-manual-delete-pod-pvc-zookeeper-deployment-configuration-kafka">2.1.27. Deleting ZooKeeper nodes manually</a></h4>
<div class="paragraph">
<p>This procedure describes how to delete an existing ZooKeeper node by using a Kubernetes annotation.
Deleting a ZooKeeper node consists of deleting both the <code>Pod</code> on which ZooKeeper is running and the related <code>PersistentVolumeClaim</code> (if the cluster was deployed with persistent storage).
After deletion, the <code>Pod</code> and its related <code>PersistentVolumeClaim</code> are recreated automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting a <code>PersistentVolumeClaim</code> can cause permanent data loss. The following procedure should only be performed if you have encountered storage issues.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Find the name of the <code>Pod</code> that you want to delete.</p>
<div class="paragraph">
<p>For example, if the cluster is named <em>cluster-name</em>, the pods are named <em>cluster-name</em>-zookeeper-<em>index</em>, where <em>index</em> starts at zero and ends at the total number of replicas.</p>
</div>
</li>
<li>
<p>Annotate the <code>Pod</code> resource in Kubernetes.</p>
<div class="paragraph">
<p>Use <code>kubectl annotate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate pod <em>cluster-name</em>-zookeeper-<em>index</em> strimzi.io/delete-pod-and-pvc=true</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for the next reconciliation, when the annotated pod with the underlying persistent volume claim will be deleted and then recreated.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="assembly-maintenance-time-windows-deployment-configuration-kafka"><a class="link" href="#assembly-maintenance-time-windows-deployment-configuration-kafka">2.1.28. Maintenance time windows for rolling updates</a></h4>
<div class="paragraph">
<p>Maintenance time windows allow you to schedule certain rolling updates of your Kafka and ZooKeeper clusters to start at a convenient time.</p>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-windows-overview-deployment-configuration-kafka"><a class="link" href="#con-maintenance-time-windows-overview-deployment-configuration-kafka">Maintenance time windows overview</a></h5>
<div class="paragraph">
<p>In most cases, the Cluster Operator only updates your Kafka or ZooKeeper clusters in response to changes to the corresponding <code>Kafka</code> resource.
This enables you to plan when to apply changes to a <code>Kafka</code> resource to minimize the impact on Kafka client applications.</p>
</div>
<div class="paragraph">
<p>However, some updates to your Kafka and ZooKeeper clusters can happen without any corresponding change to the <code>Kafka</code> resource.
For example, the Cluster Operator will need to perform a rolling restart if a CA (Certificate Authority) certificate that it manages is close to expiry.</p>
</div>
<div class="paragraph">
<p>While a rolling restart of the pods should not affect <em>availability</em> of the service (assuming correct broker and topic configurations), it could affect <em>performance</em> of the Kafka client applications.
Maintenance time windows allow you to schedule such spontaneous rolling updates of your Kafka and ZooKeeper clusters to start at a convenient time.
If maintenance time windows are not configured for a cluster then it is possible that such spontaneous rolling updates will happen at an inconvenient time, such as during a predictable period of high load.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-maintenance-time-window-definition-deployment-configuration-kafka"><a class="link" href="#con-maintenance-time-window-definition-deployment-configuration-kafka">Maintenance time window definition</a></h5>
<div class="paragraph">
<p>You configure maintenance time windows by entering an array of strings in the <code>Kafka.spec.maintenanceTimeWindows</code> property.
Each string is a <a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html" target="_blank" rel="noopener">cron expression</a> interpreted as being in UTC (Coordinated Universal Time, which for practical purposes is the same as Greenwich Mean Time).</p>
</div>
<div class="paragraph">
<p>The following example configures a single maintenance time window that starts at midnight and ends at 01:59am (UTC), on Sundays, Mondays, Tuesdays, Wednesdays, and Thursdays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
maintenanceTimeWindows:
  - "* * 0-1 ? * SUN,MON,TUE,WED,THU *"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, maintenance windows should be set in conjunction with the <code>Kafka.spec.clusterCa.renewalDays</code> and <code>Kafka.spec.clientsCa.renewalDays</code> properties of the <code>Kafka</code> resource, to ensure that the necessary CA certificate renewal can be completed in the configured maintenance time windows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strimzi does not schedule maintenance operations exactly according to the given windows. Instead, for each reconciliation, it checks whether a maintenance window is currently "open".
This means that the start of maintenance operations within a given time window can be delayed by up to the Cluster Operator reconciliation interval.
Maintenance time windows must therefore be at least this long.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the Cluster Operator configuration, see <a href="#ref-operator-cluster-str">Cluster Operator configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-configuring-maintenance-time-windows-deployment-configuration-kafka"><a class="link" href="#proc-configuring-maintenance-time-windows-deployment-configuration-kafka">Configuring a maintenance time window</a></h5>
<div class="paragraph">
<p>You can configure a maintenance time window for rolling updates triggered by supported processes.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add or edit the <code>maintenanceTimeWindows</code> property in the <code>Kafka</code> resource.
For example to allow maintenance between 0800 and 1059 and between 1400 and 1559 you would set the <code>maintenanceTimeWindows</code> as shown below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  maintenanceTimeWindows:
    - "* * 8-10 * * ?"
    - "* * 14-15 * * ?"</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>This can be done using <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>Performing a rolling update of a Kafka cluster, see <a href="#proc-manual-rolling-update-kafka-deployment-configuration-kafka">Performing a rolling update of a Kafka cluster</a></p>
</li>
<li>
<p>Performing a rolling update of a ZooKeeper cluster, see <a href="#proc-manual-rolling-update-zookeeper-deployment-configuration-kafka">Performing a rolling update of a ZooKeeper cluster</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-renewing-ca-certs-manually-deployment-configuration-kafka"><a class="link" href="#proc-renewing-ca-certs-manually-deployment-configuration-kafka">2.1.29. Renewing CA certificates manually</a></h4>
<div class="paragraph">
<p>Cluster and clients CA certificates auto-renew at the start of their respective certificate renewal periods.
If <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> and <code>Kafka.spec.clientsCa.generateCertificateAuthority</code> are set to <code>false</code>,
the CA certificates do not auto-renew.</p>
</div>
<div class="paragraph">
<p>You can manually renew one or both of these certificates before the certificate renewal period starts.
You might do this for security reasons, or if you have <a href="#con-certificate-renewal-str">changed the renewal or validity periods for the certificates</a>.</p>
</div>
<div class="paragraph">
<p>A renewed certificate uses the same private key as the old certificate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>strimzi.io/force-renew</code> annotation to the <code>Secret</code> that contains the CA certificate that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 1. Annotation for the Secret that forces renewal of certificates</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will generate a new CA certificate for the <code>Secret</code> that you annotated.
If maintenance time windows are configured, the Cluster Operator will generate the new CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
</li>
<li>
<p>Check the period the CA certificate is valid:</p>
<div class="paragraph">
<p>For example, using an <code>openssl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>CA-CERTIFICATE-SECRET</em> -o 'jsonpath={.data.<em>CA-CERTIFICATE</em>}' | base64 -d | openssl x509 -subject -issuer -startdate -enddate -noout</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE</em> is the name of the CA certificate, such as <code>jsonpath={.data.ca\.crt}</code>.</p>
</div>
<div class="paragraph">
<p>The command returns a <code>notBefore</code> and <code>notAfter</code> date, which is the validity period for the CA certificate.</p>
</div>
<div class="paragraph">
<p>For example, for a cluster CA certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">subject=O = io.strimzi, CN = cluster-ca v0
issuer=O = io.strimzi, CN = cluster-ca v0
notBefore=Jun 30 09:43:54 2020 GMT
notAfter=Jun 30 09:43:54 2021 GMT</code></pre>
</div>
</div>
</li>
<li>
<p>Delete old certificates from the Secret.</p>
<div class="paragraph">
<p>When components are using the new certificates, older certificates might still be active.
Delete the old certificates to remove any potential security risk.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-replacing-private-keys-deployment-configuration-kafka"><a class="link" href="#proc-replacing-private-keys-deployment-configuration-kafka">2.1.30. Replacing private keys</a></h4>
<div class="paragraph">
<p>You can replace the private keys used by the cluster CA and clients CA certificates.
When a private key is replaced, the Cluster Operator generates a new CA certificate for the new private key.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-replace</code> annotation to the <code>Secret</code> that contains the private key that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 2. Commands for replacing private keys</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Private key for</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca strimzi.io/force-replace=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca strimzi.io/force-replace=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new private key for the <code>Secret</code> that you annotated</p>
</li>
<li>
<p>Generate a new CA certificate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will generate the new private key and CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-cluster-resources-deployment-configuration-kafka"><a class="link" href="#ref-list-of-kafka-cluster-resources-deployment-configuration-kafka">2.1.31. List of resources created as part of Kafka cluster</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<div class="title">Shared resources</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca</code></dt>
<dd>
<p>Secret with the Cluster CA used to encrypt the cluster communication.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-ca-cert</code></dt>
<dd>
<p>Secret with the Cluster CA public key. This key can be used to verify the identity of the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca</code></dt>
<dd>
<p>Secret with the Clients CA private key used to sign user certiticates</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-clients-ca-cert</code></dt>
<dd>
<p>Secret with the Clients CA public key. This key can be used to verify the identity of the Kafka users.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cluster-operator-certs</code></dt>
<dd>
<p>Secret with Cluster operators keys for communication with Kafka and ZooKeeper.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Zookeeper nodes</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>StatefulSet which is in charge of managing the ZooKeeper node pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Pods created by the Zookeeper StatefulSet.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Headless Service needed to have DNS resolve the ZooKeeper pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-client</code></dt>
<dd>
<p>Service used by Kafka brokers to connect to ZooKeeper nodes as clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-config</code></dt>
<dd>
<p>ConfigMap that contains the ZooKeeper ancillary configuration, and is mounted as a volume by the ZooKeeper node pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper-nodes</code></dt>
<dd>
<p>Secret with ZooKeeper node keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>Service account used by the Zookeeper nodes.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-zookeeper</code></dt>
<dd>
<p>Pod Disruption Budget configured for the ZooKeeper nodes.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-zookeeper</code></dt>
<dd>
<p>Network policy managing access to the ZooKeeper services.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-zookeeper-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the ZooKeeper node pod <code><em>idx</em></code>. This resource will be created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
</dl>
</div>
<div class="dlist">
<div class="title">Kafka brokers</div>
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>StatefulSet which is in charge of managing the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Pods created by the Kafka StatefulSet.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Service needed to have DNS resolve the Kafka broker pods IP addresses directly.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-bootstrap</code></dt>
<dd>
<p>Service can be used as bootstrap servers for Kafka clients.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap service for clients connecting from outside of the Kubernetes cluster. This resource will be created only when external listener is enabled.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Service used to route traffic from outside of the Kubernetes cluster to individual pods. This resource will be created only when external listener is enabled.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-external-bootstrap</code></dt>
<dd>
<p>Bootstrap route for clients connecting from outside of the Kubernetes cluster. This resource will be created only when external listener is enabled and set to type <code>route</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-<em>pod-id</em></code></dt>
<dd>
<p>Route for traffic from outside of the Kubernetes cluster to individual pods. This resource will be created only when external listener is enabled and set to type <code>route</code>.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-config</code></dt>
<dd>
<p>ConfigMap which contains the Kafka ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-brokers</code></dt>
<dd>
<p>Secret with Kafka broker keys.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>Service account used by the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka</code></dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-kafka</code></dt>
<dd>
<p>Network policy managing access to the Kafka services.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>namespace-name</em>-<em>cluster-name</em>-kafka-init</code></dt>
<dd>
<p>Cluster role binding used by the Kafka brokers.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmx</code></dt>
<dd>
<p>Secret with JMX username and password used to secure the Kafka broker port. This resource will be created only when JMX is enabled in Kafka.</p>
</dd>
<dt class="hdlist1"><code>data-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource will be created only if persistent storage is selected for provisioning persistent volumes to store data.</p>
</dd>
<dt class="hdlist1"><code>data-<em>id</em>-<em>cluster-name</em>-kafka-<em>idx</em></code></dt>
<dd>
<p>Persistent Volume Claim for the volume <code><em>id</em></code> used for storing data for the Kafka broker pod <code><em>idx</em></code>. This resource is only created if persistent storage is selected for JBOD volumes when provisioning persistent volumes to store data.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Entity Operator</div>
<p>These resources are only created if the Entity Operator is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator</code></dt>
<dd>
<p>Deployment with Topic and User Operators.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Entity Operator deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-topic-operator-config</code></dt>
<dd>
<p>ConfigMap with ancillary configuration for Topic Operators.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-user-operator-config</code></dt>
<dd>
<p>ConfigMap with ancillary configuration for User Operators.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator-certs</code></dt>
<dd>
<p>Secret with Entity Operator keys for communication with Kafka and ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-entity-operator</code></dt>
<dd>
<p>Service account used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-topic-operator</code></dt>
<dd>
<p>Role binding used by the Entity Operator.</p>
</dd>
<dt class="hdlist1"><code>strimzi-<em>cluster-name</em>-user-operator</code></dt>
<dd>
<p>Role binding used by the Entity Operator.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Kafka Exporter</div>
<p>These resources are only created if the Kafka Exporter is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter</code></dt>
<dd>
<p>Deployment with Kafka Exporter.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Kafka Exporter deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter</code></dt>
<dd>
<p>Service used to collect consumer lag metrics.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-kafka-exporter</code></dt>
<dd>
<p>Service account used by the Kafka Exporter.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Cruise Control</div>
<p>These resources are only created only if Cruise Control was deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control</code></dt>
<dd>
<p>Deployment with Cruise Control.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the Cruise Control deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-config</code></dt>
<dd>
<p>ConfigMap that contains the Cruise Control ancillary configuration, and is mounted as a volume by the Cruise Control pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control-certs</code></dt>
<dd>
<p>Secret with Cruise Control keys for communication with Kafka and ZooKeeper.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control</code></dt>
<dd>
<p>Service used to communicate with Cruise Control.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-cruise-control</code></dt>
<dd>
<p>Service account used by Cruise Control.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-network-policy-cruise-control</code></dt>
<dd>
<p>Network policy managing access to the Cruise Control service.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">JMXTrans</div>
<p>These resources are only created if JMXTrans is deployed using the Cluster Operator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans</code></dt>
<dd>
<p>Deployment with JMXTrans.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans-<em>random-string</em></code></dt>
<dd>
<p>Pod created by the JMXTrans deployment.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans-config</code></dt>
<dd>
<p>ConfigMap that contains the JMXTrans ancillary configuration, and is mounted as a volume by the JMXTrans pods.</p>
</dd>
<dt class="hdlist1"><code><em>cluster-name</em>-jmxtrans</code></dt>
<dd>
<p>Service account used by JMXTrans.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-kafka-connect-str"><a class="link" href="#assembly-kafka-connect-str">2.2. Kafka Connect/S2I cluster configuration</a></h3>
<div class="paragraph">
<p>This section describes how to configure a Kafka Connect or Kafka Connect with Source-to-Image (S2I) deployment in your Strimzi cluster.</p>
</div>
<div class="paragraph">
<p>Kafka Connect is an integration toolkit for streaming data between Kafka brokers and other systems using <code>Connector</code> plugins.
Kafka Connect provides a framework for integrating Kafka with an external data source or target, such as a database, for import or export of data using connectors.
Connectors are plugins that provide the connection configuration needed.</p>
</div>
<div class="paragraph">
<p>If you are using Kafka Connect, you configure either the <code>KafkaConnect</code> or the <code>KafkaConnectS2I</code> resource.
Use the <code>KafkaConnectS2I</code> resource if you are using the <a href="https://docs.okd.io/3.11/creating_images/s2i.html" target="_blank" rel="noopener">Source-to-Image (S2I)</a> framework to deploy Kafka Connect.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The full schema of the <code>KafkaConnect</code> resource is described in <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code> schema reference</a>.</p>
</li>
<li>
<p>The full schema of the <code>KafkaConnectS2I</code> resource is described in <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code> schema reference</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="./deploying.html#con-creating-managing-connectors-str" target="_blank" rel="noopener">Creating and managing connectors</a></p>
</li>
<li>
<p><a href="./deploying.html#proc-deploying-kafkaconnector-str" target="_blank" rel="noopener">Deploying a <code>KafkaConnector</code> resource to Kafka Connect</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-kafka-connect-config-str"><a class="link" href="#proc-kafka-connect-config-str">2.2.1. Configuring Kafka Connect</a></h4>
<div class="paragraph">
<p>Use Kafka Connect to set up external data connections to your Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Use the properties of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource to configure your Kafka Connect deployment.
The example shown in this procedure is for the <code>KafkaConnect</code> resource, but the properties are the same for the <code>KafkaConnectS2I</code> resource.</p>
</div>
<div class="paragraph">
<div class="title">Kafka connector configuration</div>
<p><code>KafkaConnector</code> resources allow you to create and manage connector instances for Kafka Connect in a Kubernetes-native way.</p>
</div>
<div class="paragraph">
<p>In the configuration, you enable <code>KafkaConnectors</code> for a Kafka Connect cluster by adding the <code>strimzi.io/use-connector-resources</code> annotation.
You can also specify external configuration for Kafka Connect connectors through the <code>externalConfiguration</code> property.</p>
</div>
<div class="paragraph">
<p>Connectors are created, reconfigured, and deleted using the Kafka Connect HTTP REST interface, or by using <code>KafkaConnectors</code>.
For more information on these methods, see <a href="./deploying.html#con-creating-managing-connectors-str" target="_blank" rel="noopener">Creating and managing connectors</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
<div class="paragraph">
<p>The connector configuration is passed to Kafka Connect as part of an HTTP request and stored within Kafka itself.
ConfigMaps and Secrets are standard Kubernetes resources used for storing configurations and confidential data.
You can use ConfigMaps and Secrets to configure certain elements of a connector.
You can then reference the configuration values in HTTP REST commands (this keeps the configuration separate and more secure, if needed).
This method applies especially to confidential data, such as usernames, passwords, or certificates.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect <b class="conum">(1)</b>
metadata:
  name: my-connect-cluster
  annotations:
    strimzi.io/use-connector-resources: "true" <b class="conum">(2)</b>
spec:
  replicas: 3 <b class="conum">(3)</b>
  authentication: <b class="conum">(4)</b>
    type: tls
    certificateAndKey:
      certificate: source.crt
      key: source.key
      secretName: my-user-source
  bootstrapServers: my-cluster-kafka-bootstrap:9092 <b class="conum">(5)</b>
  tls: <b class="conum">(6)</b>
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
      - secretName: my-cluster-cluster-cert
        certificate: ca2.crt
  config: <b class="conum">(7)</b>
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
  externalConfiguration: <b class="conum">(8)</b>
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey
  resources: <b class="conum">(9)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(10)</b>
    type: inline
    loggers:
      log4j.rootLogger: "INFO"
  readinessProbe: <b class="conum">(11)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  metrics: <b class="conum">(12)</b>
    lowercaseOutputName: true
    lowercaseOutputLabelNames: true
    rules:
      - pattern: kafka.connect&lt;type=connect-worker-metrics&gt;&lt;&gt;([a-z-]+)
        name: kafka_connect_worker_$1
        help: "Kafka Connect JMX metric worker"
        type: GAUGE
      - pattern: kafka.connect&lt;type=connect-worker-rebalance-metrics&gt;&lt;&gt;([a-z-]+)
        name: kafka_connect_worker_rebalance_$1
        help: "Kafka Connect JMX metric rebalance information"
        type: GAUGE
  jvmOptions: <b class="conum">(13)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(14)</b>
  template: <b class="conum">(15)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: <b class="conum">(16)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>KafkaConnect</code> or <code>KafkaConnectS2I</code>, as required.</p>
</li>
<li>
<p>Enables <code>KafkaConnectors</code> for the Kafka Connect cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p>Authentication for the Kafka Connect cluster, using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>, as shown here, using <a href="#type-KafkaClientAuthenticationOAuth-reference">OAuth bearer tokens</a>, or a SASL-based <a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a> or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a> mechanism.
By default, Kafka Connect connects to Kafka brokers using a plain text connection.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the Kafka Connect cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p><a href="#property-kafka-connect-config-reference">Kafka Connect configuration</a> of <em>workers</em> (not connectors).
Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</li>
<li>
<p><a href="#type-ExternalConfiguration-reference">External configuration for Kafka connectors</a> using environment variables, as shown here, or volumes.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-connect-logging-reference">Kafka Connect loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Connect <code>log4j.rootLogger</code> logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a>, which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using <code>metrics: {}</code>.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka Connect.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are also <a href="#ref-tracing-environment-variables-str">set for distributed tracing using Jaeger</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONNECT-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
<li>
<p>If authorization is enabled for Kafka Connect, <a href="#proc-configuring-kafka-connect-user-authorization-str">configure Kafka Connect users to enable access to the Kafka Connect consumer group and topics</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-connect-multiple-instances-str"><a class="link" href="#con-kafka-connect-multiple-instances-str">2.2.2. Kafka Connect configuration for multiple instances</a></h4>
<div class="paragraph">
<p>If you are running multiple instances of Kafka Connect, you have to change the default configuration of the following <code>config</code> properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: connect-cluster <b class="conum">(1)</b>
    offset.storage.topic: connect-cluster-offsets <b class="conum">(2)</b>
    config.storage.topic: connect-cluster-configs <b class="conum">(3)</b>
    status.storage.topic: connect-cluster-status  <b class="conum">(4)</b>
    # ...
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Kafka Connect cluster group that the instance belongs to.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Values for the three topics must be the same for all Kafka Connect instances with the same <code>group.id</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless you change the default settings, each Kafka Connect instance connecting to the same Kafka cluster is deployed with the same values.
What happens, in effect, is all instances are coupled to run in a cluster and use the same topics.</p>
</div>
<div class="paragraph">
<p>If multiple Kafka Connect clusters try to use the same topics, Kafka Connect will not work as expected and generate errors.</p>
</div>
<div class="paragraph">
<p>If you wish to run multiple Kafka Connect instances, change the values of these properties for each instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-connect-user-authorization-str"><a class="link" href="#proc-configuring-kafka-connect-user-authorization-str">2.2.3. Configuring Kafka Connect user authorization</a></h4>
<div class="paragraph">
<p>This procedure describes how to authorize user access to Kafka Connect.</p>
</div>
<div class="paragraph">
<p>When any type of authorization is being used in Kafka, a Kafka Connect user requires read/write access rights to the consumer group
and the internal topics of Kafka Connect.</p>
</div>
<div class="paragraph">
<p>The properties for the consumer group and internal topics are automatically configured by Strimzi,
or they can be specified explicitly in the <code>spec</code> of the <code>KafkaConnect</code> or <code>KafkaConnectS2I</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration properties in the <code>KafkaConnect</code> resource</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster <b class="conum">(1)</b>
    offset.storage.topic: my-connect-cluster-offsets <b class="conum">(2)</b>
    config.storage.topic: my-connect-cluster-configs <b class="conum">(3)</b>
    status.storage.topic: my-connect-cluster-status <b class="conum">(4)</b>
    # ...
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Kafka Connect cluster group that the instance belongs to.</p>
</li>
<li>
<p>Kafka topic that stores connector offsets.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status configurations.</p>
</li>
<li>
<p>Kafka topic that stores connector and task status updates.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure shows how access is provided when <code>simple</code> authorization is being used.</p>
</div>
<div class="paragraph">
<p>Simple authorization uses ACL rules, handled by the Kafka <code>AclAuthorizer</code> plugin, to provide the right level of access.
For more information on configuring a <code>KafkaUser</code> resource to use simple authorization, see the <a href="#type-AclRule-reference"><code>AclRule</code> schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default values for the consumer group and topics will differ when <a href="#con-kafka-connect-multiple-instances-str">running multiple instances</a>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>authorization</code> property in the <code>KafkaUser</code> resource to provide access rights to the user.</p>
<div class="paragraph">
<p>In the following example, access rights are configured for the Kafka Connect topics and consumer group using <code>literal</code> name values:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>offset.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-offsets</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-status</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>config.storage.topic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster-configs</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>connect-cluster</code></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  authorization:
    type: simple
    acls:
      # access to offset.storage.topic
      - resource:
          type: topic
          name: connect-cluster-offsets
          patternType: literal
        operation: Write
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-offsets
          patternType: literal
        operation: Create
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-offsets
          patternType: literal
        operation: Describe
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-offsets
          patternType: literal
        operation: Read
        host: "*"
      # access to status.storage.topic
      - resource:
          type: topic
          name: connect-cluster-status
          patternType: literal
        operation: Write
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-status
          patternType: literal
        operation: Create
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-status
          patternType: literal
        operation: Describe
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-status
          patternType: literal
        operation: Read
        host: "*"
      # access to config.storage.topic
      - resource:
          type: topic
          name: connect-cluster-configs
          patternType: literal
        operation: Write
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-configs
          patternType: literal
        operation: Create
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-configs
          patternType: literal
        operation: Describe
        host: "*"
      - resource:
          type: topic
          name: connect-cluster-configs
          patternType: literal
        operation: Read
        host: "*"
      # consumer group
      - resource:
          type: group
          name: connect-cluster
          patternType: literal
        operation: Read
        host: "*"</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-USER-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-connect-resources-str"><a class="link" href="#ref-list-of-kafka-connect-resources-str">2.2.4. List of Kafka Connect cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Connect worker node pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-api</dt>
<dd>
<p>Service which exposes the REST interface for managing the Kafka Connect cluster.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Connect ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Connect worker nodes.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-connect-s2i-resources-str"><a class="link" href="#ref-list-of-kafka-connect-s2i-resources-str">2.2.5. List of Kafka Connect (S2I) cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-source</dt>
<dd>
<p>ImageStream which is used as the base image for the newly-built Docker images.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>BuildConfig which is responsible for building the new Kafka Connect Docker images.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>ImageStream where the newly built Docker images will be pushed.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>DeploymentConfig which is in charge of creating the Kafka Connect worker node pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect-api</dt>
<dd>
<p>Service which exposes the REST interface for managing the Kafka Connect cluster.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Connect ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>connect-cluster-name</em>-connect</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Connect worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-deployment-configuration-kafka-mirror-maker-str"><a class="link" href="#assembly-deployment-configuration-kafka-mirror-maker-str">2.3. Kafka MirrorMaker cluster configuration</a></h3>
<div class="paragraph">
<p>This chapter describes how to configure a Kafka MirrorMaker deployment in your Strimzi cluster to replicate data between Kafka clusters.</p>
</div>
<div class="paragraph">
<p>You can use Strimzi with MirrorMaker or <a href="#assembly-mirrormaker-str">MirrorMaker 2.0</a>.
MirrorMaker 2.0 is the latest version, and offers a more efficient way to mirror data between Kafka clusters.</p>
</div>
<div class="paragraph">
<p>If you are using MirrorMaker, you configure the <code>KafkaMirrorMaker</code> resource.</p>
</div>
<div class="paragraph">
<p>The following procedure shows how the resource is configured:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-kafka-mirror-maker-str">Configuring Kafka MirrorMaker</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full schema of the <code>KafkaMirrorMaker</code> resource is described in the <a href="#type-KafkaMirrorMaker-reference">KafkaMirrorMaker schema reference</a>.</p>
</div>
<div class="sect3">
<h4 id="configuring-kafka-mirror-maker-str"><a class="link" href="#configuring-kafka-mirror-maker-str">2.3.1. Configuring Kafka MirrorMaker</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>KafkaMirrorMaker</code> resource to configure your Kafka MirrorMaker deployment.</p>
</div>
<div class="paragraph">
<p>You can configure access control for producers and consumers using TLS or SASL authentication.
This procedure shows a configuration that uses TLS encryption and authentication on the consumer and producer side.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Source and target Kafka clusters must be available</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaMirrorMaker</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
metadata:
  name: my-mirror-maker
spec:
  replicas: 3 <b class="conum">(1)</b>
  consumer:
    bootstrapServers: my-source-cluster-kafka-bootstrap:9092 <b class="conum">(2)</b>
    groupId: "my-group" <b class="conum">(3)</b>
    numStreams: 2 <b class="conum">(4)</b>
    offsetCommitInterval: 120000 <b class="conum">(5)</b>
    tls: <b class="conum">(6)</b>
      trustedCertificates:
      - secretName: my-source-cluster-ca-cert
        certificate: ca.crt
    authentication: <b class="conum">(7)</b>
      type: tls
      certificateAndKey:
        secretName: my-source-secret
        certificate: public.crt
        key: private.key
    config: <b class="conum">(8)</b>
      max.poll.records: 100
      receive.buffer.bytes: 32768
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(9)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(10)</b>
  producer:
    bootstrapServers: my-target-cluster-kafka-bootstrap:9092
    abortOnSendFailure: false <b class="conum">(11)</b>
    tls:
      trustedCertificates:
      - secretName: my-target-cluster-ca-cert
        certificate: ca.crt
    authentication:
      type: tls
      certificateAndKey:
        secretName: my-target-secret
        certificate: public.crt
        key: private.key
    config:
      compression.type: gzip
      batch.size: 8192
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(12)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(13)</b>
  whitelist: "my-topic|other-topic" <b class="conum">(14)</b>
  resources: <b class="conum">(15)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(16)</b>
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  readinessProbe: <b class="conum">(17)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  metrics: <b class="conum">(18)</b>
    lowercaseOutputName: true
    rules:
      - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*&gt;&lt;&gt;Count"
        name: "kafka_server_$1_$2_total"
      - pattern: "kafka.server&lt;type=(.+), name=(.+)PerSec\\w*,
        topic=(.+)&gt;&lt;&gt;Count"
        name: "kafka_server_$1_$2_total"
        labels:
          topic: "$3"
  jvmOptions: <b class="conum">(19)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(20)</b>
  template: <b class="conum">(21)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: <b class="conum">(22)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing: <b class="conum">(23)</b>
    type: jaeger</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap servers</a> for consumer and producer.</p>
</li>
<li>
<p><a href="#property-consumer-group-reference">Group ID for the consumer</a>.</p>
</li>
<li>
<p><a href="#property-consumer-streams-reference">The number of consumer streams</a>.</p>
</li>
<li>
<p><a href="#property-consumer-offset-autocommit-reference">The offset auto-commit interval in milliseconds</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for consumer or producer. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p>Authentication for consumer or producer, using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>, as shown here, using <a href="#type-KafkaClientAuthenticationOAuth-reference">OAuth bearer tokens</a>, or a SASL-based <a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a> or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a> mechanism.</p>
</li>
<li>
<p>Kafka configuration options for <a href="#property-consumer-config-reference">consumer</a> and <a href="#property-producer-config-reference">producer</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMakerConsumerSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>If the <a href="#property-producer-abort-on-send-reference"><code>abortOnSendFailure</code> property</a> is set to <code>true</code>, Kafka MirrorMaker will exit and the container will restart following a send failure for a message.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMakerProducerSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>A <a href="#property-mm-whitelist-reference"><em>whitelist</em> of topics</a> mirrored from source to target Kafka cluster.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-mm-loggers-reference">loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. MirrorMaker has a single logger called <code>mirrormaker.root.logger</code>. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-prometheus-reference">Prometheus metrics</a>, which are enabled with configuration for the Prometheus JMX exporter in this example. You can enable metrics without further configuration using <code>metrics: {}</code>.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka MirrorMaker.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are also <a href="#ref-tracing-environment-variables-str">set for distributed tracing using Jaeger</a>.</p>
</li>
<li>
<p><a href="#assembly-distributed-tracing-str">Distributed tracing is enabled for Jaeger</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
With the <code>abortOnSendFailure</code> property set to <code>false</code>, the producer attempts to send the next message in a topic. The original message might be lost, as there is no attempt to resend a failed message.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>&lt;your-file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-mirror-maker-resources-str"><a class="link" href="#ref-list-of-kafka-mirror-maker-resources-str">2.3.2. List of Kafka MirrorMaker cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Deployment which is responsible for creating the Kafka MirrorMaker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-config</dt>
<dd>
<p>ConfigMap which contains ancillary configuration for the Kafka MirrorMaker, and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>&lt;mirror-maker-name&gt;</em>-mirror-maker</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka MirrorMaker worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-mirrormaker-str"><a class="link" href="#assembly-mirrormaker-str">2.4. Kafka MirrorMaker 2.0 cluster configuration</a></h3>
<div class="paragraph">
<p>This section describes how to configure a Kafka MirrorMaker 2.0 deployment in your Strimzi cluster.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 is used to replicate data between two or more active Kafka clusters, within or across data centers.</p>
</div>
<div class="paragraph">
<p>Data replication across clusters supports scenarios that require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Recovery of data in the event of a system failure</p>
</li>
<li>
<p>Aggregation of data for analysis</p>
</li>
<li>
<p>Restriction of data access to a specific cluster</p>
</li>
<li>
<p>Provision of data at a specific location to improve latency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using MirrorMaker 2.0, you configure the <code>KafkaMirrorMaker2</code> resource.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 introduces an entirely new way of replicating data between clusters.</p>
</div>
<div class="paragraph">
<p>As a result, the resource configuration differs from the previous version of MirrorMaker.
If you choose to use MirrorMaker 2.0, there is currently no legacy support, so any resources must be manually converted into the new format.</p>
</div>
<div class="paragraph">
<p>How MirrorMaker 2.0 replicates data is described here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#con-mirrormaker-str">MirrorMaker 2.0 data replication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following procedure shows how the resource is configured for MirrorMaker 2.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-mirrormaker-replication-str">Synchronizing data between Kafka clusters</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The full schema of the <code>KafkaMirrorMaker2</code> resource is described in the <a href="#type-KafkaMirrorMaker2-reference">KafkaMirrorMaker2 schema reference</a>.</p>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-str"><a class="link" href="#con-mirrormaker-str">2.4.1. MirrorMaker 2.0 data replication</a></h4>
<div class="paragraph">
<p>MirrorMaker 2.0 consumes messages from a source Kafka cluster and writes them to a target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source cluster configuration to consume data from the source cluster</p>
</li>
<li>
<p>Target cluster configuration to output data to the target cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 is based on the Kafka Connect framework, <em>connectors</em> managing the transfer of data between clusters.
A MirrorMaker 2.0 <code>MirrorSourceConnector</code> replicates topics from a source cluster to a target cluster.</p>
</div>
<div class="paragraph">
<p>The process of <em>mirroring</em> data from one cluster to another cluster is asynchronous.
The recommended pattern is for messages to be produced locally alongside the source Kafka cluster, then consumed remotely close to the target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 can be used with more than one source cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mirrormaker.png" alt="MirrorMaker 2.0 replication">
</div>
<div class="title">Figure 1. Replication across two clusters</div>
</div>
</div>
<div class="sect3">
<h4 id="cluster_configuration"><a class="link" href="#cluster_configuration">2.4.2. Cluster configuration</a></h4>
<div class="paragraph">
<p>You can use MirrorMaker 2.0 in <em>active/passive</em> or <em>active/active</em> cluster configurations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In an <em>active/active</em> configuration, both clusters are active and provide the same data simultaneously, which is useful if you want to make the same data available locally in different geographical locations.</p>
</li>
<li>
<p>In an <em>active/passive</em> configuration, the data from an active cluster is replicated in a passive cluster, which remains on standby, for example, for data recovery in the event of system failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The expectation is that producers and consumers connect to active clusters only.</p>
</div>
<div class="paragraph">
<p>A MirrorMaker 2.0 cluster is required at each target destination.</p>
</div>
<div class="sect4">
<h5 id="bidirectional_replication_activeactive"><a class="link" href="#bidirectional_replication_activeactive">Bidirectional replication (active/active)</a></h5>
<div class="paragraph">
<p>The MirrorMaker 2.0 architecture supports bidirectional replication in an <em>active/active</em> cluster configuration.</p>
</div>
<div class="paragraph">
<p>Each cluster replicates the data of the other cluster using the concept of <em>source</em> and <em>remote</em> topics.
As the same topics are stored in each cluster, remote topics are automatically renamed by MirrorMaker 2.0 to represent the source cluster.
The name of the originating cluster is prepended to the name of the topic.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mirrormaker-renaming.png" alt="MirrorMaker 2.0 bidirectional architecture">
</div>
<div class="title">Figure 2. Topic renaming</div>
</div>
<div class="paragraph">
<p>By flagging the originating cluster, topics are not replicated back to that cluster.</p>
</div>
<div class="paragraph">
<p>The concept of replication through <em>remote</em> topics is useful when configuring an architecture that requires data aggregation.
Consumers can subscribe to source and remote topics within the same cluster, without the need for a separate aggregation cluster.</p>
</div>
</div>
<div class="sect4">
<h5 id="unidirectional_replication_activepassive"><a class="link" href="#unidirectional_replication_activepassive">Unidirectional replication (active/passive)</a></h5>
<div class="paragraph">
<p>The MirrorMaker 2.0 architecture supports unidirectional replication in an <em>active/passive</em> cluster configuration.</p>
</div>
<div class="paragraph">
<p>You can use an <em>active/passive</em> cluster configuration to make backups or migrate data to another cluster.
In this situation, you might not want automatic renaming of remote topics.</p>
</div>
<div class="paragraph">
<p>You can override automatic renaming by adding <code>IdentityReplicationPolicy</code> to the source connector configuration of the <code>KafkaMirrorMaker2</code> resource.
With this configuration applied, topics retain their original names.</p>
</div>
</div>
<div class="sect4">
<h5 id="topic_configuration_synchronization"><a class="link" href="#topic_configuration_synchronization">Topic configuration synchronization</a></h5>
<div class="paragraph">
<p>Topic configuration is automatically synchronized between source and target clusters.
By synchronizing configuration properties, the need for rebalancing is reduced.</p>
</div>
</div>
<div class="sect4">
<h5 id="data_integrity"><a class="link" href="#data_integrity">Data integrity</a></h5>
<div class="paragraph">
<p>MirrorMaker 2.0 monitors source topics and propagates any configuration changes to remote topics, checking for and creating missing partitions.
Only MirrorMaker 2.0 can write to remote topics.</p>
</div>
</div>
<div class="sect4">
<h5 id="offset_tracking"><a class="link" href="#offset_tracking">Offset tracking</a></h5>
<div class="paragraph">
<p>MirrorMaker 2.0 tracks offsets for consumer groups using <em>internal topics</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>offset sync</em> topic maps the source and target offsets for replicated topic partitions from record metadata</p>
</li>
<li>
<p>The <em>checkpoint</em> topic maps the last committed offset in the source and target cluster for replicated topic partitions in each consumer group</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Offsets for the <em>checkpoint</em> topic are tracked at predetermined intervals through configuration.
Both topics enable replication to be fully restored from the correct offset position on failover.</p>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 uses its <code>MirrorCheckpointConnector</code> to emit <em>checkpoints</em> for offset tracking.</p>
</div>
</div>
<div class="sect4">
<h5 id="connectivity_checks"><a class="link" href="#connectivity_checks">Connectivity checks</a></h5>
<div class="paragraph">
<p>A <em>heartbeat</em> internal topic checks connectivity between clusters.</p>
</div>
<div class="paragraph">
<p>The <em>heartbeat</em> topic is replicated from the source cluster.</p>
</div>
<div class="paragraph">
<p>Target clusters use the topic to check:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The connector managing connectivity between clusters is running</p>
</li>
<li>
<p>The source cluster is available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 uses its <code>MirrorHeartbeatConnector</code> to emit <em>heartbeats</em> that perform these checks.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-mirrormaker-acls-str"><a class="link" href="#con-mirrormaker-acls-str">2.4.3. ACL rules synchronization</a></h4>
<div class="paragraph">
<p>ACL access to remote topics is possible if you are <strong>not</strong> using the User Operator.</p>
</div>
<div class="paragraph">
<p>If <code>AclAuthorizer</code> is being used, without the User Operator, ACL rules that manage access to brokers also apply to remote topics.
Users that can read a source topic can read its remote equivalent.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
OAuth 2.0 authorization does not support access to remote topics in this way.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-mirrormaker-replication-str"><a class="link" href="#proc-mirrormaker-replication-str">2.4.4. Synchronizing data between Kafka clusters using MirrorMaker 2.0</a></h4>
<div class="paragraph">
<p>Use MirrorMaker 2.0 to synchronize data between Kafka clusters through configuration.</p>
</div>
<div class="paragraph">
<p>The configuration must specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Kafka cluster</p>
</li>
<li>
<p>Connection information for each cluster, including TLS authentication</p>
</li>
<li>
<p>The replication flow and direction</p>
<div class="ulist">
<ul>
<li>
<p>Cluster to cluster</p>
</li>
<li>
<p>Topic to topic</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the properties of the <code>KafkaMirrorMaker2</code> resource to configure your Kafka MirrorMaker 2.0 deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The previous version of MirrorMaker continues to be supported.
If you wish to use the resources configured for the previous version,
they must be updated to the format supported by MirrorMaker 2.0.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MirrorMaker 2.0 provides default configuration values for properties such as replication factors.
A minimal configuration, with defaults left unchanged, would be something like this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  version: 2.6.0
  connectCluster: "my-cluster-target"
  clusters:
  - alias: "my-cluster-source"
    bootstrapServers: my-cluster-source-kafka-bootstrap:9092
  - alias: "my-cluster-target"
    bootstrapServers: my-cluster-target-kafka-bootstrap:9092
  mirrors:
  - sourceCluster: "my-cluster-source"
    targetCluster: "my-cluster-target"
    sourceConnector: {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure access control for source and target clusters using TLS or SASL authentication.
This procedure shows a configuration that uses TLS encryption and authentication for the source and target cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Source and target Kafka clusters must be available</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaMirrorMaker2</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaMirrorMaker2
metadata:
  name: my-mirror-maker2
spec:
  version: 2.6.0 <b class="conum">(1)</b>
  replicas: 3 <b class="conum">(2)</b>
  connectCluster: "my-cluster-target" <b class="conum">(3)</b>
  clusters: <b class="conum">(4)</b>
  - alias: "my-cluster-source" <b class="conum">(5)</b>
    authentication: <b class="conum">(6)</b>
      certificateAndKey:
        certificate: source.crt
        key: source.key
        secretName: my-user-source
      type: tls
    bootstrapServers: my-cluster-source-kafka-bootstrap:9092 <b class="conum">(7)</b>
    tls: <b class="conum">(8)</b>
      trustedCertificates:
      - certificate: ca.crt
        secretName: my-cluster-source-cluster-ca-cert
  - alias: "my-cluster-target" <b class="conum">(9)</b>
    authentication: <b class="conum">(10)</b>
      certificateAndKey:
        certificate: target.crt
        key: target.key
        secretName: my-user-target
      type: tls
    bootstrapServers: my-cluster-target-kafka-bootstrap:9092 <b class="conum">(11)</b>
    config: <b class="conum">(12)</b>
      config.storage.replication.factor: 1
      offset.storage.replication.factor: 1
      status.storage.replication.factor: 1
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(13)</b>
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(14)</b>
    tls: <b class="conum">(15)</b>
      trustedCertificates:
      - certificate: ca.crt
        secretName: my-cluster-target-cluster-ca-cert
  mirrors: <b class="conum">(16)</b>
  - sourceCluster: "my-cluster-source" <b class="conum">(17)</b>
    targetCluster: "my-cluster-target" <b class="conum">(18)</b>
    sourceConnector: <b class="conum">(19)</b>
      config:
        replication.factor: 1 <b class="conum">(20)</b>
        offset-syncs.topic.replication.factor: 1 <b class="conum">(21)</b>
        sync.topic.acls.enabled: "false" <b class="conum">(22)</b>
        replication.policy.separator: "" <b class="conum">(23)</b>
        replication.policy.class: "io.strimzi.kafka.connect.mirror.IdentityReplicationPolicy" <b class="conum">(24)</b>
    heartbeatConnector: <b class="conum">(25)</b>
      config:
        heartbeats.topic.replication.factor: 1 <b class="conum">(26)</b>
    checkpointConnector: <b class="conum">(27)</b>
      config:
        checkpoints.topic.replication.factor: 1 <b class="conum">(28)</b>
    topicsPattern: ".*" <b class="conum">(29)</b>
    groupsPattern: "group1|group2|group3" <b class="conum">(30)</b>
  resources: <b class="conum">(31)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(32)</b>
    type: inline
    loggers:
      connect.root.logger.level: "INFO"
  readinessProbe: <b class="conum">(33)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  jvmOptions: <b class="conum">(34)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  image: my-org/my-image:latest <b class="conum">(35)</b>
  template: <b class="conum">(36)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    connectContainer: <b class="conum">(37)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing:
    type: jaeger <b class="conum">(38)</b>
  externalConfiguration: <b class="conum">(39)</b>
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The Kafka Connect <a href="#type-KafkaConnectSpec-reference">version</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2Spec-reference">Cluster alias</a> for Kafka Connect.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Specification</a> for the Kafka clusters being synchronized.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Cluster alias</a> for the source Kafka cluster.</p>
</li>
<li>
<p>Authentication for the source cluster, using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>, as shown here, using <a href="#type-KafkaClientAuthenticationOAuth-reference">OAuth bearer tokens</a>, or a SASL-based <a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a> or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a> mechanism.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the source Kafka cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the source Kafka cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Cluster alias</a> for the target Kafka cluster.</p>
</li>
<li>
<p>Authentication for the target Kafka cluster is configured in the same way as for the source Kafka cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the target Kafka cluster.</p>
</li>
<li>
<p><a href="#property-kafka-connect-config-reference">Kafka Connect configuration</a>.
Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</li>
<li>
<p><a href="#con-common-configuration-ssl-reference">SSL properties</a> for external listeners to run with a specific <em>cipher suite</em> for a TLS version.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ClusterSpec-reference">Hostname verification is enabled</a> by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
<li>
<p>TLS encryption for the target Kafka cluster is configured in the same way as for the source Kafka cluster.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">MirrorMaker 2.0 connectors</a>.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">Cluster alias</a> for the source cluster used by the MirrorMaker 2.0 connectors.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2MirrorSpec-reference">Cluster alias</a> for the target cluster used by the MirrorMaker 2.0 connectors.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorSourceConnector</code></a> that creates remote topics. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>Replication factor for mirrored topics created at the target cluster.</p>
</li>
<li>
<p>Replication factor for the <code>MirrorSourceConnector</code> <code>offset-syncs</code> internal topic that maps the offsets of the source and target clusters.</p>
</li>
<li>
<p>When <a href="#con-mirrormaker-acls-str">ACL rules synchronization</a> is enabled, ACLs are applied to synchronized topics. The default is <code>true</code>.</p>
</li>
<li>
<p>Defines the separator used for the renaming of remote topics.</p>
</li>
<li>
<p>Adds a policy that overrides the automatic renaming of remote topics. Instead of prepending the name with the name of the source cluster, the topic retains its original name. This optional setting is useful for active/passive backups and data migration.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorHeartbeatConnector</code></a> that performs connectivity checks. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>Replication factor for the heartbeat topic created at the target cluster.</p>
</li>
<li>
<p><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference">Configuration for the <code>MirrorCheckpointConnector</code></a> that tracks offsets. The <code>config</code> overrides the default configuration options.</p>
</li>
<li>
<p>Replication factor for the checkpoints topic created at the target cluster.</p>
</li>
<li>
<p>Topic replication from the source cluster <a href="#type-KafkaMirrorMaker2MirrorSpec-reference">defined as regular expression patterns</a>. Here we request all topics.</p>
</li>
<li>
<p>Consumer group replication from the source cluster <a href="#type-KafkaMirrorMaker2MirrorSpec-reference">defined as regular expression patterns</a>. Here we request three consumer groups by name.
You can use comma-separated lists.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-connect-logging-reference">Kafka Connect loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Connect <code>log4j.rootLogger</code> logger, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running Kafka MirrorMaker.</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are also <a href="#ref-tracing-environment-variables-str">set for distributed tracing using Jaeger</a>.</p>
</li>
<li>
<p><a href="#assembly-distributed-tracing-str">Distributed tracing is enabled for Jaeger</a>.</p>
</li>
<li>
<p><a href="#type-ExternalConfiguration-reference">External configuration</a> for a Kubernetes Secret mounted to Kafka MirrorMaker as an environment variable.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>&lt;your-file&gt;</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-config-kafka-bridge-str"><a class="link" href="#assembly-config-kafka-bridge-str">2.5. Kafka Bridge cluster configuration</a></h3>
<div class="paragraph">
<p>This section describes how to configure a Kafka Bridge deployment in your Strimzi cluster.</p>
</div>
<div class="paragraph">
<p>Kafka Bridge provides an API for integrating HTTP-based clients with a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>If you are using the Kafka Bridge, you configure the <code>KafkaBridge</code> resource.</p>
</div>
<div class="paragraph">
<p>The full schema of the <code>KafkaBridge</code> resource is described in <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code> schema reference</a>.</p>
</div>
<div class="sect3">
<h4 id="proc-config-kafka-bridge-str"><a class="link" href="#proc-config-kafka-bridge-str">2.5.1. Configuring the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Use the Kafka Bridge to make HTTP-based requests to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Use the properties of the <code>KafkaBridge</code> resource to configure your Kafka Bridge deployment.</p>
</div>
<div class="paragraph">
<p>In order to prevent issues arising when client consumer requests are processed by different Kafka Bridge instances, address-based routing must be employed to ensure that requests are routed to the right Kafka Bridge instance.
Additionally, each independent Kafka Bridge instance must have a replica.
A Kafka Bridge instance has its own state which is not shared with another instances.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <em>Deploying Strimzi</em> guide for instructions on running a:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Cluster Operator</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-kafka-cluster-str" target="_blank" rel="noopener">Kafka cluster</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>spec</code> properties for the <code>KafkaBridge</code> resource.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  replicas: 3 <b class="conum">(1)</b>
  bootstrapServers: my-cluster-kafka-bootstrap:9092 <b class="conum">(2)</b>
  tls: <b class="conum">(3)</b>
    trustedCertificates:
      - secretName: my-cluster-cluster-cert
        certificate: ca.crt
      - secretName: my-cluster-cluster-cert
        certificate: ca2.crt
  authentication: <b class="conum">(4)</b>
    type: tls
    certificateAndKey:
      secretName: my-secret
      certificate: public.crt
      key: private.key
  http: <b class="conum">(5)</b>
    port: 8080
    cors: <b class="conum">(6)</b>
      allowedOrigins: "https://strimzi.io"
      allowedMethods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  consumer: <b class="conum">(7)</b>
    config:
      auto.offset.reset: earliest
  producer: <b class="conum">(8)</b>
    config:
      delivery.timeout.ms: 300000
  resources: <b class="conum">(9)</b>
    requests:
      cpu: "1"
      memory: 2Gi
    limits:
      cpu: "2"
      memory: 2Gi
  logging: <b class="conum">(10)</b>
    type: inline
    loggers:
      logger.bridge.level: "INFO"
      # enabling DEBUG just for send operation
      logger.send.name: "http.openapi.operation.send"
      logger.send.level: "DEBUG"
  jvmOptions: <b class="conum">(11)</b>
    "-Xmx": "1g"
    "-Xms": "1g"
  readinessProbe: <b class="conum">(12)</b>
    initialDelaySeconds: 15
    timeoutSeconds: 5
  livenessProbe:
    initialDelaySeconds: 15
    timeoutSeconds: 5
  image: my-org/my-image:latest <b class="conum">(13)</b>
  template: <b class="conum">(14)</b>
    pod:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                  - key: application
                    operator: In
                    values:
                      - postgresql
                      - mongodb
              topologyKey: "kubernetes.io/hostname"
    bridgeContainer: <b class="conum">(15)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><a href="#con-common-configuration-replicas-reference">The number of replica nodes</a>.</p>
</li>
<li>
<p><a href="#con-common-configuration-bootstrap-reference">Bootstrap server</a> for connection to the target Kafka cluster.</p>
</li>
<li>
<p><a href="#con-common-configuration-trusted-certificates-reference">TLS encryption</a> with key names under which TLS certificates are stored in X.509 format for the source Kafka cluster. If certificates are stored in the same secret, it can be listed multiple times.</p>
</li>
<li>
<p>Authentication for the Kafka Bridge cluster, using the <a href="#type-KafkaClientAuthenticationTls-reference">TLS mechanism</a>, as shown here, using <a href="#type-KafkaClientAuthenticationOAuth-reference">OAuth bearer tokens</a>, or a SASL-based <a href="#type-KafkaClientAuthenticationScramSha512-reference">SCRAM-SHA-512</a> or <a href="#type-KafkaClientAuthenticationPlain-reference">PLAIN</a> mechanism.
By default, the Kafka Bridge connects to Kafka brokers without authentication.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeHttpConfig-reference">HTTP access</a> to Kafka brokers.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeHttpConfig-reference">CORS access</a> specifying selected resources and access methods. Additional HTTP headers in requests <a href="#con-requests-kafka-bridge-cors-kafka-bridge-overview">describe the origins that are permitted access to the Kafka cluster</a>.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeConsumerSpec-reference">Consumer configuration</a> options.</p>
</li>
<li>
<p><a href="#type-KafkaBridgeProducerSpec-reference">Producer configuration</a> options.</p>
</li>
<li>
<p>Requests for reservation of <a href="#con-common-configuration-resources-reference">supported resources</a>, currently <code>cpu</code> and <code>memory</code>, and limits to specify the maximum resources that can be consumed.</p>
</li>
<li>
<p>Specified <a href="#property-kafka-bridge-logging-reference">Kafka Bridge loggers and log levels</a> added directly (<code>inline</code>) or indirectly (<code>external</code>) through a ConfigMap. A custom ConfigMap must be placed under the <code>log4j.properties</code> or <code>log4j2.properties</code> key. For the Kafka Bridge loggers, you can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF.</p>
</li>
<li>
<p><a href="#con-common-configuration-jvm-reference">JVM configuration options</a> to optimize performance for the Virtual Machine (VM) running the Kafka Bridge.</p>
</li>
<li>
<p><a href="#con-common-configuration-healthchecks-reference">Healthchecks</a> to know when to restart a container (liveness) and when a container can accept traffic (readiness).</p>
</li>
<li>
<p>ADVANCED OPTION: <a href="#con-common-configuration-images-reference">Container image configuration</a>, which is recommended only in special situations.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Template customization</a>. Here a pod is scheduled with anti-affinity, so the pod is not scheduled on nodes with the same hostname.</p>
</li>
<li>
<p>Environment variables are also <a href="#ref-tracing-environment-variables-str">set for distributed tracing using Jaeger</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-BRIDGE-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-list-of-kafka-bridge-resources-str"><a class="link" href="#ref-list-of-kafka-bridge-resources-str">2.5.2. List of Kafka Bridge cluster resources</a></h4>
<div class="paragraph">
<p>The following resources are created by the Cluster Operator in the Kubernetes cluster:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Deployment which is in charge to create the Kafka Bridge worker node pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-service</dt>
<dd>
<p>Service which exposes the REST interface of the Kafka Bridge cluster.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge-config</dt>
<dd>
<p>ConfigMap which contains the Kafka Bridge ancillary configuration and is mounted as a volume by the Kafka broker pods.</p>
</dd>
<dt class="hdlist1"><em>bridge-cluster-name</em>-bridge</dt>
<dd>
<p>Pod Disruption Budget configured for the Kafka Bridge worker nodes.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-customizing-kubernetes-resources-str"><a class="link" href="#assembly-customizing-kubernetes-resources-str">2.6. Customizing Kubernetes resources</a></h3>
<div class="paragraph">
<p>Strimzi creates several Kubernetes resources, such as <code>Deployments</code>, <code>StatefulSets</code>, <code>Pods</code>, and <code>Services</code>, which are managed by Strimzi operators.
Only the operator that is responsible for managing a particular Kubernetes resource can change that resource.
If you try to manually change an operator-managed Kubernetes resource, the operator will revert your changes back.</p>
</div>
<div class="paragraph">
<p>However, changing an operator-managed Kubernetes resource can be useful if you want to perform certain tasks, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding custom labels or annotations that control how <code>Pods</code> are treated by Istio or other services</p>
</li>
<li>
<p>Managing how <code>Loadbalancer</code>-type Services are created by the cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can make such changes using the <code>template</code> property in the Strimzi custom resources.
The <code>template</code> property is supported in the following resources.
The API reference provides more details about the customizable fields.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Kafka.spec.kafka</code></dt>
<dd>
<p>See <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.zookeeper</code></dt>
<dd>
<p>See <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.entityOperator</code></dt>
<dd>
<p>See <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.kafkaExporter</code></dt>
<dd>
<p>See <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.cruiseControl</code></dt>
<dd>
<p>See <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>Kafka.spec.jmxTrans</code></dt>
<dd>
<p>See <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaConnect.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaConnectS2I.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaMirrorMaker.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaMirrorMaker2.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaBridge.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code> schema reference</a></p>
</dd>
<dt class="hdlist1"><code>KafkaUser.spec</code></dt>
<dd>
<p>See <a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code> schema reference</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In the following example, the <code>template</code> property is used to modify the labels in a Kafka broker&#8217;s <code>StatefulSet</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
  labels:
    app: my-cluster
spec:
  kafka:
    # ...
    template:
      statefulset:
        metadata:
          labels:
            mylabel: myvalue
    # ...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="con-customizing-image-pull-policy-str"><a class="link" href="#con-customizing-image-pull-policy-str">2.6.1. Customizing the image pull policy</a></h4>
<div class="paragraph">
<p>Strimzi allows you to customize the image pull policy for containers in all pods deployed by the Cluster Operator.
The image pull policy is configured using the environment variable <code>STRIMZI_IMAGE_PULL_POLICY</code> in the Cluster Operator deployment.
The <code>STRIMZI_IMAGE_PULL_POLICY</code> environment variable can be set to three different values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>Always</code></dt>
<dd>
<p>Container images are pulled from the registry every time the pod is started or restarted.</p>
</dd>
<dt class="hdlist1"><code>IfNotPresent</code></dt>
<dd>
<p>Container images are pulled from the registry only when they were not pulled before.</p>
</dd>
<dt class="hdlist1"><code>Never</code></dt>
<dd>
<p>Container images are never pulled from the registry.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The image pull policy can be currently customized only for all Kafka, Kafka Connect, and Kafka MirrorMaker clusters at once.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about Cluster Operator configuration, see <a href="#using-the-cluster-operator-str">Using the Cluster Operator</a>.</p>
</li>
<li>
<p>For more information about Image Pull Policies, see <a href="https://kubernetes.io/docs/concepts/containers/images/#updating-images" target="_blank" rel="noopener">Disruptions</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-logging_str"><a class="link" href="#external-logging_str">2.7. External logging</a></h3>
<div class="paragraph">
<p>When setting the logging levels for a resource, you can specify them <em>inline</em> directly in the <code>spec.logging</code> property of the resource YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  logging:
    type: inline
    loggers:
      kafka.root.logger.level: "INFO"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can specify <em>external</em> logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  logging:
    type: external
    name: <em>customConfigMap</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>With external logging, logging properties are defined in a ConfigMap.
The name of the ConfigMap is referenced in the <code>spec.logging.name</code> property.</p>
</div>
<div class="paragraph">
<p>The advantages of using a ConfigMap are that the logging properties are maintained in one place and are accessible to more than one resource.</p>
</div>
<div class="sect3">
<h4 id="creating-configmap_str"><a class="link" href="#creating-configmap_str">2.7.1. Creating a ConfigMap for logging</a></h4>
<div class="paragraph">
<p>To use a ConfigMap to define logging properties, you create the ConfigMap and then reference it as part of the logging definition in the <code>spec</code> of a resource.</p>
</div>
<div class="paragraph">
<p>The ConfigMap must contain the appropriate logging configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j.properties</code> for Kafka components, ZooKeeper, and the Kafka Bridge</p>
</li>
<li>
<p><code>log4j2.properties</code> for the Topic Operator and User Operator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The configuration must be placed under these properties.</p>
</div>
<div class="paragraph">
<p>Here we demonstrate how a ConfigMap defines a root logger for a Kafka resource.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the ConfigMap.</p>
<div class="paragraph">
<p>You can create the ConfigMap as a YAML file or from a properties file using <code>kubectl</code> at the command line.</p>
</div>
<div class="paragraph">
<p>ConfigMap example with a root logger definition for Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: ConfigMap
apiVersion: kafka.strimzi.io/v1beta1
metadata:
  name: logging-configmap
data:
  log4j.properties:
    kafka.root.logger.level="INFO"</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the command line, using a properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create configmap logging-configmap --from-file=log4j.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties file defines the logging configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs"># Define the logger
kafka.root.logger.level="INFO"
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Define <em>external</em> logging in the <code>spec</code> of the resource, setting the <code>logging.name</code> to the name of the ConfigMap.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">spec:
  # ...
  logging:
    type: external
    name: logging-configmap</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f kafka.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-configuring-external-listeners-str"><a class="link" href="#assembly-configuring-external-listeners-str">3. Configuring external listeners</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use an external listener to expose your Strimzi Kafka cluster to a client outside a Kubernetes environment.</p>
</div>
<div class="paragraph">
<p>Specify the connection <code>type</code> to expose Kafka in the external listener configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>nodeport</code> uses <code>NodePort</code> type <code>Services</code></p>
</li>
<li>
<p><code>loadbalancer</code> uses <code>Loadbalancer</code> type <code>Services</code></p>
</li>
<li>
<p><code>ingress</code> uses Kubernetes <code>Ingress</code> and the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a></p>
</li>
<li>
<p><code>route</code> uses OpenShift <code>Routes</code> and the HAProxy router</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on listener configuration, see <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>route</code> is only supported on OpenShift
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/2019/04/17/accessing-kafka-part-1.html" target="_blank" rel="noopener">Accessing Apache Kafka in Strimzi</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-accessing-kafka-using-nodeports-str"><a class="link" href="#proc-accessing-kafka-using-nodeports-str">3.1. Accessing Kafka using node ports</a></h3>
<div class="paragraph">
<p>This procedure describes how to access a Strimzi Kafka cluster from an external client using node ports.</p>
</div>
<div class="paragraph">
<p>To connect to a broker, you need a hostname and port number for the Kafka <em>bootstrap address</em>,
as well as the certificate used for authentication.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure a <code>Kafka</code> resource with an external listener set to the <code>nodeport</code> type.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: external
        port: 9094
        type: nodeport
        tls: true
        authentication:
          type: tls
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>NodePort</code> type services are created for each Kafka broker, as well as an external <em>bootstrap service</em>.
The bootstrap service routes external traffic to the Kafka brokers.
Node addresses used for connection are propagated to the <code>status</code> of the Kafka custom resource.</p>
</div>
<div class="paragraph">
<p>The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the <code>Kafka</code> resource.</p>
</div>
</li>
<li>
<p>Retrieve the bootstrap address you can use to access the Kafka cluster from the status of the <code>Kafka</code> resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>KAFKA-CLUSTER-NAME</em> -o=jsonpath='{.status.listeners[?(@.type=="external")].bootstrapServers}{"\n"}'</code></pre>
</div>
</div>
</li>
<li>
<p>If TLS encryption is enabled, extract the public certificate of the broker certification authority.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-accessing-kafka-using-loadbalancers-str"><a class="link" href="#proc-accessing-kafka-using-loadbalancers-str">3.2. Accessing Kafka using loadbalancers</a></h3>
<div class="paragraph">
<p>This procedure describes how to access a Strimzi Kafka cluster from an external client using loadbalancers.</p>
</div>
<div class="paragraph">
<p>To connect to a broker, you need the address of the <em>bootstrap loadbalancer</em>,
as well as the certificate used for TLS encryption.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure a <code>Kafka</code> resource with an external listener set to the <code>loadbalancer</code> type.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: external
        port: 9094
        type: loadbalancer
        tls: true
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>loadbalancer</code> type services and loadbalancers are created for each Kafka broker, as well as an external <em>bootstrap service</em>.
The bootstrap service routes external traffic to all Kafka brokers.
DNS names and IP addresses used for connection are propagated to the <code>status</code> of each service.</p>
</div>
<div class="paragraph">
<p>The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the <code>Kafka</code> resource.</p>
</div>
</li>
<li>
<p>Retrieve the address of the bootstrap service you can use to access the Kafka cluster from the status of the <code>Kafka</code> resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>KAFKA-CLUSTER-NAME</em> -o=jsonpath='{.status.listeners[?(@.type=="external")].bootstrapServers}{"\n"}'</code></pre>
</div>
</div>
</li>
<li>
<p>If TLS encryption is enabled, extract the public certificate of the broker certification authority.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-accessing-kafka-using-ingress-str"><a class="link" href="#proc-accessing-kafka-using-ingress-str">3.3. Accessing Kafka using ingress</a></h3>
<div class="paragraph">
<p>This procedure shows how to access a Strimzi Kafka cluster from an external client outside of Kubernetes using Nginx Ingress.</p>
</div>
<div class="paragraph">
<p>To connect to a broker, you need a hostname (advertised address) for the Ingress <em>bootstrap address</em>,
as well as the certificate used for authentication.</p>
</div>
<div class="paragraph">
<p>For access using Ingress, the port is always 443.</p>
</div>
<div class="paragraph">
<div class="title">TLS passthrough</div>
<p>Kafka uses a binary protocol over TCP, but the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a> is designed to work with the HTTP protocol.
To be able to pass the Kafka connections through the Ingress, Strimzi uses the TLS passthrough feature of the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.
Ensure TLS passthrough is enabled in your <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a> deployment.</p>
</div>
<div class="paragraph">
<p>Because it is using the TLS passthrough functionality, TLS encryption cannot be disabled when exposing Kafka using <code>Ingress</code>.</p>
</div>
<div class="paragraph">
<p>For more information about enabling TLS passthrough, see <a href="https://kubernetes.github.io/ingress-nginx/user-guide/tls/#ssl-passthrough">TLS passthrough documentation</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kubernetes cluster</p>
</li>
<li>
<p>Deployed <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a> with TLS passthrough enabled</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure a <code>Kafka</code> resource with an external listener set to the <code>ingress</code> type.</p>
<div class="paragraph">
<p>Specify the Ingress hosts for the bootstrap service and Kafka brokers.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: external
        port: 9094
        type: ingress
        tls: true
        authentication:
          type: tls
        configuration: <b class="conum">(1)</b>
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Ingress hosts for the bootstrap service and Kafka brokers.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterIP</code> type services are created for each Kafka broker, as well as an additional <em>bootstrap service</em>.
These services are used by the Ingress controller to route traffic to the Kafka brokers.
An <code>Ingress</code> resource is also created for each service to expose them using the Ingress controller.
The Ingress hosts are propagated to the <code>status</code> of each service.</p>
</div>
<div class="paragraph">
<p>The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>Use the address for the bootstrap host you specified in the <code>configuration</code> and port 443 (<em>BOOTSTRAP-HOST:443</em>) in your Kafka client as the <em>bootstrap address</em> to connect to the Kafka cluster.</p>
</div>
</li>
<li>
<p>Extract the public certificate of the broker certificate authority.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure the TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-accessing-kafka-using-routes-str"><a class="link" href="#proc-accessing-kafka-using-routes-str">3.4. Accessing Kafka using OpenShift routes</a></h3>
<div class="paragraph">
<p>This procedure describes how to access a Strimzi Kafka cluster from an external client outside of OpenShift using routes.</p>
</div>
<div class="paragraph">
<p>To connect to a broker, you need a hostname for the route <em>bootstrap address</em>,
as well as the certificate used for TLS encryption.</p>
</div>
<div class="paragraph">
<p>For access using routes, the port is always 443.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An OpenShift cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure a <code>Kafka</code> resource with an external listener set to the <code>route</code> type.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  labels:
    app: my-cluster
  name: my-cluster
  namespace: myproject
spec:
  kafka:
    # ...
    listeners:
      - name: listener1
        port: 9094
        type: route
        tls: true
        # ...
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
An OpenShift Route address comprises the name of the Kafka cluster, the name of the listener, and the name of the namespace it is created in.
For example, <code>my-cluster-kafka-listener1-bootstrap-myproject</code> (<em>CLUSTER-NAME</em>-kafka-<em>LISTENER-NAME</em>-bootstrap-<em>NAMESPACE</em>). Be careful that the whole length of the address does not exceed a maximum limit of 63 characters.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterIP</code> type services are created for each Kafka broker, as well as an external <em>bootstrap service</em>.
The services route the traffic from the OpenShift Routes to the Kafka brokers.
An OpenShift <code>Route</code> resource is also created for each service to expose them using the HAProxy load balancer.
DNS addresses used for connection are propagated to the <code>status</code> of each service.</p>
</div>
<div class="paragraph">
<p>The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the <code>Kafka</code> resource.</p>
</div>
</li>
<li>
<p>Retrieve the address of the bootstrap service you can use to access the Kafka cluster from the status of the <code>Kafka</code> resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>KAFKA-CLUSTER-NAME</em> -o=jsonpath='{.status.listeners[?(@.type=="external")].bootstrapServers}{"\n"}'</code></pre>
</div>
</div>
</li>
<li>
<p>Extract the public certificate of the broker certification authority.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the extracted certificate in your Kafka client to configure TLS connection.
If you enabled any authentication, you will also need to configure SASL or TLS authentication.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-securing-access-str"><a class="link" href="#assembly-securing-access-str">4. Managing secure access to Kafka</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can secure your Kafka cluster by managing the access each client has to the Kafka brokers.</p>
</div>
<div class="paragraph">
<p>A secure connection between Kafka brokers and clients can encompass:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Encryption for data exchange</p>
</li>
<li>
<p>Authentication to prove identity</p>
</li>
<li>
<p>Authorization to allow or decline actions executed by users</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This chapter explains how to set up secure connections between Kafka brokers and clients, with sections describing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Security options for Kafka clusters and clients</p>
</li>
<li>
<p>How to secure Kafka brokers</p>
</li>
<li>
<p>How to use an authorization server for OAuth 2.0 token-based authentication and authorization</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="assembly-securing-kafka-brokers-str"><a class="link" href="#assembly-securing-kafka-brokers-str">4.1. Security options for Kafka</a></h3>
<div class="paragraph">
<p>Use the <code>Kafka</code> resource to configure the mechanisms used for Kafka authentication and authorization.</p>
</div>
<div class="sect3">
<h4 id="con-securing-kafka-authentication-str"><a class="link" href="#con-securing-kafka-authentication-str">4.1.1. Listener authentication</a></h4>
<div class="paragraph">
<p>For clients inside the Kubernetes cluster, you can create <code>plain</code> (without encryption) or <code>tls</code> <em>internal</em> listeners.</p>
</div>
<div class="paragraph">
<p>For clients outside the Kubernetes cluster, you create <em>external</em> listeners and specify a connection mechanism,
which can be <code>nodeport</code>, <code>loadbalancer</code>, <code>ingress</code> or <code>route</code> (on OpenShift).</p>
</div>
<div class="paragraph">
<p>For more information on the configuration options for connecting an external client, see <a href="#assembly-configuring-external-listeners-str">Configuring external listeners</a>.</p>
</div>
<div class="paragraph">
<p>Supported authentication options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mutual TLS authentication (only on the listeners with TLS enabled encryption)</p>
</li>
<li>
<p>SCRAM-SHA-512 authentication</p>
</li>
<li>
<p><a href="#assembly-oauth-authentication_str">OAuth 2.0 token based authentication</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The authentication option you choose depends on how you wish to authenticate client access to Kafka brokers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/listener-config-options.svg" alt="options for listener authentication configuration">
</div>
<div class="title">Figure 3. Kafka listener authentication options</div>
</div>
<div class="paragraph">
<p>The listener <code>authentication</code> property is used to specify an authentication mechanism specific to that listener.</p>
</div>
<div class="paragraph">
<p>If no <code>authentication</code> property is specified then the listener does not authenticate clients which connect through that listener.
The listener will accept all connections without authentication.</p>
</div>
<div class="paragraph">
<p>Authentication must be configured when using the User Operator to manage <code>KafkaUsers</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>plain</code> listener configured for SCRAM-SHA-512 authentication</p>
</li>
<li>
<p>A <code>tls</code> listener with mutual TLS authentication</p>
</li>
<li>
<p>An <code>external</code> listener with mutual TLS authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each listener is configured with a unique name and port within a Kafka cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Listeners cannot be configured to use the ports set aside for interbroker communication (9091) and metrics (9404).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example showing listener authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  - name: plain
    port: 9092
    type: internal
    tls: true
    authentication:
      type: scram-sha-512
  - name: tls
    port: 9093
    type: internal
    tls: true
    authentication:
      type: tls
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
# ...</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="con-mutual-tls-authentication-str"><a class="link" href="#con-mutual-tls-authentication-str">Mutual TLS authentication</a></h5>
<div class="paragraph">
<p>Mutual TLS authentication is always used for the communication between Kafka brokers and ZooKeeper pods.</p>
</div>
<div class="paragraph">
<p>Strimzi can configure Kafka to use TLS (Transport Layer Security) to provide encrypted communication between Kafka brokers and clients either with or without mutual authentication.
For mutual, or two-way, authentication, both the server and the client present certificates.
When you configure mutual authentication, the broker authenticates the client (client authentication) and the client authenticates the broker (server authentication).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS authentication is more commonly one-way, with one party authenticating the identity of another.
For example, when HTTPS is used between a web browser and a web server, the browser obtains proof of the identity of the web server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="con-scram-sha-authentication-str"><a class="link" href="#con-scram-sha-authentication-str">SCRAM-SHA-512 authentication</a></h5>
<div class="paragraph">
<p>SCRAM (Salted Challenge Response Authentication Mechanism) is an authentication protocol that can establish mutual authentication using passwords.
Strimzi can configure Kafka to use SASL (Simple Authentication and Security Layer) SCRAM-SHA-512 to provide authentication on both unencrypted and encrypted client connections.</p>
</div>
<div class="paragraph">
<p>When SCRAM-SHA-512 authentication is used with a TLS client connection, the TLS protocol provides the encryption, but is not used for authentication.</p>
</div>
<div class="paragraph">
<p>The following properties of SCRAM make it safe to use SCRAM-SHA-512 even on unencrypted connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The passwords are not sent in the clear over the communication channel.
Instead the client and the server are each challenged by the other to offer proof that they know the password of the authenticating user.</p>
</li>
<li>
<p>The server and client each generate a new challenge for each authentication exchange.
This means that the exchange is resilient against replay attacks.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a <code>KafkaUser.spec.authentication.type</code> is configured with <code>scram-sha-512</code> the User Operator will generate a random 12-character password consisting of upper and lowercase ASCII letters and numbers.</p>
</div>
</div>
<div class="sect4">
<h5 id="assembly-kafka-broker-listener-network-policies-str"><a class="link" href="#assembly-kafka-broker-listener-network-policies-str">Network policies</a></h5>
<div class="paragraph">
<p>Strimzi automatically creates a <code>NetworkPolicy</code> resource for every listener that is enabled on a Kafka broker.
By default, a <code>NetworkPolicy</code> grants access to a listener to all applications and namespaces.</p>
</div>
<div class="paragraph">
<p>If you want to restrict access to a listener at the network level to only selected applications or namespaces,
use the <code>networkPolicyPeers</code> property.</p>
</div>
<div class="paragraph">
<p>Use network policies as part of the listener authentication configuration.
Each listener can have a different <code>networkPolicyPeers</code> configuration.</p>
</div>
<div class="paragraph">
<p>For more information, refer to the <a href="#configuration-listener-network-policy-reference">Listener network policies</a> section and the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io" target="_blank" rel="noopener">NetworkPolicyPeer API reference</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Your configuration of Kubernetes must support ingress <code>NetworkPolicies</code> in order to use network policies in Strimzi.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="additional_listener_configuration_options"><a class="link" href="#additional_listener_configuration_options">Additional listener configuration options</a></h5>
<div class="paragraph">
<p>You can use the properties of the <a href="#type-GenericKafkaListenerConfiguration-reference">GenericKafkaListenerConfiguration schema</a> to add further configuration to listeners.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-securing-kafka-authorization-str"><a class="link" href="#con-securing-kafka-authorization-str">4.1.2. Kafka authorization</a></h4>
<div class="paragraph">
<p>You can configure authorization for Kafka brokers using the <code>authorization</code> property in the <code>Kafka.spec.kafka</code> resource.
If the <code>authorization</code> property is missing, no authorization is enabled and clients have no restrictions.
When enabled, authorization is applied to all enabled listeners.
The authorization method is defined in the <code>type</code> field.</p>
</div>
<div class="paragraph">
<p>Supported authorization options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#type-KafkaAuthorizationSimple-reference">Simple authorization</a></p>
</li>
<li>
<p><a href="#assembly-oauth-authorization_str">OAuth 2.0 authorization</a> (if you are using OAuth 2.0 token based authentication)</p>
</li>
<li>
<p><a href="#type-KafkaAuthorizationOpa-reference">Open Policy Agent (OPA) authorization</a></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/kafka-authorization-config-options.svg" alt="options for kafks authorization configuration">
</div>
<div class="title">Figure 4. Kafka cluster authorization options</div>
</div>
<div class="sect4">
<h5 id="super_users"><a class="link" href="#super_users">Super users</a></h5>
<div class="paragraph">
<p>Super users can access all resources in your Kafka cluster regardless of any access restrictions,
and are supported by all authorization mechanisms.</p>
</div>
<div class="paragraph">
<p>To designate super users for a Kafka cluster, add a list of user principals to the <code>superUsers</code> property.
If a user uses TLS client authentication, their username is the common name from their certificate subject prefixed with <code>CN=</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example configuration with super users</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authorization:
  type: simple
  superUsers:
    - CN=client_1
    - user_2
    - CN=client_3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-securing-kafka-clients-str"><a class="link" href="#assembly-securing-kafka-clients-str">4.2. Security options for Kafka clients</a></h3>
<div class="paragraph">
<p>Use the <code>KafkaUser</code> resource to configure the authentication mechanism, authorization mechanism, and access rights for Kafka clients.
In terms of configuring security, clients are represented as users.</p>
</div>
<div class="paragraph">
<p>You can authenticate and authorize user access to Kafka brokers.
Authentication permits access, and authorization constrains the access to permissible actions.</p>
</div>
<div class="paragraph">
<p>You can also create <em>super users</em> that have unconstrained access to Kafka brokers.</p>
</div>
<div class="paragraph">
<p>The authentication and authorization mechanisms must match the <a href="#proc-securing-kafka-str">specification for the listener used to access the Kafka brokers</a>.</p>
</div>
<div class="sect3">
<h4 id="con-securing-client-labels-str"><a class="link" href="#con-securing-client-labels-str">4.2.1. Identifying a Kafka cluster for user handling</a></h4>
<div class="paragraph">
<p>A <code>KafkaUser</code> resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the <code>Kafka</code> resource) to which it belongs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label is used by the User Operator to identify the <code>KafkaUser</code> resource and create a new user, and also in subsequent handling of the user.</p>
</div>
<div class="paragraph">
<p>If the label does not match the Kafka cluster, the User Operator cannot identify the <code>KafkaUser</code> and the user is not created.</p>
</div>
<div class="paragraph">
<p>If the status of the <code>KafkaUser</code> resource remains empty, check your label.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-securing-client-authentication-str"><a class="link" href="#con-securing-client-authentication-str">4.2.2. User authentication</a></h4>
<div class="paragraph">
<p>User authentication is configured using the <code>authentication</code> property in <code>KafkaUser.spec</code>.
The authentication mechanism enabled for the user is specified using the <code>type</code> field.</p>
</div>
<div class="paragraph">
<p>Supported authentication mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS client authentication</p>
</li>
<li>
<p>SCRAM-SHA-512 authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When no authentication mechanism is specified, the User Operator does not create the user or its credentials.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-securing-kafka-authentication-str">When to use mutual TLS authentication or SCRAM-SHA Authentication authentication for clients</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="tls_client_authentication"><a class="link" href="#tls_client_authentication">TLS Client Authentication</a></h5>
<div class="paragraph">
<p>To use TLS client authentication, you set the <code>type</code> field to <code>tls</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code> with TLS client authentication enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user is created by the User Operator, it creates a new Secret with the same name as the <code>KafkaUser</code> resource.
The Secret contains a private and public key for TLS client authentication.
The public key is contained in a user certificate, which is signed by the client Certificate Authority (CA).</p>
</div>
<div class="paragraph">
<p>All keys are in X.509 format.</p>
</div>
<div class="paragraph">
<p>Secrets provide private keys and certificates in PEM and PKCS #12 formats.</p>
</div>
<div class="paragraph">
<p>For more information on securing Kafka communication with Secrets, see <a href="#security-str">Managing TLS certificates</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>Secret</code> with user credentials</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-user
  labels:
    strimzi.io/kind: KafkaUser
    strimzi.io/cluster: my-cluster
type: Opaque
data:
  ca.crt: # Public key of the client CA
  user.crt: # User certificate that contains the public key of the user
  user.key: # Private key of the user
  user.p12: # PKCS #12 archive file for storing certificates and keys
  user.password: # Password for protecting the PKCS #12 archive file</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="scram_sha_512_authentication"><a class="link" href="#scram_sha_512_authentication">SCRAM-SHA-512 Authentication</a></h5>
<div class="paragraph">
<p>To use the SCRAM-SHA-512 authentication mechanism, you set the <code>type</code> field to <code>scram-sha-512</code>.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code> with SCRAM-SHA-512 authentication enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: scram-sha-512
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user is created by the User Operator, it creates a new secret with the same name as the <code>KafkaUser</code> resource.
The secret contains the generated password in the <code>password</code> key, which is encoded with base64.
In order to use the password, it must be decoded.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>Secret</code> with user credentials</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-user
  labels:
    strimzi.io/kind: KafkaUser
    strimzi.io/cluster: my-cluster
type: Opaque
data:
  password: Z2VuZXJhdGVkcGFzc3dvcmQ= <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The generated password, base64 encoded.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Decoding the generated password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo "Z2VuZXJhdGVkcGFzc3dvcmQ=" | base64 --decode</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-securing-client-authorization-str"><a class="link" href="#con-securing-client-authorization-str">4.2.3. User authorization</a></h4>
<div class="paragraph">
<p>User authorization is configured using the <code>authorization</code> property in <code>KafkaUser.spec</code>.
The authorization type enabled for a user is specified using the <code>type</code> field.</p>
</div>
<div class="paragraph">
<p>To use simple authorization, you set the <code>type</code> property to <code>simple</code> in <code>KafkaUser.spec.authorization</code>.
Simple authorization uses the default Kafka authorization plugin, <code>AclAuthorizer</code>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use <a href="#type-KafkaAuthorizationOpa-reference">OPA authorization</a>,
or if you are already using OAuth 2.0 token based authentication,
you can also use <a href="#assembly-oauth-authorization_str">OAuth 2.0 authorization</a>.</p>
</div>
<div class="paragraph">
<p>If no authorization is specified, the User Operator does not provision any access rights for the user.
Whether such a <code>KafkaUser</code> can still access resources depends on the authorizer being used.
For example, for the <code>AclAuthorizer</code> this is determined by its <code>allow.everyone.if.no.acl.found</code> configuration.</p>
</div>
<div class="sect4">
<h5 id="acl_rules"><a class="link" href="#acl_rules">ACL rules</a></h5>
<div class="paragraph">
<p><code>AclAuthorizer</code> uses ACL rules to manage access to Kafka brokers.</p>
</div>
<div class="paragraph">
<p>ACL rules grant access rights to the user, which you specify in the <code>acls</code> property.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>AclRule</code> object, see the <a href="#type-AclRule-reference"><code>AclRule</code> schema reference</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="super_user_access_to_kafka_brokers"><a class="link" href="#super_user_access_to_kafka_brokers">Super user access to Kafka brokers</a></h5>
<div class="paragraph">
<p>If a user is added to a list of super users in a Kafka broker configuration,
the user is allowed unlimited access to the cluster regardless of any authorization constraints defined in ACLs in <code>KafkaUser</code>.</p>
</div>
<div class="paragraph">
<p>For more information on configuring super user access to brokers, see <a href="#con-securing-kafka-authorization-str">Kafka authorization</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="user_quotas"><a class="link" href="#user_quotas">User quotas</a></h5>
<div class="paragraph">
<p>You can configure the <code>spec</code> for the <code>KafkaUser</code> resource to enforce quotas so that a user does not exceed access to Kafka brokers based on a byte threshold or a time limit of CPU utilization.</p>
</div>
<div class="listingblock">
<div class="title">An example <code>KafkaUser</code> with user quotas</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  quotas:
    producerByteRate: 1048576 <b class="conum">(1)</b>
    consumerByteRate: 2097152 <b class="conum">(2)</b>
    requestPercentage: 55 <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Byte-per-second quota on the amount of data the user can push to a Kafka broker</p>
</li>
<li>
<p>Byte-per-second quota on the amount of data the user can fetch from a Kafka broker</p>
</li>
<li>
<p>CPU utilization limit as a percentage of time for a client group</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on these properties, see the <a href="#type-KafkaUserQuotas-reference"><code>KafkaUserQuotas</code> schema reference</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-securing-kafka-str"><a class="link" href="#assembly-securing-kafka-str">4.3. Securing access to Kafka brokers</a></h3>
<div class="paragraph">
<p>To establish secure access to Kafka brokers, you configure and apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>Kafka</code> resource to:</p>
<div class="ulist">
<ul>
<li>
<p>Create listeners with a specified authentication type</p>
</li>
<li>
<p>Configure authorization for the whole Kafka cluster</p>
</li>
</ul>
</div>
</li>
<li>
<p>A <code>KafkaUser</code> resource to access the Kafka brokers securely through the listeners</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configure the <code>Kafka</code> resource to set up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Listener authentication</p>
</li>
<li>
<p>Network policies that restrict access to Kafka listeners</p>
</li>
<li>
<p>Kafka authorization</p>
</li>
<li>
<p>Super users for unconstrained access to brokers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Authentication is configured independently for each listener.
Authorization is always configured for the whole Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator creates the listeners and sets up the cluster and client certificate authority (CA) certificates to enable authentication within the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>You can replace the certificates generated by the Cluster Operator by <a href="./using.html#installing-your-own-ca-certificates-str" target="_blank" rel="noopener">installing your own certificates</a>.
You can also <a href="./using.html#kafka-listener-certificates-str" target="_blank" rel="noopener">configure your listener to use a Kafka listener certificate managed by an external Certificate Authority</a>.
Certificates are available in PKCS #12 format (.p12) and PEM (.crt) formats.</p>
</div>
<div class="paragraph">
<p>Use <code>KafkaUser</code> to enable the authentication and authorization mechanisms that a specific client uses to access Kafka.</p>
</div>
<div class="paragraph">
<p>Configure the <code>KafkaUser</code> resource to set up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication to match the enabled listener authentication</p>
</li>
<li>
<p>Authorization to match the enabled Kafka authorization</p>
</li>
<li>
<p>Quotas to control the use of resources by clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The User Operator creates the user representing the client and the security credentials used for client authentication, based on the chosen authentication type.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information about the schema for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka</code>, see the <a href="#type-Kafka-reference"><code>Kafka</code> schema reference</a>.</p>
</li>
<li>
<p><code>KafkaUser</code>, see the <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-securing-kafka-str"><a class="link" href="#proc-securing-kafka-str">4.3.1. Securing Kafka brokers</a></h4>
<div class="paragraph">
<p>This procedure shows the steps involved in securing Kafka brokers when running Strimzi.</p>
</div>
<div class="paragraph">
<p>The security implemented for Kafka brokers must be compatible with the security implemented for the clients requiring access.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka.listeners[*].authentication</code> matches <code>KafkaUser.spec.authentication</code></p>
</li>
<li>
<p><code>Kafka.spec.kafka.authorization</code> matches <code>KafkaUser.spec.authorization</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The steps show the configuration for simple authorization and a listener using TLS authentication.
For more information on listener configuration, see <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use SCRAM-SHA or OAuth 2.0 for <a href="#con-securing-kafka-authentication-str">listener authentication</a>,
and OAuth 2.0 or OPA for <a href="#con-securing-kafka-authorization-str">Kafka authorization</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>Kafka</code> resource.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Configure the <code>authorization</code> property for authorization.</p>
</li>
<li>
<p>Configure the <code>listeners</code> property to create a listener with authentication.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    authorization: <b class="conum">(1)</b>
      type: simple
      superUsers: <b class="conum">(2)</b>
        - CN=client_1
        - user_2
        - CN=client_3
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls <b class="conum">(3)</b>
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Authorization <a href="#con-securing-kafka-authorization-str">enables <code>simple</code> authorization on the Kafka broker using the <code>AclAuthorizer</code> Kafka plugin</a>.</p>
</li>
<li>
<p>List of user principals with unlimited access to Kafka. <em>CN</em> is the common name from the client certificate when TLS authentication is used.</p>
</li>
<li>
<p>Listener authentication mechanisms may be configured for each listener, and <a href="#assembly-securing-kafka-brokers-str">specified as mutual TLS, SCRAM-SHA-512 or token-based OAuth 2.0</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are configuring an external listener, the configuration is dependent on the chosen connection mechanism.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the <code>Kafka</code> resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kafka cluster is configured with a Kafka broker listener using TLS authentication.</p>
</div>
<div class="paragraph">
<p>A service is created for each Kafka broker pod.</p>
</div>
<div class="paragraph">
<p>A service is created to serve as the <em>bootstrap address</em> for connection to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The cluster CA certificate to verify the identity of the kafka brokers is also created with the same name as the <code>Kafka</code> resource.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-user-str"><a class="link" href="#proc-configuring-kafka-user-str">4.3.2. Securing user access to Kafka</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>KafkaUser</code> resource to configure a Kafka user.</p>
</div>
<div class="paragraph">
<p>You can use <code>kubectl apply</code> to create or modify users, and <code>kubectl delete</code> to delete existing users.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubectl apply -f <em>USER-CONFIG-FILE</em></code></p>
</li>
<li>
<p><code>kubectl delete KafkaUser <em>USER-NAME</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you configure the <code>KafkaUser</code> authentication and authorization mechanisms, ensure they match the equivalent <code>Kafka</code> configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KafkaUser.spec.authentication</code> matches <code>Kafka.spec.kafka.listeners[*].authentication</code></p>
</li>
<li>
<p><code>KafkaUser.spec.authorization</code> matches <code>Kafka.spec.kafka.authorization</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure shows how a user is created with TLS authentication.
You can also create a user with SCRAM-SHA authentication.</p>
</div>
<div class="paragraph">
<p>The authentication required depends on the <a href="#con-securing-kafka-authentication-str">type of authentication configured for the Kafka broker listener</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Authentication between Kafka users and Kafka brokers depends on the authentication settings for each.
For example, it is not possible to authenticate a user with TLS if it is not also enabled in the Kafka configuration.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster <a href="#con-mutual-tls-authentication-str">configured with a Kafka broker listener using TLS authentication and encryption</a>.</p>
</li>
<li>
<p>A running User Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The authentication type in <code>KafkaUser</code> should match the authentication configured in <code>Kafka</code> brokers.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>KafkaUser</code> resource.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication: <b class="conum">(1)</b>
    type: tls
  authorization:
    type: simple <b class="conum">(2)</b>
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: literal
        operation: Read</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>User authentication mechanism, defined as mutual <code>tls</code> or <code>scram-sha-512</code>.</p>
</li>
<li>
<p>Simple authorization, which requires an accompanying list of ACL rules.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the <code>KafkaUser</code> resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>USER-CONFIG-FILE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The user is created, as well as a Secret with the same name as the <code>KafkaUser</code> resource.
The Secret contains a private and public key for TLS client authentication.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For information on configuring a Kafka client with properties for secure connection to Kafka brokers, see <a href="./deploying.html#setup-external-clients-str" target="_blank" rel="noopener">Setting up access for clients outside of Kubernetes</a> in the <em>Deploying Strimzi Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-restricting-access-to-listeners-using-network-policies-str"><a class="link" href="#proc-restricting-access-to-listeners-using-network-policies-str">4.3.3. Restricting access to Kafka listeners using network policies</a></h4>
<div class="paragraph">
<p>You can restrict access to a listener to only selected applications by using the <code>networkPolicyPeers</code> property.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster with support for Ingress NetworkPolicies.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open the <code>Kafka</code> resource.</p>
</li>
<li>
<p>In the <code>networkPolicyPeers</code> property, define the application pods or namespaces that will be allowed to access the Kafka cluster.</p>
<div class="paragraph">
<p>For example, to configure a <code>tls</code> listener to allow connections only from application pods with the label <code>app</code> set to <code>kafka-client</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
        networkPolicyPeers:
          - podSelector:
              matchLabels:
                app: kafka-client
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</li>
<li>
<p>Create or update the resource.</p>
<div class="paragraph">
<p>Use <code>kubectl apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the schema, see the <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io" target="_blank" rel="noopener">NetworkPolicyPeer API reference</a> and the <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-oauth-authentication_str"><a class="link" href="#assembly-oauth-authentication_str">4.4. Using OAuth 2.0 token-based authentication</a></h3>
<div class="paragraph">
<p>Strimzi supports the use of OAuth 2.0 authentication using the <em>SASL OAUTHBEARER</em> mechanism.</p>
</div>
<div class="paragraph">
<p>OAuth 2.0 enables standardized token-based authentication and authorization between applications, using a central authorization server to issue tokens that grant limited access to resources.</p>
</div>
<div class="paragraph">
<p>You can configure OAuth 2.0 authentication, then <a href="#assembly-oauth-authorization_str">OAuth 2.0 authorization</a>.</p>
</div>
<div class="paragraph">
<p>OAuth 2.0 authentication can also be used in conjunction with <code>simple</code> or OPA-based <a href="#con-securing-kafka-authorization-str">Kafka authorization</a>.</p>
</div>
<div class="paragraph">
<p>Using OAuth 2.0 token-based authentication, application clients can access resources on application servers (called <em>resource servers</em>) without exposing account credentials.</p>
</div>
<div class="paragraph">
<p>The application client passes an access token as a means of authenticating, which application servers can also use to determine the level of access to grant.
The authorization server handles the granting of access and inquiries about access.</p>
</div>
<div class="paragraph">
<p>In the context of Strimzi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka brokers act as OAuth 2.0 resource servers</p>
</li>
<li>
<p>Kafka clients act as OAuth 2.0 application clients</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Kafka clients authenticate to Kafka brokers.
The brokers and clients communicate with the OAuth 2.0 authorization server, as necessary, to obtain or validate access tokens.</p>
</div>
<div class="paragraph">
<p>For a deployment of Strimzi, OAuth 2.0 integration provides:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server-side OAuth 2.0 support for Kafka brokers</p>
</li>
<li>
<p>Client-side OAuth 2.0 support for Kafka MirrorMaker, Kafka Connect and the Kafka Bridge</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://oauth.net/2/" target="_blank" rel="noopener">OAuth 2.0 site</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-flow-str"><a class="link" href="#con-oauth-authentication-flow-str">4.4.1. OAuth 2.0 authentication mechanism</a></h4>
<div class="paragraph">
<p>The Kafka <em>SASL OAUTHBEARER</em> mechanism is used to establish authenticated sessions with a Kafka broker.</p>
</div>
<div class="paragraph">
<p>A Kafka client initiates a session with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism for credentials exchange, where credentials take the form of an access token.</p>
</div>
<div class="paragraph">
<p>Kafka brokers and clients need to be configured to use OAuth 2.0.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-broker-str"><a class="link" href="#con-oauth-authentication-broker-str">4.4.2. OAuth 2.0 Kafka broker configuration</a></h4>
<div class="paragraph">
<p>Kafka broker configuration for OAuth 2.0 involves:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating the OAuth 2.0 client in the authorization server</p>
</li>
<li>
<p>Configuring OAuth 2.0 authentication in the Kafka custom resource</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In relation to the authorization server, Kafka brokers and Kafka clients are both regarded as OAuth 2.0 clients.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="oauth_2_0_client_configuration_on_an_authorization_server"><a class="link" href="#oauth_2_0_client_configuration_on_an_authorization_server">OAuth 2.0 client configuration on an authorization server</a></h5>
<div class="paragraph">
<p>To configure a Kafka broker to validate the token received during session initiation,
the recommended approach is to create an OAuth 2.0 <em>client</em> definition in an authorization server, configured as <em>confidential</em>, with the following client credentials enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID of <code>kafka</code> (for example)</p>
</li>
<li>
<p>Client ID and Secret as the authentication mechanism</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You only need to use a client ID and secret when using a non-public introspection endpoint of the authorization server.
The credentials are not typically required when using public authorization server endpoints, as with fast local JWT token validation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="oauth_2_0_authentication_configuration_in_the_kafka_cluster"><a class="link" href="#oauth_2_0_authentication_configuration_in_the_kafka_cluster">OAuth 2.0 authentication configuration in the Kafka cluster</a></h5>
<div class="paragraph">
<p>To use OAuth 2.0 authentication in the Kafka cluster, you specify, for example, a TLS listener configuration for your Kafka cluster custom resource with the authentication method <code>oauth</code>:</p>
</div>
<div class="listingblock">
<div class="title">Assigining the authentication method type for OAuth 2.0</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: <strong>oauth</strong>
      #...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure <code>plain</code>, <code>tls</code> and <code>external</code> listeners,
but it is recommended not to use <code>plain</code> listeners or <code>external</code> listeners with disabled TLS encryption with OAuth 2.0 as this creates a vulnerability to network eavesdropping and unauthorized access through token theft.</p>
</div>
<div class="paragraph">
<p>You configure an <code>external</code> listener with <code>type: oauth</code> for a secure transport layer to communicate with the client.</p>
</div>
<div class="listingblock">
<div class="title">Using OAuth 2.0 with an external listener</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: <strong>oauth</strong>
    #...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>tls</code> property is <em>false</em> by default, so it must be enabled.</p>
</div>
<div class="paragraph">
<p>When you have defined the type of authentication as OAuth 2.0, you add configuration based on the type of validation, either as <a href="#con-oauth-authentication-broker-fast-local">fast local JWT validation</a> or <a href="#con-oauth-authentication-broker-intro-local">token validation using an introspection endpoint</a>.</p>
</div>
<div class="paragraph">
<p>The procedure to configure OAuth 2.0 for listeners, with descriptions and examples, is described in <a href="#proc-oauth-authentication-broker-config-str">Configuring OAuth 2.0 support for Kafka brokers</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-oauth-authentication-broker-fast-local"><a class="link" href="#con-oauth-authentication-broker-fast-local">Fast local JWT token validation configuration</a></h5>
<div class="paragraph">
<p>Fast local JWT token validation checks a JWT token signature locally.</p>
</div>
<div class="paragraph">
<p>The local check ensures that a token:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Conforms to type by containing a (<em>typ</em>) claim value of <code>Bearer</code> for an access token</p>
</li>
<li>
<p>Is valid (not expired)</p>
</li>
<li>
<p>Has an issuer that matches a <code>validIssuerURI</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You specify a <code>validIssuerURI</code> attribute when you configure the listener, so that any tokens not issued by the authorization server are rejected.</p>
</div>
<div class="paragraph">
<p>The authorization server does not need to be contacted during fast local JWT token validation.
You activate fast local JWT token validation by specifying a <code>jwksEndpointUri</code> attribute, the endpoint exposed by the OAuth 2.0 authorization server.
The endpoint contains the public keys used to validate signed JWT tokens, which are sent as credentials by Kafka clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
All communication with the authorization server should be performed using TLS encryption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure a certificate truststore as a Kubernetes Secret in your Strimzi project namespace, and use a <code>tlsTrustedCertificates</code> attribute to point to the Kubernetes Secret containing the truststore file.</p>
</div>
<div class="paragraph">
<p>You might want to configure a <code>userNameClaim</code> to properly extract a username from the JWT token.
If you want to use Kafka ACL authorization, you need to identify the user by their username during authentication.
(The <code>sub</code> claim in JWT tokens is typically a unique ID, not a username.)</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for fast local JWT token validation</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    #...
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: <strong>oauth</strong>
          validIssuerUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/tls</em>&gt;
          jwksEndpointUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/tls/protocol/openid-connect/certs</em>&gt;
          userNameClaim: preferred_username
          maxSecondsWithoutReauthentication: 3600
          tlsTrustedCertificates:
          - secretName: oauth-server-cert
            certificate: ca.crt
    #...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-oauth-authentication-broker-intro-local"><a class="link" href="#con-oauth-authentication-broker-intro-local">OAuth 2.0 introspection endpoint configuration</a></h5>
<div class="paragraph">
<p>Token validation using an OAuth 2.0 introspection endpoint treats a received access token as opaque.
The Kafka broker sends an access token to the introspection endpoint, which responds with the token information necessary for validation.
Importantly, it returns up-to-date information if the specific access token is valid, and also information about when the token expires.</p>
</div>
<div class="paragraph">
<p>To configure OAuth 2.0 introspection-based validation, you specify an <code>introspectionEndpointUri</code> attribute rather than the <code>jwksEndpointUri</code> attribute specified for fast local JWT token validation.
Depending on the authorization server, you typically have to specify a <code>clientId</code> and <code>clientSecret</code>, because the introspection endpoint is usually protected.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for an introspection endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    listeners:
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: <strong>oauth</strong>
          clientId: kafka-broker
          clientSecret:
            secretName: my-cluster-oauth
            key: clientSecret
          validIssuerUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/tls</em>&gt;
          introspectionEndpointUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/tls/protocol/openid-connect/token/introspect</em>&gt;
          userNameClaim: preferred_username
          maxSecondsWithoutReauthentication: 3600
          tlsTrustedCertificates:
          - secretName: oauth-server-cert
            certificate: ca.crt</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-reauthentication-str"><a class="link" href="#con-oauth-reauthentication-str">4.4.3. Session re-authentication for Kafka brokers</a></h4>
<div class="paragraph">
<p>The Kafka <em>SASL OAUTHBEARER</em> mechanism, which is used for OAuth 2.0 authentication in Strimzi, supports a Kafka feature called the <em>re-authentication</em> mechanism.</p>
</div>
<div class="paragraph">
<p>When the re-authentication mechanism is enabled in the configuration of an <code>oauth</code> type listener, the broker&#8217;s authenticated session expires when the access token expires.
The client must then re-authenticate to the existing session by sending a new, valid access token to the broker, without dropping the connection.</p>
</div>
<div class="paragraph">
<p>If token validation is successful, a new client session is started using the existing connection.
If the client fails to re-authenticate, the broker will close the connection if further attempts are made to send or receive messages.
Java clients that use Kafka client library 2.2 or later automatically re-authenticate if the re-authentication mechanism is enabled on the broker.</p>
</div>
<div class="paragraph">
<p>You enable session re-authentication in the <code>Kafka</code> resource. Set the <code>maxSecondsWithoutReauthentication</code> property for a TLS listener with <code>type: oauth</code> authentication.
Session re-authentication is supported for both types of token validation (fast local JWT and introspection endpoint). For an example configuration, see <a href="#proc-oauth-authentication-broker-config-str">Configuring OAuth 2.0 support for Kafka brokers</a>.</p>
</div>
<div class="paragraph">
<p>For more information about the re-authentication mechanism, which was added in Kafka version 2.2, see <a href="https://cwiki.apache.org/confluence/display/KAFKA/KIP-368%3A+Allow+SASL+Connections+to+Periodically+Re-Authenticate" target="_blank" rel="noopener">KIP-368</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-oauth-authentication-broker-str">OAuth 2.0 Kafka broker configuration</a></p>
</li>
<li>
<p><a href="#proc-oauth-authentication-broker-config-str">Configuring OAuth 2.0 support for Kafka brokers</a></p>
</li>
<li>
<p><a href="appendix_crds.html#type-KafkaListenerAuthenticationOAuth-reference">KafkaListenerAuthenticationOAuth schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-client-str"><a class="link" href="#con-oauth-authentication-client-str">4.4.4. OAuth 2.0 Kafka client configuration</a></h4>
<div class="paragraph">
<p>A Kafka client is configured with either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The credentials required to obtain a valid access token from an authorization server (client ID and Secret)</p>
</li>
<li>
<p>A valid long-lived access token or refresh token, obtained using tools provided by an authorization server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only information ever sent to the Kafka broker is an access token.
The credentials used to authenticate with the authorization server to obtain the access token are never sent to the broker.</p>
</div>
<div class="paragraph">
<p>When a client obtains an access token, no further communication with the authorization server is needed.</p>
</div>
<div class="paragraph">
<p>The simplest mechanism is authentication with a client ID and Secret.
Using a long-lived access token, or a long-lived refresh token, adds more complexity because there is an additional dependency on authorization server tools.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using long-lived access tokens, you may need to configure the client in the authorization server to increase the maximum lifetime of the token.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the Kafka client is not configured with an access token directly, the client exchanges credentials for an access token during Kafka session initiation by contacting the authorization server.
The Kafka client exchanges either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID and Secret</p>
</li>
<li>
<p>Client ID, refresh token, and (optionally) a Secret</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-authentication-client-options-str"><a class="link" href="#con-oauth-authentication-client-options-str">4.4.5. OAuth 2.0 client authentication flow</a></h4>
<div class="paragraph">
<p>In this section, we explain and visualize the communication flow between Kafka client, Kafka broker, and authorization server during Kafka session initiation.
The flow depends on the client and server configuration.</p>
</div>
<div class="paragraph">
<p>When a Kafka client sends an access token as credentials to a Kafka broker, the token needs to be validated.</p>
</div>
<div class="paragraph">
<p>Depending on the authorization server used, and the configuration options available, you may prefer to use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast local token validation based on JWT signature checking and local token introspection, without contacting the authorization server</p>
</li>
<li>
<p>An OAuth 2.0 introspection endpoint provided by the authorization server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using fast local token validation requires the authorization server to provide a JWKS endpoint with public certificates that are used to validate signatures on the tokens.</p>
</div>
<div class="paragraph">
<p>Another option is to use an OAuth 2.0 introspection endpoint on the authorization server.
Each time a new Kafka broker connection is established, the broker passes the access token received from the client to the authorization server, and checks the response to confirm whether or not the token is valid.</p>
</div>
<div class="paragraph">
<p>Kafka client credentials can also be configured for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct local access using a previously generated long-lived access token</p>
</li>
<li>
<p>Contact with the authorization server for a new access token to be issued</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
An authorization server might only allow the use of opaque access tokens, which means that local token validation is not possible.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="example_client_authentication_flows"><a class="link" href="#example_client_authentication_flows">Example client authentication flows</a></h5>
<div class="paragraph">
<p>Here you can see the communication flows, for different configurations of Kafka clients and brokers, during Kafka session authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#oauth-introspection-endpoint-str">Client using client ID and secret, with broker delegating validation to authorization server</a></p>
</li>
<li>
<p><a href="#oauth-jwt-str">Client using client ID and secret, with broker performing fast local token validation</a></p>
</li>
<li>
<p><a href="#oauth-token-endpoint-str">Client using long-lived access token, with broker delegating validation to authorization server</a></p>
</li>
<li>
<p><a href="#oauth-token-jwt-str">Client using long-lived access token, with broker performing fast local validation</a></p>
</li>
</ul>
</div>
<div id="oauth-introspection-endpoint-str" class="paragraph">
<div class="title">Client using client ID and secret, with broker delegating validation to authorization server</div>
<p><span class="image"><img src="images/oauth-introspection-endpoint.png" alt="Client using client ID and secret with broker delegating validation to authorization server"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client requests access token from authorization server, using client ID and secret, and optionally a refresh token.</p>
</li>
<li>
<p>Authorization server generates a new access token.</p>
</li>
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the access token.</p>
</li>
<li>
<p>Kafka broker validates the access token by calling a token introspection endpoint on authorization server, using its own client ID and secret.</p>
</li>
<li>
<p>Kafka client session is established if the token is valid.</p>
</li>
</ol>
</div>
<div id="oauth-jwt-str" class="paragraph">
<div class="title">Client using client ID and secret, with broker performing fast local token validation</div>
<p><span class="image"><img src="images/oauth-jwt-signature.png" alt="Client using client ID and secret with broker performing fast local token validation"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with authorization server from the token endpoint, using a client ID and secret, and optionally a refresh token.</p>
</li>
<li>
<p>Authorization server generates a new access token.</p>
</li>
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the access token.</p>
</li>
<li>
<p>Kafka broker validates the access token locally using a JWT token signature check, and local token introspection.</p>
</li>
</ol>
</div>
<div id="oauth-token-endpoint-str" class="paragraph">
<div class="title">Client using long-lived access token, with broker delegating validation to authorization server</div>
<p><span class="image"><img src="images/oauth-introspection-endpoint-long-token.png" alt="Client using long-lived access token with broker delegating validation to authorization server"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the long-lived access token.</p>
</li>
<li>
<p>Kafka broker validates the access token by calling a token introspection endpoint on authorization server, using its own client ID and secret.</p>
</li>
<li>
<p>Kafka client session is established if the token is valid.</p>
</li>
</ol>
</div>
<div id="oauth-token-jwt-str" class="paragraph">
<div class="title">Client using long-lived access token, with broker performing fast local validation</div>
<p><span class="image"><img src="images/oauth-jwt-signature-token.png" alt="Client using long-lived access token with broker performing fast local validation"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kafka client authenticates with the Kafka broker using the <em>SASL OAUTHBEARER</em> mechanism to pass the long-lived access token.</p>
</li>
<li>
<p>Kafka broker validates the access token locally using JWT token signature check, and local token introspection.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Fast local JWT token signature validation is suitable only for short-lived tokens as there is no check with the authorization server if a token has been revoked.
Token expiration is written into the token, but revocation can happen at any time, so cannot be accounted for without contacting the authorization server.
Any issued token would be considered valid until it expires.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-strimzi-config-str"><a class="link" href="#con-oauth-strimzi-config-str">4.4.6. Configuring OAuth 2.0 authentication</a></h4>
<div class="paragraph">
<p>OAuth 2.0 is used for interaction between Kafka clients and Strimzi components.</p>
</div>
<div class="paragraph">
<p>In order to use OAuth 2.0 for Strimzi, you must:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#proc-oauth-server-config-str">Configure an OAuth 2.0 authorization server for the Strimzi cluster and Kafka clients</a></p>
</li>
<li>
<p><a href="#proc-oauth-authentication-broker-config-str">Deploy or update the Kafka cluster with Kafka broker listeners configured to use OAuth 2.0</a></p>
</li>
<li>
<p><a href="#proc-oauth-client-config-str">Update your Java-based Kafka clients to use OAuth 2.0</a></p>
</li>
<li>
<p><a href="#proc-oauth-kafka-config-str">Update Kafka component clients to use OAuth 2.0</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="proc-oauth-server-config-str"><a class="link" href="#proc-oauth-server-config-str">Configuring an OAuth 2.0 authorization server</a></h5>
<div class="paragraph">
<p>This procedure describes in general what you need to do to configure an authorization server for integration with Strimzi.</p>
</div>
<div class="paragraph">
<p>These instructions are not product specific.</p>
</div>
<div class="paragraph">
<p>The steps are dependent on the chosen authorization server.
Consult the product documentation for the authorization server for information on how to set up OAuth 2.0 access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you already have an authorization server deployed, you can skip the deployment step and use your current deployment.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Deploy the authorization server to your cluster.</p>
</li>
<li>
<p>Access the CLI or admin console for the authorization server to configure OAuth 2.0 for Strimzi.</p>
<div class="paragraph">
<p>Now prepare the authorization server to work with Strimzi.</p>
</div>
</li>
<li>
<p>Configure a <code>kafka-broker</code> client.</p>
</li>
<li>
<p>Configure clients for each Kafka client component of your application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After deploying and configuring the authorization server, <a href="#proc-oauth-authentication-broker-config-str">configure the Kafka brokers to use OAuth 2.0</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-authentication-broker-config-str"><a class="link" href="#proc-oauth-authentication-broker-config-str">Configuring OAuth 2.0 support for Kafka brokers</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka brokers so that the broker listeners are enabled to use OAuth 2.0 authentication using an authorization server.</p>
</div>
<div class="paragraph">
<p>We advise use of OAuth 2.0 over an encrypted interface through configuration of TLS listeners.
Plain listeners are not recommended.</p>
</div>
<div class="paragraph">
<p>If the authorization server is using certificates signed by the trusted CA and matching the OAuth 2.0 server hostname, TLS connection works using the default settings.
Otherwise, you may need to configure the truststore with prober certificates or disable the certificate hostname validation.</p>
</div>
<div class="paragraph">
<p>When configuring the Kafka broker you have two options for the mechanism used to validate the access token during OAuth 2.0 authentication of the newly connected Kafka client:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#example-1">Configuring fast local JWT token validation</a></p>
</li>
<li>
<p><a href="#example-2">Configuring token validation using an introspection endpoint</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>For more information on the configuration of OAuth 2.0 authentication for Kafka broker listeners, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="appendix_crds.html#type-KafkaListenerAuthenticationOAuth-reference">KafkaListenerAuthenticationOAuth schema reference</a></p>
</li>
<li>
<p><a href="#assembly-securing-access-str">Managing access to Kafka</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka broker configuration (<code>Kafka.spec.kafka</code>) of your <code>Kafka</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka my-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Kafka broker <code>listeners</code> configuration.</p>
<div class="paragraph">
<p>The configuration for each type of listener does not have to be the same, as they are independent.</p>
</div>
<div class="paragraph">
<p>The examples here show the configuration options as configured for external listeners.</p>
</div>
<div class="openblock">
<div class="content">
<div id="example-1" class="listingblock">
<div class="title">Example 1: Configuring fast local JWT token validation</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
- name: external
  port: 9094
  type: loadbalancer
  tls: true
  authentication:
    type: oauth <b class="conum">(1)</b>
    validIssuerUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/external</em>&gt; <b class="conum">(2)</b>
    jwksEndpointUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/external/protocol/openid-connect/certs</em>&gt; <b class="conum">(3)</b>
    userNameClaim: preferred_username <b class="conum">(4)</b>
    maxSecondsWithoutReauthentication: 3600 <b class="conum">(5)</b>
    tlsTrustedCertificates: <b class="conum">(6)</b>
    - secretName: oauth-server-cert
      certificate: ca.crt
    disableTlsHostnameVerification: true <b class="conum">(7)</b>
    jwksExpirySeconds: 360 <b class="conum">(8)</b>
    jwksRefreshSeconds: 300 <b class="conum">(9)</b>
    jwksMinRefreshPauseSeconds: 1 <b class="conum">(10)</b>
    enableECDSA: "true" <b class="conum">(11)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Listener type set to <code>oauth</code>.</p>
</li>
<li>
<p>URI of the token issuer used for authentication.</p>
</li>
<li>
<p>URI of the JWKS certificate endpoint used for local JWT validation.</p>
</li>
<li>
<p>The token claim (or key) that contains the actual user name in the token. The user name is the <em>principal</em> used to identify the user. The <code>userNameClaim</code> value will depend on the authentication flow and the authorization server used.</p>
</li>
<li>
<p>(Optional) Activates the Kafka re-authentication mechanism that enforces session expiry to the same length of time as the access token. If the specified value is less than the time left for the access token to expire, then the client will have to re-authenticate before the actual token expiry. By default, the session does not expire when the access token expires, and the client does not attempt re-authentication.</p>
</li>
<li>
<p>(Optional) Trusted certificates for TLS connection to the authorization server.</p>
</li>
<li>
<p>(Optional) Disable TLS hostname verification. Default is <code>false</code>.</p>
</li>
<li>
<p>The duration the JWKS certificates are considered valid before they expire. Default is <code>360</code> seconds. If you specify a longer time, consider the risk of allowing access to revoked certificates.</p>
</li>
<li>
<p>The period between refreshes of JWKS certificates. The interval must be at least 60 seconds shorter than the expiry interval. Default is <code>300</code> seconds.</p>
</li>
<li>
<p>The minimum pause in seconds between consecutive attempts to refresh JWKS public keys. When an unknown signing key is encountered, the JWKS keys refresh is scheduled outside the regular periodic schedule with at least the specified pause since the last refresh attempt. The refreshing of keys follows the rule of exponential backoff, retrying on unsuccessful refreshes with ever increasing pause, until it reaches <code>jwksRefreshSeconds</code>. The default value is 1.</p>
</li>
<li>
<p>(Optional) If ECDSA is used for signing JWT tokens on authorization server, then this needs to be enabled. It installs additional crypto providers using BouncyCastle crypto library. Default is <code>false</code>.</p>
</li>
</ol>
</div>
<div id="example-2" class="listingblock">
<div class="title">Example 2: Configuring token validation using an introspection endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">- name: external
  port: 9094
  type: loadbalancer
  tls: true
  authentication:
    type: oauth
    validIssuerUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/external</em>&gt;
    introspectionEndpointUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/external/protocol/openid-connect/token/introspect</em>&gt; <b class="conum">(1)</b>
    clientId: kafka-broker <b class="conum">(2)</b>
    clientSecret: <b class="conum">(3)</b>
      secretName: my-cluster-oauth
      key: clientSecret
    userNameClaim: preferred_username <b class="conum">(4)</b>
    maxSecondsWithoutReauthentication: 3600 <b class="conum">(5)</b></code></pre>
</div>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>URI of the token introspection endpoint.</p>
</li>
<li>
<p>Client ID to identify the client.</p>
</li>
<li>
<p>Client Secret and client ID is used for authentication.</p>
</li>
<li>
<p>The token claim (or key) that contains the actual user name in the token. The user name is the <em>principal</em> used to identify the user. The <code>userNameClaim</code> value will depend on the authorization server used.</p>
</li>
<li>
<p>(Optional) Activates the Kafka re-authentication mechanism that enforces session expiry to the same length of time as the access token. If the specified value is less than the time left for the access token to expire, then the client will have to re-authenticate before the actual token expiry. By default, the session does not expire when the access token expires, and the client does not attempt re-authentication.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Depending on how you apply OAuth 2.0 authentication, and the type of authorization server, there are additional (optional) configuration settings you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">  # ...
  authentication:
    type: oauth
    # ...
    checkIssuer: false <b class="conum">(1)</b>
    fallbackUserNameClaim: client_id <b class="conum">(2)</b>
    fallbackUserNamePrefix: client-account- <b class="conum">(3)</b>
    validTokenType: bearer <b class="conum">(4)</b>
    userInfoEndpointUri: <em>https://OAUTH-SERVER-ADDRESS/auth/realms/external/protocol/openid-connect/userinfo</em> <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If your authorization server does not provide an <code>iss</code> claim, it is not possible to perform an issuer check. In this situation, set <code>checkIssuer</code> to <code>false</code> and do not specify a <code>validIssuerUri</code>. Default is <code>true</code>.</p>
</li>
<li>
<p>An authorization server may not provide a single attribute to identify both regular users and clients. When a client authenticates in its own name, the server might provide a <em>client ID</em>. When a user authenticates using a username and password, to obtain a refresh token or an access token, the server might provide a <em>username</em> attribute in addition to a client ID. Use this fallback option to specify the username claim (attribute) to use if a primary user ID attribute is not available.</p>
</li>
<li>
<p>In situations where <code>fallbackUserNameClaim</code> is applicable, it may also be necessary to prevent name collisions between the values of the username claim, and those of the fallback username claim. Consider a situation where a client called <code>producer</code> exists, but also a regular user called <code>producer</code> exists. In order to differentiate between the two, you can use this property to add a prefix to the user ID of the client.</p>
</li>
<li>
<p>(Only applicable when using <code>introspectionEndpointUri</code>) Depending on the authorization server you are using, the introspection endpoint may or may not return the <em>token type</em> attribute, or it may contain different values. You can specify a valid token type value that the response from the introspection endpoint has to contain.</p>
</li>
<li>
<p>(Only applicable when using <code>introspectionEndpointUri</code>) The authorization server may be configured or implemented in such a way to not provide any identifiable information in an Introspection Endpoint response. In order to obtain the user ID, you can configure the URI of the <code>userinfo</code> endpoint as a fallback. The <code>userNameClaim</code>, <code>fallbackUserNameClaim</code>, and <code>fallbackUserNamePrefix</code> settings are applied to the response of <code>userinfo</code> endpoint.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save and exit the editor, then wait for rolling updates to complete.</p>
</li>
<li>
<p>Check the update in the logs or by watching the pod state transitions:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl logs -f ${POD_NAME} -c ${CONTAINER_NAME}
kubectl get po -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rolling update configures the brokers to use OAuth 2.0 authentication.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">What to do next</div>
<ul>
<li>
<p><a href="#proc-oauth-client-config-str">Configure your Kafka clients to use OAuth 2.0</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-client-config-str"><a class="link" href="#proc-oauth-client-config-str">Configuring Kafka Java clients to use OAuth 2.0</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka producer and consumer APIs to use OAuth 2.0 for interaction with Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Add a client callback plugin to your <em>pom.xml</em> file, and configure the system properties.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed and configured for OAuth access to Kafka brokers</p>
</li>
<li>
<p>Kafka brokers are configured for OAuth 2.0</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the client library with OAuth 2.0 support to the <code>pom.xml</code> file for the Kafka client:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
 &lt;groupId&gt;io.strimzi&lt;/groupId&gt;
 &lt;artifactId&gt;kafka-oauth-client&lt;/artifactId&gt;
 &lt;version&gt;0.6.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the system properties for the callback:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">System.setProperty(ClientConfig.OAUTH_TOKEN_ENDPOINT_URI, <em>https://&lt;auth-server-address&gt;/auth/realms/master/protocol/openid-connect/token</em>); <b class="conum">(1)</b>
System.setProperty(ClientConfig.OAUTH_CLIENT_ID, "<em>&lt;client-name&gt;</em>"); <b class="conum">(2)</b>
System.setProperty(ClientConfig.OAUTH_CLIENT_SECRET, "<em>&lt;client-secret&gt;</em>"); <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>URI of the authorization server token endpoint.</p>
</li>
<li>
<p>Client ID, which is the name used when creating the <em>client</em> in the authorization server.</p>
</li>
<li>
<p>Client secret created when creating the <em>client</em> in the authorization server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enable the <em>SASL OAUTHBEARER</em> mechanism on a TLS encrypted connection in the Kafka client configuration:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">props.put("sasl.jaas.config", "org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required;");
props.put("security.protocol", "SASL_SSL"); <b class="conum">(1)</b>
props.put("sasl.mechanism", "OAUTHBEARER");
props.put("sasl.login.callback.handler.class", "io.strimzi.kafka.oauth.client.JaasClientOauthLoginCallbackHandler");</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here we use <code>SASL_SSL</code> for use over TLS connections. Use <code>SASL_PLAINTEXT</code> over unencrypted connections.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify that the Kafka client can access the Kafka brokers.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">What to do next</div>
<ul>
<li>
<p><a href="#proc-oauth-kafka-config-str">Configure Kafka components to use OAuth 2.0</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proc-oauth-kafka-config-str"><a class="link" href="#proc-oauth-kafka-config-str">Configuring OAuth 2.0 for Kafka components</a></h5>
<div class="paragraph">
<p>This procedure describes how to configure Kafka components to use OAuth 2.0 authentication using an authorization server.</p>
</div>
<div class="paragraph">
<p>You can configure authentication for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Connect</p>
</li>
<li>
<p>Kafka MirrorMaker</p>
</li>
<li>
<p>Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this scenario, the Kafka component and the authorization server are running in the same cluster.</p>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>For more information on the configuration of OAuth 2.0 authentication for Kafka components, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="appendix_crds.html#type-KafkaClientAuthenticationOAuth-reference">KafkaClientAuthenticationOAuth schema reference</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi and Kafka are running</p>
</li>
<li>
<p>An OAuth 2.0 authorization server is deployed and configured for OAuth access to Kafka brokers</p>
</li>
<li>
<p>Kafka brokers are configured for OAuth 2.0</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a client secret and mount it to the component as an environment variable.</p>
<div class="paragraph">
<p>For example, here we are creating a client <code>Secret</code> for the Kafka Bridge:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Secret
metadata:
 name: my-bridge-oauth
type: Opaque
data:
 clientSecret: MGQ1OTRmMzYtZTllZS00MDY2LWI5OGEtMTM5MzM2NjdlZjQw <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>clientSecret</code> key must be in base64 format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or edit the resource for the Kafka component so that OAuth 2.0 authentication is configured for the authentication property.</p>
<div class="paragraph">
<p>For OAuth 2.0 authentication, you can use:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Client ID and secret</p>
</li>
<li>
<p>Client ID and refresh token</p>
</li>
<li>
<p>Access token</p>
</li>
<li>
<p>TLS</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="appendix_crds.html#type-KafkaClientAuthenticationOAuth-reference">KafkaClientAuthenticationOAuth schema reference provides examples of each</a>.</p>
</div>
<div class="paragraph">
<p>For example, here OAuth 2.0 is assigned to the Kafka Bridge client using a client ID and secret, and TLS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  authentication:
    type: oauth <b class="conum">(1)</b>
    tokenEndpointUri: https://&lt;auth-server-address&gt;/auth/realms/master/protocol/openid-connect/token <b class="conum">(2)</b>
    clientId: kafka-bridge
    clientSecret:
      secretName: my-bridge-oauth
      key: clientSecret
    tlsTrustedCertificates: <b class="conum">(3)</b>
    - secretName: oauth-server-cert
      certificate: tls.crt</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Authentication type set to <code>oauth</code>.</p>
</li>
<li>
<p>URI of the token endpoint for authentication.</p>
</li>
<li>
<p>Trusted certificates for TLS connection to the authorization server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Depending on how you apply OAuth 2.0 authentication, and the type of authorization server, there are additional configuration options you can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
spec:
  # ...
  authentication:
    # ...
    disableTlsHostnameVerification: true <b class="conum">(1)</b>
    checkAccessTokenType: false <b class="conum">(2)</b>
    accessTokenIsJwt: false <b class="conum">(3)</b>
    scope: any <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Optional) Disable TLS hostname verification. Default is <code>false</code>.</p>
</li>
<li>
<p>If the authorization server does not return a <code>typ</code> (type) claim inside the JWT token, you can apply <code>checkAccessTokenType: false</code> to skip the token type check. Default is <code>true</code>.</p>
</li>
<li>
<p>If you are using opaque tokens, you can apply <code>accessTokenIsJwt: false</code> so that access tokens are not treated as JWT tokens.</p>
</li>
<li>
<p>(Optional) The <code>scope</code> for requesting the token from the token endpoint.
An authorization server may require a client to specify the scope.
In this case it is <code>any</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the changes to the deployment of your Kafka resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kubectl apply -f your-file</code></pre>
</div>
</div>
</li>
<li>
<p>Check the update in the logs or by watching the pod state transitions:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kubectl logs -f ${POD_NAME} -c ${CONTAINER_NAME}
kubectl get pod -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rolling updates configure the component for interaction with Kafka brokers using OAuth 2.0 authentication.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-oauth-server-examples-str"><a class="link" href="#con-oauth-server-examples-str">4.4.7. Authorization server examples</a></h4>
<div class="paragraph">
<p>When choosing an authorization server, consider the features that best support configuration of your chosen authentication flow.</p>
</div>
<div class="paragraph">
<p>For the purposes of testing OAuth 2.0 with Strimzi, Keycloak and ORY Hydra were implemented as the OAuth 2.0 authorization server.</p>
</div>
<div class="paragraph">
<p>For more information, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://strimzi.io/2019/10/25/kafka-authentication-using-oauth-2.0.html" target="_blank" rel="noopener">Kafka authentication using OAuth 2.0</a></p>
</li>
<li>
<p><a href="https://github.com/strimzi/strimzi-kafka-oauth/tree/master/examples" target="_blank" rel="noopener">Using Keycloak as the OAuth 2.0 authorization server</a></p>
</li>
<li>
<p><a href="https://github.com/strimzi/strimzi-kafka-oauth/tree/master/examples/docker" target="_blank" rel="noopener">Using Hydra as the OAuth 2.0 authorization server</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-oauth-authorization_str"><a class="link" href="#assembly-oauth-authorization_str">4.5. Using OAuth 2.0 token-based authorization</a></h3>
<div id="con-oauth-authorization-intro_str" class="paragraph">
<p>If you are using OAuth 2.0 with Keycloak for token-based authentication,
you can also use Keycloak to configure authorization rules to constrain client access to Kafka brokers.
Authentication establishes the identity of a user.
Authorization decides the level of access for that user.</p>
</div>
<div class="paragraph">
<p>Strimzi supports the use of OAuth 2.0 token-based authorization through Keycloak <a href="https://www.keycloak.org/docs/latest/authorization_services/index.html" target="_blank" rel="noopener">Authorization Services</a>,
which allows you to manage security policies and permissions centrally.</p>
</div>
<div class="paragraph">
<p>Security policies and permissions defined in Keycloak are used to grant access to resources on Kafka brokers.
Users and clients are matched against policies that permit access to perform specific actions on Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Kafka allows all users full access to brokers by default,
and also provides the <code>AclAuthorizer</code> plugin to configure authorization based on Access Control Lists (ACLs).</p>
</div>
<div class="paragraph">
<p>ZooKeeper stores ACL rules that grant or deny access to resources based on <em>username</em>.
However, OAuth 2.0 token-based authorization with  Keycloak offers far greater flexibility on how you wish to implement access control to Kafka brokers.
In addition, you can configure your Kafka brokers to use OAuth 2.0 authorization and ACLs.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-oauth-authentication_str">Using OAuth 2.0 token-based authentication</a></p>
</li>
<li>
<p><a href="#con-securing-kafka-authorization-str">Kafka Authorization</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/documentation.html" target="_blank" rel="noopener">Keycloak documentation</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="con-oauth-authorization-mechanism_str"><a class="link" href="#con-oauth-authorization-mechanism_str">4.5.1. OAuth 2.0 authorization mechanism</a></h4>
<div class="paragraph">
<p>OAuth 2.0 authorization in Strimzi uses Keycloak server Authorization Services REST endpoints to extend token-based authentication with Keycloak by applying defined security policies on a particular user,
and providing a list of permissions granted on different resources for that user.
Policies use roles and groups to match permissions to users.
OAuth 2.0 authorization enforces permissions locally based on the received list of grants for the user from Keycloak Authorization Services.</p>
</div>
<div class="sect4">
<h5 id="kafka_broker_custom_authorizer"><a class="link" href="#kafka_broker_custom_authorizer">Kafka broker custom authorizer</a></h5>
<div class="paragraph">
<p>A Keycloak <em>authorizer</em> (<code>KeycloakRBACAuthorizer</code>) is provided with Strimzi.
To be able to use the Keycloak REST endpoints for Authorization Services provided by Keycloak,
you configure a custom authorizer on the Kafka broker.</p>
</div>
<div class="paragraph">
<p>The authorizer fetches a list of granted permissions from the authorization server as needed,
and enforces authorization locally on the Kafka Broker, making rapid authorization decisions for each client request.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-oauth-authorization-broker-config-str"><a class="link" href="#proc-oauth-authorization-broker-config-str">4.5.2. Configuring OAuth 2.0 authorization support</a></h4>
<div class="paragraph">
<p>This procedure describes how to configure Kafka brokers to use OAuth 2.0 authorization using Keycloak Authorization Services.</p>
</div>
<div class="paragraph">
<div class="title">Before you begin</div>
<p>Consider the access you require or want to limit for certain users.
You can use a combination of Keycloak <em>groups</em>, <em>roles</em>, <em>clients</em>, and <em>users</em> to configure access in Keycloak.</p>
</div>
<div class="paragraph">
<p>Typically, groups are used to match users based on organizational departments or geographical locations.
And roles are used to match users based on their function.</p>
</div>
<div class="paragraph">
<p>With Keycloak, you can store users and groups in LDAP, whereas clients and roles cannot be stored this way.
Storage and access to user data may be a factor in how you choose to configure authorization policies.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<a href="#property-simple-authorization-superusers-reference">Super users</a> always have unconstrained access to a Kafka broker regardless of the authorization implemented on the Kafka broker.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Strimzi must be configured to use OAuth 2.0 with Keycloak for <a href="#assembly-oauth-authentication_str">token-based authentication</a>.
You use the same Keycloak server endpoint when you set up authorization.</p>
</li>
<li>
<p>OAuth 2.0 authentication must be configured with the <code>maxSecondsWithoutReauthentication</code> option to enable re-authentication.</p>
</li>
<li>
<p>You need to understand how to manage policies and permissions for Keycloak Authorization Services, as described in the <a href="https://www.keycloak.org/documentation.html" target="_blank" rel="noopener">Keycloak documentation</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the Keycloak Admin Console or use the Keycloak Admin CLI to enable Authorization Services for the Kafka broker client you created when setting up OAuth 2.0 authentication.</p>
</li>
<li>
<p>Use Authorization Services to define resources, authorization scopes, policies, and permissions for the client.</p>
</li>
<li>
<p>Bind the permissions to users and clients by assigning them roles and groups.</p>
</li>
<li>
<p>Configure the Kafka brokers to use Keycloak authorization by updating the Kafka broker configuration (<code>Kafka.spec.kafka</code>) of your <code>Kafka</code> resource in an editor.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka my-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Kafka broker <code>kafka</code> configuration to use <code>keycloak</code> authorization, and to be able to access the authorization server and Authorization Services.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka
  # ...
  authorization:
    type: <strong>keycloak</strong> <b class="conum">(1)</b>
    tokenEndpointUri: &lt;<em>https://&lt;auth-server-address&gt;/auth/realms/external/protocol/openid-connect/token</em>&gt; <b class="conum">(2)</b>
    clientId: kafka <b class="conum">(3)</b>
    delegateToKafkaAcls: false <b class="conum">(4)</b>
    disableTlsHostnameVerification: false <b class="conum">(5)</b>
    superUsers: <b class="conum">(6)</b>
      - CN=fred
      - sam
      - CN=edward
    tlsTrustedCertificates: <b class="conum">(7)</b>
    - secretName: oauth-server-cert
      certificate: ca.crt
    grantsRefreshPeriodSeconds: 60 <b class="conum">(8)</b>
    grantsRefreshPoolSize: 5 <b class="conum">(9)</b>
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Type <code>keycloak</code> enables Keycloak authorization.</p>
</li>
<li>
<p>URI of the Keycloak token endpoint. For production, always use HTTPs.</p>
</li>
<li>
<p>The client ID of the OAuth 2.0 client definition in Keycloak that has Authorization Services enabled. Typically, <code>kafka</code> is used as the ID.</p>
</li>
<li>
<p>(Optional) Delegate authorization to Kafka <code>AclAuthorizer</code> if access is denied by Keycloak Authorization Services policies.
Default is <code>false</code>.</p>
</li>
<li>
<p>(Optional) Disable TLS hostname verification. Default is <code>false</code>.</p>
</li>
<li>
<p>(Optional) Designated <a href="#property-simple-authorization-superusers-reference">super users</a>.</p>
</li>
<li>
<p>(Optional) Trusted certificates for TLS connection to the authorization server.</p>
</li>
<li>
<p>(Optional) The time between two consecutive grants refresh runs. That is the maximum time for active sessions to detect any permissions changes for the user on Keycloak. The default value is 60.</p>
</li>
<li>
<p>(Optional) The number of threads to use to refresh (in parallel) the grants for the active sessions. The default value is 5.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save and exit the editor, then wait for rolling updates to complete.</p>
</li>
<li>
<p>Check the update in the logs or by watching the pod state transitions:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl logs -f ${POD_NAME} -c kafka
kubectl get po -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rolling update configures the brokers to use OAuth 2.0 authorization.</p>
</div>
</li>
<li>
<p>Verify the configured permissions by accessing Kafka brokers as clients or  users with specific roles, making sure they have the necessary access, or do not have the access they are not supposed to have.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operators-str"><a class="link" href="#assembly-operators-str">5. Using Strimzi Operators</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the Strimzi operators to manage your Kafka cluster, and Kafka topics and users.</p>
</div>
<div class="sect2">
<h3 id="using-the-cluster-operator-str"><a class="link" href="#using-the-cluster-operator-str">5.1. Using the Cluster Operator</a></h3>
<div class="paragraph">
<p>The Cluster Operator is used to deploy a Kafka cluster and other Kafka components.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator is deployed using YAML installation files.</p>
</div>
<div class="paragraph">
<p>For information on deploying the Cluster Operator, see <a href="./deploying.html#cluster-operator-str" target="_blank" rel="noopener">Deploying the Cluster Operator</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
<div class="paragraph">
<p>For information on the deployment options available for Kafka, see <a href="#assembly-deployment-configuration-kafka-str">Kafka Cluster configuration</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
On OpenShift, a Kafka Connect deployment can incorporate a Source2Image feature to provide a convenient way to add additional connectors.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ref-operator-cluster-str"><a class="link" href="#ref-operator-cluster-str">5.1.1. Cluster Operator configuration</a></h4>
<div class="paragraph">
<p>The Cluster Operator can be configured through the following supported environment variables and through the logging configuration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>STRIMZI_NAMESPACE</code></dt>
<dd>
<p>A comma-separated list of namespaces that the operator should operate in.
When not set, set to empty string, or to <code>*</code> the Cluster Operator will operate in all namespaces.
The Cluster Operator deployment might use the <a href="https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#the-downward-api" target="_blank" rel="noopener">Kubernetes Downward API</a>
to set this automatically to the namespace the Cluster Operator is deployed in. See the example below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">env:
  - name: STRIMZI_NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><a id="STRIMZI_FULL_RECONCILIATION_INTERVAL_MS"></a> <code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></dt>
<dd>
<p>Optional, default is 120000 ms. The interval between periodic reconciliations, in milliseconds.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_OPERATION_TIMEOUT_MS</code></dt>
<dd>
<p>Optional, default 300000 ms.
The timeout for internal operations, in milliseconds. This value should be
increased when using Strimzi on clusters where regular Kubernetes operations take longer than usual (because of slow downloading of Docker images, for example).</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from Kafka version to the corresponding Docker image containing a Kafka broker of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.5.0=strimzi/kafka:0.20.1-kafka-2.5.0, 2.6.0=strimzi/kafka:0.20.1-kafka-2.6.0</code>.
This is used when a <code>Kafka.spec.kafka.version</code> property is specified but not the <code>Kafka.spec.kafka.image</code>, as described in <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:0.20.1</code>.
The image name to use as default for the init container started before the broker for initial configuration work (that is, rack support), if no image is specified as the <code>kafka-init-image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_CONNECT_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka connect of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.5.0=strimzi/kafka:0.20.1-kafka-2.5.0, 2.6.0=strimzi/kafka:0.20.1-kafka-2.6.0</code>.
This is used when a <code>KafkaConnect.spec.version</code> property is specified but not the <code>KafkaConnect.spec.image</code>, as described in <a href="#con-common-configuration-images-reference"><code>image</code></a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_CONNECT_S2I_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka connect of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.5.0=strimzi/kafka:0.20.1-kafka-2.5.0, 2.6.0=strimzi/kafka:0.20.1-kafka-2.6.0</code>.
This is used when a <code>KafkaConnectS2I.spec.version</code> property is specified but not the <code>KafkaConnectS2I.spec.image</code>, as described in <a href="#con-common-configuration-images-reference"><code>image</code></a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KAFKA_MIRROR_MAKER_IMAGES</code></dt>
<dd>
<p>Required.
This provides a mapping from the Kafka version to the corresponding Docker image containing a Kafka mirror maker of that version.
The required syntax is whitespace or comma separated <code><em>&lt;version&gt;</em>=<em>&lt;image&gt;</em></code> pairs.
For example <code>2.5.0=strimzi/kafka:0.20.1-kafka-2.5.0, 2.6.0=strimzi/kafka:0.20.1-kafka-2.6.0</code>.
This is used when a <code>KafkaMirrorMaker.spec.version</code> property is specified but not the <code>KafkaMirrorMaker.spec.image</code>, as described in <a href="#con-common-configuration-images-reference"><code>image</code></a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:0.20.1</code>.
The image name to use as the default when deploying the topic operator,
if no image is specified as the <code>Kafka.spec.entityOperator.topicOperator.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a> of the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/operator:0.20.1</code>.
The image name to use as the default when deploying the user operator,
if no image is specified as the <code>Kafka.spec.entityOperator.userOperator.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a> of the <code>Kafka</code> resource.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code></dt>
<dd>
<p>Optional, default <code>strimzi/kafka:0.20.1-kafka-2.6.0</code>.
The image name to use as the default when deploying the sidecar container which provides TLS support for the Entity Operator, if
no image is specified as the <code>Kafka.spec.entityOperator.tlsSidecar.image</code> in the <a href="#assembly-configuring-container-images-deployment-configuration-kafka">Container images</a>.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_POLICY</code></dt>
<dd>
<p>Optional.
The <code>ImagePullPolicy</code> which will be applied to containers in all pods managed by Strimzi Cluster Operator.
The valid values are <code>Always</code>, <code>IfNotPresent</code>, and <code>Never</code>.
If not specified, the Kubernetes defaults will be used.
Changing the policy will result in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_IMAGE_PULL_SECRETS</code></dt>
<dd>
<p>Optional.
A comma-separated list of <code>Secret</code> names.
The secrets referenced here contain the credentials to the container registries where the container images are pulled from.
The secrets are used in the <code>imagePullSecrets</code> field for all <code>Pods</code> created by the Cluster Operator.
Changing this list results in a rolling update of all your Kafka, Kafka Connect, and Kafka MirrorMaker clusters.</p>
</dd>
<dt class="hdlist1"><code>STRIMZI_KUBERNETES_VERSION</code></dt>
<dd>
<p>Optional.
Overrides the Kubernetes version information detected from the API server.
See the example below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">env:
  - name: STRIMZI_KUBERNETES_VERSION
    value: |
           major=1
           minor=16
           gitVersion=v1.16.2
           gitCommit=c97fe5036ef3df2967d086711e6c0c405941e14b
           gitTreeState=clean
           buildDate=2019-10-15T19:09:08Z
           goVersion=go1.12.10
           compiler=gc
           platform=linux/amd64</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1"><code>KUBERNETES_SERVICE_DNS_DOMAIN</code></dt>
<dd>
<p>Optional.
Overrides the default Kubernetes DNS domain name suffix.</p>
<div class="paragraph">
<p>By default, services assigned in the Kubernetes cluster have a DNS domain name that uses the default suffix <code>cluster.local</code>.</p>
</div>
<div class="paragraph">
<p>For example, for broker <em>kafka-0</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"><em>&lt;cluster-name&gt;</em>-kafka-0.<em>&lt;cluster-name&gt;</em>-kafka-brokers.<em>&lt;namespace&gt;</em>.svc.<em>cluster.local</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The DNS domain name is added to the Kafka broker certificates used for hostname verification.</p>
</div>
<div class="paragraph">
<p>If you are using a different DNS domain name suffix in your cluster, change the <code>KUBERNETES_SERVICE_DNS_DOMAIN</code> environment variable from the default to the one you are using in order to establish a connection with the Kafka brokers.</p>
</div>
</dd>
</dl>
</div>
<h5 id="configuration_by_configmap" class="discrete">Configuration by ConfigMap</h5>
<div class="paragraph">
<p>The Cluster Operator&#8217;s logging is configured by the <code>strimzi-cluster-operator</code> <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>A <code>ConfigMap</code> containing logging configuration is created when installing the Cluster Operator.
This <code>ConfigMap</code> is described in the file <code>install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</code>.
You configure Cluster Operator logging by changing the data field <code>log4j2.properties</code> in this <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>To update the logging configuration, you can edit the <code>050-ConfigMap-strimzi-cluster-operator.yaml</code> file and then run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>install/cluster-operator/050-ConfigMap-strimzi-cluster-operator.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, edit the <code>ConfigMap</code> directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit cm strimzi-cluster-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the frequency of the reload interval, set a time in seconds in the <code>monitorInterval</code> option in the created <code>ConfigMap</code>.</p>
</div>
<div class="paragraph">
<p>If the <code>ConfigMap</code> is missing when the Cluster Operator is deployed, the default logging values are used.</p>
</div>
<div class="paragraph">
<p>If the <code>ConfigMap</code> is accidentally deleted after the Cluster Operator is deployed, the most recently loaded logging configuration is used.
Create a new <code>ConfigMap</code> to load a new logging configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Do not remove the monitorInterval option from the ConfigMap.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="periodic_reconciliation"><a class="link" href="#periodic_reconciliation">Periodic reconciliation</a></h5>
<div class="paragraph">
<p>Although the Cluster Operator reacts to all notifications about the desired cluster resources received from the Kubernetes cluster,
if the operator is not running, or if a notification is not received for any reason, the desired resources will get out of sync with the state of the running Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>In order to handle failovers properly, a periodic reconciliation process is executed by the Cluster Operator so that it can compare the state of the desired resources with the current cluster deployments in order to have a consistent state across all of them.
You can set the time interval for the periodic reconciliations using the <a href="#STRIMZI_FULL_RECONCILIATION_INTERVAL_MS"><code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code></a> variable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="provisioning_role_based_access_control_rbac"><a class="link" href="#provisioning_role_based_access_control_rbac">5.1.2. Provisioning Role-Based Access Control (RBAC)</a></h4>
<div class="paragraph">
<p>For the Cluster Operator to function it needs permission within the Kubernetes cluster to interact with resources such as <code>Kafka</code>, <code>KafkaConnect</code>, and so on, as well as the managed resources, such as <code>ConfigMaps</code>, <code>Pods</code>, <code>Deployments</code>, <code>StatefulSets</code> and <code>Services</code>.
Such permission is described in terms of Kubernetes role-based access control (RBAC) resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ServiceAccount</code>,</p>
</li>
<li>
<p><code>Role</code> and <code>ClusterRole</code>,</p>
</li>
<li>
<p><code>RoleBinding</code> and <code>ClusterRoleBinding</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to running under its own <code>ServiceAccount</code> with a <code>ClusterRoleBinding</code>, the Cluster Operator manages some RBAC resources for the components that need access to Kubernetes resources.</p>
</div>
<div class="paragraph">
<p>Kubernetes also includes privilege escalation protections that prevent components operating under one <code>ServiceAccount</code> from granting other <code>ServiceAccounts</code> privileges that the granting <code>ServiceAccount</code> does not have.
Because the Cluster Operator must be able to create the <code>ClusterRoleBindings</code>, and <code>RoleBindings</code> needed by resources it manages, the Cluster Operator must also have those same privileges.</p>
</div>
<div class="sect4">
<h5 id="delegated-privileges-str"><a class="link" href="#delegated-privileges-str">Delegated privileges</a></h5>
<div class="paragraph">
<p>When the Cluster Operator deploys resources for a desired <code>Kafka</code> resource it also creates <code>ServiceAccounts</code>, <code>RoleBindings</code>, and <code>ClusterRoleBindings</code>, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka broker pods use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-kafka</code></p>
<div class="ulist">
<ul>
<li>
<p>When the rack feature is used, the <code>strimzi-<em>cluster-name</em>-kafka-init</code> <code>ClusterRoleBinding</code> is used to grant this <code>ServiceAccount</code> access to the nodes within the cluster via a <code>ClusterRole</code> called <code>strimzi-kafka-broker</code></p>
</li>
<li>
<p>When the rack feature is not used no binding is created</p>
</li>
</ul>
</div>
</li>
<li>
<p>The ZooKeeper pods use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-zookeeper</code></p>
</li>
<li>
<p>The Entity Operator pod uses a <code>ServiceAccount</code> called <code><em>cluster-name</em>-entity-operator</code></p>
<div class="ulist">
<ul>
<li>
<p>The Topic Operator produces Kubernetes events with status information, so the <code>ServiceAccount</code> is bound to a <code>ClusterRole</code> called <code>strimzi-entity-operator</code> which grants this access via the <code>strimzi-entity-operator</code> <code>RoleBinding</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>The pods for <code>KafkaConnect</code> and <code>KafkaConnectS2I</code> resources use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-cluster-connect</code></p>
</li>
<li>
<p>The pods for <code>KafkaMirrorMaker</code> use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-mirror-maker</code></p>
</li>
<li>
<p>The pods for <code>KafkaMirrorMaker2</code> use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-mirrormaker2</code></p>
</li>
<li>
<p>The pods for <code>KafkaBridge</code> use a <code>ServiceAccount</code> called <code><em>cluster-name</em>-bridge</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="serviceaccount"><a class="link" href="#serviceaccount"><code>ServiceAccount</code></a></h5>
<div class="paragraph">
<p>The Cluster Operator is best run using a <code>ServiceAccount</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ServiceAccount</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: ServiceAccount
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Deployment</code> of the operator then needs to specify this in its <code>spec.template.spec.serviceAccountName</code>:</p>
</div>
<div class="listingblock">
<div class="title">Partial example of <code>Deployment</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: apps/v1
kind: Deployment
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
spec:
  replicas: 1
  selector:
    matchLabels:
      name: strimzi-cluster-operator
      strimzi.io/kind: cluster-operator
  template:
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note line 12, where the <code>strimzi-cluster-operator</code> <code>ServiceAccount</code> is specified as the <code>serviceAccountName</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="clusterroles"><a class="link" href="#clusterroles"><code>ClusterRoles</code></a></h5>
<div class="paragraph">
<p>The Cluster Operator needs to operate using <code>ClusterRoles</code> that gives access to the necessary resources.
Depending on the Kubernetes cluster setup, a cluster administrator might be needed to create the <code>ClusterRoles</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cluster administrator rights are only needed for the creation of the <code>ClusterRoles</code>.
The Cluster Operator will not run under the cluster admin account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ClusterRoles</code> follow the <em>principle of least privilege</em> and contain only those privileges needed by the Cluster Operator to operate Kafka, Kafka Connect, and ZooKeeper clusters. The first set of assigned privileges allow the Cluster Operator to manage Kubernetes resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>ConfigMaps</code>.</p>
</div>
<div class="paragraph">
<p>Cluster Operator uses ClusterRoles to grant permission at the namespace-scoped resources level and cluster-scoped resources level:</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with namespaced resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-namespaced
  labels:
    app: strimzi
rules:
  - apiGroups:
      - ""
    resources:
      # The cluster operator needs to access and manage service accounts to grant Strimzi components cluster permissions
      - serviceaccounts
    verbs:
      - get
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      # The cluster operator needs to access and manage rolebindings to grant Strimzi components cluster permissions
      - rolebindings
    verbs:
      - get
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - ""
    resources:
      # The cluster operator needs to access and manage config maps for Strimzi components configuration
      - configmaps
      # The cluster operator needs to access and manage services to expose Strimzi components to network traffic
      - services
      # The cluster operator needs to access and manage secrets to handle credentials
      - secrets
      # The cluster operator needs to access and manage persistent volume claims to bind them to Strimzi components for persistent data
      - persistentvolumeclaims
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "kafka.strimzi.io"
    resources:
      # The cluster operator runs the KafkaAssemblyOperator, which needs to access and manage Kafka resources
      - kafkas
      - kafkas/status
      # The cluster operator runs the KafkaConnectAssemblyOperator, which needs to access and manage KafkaConnect resources
      - kafkaconnects
      - kafkaconnects/status
      # The cluster operator runs the KafkaConnectS2IAssemblyOperator, which needs to access and manage KafkaConnectS2I resources
      - kafkaconnects2is
      - kafkaconnects2is/status
      # The cluster operator runs the KafkaConnectorAssemblyOperator, which needs to access and manage KafkaConnector resources
      - kafkaconnectors
      - kafkaconnectors/status
      # The cluster operator runs the KafkaMirrorMakerAssemblyOperator, which needs to access and manage KafkaMirrorMaker resources
      - kafkamirrormakers
      - kafkamirrormakers/status
      # The cluster operator runs the KafkaBridgeAssemblyOperator, which needs to access and manage BridgeMaker resources
      - kafkabridges
      - kafkabridges/status
      # The cluster operator runs the KafkaMirrorMaker2AssemblyOperator, which needs to access and manage KafkaMirrorMaker2 resources
      - kafkamirrormaker2s
      - kafkamirrormaker2s/status
      # The cluster operator runs the KafkaRebalanceAssemblyOperator, which needs to access and manage KafkaRebalance resources
      - kafkarebalances
      - kafkarebalances/status
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - ""
    resources:
      # The cluster operator needs to access and delete pods, this is to allow it to monitor pod health and coordinate rolling updates
      - pods
    verbs:
      - get
      - list
      - watch
      - delete
  - apiGroups:
      - ""
    resources:
      - endpoints
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      # The cluster operator needs the extensions api as the operator supports Kubernetes version 1.11+
      # apps/v1 was introduced in Kubernetes 1.14
      - "extensions"
    resources:
      # The cluster operator needs to access and manage deployments to run deployment based Strimzi components
      - deployments
      - deployments/scale
      # The cluster operator needs to access replica sets to manage Strimzi components and to determine error states
      - replicasets
      # The cluster operator needs to access and manage replication controllers to manage replicasets
      - replicationcontrollers
      # The cluster operator needs to access and manage network policies to lock down communication between Strimzi components
      - networkpolicies
      # The cluster operator needs to access and manage ingresses which allow external access to the services in a cluster
      - ingresses
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - "apps"
    resources:
      # The cluster operator needs to access and manage deployments to run deployment based Strimzi components
      - deployments
      - deployments/scale
      - deployments/status
      # The cluster operator needs to access and manage stateful sets to run stateful sets based Strimzi components
      - statefulsets
      # The cluster operator needs to access replica-sets to manage Strimzi components and to determine error states
      - replicasets
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - ""
    resources:
      # The cluster operator needs to be able to create events and delegate permissions to do so
      - events
    verbs:
      - create
  - apiGroups:
      # OpenShift S2I requirements
      - apps.openshift.io
    resources:
      - deploymentconfigs
      - deploymentconfigs/scale
      - deploymentconfigs/status
      - deploymentconfigs/finalizers
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      # OpenShift S2I requirements
      - build.openshift.io
    resources:
      - buildconfigs
      - builds
    verbs:
      - create
      - delete
      - get
      - list
      - patch
      - watch
      - update
  - apiGroups:
      # OpenShift S2I requirements
      - image.openshift.io
    resources:
      - imagestreams
      - imagestreams/status
    verbs:
      - create
      - delete
      - get
      - list
      - watch
      - patch
      - update
  - apiGroups:
      - networking.k8s.io
    resources:
      # The cluster operator needs to access and manage network policies to lock down communication between Strimzi components
      - networkpolicies
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - route.openshift.io
    resources:
      # The cluster operator needs to access and manage routes to expose Strimzi components for external access
      - routes
      - routes/custom-host
    verbs:
      - get
      - list
      - create
      - delete
      - patch
      - update
  - apiGroups:
      - policy
    resources:
      # The cluster operator needs to access and manage pod disruption budgets this limits the number of concurrent disruptions
      # that a Strimzi component experiences, allowing for higher availability
      - poddisruptionbudgets
    verbs:
      - get
      - list
      - watch
      - create
      - delete
      - patch
      - update</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second includes the permissions needed for cluster-scoped resources.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> with cluster-scoped resources for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-cluster-operator-global
  labels:
    app: strimzi
rules:
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      # The cluster operator needs to create and manage cluster role bindings in the case of an install where a user
      # has specified they want their cluster role bindings generated
      - clusterrolebindings
    verbs:
      - get
      - create
      - delete
      - patch
      - update
      - watch
  - apiGroups:
      - storage.k8s.io
    resources:
      # The cluster operator requires "get" permissions to view storage class details
      # This is because only a persistent volume of a supported storage class type can be resized
      - storageclasses
    verbs:
      - get
  - apiGroups:
      - ""
    resources:
      # The cluster operator requires "list" permissions to view all nodes in a cluster
      # The listing is used to determine the node addresses when NodePort access is configured
      # These addresses are then exposed in the custom resource states
      - nodes
    verbs:
      - list</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-kafka-broker</code> <code>ClusterRole</code> represents the access needed by the init container in Kafka pods that is used for the rack feature. As described in the <a href="#delegated-privileges-str">Delegated privileges</a> section, this role is also needed by the Cluster Operator in order to be able to delegate this access.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to Kubernetes nodes to the Kafka broker pods</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-kafka-broker
  labels:
    app: strimzi
rules:
  - apiGroups:
      - ""
    resources:
      # The Kafka Brokers require "get" permissions to view the node they are on
      # This information is used to generate a Rack ID that is used for High Availability configurations
      - nodes
    verbs:
      - get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-topic-operator</code> <code>ClusterRole</code> represents the access needed by the Topic Operator. As described in the <a href="#delegated-privileges-str">Delegated privileges</a> section, this role is also needed by the Cluster Operator in order to be able to delegate this access.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to events to the Topic Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-entity-operator
  labels:
    app: strimzi
rules:
  - apiGroups:
      - "kafka.strimzi.io"
    resources:
      # The entity operator runs the KafkaTopic assembly operator, which needs to access and manage KafkaTopic resources
      - kafkatopics
      - kafkatopics/status
      # The entity operator runs the KafkaUser assembly operator, which needs to access and manage KafkaUser resources
      - kafkausers
      - kafkausers/status
    verbs:
      - get
      - list
      - watch
      - create
      - patch
      - update
      - delete
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      # The entity operator needs to be able to create events
      - create
  - apiGroups:
      - ""
    resources:
      # The entity operator user-operator needs to access and manage secrets to store generated credentials
      - secrets
    verbs:
      - get
      - list
      - create
      - patch
      - update
      - delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>strimzi-kafka-client</code> <code>ClusterRole</code> represents the access needed by the components based on Kafka clients which use the client rack-awareness.
As described in the <a href="#delegated-privileges-str">Delegated privileges</a> section, this role is also needed by the Cluster Operator in order to be able to delegate this access.</p>
</div>
<div class="listingblock">
<div class="title"><code>ClusterRole</code> for the Cluster Operator allowing it to delegate access to Kubernetes nodes to the Kafka client based pods</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: strimzi-kafka-client
  labels:
    app: strimzi
rules:
  - apiGroups:
      - ""
    resources:
      # The Kafka clients (Connect, Mirror Maker, etc.) require "get" permissions to view the node they are on
      # This information is used to generate a Rack ID (client.rack option) that is used for consuming from the closest
      # replicas when enabled
      - nodes
    verbs:
      - get</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="clusterrolebindings"><a class="link" href="#clusterrolebindings"><code>ClusterRoleBindings</code></a></h5>
<div class="paragraph">
<p>The operator needs <code>ClusterRoleBindings</code> and <code>RoleBindings</code> which associates its <code>ClusterRole</code> with its <code>ServiceAccount</code>:
<code>ClusterRoleBindings</code> are needed for <code>ClusterRoles</code> containing cluster-scoped resources.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-global
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterRoleBindings</code> are also needed for the <code>ClusterRoles</code> needed for delegation:</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator for the Kafka broker rack-awarness</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator-kafka-broker-delegation
  labels:
    app: strimzi
# The Kafka broker cluster role must be bound to the cluster operator service account so that it can delegate the cluster role to the Kafka brokers.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-kafka-broker
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ClusterRoleBinding</code> for the Cluster Operator for the Kafka client rack-awarness</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: strimzi-cluster-operator-kafka-client-delegation
  labels:
    app: strimzi
# The Kafka clients cluster role must be bound to the cluster operator service account so that it can delegate the
# cluster role to the Kafka clients using it for consuming from closest replica.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-kafka-client
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ClusterRoles</code> containing only namespaced resources are bound using <code>RoleBindings</code> only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator
  labels:
    app: strimzi
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-cluster-operator-namespaced
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="yaml" class="language-yaml hljs">apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: strimzi-cluster-operator-entity-operator-delegation
  labels:
    app: strimzi
# The Entity Operator cluster role must be bound to the cluster operator service account so that it can delegate the cluster role to the Entity Operator.
# This must be done to avoid escalating privileges which would be blocked by Kubernetes.
subjects:
  - kind: ServiceAccount
    name: strimzi-cluster-operator
    namespace: myproject
roleRef:
  kind: ClusterRole
  name: strimzi-entity-operator
  apiGroup: rbac.authorization.k8s.io</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-the-topic-operator-str"><a class="link" href="#using-the-topic-operator-str">5.2. Using the Topic Operator</a></h3>
<div class="paragraph">
<p>When you create, modify or delete a topic using the <code>KafkaTopic</code> resource,
the Topic Operator ensures those changes are reflected in the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The <em>Deploying Strimzi</em> guide provides instructions to deploy the Topic Operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#deploying-the-topic-operator-using-the-cluster-operator-str" target="_blank" rel="noopener">Using the Cluster Operator (recommended)</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-the-topic-operator-standalone-str" target="_blank" rel="noopener">Standalone to operate with Kafka clusters not managed by Strimzi</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ref-operator-topic-str"><a class="link" href="#ref-operator-topic-str">5.2.1. Kafka topic resource</a></h4>
<div class="paragraph">
<p>The <code>KafkaTopic</code> resource is used to configure topics, including the number of partitions and replicas.</p>
</div>
<div class="paragraph">
<p>The full schema for <code>KafkaTopic</code> is described in <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code> schema reference</a>.</p>
</div>
<div class="sect4">
<h5 id="identifying_a_kafka_cluster_for_topic_handling"><a class="link" href="#identifying_a_kafka_cluster_for_topic_handling">Identifying a Kafka cluster for topic handling</a></h5>
<div class="paragraph">
<p>A <code>KafkaTopic</code> resource includes a label that defines the appropriate name of the Kafka cluster (derived from the name of the <code>Kafka</code> resource) to which it belongs.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: topic-name-1
  labels:
    strimzi.io/cluster: my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label is used by the Topic Operator to identify the <code>KafkaTopic</code> resource and create a new topic, and also in subsequent handling of the topic.</p>
</div>
<div class="paragraph">
<p>If the label does not match the Kafka cluster, the Topic Operator cannot identify the <code>KafkaTopic</code> and the topic is not created.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling_changes_to_topics"><a class="link" href="#handling_changes_to_topics">Handling changes to topics</a></h5>
<div class="paragraph">
<p>A fundamental problem that the Topic Operator has to solve is that there is no single source of truth:
Both the <code>KafkaTopic</code> resource and the Kafka topic can be modified independently of the operator.
Complicating this, the Topic Operator might not always be able to observe changes at each end in real time (for example, the operator might be down).</p>
</div>
<div class="paragraph">
<p>To resolve this, the operator maintains its own private copy of the information about each topic.
When a change happens either in the Kafka cluster, or in Kubernetes, it looks at both the state of the other system and at its private copy in order to determine what needs to change to keep everything in sync.
The same thing happens whenever the operator starts, and periodically while it is running.</p>
</div>
<div class="paragraph">
<p>For example, suppose the Topic Operator is not running, and a <code>KafkaTopic</code> <code>my-topic</code> gets created.
When the operator starts it will lack a private copy of "my-topic", so it can infer that the <code>KafkaTopic</code> has been created since it was last running.
The operator will create the topic corresponding to <code>my-topic</code>, and also store a private copy of the metadata for <code>my-topic</code>.</p>
</div>
<div class="paragraph">
<p>The private copy allows the operator to cope with scenarios where the topic configuration gets changed both in Kafka and in Kubernetes, so long as the changes are not incompatible (for example, both changing the same topic config key, but to different values).
In the case of incompatible changes, the Kafka configuration wins, and the <code>KafkaTopic</code> will be updated to reflect that.</p>
</div>
<div class="paragraph">
<p>The private copy is held in the same ZooKeeper ensemble used by Kafka itself.
This mitigates availability concerns, because if ZooKeeper is not running then Kafka itself cannot run, so the operator will be no less available than it would even if it was stateless.</p>
</div>
</div>
<div class="sect4">
<h5 id="kafka_topic_usage_recommendations"><a class="link" href="#kafka_topic_usage_recommendations">Kafka topic usage recommendations</a></h5>
<div class="paragraph">
<p>When working with topics, be consistent.
Always operate on either <code>KafkaTopic</code> resources or topics directly in Kubernetes.
Avoid routinely switching between both methods for a given topic.</p>
</div>
<div class="paragraph">
<p>Use topic names that reflect the nature of the topic, and remember that names cannot be changed later.</p>
</div>
<div class="paragraph">
<p>If creating a topic in Kafka, use a name that is a valid Kubernetes resource name,
otherwise the Topic Operator will need to create the corresponding <code>KafkaTopic</code> with a name that conforms to the Kubernetes rules.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Recommendations for identifiers and names in Kubernetes are outlined in <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/architecture/identifiers.md" target="_blank" rel="noopener">Identifiers and Names in Kubernetes</a> community article.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="kafka_topic_naming_conventions"><a class="link" href="#kafka_topic_naming_conventions">Kafka topic naming conventions</a></h5>
<div class="paragraph">
<p>Kafka and Kubernetes impose their own validation rules for the naming of topics in Kafka and <code>KafkaTopic.metadata.name</code> respectively.
There are valid names for each which are invalid in the other.</p>
</div>
<div class="paragraph">
<p>Using the <code>spec.topicName</code> property, it is possible to create a valid topic in Kafka with a name that would be invalid for the Kafka topic in Kubernetes.</p>
</div>
<div class="paragraph">
<p>The <code>spec.topicName</code> property inherits Kafka naming validation rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name must not be longer than 249 characters.</p>
</li>
<li>
<p>Valid characters for Kafka topics are ASCII alphanumerics, <code>.</code>, <code>_</code>, and <code>-</code>.</p>
</li>
<li>
<p>The name cannot be <code>.</code> or <code>..</code>, though <code>.</code> can be used in a name, such as <code>exampleTopic.</code> or <code>.exampleTopic</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>spec.topicName</code> must not be changed.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: {KafkaApiVersion}
kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: topicName-1 <b class="conum">(1)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Upper case is invalid in Kubernetes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>cannot be changed to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: {KafkaApiVersion}
kind: KafkaTopic
metadata:
  name: topic-name-1
spec:
  topicName: name-2
  # ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Some Kafka client applications, such as Kafka Streams, can create topics in Kafka programmatically. If those topics have names that are invalid Kubernetes resource names, the Topic Operator gives them valid names based on the Kafka names. Invalid characters are replaced and a hash is appended to the name.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-configuring-kafka-topic-str"><a class="link" href="#proc-configuring-kafka-topic-str">5.2.2. Configuring a Kafka topic</a></h4>
<div class="paragraph">
<p>Use the properties of the <code>KafkaTopic</code> resource to configure a Kafka topic.</p>
</div>
<div class="paragraph">
<p>You can use <code>kubectl apply</code> to create or modify topics, and <code>kubectl delete</code> to delete existing topics.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>kubectl apply -f &lt;topic-config-file&gt;</code></p>
</li>
<li>
<p><code>kubectl delete KafkaTopic &lt;topic-name&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure shows how to create a topic with 10 partitions and 2 replicas.</p>
</div>
<div class="paragraph">
<div class="title">Before you start</div>
<p>It is important that you consider the following before making your changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka does <em>not</em> support making the following changes through the <code>KafkaTopic</code> resource:</p>
<div class="ulist">
<ul>
<li>
<p>Changing topic names using <code>spec.topicName</code></p>
</li>
<li>
<p>Decreasing partition size using <code>spec.partitions</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>You cannot use <code>spec.replicas</code> to change the number of replicas that were initially specified.</p>
</li>
<li>
<p>Increasing <code>spec.partitions</code> for topics with keys will change how records are partitioned, which can be particularly problematic when the topic uses <em>semantic partitioning</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A running Kafka cluster <a href="#con-securing-kafka-authentication-str">configured with a Kafka broker listener using TLS authentication and encryption</a>.</p>
</li>
<li>
<p>A running Topic Operator (typically <a href="#assembly-kafka-entity-operator-deployment-configuration-kafka">deployed with the Entity Operator</a>).</p>
</li>
<li>
<p>For deleting a topic, <code>delete.topic.enable=true</code> (default) in the <code>spec.kafka.config</code> of the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Prepare a file containing the <code>KafkaTopic</code> to be created.</p>
<div class="listingblock">
<div class="title">An example <code>KafkaTopic</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: orders
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 10
  replicas: 2</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When modifying a topic, you can get the current version of the resource using <code>kubectl get kafkatopic orders -o yaml</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create the <code>KafkaTopic</code> resource in Kubernetes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>TOPIC-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-topic-operator-with-resource-requests-limits-str"><a class="link" href="#proc-topic-operator-with-resource-requests-limits-str">5.2.3. Configuring the Topic Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the Topic Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>MY-CLUSTER</em></code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.topicOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the Topic Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # Kafka and ZooKeeper sections...
  entityOperator:
    topicOperator:
      resources:
        requests:
          cpu: "1"
          memory: 500Mi
        limits:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>KAFKA-CONFIG-FILE</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-using-the-user-operator-str"><a class="link" href="#assembly-using-the-user-operator-str">5.3. Using the User Operator</a></h3>
<div class="paragraph">
<p>When you create, modify or delete a user using the <code>KafkaUser</code> resource,
the User Operator ensures those changes are reflected in the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The <em>Deploying Strimzi</em> guide provides instructions to deploy the User Operator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./deploying.html#deploying-the-user-operator-using-the-cluster-operator-str" target="_blank" rel="noopener">Using the Cluster Operator (recommended)</a></p>
</li>
<li>
<p><a href="./deploying.html#deploying-the-user-operator-standalone-str" target="_blank" rel="noopener">Standalone to operate with Kafka clusters not managed by Strimzi</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about the schema, see <a href="#type-KafkaUser-reference"><code>KafkaUser</code> schema reference</a>.</p>
</div>
<div class="paragraph">
<div class="title">Authenticating and authorizing access to Kafka</div>
<p>Use <code>KafkaUser</code> to enable the authentication and authorization mechanisms that a specific client uses to access Kafka.</p>
</div>
<div class="paragraph">
<p>For more information on using <code>KafkUser</code> to manage users and secure access to Kafka brokers, see <a href="#assembly-securing-kafka-str">Securing access to Kafka brokers</a>.</p>
</div>
<div class="sect3">
<h4 id="proc-user-operator-with-resource-requests-limits-str"><a class="link" href="#proc-user-operator-with-resource-requests-limits-str">5.3.1. Configuring the User Operator with resource requests and limits</a></h4>
<div class="paragraph">
<p>You can allocate resources, such as CPU and memory, to the User Operator and set a limit on the amount of resources it can consume.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Update the Kafka cluster configuration in an editor, as required:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl edit kafka <em>MY-CLUSTER</em></code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>spec.entityOperator.userOperator.resources</code> property in the <code>Kafka</code> resource, set the resource requests and limits for the User Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  # Kafka and ZooKeeper sections...
  entityOperator:
    userOperator:
      resources:
        requests:
          cpu: "1"
          memory: 500Mi
        limits:
          cpu: "1"
          memory: 500Mi</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the file and exit the editor.
The Cluster Operator applies the changes automatically.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-operators-prometheus-metrics-str"><a class="link" href="#con-operators-prometheus-metrics-str">5.4. Monitoring operators using Prometheus metrics</a></h3>
<div class="paragraph">
<p>Strimzi operators expose Prometheus metrics.
The metrics are automatically enabled and contain information about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of reconciliations</p>
</li>
<li>
<p>Number of Custom Resources the operator is processing</p>
</li>
<li>
<p>Duration of reconciliations</p>
</li>
<li>
<p>JVM metrics from the operators</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, we provide an example Grafana dashboard.</p>
</div>
<div class="paragraph">
<p>For more information about Prometheus, see the <a href="./deploying.html#assembly-metrics-str">Introducing Metrics to Kafka</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kafka-bridge-concepts-str"><a class="link" href="#kafka-bridge-concepts-str">6. Kafka Bridge</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides an overview of the Strimzi Kafka Bridge and helps you get started using its REST API to interact with Strimzi.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To try out the Kafka Bridge in your local environment, see the <a href="#assembly-kafka-bridge-quickstart-str">Kafka Bridge quickstart</a> later in this chapter.</p>
</li>
<li>
<p>For detailed configuration steps, see <a href="#assembly-config-kafka-bridge-str">Kafka Bridge cluster configuration</a>.</p>
</li>
<li>
<p>To view the API documentation, see the <a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Kafka Bridge API reference</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="assembly-kafka-bridge-overview-str"><a class="link" href="#assembly-kafka-bridge-overview-str">6.1. Kafka Bridge overview</a></h3>
<div class="paragraph">
<p>You can use the Strimzi Kafka Bridge as an interface to make specific types of HTTP requests to the Kafka cluster.</p>
</div>
<div class="sect3">
<h4 id="overview-components-kafka-bridge_kafka-bridge-overview"><a class="link" href="#overview-components-kafka-bridge_kafka-bridge-overview">6.1.1. Kafka Bridge interface</a></h4>
<div class="paragraph">
<p>The Kafka Bridge provides a RESTful interface that allows HTTP-based clients to interact with a Kafka cluster.
It offers the advantages of a web API connection to Strimzi, without the need for client applications to interpret the Kafka protocol.</p>
</div>
<div class="paragraph">
<p>The API has two main resources  <code>consumers</code> and <code>topics</code>  that are exposed and made accessible through endpoints to interact with consumers and producers in your Kafka cluster. The resources relate only to the Kafka Bridge, not the consumers and producers connected directly to Kafka.</p>
</div>
<div class="sect4">
<h5 id="http_requests"><a class="link" href="#http_requests">HTTP requests</a></h5>
<div class="paragraph">
<p>The Kafka Bridge supports HTTP requests to a Kafka cluster, with methods to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send messages to a topic.</p>
</li>
<li>
<p>Retrieve messages from topics.</p>
</li>
<li>
<p>Retrieve a list of partitions for a topic.</p>
</li>
<li>
<p>Create and delete consumers.</p>
</li>
<li>
<p>Subscribe consumers to topics, so that they start receiving messages from those topics.</p>
</li>
<li>
<p>Retrieve a list of topics that a consumer is subscribed to.</p>
</li>
<li>
<p>Unsubscribe consumers from topics.</p>
</li>
<li>
<p>Assign partitions to consumers.</p>
</li>
<li>
<p>Commit a list of consumer offsets.</p>
</li>
<li>
<p>Seek on a partition, so that a consumer starts receiving messages from the first or last offset position, or a given offset position.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods provide JSON responses and HTTP response code error handling.
Messages can be sent in JSON or binary formats.</p>
</div>
<div class="paragraph">
<p>Clients can produce and consume messages without the requirement to use the native Kafka protocol.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To view the API documentation, including example requests and responses, see the <a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Kafka Bridge API reference</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-overview-components-kafka-bridge-clients_kafka-bridge-overview"><a class="link" href="#con-overview-components-kafka-bridge-clients_kafka-bridge-overview">6.1.2. Supported clients for the Kafka Bridge</a></h4>
<div class="paragraph">
<p>You can use the Kafka Bridge to integrate both <em>internal</em> and <em>external</em> HTTP client applications with your Kafka cluster.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Internal clients</dt>
<dd>
<p>Internal clients are container-based HTTP clients running in <em>the same</em> Kubernetes cluster as the Kafka Bridge itself.
Internal clients can access the Kafka Bridge on the host and port defined in the <code>KafkaBridge</code> custom resource.</p>
</dd>
<dt class="hdlist1">External clients</dt>
<dd>
<p>External clients are HTTP clients running <em>outside</em> the Kubernetes cluster in which the Kafka Bridge is deployed and running.
External clients can access the Kafka Bridge through an OpenShift Route, a loadbalancer service, or using an Ingress.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">HTTP internal and external client integration</div>
<p><span class="image"><img src="images/kafka-bridge.png" alt="Internal and external HTTP producers and consumers exchange data with the Kafka brokers through the Kafka Bridge"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="con-securing-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-securing-kafka-bridge-kafka-bridge-overview">6.1.3. Securing the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Strimzi does not currently provide any encryption, authentication, or authorization for the Kafka Bridge. This means that requests sent from external clients to the Kafka Bridge are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Not encrypted, and must use HTTP rather than HTTPS</p>
</li>
<li>
<p>Sent without authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, you can secure the Kafka Bridge using other methods, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kubernetes Network Policies that define which pods can access the Kafka Bridge.</p>
</li>
<li>
<p>Reverse proxies with authentication or authorization, for example, OAuth2 proxies.</p>
</li>
<li>
<p>API Gateways.</p>
</li>
<li>
<p>Ingress or OpenShift Routes with TLS termination.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Kafka Bridge supports TLS encryption and TLS and SASL authentication when connecting to the Kafka Brokers. Within your Kubernetes cluster, you can configure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS or SASL-based authentication between the Kafka Bridge and your Kafka cluster</p>
</li>
<li>
<p>A TLS-encrypted connection between the Kafka Bridge and your Kafka cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see <a href="#proc-config-kafka-bridge-str">Configuring the Kafka Bridge</a>.</p>
</div>
<div class="paragraph">
<p>You can use ACLs in Kafka brokers to restrict the topics that can be consumed and produced using the Kafka Bridge.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-accessing-kafka-bridge-from-outside-kafka-bridge-overview"><a class="link" href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">6.1.4. Accessing the Kafka Bridge outside of Kubernetes</a></h4>
<div class="paragraph">
<p>After deployment, the Strimzi Kafka Bridge can only be accessed by applications running in the same Kubernetes cluster. These applications use the <code><em>kafka-bridge-name</em>-bridge-service</code> Service to access the API.</p>
</div>
<div class="paragraph">
<p>If you want to make the Kafka Bridge accessible to applications running outside of the Kubernetes cluster, you can expose it manually by using one of the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Services of types LoadBalancer or NodePort</p>
</li>
<li>
<p>Ingress resources</p>
</li>
<li>
<p>OpenShift Routes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you decide to create Services, use the following labels in the <code>selector</code> to configure the pods to which the service will route the traffic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">  # ...
  selector:
    strimzi.io/cluster: kafka-bridge-name <b class="conum">(1)</b>
    strimzi.io/kind: KafkaBridge
  #...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Name of the Kafka Bridge custom resource in your Kubernetes cluster.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-requests-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-requests-kafka-bridge-kafka-bridge-overview">6.1.5. Requests to the Kafka Bridge</a></h4>
<div class="paragraph">
<p>Specify data formats and HTTP headers to ensure valid requests are submitted to the Kafka Bridge.</p>
</div>
<div class="sect4">
<h5 id="content_type_headers"><a class="link" href="#content_type_headers">Content Type headers</a></h5>
<div class="paragraph">
<p>API request and response bodies are always encoded as JSON.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When performing consumer operations, <code>POST</code> requests must provide the following <code>Content-Type</code> header if there is a non-empty body:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Content-Type: application/vnd.kafka.v2+json</code></pre>
</div>
</div>
</li>
<li>
<p>When performing producer operations, <code>POST</code> requests must provide <code>Content-Type</code> headers specifying the <em>embedded data format</em> of the messages produced. This can be either <code>json</code> or <code>binary</code>.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Embedded data format</th>
<th class="tableblock halign-left valign-top">Content-Type header</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Content-Type: application/vnd.kafka.json.v2+json</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Binary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Content-Type: application/vnd.kafka.binary.v2+json</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>The embedded data format is set per consumer, as described in the next section.</p>
</div>
<div class="paragraph">
<p>The <code>Content-Type</code> must <em>not</em> be set if the <code>POST</code> request has an empty body.
An empty body can be used to create a consumer with the default values.</p>
</div>
</div>
<div class="sect4">
<h5 id="embedded_data_format"><a class="link" href="#embedded_data_format">Embedded data format</a></h5>
<div class="paragraph">
<p>The embedded data format is the format of the Kafka messages that are transmitted, over HTTP, from a producer to a consumer using the Kafka Bridge. Two embedded data formats are supported: JSON and binary.</p>
</div>
<div class="paragraph">
<p>When creating a consumer using the <code>/consumers/<em>groupid</em></code> endpoint, the <code>POST</code> request body must specify an embedded data format of either JSON or binary. This is specified in the <code>format</code> field, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "name": "my-consumer",
  "format": "binary", <b class="conum">(1)</b>
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A binary embedded data format.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The embedded data format specified when creating a consumer must match the data format of the Kafka messages it will consume.</p>
</div>
<div class="paragraph">
<p>If you choose to specify a binary embedded data format, subsequent producer requests must provide the binary data in the request body as Base64-encoded strings. For example, when sending messages using the <code>/topics/<em>topicname</em></code> endpoint, <code>records.value</code> must be encoded in Base64:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">{
  "records": [
    {
      "key": "my-key",
      "value": "ZWR3YXJkdGhldGhyZWVsZWdnZWRjYXQ="
    },
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Producer requests must also provide a <code>Content-Type</code> header that corresponds to the embedded data format, for example, <code>Content-Type: application/vnd.kafka.binary.v2+json</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="message_format"><a class="link" href="#message_format">Message format</a></h5>
<div class="paragraph">
<p>When sending messages using the <code>/topics</code> endpoint, you enter the message payload in the request body, in the <code>records</code> parameter.</p>
</div>
<div class="paragraph">
<p>The <code>records</code> parameter can contain any of these optional fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message <code>headers</code></p>
</li>
<li>
<p>Message <code>key</code></p>
</li>
<li>
<p>Message <code>value</code></p>
</li>
<li>
<p>Destination <code>partition</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>POST</code> request to /topics</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST \
  http://localhost:8080/topics/my-topic \
  -H 'content-type: application/vnd.kafka.json.v2+json' \
  -d '{
    "records": [
        {
            "key": "my-key",
            "value": "sales-lead-0001"
            "partition": 2
            "headers": [
              {
                "key": "key1",
                "value": "QXBhY2hlIEthZmthIGlzIHRoZSBib21iIQ==" <b class="conum">(1)</b>
              }
            ]
        },
    ]
}'</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The header value in binary format and encoded as Base64.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="accept_headers"><a class="link" href="#accept_headers">Accept headers</a></h5>
<div class="paragraph">
<p>After creating a consumer, all subsequent GET requests must provide an <code>Accept</code> header in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Accept: application/vnd.kafka.<em>EMBEDDED-DATA-FORMAT</em>.v2+json</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EMBEDDED-DATA-FORMAT</code> is either <code>json</code> or <code>binary</code>.</p>
</div>
<div class="paragraph">
<p>For example, when retrieving records for a subscribed consumer using an embedded data format of JSON, include this Accept header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Accept: application/vnd.kafka.json.v2+json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-requests-kafka-bridge-cors-kafka-bridge-overview"><a class="link" href="#con-requests-kafka-bridge-cors-kafka-bridge-overview">6.1.6. CORS</a></h4>
<div class="paragraph">
<p>Cross-Origin Resource Sharing (CORS) allows you to specify allowed methods and originating URLs for accessing the Kafka cluster in your <a href="#proc-config-kafka-bridge-str">Kafka Bridge HTTP configuration</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example CORS configuration for Kafka Bridge</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
cors:
  allowedOrigins: "https://strimzi.io"
  allowedMethods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>CORS allows for <em>simple</em> and <em>preflighted</em> requests between origin sources on different domains.</p>
</div>
<div class="paragraph">
<p>Simple requests are suitable for standard requests using <code>GET</code>, <code>HEAD</code>, <code>POST</code> methods.</p>
</div>
<div class="paragraph">
<p>A preflighted request sends a <em>HTTP OPTIONS</em> request as an initial check that the actual request is safe to send.
On confirmation, the actual request is sent.
Preflight requests are suitable for methods that require greater safeguards, such as <code>PUT</code> and <code>DELETE</code>,
and use non-standard headers.</p>
</div>
<div class="paragraph">
<p>All requests require an <code>Origin</code> value in their header, which is the source of the HTTP request.</p>
</div>
<div class="sect4">
<h5 id="simple_request"><a class="link" href="#simple_request">Simple request</a></h5>
<div class="paragraph">
<p>For example, this simple request header specifies the origin as <code>https://strimzi.io</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">Origin: https://strimzi.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>The header information is added to the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">curl -v -X GET <em>HTTP-ADDRESS</em>/bridge-consumer/records \
-H 'Origin: https://strimzi.io'\
-H 'content-type: application/vnd.kafka.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the response from the Kafka Bridge, an <code>Access-Control-Allow-Origin</code> header is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Access-Control-Allow-Origin: * <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Returning an asterisk (<code>*</code>) shows the resource can be accessed by any domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="preflighted_request"><a class="link" href="#preflighted_request">Preflighted request</a></h5>
<div class="paragraph">
<p>An initial preflight request is sent to Kafka Bridge using an <code>OPTIONS</code> method.
The <em>HTTP OPTIONS</em> request sends header information to check that Kafka Bridge will allow the actual request.</p>
</div>
<div class="paragraph">
<p>Here the preflight request checks that a <code>POST</code> request is valid from <code>https://strimzi.io</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">OPTIONS /my-group/instances/my-user/subscription HTTP/1.1
Origin: https://strimzi.io
Access-Control-Request-Method: POST <b class="conum">(1)</b>
Access-Control-Request-Headers: Content-Type <b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Kafka Bridge is alerted that the actual request is a <code>POST</code> request.</p>
</li>
<li>
<p>The actual request will be sent with a <code>Content-Type</code> header.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>OPTIONS</code> is added to the header information of the preflight request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">curl -v -X OPTIONS -H 'Origin: https://strimzi.io' \
-H 'Access-Control-Request-Method: POST' \
-H 'content-type: application/vnd.kafka.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka Bridge responds to the initial request to confirm that the request will be accepted.
The response header returns allowed origins, methods and headers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://strimzi.io
Access-Control-Allow-Methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
Access-Control-Allow-Headers: content-type</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the origin or method is rejected, an error message is returned.</p>
</div>
<div class="paragraph">
<p>The actual request does not require <code>Access-Control-Request-Method</code> header, as it was confirmed in the preflight request,
but it does require the origin header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">curl -v -X POST <em>HTTP-ADDRESS</em>/topics/bridge-topic \
-H 'Origin: https://strimzi.io' \
-H 'content-type: application/vnd.kafka.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response shows the originating URL is allowed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Access-Control-Allow-Origin: https://strimzi.io</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="https://www.w3.org/TR/cors/" target="_blank" rel="noopener">Fetch</a> CORS specification</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ref-api-resources-kafka-bridge-kafka-bridge-overview"><a class="link" href="#ref-api-resources-kafka-bridge-kafka-bridge-overview">6.1.7. Kafka Bridge API resources</a></h4>
<div class="paragraph">
<p>For the full list of REST API endpoints and descriptions, including example requests and responses, see the <a href="https://strimzi.io/docs/bridge/latest/" target="_blank" rel="noopener">Kafka Bridge API reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-deployment-kafka-bridge-kafka-bridge-overview"><a class="link" href="#con-deployment-kafka-bridge-kafka-bridge-overview">6.1.8. Kafka Bridge deployment</a></h4>
<div class="paragraph">
<p>You deploy the Kafka Bridge into your Kubernetes cluster by using the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>After the Kafka Bridge is deployed, the Cluster Operator creates Kafka Bridge objects in your Kubernetes cluster.
Objects include the <em>deployment</em>, <em>service</em>, and <em>pod</em>, each named after the name given in the custom resource for the Kafka Bridge.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For deployment instructions, see <a href="./deploying.html#deploying-kafka-bridge-str" target="_blank" rel="noopener">Deploying Kafka Bridge to your Kubernetes cluster</a> in the <em>Deploying Strimzi</em> guide.</p>
</li>
<li>
<p>For detailed information on configuring the Kafka Bridge, see <a href="#assembly-config-kafka-bridge-str">Kafka Bridge cluster configuration</a></p>
</li>
<li>
<p>For information on configuring the host and port for the <code>KafkaBridge</code> resource, see <a href="#proc-config-kafka-bridge-str">Configuring the Kafka Bridge</a>.</p>
</li>
<li>
<p>For information on integrating external clients, see <a href="#con-accessing-kafka-bridge-from-outside-kafka-bridge-overview">Accessing the Kafka Bridge outside of Kubernetes</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-kafka-bridge-quickstart-str"><a class="link" href="#assembly-kafka-bridge-quickstart-str">6.2. Kafka Bridge quickstart</a></h3>
<div class="paragraph">
<p>Use this quickstart to try out the Strimzi Kafka Bridge in your local development environment. You will learn how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy the Kafka Bridge to your Kubernetes cluster</p>
</li>
<li>
<p>Expose the Kafka Bridge service to your local machine by using port-forwarding</p>
</li>
<li>
<p>Produce messages to topics and partitions in your Kafka cluster</p>
</li>
<li>
<p>Create a Kafka Bridge consumer</p>
</li>
<li>
<p>Perform basic consumer operations, such as subscribing the consumer to topics and retrieving the messages that you produced</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this quickstart, HTTP requests are formatted as curl commands that you can copy and paste to your terminal. Access to a Kubernetes cluster is required; to run and manage a local Kubernetes cluster, use a tool such as Minikube, CodeReady Containers, or MiniShift.</p>
</div>
<div class="paragraph">
<p>Ensure you have the prerequisites and then follow the tasks in the order provided in this chapter.</p>
</div>
<div class="paragraph">
<div class="title">About data formats</div>
<p>In this quickstart, you will produce and consume messages in JSON format, not binary. For more information on the data formats and HTTP headers used in the example requests, see <a href="#con-requests-kafka-bridge-kafka-bridge-overview">Requests to the Kafka Bridge</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites for the quickstart</div>
<ul>
<li>
<p>Cluster administrator access to a local or remote Kubernetes cluster.</p>
</li>
<li>
<p>Strimzi is installed.</p>
</li>
<li>
<p>A running Kafka cluster, deployed by the Cluster Operator, in a Kubernetes namespace.</p>
</li>
<li>
<p>The Entity Operator is deployed and running as part of the Kafka cluster.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart"><a class="link" href="#proc-deploying-kafka-bridge-quickstart-kafka-bridge-quickstart">6.2.1. Deploying the Kafka Bridge to your Kubernetes cluster</a></h4>
<div class="paragraph">
<p>Strimzi includes a YAML example that specifies the configuration of the Strimzi Kafka Bridge. Make some minimal changes to this file and then deploy an instance of the Kafka Bridge to your Kubernetes cluster.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>examples/bridge/kafka-bridge.yaml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: quickstart <b class="conum">(1)</b>
spec:
  replicas: 1
  bootstrapServers: &lt;cluster-name&gt;-kafka-bootstrap:9092 <b class="conum">(2)</b>
  http:
    port: 8080</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When the Kafka Bridge is deployed, <code>-bridge</code> is appended to the name of the deployment and other related resources. In this example, the Kafka Bridge deployment is named <code>quickstart-bridge</code> and the accompanying Kafka Bridge service is named <code>quickstart-bridge-service</code>.</p>
</li>
<li>
<p>In the <code>bootstrapServers</code> property, enter the name of the Kafka cluster as the <code>&lt;cluster-name&gt;</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Deploy the Kafka Bridge to your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/bridge/kafka-bridge.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>quickstart-bridge</code> deployment, service, and other related resources are created in your Kubernetes cluster.</p>
</div>
</li>
<li>
<p>Verify that the Kafka Bridge was successfully deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get deployments</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
quickstart-bridge                  1/1     1            1          34m
my-cluster-connect                 1/1     1            1          24h
my-cluster-entity-operator         1/1     1            1          24h
#...</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After deploying the Kafka Bridge to your Kubernetes cluster, <a href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">expose the Kafka Bridge service to your local machine</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more detailed information about configuring the Kafka Bridge, see <a href="#assembly-config-kafka-bridge-str">Kafka Bridge cluster configuration</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart"><a class="link" href="#proc-exposing-kafka-bridge-service-local-machine-kafka-bridge-quickstart">6.2.2. Exposing the Kafka Bridge service to your local machine</a></h4>
<div class="paragraph">
<p>Next, use port forwarding to expose the Strimzi Kafka Bridge service to your local machine on <a href="http://localhost:8080" class="bare">http://localhost:8080</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Port forwarding is only suitable for development and testing purposes.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>List the names of the pods in your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get pods -o name

pod/kafka-consumer
# ...
pod/quickstart-bridge-589d78784d-9jcnr
pod/strimzi-cluster-operator-76bcf9bc76-8dnfm</code></pre>
</div>
</div>
</li>
<li>
<p>Connect to the <code>quickstart-bridge</code> pod on port <code>8080</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl port-forward pod/quickstart-bridge-589d78784d-9jcnr 8080:8080 &amp;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If port 8080 on your local machine is already in use, use an alternative HTTP port, such as <code>8008</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>API requests are now forwarded from port 8080 on your local machine to port 8080 in the Kafka Bridge pod.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart"><a class="link" href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">6.2.3. Producing messages to topics and partitions</a></h4>
<div class="paragraph">
<p>Next, produce messages to topics in JSON format by using the <a href="https://strimzi.io/docs/bridge/latest/#_send" target="_blank" rel="noopener">topics</a> endpoint. You can specify destination partitions for messages in the request body, as shown here. The <a href="https://strimzi.io/docs/bridge/latest/#_sendtopartition" target="_blank" rel="noopener">partitions</a> endpoint provides an alternative method for specifying a single destination partition for all messages as a path parameter.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In a text editor, create a YAML definition for a Kafka topic with three partitions.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaTopic
metadata:
  name: bridge-quickstart-topic
  labels:
    strimzi.io/cluster: &lt;kafka-cluster-name&gt; <b class="conum">(1)</b>
spec:
  partitions: 3 <b class="conum">(2)</b>
  replicas: 1
  config:
    retention.ms: 7200000
    segment.bytes: 1073741824</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The name of the Kafka cluster in which the Kafka Bridge is deployed.</p>
</li>
<li>
<p>The number of partitions for the topic.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Save the file to the <code>examples/topic</code> directory as <code>bridge-quickstart-topic.yaml</code>.</p>
</li>
<li>
<p>Create the topic in your Kubernetes cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f examples/topic/bridge-quickstart-topic.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Using the Kafka Bridge, produce three messages to the topic you created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST \
  http://localhost:8080/topics/bridge-quickstart-topic \
  -H 'content-type: application/vnd.kafka.json.v2+json' \
  -d '{
    "records": [
        {
            "key": "my-key",
            "value": "sales-lead-0001"
        },
        {
            "value": "sales-lead-0002",
            "partition": 2
        },
        {
            "value": "sales-lead-0003"
        }
    ]
}'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sales-lead-0001</code> is sent to a partition based on the hash of the key.</p>
</li>
<li>
<p><code>sales-lead-0002</code> is sent directly to partition 2.</p>
</li>
<li>
<p><code>sales-lead-0003</code> is sent to a partition in the <code>bridge-quickstart-topic</code> topic using a round-robin method.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the request is successful, the Kafka Bridge returns an <code>offsets</code> array, along with a <code>200</code> code and a <code>content-type</code> header of <code>application/vnd.kafka.v2+json</code>. For each message, the <code>offsets</code> array describes:</p>
<div class="ulist">
<ul>
<li>
<p>The partition that the message was sent to</p>
</li>
<li>
<p>The current message offset of the partition</p>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">#...
{
  "offsets":[
    {
      "partition":0,
      "offset":0
    },
    {
      "partition":2,
      "offset":0
    },
    {
      "partition":0,
      "offset":1
    }
  ]
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After producing messages to topics and partitions, <a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">create a Kafka Bridge consumer</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_send" target="_blank" rel="noopener">POST /topics/{topicname}</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_sendtopartition" target="_blank" rel="noopener">POST /topics/{topicname}/partitions/{partitionid}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">6.2.4. Creating a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Before you can perform any consumer operations in the Kafka cluster, you must first create a consumer by using the <a href="https://strimzi.io/docs/bridge/latest/#_createconsumer" target="_blank" rel="noopener">consumers</a> endpoint. The consumer is referred to as a <em>Kafka Bridge consumer</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka Bridge consumer in a new consumer group named <code>bridge-quickstart-consumer-group</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "name": "bridge-quickstart-consumer",
    "auto.offset.reset": "earliest",
    "format": "json",
    "enable.auto.commit": false,
    "fetch.min.bytes": 512,
    "consumer.request.timeout.ms": 30000
  }'</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The consumer is named <code>bridge-quickstart-consumer</code> and the embedded data format is set as <code>json</code>.</p>
</li>
<li>
<p>Some basic configuration settings are defined.</p>
</li>
<li>
<p>The consumer will not commit offsets to the log automatically because the <code>enable.auto.commit</code> setting is <code>false</code>. You will commit the offsets manually later in this quickstart.</p>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns the consumer ID (<code>instance_id</code>) and base URL (<code>base_uri</code>) in the response body, along with a <code>200</code> code.</p>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">#...
{
  "instance_id": "bridge-quickstart-consumer",
  "base_uri":"http://&lt;bridge-name&gt;-bridge-service:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the base URL (<code>base_uri</code>) to use in the other consumer operations in this quickstart.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>Now that you have created a Kafka Bridge consumer, you can  <a href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">subscribe it to topics</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_createconsumer" target="_blank" rel="noopener">POST /consumers/{groupid}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-subscribing-consumer-topics-kafka-bridge-quickstart">6.2.5. Subscribing a Kafka Bridge consumer to topics</a></h4>
<div class="paragraph">
<p>After you have created a Kafka Bridge consumer, subscribe it to one or more topics by using the <a href="https://strimzi.io/docs/bridge/latest/#_subscribe" target="_blank" rel="noopener">subscription</a> endpoint. Once subscribed, the consumer starts receiving all messages that are produced to the topic.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Subscribe the consumer to the <code>bridge-quickstart-topic</code> topic that you created earlier, in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/subscription \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "topics": [
        "bridge-quickstart-topic"
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>topics</code> array can contain a single topic (as shown here) or multiple topics. If you want to subscribe the consumer to multiple topics that match a regular expression, you can use the <code>topic_pattern</code> string instead of the <code>topics</code> array.</p>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> (No Content) code only.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After subscribing a Kafka Bridge consumer to topics, you can <a href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">retrieve messages from the consumer</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_subscribe" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/subscription</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-retrieving-latest-messages-from-consumer-kafka-bridge-quickstart">6.2.6. Retrieving the latest messages from a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Next, retrieve the latest messages from the Kafka Bridge consumer by requesting data from the <a href="https://strimzi.io/docs/bridge/latest/#_poll" target="_blank" rel="noopener">records</a> endpoint. In production, HTTP clients can call this endpoint repeatedly (in a loop).</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Produce additional messages to the Kafka Bridge consumer, as described in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>.</p>
</li>
<li>
<p>Submit a <code>GET</code> request to the <code>records</code> endpoint:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X GET http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/records \
  -H 'accept: application/vnd.kafka.json.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating and subscribing to a Kafka Bridge consumer, a first GET request will return an empty response because the poll operation starts a rebalancing process to assign partitions.</p>
</div>
</li>
<li>
<p>Repeat step two to retrieve messages from the Kafka Bridge consumer.</p>
<div class="paragraph">
<p>The Kafka Bridge returns an array of messages&#8201;&#8212;&#8201;describing the topic name, key, value, partition, and offset&#8201;&#8212;&#8201;in the response body, along with a <code>200</code> code. Messages are retrieved from the latest offset by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">HTTP/1.1 200 OK
content-type: application/vnd.kafka.json.v2+json
#...
[
  {
    "topic":"bridge-quickstart-topic",
    "key":"my-key",
    "value":"sales-lead-0001",
    "partition":0,
    "offset":0
  },
  {
    "topic":"bridge-quickstart-topic",
    "key":null,
    "value":"sales-lead-0003",
    "partition":0,
    "offset":1
  },
#...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If an empty response is returned, produce more records to the consumer as described in <a href="#proc-producing-messages-from-bridge-topics-partitions-kafka-bridge-quickstart">Producing messages to topics and partitions</a>, and then try retrieving messages again.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After retrieving messages from a Kafka Bridge consumer, try <a href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">committing offsets to the log</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_poll" target="_blank" rel="noopener">GET /consumers/{groupid}/instances/{name}/records</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-committing-consumer-offsets-to-log-kafka-bridge-quickstart">6.2.7. Commiting offsets to the log</a></h4>
<div class="paragraph">
<p>Next, use the <a href="https://strimzi.io/docs/bridge/latest/#_commit" target="_blank" rel="noopener">offsets</a> endpoint to manually commit  offsets to the log for all messages received by the Kafka Bridge consumer. This is required because the Kafka Bridge consumer that you created earlier, in <a href="#proc-creating-kafka-bridge-consumer-kafka-bridge-quickstart">Creating a Kafka Bridge consumer</a>, was configured with the <code>enable.auto.commit</code> setting as <code>false</code>.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Commit offsets to the log for the <code>bridge-quickstart-consumer</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/offsets</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because no request body is submitted, offsets are committed for all the records that have been received by the consumer. Alternatively, the request body can contain an array (<a href="https://strimzi.io/docs/bridge/latest/#_offsetcommitseeklist" target="_blank" rel="noopener">OffsetCommitSeekList</a>) that specifies the topics and partitions that you want to commit offsets for.</p>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After committing offsets to the log, try out the endpoints for <a href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">seeking to offsets</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_commit">POST /consumers/{groupid}/instances/{name}/offsets</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-seeking-offset-for-partition-kafka-bridge-quickstart">6.2.8. Seeking to offsets for a partition</a></h4>
<div class="paragraph">
<p>Next, use the <a href="https://strimzi.io/docs/bridge/latest/#_seek" target="_blank" rel="noopener">positions</a> endpoints to configure the Kafka Bridge consumer to retrieve messages for a partition from a specific offset, and then from the latest offset. This is referred to in Apache Kafka as a seek operation.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Seek to a specific offset for partition 0 of the <code>quickstart-bridge-topic</code> topic:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/positions \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "offsets": [
        {
            "topic": "bridge-quickstart-topic",
            "partition": 0,
            "offset": 2
        }
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
<li>
<p>Submit a <code>GET</code> request to the <code>records</code> endpoint:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X GET http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/records \
  -H 'accept: application/vnd.kafka.json.v2+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kafka Bridge returns messages from the offset that you seeked to.</p>
</div>
</li>
<li>
<p>Restore the default message retrieval behavior by seeking to the last offset for the same partition. This time, use the <a href="https://strimzi.io/docs/bridge/latest/#_seektoend" target="_blank" rel="noopener">positions/end</a> endpoint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X POST http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer/positions/end \
  -H 'content-type: application/vnd.kafka.v2+json' \
  -d '{
    "partitions": [
        {
            "topic": "bridge-quickstart-topic",
            "partition": 0
        }
    ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns another <code>204</code> code.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can also use the <a href="https://strimzi.io/docs/bridge/latest/#_seektobeginning" target="_blank" rel="noopener">positions/beginning</a> endpoint to seek to the first offset for one or more partitions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>In this quickstart, you have used the Strimzi Kafka Bridge to perform several common operations on a Kafka cluster. You can now <a href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">delete the Kafka Bridge consumer</a> that you created earlier.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seek" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seektobeginning" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions/beginning</a> in the API reference documentation.</p>
</li>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_seektoend" target="_blank" rel="noopener">POST /consumers/{groupid}/instances/{name}/positions/end</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-bridge-deleting-consumer-kafka-bridge-quickstart"><a class="link" href="#proc-bridge-deleting-consumer-kafka-bridge-quickstart">6.2.9. Deleting a Kafka Bridge consumer</a></h4>
<div class="paragraph">
<p>Finally, delete the Kafa Bridge consumer that you used throughout this quickstart.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Delete the Kafka Bridge consumer by sending a <code>DELETE</code> request to the <a href="https://strimzi.io/docs/bridge/latest/#_deleteconsumer" target="_blank" rel="noopener">instances</a> endpoint.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -X DELETE http://localhost:8080/consumers/bridge-quickstart-consumer-group/instances/bridge-quickstart-consumer</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the request is successful, the Kafka Bridge returns a <code>204</code> code only.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://strimzi.io/docs/bridge/latest/#_deleteconsumer" target="_blank" rel="noopener">DELETE /consumers/{groupid}/instances/{name}</a> in the API reference documentation.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cruise-control-concepts-str"><a class="link" href="#cruise-control-concepts-str">7. Cruise Control for cluster rebalancing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can deploy <a href="https://github.com/linkedin/cruise-control" target="_blank" rel="noopener">Cruise Control</a> to your Strimzi cluster and use it to <em>rebalance</em> the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Cruise Control is an open source system for automating Kafka operations, such as monitoring cluster workload, rebalancing a cluster based on predefined constraints, and detecting and fixing anomalies.
It consists of four main components&#8212;&#8203;the Load Monitor, the Analyzer, the Anomaly Detector, and the Executor&#8212;&#8203;and a REST API for client interactions.
Strimzi utilizes the REST API to support the following Cruise Control features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generating <em>optimization proposals</em> from multiple <em>optimization goals</em>.</p>
</li>
<li>
<p>Rebalancing a Kafka cluster based on an optimization proposal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other Cruise Control features are not currently supported, including anomaly detection, notifications, write-your-own goals, and changing the topic replication factor.</p>
</div>
<div class="paragraph">
<p>Example YAML files for Cruise Control are provided in <code>examples/cruise-control/</code>.</p>
</div>
<div class="sect2">
<h3 id="con-cruise-control-overview-str"><a class="link" href="#con-cruise-control-overview-str">7.1. Why use Cruise Control?</a></h3>
<div class="paragraph">
<p>Cruise Control reduces the time and effort involved in running an efficient and balanced Kafka cluster.</p>
</div>
<div class="paragraph">
<p>A typical cluster can become unevenly loaded over time.
Partitions that handle large amounts of message traffic might be unevenly distributed across the available brokers.
To rebalance the cluster, administrators must monitor the load on brokers and manually reassign busy partitions to brokers with spare capacity.</p>
</div>
<div class="paragraph">
<p>Cruise Control automates the cluster rebalancing process.
It constructs a <em>workload model</em> of resource utilization for the cluster&#8212;&#8203;based on CPU, disk, and network load&#8212;&#8203;and generates optimization proposals (that you can approve or reject) for more balanced partition assignments.
A set of configurable optimization goals is used to calculate these proposals.</p>
</div>
<div class="paragraph">
<p>When you approve an optimization proposal, Cruise Control applies it to your Kafka cluster.
When the cluster rebalancing operation is complete, the broker pods are used more effectively and the Kafka cluster is more evenly balanced.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://github.com/linkedin/cruise-control/wiki" target="_blank" rel="noopener">Cruise Control Wiki</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-optimization-goals-str"><a class="link" href="#con-optimization-goals-str">7.2. Optimization goals overview</a></h3>
<div class="paragraph">
<p>To rebalance a Kafka cluster, Cruise Control uses optimization goals to generate <a href="#con-optimization-proposals-str">optimization proposals</a>, which you can approve or reject.</p>
</div>
<div class="paragraph">
<p>Optimization goals are constraints on workload redistribution and resource utilization across a Kafka cluster.
Strimzi supports most of the optimization goals developed in the Cruise Control project.
The supported goals, in the default descending order of priority, are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Rack-awareness</p>
</li>
<li>
<p>Replica capacity</p>
</li>
<li>
<p><em>Capacity</em>: Disk capacity, Network inbound capacity, Network outbound capacity, CPU capacity</p>
</li>
<li>
<p>Replica distribution</p>
</li>
<li>
<p>Potential network output</p>
</li>
<li>
<p><em>Resource distribution</em>: Disk utilization distribution, Network inbound utilization distribution, Network outbound utilization distribution, CPU utilization distribution</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The resource distribution goals are controlled using <a href="#capacity-configuration">capacity limits</a> on broker resources.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Leader bytes-in rate distribution</p>
</li>
<li>
<p>Topic replica distribution</p>
</li>
<li>
<p>Leader replica distribution</p>
</li>
<li>
<p>Preferred leader election</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information on each optimization goal, see <a href="https://github.com/linkedin/cruise-control/wiki/Pluggable-Components#goals" target="_blank" rel="noopener">Goals</a> in the Cruise Control Wiki.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Intra-broker disk goals, "Write your own" goals, and Kafka assigner goals are not yet supported.
</td>
</tr>
</table>
</div>
<h4 id="goals_configuration_in_strimzi_custom_resources" class="discrete">Goals configuration in Strimzi custom resources</h4>
<div class="paragraph">
<p>You configure optimization goals in <code>Kafka</code> and <code>KafkaRebalance</code> custom resources. Cruise Control has configurations for <a href="#hard-soft-goals">hard</a> optimization goals that must be satisfied, as well as <a href="#master-goals">master</a>, <a href="#default-goals">default</a>, and <a href="#user-provided-goals">user-provided</a> optimization goals.
Optimization goals for resource distribution (disk, network inbound, network outbound, and CPU) are subject to <a href="#capacity-configuration">capacity limits</a> on broker resources.</p>
</div>
<div class="paragraph">
<p>The following sections describe each goal configuration in more detail.</p>
</div>
<h5 id="hard-soft-goals" class="discrete">Hard goals and soft goals</h5>
<div class="paragraph">
<p>Hard goals are goals that <em>must</em> be satisfied in optimization proposals.
Goals that are not configured as hard goals are known as <em>soft goals</em>.
You can think of soft goals as <em>best effort</em> goals: they do <em>not</em> need to be satisfied in optimization proposals, but are included in optimization calculations.
An optimization proposal that violates one or more soft goals, but satisfies all hard goals, is valid.</p>
</div>
<div class="paragraph">
<p>Cruise Control will calculate optimization proposals that satisfy all the hard goals and as many soft goals as possible (in their priority order).
An optimization proposal that does <em>not</em> satisfy all the hard goals is rejected by Cruise Control and not sent to the user for approval.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For example, you might have a soft goal to distribute a topic&#8217;s replicas evenly across the cluster (the topic replica distribution goal).
Cruise Control will ignore this goal if doing so enables all the configured hard goals to be met.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Cruise Control, the following <a href="#master-goals">master optimization goals</a> are preset as hard goals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal</code></pre>
</div>
</div>
<div class="paragraph">
<p>You configure hard goals in the Cruise Control deployment configuration, by editing the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To inherit the preset hard goals from Cruise Control, do not specify the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code></p>
</li>
<li>
<p>To change the preset hard goals, specify the desired goals in the <code>hard.goals</code> property, using their fully-qualified domain names.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> configuration for hard optimization goals</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}
  cruiseControl:
    brokerCapacity:
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
    config:
      hard.goals: &gt;
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkInboundCapacityGoal,
        com.linkedin.kafka.cruisecontrol.analyzer.goals.NetworkOutboundCapacityGoal
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Increasing the number of configured hard goals will reduce the likelihood of Cruise Control generating valid optimization proposals.</p>
</div>
<div class="paragraph">
<p>If <code>skipHardGoalCheck: true</code> is specified in the <code>KafkaRebalance</code> custom resource, Cruise Control does <em>not</em> check that the list of user-provided optimization goals (in <code>KafkaRebalance.spec.goals</code>) contains <em>all</em> the configured hard goals (<code>hard.goals</code>).
Therefore, if some, but not all, of the user-provided optimization goals are in the <code>hard.goals</code> list, Cruise Control will still treat them as hard goals even if <code>skipHardGoalCheck: true</code> is specified.</p>
</div>
<h5 id="master-goals" class="discrete">Master optimization goals</h5>
<div class="paragraph">
<p>The <em>master optimization goals</em> are available to all users.
Goals that are not listed in the master optimization goals are not available for use in Cruise Control operations.</p>
</div>
<div class="paragraph">
<p>Unless you change the Cruise Control <a href="#proc-deploying-cruise-control-str">deployment configuration</a>, Strimzi will inherit the following master optimization goals from Cruise Control, in descending priority order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">RackAwareGoal; ReplicaCapacityGoal; DiskCapacityGoal; NetworkInboundCapacityGoal; NetworkOutboundCapacityGoal; CpuCapacityGoal; ReplicaDistributionGoal; PotentialNwOutGoal; DiskUsageDistributionGoal; NetworkInboundUsageDistributionGoal; NetworkOutboundUsageDistributionGoal; CpuUsageDistributionGoal; TopicReplicaDistributionGoal; LeaderReplicaDistributionGoal; LeaderBytesInDistributionGoal; PreferredLeaderElectionGoal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Six of these goals are preset as <a href="#hard-soft-goals">hard goals</a>.</p>
</div>
<div class="paragraph">
<p>To reduce complexity, we recommend that you use the inherited master optimization goals, unless you need to <em>completely</em> exclude one or more goals from use in <code>KafkaRebalance</code> resources. The priority order of the master optimization goals can be modified, if desired, in the configuration for <a href="#default-goals">default optimization goals</a>.</p>
</div>
<div class="paragraph">
<p>You configure master optimization goals, if necessary, in the Cruise Control deployment configuration: <code>Kafka.spec.cruiseControl.config.goals</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>To accept the inherited master optimization goals, do not specify the <code>goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>If you need to modify the inherited master optimization goals, specify a list of goals, in descending priority order, in the <code>goals</code> configuration option.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you change the inherited master optimization goals, you must ensure that the hard goals, if configured in the <code>hard.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>, are a subset of the master optimization goals that you configured. Otherwise, errors will occur when generating optimization proposals.
</td>
</tr>
</table>
</div>
<h5 id="default-goals" class="discrete">Default optimization goals</h5>
<div class="paragraph">
<p>Cruise Control uses the <em>default optimization goals</em> to generate the <em>cached optimization proposal</em>.
For more information about the cached optimization proposal, see <a href="#con-optimization-proposals-str">Optimization proposals overview</a>.</p>
</div>
<div class="paragraph">
<p>You can override the default optimization goals by setting <a href="#user-provided-goals">user-provided optimization goals</a> in a <code>KafkaRebalance</code> custom resource.</p>
</div>
<div class="paragraph">
<p>Unless you specify <code>default.goals</code> in the Cruise Control <a href="#proc-deploying-cruise-control-str">deployment configuration</a>, the master optimization goals are used as the default optimization goals.
In this case, the cached optimization proposal is generated using the master optimization goals.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use the master optimization goals as the default goals, do not specify the <code>default.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>To modify the default optimization goals, edit the <code>default.goals</code> property in <code>Kafka.spec.cruiseControl.config</code>.
You must use a subset of the master optimization goals.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> configuration for default optimization goals</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
  zookeeper:
    # ...
  entityOperator:
    topicOperator: {}
    userOperator: {}
  cruiseControl:
    brokerCapacity:
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
    config:
      default.goals: &gt;
         com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
         com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal,
         com.linkedin.kafka.cruisecontrol.analyzer.goals.DiskCapacityGoal
      # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no default optimization goals are specified, the cached proposal is generated using the master optimization goals.</p>
</div>
<h5 id="user-provided-goals" class="discrete">User-provided optimization goals</h5>
<div class="paragraph">
<p><em>User-provided optimization goals</em> narrow down the configured default goals for a particular optimization proposal.
You can set them, as required, in <code>spec.goals</code> in a <code>KafkaRebalance</code> custom resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>KafkaRebalance.spec.goals</pre>
</div>
</div>
<div class="paragraph">
<p>User-provided optimization goals can generate optimization proposals for different scenarios.
For example, you might want to optimize leader replica distribution across the Kafka cluster without considering disk capacity or disk utilization.
So, you create a <code>KafkaRebalance</code> custom resource containing a single user-provided goal for leader replica distribution.</p>
</div>
<div class="paragraph">
<p>User-provided optimization goals must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Include all configured <a href="#hard-soft-goals">hard goals</a>, or an error occurs</p>
</li>
<li>
<p>Be a subset of the master optimization goals</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ignore the configured hard goals when generating an optimization proposal, add the <code>skipHardGoalCheck: true</code> property to the <code>KafkaRebalance</code> custom resource. See <a href="#proc-generating-optimization-proposals-str">Generating optimization proposals</a>.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#ref-cruise-control-configuration-str">Cruise Control configuration</a></p>
</li>
<li>
<p><a href="https://github.com/linkedin/cruise-control/wiki/Configurations" target="_blank" rel="noopener">Configurations</a> in the Cruise Control Wiki.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-optimization-proposals-str"><a class="link" href="#con-optimization-proposals-str">7.3. Optimization proposals overview</a></h3>
<div class="paragraph">
<p>An <em>optimization proposal</em> is a summary of proposed changes that would produce a more balanced Kafka cluster, with partition workloads distributed more evenly among the brokers.
Each optimization proposal is based on the set of <a href="#con-optimization-goals-str">optimization goals</a> that was used to generate it, subject to any configured <a href="#capacity-configuration">capacity limits on broker resources</a>.</p>
</div>
<div class="paragraph">
<p>An optimization proposal is contained in the <code>Status.Optimization Result</code> property of a <code>KafkaRebalance</code> custom resource.
The information provided is a summary of the full optimization proposal.
Use the summary to decide whether to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Approve the optimization proposal. This instructs Cruise Control to apply the proposal to the Kafka cluster and start a cluster rebalance operation.</p>
</li>
<li>
<p>Reject the optimization proposal. You can change the optimization goals and then generate another proposal.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All optimization proposals are <em>dry runs</em>: you cannot approve a cluster rebalance without first generating an optimization proposal.
There is no limit to the number of optimization proposals that can be generated.</p>
</div>
<h4 id="cached_optimization_proposal" class="discrete">Cached optimization proposal</h4>
<div class="paragraph">
<p>Cruise Control maintains a <em>cached optimization proposal</em> based on the configured default optimization goals.
Generated from the workload model, the cached optimization proposal is updated every 15 minutes to reflect the current state of the Kafka cluster.
If you generate an optimization proposal using the default optimization goals, Cruise Control returns the most recent cached proposal.</p>
</div>
<div class="paragraph">
<p>To change the cached optimization proposal refresh interval, edit the <code>proposal.expiration.ms</code> setting in the Cruise Control deployment configuration.
Consider a shorter interval for fast changing clusters, although this increases the load on the Cruise Control server.</p>
</div>
<h4 id="contents-optimization-proposals" class="discrete">Contents of optimization proposals</h4>
<div class="paragraph">
<p>The following table describes the properties contained in an optimization proposal:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 3. Properties contained in an optimization proposal</caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 65%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numIntraBrokerReplicaMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of partition replicas that will be transferred between the disks of the cluster&#8217;s brokers.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively high, but lower than <code>numReplicaMovements</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedBrokersForLeadership</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet supported. An empty list is returned.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numReplicaMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of partition replicas that will be moved between separate brokers.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively high.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onDemandBalancednessScoreBefore, onDemandBalancednessScoreAfter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A measurement of the overall <em>balancedness</em> of a Kafka Cluster, before and after the optimization proposal was generated.</p>
<p class="tableblock">The score is calculated by subtracting the sum of the <code>BalancednessScore</code> of each violated soft goal from 100. Cruise Control assigns a <code>BalancednessScore</code> to every optimization goal based on several factors, including priority&#8212;&#8203;the goal&#8217;s position in the list of <code>default.goals</code> or user-provided goals.</p>
<p class="tableblock">The <code>Before</code> score is based on the current configuration of the Kafka cluster.
The <code>After</code> score is based on the generated optimization proposal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intraBrokerDataToMoveMB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the size of each partition replica that will be moved between disks on the same broker (see also <code>numIntraBrokerReplicaMovements</code>).</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Variable. The larger the number, the longer the cluster rebalance will take to complete. Moving a large amount of data between disks on the same broker has less impact than between separate brokers (see <code>dataToMoveMB</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recentWindows</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of metrics windows upon which the optimization proposal is based.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dataToMoveMB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sum of the size of each partition replica that will be moved to a separate broker (see also <code>numReplicaMovements</code>).</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Variable. The larger the number, the longer the cluster rebalance will take to complete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitoredPartitionsPercentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of partitions in the Kafka cluster covered by the optimization proposal. Affected by the number of <code>excludedTopics</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedTopics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you specified a regular expression in the <code>spec.excludedTopicsRegex</code> property in the <code>KafkaRebalance</code> resource, all topic names matching that expression are listed here.
These topics are excluded from the calculation of partition replica/leader movements in the optimization proposal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>numLeaderMovements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of partitions whose leaders will be switched to different replicas. This involves a change to ZooKeeper configuration.</p>
<p class="tableblock"><strong>Performance impact during rebalance operation</strong>: Relatively low.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludedBrokersForReplicaMove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet supported. An empty list is returned.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-goals-str">Optimization goals overview</a></p>
</li>
<li>
<p><a href="#proc-generating-optimization-proposals-str">Generating optimization proposals</a></p>
</li>
<li>
<p><a href="#proc-approving-optimization-proposal-str">Approving an optimization proposal</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="con-rebalance-str"><a class="link" href="#con-rebalance-str">7.4. Rebalance performance tuning overview</a></h3>
<div class="paragraph">
<p>You can adjust several performance tuning options for cluster rebalances.
These options control how partition replica and leadership movements in a rebalance are executed, as well as the bandwidth that is allocated to a rebalance operation.</p>
</div>
<h4 id="partition_reassignment_commands" class="discrete">Partition reassignment commands</h4>
<div class="paragraph">
<p><a href="#con-optimization-proposals-str">Optimization proposals</a> are comprised of separate partition reassignment commands.
When you <a href="#proc-approving-optimization-proposal-str">approve</a> a proposal, the Cruise Control server applies these commands to the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>A partition reassignment command consists of either of the following types of operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Partition movement: Involves transferring the partition replica and its data to a new location. Partition movements can take one of two forms:</p>
<div class="ulist">
<ul>
<li>
<p>Inter-broker movement: The partition replica is moved to a log directory on a different broker.</p>
</li>
<li>
<p>Intra-broker movement: The partition replica is moved to a different log directory on the same broker.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Leadership movement: This involves switching the leader of the partition&#8217;s replicas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cruise Control issues partition reassignment commands to the Kafka cluster in batches.
The performance of the cluster during the rebalance is affected by the number of each type of movement contained in each batch.</p>
</div>
<h4 id="replica_movement_strategies" class="discrete">Replica movement strategies</h4>
<div class="paragraph">
<p>Cluster rebalance performance is also influenced by the <em>replica movement strategy</em> that is applied to the batches of partition reassignment commands.
By default, Cruise Control uses the <code>BaseReplicaMovementStrategy</code>, which simply applies the commands in the order they were generated.
However, if there are some very large partition reassignments early in the proposal, this strategy can slow down the application of the other reassignments.</p>
</div>
<div class="paragraph">
<p>Cruise Control provides three alternative replica movement strategies that can be applied to optimization proposals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PrioritizeSmallReplicaMovementStrategy</code>: Order reassignments in order of ascending size.</p>
</li>
<li>
<p><code>PrioritizeLargeReplicaMovementStrategy</code>: Order reassignments in order of descending size.</p>
</li>
<li>
<p><code>PostponeUrpReplicaMovementStrategy</code>: Prioritize reassignments for replicas of partitions which have no out-of-sync replicas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These strategies can be configured as a sequence.
The first strategy attempts to compare two partition reassignments using its internal logic.
If the reassignments are equivalent, then it passes them to the next strategy in the sequence to decide the order, and so on.</p>
</div>
<h4 id="rebalance_tuning_options" class="discrete">Rebalance tuning options</h4>
<div class="paragraph">
<p>Cruise Control provides several configuration options for tuning the rebalance parameters discussed above.
You can set these tuning options at either the <a href="#ref-cruise-control-configuration-str">Cruise Control server</a> or <a href="#proc-generating-optimization-proposals-str">optimization proposal</a> levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Cruise Control server setting can be set in the Kafka custom resource under <code>Kafka.spec.cruiseControl.config</code>.</p>
</li>
<li>
<p>The individual rebalance performance configurations can be set under <code>KafkaRebalance.spec</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The relevant configurations are summarized below:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Server and <code>KafkaRebalance</code> Configuration</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>num.concurrent.partition.movements.per.broker</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of inter-broker partition movements in each partition reassignment batch</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concurrentPartitionMovementsPerBroker</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>num.concurrent.intra.broker.partition.movements</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of intra-broker partition movements in each partition reassignment batch</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concurrentIntraBrokerPartitionMovements</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>num.concurrent.leader.movements</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of partition leadership changes in each partition reassignment batch</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>concurrentLeaderMovements</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default.replication.throttle</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The bandwidth (in bytes per second) to be assigned to the reassigning of partitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">No Limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replicationThrottle</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default.replica.movement.strategies</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The list of strategies (in priority order) used to determine the order in which partition reassignment commands are executed for generated proposals.</p>
<p class="tableblock">For the server setting, use a comma separated string with the fully qualified names of the strategy class (add <code>com.linkedin.kafka.cruisecontrol.executor.strategy.</code> to the start of each class name). For the <code>KafkaRebalance</code> resource setting use a YAML array of strategy class names.</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>BaseReplicaMovementStrategy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replicaMovementStrategies</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changing the default settings affects the length of time that the rebalance takes to complete, as well as the load placed on the Kafka cluster during the rebalance.
Using lower values reduces the load but increases the amount of time taken, and vice versa.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code> schema reference</a>.</p>
</li>
<li>
<p><a href="#type-KafkaRebalanceSpec-reference"><code>KafkaRebalanceSpec</code> schema reference</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ref-cruise-control-configuration-str"><a class="link" href="#ref-cruise-control-configuration-str">7.5. Cruise Control configuration</a></h3>
<div class="paragraph">
<p>The <code>config</code> property in <code>Kafka.spec.cruiseControl</code> contains configuration options as keys with values as one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Strings that look like JSON or YAML will need to be explicitly quoted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can specify and configure all the options listed in the "Configurations" section of the <a href="https://github.com/linkedin/cruise-control/wiki/Configurations">Cruise Control documentation</a>, apart from those managed directly by Strimzi.
Specifically, you <strong>cannot</strong> modify configuration options with keys equal to or starting with one of the keys mentioned <a href="#type-CruiseControlSpec-reference">here</a>.</p>
</div>
<div class="paragraph">
<p>If restricted options are specified, they are ignored and a warning message is printed to the Cluster Operator log file.
All the supported options are passed to Cruise Control.</p>
</div>
<div class="listingblock">
<div class="title">An example Cruise Control configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    config:
      default.goals: &gt;
         com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
         com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal
      cpu.balance.threshold: 1.1
      metadata.max.age.ms: 300000
      send.buffer.bytes: 131072
    # ...</code></pre>
</div>
</div>
<h4 id="capacity-configuration" class="discrete">Capacity configuration</h4>
<div class="paragraph">
<p>Cruise Control uses <em>capacity limits</em> to determine if optimization goals for resource distribution are being broken.
There are four goals of this type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiskUsageDistributionGoal</code>            - Disk utilization distribution</p>
</li>
<li>
<p><code>CpuUsageDistributionGoal</code>             - CPU utilization distribution</p>
</li>
<li>
<p><code>NetworkInboundUsageDistributionGoal</code>  - Network inbound utilization distribution</p>
</li>
<li>
<p><code>NetworkOutboundUsageDistributionGoal</code> - Network outbound utilization distribution</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You specify capacity limits for Kafka broker resources in the <code>brokerCapacity</code> property in <code>Kafka.spec.cruiseControl</code> .
They are enabled by default and you can change their default values.
Capacity limits can be set for the following broker resources, using the standard Kubernetes byte units (K, M, G and T) or their bibyte (power of two) equivalents (Ki, Mi, Gi and Ti):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>disk</code>            - Disk storage per broker (Default: 100000Mi)</p>
</li>
<li>
<p><code>cpuUtilization</code>  - CPU utilization as a percentage (Default: 100)</p>
</li>
<li>
<p><code>inboundNetwork</code>  - Inbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
<li>
<p><code>outboundNetwork</code> - Outbound network throughput in byte units per second (Default: 10000KiB/s)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because Strimzi Kafka brokers are homogeneous, Cruise Control applies the same capacity limits to every broker it is monitoring.</p>
</div>
<div class="listingblock">
<div class="title">An example Cruise Control brokerCapacity configuration using bibyte units</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    # ...
    brokerCapacity:
      disk: 100Gi
      cpuUtilization: 100
      inboundNetwork: 10000KiB/s
      outboundNetwork: 10000KiB/s
    # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For more information, refer to the <a href="#type-BrokerCapacity-reference"><code>BrokerCapacity</code> schema reference</a>.</p>
</div>
<h4 id="logging-configuration" class="discrete">Logging configuration</h4>
<div class="paragraph">
<p>Cruise Control has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cruisecontrol.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cruise Control uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
# ...
spec:
  cruiseControl:
    # ...
    logging:
      type: inline
      loggers:
        cruisecontrol.root.logger: "INFO"
    # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
# ...
spec:
  cruiseControl:
    # ...
    logging:
      type: external
      name: customConfigMap
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-deploying-cruise-control-str"><a class="link" href="#proc-deploying-cruise-control-str">7.6. Deploying Cruise Control</a></h3>
<div class="paragraph">
<p>To deploy Cruise Control to your Strimzi cluster, define the configuration using the <code>cruiseControl</code> property in the <code>Kafka</code> resource, and then create or update the resource.</p>
</div>
<div class="paragraph">
<p>Deploy one instance of Cruise Control per Kafka cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster</p>
</li>
<li>
<p>A running Cluster Operator</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the <code>Kafka</code> resource and add the <code>cruiseControl</code> property.</p>
<div class="paragraph">
<p>The properties you can configure are shown in this example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  # ...
  cruiseControl:
    brokerCapacity: <b class="conum">(1)</b>
      inboundNetwork: 10000KB/s
      outboundNetwork: 10000KB/s
      # ...
    config: <b class="conum">(2)</b>
      default.goals: &gt;
         com.linkedin.kafka.cruisecontrol.analyzer.goals.RackAwareGoal,
         com.linkedin.kafka.cruisecontrol.analyzer.goals.ReplicaCapacityGoal
         # ...
      cpu.balance.threshold: 1.1
      metadata.max.age.ms: 300000
      send.buffer.bytes: 131072
      # ...
    resources: <b class="conum">(3)</b>
      requests:
        cpu: 200m
        memory: 64Mi
      limits:
        cpu: 500m
        memory: 128Mi
    logging: <b class="conum">(4)</b>
        type: inline
        loggers:
          cruisecontrol.root.logger: "INFO"
    template: <b class="conum">(5)</b>
      pod:
        metadata:
          labels:
            label1: value1
        securityContext:
          runAsUser: 1000001
          fsGroup: 0
        terminationGracePeriodSeconds: 120
    readinessProbe: <b class="conum">(6)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
    livenessProbe: <b class="conum">(7)</b>
      initialDelaySeconds: 15
      timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specifies capacity limits for broker resources. For more information, see <a href="#capacity-configuration">Capacity configuration</a>.</p>
</li>
<li>
<p>Defines the Cruise Control configuration, including the default optimization goals (in <code>default.goals</code>) and any customizations to the master optimization goals (in <code>goals</code>) or the hard goals (in <code>hard.goals</code>).
You can provide any <a href="#ref-cruise-control-configuration-str">standard Cruise Control configuration option</a> apart from those managed directly by Strimzi.
For more information on configuring optimization goals, see <a href="#con-optimization-goals-str">Optimization goals overview</a>.</p>
</li>
<li>
<p>CPU and memory resources reserved for Cruise Control. For more information, see <a href="#assembly-resource-limits-and-requests-deployment-configuration-kafka">CPU and memory resources</a>.</p>
</li>
<li>
<p>Defined loggers and log levels added directly (inline) or indirectly (external) through a ConfigMap. A custom ConfigMap must be placed under the log4j.properties key. Cruise Control has a single logger named <code>cruisecontrol.root.logger</code>. You can set the log level to INFO, ERROR, WARN, TRACE, DEBUG, FATAL or OFF. For more information, see <a href="#logging-configuration">Logging configuration</a>.</p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Customization of deployment templates and pods</a>.</p>
</li>
<li>
<p><a href="#assembly-healthchecks-deployment-configuration-kafka">Healthcheck readiness probes</a>.</p>
</li>
<li>
<p><a href="#assembly-healthchecks-deployment-configuration-kafka">Healthcheck liveness probes</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that Cruise Control was successfully deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get deployments -l app.kubernetes.io/name=strimzi</code></pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="auto_created_topics" class="discrete">Auto-created topics</h4>
<div class="paragraph">
<p>The following table shows the three topics that are automatically created when Cruise Control is deployed. These topics are required for Cruise Control to work properly and must not be deleted or changed.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 4. Auto-created topics</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Auto-created topic</th>
<th class="tableblock halign-left valign-top">Created by</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strimzi Metrics Reporter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the raw metrics from the Metrics Reporter in each Kafka broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.partitionmetricsamples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cruise Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the derived metrics for each partition. These are created by the <a href="https://github.com/linkedin/cruise-control/wiki/Overview#metric-sample-aggregator" target="_blank" rel="noopener">Metric Sample Aggregator</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strimzi.cruisecontrol.modeltrainingsamples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cruise Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the metrics samples used to create the <a href="https://github.com/linkedin/cruise-control/wiki/Overview#cluster-workload-model" target="_blank" rel="noopener">Cluster Workload Model</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To prevent the removal of records that are needed by Cruise Control, log compaction is disabled in the auto-created topics.</p>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p>After configuring and deploying Cruise Control, you can <a href="#proc-generating-optimization-proposals-str">generate optimization proposals</a>.</p>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p><a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code> schema reference</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-generating-optimization-proposals-str"><a class="link" href="#proc-generating-optimization-proposals-str">7.7. Generating optimization proposals</a></h3>
<div class="paragraph">
<p>When you create or update a <code>KafkaRebalance</code> resource, Cruise Control generates an <a href="#con-optimization-proposals-str">optimization proposal</a> for the Kafka cluster based on the configured <a href="#con-optimization-goals-str">optimization goals</a>.</p>
</div>
<div class="paragraph">
<p>Analyze the information in the optimization proposal and decide whether to approve it.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-deploying-cruise-control-str">deployed Cruise Control</a> to your Strimzi cluster.</p>
</li>
<li>
<p>You have configured <a href="#con-optimization-goals-str">optimization goals</a> and, optionally, <a href="#capacity-configuration">capacity limits on broker resources</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>KafkaRebalance</code> resource:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use the <em>default optimization goals</em> defined in the <code>Kafka</code> resource, leave the <code>spec</code> property empty:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec: {}</code></pre>
</div>
</div>
</li>
<li>
<p>To configure <em>user-provided optimization goals</em> instead of using the default goals, add the <code>goals</code> property and enter one or more goals.</p>
<div class="paragraph">
<p>In the following example, rack awareness and replica capacity are configured as user-provided optimization goals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  goals:
    - RackAwareGoal
    - ReplicaCapacityGoal</code></pre>
</div>
</div>
</li>
<li>
<p>To ignore the configured hard goals, add the <code>skipHardGoalCheck: true</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaRebalance
metadata:
  name: my-rebalance
  labels:
    strimzi.io/cluster: my-cluster
spec:
  goals:
    - RackAwareGoal
    - ReplicaCapacityGoal
skipHardGoalCheck: true</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>your-file</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Cluster Operator requests the optimization proposal from Cruise Control.
This might take a few minutes depending on the size of the Kafka cluster.</p>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cruise Control returns one of two statuses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PendingProposal</code>: The rebalance operator is polling the Cruise Control API to check if the optimization proposal is ready.</p>
</li>
<li>
<p><code>ProposalReady</code>: The optimization proposal is ready for review and, if desired, approval.
The optimization proposal is contained in the <code>Status.Optimization Result</code> property of the <code>KafkaRebalance</code> resource.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Review the optimization proposal.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example proposal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">Status:
  Conditions:
    Last Transition Time:  2020-05-19T13:50:12.533Z
    Status:                ProposalReady
    Type:                  State
  Observed Generation:     1
  Optimization Result:
    Data To Move MB:  0
    Excluded Brokers For Leadership:
    Excluded Brokers For Replica Move:
    Excluded Topics:
    Intra Broker Data To Move MB:         0
    Monitored Partitions Percentage:      100
    Num Intra Broker Replica Movements:   0
    Num Leader Movements:                 0
    Num Replica Movements:                26
    On Demand Balancedness Score After:   81.8666802863978
    On Demand Balancedness Score Before:  78.01176356230222
    Recent Windows:                       1
  Session Id:                             05539377-ca7b-45ef-b359-e13564f1458c</code></pre>
</div>
</div>
<div class="paragraph">
<p>The properties in the <code>Optimization Result</code> section describe the pending cluster rebalance operation.
For descriptions of each property, see <a href="#contents-optimization-proposals">Contents of optimization proposals</a>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">What to do next</div>
<p><a href="#proc-approving-optimization-proposal-str">Approving an optimization proposal</a></p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-approving-optimization-proposal-str"><a class="link" href="#proc-approving-optimization-proposal-str">7.8. Approving an optimization proposal</a></h3>
<div class="paragraph">
<p>You can approve an <a href="#con-optimization-proposals-str">optimization proposal</a> generated by Cruise Control, if its status is <code>ProposalReady</code>.
Cruise Control will then apply the optimization proposal to the Kafka cluster, reassigning partitions to brokers and changing partition leadership.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>This is not a dry run.</strong> Before you approve an optimization proposal, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refresh the proposal in case it has become out of date.</p>
</li>
<li>
<p>Carefully review the <a href="#contents-optimization-proposals">contents of the proposal</a>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-generating-optimization-proposals-str">generated an optimization proposal</a> from Cruise Control.</p>
</li>
<li>
<p>The <code>KafkaRebalance</code> custom resource status is <code>ProposalReady</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform these steps for the optimization proposal that you want to approve:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unless the optimization proposal is newly generated, check that it is based on current information about the state of the Kafka cluster.
To do so, refresh the optimization proposal to make sure it uses the latest cluster metrics:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes with <code>refresh</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=refresh</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the status changes to <code>ProposalReady</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Approve the optimization proposal that you want Cruise Control to apply.</p>
<div class="paragraph">
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=approve</code></pre>
</div>
</div>
</li>
<li>
<p>The Cluster Operator detects the annotated resource and instructs Cruise Control to rebalance the Kafka cluster.</p>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Cruise Control returns one of three statuses:</p>
<div class="ulist">
<ul>
<li>
<p>Rebalancing: The cluster rebalance operation is in progress.</p>
</li>
<li>
<p>Ready: The cluster rebalancing operation completed successfully. The <code>KafkaRebalance</code> custom resource cannot be reused.</p>
</li>
<li>
<p>NotReady: An error occurred&#8212;&#8203;see <a href="#proc-fixing-problems-with-kafkarebalance-str">Fixing problems with a <code>KafkaRebalance</code> resource</a>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
<li>
<p><a href="#proc-stopping-cluster-rebalance-str">Stopping a cluster rebalance</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-stopping-cluster-rebalance-str"><a class="link" href="#proc-stopping-cluster-rebalance-str">7.9. Stopping a cluster rebalance</a></h3>
<div class="paragraph">
<p>Once started, a cluster rebalance operation might take some time to complete and affect the overall performance of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>If you want to stop a cluster rebalance operation that is in progress, apply the <code>stop</code> annotation to the <code>KafkaRebalance</code> custom resource.
This instructs Cruise Control to finish the current batch of partition reassignments and then stop the rebalance.
When the rebalance has stopped, completed partition reassignments have already been applied; therefore, the state of the Kafka cluster is different when compared to prior to the start of the rebalance operation.
If further rebalancing is required, you should generate a new optimization proposal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The performance of the Kafka cluster in the intermediate (stopped) state might be worse than in the initial state.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-approving-optimization-proposal-str">approved the optimization proposal</a> by annotating the <code>KafkaRebalance</code> custom resource with <code>approve</code>.</p>
</li>
<li>
<p>The status of the <code>KafkaRebalance</code> custom resource is <code>Rebalancing</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=stop</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the status changes to <code>Stopped</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-fixing-problems-with-kafkarebalance-str"><a class="link" href="#proc-fixing-problems-with-kafkarebalance-str">7.10. Fixing problems with a <code>KafkaRebalance</code> resource</a></h3>
<div class="paragraph">
<p>If an issue occurs when creating a <code>KafkaRebalance</code> resource or interacting with Cruise Control, the error is reported in the resource status, along with details of how to fix it.
The resource also moves to the <code>NotReady</code> state.</p>
</div>
<div class="paragraph">
<p>To continue with the cluster rebalance operation, you must fix the problem in the <code>KafkaRebalance</code> resource itself or with the overall Cruise Control deployment.
Problems might include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A misconfigured parameter in the <code>KafkaRebalance</code> resource.</p>
</li>
<li>
<p>The <code>strimzi.io/cluster</code> label for specifying the Kafka cluster in the <code>KafkaRebalance</code> resource is missing.</p>
</li>
<li>
<p>The Cruise Control server is not deployed as the <code>cruiseControl</code> property in the <code>Kafka</code> resource is missing.</p>
</li>
<li>
<p>The Cruise Control server is not reachable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After fixing the issue, you need to add the <code>refresh</code> annotation to the <code>KafkaRebalance</code> resource.
During a refresh, a new optimization proposal is requested from the Cruise Control server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have <a href="#proc-approving-optimization-proposal-str">approved an optimization proposal</a>.</p>
</li>
<li>
<p>The status of the <code>KafkaRebalance</code> custom resource for the rebalance operation is <code>NotReady</code>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get information about the error from the <code>KafkaRebalance</code> status:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Attempt to resolve the issue in the <code>KafkaRebalance</code> resource.</p>
</li>
<li>
<p>Annotate the <code>KafkaRebalance</code> resource in Kubernetes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl annotate kafkarebalance <em>rebalance-cr-name</em> strimzi.io/rebalance=refresh</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the <code>KafkaRebalance</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe kafkarebalance <em>rebalance-cr-name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Wait until the status changes to <code>PendingProposal</code>, or directly to <code>ProposalReady</code>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-optimization-proposals-str">Optimization proposals overview</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-distributed-tracing-str"><a class="link" href="#assembly-distributed-tracing-str">8. Distributed tracing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Distributed tracing allows you to track the progress of transactions between applications in a distributed system. In a microservices architecture, tracing tracks the progress of transactions between services. Trace data is useful for monitoring application performance and investigating issues with target systems and end-user applications.</p>
</div>
<div class="paragraph">
<p>In Strimzi, tracing facilitates the end-to-end tracking of messages: from source systems to Kafka, and then from Kafka to target systems and applications. It complements the metrics that are available to view in <a href="./deploying.html#assembly-metrics-setup-str">Grafana dashboards</a>, as well as the component loggers.</p>
</div>
<h3 id="how_strimzi_supports_tracing" class="discrete">How Strimzi supports tracing</h3>
<div class="paragraph">
<p>Support for tracing is built in to the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka Connect (including Kafka Connect with Source2Image support)</p>
</li>
<li>
<p>MirrorMaker</p>
</li>
<li>
<p>MirrorMaker 2.0</p>
</li>
<li>
<p>Strimzi Kafka Bridge</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You enable and configure tracing for these components using template configuration properties in their custom resources.</p>
</div>
<div class="paragraph">
<p>To enable tracing in Kafka producers, consumers, and Kafka Streams API applications, you <em>instrument</em> application code using the <a href="https://github.com/opentracing-contrib/java-kafka-client/blob/master/README.md" target="_blank" rel="noopener">OpenTracing Apache Kafka Client Instrumentation</a> library (included with Strimzi). When instrumented, clients generate trace data; for example, when producing messages or writing offsets to the log.</p>
</div>
<div class="paragraph">
<p>Traces are sampled according to a sampling strategy and then visualized in the Jaeger user interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Tracing is not supported for Kafka brokers.</p>
</div>
<div class="paragraph">
<p>Setting up tracing for applications and systems beyond Strimzi is outside the scope of this chapter. To learn more about this subject, search for "inject and extract" in the <a href="https://opentracing.io/docs/overview/" target="_blank" rel="noopener">OpenTracing documentation</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<h3 id="outline_of_procedures" class="discrete">Outline of procedures</h3>
<div class="paragraph">
<p>To set up tracing for Strimzi, follow these procedures in order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up tracing for clients:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">Initialize a Jaeger tracer for Kafka clients</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Instrument clients with tracers:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#proc-instrumenting-producers-consumers-for-opentracing-str">Instrument producers and consumers for tracing</a></p>
</li>
<li>
<p><a href="#proc-instrumenting-kafka-streams-with-tracers-str">Instrument Kafka Streams applications for tracing</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#assembly-setting-up-tracing-mirror-maker-connect-bridge-str">Set up tracing for MirrorMaker, Kafka Connect, and the Kafka Bridge</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Jaeger backend components are deployed to your Kubernetes cluster. For deployment instructions, see the <a href="https://www.jaegertracing.io/docs/1.18/deployment/" target="_blank" rel="noopener">Jaeger deployment documentation</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="con-overview-opentracing-jaeger-str"><a class="link" href="#con-overview-opentracing-jaeger-str">8.1. Overview of OpenTracing and Jaeger</a></h3>
<div class="paragraph">
<p>Strimzi uses the OpenTracing and Jaeger projects.</p>
</div>
<div class="paragraph">
<p>OpenTracing is an API specification that is independent from the tracing or monitoring system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The OpenTracing APIs are used to <em>instrument</em> application code</p>
</li>
<li>
<p>Instrumented applications generate <em>traces</em> for individual transactions across the distributed system</p>
</li>
<li>
<p>Traces are composed of <em>spans</em> that define specific units of work over time</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jaeger is a tracing system for microservices-based distributed systems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jaeger implements the OpenTracing APIs and provides client libraries for instrumentation</p>
</li>
<li>
<p>The Jaeger user interface allows you to query, filter, and analyze trace data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/image_con-overview-distributed-tracing.png" alt="The Jaeger user interface showing a simple query"></span></p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://opentracing.io/" target="_blank" rel="noopener">OpenTracing</a></p>
</li>
<li>
<p><a href="https://www.jaegertracing.io/" target="_blank" rel="noopener">Jaeger</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="assembly-setting-up-tracing-kafka-clients-str"><a class="link" href="#assembly-setting-up-tracing-kafka-clients-str">8.2. Setting up tracing for Kafka clients</a></h3>
<div class="paragraph">
<p>Initialize a Jaeger tracer to instrument your client applications for distributed tracing.</p>
</div>
<div class="sect3">
<h4 id="proc-configuring-jaeger-tracer-kafka-clients-str"><a class="link" href="#proc-configuring-jaeger-tracer-kafka-clients-str">8.2.1. Initializing a Jaeger tracer for Kafka clients</a></h4>
<div class="paragraph">
<p>Configure and initialize a Jaeger tracer using a set of <a href="#ref-tracing-environment-variables-str">tracing environment variables</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In each client application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Maven dependencies for Jaeger to the <code>pom.xml</code> file for the client application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.jaegertracing&lt;/groupId&gt;
    &lt;artifactId&gt;jaeger-client&lt;/artifactId&gt;
    &lt;version&gt;1.3.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Define the configuration of the Jaeger tracer using the <a href="#ref-tracing-environment-variables-str">tracing environment variables</a>.</p>
</li>
<li>
<p>Create the Jaeger tracer from the environment variables that you defined in step two:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Tracer tracer = Configuration.fromEnv().getTracer();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For alternative ways to initialize a Jaeger tracer, see the <a href="https://github.com/jaegertracing/jaeger-client-java/tree/master/jaeger-core" target="_blank" rel="noopener">Java OpenTracing library</a> documentation.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Register the Jaeger tracer as a global tracer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">GlobalTracer.register(tracer);</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>A Jaeger tracer is now initialized for the client application to use.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-tracing-environment-variables-str"><a class="link" href="#ref-tracing-environment-variables-str">8.2.2. Environment variables for tracing</a></h4>
<div class="paragraph">
<p>Use these environment variables when configuring a Jaeger tracer for Kafka clients.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The tracing environment variables are part of the Jaeger project and are subject to change. For the latest environment variables, see the <a href="https://github.com/jaegertracing/jaeger-client-java/tree/master/jaeger-core#configuration-via-environment" target="_blank" rel="noopener">Jaeger documentation</a>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none fit-content stretch">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SERVICE_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the Jaeger tracer service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AGENT_HOST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname for communicating with the <code>jaeger-agent</code> through the User Datagram Protocol (UDP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AGENT_PORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used for communicating with the <code>jaeger-agent</code> through UDP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_ENDPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>traces</code> endpoint. Only define this variable if the client application will bypass the <code>jaeger-agent</code> and connect directly to the <code>jaeger-collector</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_AUTH_TOKEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The authentication token to send to the endpoint as a bearer token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to send to the endpoint if using basic authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_PASSWORD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to send to the endpoint if using basic authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_PROPAGATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of formats to use for propagating the trace context. Defaults to the standard Jaeger format. Valid values are <code>jaeger</code>, <code>b3</code>, and <code>w3c</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_LOG_SPANS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the reporter should also log the spans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_MAX_QUEUE_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reporter&#8217;s maximum queue size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_REPORTER_FLUSH_INTERVAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The reporter&#8217;s flush interval, in ms. Defines how frequently the Jaeger reporter flushes span batches.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_TYPE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The sampling strategy to use for client traces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Constant</p>
</li>
<li>
<p>Probabilistic</p>
</li>
<li>
<p>Rate Limiting</p>
</li>
<li>
<p>Remote (the default)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To sample all traces, use the Constant sampling strategy with a parameter of 1.</p>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://www.jaegertracing.io/docs/1.14/sampling/#client-sampling-configuration" target="_blank" rel="noopener">Jaeger documentation</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_PARAM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sampler parameter (number).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_SAMPLER_MANAGER_HOST_PORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname and port to use if a Remote sampling strategy is selected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAEGER_TAGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of tracer-level tags that are added to all reported spans.</p>
<p class="tableblock">The value can also refer to an environment variable using the format <code>${envVarName:default}</code>. <code>:default</code> is optional and identifies a value to use if the environment variable cannot be found.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-configuring-jaeger-tracer-kafka-clients-str">Initializing a Jaeger tracer for Kafka clients</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-instrumenting-kafka-clients-tracers-str"><a class="link" href="#assembly-instrumenting-kafka-clients-tracers-str">8.3. Instrumenting Kafka clients with tracers</a></h3>
<div class="paragraph">
<p>Instrument Kafka producer and consumer clients, and Kafka Streams API applications for distributed tracing.</p>
</div>
<div class="sect3">
<h4 id="proc-instrumenting-producers-consumers-for-opentracing-str"><a class="link" href="#proc-instrumenting-producers-consumers-for-opentracing-str">8.3.1. Instrumenting producers and consumers for tracing</a></h4>
<div class="paragraph">
<p>Use a Decorator pattern or Interceptors to instrument your Java producer and consumer application code for tracing.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In the application code of each producer and consumer application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the Maven dependency for OpenTracing to the producer or consumer&#8217;s <code>pom.xml</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.opentracing.contrib&lt;/groupId&gt;
    &lt;artifactId&gt;opentracing-kafka-client&lt;/artifactId&gt;
    &lt;version&gt;0.1.13&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Instrument your client application code using either a Decorator pattern or Interceptors.</p>
<div class="ulist">
<ul>
<li>
<p>To use a Decorator pattern:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Create an instance of the TracingKafkaProducer:
TracingKafkaProducer&lt;Integer, String&gt; tracingProducer = new TracingKafkaProducer&lt;&gt;(producer,
        tracer);

// Send:
tracingProducer.send(...);

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Create an instance of the TracingKafkaConsumer:
TracingKafkaConsumer&lt;Integer, String&gt; tracingConsumer = new TracingKafkaConsumer&lt;&gt;(consumer,
        tracer);

// Subscribe:
tracingConsumer.subscribe(Collections.singletonList("messages"));

// Get messages:
ConsumerRecords&lt;Integer, String&gt; records = tracingConsumer.poll(1000);

// Retrieve SpanContext from polled record (consumer side):
ConsumerRecord&lt;Integer, String&gt; record = ...
SpanContext spanContext = TracingKafkaUtils.extractSpanContext(record.headers(), tracer);</code></pre>
</div>
</div>
</li>
<li>
<p>To use Interceptors:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Register the tracer with GlobalTracer:
GlobalTracer.register(tracer);

// Add the TracingProducerInterceptor to the sender properties:
senderProps.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,
          TracingProducerInterceptor.class.getName());

// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Send:
producer.send(...);

// Add the TracingConsumerInterceptor to the consumer properties:
consumerProps.put(ConsumerConfig.INTERCEPTOR_CLASSES_CONFIG,
          TracingConsumerInterceptor.class.getName());

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Subscribe:
consumer.subscribe(Collections.singletonList("messages"));

// Get messages:
ConsumerRecords&lt;Integer, String&gt; records = consumer.poll(1000);

// Retrieve the SpanContext from a polled message (consumer side):
ConsumerRecord&lt;Integer, String&gt; record = ...
SpanContext spanContext = TracingKafkaUtils.extractSpanContext(record.headers(), tracer);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="custom_span_names_in_a_decorator_pattern"><a class="link" href="#custom_span_names_in_a_decorator_pattern">Custom span names in a Decorator pattern</a></h5>
<div class="paragraph">
<p>A <em>span</em> is a logical unit of work in Jaeger, with an operation name, start time, and duration.</p>
</div>
<div class="paragraph">
<p>To use a Decorator pattern to instrument your producer and consumer applications, define custom span names by passing a <code>BiFunction</code> object as an additional argument when creating the <code>TracingKafkaProducer</code> and <code>TracingKafkaConsumer</code> objects. The OpenTracing Apache Kafka Client Instrumentation library includes several built-in span names.</p>
</div>
<div class="listingblock">
<div class="title">Example: Using custom span names to instrument client application code in a Decorator pattern</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Create a BiFunction for the KafkaProducer that operates on (String operationName, ProducerRecord consumerRecord) and returns a String to be used as the name:

BiFunction&lt;String, ProducerRecord, String&gt; producerSpanNameProvider =
    (operationName, producerRecord) -&gt; "CUSTOM_PRODUCER_NAME";

// Create an instance of the KafkaProducer:
KafkaProducer&lt;Integer, String&gt; producer = new KafkaProducer&lt;&gt;(senderProps);

// Create an instance of the TracingKafkaProducer
TracingKafkaProducer&lt;Integer, String&gt; tracingProducer = new TracingKafkaProducer&lt;&gt;(producer,
        tracer,
        producerSpanNameProvider);

// Spans created by the tracingProducer will now have "CUSTOM_PRODUCER_NAME" as the span name.

// Create a BiFunction for the KafkaConsumer that operates on (String operationName, ConsumerRecord consumerRecord) and returns a String to be used as the name:

BiFunction&lt;String, ConsumerRecord, String&gt; consumerSpanNameProvider =
    (operationName, consumerRecord) -&gt; operationName.toUpperCase();

// Create an instance of the KafkaConsumer:
KafkaConsumer&lt;Integer, String&gt; consumer = new KafkaConsumer&lt;&gt;(consumerProps);

// Create an instance of the TracingKafkaConsumer, passing in the consumerSpanNameProvider BiFunction:

TracingKafkaConsumer&lt;Integer, String&gt; tracingConsumer = new TracingKafkaConsumer&lt;&gt;(consumer,
        tracer,
        consumerSpanNameProvider);

// Spans created by the tracingConsumer will have the operation name as the span name, in upper-case.
// "receive" -&gt; "RECEIVE"</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="built_in_span_names"><a class="link" href="#built_in_span_names">Built-in span names</a></h5>
<div class="paragraph">
<p>When defining custom span names, you can use the following <code>BiFunctions</code> in the <code>ClientSpanNameProvider</code> class. If no <code>spanNameProvider</code> is specified, <code>CONSUMER_OPERATION_NAME</code> and <code>PRODUCER_OPERATION_NAME</code> are used.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none fit-content">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">BiFunction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_OPERATION_NAME, PRODUCER_OPERATION_NAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the <code>operationName</code> as the span name: "receive" for consumers and "send" for producers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_PREFIXED_OPERATION_NAME(String prefix), PRODUCER_PREFIXED_OPERATION_NAME(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and <code>operationName</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_TOPIC, PRODUCER_TOPIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the name of the topic that the message was sent to or retrieved from in the format <code>(record.topic())</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PREFIXED_CONSUMER_TOPIC(String prefix), PREFIXED_PRODUCER_TOPIC(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and the topic name in the format <code>(record.topic())</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_OPERATION_NAME_TOPIC, PRODUCER_OPERATION_NAME_TOPIC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the operation name and the topic name: <code>"operationName - record.topic()"</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONSUMER_PREFIXED_OPERATION_NAME_TOPIC(String prefix), PRODUCER_PREFIXED_OPERATION_NAME_TOPIC(String prefix)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a String concatenation of <code>prefix</code> and <code>"operationName - record.topic()"</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-instrumenting-kafka-streams-with-tracers-str"><a class="link" href="#proc-instrumenting-kafka-streams-with-tracers-str">8.3.2. Instrumenting Kafka Streams applications for tracing</a></h4>
<div class="paragraph">
<p>This section describes how to instrument Kafka Streams API applications for distributed tracing.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>In each Kafka Streams API application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the <code>opentracing-kafka-streams</code> dependency to the pom.xml file for your Kafka Streams API application:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependency&gt;
    &lt;groupId&gt;io.opentracing.contrib&lt;/groupId&gt;
    &lt;artifactId&gt;opentracing-kafka-streams&lt;/artifactId&gt;
    &lt;version&gt;0.1.13&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Create an instance of the <code>TracingKafkaClientSupplier</code> supplier interface:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">KafkaClientSupplier supplier = new TracingKafkaClientSupplier(tracer);</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the supplier interface to <code>KafkaStreams</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">KafkaStreams streams = new KafkaStreams(builder.build(), new StreamsConfig(config), supplier);
streams.start();</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-setting-up-tracing-mirror-maker-connect-bridge-str"><a class="link" href="#assembly-setting-up-tracing-mirror-maker-connect-bridge-str">8.4. Setting up tracing for MirrorMaker, Kafka Connect, and the Kafka Bridge</a></h3>
<div class="paragraph">
<p>Distributed tracing is supported for MirrorMaker, MirrorMaker 2.0, Kafka Connect (including Kafka Connect with Source2Image support), and the Strimzi Kafka Bridge.</p>
</div>
<div class="paragraph">
<div class="title">Tracing in MirrorMaker and MirrorMaker 2.0</div>
<p>For MirrorMaker and MirrorMaker 2.0, messages are traced from the source cluster to the target cluster. The trace data records messages entering and leaving the MirrorMaker or MirrorMaker 2.0 component.</p>
</div>
<div class="paragraph">
<div class="title">Tracing in Kafka Connect</div>
<p>Only messages produced and consumed by Kafka Connect itself are traced. To trace messages sent between Kafka Connect and external systems, you must configure tracing in the connectors for those systems. For more information, see <a href="#proc-kafka-connect-config-str">Configuring Kafka Connect</a>.</p>
</div>
<div class="paragraph">
<div class="title">Tracing in the Kafka Bridge</div>
<p>Messages produced and consumed by the Kafka Bridge are traced. Incoming HTTP requests from client applications to send and receive messages through the Kafka Bridge are also traced.
To have end-to-end tracing, you must configure tracing in your HTTP clients.</p>
</div>
<div class="sect3">
<h4 id="proc-enabling-tracing-in-connect-mirror-maker-bridge-resources-str"><a class="link" href="#proc-enabling-tracing-in-connect-mirror-maker-bridge-resources-str">8.4.1. Enabling tracing in MirrorMaker, Kafka Connect, and Kafka Bridge resources</a></h4>
<div class="paragraph">
<p>Update the configuration of <code>KafkaMirrorMaker</code>, <code>KafkaMirrorMaker2</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, and <code>KafkaBridge</code> custom resources to specify and configure a Jaeger tracer service for each resource. Updating a tracing-enabled resource in your Kubernetes cluster triggers two events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interceptor classes are updated in the integrated consumers and producers in MirrorMaker, MirrorMaker 2.0, Kafka Connect, or the Strimzi Kafka Bridge.</p>
</li>
<li>
<p>For MirrorMaker, MirrorMaker 2.0, and Kafka Connect, the tracing agent initializes a Jaeger tracer based on the tracing configuration defined in the resource.</p>
</li>
<li>
<p>For the Kafka Bridge, a Jaeger tracer based on the tracing configuration defined in the resource is initialized by the Kafka Bridge itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Perform these steps for each <code>KafkaMirrorMaker</code>, <code>KafkaMirrorMaker2</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, and <code>KafkaBridge</code> resource.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>spec.template</code> property, configure the Jaeger tracer service. For example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Jaeger tracer configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect-cluster
spec:
  #...
  template:
    connectContainer: <b class="conum">(1)</b>
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing: <b class="conum">(2)</b>
    type: jaeger
  #...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Jaeger tracer configuration for MirrorMaker</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
metadata:
  name: my-mirror-maker
spec:
  #...
  template:
    mirrorMakerContainer:
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing:
    type: jaeger
#...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Jaeger tracer configuration for MirrorMaker 2.0</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaMirrorMaker2
metadata:
  name: my-mm2-cluster
spec:
  #...
  template:
    connectContainer:
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing:
    type: jaeger
#...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Jaeger tracer configuration for the Kafka Bridge</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  #...
  template:
    bridgeContainer:
      env:
        - name: JAEGER_SERVICE_NAME
          value: my-jaeger-service
        - name: JAEGER_AGENT_HOST
          value: jaeger-agent-name
        - name: JAEGER_AGENT_PORT
          value: "6831"
  tracing:
    type: jaeger
#...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use the <a href="#ref-tracing-environment-variables-str">tracing environment variables</a> as template configuration properties.</p>
</li>
<li>
<p>Set the <code>spec.tracing.type</code> property to <code>jaeger</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</li>
<li>
<p>Create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f your-file</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code> schema reference</a></p>
</li>
<li>
<p><a href="#assembly-customizing-kubernetes-resources-str">Customizing Kubernetes resources</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-str"><a class="link" href="#security-str">9. Managing TLS certificates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi supports encrypted communication between the Kafka and Strimzi components using the TLS protocol.
Communication between Kafka brokers (interbroker communication), between ZooKeeper nodes (internodal communication), and between these and the Strimzi operators is always encrypted.
Communication between Kafka clients and Kafka brokers is encrypted according to how the cluster is configured.
For the Kafka and Strimzi components, TLS certificates are also used for authentication.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator automatically sets up and renews TLS certificates to enable encryption and authentication within your cluster.
It also sets up other TLS certificates if you want to enable encryption or TLS authentication between Kafka brokers and clients.
Certificates provided by users are not renewed.</p>
</div>
<div class="paragraph">
<p>You can provide your own server certificates, called <em>Kafka listener certificates</em>, for TLS listeners or external listeners which have TLS encryption enabled.
For more information, see <a href="#kafka-listener-certificates-str">Kafka listener certificates</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/secure_communication.png" alt="Secure Communication">
</div>
<div class="title">Figure 5. Example architecture of the communication secured by TLS</div>
</div>
<div class="sect2">
<h3 id="certificate-authorities-str"><a class="link" href="#certificate-authorities-str">9.1. Certificate Authorities</a></h3>
<div class="paragraph">
<p>To support encryption, each Strimzi component needs its own private keys and public key certificates.
All component certificates are signed by an internal Certificate Authority (CA) called the <em>cluster CA</em>.</p>
</div>
<div class="paragraph">
<p>Similarly, each Kafka client application connecting to Strimzi using TLS client authentication needs to provide private keys and certificates.
A second internal CA, named the <em>clients CA</em>, is used to sign certificates for the Kafka clients.</p>
</div>
<div class="sect3">
<h4 id="ca_certificates"><a class="link" href="#ca_certificates">9.1.1. CA certificates</a></h4>
<div class="paragraph">
<p>Both the cluster CA and clients CA have a self-signed public key certificate.</p>
</div>
<div class="paragraph">
<p>Kafka brokers are configured to trust certificates signed by either the cluster CA or clients CA.
Components that clients do not need to connect to, such as ZooKeeper, only trust certificates signed by the cluster CA.
Unless TLS encryption for external listeners is disabled, client applications must trust certificates signed by the cluster CA.
This is also true for client applications that perform <a href="#assembly-securing-kafka-brokers-str">mutual TLS authentication</a>.</p>
</div>
<div class="paragraph">
<p>By default, Strimzi automatically generates and renews CA certificates issued by the cluster CA or clients CA.
You can configure the management of these CA certificates in the <code>Kafka.spec.clusterCa</code> and <code>Kafka.spec.clientsCa</code> objects.
Certificates provided by users are not renewed.</p>
</div>
<div class="paragraph">
<p>You can provide your own CA certificates for the cluster CA or clients CA.
For more information, see <a href="#installing-your-own-ca-certificates-str">Installing your own CA certificates</a>.
If you provide your own certificates, you must manually renew them when needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-your-own-ca-certificates-str"><a class="link" href="#installing-your-own-ca-certificates-str">9.1.2. Installing your own CA certificates</a></h4>
<div class="paragraph">
<p>This procedure describes how to install your own CA certificates and keys instead of using the CA certificates and private keys generated by the Cluster Operator.</p>
</div>
<div class="paragraph">
<p>You can use this procedure to install your own cluster or client CA certificates.</p>
</div>
<div class="paragraph">
<p>The procedure describes renewal of CA certificates in PEM format.
You can also use certificates in PKCS #12 format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster is not yet deployed.</p>
</li>
<li>
<p>Your own X.509 certificates and keys in PEM format for the cluster CA or clients CA.</p>
<div class="ulist">
<ul>
<li>
<p>If you want to use a cluster or clients CA which is not a Root CA, you have to include the whole chain in the certificate file.
The chain should be in the following order:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The cluster or clients CA</p>
</li>
<li>
<p>One or more intermediate CAs</p>
</li>
<li>
<p>The root CA</p>
</li>
</ol>
</div>
</li>
<li>
<p>All CAs in the chain should be configured as a CA in the X509v3 Basic Constraints.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Put your CA certificate in the corresponding <code>Secret</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the existing secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete secret <em>CA-CERTIFICATE-SECRET</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>,  which is <code><em>CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p>Ignore any "Not Exists" errors.</p>
</div>
</li>
<li>
<p>Create and label the new secret</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>CA-CERTIFICATE-SECRET</em> --from-file=ca.crt=<em>CA-CERTIFICATE-FILENAME</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Put your CA key in the corresponding <code>Secret</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the existing secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete secret <em>CA-KEY-SECRET</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-KEY-SECRET</em> is the name of CA key, which is <code><em>CLUSTER-NAME</em>-cluster-ca</code> for the cluster CA key and <code><em>CLUSTER-NAME</em>-clients-ca</code> for the clients CA key.</p>
</div>
</li>
<li>
<p>Create the new secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>CA-KEY-SECRET</em> --from-file=ca.key=<em>CA-KEY-SECRET-FILENAME</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Label the secrets with the labels <code>strimzi.io/kind=Kafka</code> and <code>strimzi.io/cluster=<em>CLUSTER-NAME</em></code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label secret <em>CA-CERTIFICATE-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>CLUSTER-NAME</em>
kubectl label secret <em>CA-KEY-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>CLUSTER-NAME</em></code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Kafka</code> resource for your cluster, configuring either the <code>Kafka.spec.clusterCa</code> or the <code>Kafka.spec.clientsCa</code> object to <em>not</em> use generated CAs:</p>
<div class="listingblock">
<div class="title">Example fragment <code>Kafka</code> resource configuring the cluster CA to use certificates you supply for yourself</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kind: Kafka
version: kafka.strimzi.io/v1beta1
spec:
  # ...
  clusterCa:
    generateCertificateAuthority: false</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To renew CA certificates you have previously installed, see <a href="#renewing-your-own-ca-certificates-str">Renewing your own CA certificates</a>.</p>
</li>
<li>
<p><a href="#proc-installing-certs-per-listener-str">Providing your own Kafka listener certificates</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="certificates-and-secrets-str"><a class="link" href="#certificates-and-secrets-str">9.2. Secrets</a></h3>
<div class="paragraph">
<p>Strimzi uses <em>Secrets</em> to store private keys and certificates for Kafka cluster components and clients.
Secrets are used for establishing TLS encrypted connections between Kafka brokers, and between brokers and clients.
They are also used for mutual TLS authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>Cluster Secret</em> contains a cluster CA certificate to sign Kafka broker certificates, and is used by a connecting client to establish a TLS encrypted connection with the Kafka cluster to validate broker identity.</p>
</li>
<li>
<p>A <em>Client Secret</em> contains a client CA certificate for a user to sign its own client certificate to allow mutual authentication against the Kafka cluster.
The broker validates the client identity through the client CA certificate itself.</p>
</li>
<li>
<p>A <em>User Secret</em> contains a private key and certificate, which are generated and signed by the client CA certificate when a new user is created.
The key and certificate are used for authentication and authorization when accessing the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Secrets provide private keys and certificates in PEM and PKCS #12 formats.
Using private keys and certificates in PEM format means that users have to get them from the Secrets, and generate a corresponding truststore (or keystore) to use in their Java applications.
PKCS #12 storage provides a truststore (or keystore) that can be used directly.</p>
</div>
<div class="paragraph">
<p>All keys are 2048 bits in size.</p>
</div>
<div class="sect3">
<h4 id="pkcs_12_storage"><a class="link" href="#pkcs_12_storage">9.2.1. PKCS #12 storage</a></h4>
<div class="paragraph">
<p>PKCS #12 defines an archive file format (<code>.p12</code>) for storing cryptography objects into a single file with password protection.
You can use PKCS #12 to manage certificates and keys in one place.</p>
</div>
<div class="paragraph">
<p>Each Secret contains fields specific to PKCS #12.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>.p12</code> field contains the certificates and keys.</p>
</li>
<li>
<p>The <code>.password</code> field is the password that protects the archive.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cluster_ca_secrets"><a class="link" href="#cluster_ca_secrets">9.2.2. Cluster CA Secrets</a></h4>
<div class="paragraph">
<p>The following tables describe the Cluster Secrets that are managed by the Cluster Operator in a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Only the <code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> Secret needs to be used by clients.
All other <code>Secrets</code> described only need to be accessed by the Strimzi components.
You can enforce this using Kubernetes role-based access controls, if necessary.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 5. Fields in the <code><em>&lt;cluster&gt;</em>-cluster-ca</code> Secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the cluster CA.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 6. Fields in the <code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> Secret</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the cluster CA.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The CA certificates in <code><em>&lt;cluster&gt;</em>-cluster-ca-cert</code> must be trusted by Kafka client applications so that they validate the Kafka broker certificates when connecting to Kafka brokers over TLS.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 7. Fields in the <code><em>&lt;cluster&gt;</em>-kafka-brokers</code> Secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for Kafka broker pod <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-kafka-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for Kafka broker pod <code><em>&lt;num&gt;</em></code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 8. Fields in the <code><em>&lt;cluster&gt;</em>-zookeeper-nodes</code> Secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the  PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for ZooKeeper node <em>&lt;num&gt;</em>. Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-zookeeper-<em>&lt;num&gt;</em>.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for ZooKeeper pod <code><em>&lt;num&gt;</em></code>.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 9. Fields in the <code><em>&lt;cluster&gt;</em>-entity-operator-certs</code> Secret</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator_.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator_.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator_.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for TLS communication between the Entity Operator and Kafka or ZooKeeper.
Signed by a current or former cluster CA private key in <code><em>&lt;cluster&gt;</em>-cluster-ca</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entity-operator.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for TLS communication between the Entity Operator and Kafka or ZooKeeper.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="client_ca_secrets"><a class="link" href="#client_ca_secrets">9.2.3. Client CA Secrets</a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Clients CA <code>Secrets</code> managed by the Cluster Operator in <em>&lt;cluster&gt;</em></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Secret name</th>
<th class="tableblock halign-left valign-top">Field within Secret</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-clients-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current private key for the clients CA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><code><em>&lt;cluster&gt;</em>-clients-ca-cert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the  PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ca.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current certificate for the clients CA.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The certificates in <code><em>&lt;cluster&gt;</em>-clients-ca-cert</code> are those which the Kafka brokers trust.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code><em>&lt;cluster&gt;</em>-clients-ca</code> is used to sign certificates of client applications.
It needs to be accessible to the Strimzi components and for administrative access if you are intending to issue application certificates without using the User Operator.
You can enforce this using Kubernetes role-based access controls if necessary.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="user_secrets"><a class="link" href="#user_secrets">9.2.4. User Secrets</a></h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. <code>Secrets</code> managed by the User Operator</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Secret name</th>
<th class="tableblock halign-left valign-top">Field within Secret</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code><em>&lt;user&gt;</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.p12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCS #12 archive file for storing certificates and keys.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for protecting the  PKCS #12 archive file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.crt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate for the user, signed by the clients CA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key for the user</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-certificate-renewal-str"><a class="link" href="#con-certificate-renewal-str">9.3. Certificate renewal and validity periods</a></h3>
<div class="paragraph">
<p>Cluster CA and clients CA certificates are only valid for a limited time period, known as the validity period.
This is usually defined as a number of days since the certificate was generated.</p>
</div>
<div class="paragraph">
<p>For auto-generated CA certificates, you can configure the validity period of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster CA certificates in <code>Kafka.spec.clusterCa.validityDays</code></p>
</li>
<li>
<p>Client CA certificates in <code>Kafka.spec.clientsCa.validityDays</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default validity period for both certificates is 365 days.
Manually-installed CA certificates should have their own validity periods defined.</p>
</div>
<div class="paragraph">
<p>When a CA certificate expires, components and clients that still trust that certificate will not accept TLS connections from peers whose certificates were signed by the CA private key.
The components and clients need to trust the <em>new</em> CA certificate instead.</p>
</div>
<div class="paragraph">
<p>To allow the renewal of CA certificates without a loss of service, the Cluster Operator will initiate certificate renewal before the old CA certificates expire.</p>
</div>
<div class="paragraph">
<p>You can configure the renewal period of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cluster CA certificates in <code>Kafka.spec.clusterCa.renewalDays</code></p>
</li>
<li>
<p>Client CA certificates in <code>Kafka.spec.clientsCa.renewalDays</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default renewal period for both certificates is 30 days.</p>
</div>
<div class="paragraph">
<p>The renewal period is measured backwards, from the expiry date of the current certificate.</p>
</div>
<div class="listingblock">
<div class="title">Validity period against renewal period</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Not Before                                     Not After
    |                                              |
    |&lt;--------------- validityDays ---------------&gt;|
                              &lt;--- renewalDays ---&gt;|</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a change to the validity and renewal periods after creating the Kafka cluster, you configure and apply the <code>Kafka</code> custom resource,
and <a href="#proc-renewing-ca-certs-manually-str">manually renew the CA certificates</a>.
If you do not manually renew the certificates, the new periods will be used the next time the certificate is renewed automatically.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka configuration for certificate validity and renewal periods</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
# ...
spec:
# ...
  clusterCa:
    renewalDays: 30
    validityDays: 365
    generateCertificateAuthority: true
  clientsCa:
    renewalDays: 30
    validityDays: 365
    generateCertificateAuthority: true
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the Cluster Operator during the renewal period depends on whether the relevant setting is enabled
in either <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> or <code>Kafka.spec.clientsCa.generateCertificateAuthority</code>.</p>
</div>
<div class="sect3">
<h4 id="renewal_process_with_generated_cas"><a class="link" href="#renewal_process_with_generated_cas">9.3.1. Renewal process with generated CAs</a></h4>
<div class="paragraph">
<p>The Cluster Operator performs the following process to renew CA certificates:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate a new CA certificate, but retain the existing key. The new certificate replaces the old one with the name <code>ca.crt</code> within the corresponding <code>Secret</code>.</p>
</li>
<li>
<p>Generate new client certificates (for ZooKeeper nodes, Kafka brokers, and the Entity Operator).
This is not strictly necessary because the signing key has not changed, but it keeps the validity period of the client certificate in sync with the CA certificate.</p>
</li>
<li>
<p>Restart ZooKeeper nodes so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restart Kafka brokers so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
<li>
<p>Restart the Topic and User Operators so that they will trust the new CA certificate and use the new client certificates.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="client_applications"><a class="link" href="#client_applications">9.3.2. Client applications</a></h4>
<div class="paragraph">
<p>The Cluster Operator is not aware of the client applications using the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>When connecting to the cluster, and to ensure they operate correctly, client applications must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trust the cluster CA certificate published in the <em>&lt;cluster&gt;</em>-cluster-ca-cert Secret.</p>
</li>
<li>
<p>Use the credentials published in their <em>&lt;user-name&gt;</em> Secret to connect to the cluster.</p>
<div class="paragraph">
<p>The User Secret provides credentials in PEM and PKCS #12 format, or it can provide a password when using SCRAM-SHA authentication.
The User Operator creates the user credentials when a user is created.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For workloads running inside the same Kubernetes cluster and namespace, Secrets can be mounted as a volume so the client Pods construct their keystores and truststores from the current state of the Secrets.
For more details on this procedure, see <a href="#configuring-internal-clients-to-trust-cluster-ca-str">Configuring internal clients to trust the cluster CA</a>.</p>
</div>
<div class="sect4">
<h5 id="client_certificate_renewal"><a class="link" href="#client_certificate_renewal">Client certificate renewal</a></h5>
<div class="paragraph">
<p>You must ensure clients continue to work after certificate renewal.
The renewal process depends on how the clients are configured.</p>
</div>
<div class="paragraph">
<p>If you are provisioning client certificates and keys manually, you must generate new client certificates and ensure the new certificates are used by clients within the renewal period.
Failure to do this by the end of the renewal period could result in client applications being unable to connect to the cluster.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-renewing-ca-certs-manually-str"><a class="link" href="#proc-renewing-ca-certs-manually-str">9.3.3. Renewing CA certificates manually</a></h4>
<div class="paragraph">
<p>Cluster and clients CA certificates auto-renew at the start of their respective certificate renewal periods.
If <code>Kafka.spec.clusterCa.generateCertificateAuthority</code> and <code>Kafka.spec.clientsCa.generateCertificateAuthority</code> are set to <code>false</code>,
the CA certificates do not auto-renew.</p>
</div>
<div class="paragraph">
<p>You can manually renew one or both of these certificates before the certificate renewal period starts.
You might do this for security reasons, or if you have <a href="#con-certificate-renewal-str">changed the renewal or validity periods for the certificates</a>.</p>
</div>
<div class="paragraph">
<p>A renewed certificate uses the same private key as the old certificate.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>strimzi.io/force-renew</code> annotation to the <code>Secret</code> that contains the CA certificate that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 12. Annotation for the Secret that forces renewal of certificates</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Certificate</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert strimzi.io/force-renew=true</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will generate a new CA certificate for the <code>Secret</code> that you annotated.
If maintenance time windows are configured, the Cluster Operator will generate the new CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
</li>
<li>
<p>Check the period the CA certificate is valid:</p>
<div class="paragraph">
<p>For example, using an <code>openssl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>CA-CERTIFICATE-SECRET</em> -o 'jsonpath={.data.<em>CA-CERTIFICATE</em>}' | base64 -d | openssl x509 -subject -issuer -startdate -enddate -noout</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE</em> is the name of the CA certificate, such as <code>jsonpath={.data.ca\.crt}</code>.</p>
</div>
<div class="paragraph">
<p>The command returns a <code>notBefore</code> and <code>notAfter</code> date, which is the validity period for the CA certificate.</p>
</div>
<div class="paragraph">
<p>For example, for a cluster CA certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">subject=O = io.strimzi, CN = cluster-ca v0
issuer=O = io.strimzi, CN = cluster-ca v0
notBefore=Jun 30 09:43:54 2020 GMT
notAfter=Jun 30 09:43:54 2021 GMT</code></pre>
</div>
</div>
</li>
<li>
<p>Delete old certificates from the Secret.</p>
<div class="paragraph">
<p>When components are using the new certificates, older certificates might still be active.
Delete the old certificates to remove any potential security risk.</p>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
<li>
<p><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code> schema reference</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="renewing-your-own-ca-certificates-str"><a class="link" href="#renewing-your-own-ca-certificates-str">9.3.4. Renewing your own CA certificates</a></h4>
<div class="paragraph">
<p>This procedure describes how to renew CA certificates and keys that you previously installed.
You need to follow this procedure during the renewal period in order to replace CA certificates which will soon expire.</p>
</div>
<div class="paragraph">
<p>You can use this procedure to install your own cluster or client CA certificates.</p>
</div>
<div class="paragraph">
<p>The procedure describes renewal of CA certificates in PEM format.
You can also use certificates in PKCS #12 format.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which you previously installed your own CA certificates and private keys.</p>
</li>
<li>
<p>New cluster and clients X.509 certificates and keys in PEM format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These could be generated using an <code>openssl</code> command, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">openssl req -x509 -new -days <em>NUMBER-OF-DAYS-VALID</em> --nodes -out ca.crt -keyout ca.key</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check the details of the current CA certificates in the <code>Secret</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl describe secret <em>CA-CERTIFICATE-SECRET</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca-cert</code> for the cluster CA certificate and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca-cert</code> for the clients CA certificate.</p>
</div>
</li>
<li>
<p>Create a directory to contain the existing CA certificates in the secret.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">mkdir new-ca-cert-secret
cd new-ca-cert-secret</code></pre>
</div>
</div>
</li>
<li>
<p>Fetch the secret for each CA certificate you wish to renew:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>CA-CERTIFICATE-SECRET</em> -o 'jsonpath={.data.<em>CA-CERTIFICATE</em>}' | base64 -d &gt; <em>CA-CERTIFICATE</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>CA-CERTIFICATE</em> with the name of each CA certificate.</p>
</div>
</li>
<li>
<p>Rename the old <code>ca.crt</code> file as <code>ca-<em>DATE</em>.crt</code>,
where <em>DATE</em> is the certificate expiry date in the format <em>YEAR-MONTH-DAYTHOUR-MINUTE-SECONDZ</em>.</p>
<div class="paragraph">
<p>For example <code>ca-2018-09-27T17-32-00Z.crt</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">mv ca.crt ca-$(date -u -d$(openssl x509 -enddate -noout -in ca.crt | sed 's/.*=//') +'%Y-%m-%dT%H-%M-%SZ').crt</code></pre>
</div>
</div>
</li>
<li>
<p>Copy your new CA certificate into the directory, naming it <code>ca.crt</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cp <em>PATH-TO-NEW-CERTIFICATE</em> ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Put your CA certificate in the corresponding <code>Secret</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the existing secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete secret <em>CA-CERTIFICATE-SECRET</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-CERTIFICATE-SECRET</em> is the name of the <code>Secret</code>, as returned in the first step.</p>
</div>
<div class="paragraph">
<p>Ignore any "Not Exists" errors.</p>
</div>
</li>
<li>
<p>Recreate the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>CA-CERTIFICATE-SECRET</em> --from-file=.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Delete the directory you created:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">cd ..
rm -r new-ca-cert-secret</code></pre>
</div>
</div>
</li>
<li>
<p>Put your CA key in the corresponding <code>Secret</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Delete the existing secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete secret <em>CA-KEY-SECRET</em></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>CA-KEY-SECRET</em> is the name of CA key, which is <code><em>KAFKA-CLUSTER-NAME</em>-cluster-ca</code> for the cluster CA key and <code><em>KAFKA-CLUSTER-NAME</em>-clients-ca</code> for the clients CA key.</p>
</div>
</li>
<li>
<p>Recreate the secret with the new CA key:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>CA-KEY-SECRET</em> --from-file=ca.key=<em>CA-KEY-SECRET-FILENAME</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Label the secrets with the labels <code>strimzi.io/kind=Kafka</code> and <code>strimzi.io/cluster=<em>KAFKA-CLUSTER-NAME</em></code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl label secret <em>CA-CERTIFICATE-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>KAFKA-CLUSTER-NAME</em>
kubectl label secret <em>CA-KEY-SECRET</em> strimzi.io/kind=Kafka strimzi.io/cluster=<em>KAFKA-CLUSTER-NAME</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-replacing-private-keys-str"><a class="link" href="#proc-replacing-private-keys-str">9.4. Replacing private keys</a></h3>
<div class="paragraph">
<p>You can replace the private keys used by the cluster CA and clients CA certificates.
When a private key is replaced, the Cluster Operator generates a new CA certificate for the new private key.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>A Kafka cluster in which CA certificates and private keys are installed.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Apply the <code>strimzi.io/force-replace</code> annotation to the <code>Secret</code> that contains the private key that you want to renew.</p>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 13. Commands for replacing private keys</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Private key for</th>
<th class="tableblock halign-left valign-top">Secret</th>
<th class="tableblock halign-left valign-top">Annotate command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-cluster-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-cluster-ca strimzi.io/force-replace=true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>&lt;cluster-name&gt;</em>-clients-ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubectl annotate secret <em>&lt;cluster-name&gt;</em>-clients-ca strimzi.io/force-replace=true</code></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the next reconciliation the Cluster Operator will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new private key for the <code>Secret</code> that you annotated</p>
</li>
<li>
<p>Generate a new CA certificate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If maintenance time windows are configured, the Cluster Operator will generate the new private key and CA certificate at the first reconciliation within the next maintenance time window.</p>
</div>
<div class="paragraph">
<p>Client applications must reload the cluster and clients CA certificates that were renewed by the Cluster Operator.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#certificates-and-secrets-str">Secrets</a></p>
</li>
<li>
<p><a href="#assembly-maintenance-time-windows-deployment-configuration-kafka">Maintenance time windows for rolling updates</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tls-connections-str"><a class="link" href="#tls-connections-str">9.5. TLS connections</a></h3>
<div class="sect3">
<h4 id="zookeeper_communication"><a class="link" href="#zookeeper_communication">9.5.1. ZooKeeper communication</a></h4>
<div class="paragraph">
<p>Communication between the ZooKeeper nodes on all ports as well as between clients and ZooKeeper is encrypted.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_interbroker_communication"><a class="link" href="#kafka_interbroker_communication">9.5.2. Kafka interbroker communication</a></h4>
<div class="paragraph">
<p>Communication between Kafka brokers is done through an internal listener on port 9091, which is encrypted by default and not accessible to Kafka clients.</p>
</div>
<div class="paragraph">
<p>Communication between Kafka brokers and ZooKeeper nodes is also encrypted.</p>
</div>
</div>
<div class="sect3">
<h4 id="topic_and_user_operators"><a class="link" href="#topic_and_user_operators">9.5.3. Topic and User Operators</a></h4>
<div class="paragraph">
<p>All Operators use encryption for communication with both Kafka and ZooKeeper.
In Topic and User Operators, a TLS sidecar is used when communicating with ZooKeeper.</p>
</div>
</div>
<div class="sect3">
<h4 id="cruise_control"><a class="link" href="#cruise_control">9.5.4. Cruise Control</a></h4>
<div class="paragraph">
<p>Cruise Control uses encryption for communication with both Kafka and ZooKeeper.
A TLS sidecar is used when communicating with ZooKeeper.</p>
</div>
</div>
<div class="sect3">
<h4 id="kafka_client_connections"><a class="link" href="#kafka_client_connections">9.5.5. Kafka Client connections</a></h4>
<div class="paragraph">
<p>Encrypted or unencrypted communication between Kafka brokers and clients is configured using the <code>tls</code> property for <code>spec.kafka.listeners</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-internal-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-internal-clients-to-trust-cluster-ca-str">9.6. Configuring internal clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides inside the Kubernetes cluster  connecting to a TLS listener  to trust the cluster CA certificate.</p>
</div>
<div class="paragraph">
<p>The easiest way to achieve this for an internal client is to use a volume mount to access the <code>Secrets</code> containing the necessary certificates and keys.</p>
</div>
<div class="paragraph">
<p>Follow the steps to configure trust certificates that are signed by the cluster CA for Java-based Kafka Producer, Consumer, and Streams APIs.</p>
</div>
<div class="paragraph">
<p>Choose the steps to follow according to the certificate format of the cluster CA: PKCS #12 (<code>.p12</code>) or PEM (<code>.crt</code>).</p>
</div>
<div class="paragraph">
<p>The steps describe how to mount the Cluster Secret that verifies the identity of the Kafka cluster to the client pod.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator must be running.</p>
</li>
<li>
<p>There needs to be a <code>Kafka</code> resource within the Kubernetes cluster.</p>
</li>
<li>
<p>You need a Kafka client application inside the Kubernetes cluster that will connect using TLS, and needs to trust the cluster CA certificate.</p>
</li>
<li>
<p>The client application must be running in the same namespace as the <code>Kafka</code> resource.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Using PKCS #12 format (.p12)</div>
<ol class="arabic">
<li>
<p>Mount the cluster Secret as a volume when defining the client pod.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kind: Pod
apiVersion: v1
metadata:
  name: client-pod
spec:
  containers:
  - name: client-name
    image: client-name
    volumeMounts:
    - name: secret-volume
      mountPath: /data/p12
    env:
    - name: SECRET_PASSWORD
      valueFrom:
        secretKeyRef:
          name: my-secret
          key: my-password
  volumes:
  - name: secret-volume
    secret:
      secretName: my-cluster-cluster-ca-cert</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we&#8217;re mounting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PKCS #12 file into an exact path, which can be configured</p>
</li>
<li>
<p>The password into an environment variable, where it can be used for Java configuration</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the Kafka client with the following properties:</p>
<div class="ulist">
<ul>
<li>
<p>A security protocol option:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS for encryption (with or without TLS authentication).</p>
</li>
<li>
<p><code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ssl.truststore.location</code> with the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code> with the password for accessing the truststore.</p>
</li>
<li>
<p><code>ssl.truststore.type=PKCS12</code> to identify the truststore type.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Using PEM format (.crt)</div>
<ol class="arabic">
<li>
<p>Mount the cluster Secret as a volume when defining the client pod.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kind: Pod
apiVersion: v1
metadata:
  name: client-pod
spec:
  containers:
  - name: client-name
    image: client-name
    volumeMounts:
    - name: secret-volume
      mountPath: /data/crt
  volumes:
  - name: secret-volume
    secret:
      secretName: my-cluster-cluster-ca-cert</code></pre>
</div>
</div>
</li>
<li>
<p>Use the certificate with clients that use certificates in X.509 format.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-clients-to-trust-cluster-ca-str"><a class="link" href="#configuring-external-clients-to-trust-cluster-ca-str">9.7. Configuring external clients to trust the cluster CA</a></h3>
<div class="paragraph">
<p>This procedure describes how to configure a Kafka client that resides outside the Kubernetes cluster  connecting to an <code>external</code> listener  to trust the cluster CA certificate.
Follow this procedure when setting up the client and during the renewal period, when the old clients CA certificate is replaced.</p>
</div>
<div class="paragraph">
<p>Follow the steps to configure trust certificates that are signed by the cluster CA for Java-based Kafka Producer, Consumer, and Streams APIs.</p>
</div>
<div class="paragraph">
<p>Choose the steps to follow according to the certificate format of the cluster CA: PKCS #12 (<code>.p12</code>) or PEM (<code>.crt</code>).</p>
</div>
<div class="paragraph">
<p>The steps describe how to obtain the certificate from the Cluster Secret that verifies the identity of the Kafka cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</code> <code>Secret</code> will contain more than one CA certificate during the CA certificate renewal period.
Clients must add <em>all</em> of them to their truststores.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Cluster Operator must be running.</p>
</li>
<li>
<p>There needs to be a <code>Kafka</code> resource within the Kubernetes cluster.</p>
</li>
<li>
<p>You need a Kafka client application outside the Kubernetes cluster that will connect using TLS, and needs to trust the cluster CA certificate.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Using PKCS #12 format (.p12)</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate and password from the generated <code><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</code> Secret.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.p12}' | base64 -d &gt; ca.p12</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.password}' | base64 -d &gt; ca.password</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the Kafka client with the following properties:</p>
<div class="ulist">
<ul>
<li>
<p>A security protocol option:</p>
<div class="ulist">
<ul>
<li>
<p><code>security.protocol: SSL</code> when using TLS for encryption (with or without TLS authentication).</p>
</li>
<li>
<p><code>security.protocol: SASL_SSL</code> when using SCRAM-SHA authentication over TLS.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ssl.truststore.location</code> with the truststore location where the certificates were imported.</p>
</li>
<li>
<p><code>ssl.truststore.password</code> with the password for accessing the truststore. This property can be omitted if it is not needed by the truststore.</p>
</li>
<li>
<p><code>ssl.truststore.type=PKCS12</code> to identify the truststore type.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Using PEM format (.crt)</div>
<ol class="arabic">
<li>
<p>Extract the cluster CA certificate from the generated <code><em>&lt;cluster-name&gt;</em>-cluster-ca-cert</code> Secret.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get secret <em>&lt;cluster-name&gt;</em>-cluster-ca-cert -o jsonpath='{.data.ca\.crt}' | base64 -d &gt; ca.crt</code></pre>
</div>
</div>
</li>
<li>
<p>Use the certificate with clients that use certificates in X.509 format.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="kafka-listener-certificates-str"><a class="link" href="#kafka-listener-certificates-str">9.8. Kafka listener certificates</a></h3>
<div class="paragraph">
<p>You can provide your own server certificates and private keys for the following types of listeners:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internal TLS listeners for communication within the Kubernetes cluster</p>
</li>
<li>
<p>External listeners (<code>route</code>, <code>loadbalancer</code>, <code>ingress</code>, and <code>nodeport</code> types), which have TLS encryption enabled, for communication between Kafka clients and Kafka brokers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These user-provided certificates are called <em>Kafka listener certificates</em>.</p>
</div>
<div class="paragraph">
<p>Providing Kafka listener certificates for external listeners allows you to leverage existing security infrastructure, such as your organization&#8217;s private CA or a public CA.
Kafka clients will connect to Kafka brokers using Kafka listener certificates rather than certificates signed by the cluster CA or clients CA.</p>
</div>
<div class="paragraph">
<p>You must manually renew Kafka listener certificates when needed.</p>
</div>
<div class="sect3">
<h4 id="proc-installing-certs-per-listener-str"><a class="link" href="#proc-installing-certs-per-listener-str">9.8.1. Providing your own Kafka listener certificates</a></h4>
<div class="paragraph">
<p>This procedure shows how to configure a listener to use your own private key and server certificate, called a <a href="#kafka-listener-certificates-str">Kafka listener certificate</a>.</p>
</div>
<div class="paragraph">
<p>Your client applications should use the CA public key as a trusted certificate in order to verify the identity of the Kafka broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
<li>
<p>For each listener, a compatible server certificate signed by an external CA.</p>
<div class="ulist">
<ul>
<li>
<p>Provide an X.509 certificate in PEM format.</p>
</li>
<li>
<p>Specify the correct Subject Alternative Names (SANs) for each listener.
For more information, see <a href="#ref-alternative-subjects-certs-for-listeners-str">Alternative subjects in server certificates for Kafka listeners</a>.</p>
</li>
<li>
<p>You can provide a certificate that includes the whole CA chain in the certificate file.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> containing your private key and server certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>my-secret</em> --from-file=<em>my-listener-key.key</em> --from-file=<em>my-listener-certificate.crt</em></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>Kafka</code> resource for your cluster. Configure the listener to use your <code>Secret</code>, certificate file, and private key file in the <code>configuration.brokerCertChainAndKey</code> property.</p>
<div class="listingblock">
<div class="title">Example configuration for a <code>loadbalancer</code> external listener with TLS encryption enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  - name: plain
    port: 9092
    type: internal
    tls: false
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      brokerCertChainAndKey:
        secretName: my-secret
        certificate: my-listener-certificate.crt
        key: my-listener-key.key
# ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example configuration for a TLS listener</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  - name: plain
    port: 9092
    type: internal
    tls: false
  - name: tls
    port: 9093
    type: internal
    tls: true
    authentication:
      type: tls
    configuration:
      brokerCertChainAndKey:
        secretName: my-secret
        certificate: my-listener-certificate.crt
        key: my-listener-key.key
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the new configuration to create or update the resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Cluster Operator starts a rolling update of the Kafka cluster, which updates the configuration of the listeners.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A rolling update is also started if you update a Kafka listener certificate in a <code>Secret</code> that is already used by a TLS or external listener.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#ref-alternative-subjects-certs-for-listeners-str">Alternative subjects in server certificates for Kafka listeners</a></p>
</li>
<li>
<p><a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code> schema reference</a></p>
</li>
<li>
<p><a href="#kafka-listener-certificates-str">Kafka listener certificates</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-alternative-subjects-certs-for-listeners-str"><a class="link" href="#ref-alternative-subjects-certs-for-listeners-str">9.8.2. Alternative subjects in server certificates for Kafka listeners</a></h4>
<div class="paragraph">
<p>In order to use TLS hostname verification with your own <a href="#kafka-listener-certificates-str">Kafka listener certificates</a>, you must use the correct Subject Alternative Names (SANs) for each listener. The certificate SANs must specify hostnames for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All of the Kafka brokers in your cluster</p>
</li>
<li>
<p>The Kafka cluster bootstrap service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use wildcard certificates if they are supported by your CA.</p>
</div>
<div class="sect4">
<h5 id="tls_listener_san_examples"><a class="link" href="#tls_listener_san_examples">TLS listener SAN examples</a></h5>
<div class="paragraph">
<p>Use the following examples to help you specify hostnames of the SANs in your certificates for TLS listeners.</p>
</div>
<div class="listingblock">
<div class="title">Wildcards example</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">//Kafka brokers
*.<em>&lt;cluster-name&gt;</em>-kafka-brokers
*.<em>&lt;cluster-name&gt;</em>-kafka-brokers.<em>&lt;namespace&gt;</em>.svc

// Bootstrap service
<em>&lt;cluster-name&gt;</em>-kafka-bootstrap
<em>&lt;cluster-name&gt;</em>-kafka-bootstrap.<em>&lt;namespace&gt;</em>.svc</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Non-wildcards example</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">// Kafka brokers
<em>&lt;cluster-name&gt;</em>-kafka-0.<em>&lt;cluster-name&gt;</em>-kafka-brokers
<em>&lt;cluster-name&gt;</em>-kafka-0.<em>&lt;cluster-name&gt;</em>-kafka-brokers.<em>&lt;namespace&gt;</em>.svc
<em>&lt;cluster-name&gt;</em>-kafka-1.<em>&lt;cluster-name&gt;</em>-kafka-brokers
<em>&lt;cluster-name&gt;</em>-kafka-1.<em>&lt;cluster-name&gt;</em>-kafka-brokers.<em>&lt;namespace&gt;</em>.svc
# ...

// Bootstrap service
<em>&lt;cluster-name&gt;</em>-kafka-bootstrap
<em>&lt;cluster-name&gt;</em>-kafka-bootstrap.<em>&lt;namespace&gt;</em>.svc</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="external_listener_san_examples"><a class="link" href="#external_listener_san_examples">External listener SAN examples</a></h5>
<div class="paragraph">
<p>For external listeners which have TLS encryption enabled, the hostnames you need to specify in certificates depends on the external listener <code>type</code>.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 14. SANs for each type of external listener</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">External listener type</th>
<th class="tableblock halign-left valign-top">In the SANs, specify&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Route</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses of all Kafka broker <code>Routes</code> and the address of the bootstrap <code>Route</code>.</p>
<p class="tableblock">You can use a matching wildcard name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loadbalancer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses of all Kafka broker <code>loadbalancers</code> and the bootstrap <code>loadbalancer</code> address.</p>
<p class="tableblock">You can use a matching wildcard name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NodePort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addresses of all Kubernetes worker nodes that the Kafka broker pods might be scheduled to.</p>
<p class="tableblock">You can use a matching wildcard name.</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-installing-certs-per-listener-str">Providing your own Kafka listener certificates</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="management-tasks-str"><a class="link" href="#management-tasks-str">10. Managing Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter covers tasks to maintain a deployment of Strimzi.</p>
</div>
<div class="sect2">
<h3 id="working-with-resources-str"><a class="link" href="#working-with-resources-str">10.1. Working with custom resources</a></h3>
<div class="paragraph">
<p>You can use <code>kubectl</code> commands to retrieve information and perform other operations on Strimzi custom resources.</p>
</div>
<div class="paragraph">
<p>Using <code>kubectl</code> with the <code>status</code> subresource of a custom resource allows you to get the information about the resource.</p>
</div>
<div class="sect3">
<h4 id="con-custom-resources-info-str"><a class="link" href="#con-custom-resources-info-str">10.1.1. Performing <code>kubectl</code> operations on custom resources</a></h4>
<div class="paragraph">
<p>Use <code>kubectl</code> commands, such as <code>get</code>, <code>describe</code>, <code>edit</code>, or <code>delete</code>, to perform operations on resource types.
For example, <code>kubectl get kafkatopics</code> retrieves a list of all Kafka topics and <code>kubectl get kafkas</code> retrieves all deployed Kafka clusters.</p>
</div>
<div class="paragraph">
<p>When referencing resource types, you can use both singular and plural names:
<code>kubectl get kafkas</code> gets the same results as <code>kubectl get kafka</code>.</p>
</div>
<div class="paragraph">
<p>You can also use the <em>short name</em> of the resource.
Learning short names can save you time when managing Strimzi.
The short name for <code>Kafka</code> is <code>k</code>, so you can also run <code>kubectl get k</code> to list all Kafka clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get k

NAME         DESIRED KAFKA REPLICAS   DESIRED ZK REPLICAS
my-cluster   3                        3</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 15. Long and short names for each Strimzi resource</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Strimzi resource</th>
<th class="tableblock halign-left valign-top">Long name</th>
<th class="tableblock halign-left valign-top">Short name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Topic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkatopic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkauser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ku</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaconnect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connect S2I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaconnects2i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kcs2i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Connector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaconnector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kctr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Mirror Maker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkamirrormaker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kmm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Mirror Maker 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkamirrormaker2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kmm2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Bridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkabridge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka Rebalance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkarebalance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kr</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="resource_categories"><a class="link" href="#resource_categories">Resource categories</a></h5>
<div class="paragraph">
<p>Categories of custom resources can also be used in <code>kubectl</code> commands.</p>
</div>
<div class="paragraph">
<p>All Strimzi custom resources belong to the category <code>strimzi</code>, so you can use <code>strimzi</code> to get all the Strimzi resources with one command.</p>
</div>
<div class="paragraph">
<p>For example, running <code>kubectl get strimzi</code> lists all Strimzi custom resources in a given namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get strimzi

NAME                                   DESIRED KAFKA REPLICAS DESIRED ZK REPLICAS
kafka.kafka.strimzi.io/my-cluster      3                      3

NAME                                   PARTITIONS REPLICATION FACTOR
kafkatopic.kafka.strimzi.io/kafka-apps 3          3

NAME                                   AUTHENTICATION AUTHORIZATION
kafkauser.kafka.strimzi.io/my-user     tls            simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>kubectl get strimzi -o name</code> command returns all resource types and resource names.
The <code>-o name</code> option fetches the output in the <em>type/name</em> format</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get strimzi -o name

kafka.kafka.strimzi.io/my-cluster
kafkatopic.kafka.strimzi.io/kafka-apps
kafkauser.kafka.strimzi.io/my-user</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can combine this <code>strimzi</code> command with other commands.
For example, you can pass it into a <code>kubectl delete</code> command to delete all resources in a single command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl delete $(kubectl get strimzi -o name)

kafka.kafka.strimzi.io "my-cluster" deleted
kafkatopic.kafka.strimzi.io "kafka-apps" deleted
kafkauser.kafka.strimzi.io "my-user" deleted</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deleting all resources in a single operation might be useful, for example,
when you are testing new Strimzi features.</p>
</div>
</div>
<div class="sect4">
<h5 id="querying_the_status_of_sub_resources"><a class="link" href="#querying_the_status_of_sub_resources">Querying the status of sub-resources</a></h5>
<div class="paragraph">
<p>There are other values you can pass to the <code>-o</code> option.
For example, by using <code>-o yaml</code> you get the output in YAML format.
Usng <code>-o json</code> will return it as JSON.</p>
</div>
<div class="paragraph">
<p>You can see all the options in <code>kubectl get --help</code>.</p>
</div>
<div class="paragraph">
<p>One of the most useful options is the <a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener">JSONPath support</a>, which allows you to pass JSONPath expressions to query the Kubernetes API.
A JSONPath expression can extract or navigate specific parts of any resource.</p>
</div>
<div class="paragraph">
<p>For example, you can use the JSONPath expression <code>{.status.listeners[?(@.type=="tls")].bootstrapServers}</code>
to get the bootstrap address from the status of the Kafka custom resource and use it in your Kafka clients.</p>
</div>
<div class="paragraph">
<p>Here, the command finds the <code>bootstrapServers</code> value of the <code>tls</code> listeners.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka my-cluster -o=jsonpath='{.status.listeners[?(@.type=="tls")].bootstrapServers}{"\n"}'

my-cluster-kafka-bootstrap.myproject.svc:9093</code></pre>
</div>
</div>
<div class="paragraph">
<p>By changing the type condition to <code>@.type=="external"</code> or <code>@.type=="plain"</code> you can also get the address of the other Kafka listeners.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka my-cluster -o=jsonpath='{.status.listeners[?(@.type=="external")].bootstrapServers}{"\n"}'

192.168.1.247:9094</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>jsonpath</code> to extract any other property or group of properties from any custom resource.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-custom-resources-status-str"><a class="link" href="#con-custom-resources-status-str">10.1.2. Strimzi custom resource status information</a></h4>
<div class="paragraph">
<p>Several resources have a <code>status</code> property, as described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<caption class="title">Table 16. Custom resource status properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Strimzi resource</th>
<th class="tableblock halign-left valign-top">Schema reference</th>
<th class="tableblock halign-left valign-top">Publishes status information on&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Kafka</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaStatus-reference"><code>KafkaStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka Connect cluster, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnectS2I</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2IStatus-reference"><code>KafkaConnectS2IStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka Connect cluster with Source-to-Image support, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaConnector</code> resources, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaMirrorMaker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kafka MirrorMaker tool, if deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaTopic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka topics in your Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kafka users in your Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>KafkaBridge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code> schema reference</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Strimzi Kafka Bridge, if deployed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>status</code> property of a resource provides information on the resource&#8217;s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Current state</em>, in the <code>status.conditions</code> property</p>
</li>
<li>
<p><em>Last observed generation</em>, in the <code>status.observedGeneration</code> property</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>status</code> property also provides resource-specific information. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KafkaConnectStatus</code> provides the REST API endpoint for Kafka Connect connectors.</p>
</li>
<li>
<p><code>KafkaUserStatus</code> provides the user name of the Kafka user and the <code>Secret</code> in which their credentials are stored.</p>
</li>
<li>
<p><code>KafkaBridgeStatus</code> provides the HTTP address at which external client applications can access the Bridge service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A resource&#8217;s <em>current state</em> is useful for tracking progress related to the resource achieving its <em>desired state</em>, as defined by the <code>spec</code> property. The status conditions provide the time and reason the state of the resource changed and details of events preventing or delaying the operator from realizing the resource&#8217;s desired state.</p>
</div>
<div class="paragraph">
<p>The <em>last observed generation</em> is the generation of the resource that was last reconciled by the Cluster Operator. If the value of <code>observedGeneration</code> is different from the value of <code>metadata.generation</code>, the operator has not yet processed the latest update to the resource. If these values are the same, the status information reflects the most recent changes to the resource.</p>
</div>
<div class="paragraph">
<p>Strimzi creates and maintains the status of custom resources, periodically evaluating the current state of the custom resource and updating its status accordingly.
When performing an update on a custom resource using <code>kubectl edit</code>, for example, its <code>status</code> is not editable. Moreover, changing the <code>status</code> would not affect the configuration of the Kafka cluster.</p>
</div>
<div class="paragraph">
<p>Here we see the <code>status</code> property specified for a Kafka custom resource.</p>
</div>
<div class="listingblock">
<div class="title">Kafka custom resource with status</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
spec:
  # ...
status:
  conditions: <b class="conum">(1)</b>
  - lastTransitionTime: 2019-07-23T23:46:57+0000
    status: "True"
    type: Ready <b class="conum">(2)</b>
  observedGeneration: 4 <b class="conum">(3)</b>
  listeners: <b class="conum">(4)</b>
  - addresses:
    - host: my-cluster-kafka-bootstrap.myproject.svc
      port: 9092
    type: plain
  - addresses:
    - host: my-cluster-kafka-bootstrap.myproject.svc
      port: 9093
    certificates:
    - |
      -----BEGIN CERTIFICATE-----
      ...
      -----END CERTIFICATE-----
    type: tls
  - addresses:
    - host: 172.29.49.180
      port: 9094
    certificates:
    - |
      -----BEGIN CERTIFICATE-----
      ...
      -----END CERTIFICATE-----
    type: external
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Status <code>conditions</code> describe criteria related to the status that cannot be deduced from the existing resource information, or are specific to the instance of a resource.</p>
</li>
<li>
<p>The <code>Ready</code> condition indicates whether the Cluster Operator currently considers the Kafka cluster able to handle traffic.</p>
</li>
<li>
<p>The <code>observedGeneration</code> indicates the generation of the <code>Kafka</code> custom resource that was last reconciled by the Cluster Operator.</p>
</li>
<li>
<p>The <code>listeners</code> describe the current Kafka bootstrap addresses by type.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The address in the custom resource status for external listeners with type <code>nodeport</code> is currently not supported.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Kafka bootstrap addresses listed in the status do not signify that those endpoints or the Kafka cluster is in a ready state.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Accessing status information</div>
<p>You can access status information for a resource from the command line. For more information, see <a href="#proc-accessing-resource-status-str">Finding the status of a custom resource</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-accessing-resource-status-str"><a class="link" href="#proc-accessing-resource-status-str">10.1.3. Finding the status of a custom resource</a></h4>
<div class="paragraph">
<p>This procedure describes how to find the status of a custom resource.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Kubernetes cluster.</p>
</li>
<li>
<p>The Cluster Operator is running.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Specify the custom resource and use the <code>-o jsonpath</code> option to apply a standard JSONPath expression to select the <code>status</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>&lt;kafka_resource_name&gt;</em> -o jsonpath='{.status}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This expression returns all the status information for the specified custom resource. You can use dot notation, such as <code>status.listeners</code> or <code>status.observedGeneration</code>, to fine-tune the status information you wish to see.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#con-custom-resources-status-str">Strimzi custom resource status information</a></p>
</li>
<li>
<p>For more information about using JSONPath, see <a href="https://kubernetes.io/docs/reference/kubectl/jsonpath/" target="_blank" rel="noopener">JSONPath support</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-add-service-discovery-str"><a class="link" href="#proc-add-service-discovery-str">10.2. Discovering services using labels and annotations</a></h3>
<div class="paragraph">
<p>Service discovery makes it easier for client applications running in the same Kubernetes cluster as Strimzi to interact with a Kafka cluster.</p>
</div>
<div class="paragraph">
<p>A <em>service discovery</em> label and annotation is generated for services used to access the Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Internal Kafka bootstrap service</p>
</li>
<li>
<p>HTTP Bridge service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The label helps to make the service discoverable, and the annotation provides connection details that a client application can use to make the connection.</p>
</div>
<div class="paragraph">
<p>The service discovery label, <code>strimzi.io/discovery</code>, is set as <code>true</code> for the <code>Service</code> resources.
The service discovery annotation has the same key, providing connection details in JSON format for each service.</p>
</div>
<h4 id="example_internal_kafka_bootstrap_service" class="discrete">Example internal Kafka bootstrap service</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Service
metadata:
  annotations:
    strimzi.io/discovery: |-
      [ {
        "port" : 9092,
        "tls" : false,
        "protocol" : "kafka",
        "auth" : "scram-sha-512"
      }, {
        "port" : 9093,
        "tls" : true,
        "protocol" : "kafka",
        "auth" : "tls"
      } ]
  labels:
    strimzi.io/cluster: my-cluster
    strimzi.io/discovery: "true"
    strimzi.io/kind: Kafka
    strimzi.io/name: my-cluster-kafka-bootstrap
  name: my-cluster-kafka-bootstrap
spec:
  #...</code></pre>
</div>
</div>
<h4 id="example_http_bridge_service" class="discrete">Example HTTP Bridge service</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Service
metadata:
  annotations:
    strimzi.io/discovery: |-
      [ {
        "port" : 8080,
        "tls" : false,
        "auth" : "none",
        "protocol" : "http"
      } ]
  labels:
    strimzi.io/cluster: my-bridge
    strimzi.io/discovery: "true"
    strimzi.io/kind: KafkaBridge
    strimzi.io/name: my-bridge-bridge-service</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="returning_connection_details_on_services"><a class="link" href="#returning_connection_details_on_services">10.2.1. Returning connection details on services</a></h4>
<div class="paragraph">
<p>You can find the services by specifying the discovery label when fetching services from the command line or a corresponding API call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">kubectl get service -l strimzi.io/discovery=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The connection details are returned when retrieving the service discovery label.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-recovery-str"><a class="link" href="#cluster-recovery-str">10.3. Recovering a cluster from persistent volumes</a></h3>
<div class="paragraph">
<p>You can recover a Kafka cluster from persistent volumes (PVs) if they are still present.</p>
</div>
<div class="paragraph">
<p>You might want to do this, for example, after:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A namespace was deleted unintentionally</p>
</li>
<li>
<p>A whole Kubernetes cluster is lost, but the PVs remain in the infrastructure</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="namespace-deletion_str"><a class="link" href="#namespace-deletion_str">10.3.1. Recovery from namespace deletion</a></h4>
<div class="paragraph">
<p>Recovery from namespace deletion is possible because of the relationship between persistent volumes and namespaces.
A <code>PersistentVolume</code> (PV) is a storage resource that lives outside of a namespace.
A PV is mounted into a Kafka pod using a <code>PersistentVolumeClaim</code> (PVC), which lives inside a namespace.</p>
</div>
<div class="paragraph">
<p>The reclaim policy for a PV tells a cluster how to act when a namespace is deleted.
If the reclaim policy is set as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Delete</em> (default), PVs are deleted when PVCs are deleted within a namespace</p>
</li>
<li>
<p><em>Retain</em>, PVs are not deleted when a namespace is deleted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To ensure that you can recover from a PV if a namespace is deleted unintentionally, the policy must be reset from <em>Delete</em> to <em>Retain</em> in the PV specification using the <code>persistentVolumeReclaimPolicy</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: v1
kind: PersistentVolume
# ...
spec:
  # ...
  <strong>persistentVolumeReclaimPolicy: Retain</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, PVs can inherit the reclaim policy of an associated storage class.
Storage classes are used for dynamic volume allocation.</p>
</div>
<div class="paragraph">
<p>By configuring the <code>reclaimPolicy</code> property for the storage class, PVs that use the storage class are created with the appropriate reclaim policy.
The storage class is configured for the PV using the <code>storageClassName</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: v1
kind: StorageClass
metadata:
  <strong>name: gp2-retain</strong>
parameters:
  # ...
# ...
<strong>reclaimPolicy: Retain</strong></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: v1
kind: PersistentVolume
# ...
spec:
  # ...
  <strong>storageClassName: gp2-retain</strong></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are using <em>Retain</em> as the reclaim policy, but you want to delete an entire cluster, you need to delete the PVs manually.
Otherwise they will not be deleted, and may cause unnecessary expenditure on resources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cluster-loss_str"><a class="link" href="#cluster-loss_str">10.3.2. Recovery from loss of a Kubernetes cluster</a></h4>
<div class="paragraph">
<p>When a cluster is lost, you can use the data from disks/volumes to recover the cluster if they were preserved within the infrastructure.
The recovery procedure is the same as with namespace deletion, assuming PVs can be recovered and they were created manually.</p>
</div>
</div>
<div class="sect3">
<h4 id="cluster-recovery-volume_str"><a class="link" href="#cluster-recovery-volume_str">10.3.3. Recovering a deleted cluster from persistent volumes</a></h4>
<div class="paragraph">
<p>This procedure describes how to recover a deleted cluster from persistent volumes (PVs).</p>
</div>
<div class="paragraph">
<p>In this situation, the Topic Operator identifies that topics exist in Kafka, but the <code>KafkaTopic</code> resources do not exist.</p>
</div>
<div class="paragraph">
<p>When you get to the step to recreate your cluster, you have two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use <em>Option 1</em> when you can recover all <code>KafkaTopic</code> resources.</p>
<div class="paragraph">
<p>The <code>KafkaTopic</code> resources must therefore be recovered before the cluster is started so that the corresponding topics are not deleted by the Topic Operator.</p>
</div>
</li>
<li>
<p>Use <em>Option 2</em> when you are unable to recover all <code>KafkaTopic</code> resources.</p>
<div class="paragraph">
<p>This time you deploy your cluster without the Topic Operator, delete the Topic Operator data in ZooKeeper, and then redeploy it so that the Topic Operator can recreate the <code>KafkaTopic</code> resources from the corresponding topics.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the Topic Operator is not deployed, you only need to recover the <code>PersistentVolumeClaim</code> (PVC) resources.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Before you begin</div>
<p>In this procedure, it is essential that PVs are mounted into the correct PVC to avoid data corruption.
A <code>volumeName</code> is specified for the PVC and this must match the name of the PV.</p>
</div>
<div class="paragraph">
<p>For more information, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="ref-persistent-storage-str.html#pvc-naming">Persistent Volume Claim naming</a></p>
</li>
<li>
<p><a href="ref-jbod-storage-str.html#jbod-pvc">JBOD and Persistent Volume Claims</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The procedure does not include recovery of <code>KafkaUser</code> resources, which must be recreated manually.
If passwords and certificates need to be retained, secrets must be recreated before creating the <code>KafkaUser</code> resources.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Check information on the PVs in the cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get pv</code></pre>
</div>
</div>
<div class="paragraph">
<p>Information is presented for PVs with data.</p>
</div>
<div class="paragraph">
<p>Example output showing columns important to this procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">NAME                                         RECLAIMPOLICY CLAIM
pvc-5e9c5c7f-3317-11ea-a650-06e1eadd9a4c ... Retain ...    myproject/data-my-cluster-zookeeper-1
pvc-5e9cc72d-3317-11ea-97b0-0aef8816c7ea ... Retain ...    myproject/data-my-cluster-zookeeper-0
pvc-5ead43d1-3317-11ea-97b0-0aef8816c7ea ... Retain ...    myproject/data-my-cluster-zookeeper-2
pvc-7e1f67f9-3317-11ea-a650-06e1eadd9a4c ... Retain ...    myproject/data-0-my-cluster-kafka-0
pvc-7e21042e-3317-11ea-9786-02deaf9aa87e ... Retain ...    myproject/data-0-my-cluster-kafka-1
pvc-7e226978-3317-11ea-97b0-0aef8816c7ea ... Retain ...    myproject/data-0-my-cluster-kafka-2</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>NAME</em> shows the name of each PV.</p>
</li>
<li>
<p><em>RECLAIM POLICY</em> shows that PVs are <em>retained</em>.</p>
</li>
<li>
<p><em>CLAIM</em> shows the link to the original PVCs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Recreate the original namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create namespace <em>myproject</em></code></pre>
</div>
</div>
</li>
<li>
<p>Recreate the original PVC resource specifications, linking the PVCs to the appropriate PV:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: data-0-my-cluster-kafka-0
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  storageClassName: gp2-retain
  volumeMode: Filesystem
  volumeName: <strong>pvc-7e1f67f9-3317-11ea-a650-06e1eadd9a4c</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Edit the PV specifications to delete the <code>claimRef</code> properties that bound the original PVC.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: v1
kind: PersistentVolume
metadata:
  annotations:
    kubernetes.io/createdby: aws-ebs-dynamic-provisioner
    pv.kubernetes.io/bound-by-controller: "yes"
    pv.kubernetes.io/provisioned-by: kubernetes.io/aws-ebs
  creationTimestamp: "&lt;date&gt;"
  finalizers:
  - kubernetes.io/pv-protection
  labels:
    failure-domain.beta.kubernetes.io/region: eu-west-1
    failure-domain.beta.kubernetes.io/zone: eu-west-1c
  name: pvc-7e226978-3317-11ea-97b0-0aef8816c7ea
  resourceVersion: "39431"
  selfLink: /api/v1/persistentvolumes/pvc-7e226978-3317-11ea-97b0-0aef8816c7ea
  uid: 7efe6b0d-3317-11ea-a650-06e1eadd9a4c
spec:
  accessModes:
  - ReadWriteOnce
  awsElasticBlockStore:
    fsType: xfs
    volumeID: aws://eu-west-1c/vol-09db3141656d1c258
  capacity:
    storage: 100Gi
  <strong>claimRef:</strong>
    <strong>apiVersion: v1</strong>
    <strong>kind: PersistentVolumeClaim</strong>
    <strong>name: data-0-my-cluster-kafka-2</strong>
    <strong>namespace: myproject</strong>
    <strong>resourceVersion: "39113"</strong>
    <strong>uid: 54be1c60-3319-11ea-97b0-0aef8816c7ea</strong>
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: failure-domain.beta.kubernetes.io/zone
          operator: In
          values:
          - eu-west-1c
        - key: failure-domain.beta.kubernetes.io/region
          operator: In
          values:
          - eu-west-1
  persistentVolumeReclaimPolicy: Retain
  storageClassName: gp2-retain
  volumeMode: Filesystem</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example, the following properties are deleted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">claimRef:
  apiVersion: v1
  kind: PersistentVolumeClaim
  name: data-0-my-cluster-kafka-2
  namespace: myproject
  resourceVersion: "39113"
  uid: 54be1c60-3319-11ea-97b0-0aef8816c7ea</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Cluster Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f install/cluster-operator -n <em>my-project</em></code></pre>
</div>
</div>
</li>
<li>
<p>Recreate your cluster.</p>
<div class="paragraph">
<p>Follow the steps depending on whether or not you have all the <code>KafkaTopic</code> resources needed to recreate your cluster.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong><em>Option 1</em></strong>: If you have <strong>all</strong> the <code>KafkaTopic</code> resources that existed before you lost your cluster, including internal topics such as committed offsets from <code>__consumer_offsets</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Recreate all <code>KafkaTopic</code> resources.</p>
<div class="paragraph">
<p>It is essential that you recreate the resources before deploying the cluster, or the Topic Operator will delete the topics.</p>
</div>
</li>
<li>
<p>Deploy the Kafka cluster.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl apply -f <em>kafka.yaml</em></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong><em>Option 2</em></strong>: If you do not have all the <code>KafkaTopic</code> resources that existed before you lost your cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the Kafka cluster, as with the first option, but without the Topic Operator by removing the <code>topicOperator</code> property from the Kafka resource before deploying.</p>
<div class="paragraph">
<p>If you include the Topic Operator in the deployment, the Topic Operator will delete all the topics.</p>
</div>
</li>
<li>
<p>Run an <code>exec</code> command to one of the Kafka broker pods to open the ZooKeeper shell script.</p>
<div class="paragraph">
<p>For example, where <em>my-cluster-kafka-0</em> is the name of the broker pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl exec -ti <em>my-cluster-zookeeper-0</em> -- bin/zookeeper-shell.sh localhost:12181</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the whole <code>/strimzi</code> path to remove the Topic Operator storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">deleteall /strimzi</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the Topic Operator by redeploying the Kafka cluster with the <code>topicOperator</code> property to recreate the <code>KafkaTopic</code> resources.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  #...
  entityOperator:
    <strong>topicOperator: {}</strong> <b class="conum">(1)</b>
    #...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Here we show the default configuration, which has no additional properties.
You specify the required configuration using the properties described in <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code> schema reference</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Verify the recovery by listing the <code>KafkaTopic</code> resources:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get KafkaTopic</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-client-config-str"><a class="link" href="#assembly-client-config-str">10.4. Tuning client configuration</a></h3>
<div class="paragraph">
<p>Use configuration properties to optimize the performance of Kafka producers and consumers.</p>
</div>
<div class="paragraph">
<p>A minimum set of configuration properties is required,
but you can add or adjust properties to change how producers and consumers interact with Kafka.
For example, for producers you can tune latency and throughput of messages so that clients can respond to data in real time.
Or you can change the configuration to provide stronger message durability guarantees.</p>
</div>
<div class="paragraph">
<p>You might start by analyzing client metrics to gauge where to make your initial configurations,
then make incremental changes and further comparisons until you have the configuration you need.</p>
</div>
<div class="sect3">
<h4 id="con-producer-config-properties-str"><a class="link" href="#con-producer-config-properties-str">10.4.1. Kafka producer configuration tuning</a></h4>
<div class="paragraph">
<p>Use a basic producer configuration with optional properties that are tailored to specific use cases.</p>
</div>
<div class="paragraph">
<p>Adjusting your configuration to maximize throughput might increase latency or vice versa.
You will need to experiment and tune your producer configuration to get the balance you need.</p>
</div>
<div class="sect4">
<h5 id="basic_producer_configuration"><a class="link" href="#basic_producer_configuration">Basic producer configuration</a></h5>
<div class="paragraph">
<p>Connection and serializer properties are required for every producer.
Generally, it is good practice to add a client id for tracking,
and use compression on the producer to reduce batch sizes in requests.</p>
</div>
<div class="paragraph">
<p>In a basic producer configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The order of messages in a partition is not guaranteed.</p>
</li>
<li>
<p>The acknowledgment of messages reaching the broker does not guarantee durability.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># ...
bootstrap.servers=localhost:9092 <b class="conum">(1)</b>
key.serializer=org.apache.kafka.common.serialization.StringSerializer <b class="conum">(2)</b>
value.serializer=org.apache.kafka.common.serialization.StringSerializer <b class="conum">(3)</b>
client.id=my-client <b class="conum">(4)</b>
compression.type=gzip <b class="conum">(5)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Tells the producer to connect to a Kafka cluster using a <em>host:port</em> bootstrap server address for a Kafka broker.
The producer uses the address to discover and connect to all brokers in the cluster.
Use a comma-separated list to specify two or three addresses in case a server is down, but its not necessary to provide a list of all the brokers in the cluster.</p>
</li>
<li>
<p>(Required) Serializer to transform the key of each message to bytes prior to them being sent to a broker.</p>
</li>
<li>
<p>(Required) Serializer to transform the value of each message to bytes prior to them being sent to a broker.</p>
</li>
<li>
<p>(Optional) The logical name for the client, which is used in logs and metrics to identify the source of a request.</p>
</li>
<li>
<p>(Optional) The codec for compressing messages, which are sent and might be stored in compressed format and then decompressed when reaching a consumer.
Compression is useful for improving throughput and reducing the load on storage, but might not be suitable for low latency applications where the cost of compression or decompression could be prohibitive.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="data_durability"><a class="link" href="#data_durability">Data durability</a></h5>
<div class="paragraph">
<p>You can apply greater data durability, to minimize the likelihood that messages are lost, using message delivery acknowledgments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
acks=all <b class="conum">(1)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specifying <code>acks=all</code> forces a partition leader to replicate messages to a certain number of followers before
acknowledging that the message request was successfully received.
Because of the additional checks, <code>acks=all</code> increases the latency between the producer sending a message and receiving acknowledgment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The number of brokers which need to have appended the messages to their logs before the acknowledgment is sent to the producer is determined by the topic&#8217;s <code>min.insync.replicas</code> configuration.
A typical starting point is to have a topic replication factor of 3, with two in-sync replicas on other brokers.
In this configuration, the producer can continue unaffected if a single broker is unavailable.
If a second broker becomes unavailable, the producer wont receive acknowledgments and wont be able to produce more messages.</p>
</div>
<div class="listingblock">
<div class="title">Topic configuration to support <code>acks=all</code></div>
<div class="content">
<pre># ...
min.insync.replicas=2 <b class="conum">(1)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Use <code>2</code> in-sync replicas. The default is <code>1</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the system fails, there is a risk of unsent data in the buffer being lost.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ordered_delivery"><a class="link" href="#ordered_delivery">Ordered delivery</a></h5>
<div class="paragraph">
<p>Idempotent producers avoid duplicates as messages are delivered exactly once.
IDs and sequence numbers are assigned to messages to ensure the order of delivery, even in the event of failure.
If you are using <code>acks=all</code> for data consistency, enabling idempotency makes sense for ordered delivery.</p>
</div>
<div class="listingblock">
<div class="title">Ordered delivery with idempotency</div>
<div class="content">
<pre># ...
enable.idempotence=true <b class="conum">(1)</b>
max.in.flight.requests.per.connection=5 <b class="conum">(2)</b>
acks=all <b class="conum">(3)</b>
retries=2147483647 <b class="conum">(4)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set to <code>true</code> to enable the idempotent producer.</p>
</li>
<li>
<p>With idempotent delivery the number of in-flight requests may be greater than 1 while still providing the message ordering guarantee. The default is 5 in-flight requests.</p>
</li>
<li>
<p>Set <code>acks</code> to <code>all</code>.</p>
</li>
<li>
<p>Set the number of attempts to resend a failed message request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are not using <code>acks=all</code> and idempotency because of the performance cost,
set the number of in-flight (unacknowledged) requests to 1 to preserve ordering.
Otherwise, a situation is possible where <em>Message-A</em> fails only to succeed after <em>Message-B</em> was already written to the broker.</p>
</div>
<div class="listingblock">
<div class="title">Ordered delivery without idempotency</div>
<div class="content">
<pre># ...
enable.idempotence=false <b class="conum">(1)</b>
max.in.flight.requests.per.connection=1 <b class="conum">(2)</b>
retries=2147483647
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set to <code>false</code> to disable the idempotent producer.</p>
</li>
<li>
<p>Set the number of in-flight requests to exactly <code>1</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="reliability_guarantees"><a class="link" href="#reliability_guarantees">Reliability guarantees</a></h5>
<div class="paragraph">
<p>Idempotence is useful for exactly once writes to a single partition.
Transactions, when used with idempotence, allow exactly once writes across multiple partitions.</p>
</div>
<div class="paragraph">
<p>Transactions guarantee that messages using the same transactional ID are produced once,
and either <em>all</em> are successfully written to the respective logs or <em>none</em> of them are.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># ...
enable.idempotence=true
max.in.flight.requests.per.connection=5
acks=all
retries=2147483647
transactional.id=<em>UNIQUE-ID</em> <b class="conum">(1)</b>
transaction.timeout.ms=900000 <b class="conum">(2)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify a unique transactional ID.</p>
</li>
<li>
<p>Set the maximum allowed time for transactions in milliseconds before a timeout error is returned.
The default is <code>900000</code> or 15 minutes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The choice of <code>transactional.id</code> is important in order that the transactional guarantee is maintained.
Each transactional id should be used for a unique set of topic partitions.
For example, this can be achieved using an external mapping of topic partition names to transactional ids,
or by computing the transactional id from the topic partition names using a function that avoids collisions.</p>
</div>
</div>
<div class="sect4">
<h5 id="optimizing_throughput_and_latency"><a class="link" href="#optimizing_throughput_and_latency">Optimizing throughput and latency</a></h5>
<div class="paragraph">
<p>Usually, the requirement of a system is to satisfy a particular throughput target for a proportion of messages within a given latency.
For example, targeting 500,000 messages per second with 95% of messages being acknowledged within 2 seconds.</p>
</div>
<div class="paragraph">
<p>Its likely that the messaging semantics (message ordering and durability) of your producer are defined by the requirements for your application.
For instance, its possible that you dont have the option of using <code>acks=0</code> or <code>acks=1</code> without breaking some important property or guarantee provided by your application.</p>
</div>
<div class="paragraph">
<p>Broker restarts have a significant impact on high percentile statistics.
For example, over a long period the 99th percentile latency is dominated by behavior around broker restarts.
This is worth considering when designing benchmarks or comparing performance numbers from benchmarking with performance numbers seen in production.</p>
</div>
<div class="paragraph">
<p>Depending on your objective, Kafka offers a number of configuration parameters and techniques for tuning producer performance for throughput and latency.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Message batching (<code>linger.ms</code> and <code>batch.size</code>)</dt>
<dd>
<p>Message batching delays sending messages in the hope that more messages destined for the same broker will be sent,
allowing them to be batched into a single produce request.
Batching is a compromise between higher latency in return for higher throughput.
Time-based batching is configured using <code>linger.ms</code>, and size-based batching is configured using <code>batch.size</code>.</p>
</dd>
<dt class="hdlist1">Compression (<code>compression.type</code>)</dt>
<dd>
<p>Message compression adds latency in the producer (CPU time spent compressing the messages),
but makes requests (and potentially disk writes) smaller, which can increase throughput.
Whether compression is worthwhile, and the best compression to use, will depend on the messages being sent.
Compression happens on the thread which calls <code>KafkaProducer.send()</code>,
so if the latency of this method matters for your application you should consider using more threads.</p>
</dd>
<dt class="hdlist1">Pipelining (<code>max.in.flight.requests.per.connection</code>)</dt>
<dd>
<p>Pipelining means sending more requests before the response to a previous request has been received.
In general more pipelining means better throughput, up to a threshold at which other effects,
such as worse batching, start to counteract the effect on throughput.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Lowering latency</div>
<p>When your application calls <code>KafkaProducer.send()</code> the messages are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Processed by any interceptors</p>
</li>
<li>
<p>Serialized</p>
</li>
<li>
<p>Assigned to a partition</p>
</li>
<li>
<p>Compressed</p>
</li>
<li>
<p>Added to a batch of messages in a per-partition queue</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At which point the <code>send()</code> method returns.
So the time <code>send()</code> is blocked is determined by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The time spent in the interceptors, serializers and partitioner</p>
</li>
<li>
<p>The compression algorithm used</p>
</li>
<li>
<p>The time spent waiting for a buffer to use for compression</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Batches will remain in the queue until one of the following occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The batch is full (according to <code>batch.size</code>)</p>
</li>
<li>
<p>The delay introduced by <code>linger.ms</code> has passed</p>
</li>
<li>
<p>The sender is about to send message batches for other partitions to the same broker, and it is possible to add this batch too</p>
</li>
<li>
<p>The producer is being flushed or closed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Look at the configuration for batching and buffering to mitigate the impact of <code>send()</code> blocking on latency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
linger.ms=100 <b class="conum">(1)</b>
batch.size=16384 <b class="conum">(2)</b>
buffer.memory=33554432 <b class="conum">(3)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>linger</code> property adds a delay in milliseconds so that larger batches of messages are accumulated and sent in a request. The default is <code>0'.</code></p>
</li>
<li>
<p>If a maximum <code>batch.size</code> in bytes is used, a request is sent when the maximum is reached, or messages have been queued for longer than <code>linger.ms</code> (whichever comes sooner).
Adding the delay allows batches to accumulate messages up to the batch size.</p>
</li>
<li>
<p>The buffer size must be at least as big as the batch size, and be able to accommodate buffering, compression and in-flight requests.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Increasing throughput</div>
<p>Improve throughput of your message requests by adjusting the maximum time to wait before a message is delivered and completes a send request.</p>
</div>
<div class="paragraph">
<p>You can also direct messages to a specified partition by writing a custom partitioner to replace the default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
delivery.timeout.ms=120000 <b class="conum">(1)</b>
partitioner.class=my-custom-partitioner <b class="conum">(2)</b>

# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The maximum time in milliseconds to wait for a complete send request. You can set the value to <code>MAX_LONG</code> to delegate to Kafka an indefinite number of retries.
The default is <code>120000</code> or 2 minutes.</p>
</li>
<li>
<p>Specify the class name of the custom partitioner.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-consumer-config-properties-str"><a class="link" href="#con-consumer-config-properties-str">10.4.2. Kafka consumer configuration tuning</a></h4>
<div class="paragraph">
<p>Use a basic consumer configuration with optional properties that are tailored to specific use cases.</p>
</div>
<div class="paragraph">
<p>When tuning your consumers your primary concern will be ensuring that they cope efficiently with the amount of data ingested.
As with the producer tuning, be prepared to make incremental changes until the consumers operate as expected.</p>
</div>
<div class="sect4">
<h5 id="basic_consumer_configuration"><a class="link" href="#basic_consumer_configuration">Basic consumer configuration</a></h5>
<div class="paragraph">
<p>Connection and deserializer properties are required for every consumer.
Generally, it is good practice to add a client id for tracking.</p>
</div>
<div class="paragraph">
<p>In a consumer configuration, irrespective of any subsequent configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The consumer fetches from a given offset and consumes the messages in order, unless the offset is changed to skip or re-read messages.</p>
</li>
<li>
<p>The broker does not know if the consumer processed the responses, even when committing offsets to Kafka, because the offsets might be sent to a different broker in the cluster.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># ...
bootstrap.servers=localhost:9092 <b class="conum">(1)</b>
key.deserializer=org.apache.kafka.common.serialization.StringDeserializer  <b class="conum">(2)</b>
value.deserializer=org.apache.kafka.common.serialization.StringDeserializer  <b class="conum">(3)</b>
client.id=my-client <b class="conum">(4)</b>
group.id=my-group-id <b class="conum">(5)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>(Required) Tells the consumer to connect to a Kafka cluster using a <em>host:port</em> bootstrap server address for a Kafka broker.
The consumer uses the address to discover and connect to all brokers in the cluster.
Use a comma-separated list to specify two or three addresses in case a server is down, but it is not necessary to provide a list of all the brokers in the cluster.
If you are using a loadbalancer service to expose the Kafka cluster, you only need the address for the service because the availability is handled by the loadbalancer.</p>
</li>
<li>
<p>(Required) Deserializer to transform the bytes fetched from the Kafka broker into message keys.</p>
</li>
<li>
<p>(Required) Deserializer to transform the bytes fetched from the Kafka broker into message values.</p>
</li>
<li>
<p>(Optional) The logical name for the client, which is used in logs and metrics to identify the source of a request. The id can also be used to throttle consumers based on processing time quotas.</p>
</li>
<li>
<p>(Conditional) A group id is <em>required</em> for a consumer to be able to join a consumer group.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Consumer groups are used to share a typically large data stream generated by multiple producers from a given topic.
Consumers are grouped using a <code>group.id</code>, allowing messages to be spread across the members.</p>
</div>
</div>
<div class="sect4">
<h5 id="scaling_data_consumption_using_consumer_groups"><a class="link" href="#scaling_data_consumption_using_consumer_groups">Scaling data consumption using consumer groups</a></h5>
<div class="paragraph">
<p>Consumer groups share a typically large data stream generated by one or multiple producers from a given topic.
Consumers with the same <code>group.id</code> property are in the same group.
One of the consumers in the group is elected leader and decides how the partitions are assigned to the consumers in the group.
Each partition can only be assigned to a single consumer.</p>
</div>
<div class="paragraph">
<p>If you do not already have as many consumers as partitions,
you can scale data consumption by adding more consumer instances with the same <code>group.id</code>.
Adding more consumers to a group than there are partitions will not help throughput,
but it does mean that there are consumers on standby should one stop functioning.
If you can meet throughput goals with fewer consumers, you save on resources.</p>
</div>
<div class="paragraph">
<p>Consumers within the same consumer group send offset commits and heartbeats to the same broker.
So the greater the number of consumers in the group, the higher the request load on the broker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
group.id=my-group-id <b class="conum">(1)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add a consumer to a consumer group using a group id.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="message_ordering_guarantees"><a class="link" href="#message_ordering_guarantees">Message ordering guarantees</a></h5>
<div class="paragraph">
<p>Kafka brokers receive fetch requests from consumers that ask the broker to send messages from a list of topics, partitions and offset positions.</p>
</div>
<div class="paragraph">
<p>A consumer observes messages in a single partition in the same order that they were committed to the broker,
which means that Kafka <strong>only</strong> provides ordering guarantees for messages in a single partition.
Conversely, if a consumer is consuming messages from multiple partitions, the order of messages in different partitions as observed by the consumer does not necessarily reflect the order in which they were sent.</p>
</div>
<div class="paragraph">
<p>If you want a strict ordering of messages from one topic, use one partition per consumer.</p>
</div>
</div>
<div class="sect4">
<h5 id="optimizing_throughput_and_latency_2"><a class="link" href="#optimizing_throughput_and_latency_2">Optimizing throughput and latency</a></h5>
<div class="paragraph">
<p>Control the number of messages returned when your client application calls <code>KafkaConsumer.poll()</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>fetch.max.wait.ms</code> and <code>fetch.min.bytes</code> properties to increase the minimum amount of data fetched by the consumer from the Kafka broker.
Time-based batching is configured using <code>fetch.max.wait.ms</code>, and size-based batching is configured using <code>fetch.min.bytes</code>.</p>
</div>
<div class="paragraph">
<p>If CPU utilization in the consumer or broker is high, it might be because there are too many requests from the consumer.
You can adjust <code>fetch.max.wait.ms</code> and <code>fetch.min.bytes</code> properties higher so that there are fewer requests and messages are delivered in bigger batches.
By adjusting higher, throughput is improved with some cost to latency.
You can also adjust higher if the amount of data being produced is low.</p>
</div>
<div class="paragraph">
<p>For example, if you set <code>fetch.max.wait.ms</code> to 500ms and <code>fetch.min.bytes</code> to 16384 bytes,
when Kafka receives a fetch request from the consumer it will respond when the first of either threshold is reached.</p>
</div>
<div class="paragraph">
<p>Conversely, you can adjust the <code>fetch.max.wait.ms</code> and <code>fetch.min.bytes</code> properties lower to improve end-to-end latency.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
fetch.max.wait.ms=500 <b class="conum">(1)</b>
fetch.min.bytes=16384 <b class="conum">(2)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The maximum time in milliseconds the broker will wait before completing fetch requests.
The default is <code>500</code> milliseconds.</p>
</li>
<li>
<p>If a minimum batch size in bytes is used, a request is sent when the minimum is reached, or messages have been queued for longer than <code>fetch.max.wait.ms</code> (whichever comes sooner).
Adding the delay allows batches to accumulate messages up to the batch size.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Lowering latency by increasing the fetch request size</div>
<p>Use the <code>fetch.max.bytes</code> and <code>max.partition.fetch.bytes</code> properties to increase the maximum amount of data fetched by the consumer from the Kafka broker.</p>
</div>
<div class="paragraph">
<p>The <code>fetch.max.bytes</code> property sets a maximum limit in bytes on the amount of data fetched from the broker at one time.</p>
</div>
<div class="paragraph">
<p>The <code>max.partition.fetch.bytes</code> sets a maximum limit in bytes on how much data is returned for each partition,
which must always be larger than the number of bytes set in the broker or topic configuration for <code>max.message.bytes</code>.</p>
</div>
<div class="paragraph">
<p>The maximum amount of memory a client can consume is calculated approximately as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"><em>NUMBER-OF-BROKERS</em> * fetch.max.bytes and <em>NUMBER-OF-PARTITIONS</em> * max.partition.fetch.bytes</code></pre>
</div>
</div>
<div class="paragraph">
<p>If memory usage can accommodate it, you can increase the values of these two properties.
By allowing more data in each request, latency is improved as there are fewer fetch requests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
fetch.max.bytes=52428800 <b class="conum">(1)</b>
max.partition.fetch.bytes=1048576 <b class="conum">(2)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The maximum amount of data in bytes returned for a fetch request.</p>
</li>
<li>
<p>The maximum amount of data in bytes returned for each partition.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="avoiding_data_loss_or_duplication_when_committing_offsets"><a class="link" href="#avoiding_data_loss_or_duplication_when_committing_offsets">Avoiding data loss or duplication when committing offsets</a></h5>
<div class="paragraph">
<p>The Kafka <em>auto-commit mechanism</em> allows a consumer to commit the offsets of messages automatically.
If enabled, the consumer will commit offsets received from polling the broker at 5000ms intervals.</p>
</div>
<div class="paragraph">
<p>The auto-commit mechanism is convenient, but it introduces a risk of data loss and duplication.
If a consumer has fetched and transformed a number of messages, but the system crashes with processed messages in the consumer buffer when performing an auto-commit, that data is lost.
If the system crashes after processing the messages, but before performing the auto-commit, the data is duplicated on another consumer instance after rebalancing.</p>
</div>
<div class="paragraph">
<p>Auto-committing can avoid data loss only when all messages are processed before the next poll to the broker,
or the consumer closes.</p>
</div>
<div class="paragraph">
<p>To minimize the likelihood of data loss or duplication, you can set <code>enable.auto.commit</code> to <code>false</code> and develop your client application to have more control over committing offsets.
Or you can use <code>auto.commit.interval.ms</code> to decrease the intervals between commits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
enable.auto.commit=false <b class="conum">(1)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Auto commit is set to false to provide more control over committing offsets.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>By setting to <code>enable.auto.commit</code> to <code>false</code>, you can commit offsets after <strong>all</strong> processing has been performed and the message has been consumed.
For example, you can set up your application to call the Kafka <code>commitSync</code> and <code>commitAsync</code> commit APIs.</p>
</div>
<div class="paragraph">
<p>The <code>commitSync</code> API commits the offsets in a message batch returned from polling.
You call the API when you are finished processing all the messages in the batch.
If you use the <code>commitSync</code> API, the application will not poll for new messages until the last offset in the batch is committed.
If this negatively affects throughput, you can commit less frequently,
or you can use the <code>commitAsync</code> API.
The <code>commitAsync</code> API does not wait for the broker to respond to a commit request,
but risks creating more duplicates when rebalancing.
A common approach is to combine both commit APIs in an application, with the <code>commitSync</code> API used just before shutting the consumer down or rebalancing to make sure the final commit is successful.</p>
</div>
<div class="sect5">
<h6 id="controlling_transactional_messages"><a class="link" href="#controlling_transactional_messages">Controlling transactional messages</a></h6>
<div class="paragraph">
<p>Consider using transactional ids and enabling idempotence (<code>enable.idempotence=true</code>) on the producer side to guarantee exactly-once delivery.
On the consumer side, you can then use the <code>isolation.level</code> property to control how transactional messages are read by the consumer.</p>
</div>
<div class="paragraph">
<p>The <code>isolation.level</code> property has two valid values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>read_committed</code></p>
</li>
<li>
<p><code>read_uncommitted</code> (default)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use <code>read_committed</code> to ensure that only transactional messages that have been committed are read by the consumer.
However, this will cause an increase in end-to-end latency, because the consumer will not be able to return a message until the brokers have written the transaction markers that record the result of the transaction (<em>committed</em> or <em>aborted</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
enable.auto.commit=false
isolation.level=read_committed <b class="conum">(1)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set to <code>read_committed</code> so that only committed messages are read by the consumer.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="recovering_from_failure_to_avoid_data_loss"><a class="link" href="#recovering_from_failure_to_avoid_data_loss">Recovering from failure to avoid data loss</a></h5>
<div class="paragraph">
<p>Use the <code>session.timeout.ms</code> and <code>heartbeat.interval.ms</code> properties to configure the time taken to check and recover from consumer failure within a consumer group.</p>
</div>
<div class="paragraph">
<p>The <code>session.timeout.ms</code> property specifies the maximum amount of time in milliseconds a consumer within a consumer group can be out of contact with a broker before being considered inactive and a <em>rebalancing</em> is triggered between the active consumers in the group.
When the group rebalances, the partitions are reassigned to the members of the group.</p>
</div>
<div class="paragraph">
<p>The <code>heartbeat.interval.ms</code> property specifies the interval in milliseconds between <em>heartbeat</em> checks to the consumer group coordinator to indicate that the consumer is active and connected.
The heartbeat interval must be lower, usually by a third, than the session timeout interval.</p>
</div>
<div class="paragraph">
<p>If you set the <code>session.timeout.ms</code> property lower, failing consumers are detected earlier, and rebalancing can take place quicker.
However, take care not to set the timeout so low that the broker fails to receive a heartbeat in time and triggers an unnecessary rebalance.</p>
</div>
<div class="paragraph">
<p>Decreasing the heartbeat interval reduces the chance of accidental rebalancing, but more frequent heartbeats increases the overhead on broker resources.</p>
</div>
</div>
<div class="sect4">
<h5 id="managing_offset_policy"><a class="link" href="#managing_offset_policy">Managing offset policy</a></h5>
<div class="paragraph">
<p>Use the <code>auto.offset.reset</code> property to control how a consumer behaves when no offsets have been committed,
or a committed offset is no longer valid or deleted.</p>
</div>
<div class="paragraph">
<p>Suppose you deploy a consumer application for the first time, and it reads messages from an existing topic.
Because this is the first time the <code>group.id</code> is used, the <code>__consumer_offsets</code> topic does not contain any offset information for this application.
The new application can start processing all existing messages from the start of the log or only new messages.
The default reset value is <code>latest</code>, which starts at the end of the partition, and consequently means some messages are missed.
To avoid data loss, but increase the amount of processing, set <code>auto.offset.reset</code> to <code>earliest</code> to start at the beginning of the partition.</p>
</div>
<div class="paragraph">
<p>Also consider using the <code>earliest</code> option to avoid messages being lost when the offsets retention period (<code>offsets.retention.minutes</code>) configured for a broker has ended.
If a consumer group or standalone consumer is inactive and commits no offsets during the retention period, previously committed offsets are deleted from <code>__consumer_offsets</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ...
heartbeat.interval.ms=3000 <b class="conum">(1)</b>
session.timeout.ms=10000 <b class="conum">(2)</b>
auto.offset.reset=earliest <b class="conum">(3)</b>
# ...</pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Adjust the heartbeat interval lower according to anticipated rebalances.</p>
</li>
<li>
<p>If no heartbeats are received by the Kafka broker before the timeout duration expires, the consumer is removed from the consumer group and a rebalance is initiated.
If the broker configuration has a <code>group.min.session.timeout.ms</code> and <code>group.max.session.timeout.ms</code>, the session timeout value must be within that range.</p>
</li>
<li>
<p>Set to <code>earliest</code> to return to the start of a partition and avoid data loss if offsets were not committed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the amount of data returned in a single fetch request is large,
a timeout might occur before the consumer has processed it.
In this case, you can lower <code>max.partition.fetch.bytes</code> or increase <code>session.timeout.ms</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="minimizing_the_impact_of_rebalances"><a class="link" href="#minimizing_the_impact_of_rebalances">Minimizing the impact of rebalances</a></h5>
<div class="paragraph">
<p>The rebalancing of a partition between active consumers in a group is the time it takes for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consumers to commit their offsets</p>
</li>
<li>
<p>The new consumer group to be formed</p>
</li>
<li>
<p>The group leader to assign partitions to group members</p>
</li>
<li>
<p>The consumers in the group to receive their assignments and start fetching</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clearly, the process increases the downtime of a service, particularly when it happens repeatedly during a rolling restart of a consumer group cluster.</p>
</div>
<div class="paragraph">
<p>In this situation, you can use the concept of <em>static membership</em> to reduce the number of rebalances.
Rebalancing assigns topic partitions evenly among consumer group members.
Static membership uses persistence so that a consumer instance is recognized during a restart after a session timeout.</p>
</div>
<div class="paragraph">
<p>The consumer group coordinator can identify a new consumer instance using a unique id that is specified using the <code>group.instance.id</code> property.
During a restart, the consumer is assigned a new member id, but as a static member it continues with the same instance id,
and the same assignment of topic partitions is made.</p>
</div>
<div class="paragraph">
<p>If the consumer application does not make a call to poll at least every <code>max.poll.interval.ms milliseconds</code>, the consumer is considered to be failed, causing a rebalance.
If the application cannot process all the records returned from poll in time, you can avoid a rebalance by using the <code>max.poll.interval.ms</code> property to specify the interval in milliseconds between polls for new messages from a consumer.
Or you can use the <code>max.poll.records</code> property to set a maximum limit on the number of records returned from the consumer buffer, allowing your application to process fewer records within the <code>max.poll.interval.ms limit</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs"># ...
group.instance.id=<em>UNIQUE-ID</em> <b class="conum">(1)</b>
max.poll.interval.ms=300000 <b class="conum">(2)</b>
max.poll.records=500 <b class="conum">(3)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The unique instance id ensures that a new consumer instance receives the same assignment of topic partitions.</p>
</li>
<li>
<p>Set the interval to check the consumer is continuing to process messages.</p>
</li>
<li>
<p>Sets the number of processed records returned from the consumer.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uninstalling-str"><a class="link" href="#uninstalling-str">10.5. Uninstalling Strimzi</a></h3>
<div class="paragraph">
<p>This procedure describes how to uninstall Strimzi and remove resources related to the deployment.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>In order to perform this procedure, identify resources created specifically for a deployment and referenced from the Strimzi resource.</p>
</div>
<div class="paragraph">
<p>Such resources include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Secrets (Custom CAs and certificates, Kafka Connect secrets, and other Kafka secrets)</p>
</li>
<li>
<p>Logging <code>ConfigMaps</code> (of type <code>external</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are resources referenced by <code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code> configuration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete the Cluster Operator <code>Deployment</code>, related <code>CustomResourceDefinitions</code>, and <code>RBAC</code> resources:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kubectl delete -f install/cluster-operator</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting <code>CustomResourceDefinitions</code> results in the garbage collection of the corresponding custom resources (<code>Kafka</code>, <code>KafkaConnect</code>, <code>KafkaConnectS2I</code>, <code>KafkaMirrorMaker</code>, or <code>KafkaBridge</code>) and the resources dependent on them (Deployments, StatefulSets, and other dependent resources).
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Delete the resources you identified in the prerequisites.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-faq_str"><a class="link" href="#appendix-faq_str">Appendix A: Frequently asked questions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="questions_related_to_the_cluster_operator"><a class="link" href="#questions_related_to_the_cluster_operator">A.1. Questions related to the Cluster Operator</a></h3>
<div class="sect3">
<h4 id="co-faq-admin-privileges_str"><a class="link" href="#co-faq-admin-privileges_str">A.1.1. Why do I need cluster administrator privileges to install Strimzi?</a></h4>
<div class="paragraph">
<p>To install Strimzi, you need to be able to create the following cluster-scoped resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Custom Resource Definitions (CRDs) to instruct Kubernetes about resources that are specific to Strimzi, such as <code>Kafka</code> and <code>KafkaConnect</code></p>
</li>
<li>
<p><code>ClusterRoles</code> and <code>ClusterRoleBindings</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cluster-scoped resources, which are not scoped to a particular Kubernetes namespace, typically require <em>cluster administrator</em> privileges to install.</p>
</div>
<div class="paragraph">
<p>As a cluster administrator, you can inspect all the resources being installed (in the <code>/install/</code> directory) to ensure that the <code>ClusterRoles</code> do not grant unnecessary privileges.</p>
</div>
<div class="paragraph">
<p>After installation, the Cluster Operator runs as a regular <code>Deployment</code>, so any standard (non-admin) Kubernetes user with privileges to access the <code>Deployment</code> can configure it.
The cluster administrator can grant standard users the privileges necessary to manage <code>Kafka</code> custom resources.</p>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#co-faq-cluster-role-bindings_str">Why does the Cluster Operator need to create <code>ClusterRoleBindings</code>?</a></p>
</li>
<li>
<p><a href="#co-faq-standard-users_str">Can standard Kubernetes users create Kafka custom resources?</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="co-faq-cluster-role-bindings_str"><a class="link" href="#co-faq-cluster-role-bindings_str">A.1.2. Why does the Cluster Operator need to create <code>ClusterRoleBindings</code>?</a></h4>
<div class="paragraph">
<p>Kubernetes has built-in <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping" target="_blank" rel="noopener">privilege escalation prevention</a>,
which means that the Cluster Operator cannot grant privileges it does not have itself, specifically, it cannot grant such privileges in a namespace it cannot access.
Therefore, the Cluster Operator must have the privileges necessary for <em>all</em> the components it orchestrates.</p>
</div>
<div class="paragraph">
<p>The Cluster Operator needs to be able to grant access so that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Topic Operator can manage  <code>KafkaTopics</code>, by creating <code>Roles</code> and <code>RoleBindings</code> in the namespace that the operator runs in</p>
</li>
<li>
<p>The User Operator can manage <code>KafkaUsers</code>, by creating <code>Roles</code> and <code>RoleBindings</code> in the namespace that the operator runs in</p>
</li>
<li>
<p>The failure domain of a <code>Node</code> is discovered by Strimzi, by creating a <code>ClusterRoleBinding</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using rack-aware partition assignment, the broker pod needs to be able to get information about the <code>Node</code> it is running on,
for example, the Availability Zone in Amazon AWS.
A <code>Node</code> is a cluster-scoped resource, so access to it can only be granted through a <code>ClusterRoleBinding</code>, not a namespace-scoped <code>RoleBinding</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="co-faq-standard-users_str"><a class="link" href="#co-faq-standard-users_str">A.1.3. Can standard Kubernetes users create Kafka custom resources?</a></h4>
<div class="paragraph">
<p>By default, standard Kubernetes users will not have the privileges necessary to manage the custom resources handled by the Cluster Operator.
The cluster administrator can grant a user the necessary privileges using Kubernetes RBAC resources.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="./deploying.html#adding-users-the-strimzi-admin-role-str" target="_blank" rel="noopener">Designating Strimzi administrators</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="what_do_the_failed_to_acquire_lock_warnings_in_the_log_mean"><a class="link" href="#what_do_the_failed_to_acquire_lock_warnings_in_the_log_mean">A.1.4. What do the <em>failed to acquire lock</em> warnings in the log mean?</a></h4>
<div class="paragraph">
<p>For each cluster, the Cluster Operator executes only one operation at a time.
The Cluster Operator uses locks to make sure that there are never two parallel operations running for the same cluster.
Other operations must wait until the current operation completes before the lock is released.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">INFO</dt>
<dd>
<p>Examples of cluster operations include <em>cluster creation</em>, <em>rolling update</em>, <em>scale down</em> , and <em>scale up</em>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If the waiting time for the lock takes too long, the operation times out and the following warning message is printed to
the log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">2018-03-04 17:09:24 WARNING AbstractClusterOperations:290 - Failed to acquire lock for kafka cluster lock::kafka::myproject::my-cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the exact configuration of <code>STRIMZI_FULL_RECONCILIATION_INTERVAL_MS</code> and <code>STRIMZI_OPERATION_TIMEOUT_MS</code>, this
warning message might appear occasionally without indicating any underlying issues.
Operations that time out are picked up in the next periodic reconciliation, so that the operation can acquire the lock and execute again.</p>
</div>
<div class="paragraph">
<p>Should this message appear periodically, even in situations when there should be no other operations running for a given
cluster, it might indicate that the lock was not properly released due to an error.
If this is the case, try restarting the Cluster Operator.</p>
</div>
</div>
<div class="sect3">
<h4 id="why_is_hostname_verification_failing_when_connecting_to_nodeports_using_tls"><a class="link" href="#why_is_hostname_verification_failing_when_connecting_to_nodeports_using_tls">A.1.5. Why is hostname verification failing when connecting to NodePorts using TLS?</a></h4>
<div class="paragraph">
<p>Currently, off-cluster access using NodePorts with TLS encryption enabled does not support TLS hostname verification.
As a result, the clients that verify the hostname will fail to connect.
For example, the Java client will fail with the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Caused by: java.security.cert.CertificateException: No subject alternative names matching IP address 168.72.15.231 found
 at sun.security.util.HostnameChecker.matchIP(HostnameChecker.java:168)
 at sun.security.util.HostnameChecker.match(HostnameChecker.java:94)
 at sun.security.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:455)
 at sun.security.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:436)
 at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:252)
 at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:136)
 at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1501)
 ... 17 more</code></pre>
</div>
</div>
<div class="paragraph">
<p>To connect, you must disable hostname verification.
In the Java client, you can do this by setting the configuration option <code>ssl.endpoint.identification.algorithm</code> to an empty string.</p>
</div>
<div class="paragraph">
<p>When configuring the client using a properties file, you can do it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">ssl.endpoint.identification.algorithm=</code></pre>
</div>
</div>
<div class="paragraph">
<p>When configuring the client directly in Java, set the configuration option to an empty string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">props.put("ssl.endpoint.identification.algorithm", "");</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api_reference-str"><a class="link" href="#api_reference-str">Appendix B: Custom Resource API Reference</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="con-common-configuration-properties-reference"><a class="link" href="#con-common-configuration-properties-reference">B.1. Common configuration properties</a></h3>
<div class="paragraph">
<p>Common configuration properties apply to more than one resource.</p>
</div>
<div class="sect3">
<h4 id="con-common-configuration-replicas-reference"><a class="link" href="#con-common-configuration-replicas-reference">B.1.1. <code>replicas</code></a></h4>
<div class="paragraph">
<p>Use the <code>replicas</code> property to configure replicas.</p>
</div>
<div class="paragraph">
<p>The type of replication depends on the resource.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KafkaTopic</code> uses a replication factor to configure the number of replicas of each partition within a Kafka cluster.</p>
</li>
<li>
<p>Kafka components use replicas to configure the number of pods in a deployment to provide better availability and scalability.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When running a Kafka component on Kubernetes it may not be necessary to run multiple replicas for high availability.
When the node where the component is deployed crashes, Kubernetes will automatically reschedule the Kafka component pod to a different node.
However, running Kafka components with multiple replicas can provide faster failover times as the other nodes will be up and running.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-bootstrap-reference"><a class="link" href="#con-common-configuration-bootstrap-reference">B.1.2. <code>bootstrapServers</code></a></h4>
<div class="paragraph">
<p>Use the <code>bootstrapServers</code> property to configure a list of bootstrap servers.</p>
</div>
<div class="paragraph">
<p>The bootstrap server lists can refer to Kafka clusters that are not deployed in the same Kubernetes cluster.
They can also refer to a Kafka cluster not deployed by Strimzi.</p>
</div>
<div class="paragraph">
<p>If on the same Kubernetes cluster, each list must ideally contain the Kafka cluster bootstrap service which is named <code><em>CLUSTER-NAME</em>-kafka-bootstrap</code> and a port number.
If deployed by Strimzi but on different Kubernetes clusters, the list content depends on the approach used for exposing the clusters (routes, nodeports or loadbalancers).</p>
</div>
<div class="paragraph">
<p>When using Kafka with a Kafka cluster not managed by Strimzi, you can specify the bootstrap servers list according to the configuration of the given cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-ssl-reference"><a class="link" href="#con-common-configuration-ssl-reference">B.1.3. <code>ssl</code></a></h4>
<div class="paragraph">
<p>Use the three allowed <code>ssl</code> configuration options for client connection using a specific <em>cipher suite</em> for a TLS version.
A cipher suite combines algorithms for secure connection and data transfer.</p>
</div>
<div class="paragraph">
<p>You can also configure the <code>ssl.endpoint.identification.algorithm</code> property to enable or disable hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">Example SSL configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
spec:
  config:
    ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384" <b class="conum">(1)</b>
    ssl.enabled.protocols: "TLSv1.2" <b class="conum">(2)</b>
    ssl.protocol: "TLSv1.2" <b class="conum">(3)</b>
    ssl.endpoint.identification.algorithm: HTTPS <b class="conum">(4)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The cipher suite for TLS using a combination of <code>ECDHE</code> key exchange mechanism, <code>RSA</code> authentication algorithm,
<code>AES</code> bulk encyption algorithm and <code>SHA384</code> MAC algorithm.</p>
</li>
<li>
<p>The SSl protocol <code>TLSv1.2</code> is enabled.</p>
</li>
<li>
<p>Specifies the <code>TLSv1.2</code> protocol to generate the SSL context.
Allowed values are <code>TLSv1.1</code> and <code>TLSv1.2</code>.</p>
</li>
<li>
<p>Hostname verification is enabled by setting to <code>HTTPS</code>. An empty string disables the verification.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-trusted-certificates-reference"><a class="link" href="#con-common-configuration-trusted-certificates-reference">B.1.4. <code>trustedCertificates</code></a></h4>
<div class="paragraph">
<p>Having set <code>tls</code> to configure TLS encryption, use the <code>trustedCertificates</code> property to provide a list of secrets with key names under which the certificates are stored in X.509 format.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the Cluster Operator for the Kafka cluster,
or you can create your own TLS certificate file, then create a <code>Secret</code> from the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>MY-SECRET</em> \
--from-file=<em>MY-TLS-CERTIFICATE-FILE.crt</em></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example TLS encryption configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">tls:
  trustedCertificates:
    - secretName: my-cluster-cluster-cert
      certificate: ca.crt
    - secretName: my-cluster-cluster-cert
      certificate: ca2.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If certificates are stored in the same secret, it can be listed multiple times.</p>
</div>
<div class="paragraph">
<p>If you want to enable TLS, but use the default set of public certification authorities shipped with Java,
you can specify <code>trustedCertificates</code> as an empty array:</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling TLS with the default Java certificates</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">tls:
  trustedCertificates: []</code></pre>
</div>
</div>
<div class="paragraph">
<p>For information on configuring TLS client authentication, see <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code> schema reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-resources-reference"><a class="link" href="#con-common-configuration-resources-reference">B.1.5. <code>resources</code></a></h4>
<div class="paragraph">
<p>You request CPU and memory resources for components.
Limits specify the maximum resources that can be consumed by a given container.</p>
</div>
<div class="paragraph">
<p>Resource requests and limits for the Topic Operator and User Operator are set in the <code>Kafka</code> resource.</p>
</div>
<div class="paragraph">
<p>Use the <code>reources.requests</code> and <code>resources.limits</code> properties to configure resource requests and limits.</p>
</div>
<div class="paragraph">
<p>For every deployed container, Strimzi allows you to request specific resources and define the maximum consumption of those resources.</p>
</div>
<div class="paragraph">
<p>Strimzi supports requests and limits for the following types of resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cpu</code></p>
</li>
<li>
<p><code>memory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Strimzi uses the Kubernetes syntax for specifying these resources.</p>
</div>
<div class="paragraph">
<p>For more information about managing computing resources on Kubernetes, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/" target="_blank" rel="noopener">Managing Compute Resources for Containers</a>.</p>
</div>
<div class="paragraph">
<p><strong>Resource requests</strong></p>
</div>
<div class="paragraph">
<p>Requests specify the resources to reserve for a given container.
Reserving the resources ensures that they are always available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the resource request is for more than the available free resources in the Kubernetes cluster, the pod is not scheduled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A request may be configured for one or more supported resources.</p>
</div>
<div class="paragraph">
<p><strong>Resource limits</strong></p>
</div>
<div class="paragraph">
<p>Limits specify the maximum resources that can be consumed by a given container.
The limit is not reserved and might not always be available.
A container can use the resources up to the limit only when they are available.
Resource limits should be always higher than the resource requests.</p>
</div>
<div class="paragraph">
<p>A resource may be configured for one or more supported limits.</p>
</div>
<div class="paragraph">
<p><strong>Supported CPU formats</strong></p>
</div>
<div class="paragraph">
<p>CPU requests and limits are supported in the following formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of CPU cores as integer (<code>5</code> CPU core) or decimal (<code>2.5</code> CPU core).</p>
</li>
<li>
<p>Number or <em>millicpus</em> / <em>millicores</em> (<code>100m</code>) where 1000 <em>millicores</em> is the same <code>1</code> CPU core.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The computing power of 1 CPU core may differ depending on the platform where Kubernetes is deployed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on CPU specification, see the <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-cpu" target="_blank" rel="noopener">Meaning of CPU</a>.</p>
</div>
<div class="paragraph">
<p><strong>Supported memory formats</strong></p>
</div>
<div class="paragraph">
<p>Memory requests and limits are specified in megabytes, gigabytes, mebibytes, and gibibytes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To specify memory in megabytes, use the <code>M</code> suffix. For example <code>1000M</code>.</p>
</li>
<li>
<p>To specify memory in gigabytes, use the <code>G</code> suffix. For example <code>1G</code>.</p>
</li>
<li>
<p>To specify memory in mebibytes, use the <code>Mi</code> suffix. For example <code>1000Mi</code>.</p>
</li>
<li>
<p>To specify memory in gibibytes, use the <code>Gi</code> suffix. For example <code>1Gi</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more details about memory specification and additional supported units, see <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#meaning-of-memory" target="_blank" rel="noopener">Meaning of memory</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-images-reference"><a class="link" href="#con-common-configuration-images-reference">B.1.6. <code>image</code></a></h4>
<div class="paragraph">
<p>Use the <code>image</code> property to configure the container image used by the component.</p>
</div>
<div class="paragraph">
<p>Overriding container images is recommended only in special situations where you need to use a different container registry or a customized image.</p>
</div>
<div class="paragraph">
<p>For example, if your network does not allow access to the container repository used by Strimzi, you can copy the Strimzi images or build them from the source.
However, if the configured image is not compatible with Strimzi images, it might not work properly.</p>
</div>
<div class="paragraph">
<p>A copy of the container image might also be customized and used for debugging.</p>
</div>
<div class="paragraph">
<p>You can specify which container image to use for a component using the <code>image</code> property in the following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.topicOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.userOperator</code></p>
</li>
<li>
<p><code>Kafka.spec.entityOperator.tlsSidecar</code></p>
</li>
<li>
<p><code>Kafka.spec.jmxTrans</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker2.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring the <code>image</code> property for Kafka, Kafka Connect, and Kafka MirrorMaker</strong></p>
</div>
<div class="paragraph">
<p>Kafka, Kafka Connect (including Kafka Connect with S2I support), and Kafka MirrorMaker support multiple versions of Kafka.
Each component requires its own image.
The default images for the different Kafka versions are configured in the following environment variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STRIMZI_KAFKA_IMAGES</code></p>
</li>
<li>
<p><code>STRIMZI_KAFKA_CONNECT_IMAGES</code></p>
</li>
<li>
<p><code>STRIMZI_KAFKA_CONNECT_S2I_IMAGES</code></p>
</li>
<li>
<p><code>STRIMZI_KAFKA_MIRROR_MAKER_IMAGES</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These environment variables contain mappings between the Kafka versions and their corresponding images.
The mappings are used together with the <code>image</code> and <code>version</code> properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If neither <code>image</code> nor <code>version</code> are given in the custom resource then the <code>version</code> will default to the Cluster Operator&#8217;s default Kafka version, and the image will be the one corresponding to this version in the environment variable.</p>
</li>
<li>
<p>If <code>image</code> is given but <code>version</code> is not, then the given image is used and the <code>version</code> is assumed to be the Cluster Operator&#8217;s default Kafka version.</p>
</li>
<li>
<p>If <code>version</code> is given but <code>image</code> is not, then the image that corresponds to the given version in the environment variable is used.</p>
</li>
<li>
<p>If both <code>version</code> and <code>image</code> are given, then the given image is used. The image is assumed to contain a Kafka image with the given version.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>image</code> and <code>version</code> for the different components can be configured in the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kafka in <code>spec.kafka.image</code> and <code>spec.kafka.version</code>.</p>
</li>
<li>
<p>For Kafka Connect, Kafka Connect S2I, and Kafka MirrorMaker in <code>spec.image</code> and <code>spec.version</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
It is recommended to provide only the <code>version</code> and leave the <code>image</code> property unspecified.
This reduces the chance of making a mistake when configuring the custom resource.
If you need to change the images used for different versions of Kafka, it is preferable to configure the Cluster Operator&#8217;s environment variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring the <code>image</code> property in other resources</strong></p>
</div>
<div class="paragraph">
<p>For the <code>image</code> property in the other custom resources, the given value will be used during deployment.
If the <code>image</code> property is missing, the <code>image</code> specified in the Cluster Operator configuration will be used.
If the <code>image</code> name is not defined in the Cluster Operator configuration, then the default value will be used.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Topic Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:0.20.1</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For User Operator:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_USER_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:0.20.1</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Entity Operator TLS sidecar:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:0.20.1-kafka-2.6.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Exporter:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_EXPORTER_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka:0.20.1-kafka-2.6.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka Bridge:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_BRIDGE_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/kafka-bridge:0.19.0</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka broker initializer:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_KAFKA_INIT_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:0.20.1</code> container image.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For Kafka broker initializer:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container image specified in the <code>STRIMZI_DEFAULT_JMXTRANS_IMAGE</code> environment variable from the Cluster Operator configuration.</p>
</li>
<li>
<p><code>strimzi/operator:0.20.1</code> container image.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example of container image configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    image: my-org/my-image:latest
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-healthchecks-reference"><a class="link" href="#con-common-configuration-healthchecks-reference">B.1.7. <code>livenessProbe</code> and <code>readinessProbe</code> healthchecks</a></h4>
<div class="paragraph">
<p>Use the <code>livenessProbe</code> and <code>readinessProbe</code> properties to configure healthcheck probes supported in Strimzi.</p>
</div>
<div class="paragraph">
<p>Healthchecks are periodical tests which verify the health of an application.
When a Healthcheck probe fails, Kubernetes assumes that the application is not healthy and attempts to fix it.</p>
</div>
<div class="paragraph">
<p>For more details about the probes, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/" target="_blank" rel="noopener">Configure Liveness and Readiness Probes</a>.</p>
</div>
<div class="paragraph">
<p>Both <code>livenessProbe</code> and <code>readinessProbe</code> support the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialDelaySeconds</code></p>
</li>
<li>
<p><code>timeoutSeconds</code></p>
</li>
<li>
<p><code>periodSeconds</code></p>
</li>
<li>
<p><code>successThreshold</code></p>
</li>
<li>
<p><code>failureThreshold</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example of liveness and readiness probe configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
readinessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
livenessProbe:
  initialDelaySeconds: 15
  timeoutSeconds: 5
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the <code>livenessProbe</code> and <code>readinessProbe</code> options, see <a href="#type-Probe-reference">Probe schema reference</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-prometheus-reference"><a class="link" href="#con-common-configuration-prometheus-reference">B.1.8. <code>metrics</code></a></h4>
<div class="paragraph">
<p>Use the <code>metrics</code> property to enable and configure Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>The <code>metrics</code> property can also contain additional configuration for the <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">Prometheus JMX exporter</a>.
Strimzi supports Prometheus metrics using Prometheus JMX exporter to convert the JMX metrics supported by Apache Kafka and ZooKeeper to Prometheus metrics.</p>
</div>
<div class="paragraph">
<p>To enable Prometheus metrics export without any further configuration, you can set it to an empty object (<code>{}</code>).</p>
</div>
<div class="paragraph">
<p>When metrics are enabled, they are exposed on port 9404.</p>
</div>
<div class="paragraph">
<p>When the <code>metrics</code> property is not defined in the resource, the Prometheus metrics are disabled.</p>
</div>
<div class="paragraph">
<p>For more information about setting up and deploying Prometheus and Grafana, see <a href="./deploying.html#assembly-metrics-setup-str">Introducing Metrics to Kafka</a> in the <em>Deploying Strimzi</em> guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-jvm-reference"><a class="link" href="#con-common-configuration-jvm-reference">B.1.9. <code>jvmOptions</code></a></h4>
<div class="paragraph">
<p>JVM options can be configured using the <code>jvmOptions</code> property in following resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Kafka.spec.kafka</code></p>
</li>
<li>
<p><code>Kafka.spec.zookeeper</code></p>
</li>
<li>
<p><code>KafkaConnect.spec</code></p>
</li>
<li>
<p><code>KafkaConnectS2I.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker.spec</code></p>
</li>
<li>
<p><code>KafkaMirrorMaker2.spec</code></p>
</li>
<li>
<p><code>KafkaBridge.spec</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the following JVM options are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-Xms</code></dt>
<dd>
<p>Configures the minimum initial allocation heap size when the JVM starts.</p>
</dd>
<dt class="hdlist1"><code>-Xmx</code></dt>
<dd>
<p>Configures the maximum heap size.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The units accepted by JVM settings such as <code>-Xmx</code> and <code>-Xms</code> are those accepted by the JDK <code>java</code> binary in the corresponding image.
Accordingly, <code>1g</code> or <code>1G</code> means 1,073,741,824 bytes, and <code>Gi</code> is not a valid unit suffix.
This is in contrast to the units used for <a href="#con-common-configuration-resources-reference">memory requests and limits</a>, which follow the Kubernetes convention where <code>1G</code> means 1,000,000,000 bytes, and <code>1Gi</code> means 1,073,741,824 bytes
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default values used for <code>-Xms</code> and <code>-Xmx</code> depends on whether there is a <a href="#con-common-configuration-resources-reference">memory request</a> limit configured for the container.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there is a memory limit, the JVM&#8217;s minimum and maximum memory is set to a value corresponding to the limit.</p>
</li>
<li>
<p>If there is no memory limit, the JVM&#8217;s minimum memory is set to <code>128M</code>. The JVM&#8217;s maximum memory is not defined to allow the memory to grow as needed, which is ideal for single node environments in test and development.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Setting <code>-Xmx</code> explicitly requires some care:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The JVM&#8217;s overall memory usage will be approximately 4  the maximum heap, as configured by <code>-Xmx</code>.</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory limit, it is possible that the container will be killed should the Kubernetes node experience memory pressure (from other Pods running on it).</p>
</li>
<li>
<p>If <code>-Xmx</code> is set without also setting an appropriate Kubernetes memory request, it is possible that the container will be scheduled to a node with insufficient memory.
In this case, the container will not start but crash (immediately if <code>-Xms</code> is set to <code>-Xmx</code>, or some later time if not).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When setting <code>-Xmx</code> explicitly, it is recommended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the memory request and the memory limit to the same value</p>
</li>
<li>
<p>Use a memory request that is at least 4.5  the <code>-Xmx</code></p>
</li>
<li>
<p>Consider setting <code>-Xms</code> to the same value as <code>-Xmx</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Containers doing lots of disk I/O (such as Kafka broker containers) will need to leave some memory available for use as an operating system page cache.
On such containers, the requested memory should be significantly higher than the memory used by the JVM.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-Xmx</code> and <code>-Xms</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-Xmx": "2g"
  "-Xms": "2g"
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the JVM will use 2 GiB (=2,147,483,648 bytes) for its heap.
Its total memory usage will be approximately 8GiB.</p>
</div>
<div class="paragraph">
<p>Setting the same value for initial (<code>-Xms</code>) and maximum (<code>-Xmx</code>) heap sizes avoids the JVM having to allocate memory after startup, at the cost of possibly allocating more heap than is really needed.
For Kafka and ZooKeeper pods such allocation could cause unwanted latency.
For Kafka Connect avoiding over allocation may be the most important concern, especially in distributed mode where the effects of over-allocation is multiplied by the number of consumers.</p>
</div>
<div class="paragraph">
<p><strong>-server</strong></p>
</div>
<div class="paragraph">
<p><code>-server</code> enables the server JVM. This option can be set to true or false.</p>
</div>
<div class="listingblock">
<div class="title">Example fragment configuring <code>-server</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  "-server": true
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) are specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> is used.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>-XX</strong></p>
</div>
<div class="paragraph">
<p><code>-XX</code> object can be used for configuring advanced runtime options of a JVM.
The <code>-server</code> and <code>-XX</code> options are used to configure the <code>KAFKA_JVM_PERFORMANCE_OPTS</code> option of Apache Kafka.</p>
</div>
<div class="listingblock">
<div class="title">Example showing the use of the <code>-XX</code> object</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">jvmOptions:
  "-XX":
    "UseG1GC": true
    "MaxGCPauseMillis": 20
    "InitiatingHeapOccupancyPercent": 35
    "ExplicitGCInvokesConcurrent": true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example configuration above will result in the following JVM options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -XX:-UseParNewGC</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When neither of the two options (<code>-server</code> and <code>-XX</code>) are specified, the default Apache Kafka configuration of <code>KAFKA_JVM_PERFORMANCE_OPTS</code> is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-common-configuration-garbage-collection-reference"><a class="link" href="#con-common-configuration-garbage-collection-reference">B.1.10. Garbage collector logging</a></h4>
<div class="paragraph">
<p>The <code>jvmOptions</code> property also allows you to enable and disable garbage collector (GC) logging.
GC logging is disabled by default.
To enable it, set the <code>gcLoggingEnabled</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example of enabling GC logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
jvmOptions:
  gcLoggingEnabled: true
# ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="type-Kafka-reference"><a class="link" href="#type-Kafka-reference">B.2. <code>Kafka</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka and ZooKeeper clusters, and Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka and ZooKeeper clusters, and Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaSpec-reference"><a class="link" href="#type-KafkaSpec-reference">B.3. <code>KafkaSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafka</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeper</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the ZooKeeper cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>topicOperator</code> has been deprecated. This feature should now be configured at path <code>spec.entityOperator.topicOperator</code>.</strong> Configuration of the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entityOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Entity Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusterCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the cluster certificate authority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientsCa</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the clients certificate authority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertificateAuthority-reference"><code>CertificateAuthority</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cruiseControl</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration for Cruise Control deployment. Deploys a Cruise Control instance when specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxTrans</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration for JmxTrans. When the property is present a JmxTrans deployment is created for gathering JMX metrics from each Kafka broker. For more information see <a href="https://github.com/jmxtrans/jmxtrans">JmxTrans GitHub</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaExporter</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Kafka Exporter. Kafka Exporter can provide additional metrics, for example lag of consumer group at topic/partition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maintenanceTimeWindows</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of time windows for maintenance tasks (that is, certificates renewal). Each time window is defined by a cron expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClusterSpec-reference"><a class="link" href="#type-KafkaClusterSpec-reference">B.4. <code>KafkaClusterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka cluster.</p>
</div>
<div class="sect3">
<h4 id="property-kafka-listeners-reference"><a class="link" href="#property-kafka-listeners-reference">B.4.1. <code>listeners</code></a></h4>
<div class="paragraph">
<p>Use the <code>listeners</code> property to configure listeners to provide access to Kafka brokers.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration of a plain (unencrypted) listener without authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
spec:
  kafka:
    # ...
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
    # ...
  zookeeper:
    # ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-kafka-config-reference"><a class="link" href="#property-kafka-config-reference">B.4.2. <code>config</code></a></h4>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka brokers as keys with values in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure all of the options in the "Broker Configs" section of the <a href="http://kafka.apache.org/documentation/#brokerconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> apart from those managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>advertised.</code></p>
</li>
<li>
<p><code>broker.</code></p>
</li>
<li>
<p><code>listener.</code></p>
</li>
<li>
<p><code>host.name</code></p>
</li>
<li>
<p><code>port</code></p>
</li>
<li>
<p><code>inter.broker.listener.name</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>password.</code></p>
</li>
<li>
<p><code>principal.builder.class</code></p>
</li>
<li>
<p><code>log.dir</code></p>
</li>
<li>
<p><code>zookeeper.connect</code></p>
</li>
<li>
<p><code>zookeeper.set.acl</code></p>
</li>
<li>
<p><code>authorizer.</code></p>
</li>
<li>
<p><code>super.user</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other supported options are passed to Kafka.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also configure the <code>zookeeper.connection.timeout.ms</code> property to set the maximum time allowed for establishing a ZooKeeper connection.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka broker configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    # ...
    config:
      num.partitions: 1
      num.recovery.threads.per.data.dir: 1
      default.replication.factor: 3
      offsets.topic.replication.factor: 3
      transaction.state.log.replication.factor: 3
      transaction.state.log.min.isr: 1
      log.retention.hours: 168
      log.segment.bytes: 1073741824
      log.retention.check.interval.ms: 300000
      num.network.threads: 3
      num.io.threads: 8
      socket.send.buffer.bytes: 102400
      socket.receive.buffer.bytes: 102400
      socket.request.max.bytes: 104857600
      group.initial.rebalance.delay.ms: 0
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      zookeeper.connection.timeout.ms: 6000
    # ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods. The default value depends on the configured <code>Kafka.spec.kafka.version</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim, jbod].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>, <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures listeners of Kafka brokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a> array or <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization configuration for Kafka brokers. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple, opa, keycloak].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka broker config properties with the following prefixes cannot be set: listeners, advertised., broker., listener., host.name, port, inter.broker.listener.name, sasl., ssl., security., password., principal.builder.class, log.dir, zookeeper.connect, zookeeper.set.acl, zookeeper.ssl, zookeeper.clientCnxnSocket, authorizer., super.user, cruise.control.metrics.topic, cruise.control.metrics.reporter.bootstrap.servers (with the exception of: zookeeper.connection.timeout.ms, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols,cruise.control.metrics.topic.num.partitions, cruise.control.metrics.topic.replication.factor, cruise.control.metrics.topic.retention.ms,cruise.control.metrics.topic.auto.create.retries, cruise.control.metrics.topic.auto.create.timeout.ms).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the <code>broker.rack</code> broker config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image of the init container used for initializing the <code>broker.rack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.kafka.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.kafka.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jmxOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JMX Options for Kafka brokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tlsSidecar</code> has been deprecated.</strong> TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka cluster resources. The template allows users to specify how are the <code>StatefulSet</code>, <code>Pods</code> and <code>Services</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The kafka broker version. Defaults to 2.6.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-EphemeralStorage-reference"><a class="link" href="#type-EphemeralStorage-reference">B.5. <code>EphemeralStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>EphemeralStorage</code> from <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>ephemeral</code> for the type <code>EphemeralStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeLimit</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When type=ephemeral, defines the total amount of local storage required for this EmptyDir volume (for example 1Gi).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>ephemeral</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PersistentClaimStorage-reference"><a class="link" href="#type-PersistentClaimStorage-reference">B.6. <code>PersistentClaimStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JbodStorage-reference"><code>JbodStorage</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>PersistentClaimStorage</code> from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>.
It must have the value <code>persistent-claim</code> for the type <code>PersistentClaimStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>persistent-claim</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When type=persistent-claim, defines the size of the persistent volume claim (i.e 1Gi). Mandatory when type=persistent-claim.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">selector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies a specific persistent volume to use. It contains key:value pairs representing labels for selecting such a volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies if the persistent volume claim has to be deleted when the cluster is un-deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The storage class to use for dynamic volume allocation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage identification number. It is mandatory only for storage volumes defined in a storage of type 'jbod'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for individual brokers. The <code>overrides</code> field allows to specify a different configuration for different brokers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PersistentClaimStorageOverride-reference"><code>PersistentClaimStorageOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PersistentClaimStorageOverride-reference"><a class="link" href="#type-PersistentClaimStorageOverride-reference">B.7. <code>PersistentClaimStorageOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The storage class to use for dynamic volume allocation for this broker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JbodStorage-reference"><a class="link" href="#type-JbodStorage-reference">B.8. <code>JbodStorage</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>JbodStorage</code> from <a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a>.
It must have the value <code>jbod</code> for the type <code>JbodStorage</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>jbod</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of volumes as Storage objects representing the JBOD disks array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-GenericKafkaListener-reference"><a class="link" href="#type-GenericKafkaListener-reference">B.9. <code>GenericKafkaListener</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures listeners to connect to Kafka brokers within and outside Kubernetes.</p>
</div>
<div class="paragraph">
<p>You configure the listeners in the <code>Kafka</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Kafka</code> resource showing listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    #...
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
      - name: external1
        port: 9094
        type: route
        tls: true
      - name: external2
        port: 9095
        type: ingress
        tls: false
        authentication:
          type: tls
        configuration:
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
    #...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="property-generic-listeners-reference"><a class="link" href="#property-generic-listeners-reference">B.9.1. <code>listeners</code></a></h4>
<div class="paragraph">
<p>You configure Kafka broker listeners using the <code>listeners</code> property in the <code>Kafka</code> resource.
Listeners are defined as an array.</p>
</div>
<div class="listingblock">
<div class="title">Example listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  - name: plain
    port: 9092
    type: internal
    tls: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name and port must be unique within the Kafka cluster.
The name can be up to 25 characters long, comprising lower-case letters and numbers.
Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX.</p>
</div>
<div class="paragraph">
<p>By specifying a unique name and port for each listener,
you can configure multiple listeners.</p>
</div>
</div>
<div class="sect3">
<h4 id="type"><a class="link" href="#type">B.9.2. <code>type</code></a></h4>
<div class="paragraph">
<p>The type is set as <code>internal</code>,
or for external listeners, as <code>route</code>, <code>loadbalancer</code>, <code>nodeport</code> or <code>ingress</code>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">internal</dt>
<dd>
<p>You can configure internal listeners with or without encryption using the <code>tls</code> property.</p>
<div class="listingblock">
<div class="title">Example <code>internal</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">route</dt>
<dd>
<p>Configures an external listener to expose Kafka using OpenShift <code>Routes</code> and the HAProxy router.</p>
<div class="paragraph">
<p>A dedicated <code>Route</code> is created for every Kafka broker pod.
An additional <code>Route</code> is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Routes</code> to connect to Kafka on port 443.
The client connects on port 443, the default router port, but traffic is then routed to the port you configure,
which is <code>9094</code> in this example.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>route</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external1
        port: 9094
        type: route
        tls: true
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">ingress</dt>
<dd>
<p>Configures an external listener to expose Kafka using Kubernetes <code>Ingress</code> and the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.</p>
<div class="paragraph">
<p>A dedicated <code>Ingress</code> resource is created for every Kafka broker pod.
An additional <code>Ingress</code> resource is created to serve as a Kafka bootstrap address.
Kafka clients can use these <code>Ingress</code> resources to connect to Kafka on port 443.
The client connects on port 443, the default controller port, but traffic is then routed to the port you configure,
which is <code>9095</code> in the following example.</p>
</div>
<div class="paragraph">
<p>You must specify the hostnames used by the bootstrap and per-broker services
using <a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code></a>
and <a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code></a> properties.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>ingress</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external2
        port: 9095
        type: ingress
        tls: false
        authentication:
          type: tls
        configuration:
          bootstrap:
            host: bootstrap.myingress.com
          brokers:
          - broker: 0
            host: broker-0.myingress.com
          - broker: 1
            host: broker-1.myingress.com
          - broker: 2
            host: broker-2.myingress.com
  #...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
External listeners using <code>Ingress</code> are currently only tested with the <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1">loadbalancer</dt>
<dd>
<p>Configures an external listener to expose Kafka <code>Loadbalancer</code> type <code>Services</code>.</p>
<div class="paragraph">
<p>A new loadbalancer service is created for every Kafka broker pod.
An additional loadbalancer is created to serve as a Kafka <em>bootstrap</em> address.
Loadbalancers listen to the specified port number, which is port <code>9094</code> in the following example.</p>
</div>
<div class="paragraph">
<p>You can use the <code>loadBalancerSourceRanges</code> property to configure <a href="#property-listener-config-source-ranges-reference">source ranges</a> to restrict access to the specified IP addresses.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>loadbalancer</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
spec:
  kafka:
    #...
    listeners:
      - name: external3
        port: 9094
        type: loadbalancer
        tls: true
        configuration:
          loadBalancerSourceRanges:
            - 10.0.0.0/8
            - 88.208.76.87/32
    #...</code></pre>
</div>
</div>
</dd>
<dt class="hdlist1">nodeport</dt>
<dd>
<p>Configures an external listener to expose Kafka using <code>NodePort</code> type <code>Services</code>.</p>
<div class="paragraph">
<p>Kafka clients connect directly to the nodes of Kubernetes.
An additional <code>NodePort</code> type of service is created to serve as a Kafka bootstrap address.</p>
</div>
<div class="paragraph">
<p>When configuring the advertised addresses for the Kafka broker pods, Strimzi uses the address of the node on which the given pod is running.
You can use <code>preferredNodePortAddressType</code> property to configure the <a href="#property-listener-config-preferredNodePortAddressType-reference">first address type checked as the node address</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>nodeport</code> listener configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">#...
spec:
  kafka:
    #...
    listeners:
      #...
      - name: external4
        port: 9095
        type: nodeport
        tls: false
        configuration:
          preferredNodePortAddressType: InternalDNS
    #...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS hostname verification is not currently supported when exposing Kafka clusters using node ports.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-port-reference"><a class="link" href="#property-listener-port-reference">B.9.3. <code>port</code></a></h4>
<div class="paragraph">
<p>The port number is the port used in the Kafka cluster, which might not be the same port used for access by a client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>loadbalancer</code> listeners use the specified port number, as do <code>internal</code> listeners</p>
</li>
<li>
<p><code>ingress</code> and <code>route</code> listeners use port 443 for access</p>
</li>
<li>
<p><code>nodeport</code> listeners use the port number assigned by Kubernetes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection, use the address and port for the bootstrap service of the listener.
You can retrieve this from the status of the <code>Kafka</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">Example command to retrieve the address and port for client connection</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl get kafka <em>KAFKA-CLUSTER-NAME</em> -o=jsonpath='{.status.listeners[?(@.type=="external")].bootstrapServers}{"\n"}'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Listeners cannot be configured to use the ports set aside for interbroker communication (9091) and metrics (9404).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-tls-reference"><a class="link" href="#property-listener-tls-reference">B.9.4. <code>tls</code></a></h4>
<div class="paragraph">
<p>The TLS property is required.</p>
</div>
<div class="paragraph">
<p>By default, TLS encryption is not enabled.
To enable it, set the <code>tls</code> property to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>TLS encryption is always used with <code>route</code> listeners.</p>
</div>
</div>
<div class="sect3">
<h4 id="authentication"><a class="link" href="#authentication">B.9.5. <code>authentication</code></a></h4>
<div class="paragraph">
<p>Authentication for the listener can be specified as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mutual TLS (<code>tls</code>)</p>
</li>
<li>
<p>SCRAM-SHA-512 (<code>scram-sha-512</code>)</p>
</li>
<li>
<p>Token-based OAuth 2.0 (<code>oauth</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuration-listener-network-policy-reference"><a class="link" href="#configuration-listener-network-policy-reference">B.9.6. <code>networkPolicyPeers</code></a></h4>
<div class="paragraph">
<p>Use <code>networkPolicyPeers</code> to configure network policies that restrict access to a listener at the network level.
The following example shows a <code>networkPolicyPeers</code> configuration for a <code>plain</code> and a <code>tls</code> listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: plain
    port: 9092
    type: internal
    tls: true
    authentication:
      type: scram-sha-512
    networkPolicyPeers:
      - podSelector:
          matchLabels:
            app: kafka-sasl-consumer
      - podSelector:
          matchLabels:
            app: kafka-sasl-producer
  - name: tls
    port: 9093
    type: internal
    tls: true
    authentication:
      type: tls
    networkPolicyPeers:
      - namespaceSelector:
          matchLabels:
            project: myproject
      - namespaceSelector:
          matchLabels:
            project: myproject2
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only application pods matching the labels <code>app: kafka-sasl-consumer</code> and <code>app: kafka-sasl-producer</code> can connect to the <code>plain</code> listener.
The application pods must be running in the same namespace as the Kafka broker.</p>
</li>
<li>
<p>Only application pods running in namespaces matching the labels <code>project: myproject</code> and <code>project: myproject2</code> can connect to the <code>tls</code> listener.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The syntax of the <code>networkPolicyPeers</code> field is the same as the <code>from</code> field in <code>NetworkPolicy</code> resources.</p>
</div>
<div id="property-listener-bwc-reference" class="paragraph">
<div class="title">Backwards compatibility with <code>KafkaListeners</code></div>
<p><code>GenericKafkaListener</code> replaces the <code>KafkaListeners</code> schema, which is now deprecated.</p>
</div>
<div class="paragraph">
<p>To convert the listeners configured using the <code>KafkaListeners</code> schema into the format of the <code>GenericKafkaListener</code> schema, with backwards compatibility,
use the following names, ports and types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">listeners:
  #...
  - name: plain
    port: 9092
    type: internal
    tls: false
  - name: tls
    port: 9093
    type: internal
    tls: true
  - name: external
    port: 9094
    type: <em>EXTERNAL-LISTENER-TYPE</em> <b class="conum">(1)</b>
    tls: true
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Options: <code>ingress</code>, <code>loadbalancer</code>, <code>nodeport</code>, <code>route</code></p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the listener. The name will be used to identify the listener and the related Kubernetes objects. The name has to be unique within given a Kafka cluster. The name can consist of lowercase characters and numbers and be up to 11 characters long.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Port number used by the listener inside Kafka. The port number has to be unique within a given Kafka cluster. Allowed port numbers are 9092 and higher with the exception of ports 9404 and 9999, which are already used for Prometheus and JMX. Depending on the listener type, the port number might not be the same as the port number that connects Kafka clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Type of the listener. Currently the supported types are <code>internal</code>, <code>route</code>, <code>loadbalancer</code>, <code>nodeport</code> and <code>ingress</code>.</p>
<p class="tableblock">* <code>internal</code> type exposes Kafka internally only within the Kubernetes cluster.
* <code>route</code> type uses OpenShift Routes to expose Kafka.
* <code>loadbalancer</code> type uses LoadBalancer type services to expose Kafka.
* <code>nodeport</code> type uses NodePort type services to expose Kafka.
* <code>ingress</code> type uses Kubernetes Nginx Ingress to expose Kafka.
.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [ingress, internal, route, loadbalancer, nodeport])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enables TLS encryption on the listener. This is a required property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for this listener. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional listener configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationTls-reference"><a class="link" href="#type-KafkaListenerAuthenticationTls-reference">B.10. <code>KafkaListenerAuthenticationTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationTls</code> from <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaListenerAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaListenerAuthenticationScramSha512-reference">B.11. <code>KafkaListenerAuthenticationScramSha512</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationScramSha512</code> from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaListenerAuthenticationScramSha512</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerAuthenticationOAuth-reference"><a class="link" href="#type-KafkaListenerAuthenticationOAuth-reference">B.12. <code>KafkaListenerAuthenticationOAuth</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a>, <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerAuthenticationOAuth</code> from <a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaListenerAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessTokenIsJwt</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configure whether the access token is treated as JWT. This must be set to <code>false</code> if the authorization server returns opaque tokens. Defaults to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkAccessTokenType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configure whether the access token type check is performed or not. This should be set to <code>false</code> if the authorization server does not include 'typ' claim in JWT token. Defaults to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkIssuer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable issuer checking. By default issuer is checked using the value configured by <code>validIssuerUri</code>. Default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth Client ID which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the OAuth client secret which the Kafka broker can use to authenticate against the authorization server and use the introspect endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable TLS hostname verification. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableECDSA</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable ECDSA support by installing BouncyCastle crypto provider. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallbackUserNameClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The fallback username claim to be used for the user id if the claim specified by <code>userNameClaim</code> is not present. This is useful when <code>client_credentials</code> authentication only results in the client id being provided in another claim. It only takes effect if <code>userNameClaim</code> is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fallbackUserNamePrefix</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The prefix to use with the value of <code>fallbackUserNameClaim</code> to construct the user id. This only takes effect if <code>fallbackUserNameClaim</code> is true, and the value is present for the claim. Mapping usernames and client ids into the same user id space is useful in preventing name collisions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">introspectionEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the token introspection endpoint which can be used to validate opaque non-JWT tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the JWKS certificate endpoint, which can be used for local JWT validation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksExpirySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures how often are the JWKS certificates considered valid. The expiry interval has to be at least 60 seconds longer then the refresh interval specified in <code>jwksRefreshSeconds</code>. Defaults to 360 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksMinRefreshPauseSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The minimum pause between two consecutive refreshes. When an unknown signing key is encountered the refresh is scheduled immediately, but will always wait for this minimum pause. Defaults to 1 second.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jwksRefreshSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures how often are the JWKS certificates refreshed. The refresh interval has to be at least 60 seconds shorter then the expiry interval specified in <code>jwksExpirySeconds</code>. Defaults to 300 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxSecondsWithoutReauthentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Maximum number of seconds the authenticated session remains valid without re-authentication. This enables Apache Kafka re-authentication feature, and causes sessions to expire when the access token expires. If the access token expires before max time or if max time is reached, the client has to re-authenticate, otherwise the server will drop the connection. Not set by default - the authenticated session does not expire when the access token expires.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection to the OAuth server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>oauth</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userInfoEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the User Info Endpoint to use as a fallback to obtaining the user id when the Introspection Endpoint does not return information that can be used for the user id.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userNameClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the claim from the JWT authentication token, Introspection Endpoint response or User Info Endpoint response which will be used to extract the user id. Defaults to <code>sub</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validIssuerUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">URI of the token issuer used for authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validTokenType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Valid value for the <code>token_type</code> attribute returned by the Introspection Endpoint. No default value, and not checked by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-GenericSecretSource-reference"><a class="link" href="#type-GenericSecretSource-reference">B.13. <code>GenericSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The key under which the secret value is stored in the Kubernetes Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Kubernetes Secret containing the secret value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CertSecretSource-reference"><a class="link" href="#type-CertSecretSource-reference">B.14. <code>CertSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>, <a href="#type-KafkaBridgeTls-reference"><code>KafkaBridgeTls</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>, <a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a>, <a href="#type-KafkaMirrorMaker2Tls-reference"><code>KafkaMirrorMaker2Tls</code></a>, <a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the file certificate in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-GenericKafkaListenerConfiguration-reference"><a class="link" href="#type-GenericKafkaListenerConfiguration-reference">B.15. <code>GenericKafkaListenerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a></p>
</div>
<div class="paragraph">
<p>Configuration for Kafka listeners.</p>
</div>
<div class="sect3">
<h4 id="property-listener-config-brokerCertChainAndKey-reference"><a class="link" href="#property-listener-config-brokerCertChainAndKey-reference">B.15.1. <code>brokerCertChainAndKey</code></a></h4>
<div class="paragraph">
<p>The <code>brokerCertChainAndKey</code> property is only used with listeners that have TLS encryption enabled.
You can use the property to providing your own Kafka listener certificates.</p>
</div>
<div class="listingblock">
<div class="title">Example configuration for a <code>loadbalancer</code> external listener with TLS encryption enabled</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      brokerCertChainAndKey:
        secretName: my-secret
        certificate: my-listener-certificate.crt
        key: my-listener-key.key
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-traffic-policy-reference"><a class="link" href="#property-listener-config-traffic-policy-reference">B.15.2. <code>externalTrafficPolicy</code></a></h4>
<div class="paragraph">
<p>The <code>externalTrafficPolicy</code> property is used with <code>loadbalancer</code> and <code>nodeport</code> listeners.
When exposing Kafka outside of Kubernetes you can choose <code>Local</code> or <code>Cluster</code>.
<code>Local</code> avoids hops to other nodes and preserves the client IP, whereas <code>Cluster</code> does neither.
The default is <code>Cluster</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-source-ranges-reference"><a class="link" href="#property-listener-config-source-ranges-reference">B.15.3. <code>loadBalancerSourceRanges</code></a></h4>
<div class="paragraph">
<p>The <code>loadBalancerSourceRanges</code> property is only used with <code>loadbalancer</code> listeners.
When exposing Kafka outside of Kubernetes use source ranges, in addition to labels and annotations, to customize how a service is created.</p>
</div>
<div class="listingblock">
<div class="title">Example source ranges configured for a loadbalancer listener</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: false
    configuration:
      externalTrafficPolicy: Local
      loadBalancerSourceRanges:
        - 10.0.0.0/8
        - 88.208.76.87/32
      # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-class-reference"><a class="link" href="#property-listener-config-class-reference">B.15.4. <code>class</code></a></h4>
<div class="paragraph">
<p>The <code>class</code> property is only used with <code>ingress</code> listeners.</p>
</div>
<div class="paragraph">
<p>By default, the <code>Ingress</code> class is set to <code>nginx</code>.
You can change the <code>Ingress</code> class using the <code>class</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>ingress</code> using <code>Ingress</code> class <code>nginx-internal</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: ingress
    tls: false
    configuration:
      class: nginx-internal
    # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-preferredNodePortAddressType-reference"><a class="link" href="#property-listener-config-preferredNodePortAddressType-reference">B.15.5. <code>preferredNodePortAddressType</code></a></h4>
<div class="paragraph">
<p>The <code>preferredNodePortAddressType</code> property is only used with <code>nodeport</code> listeners.</p>
</div>
<div class="paragraph">
<p>Use the <code>preferredNodePortAddressType</code> property in your listener configuration to specify the first address type checked as the node address.
This property is useful, for example, if your deployment does not have DNS support, or you only want to expose a broker internally through an internal DNS or IP address.
If an address of this type is found, it is used.
If the preferred address type is not found, Strimzi proceeds through the types in the standard order of priority:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ExternalDNS</p>
</li>
<li>
<p>ExternalIP</p>
</li>
<li>
<p>Hostname</p>
</li>
<li>
<p>InternalDNS</p>
</li>
<li>
<p>InternalIP</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with a preferred node port address type</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: nodeport
    tls: false
    configuration:
      preferredNodePortAddressType: InternalDNS
      # ...
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-dns-reference"><a class="link" href="#property-listener-config-dns-reference">B.15.6. <code>useServiceDnsDomain</code></a></h4>
<div class="paragraph">
<p>The <code>useServiceDnsDomain</code> property is only used with <code>internal</code> listeners.
It defines whether the fully-qualified DNS names that include the cluster service suffix (usually <code>.cluster.local</code>) are used.
With <code>useServiceDnsDomain</code> set as <code>false</code>, the advertised addresses are generated without the service suffix; for example, <code>my-cluster-kafka-0.my-cluster-kafka-brokers.myproject.svc</code>.
With <code>useServiceDnsDomain</code> set as <code>true</code>, the advertised addresses are generated with the service suffix; for example, <code>my-cluster-kafka-0.my-cluster-kafka-brokers.myproject.svc.cluster.local</code>.
Default is <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example of an internal listener configured to use the Service DNS domain</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: plain
    port: 9092
    type: internal
    tls: false
    configuration:
      useServiceDnsDomain: true
      # ...
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your Kubernetes cluster uses a different service suffix than <code>.cluster.local</code>, you can configure the suffix using the <code>KUBERNETES_SERVICE_DNS_DOMAIN</code> environment variable in the Cluster Operator configuration.
See <a href="#ref-operator-cluster-str">Cluster Operator configuration</a> for more details.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair which will be used for this listener. The certificate can optionally contain the whole chain. This field can be used only with listeners with enabled TLS encryption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalTrafficPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies whether the service routes external traffic to node-local or cluster-wide endpoints. <code>Cluster</code> may cause a second hop to another node and obscures the client source IP. <code>Local</code> avoids a second hop for LoadBalancer and Nodeport type services and preserves the client source IP (when supported by the infrastructure). If unspecified, Kubernetes will use <code>Cluster</code> as the default.This field can be used only with <code>loadbalancer</code> or <code>nodeport</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Local, Cluster])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerSourceRanges</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of CIDR ranges (for example <code>10.0.0.0/8</code> or <code>130.211.204.1/32</code>) from which clients can connect to load balancer type listeners. If supported by the platform, traffic through the loadbalancer is restricted to the specified CIDR ranges. This field is applicable only for loadbalancer type services and is ignored if the cloud provider does not support the feature. For more information, see <a href="https://v1-17.docs.kubernetes.io/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/" class="bare">https://v1-17.docs.kubernetes.io/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/</a>. This field can be used only with <code>loadbalancer</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Bootstrap configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Per-broker configurations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures the <code>Ingress</code> class that defines which <code>Ingress</code> controller will be used. If not set, the <code>Ingress</code> class is set to <code>nginx</code>. This field can be used only with <code>ingress</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferredNodePortAddressType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Defines which address type should be used as the node address. Available types are: <code>ExternalDNS</code>, <code>ExternalIP</code>, <code>InternalDNS</code>, <code>InternalIP</code> and <code>Hostname</code>. By default, the addresses will be used in the following order (the first one found will be used):
* <code>ExternalDNS</code>
* <code>ExternalIP</code>
* <code>InternalDNS</code>
* <code>InternalIP</code>
* <code>Hostname</code></p>
<p class="tableblock">This field can be used to select the address type which will be used as the preferred type and checked first. In case no address will be found for this address type, the other types will be used in the default order.This field can be used only with <code>nodeport</code> type listener..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [ExternalDNS, ExternalIP, Hostname, InternalIP, InternalDNS])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useServiceDnsDomain</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures whether the Kubernetes service DNS domain should be used or not. If set to <code>true</code>, the generated addresses with contain the service DNS domain suffix (by default <code>.cluster.local</code>, can be configured using environment variable <code>KUBERNETES_SERVICE_DNS_DOMAIN</code>). Defaults to <code>false</code>.This field can be used only with <code>internal</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-CertAndKeySecretSource-reference"><a class="link" href="#type-CertAndKeySecretSource-reference">B.16. <code>CertAndKeySecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a>, <a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a>, <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaListenerExternalConfiguration-reference"><code>KafkaListenerExternalConfiguration</code></a>, <a href="#type-NodePortListenerConfiguration-reference"><code>NodePortListenerConfiguration</code></a>, <a href="#type-TlsListenerConfiguration-reference"><code>TlsListenerConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the file certificate in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">key</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the private key in the Secret.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-GenericKafkaListenerConfigurationBootstrap-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBootstrap-reference">B.17. <code>GenericKafkaListenerConfigurationBootstrap</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p>
</div>
<div class="paragraph">
<p>Configures bootstrap service overrides for external listeners.</p>
</div>
<div class="paragraph">
<p>Broker service equivalents of <code>nodePort</code>, <code>host</code>, <code>loadBalancerIP</code> and <code>annotations</code> properties are configured in the <a href="#type-GenericKafkaListenerConfigurationBroker-reference"><code>GenericKafkaListenerConfigurationBroker</code> schema</a>.</p>
</div>
<div class="sect3">
<h4 id="property-listener-config-altnames-reference"><a class="link" href="#property-listener-config-altnames-reference">B.17.1. <code>alternativeNames</code></a></h4>
<div class="paragraph">
<p>You can specify alternative names for the bootstrap service.
The names are added to the broker certificates and can be used for TLS hostname verification.
The <code>alternativeNames</code> property is applicable to all types of external listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external <code>route</code> listener configured with an additional bootstrap address</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        alternativeNames:
          - example.hostname1
          - example.hostname2
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-host-reference"><a class="link" href="#property-listener-config-host-reference">B.17.2. <code>host</code></a></h4>
<div class="paragraph">
<p>The <code>host</code> property is used with <code>route</code> and <code>ingress</code> listeners to specify the hostnames used by the bootstrap and per-broker services.</p>
</div>
<div class="paragraph">
<p>A <code>host</code> property value is mandatory for <code>ingress</code> listener configuration, as the Ingress controller does not assign any hostnames automatically.
Make sure that the hostnames resolve to the Ingress endpoints.
Strimzi will not perform any validation that the requested hosts are available and properly routed to the Ingress endpoints.</p>
</div>
<div class="listingblock">
<div class="title">Example of host configuration for an ingress listener</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: ingress
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        host: bootstrap.myingress.com
      brokers:
      - broker: 0
        host: broker-0.myingress.com
      - broker: 1
        host: broker-1.myingress.com
      - broker: 2
        host: broker-2.myingress.com
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>route</code> listener hosts are automatically assigned by OpenShift.
However, you can override the assigned route hosts by specifying hosts.</p>
</div>
<div class="paragraph">
<p>Strimzi does not perform any validation that the requested hosts are available.
You must ensure that they are free and can be used.</p>
</div>
<div class="listingblock">
<div class="title">Example of host configuration for a route listener</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        host: bootstrap.myrouter.com
      brokers:
      - broker: 0
        host: broker-0.myrouter.com
      - broker: 1
        host: broker-1.myrouter.com
      - broker: 2
        host: broker-2.myrouter.com
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-nodeport-reference"><a class="link" href="#property-listener-config-nodeport-reference">B.17.3. <code>nodePort</code></a></h4>
<div class="paragraph">
<p>By default, the port numbers used for the bootstrap and broker services are automatically assigned by Kubernetes.
You can override the assigned node ports for <code>nodeport</code> listeners by specifying the requested port numbers.</p>
</div>
<div class="paragraph">
<p>Strimzi does not perform any validation on the requested ports.
You must ensure that they are free and available for use.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener configured with overrides for node ports</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: nodeport
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        nodePort: 32100
      brokers:
      - broker: 0
        nodePort: 32000
      - broker: 1
        nodePort: 32001
      - broker: 2
        nodePort: 32002
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-lb-ip-reference"><a class="link" href="#property-listener-config-lb-ip-reference">B.17.4. <code>loadBalancerIP</code></a></h4>
<div class="paragraph">
<p>Use the <code>loadBalancerIP</code> property to request a specific IP address when creating a loadbalancer.
Use this property when you need to use a loadbalancer with a specific IP address.
The <code>loadBalancerIP</code> field is ignored if the cloud provider does not support the feature.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> with specific loadbalancer IP address requests</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        loadBalancerIP: 172.29.3.10
      brokers:
      - broker: 0
        loadBalancerIP: 172.29.3.1
      - broker: 1
        loadBalancerIP: 172.29.3.2
      - broker: 2
        loadBalancerIP: 172.29.3.3
# ...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-listener-config-annotations-reference"><a class="link" href="#property-listener-config-annotations-reference">B.17.5. <code>annotations</code></a></h4>
<div class="paragraph">
<p>Use the <code>annotations</code> property to add annotations to <code>loadbalancer</code>, <code>nodeport</code> or <code>ingress</code> listeners.
You can use these annotations to instrument DNS tooling such as <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener">External DNS</a>, which automatically assigns DNS names to the loadbalancer services.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external listener of type <code>loadbalancer</code> using <code>annotations</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
listeners:
  #...
  - name: external
    port: 9094
    type: loadbalancer
    tls: true
    authentication:
      type: tls
    configuration:
      bootstrap:
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-bootstrap.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      brokers:
      - broker: 0
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-0.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 1
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-1.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
      - broker: 2
        annotations:
          external-dns.alpha.kubernetes.io/hostname: kafka-broker-2.mydomain.com.
          external-dns.alpha.kubernetes.io/ttl: "60"
# ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alternativeNames</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional alternative names for the bootstrap service. The alternative names will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The bootstrap host. This field will be used in the Ingress resource or in the Route resource to specify the desired hostname. This field can be used only with <code>route</code> (optional) or <code>ingress</code> (required) type listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the bootstrap service. This field can be used only with <code>nodeport</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.This field can be used only with <code>loadbalancer</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> or <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, or <code>ingress</code> type listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-GenericKafkaListenerConfigurationBroker-reference"><a class="link" href="#type-GenericKafkaListenerConfigurationBroker-reference">B.18. <code>GenericKafkaListenerConfigurationBroker</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-GenericKafkaListenerConfiguration-reference"><code>GenericKafkaListenerConfiguration</code></a></p>
</div>
<div class="paragraph">
<p>Configures broker service overrides for external listeners.</p>
</div>
<div class="paragraph">
<p>You can see example configuration for the <code>nodePort</code>, <code>host</code>, <code>loadBalancerIP</code> and <code>annotations</code> properties in the <a href="#type-GenericKafkaListenerConfigurationBootstrap-reference"><code>GenericKafkaListenerConfigurationBootstrap</code> schema</a>,
which configures bootstrap service overrides for external listeners.</p>
</div>
<div id="property-listener-config-broker-reference" class="paragraph">
<div class="title">Advertised addresses for brokers</div>
<p>By default, Strimzi tries to automatically determine the hostnames and ports that your Kafka cluster advertises to its clients.
This is not sufficient in all situations, because the infrastructure on which Strimzi is running might not provide the right hostname or port through which Kafka can be accessed.</p>
</div>
<div class="paragraph">
<p>You can specify a broker ID and customize the advertised hostname and port in the <code>configuration</code> property of the external listener.
Strimzi will then automatically configure the advertised address in the Kafka brokers and add it to the broker certificates so it can be used for TLS hostname verification.
Overriding the advertised host and ports is available for all types of external listeners.</p>
</div>
<div class="listingblock">
<div class="title">Example of an external <code>route</code> listener configured with overrides for advertised addresses</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">listeners:
  #...
  - name: external
    port: 9094
    type: route
    tls: true
    authentication:
      type: tls
    configuration:
      brokers:
      - broker: 0
        advertisedHost: example.hostname.0
        advertisedPort: 12340
      - broker: 1
        advertisedHost: example.hostname.1
        advertisedPort: 12341
      - broker: 2
        advertisedHost: example.hostname.2
        advertisedPort: 12342
# ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">ID of the kafka broker (broker identifier). Broker IDs start from 0 and correspond to the number of broker replicas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The broker host. This field will be used in the Ingress resource or in the Route resource to specify the desired hostname. This field can be used only with <code>route</code> (optional) or <code>ingress</code> (required) type listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the per-broker service. This field can be used only with <code>nodeport</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.This field can be used only with <code>loadbalancer</code> type listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> or <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS. This field can be used only with <code>loadbalancer</code>, <code>nodeport</code>, or <code>ingress</code> type listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListeners-reference"><a class="link" href="#type-KafkaListeners-reference">B.19. <code>KafkaListeners</code> schema reference</a></h3>
<div class="paragraph">
<p><strong>The type <code>KafkaListeners</code> has been deprecated.</strong>
Please use <a href="#type-GenericKafkaListener-reference"><code>GenericKafkaListener</code></a> instead.</p>
</div>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://strimzi.io/docs/operators/0.19.0/using.html">previous documentation</a> for example configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plain</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures plain listener on port 9092.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerPlain-reference"><code>KafkaListenerPlain</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures TLS listener on port 9093.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">external</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures external listener on port 9094. The type depends on the value of the <code>external.type</code> property within the given object, which must be one of [route, loadbalancer, nodeport, ingress].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerPlain-reference"><a class="link" href="#type-KafkaListenerPlain-reference">B.20. <code>KafkaListenerPlain</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for this listener. Since this listener does not use TLS transport you cannot configure an authentication with <code>type: tls</code>. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerTls-reference"><a class="link" href="#type-KafkaListenerTls-reference">B.21. <code>KafkaListenerTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for this listener. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of TLS listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsListenerConfiguration-reference"><code>TlsListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-TlsListenerConfiguration-reference"><a class="link" href="#type-TlsListenerConfiguration-reference">B.22. <code>TlsListenerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerTls-reference"><code>KafkaListenerTls</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair. The certificate can optionally contain the whole chain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalRoute-reference"><a class="link" href="#type-KafkaListenerExternalRoute-reference">B.23. <code>KafkaListenerExternalRoute</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalRoute</code> from <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>route</code> for the type <code>KafkaListenerExternalRoute</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>route</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External listener configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerExternalConfiguration-reference"><code>KafkaListenerExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerOverride-reference"><a class="link" href="#type-RouteListenerOverride-reference">B.24. <code>RouteListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerBootstrapOverride-reference"><code>RouteListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-RouteListenerBrokerOverride-reference"><code>RouteListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerBootstrapOverride-reference"><a class="link" href="#type-RouteListenerBootstrapOverride-reference">B.25. <code>RouteListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the bootstrap route. This field will be used in the <code>spec.host</code> field of the OpenShift Route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-RouteListenerBrokerOverride-reference"><a class="link" href="#type-RouteListenerBrokerOverride-reference">B.26. <code>RouteListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-RouteListenerOverride-reference"><code>RouteListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the broker route. This field will be used in the <code>spec.host</code> field of the OpenShift Route.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalConfiguration-reference"><a class="link" href="#type-KafkaListenerExternalConfiguration-reference">B.27. <code>KafkaListenerExternalConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair. The certificate can optionally contain the whole chain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalLoadBalancer-reference"><a class="link" href="#type-KafkaListenerExternalLoadBalancer-reference">B.28. <code>KafkaListenerExternalLoadBalancer</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalLoadBalancer</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>loadbalancer</code> for the type <code>KafkaListenerExternalLoadBalancer</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>loadbalancer</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External listener configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerExternalConfiguration-reference"><code>KafkaListenerExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enables TLS encryption on the listener. By default set to <code>true</code> for enabled TLS encryption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerOverride-reference"><a class="link" href="#type-LoadBalancerListenerOverride-reference">B.29. <code>LoadBalancerListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerBootstrapOverride-reference"><code>LoadBalancerListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-LoadBalancerListenerBrokerOverride-reference"><code>LoadBalancerListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerBootstrapOverride-reference"><a class="link" href="#type-LoadBalancerListenerBootstrapOverride-reference">B.30. <code>LoadBalancerListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-LoadBalancerListenerBrokerOverride-reference"><a class="link" href="#type-LoadBalancerListenerBrokerOverride-reference">B.31. <code>LoadBalancerListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-LoadBalancerListenerOverride-reference"><code>LoadBalancerListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerIP</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The loadbalancer is requested with the IP address specified in this field. This feature depends on whether the underlying cloud provider supports specifying the <code>loadBalancerIP</code> when a load balancer is created. This field is ignored if the cloud provider does not support the feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalNodePort-reference"><a class="link" href="#type-KafkaListenerExternalNodePort-reference">B.32. <code>KafkaListenerExternalNodePort</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalNodePort</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a>.
It must have the value <code>nodeport</code> for the type <code>KafkaListenerExternalNodePort</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>nodeport</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overrides</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Overrides for external bootstrap and broker services and externally advertised addresses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External listener configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerConfiguration-reference"><code>NodePortListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enables TLS encryption on the listener. By default set to <code>true</code> for enabled TLS encryption.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerOverride-reference"><a class="link" href="#type-NodePortListenerOverride-reference">B.33. <code>NodePortListenerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap service configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerBootstrapOverride-reference"><code>NodePortListenerBootstrapOverride</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker services configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-NodePortListenerBrokerOverride-reference"><code>NodePortListenerBrokerOverride</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerBootstrapOverride-reference"><a class="link" href="#type-NodePortListenerBootstrapOverride-reference">B.34. <code>NodePortListenerBootstrapOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerBrokerOverride-reference"><a class="link" href="#type-NodePortListenerBrokerOverride-reference">B.35. <code>NodePortListenerBrokerOverride</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-NodePortListenerOverride-reference"><code>NodePortListenerOverride</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodePort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Node port for the broker service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Service</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-NodePortListenerConfiguration-reference"><a class="link" href="#type-NodePortListenerConfiguration-reference">B.36. <code>NodePortListenerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair. The certificate can optionally contain the whole chain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preferredAddressType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Defines which address type should be used as the node address. Available types are: <code>ExternalDNS</code>, <code>ExternalIP</code>, <code>InternalDNS</code>, <code>InternalIP</code> and <code>Hostname</code>. By default, the addresses will be used in the following order (the first one found will be used):
* <code>ExternalDNS</code>
* <code>ExternalIP</code>
* <code>InternalDNS</code>
* <code>InternalIP</code>
* <code>Hostname</code></p>
<p class="tableblock">This field can be used to select the address type which will be used as the preferred type and checked first. In case no address will be found for this address type, the other types will be used in the default order..</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [ExternalDNS, ExternalIP, Hostname, InternalIP, InternalDNS])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaListenerExternalIngress-reference"><a class="link" href="#type-KafkaListenerExternalIngress-reference">B.37. <code>KafkaListenerExternalIngress</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListeners-reference"><code>KafkaListeners</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaListenerExternalIngress</code> from <a href="#type-KafkaListenerExternalRoute-reference"><code>KafkaListenerExternalRoute</code></a>, <a href="#type-KafkaListenerExternalLoadBalancer-reference"><code>KafkaListenerExternalLoadBalancer</code></a>, <a href="#type-KafkaListenerExternalNodePort-reference"><code>KafkaListenerExternalNodePort</code></a>.
It must have the value <code>ingress</code> for the type <code>KafkaListenerExternalIngress</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>ingress</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka brokers. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaListenerAuthenticationTls-reference"><code>KafkaListenerAuthenticationTls</code></a>, <a href="#type-KafkaListenerAuthenticationScramSha512-reference"><code>KafkaListenerAuthenticationScramSha512</code></a>, <a href="#type-KafkaListenerAuthenticationOAuth-reference"><code>KafkaListenerAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures the <code>Ingress</code> class that defines which <code>Ingress</code> controller will be used. If not set, the <code>Ingress</code> class is set to <code>nginx</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configuration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External listener configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">networkPolicyPeers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of peers which should be able to connect to this listener. Peers in this list are combined using a logical OR operation. If this field is empty or missing, all connections will be allowed for this listener. If this field is present and contains at least one item, the listener only allows the traffic which matches at least one item in this list. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">networking.k8s.io/v1 networkpolicypeer</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#networkpolicypeer-v1-networking-k8s-io">NetworkPolicyPeer</a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerConfiguration-reference"><a class="link" href="#type-IngressListenerConfiguration-reference">B.38. <code>IngressListenerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaListenerExternalIngress-reference"><code>KafkaListenerExternalIngress</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External bootstrap ingress configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerBootstrapConfiguration-reference"><code>IngressListenerBootstrapConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">External broker ingress configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-IngressListenerBrokerConfiguration-reference"><code>IngressListenerBrokerConfiguration</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCertChainAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair. The certificate can optionally contain the whole chain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerBootstrapConfiguration-reference"><a class="link" href="#type-IngressListenerBootstrapConfiguration-reference">B.39. <code>IngressListenerBootstrapConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">address</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Additional address name for the bootstrap service. The address will be added to the list of subject alternative names of the TLS certificates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> resource. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the bootstrap route. This field will be used in the Ingress resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-IngressListenerBrokerConfiguration-reference"><a class="link" href="#type-IngressListenerBrokerConfiguration-reference">B.40. <code>IngressListenerBrokerConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-IngressListenerConfiguration-reference"><code>IngressListenerConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">broker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Id of the kafka broker (broker identifier).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedHost</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host name which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisedPort</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port number which will be used in the brokers' <code>advertised.brokers</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Host for the broker ingress. This field will be used in the Ingress resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dnsAnnotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations that will be added to the <code>Ingress</code> resources for individual brokers. You can use this field to configure DNS providers such as External DNS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaAuthorizationSimple-reference"><a class="link" href="#type-KafkaAuthorizationSimple-reference">B.41. <code>KafkaAuthorizationSimple</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>Simple authorization in Strimzi uses the <code>AclAuthorizer</code> plugin, the default Access Control Lists (ACLs) authorization plugin provided with Apache Kafka.
ACLs allow you to define which users have access to which resources at a granular level.</p>
</div>
<div class="paragraph">
<p>Configure the <code>Kafka</code> custom resource to use simple authorization.
Set the <code>type</code> property in the <code>authorization</code> section to the value <code>simple</code>,
and configure a list of super users.</p>
</div>
<div class="paragraph">
<p>Access rules are configured for the <code>KafkaUser</code>, as described in the <a href="#type-AclRule-reference">ACLRule schema reference</a>.</p>
</div>
<div class="sect3">
<h4 id="property-simple-authorization-superusers-reference"><a class="link" href="#property-simple-authorization-superusers-reference">B.41.1. <code>superUsers</code></a></h4>
<div class="paragraph">
<p>A list of user principals treated as super users, so that they are always allowed without querying ACL rules.
For more information see <a href="#con-securing-kafka-authorization-str">Kafka authorization</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of simple authorization configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authorization:
  type: simple
  superUsers:
    - CN=client_1
    - user_2
    - CN=client_3</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>super.user</code> configuration option in the <code>config</code> property in <code>Kafka.spec.kafka</code> is ignored.
Designate super users in the <code>authorization</code> property instead.
For more information, see <a href="#type-KafkaClusterSpec-reference">Kafka broker configuration</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaAuthorizationSimple</code> from <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>.
It must have the value <code>simple</code> for the type <code>KafkaAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>simple</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of super users. Should contain list of user principals which should get unlimited access rights.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaAuthorizationOpa-reference"><a class="link" href="#type-KafkaAuthorizationOpa-reference">B.42. <code>KafkaAuthorizationOpa</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>To use <a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener">Open Policy Agent</a> authorization, set the <code>type</code> property in the <code>authorization</code> section to the value <code>opa</code>,
and configure OPA properties as required.</p>
</div>
<div class="sect3">
<h4 id="url"><a class="link" href="#url">B.42.1. <code>url</code></a></h4>
<div class="paragraph">
<p>The URL used to connect to the Open Policy Agent server.
The URL has to include the policy which will be queried by the authorizer.
<strong>Required.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="allowonerror"><a class="link" href="#allowonerror">B.42.2. <code>allowOnError</code></a></h4>
<div class="paragraph">
<p>Defines whether a Kafka client should be allowed or denied by default when the authorizer fails to query the Open Policy Agent, for example, when it is temporarily unavailable.
Defaults to <code>false</code> - all actions will be denied.</p>
</div>
</div>
<div class="sect3">
<h4 id="initialcachecapacity"><a class="link" href="#initialcachecapacity">B.42.3. <code>initialCacheCapacity</code></a></h4>
<div class="paragraph">
<p>Initial capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request.
Defaults to <code>5000</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="maximumcachesize"><a class="link" href="#maximumcachesize">B.42.4. <code>maximumCacheSize</code></a></h4>
<div class="paragraph">
<p>Maximum capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request.
Defaults to <code>50000</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="expireafterms"><a class="link" href="#expireafterms">B.42.5. <code>expireAfterMs</code></a></h4>
<div class="paragraph">
<p>The expiration of the records kept in the local cache to avoid querying the Open Policy Agent for every request.
Defines how often the cached authorization decisions are reloaded from the Open Policy Agent server.
In milliseconds.
Defaults to <code>3600000</code> milliseconds (1 hour).</p>
</div>
</div>
<div class="sect3">
<h4 id="superusers"><a class="link" href="#superusers">B.42.6. <code>superUsers</code></a></h4>
<div class="paragraph">
<p>A list of user principals treated as super users, so that they are always allowed without querying the open Policy Agent policy.
For more information see <a href="#con-securing-kafka-authorization-str">Kafka authorization</a>.</p>
</div>
<div class="listingblock">
<div class="title">An example of Open Policy Agent authorizer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authorization:
  type: opa
  url: http://opa:8181/v1/data/kafka/allow
  allowOnError: false
  initialCacheCapacity: 1000
  maximumCacheSize: 10000
  expireAfterMs: 60000
  superUsers:
    - CN=fred
    - sam
    - CN=edward</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaAuthorizationOpa</code> from <a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationKeycloak-reference"><code>KafkaAuthorizationKeycloak</code></a>.
It must have the value <code>opa</code> for the type <code>KafkaAuthorizationOpa</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>opa</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL used to connect to the Open Policy Agent server. The URL has to include the policy which will be queried by the authorizer. This option is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowOnError</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Defines whether a Kafka client should be allowed or denied by default when the authorizer fails to query the Open Policy Agent, for example, when it is temporarily unavailable). Defaults to <code>false</code> - all actions will be denied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialCacheCapacity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Initial capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request Defaults to <code>5000</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximumCacheSize</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Maximum capacity of the local cache used by the authorizer to avoid querying the Open Policy Agent for every request. Defaults to <code>50000</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expireAfterMs</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The expiration of the records kept in the local cache to avoid querying the Open Policy Agent for every request. Defines how often the cached authorization decisions are reloaded from the Open Policy Agent server. In milliseconds. Defaults to <code>3600000</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of super users, which is specifically a list of user principals that have unlimited access rights.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaAuthorizationKeycloak-reference"><a class="link" href="#type-KafkaAuthorizationKeycloak-reference">B.43. <code>KafkaAuthorizationKeycloak</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaAuthorizationKeycloak</code> from <a href="#type-KafkaAuthorizationSimple-reference"><code>KafkaAuthorizationSimple</code></a>, <a href="#type-KafkaAuthorizationOpa-reference"><code>KafkaAuthorizationOpa</code></a>.
It must have the value <code>keycloak</code> for the type <code>KafkaAuthorizationKeycloak</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>keycloak</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth Client ID which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization server token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection to the OAuth server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable TLS hostname verification. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegateToKafkaAcls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Whether authorization decision should be delegated to the 'Simple' authorizer if DENIED by Keycloak Authorization Services policies. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grantsRefreshPeriodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The time between two consecutive grants refresh runs in seconds. The default value is 60.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grantsRefreshPoolSize</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of threads to use to refresh grants for active sessions. The more threads, the more parallelism, so the sooner the job completes. However, using more threads places a heavier load on the authorization server. The default value is 5.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">superUsers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of super users. Should contain list of user principals which should get unlimited access rights.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Rack-reference"><a class="link" href="#type-Rack-reference">B.44. <code>Rack</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topologyKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A key that matches labels assigned to the Kubernetes cluster nodes. The value of the label is used to set the broker&#8217;s <code>broker.rack</code> config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Probe-reference"><a class="link" href="#type-Probe-reference">B.45. <code>Probe</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failureThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Minimum consecutive failures for the probe to be considered failed after having succeeded. Defaults to 3. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialDelaySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The initial delay before first the health is first checked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">periodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">How often (in seconds) to perform the probe. Default to 10 seconds. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">successThreshold</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Minimum consecutive successes for the probe to be considered successful after having failed. Defaults to 1. Must be 1 for liveness. Minimum value is 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The timeout for each attempted health check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JvmOptions-reference"><a class="link" href="#type-JvmOptions-reference">B.46. <code>JvmOptions</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-XX</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A map of -XX options to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xms</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">-Xms option to to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Xmx</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">-Xmx option to to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gcLoggingEnabled</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies whether the Garbage Collection logging is enabled. The default is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javaSystemProperties</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A map of additional system properties which will be passed using the <code>-D</code> option to the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-SystemProperty-reference"><code>SystemProperty</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-SystemProperty-reference"><a class="link" href="#type-SystemProperty-reference">B.47. <code>SystemProperty</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The system property name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The system property value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaJmxOptions-reference"><a class="link" href="#type-KafkaJmxOptions-reference">B.48. <code>KafkaJmxOptions</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the Kafka JMX port. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [password].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaJmxAuthenticationPassword-reference"><code>KafkaJmxAuthenticationPassword</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaJmxAuthenticationPassword-reference"><a class="link" href="#type-KafkaJmxAuthenticationPassword-reference">B.49. <code>KafkaJmxAuthenticationPassword</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaJmxOptions-reference"><code>KafkaJmxOptions</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaJmxAuthenticationPassword</code> from other subtypes which may be added in the future.
It must have the value <code>password</code> for the type <code>KafkaJmxAuthenticationPassword</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-InlineLogging-reference"><a class="link" href="#type-InlineLogging-reference">B.50. <code>InlineLogging</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>InlineLogging</code> from <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a>.
It must have the value <code>inline</code> for the type <code>InlineLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>inline</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loggers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A Map from logger name to logger level.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalLogging-reference"><a class="link" href="#type-ExternalLogging-reference">B.51. <code>ExternalLogging</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a>, <a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a>, <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>ExternalLogging</code> from <a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>.
It must have the value <code>external</code> for the type <code>ExternalLogging</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>external</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the <code>ConfigMap</code> from which to get the logging configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-TlsSidecar-reference"><a class="link" href="#type-TlsSidecar-reference">B.52. <code>TlsSidecar</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a>, <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a>, <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a>, <a href="#type-TopicOperatorSpec-reference"><code>TopicOperatorSpec</code></a>, <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logLevel</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The log level for the TLS sidecar. Default value is <code>notice</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [emerg, debug, crit, err, alert, warning, notice, info])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClusterTemplate-reference"><a class="link" href="#type-KafkaClusterTemplate-reference">B.53. <code>KafkaClusterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterSpec-reference"><code>KafkaClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>StatefulSet</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka bootstrap <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokersService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka broker <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalServiceTemplate-reference"><code>ExternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Services</code> used for access from outside of Kubernetes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalServiceTemplate-reference"><code>ExternalServiceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Route</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodRoute</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Routes</code> used for access from outside of OpenShift.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalBootstrapIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka external bootstrap <code>Ingress</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perPodIngress</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka per-pod <code>Ingress</code> used for access from outside of Kubernetes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for all Kafka <code>PersistentVolumeClaims</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka broker container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tlsSidecarContainer</code> has been deprecated.</strong> Template for the Kafka broker TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka init container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-StatefulSetTemplate-reference"><a class="link" href="#type-StatefulSetTemplate-reference">B.54. <code>StatefulSetTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podManagementPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">PodManagementPolicy which will be used for this StatefulSet. Valid values are <code>Parallel</code> and <code>OrderedReady</code>. Defaults to <code>Parallel</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [OrderedReady, Parallel])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-MetadataTemplate-reference"><a class="link" href="#type-MetadataTemplate-reference">B.55. <code>MetadataTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalServiceTemplate-reference"><code>ExternalServiceTemplate</code></a>, <a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a>, <a href="#type-PodTemplate-reference"><code>PodTemplate</code></a>, <a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a>, <a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p>
</div>
<div class="paragraph">
<p><code>Labels</code> and <code>Annotations</code> are used to identify and organize resources, and are configured in the <code>metadata</code> property.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
    statefulset:
        metadata:
            labels:
                label1: value1
                label2: value2
            annotations:
                annotation1: value1
                annotation2: value2
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>labels</code> and <code>annotations</code> fields can contain any labels or annotations that do not contain the reserved string <code>strimzi.io</code>.
Labels and annotations containing <code>strimzi.io</code> are used internally by Strimzi and cannot be configured.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labels</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Labels added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">annotations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Annotations added to the resource template. Can be applied to different resources such as <code>StatefulSets</code>, <code>Deployments</code>, <code>Pods</code>, and <code>Services</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PodTemplate-reference"><a class="link" href="#type-PodTemplate-reference">B.56. <code>PodTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="listingblock">
<div class="title">Example <code>PodTemplate</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
  pod:
    metadata:
      labels:
        label1: value1
      annotations:
        anno1: value1
    imagePullSecrets:
      - name: my-docker-credentials
    securityContext:
      runAsUser: 1000001
      fsGroup: 0
    terminationGracePeriodSeconds: 120
# ...</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="property-hostaliases-config-reference"><a class="link" href="#property-hostaliases-config-reference">B.56.1. <code>hostAliases</code></a></h4>
<div class="paragraph">
<p>Use the <code>hostAliases</code> property to a specify a list of hosts and IP addresses,
which are injected into the <code>/etc/hosts</code> file of the pod.</p>
</div>
<div class="paragraph">
<p>This configuration is especially useful for Kafka Connect or MirrorMaker when a connection outside of the cluster is also requested by users.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>hostAliases</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
#...
spec:
  # ...
  template:
    pod:
      hostAliases:
      - ip: "192.168.1.86"
        hostnames:
        - "my-host-1"
        - "my-host-2"
      #...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imagePullSecrets</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of references to secrets in the same namespace to use for pulling any of the images used by this Pod. When the <code>STRIMZI_IMAGE_PULL_SECRETS</code> environment variable in Cluster Operator and the <code>imagePullSecrets</code> option are specified, only the <code>imagePullSecrets</code> variable is used and the <code>STRIMZI_IMAGE_PULL_SECRETS</code> variable is ignored. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#localobjectreference-v1-core">core/v1 localobjectreference</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#localobjectreference-v1-core">LocalObjectReference</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityContext</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configures pod-level security attributes and common container settings. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core">core/v1 podsecuritycontext</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#podsecuritycontext-v1-core">PodSecurityContext</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">terminationGracePeriodSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The grace period is the duration in seconds after the processes running in the pod are sent a termination signal, and the time when the processes are forcibly halted with a kill signal. Set this value to longer than the expected cleanup time for your process. Value must be a non-negative integer. A zero value indicates delete immediately. You might need to increase the grace period for very large Kafka clusters, so that the Kafka brokers have enough time to transfer their work to another broker before they are terminated. Defaults to 30 seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">priorityClassName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the priority class used to assign priority to the pods. For more information about priority classes, see <a href="https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption" target="_blank" rel="noopener">Pod Priority and Preemption</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">schedulerName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the scheduler used to dispatch this <code>Pod</code>. If not specified, the default scheduler will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hostAliases</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The pod&#8217;s HostAliases. HostAliases is an optional list of hosts and IPs that will be injected into the pod&#8217;s hosts file if specified. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#HostAlias-v1-core">core/v1 HostAlias</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#HostAlias-v1-core">HostAlias</a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-ResourceTemplate-reference"><a class="link" href="#type-ResourceTemplate-reference">B.57. <code>ResourceTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalServiceTemplate-reference"><a class="link" href="#type-ExternalServiceTemplate-reference">B.58. <code>ExternalServiceTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p>When exposing Kafka outside of Kubernetes using loadbalancers or node ports, you can use properties, in addition to labels and annotations, to customize how a Service is created.</p>
</div>
<div class="listingblock">
<div class="title">An example showing customized external services</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
  externalBootstrapService:
    externalTrafficPolicy: Local
    loadBalancerSourceRanges:
      - 10.0.0.0/8
      - 88.208.76.87/32
  perPodService:
    externalTrafficPolicy: Local
    loadBalancerSourceRanges:
      - 10.0.0.0/8
      - 88.208.76.87/32
# ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata applied to the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalTrafficPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>externalTrafficPolicy</code> has been deprecated.</strong> Specifies whether the service routes external traffic to node-local or cluster-wide endpoints. <code>Cluster</code> may cause a second hop to another node and obscures the client source IP. <code>Local</code> avoids a second hop for LoadBalancer and Nodeport type services and preserves the client source IP (when supported by the infrastructure). If unspecified, Kubernetes will use <code>Cluster</code> as the default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Local, Cluster])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancerSourceRanges</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>loadBalancerSourceRanges</code> has been deprecated.</strong> A list of CIDR ranges (for example <code>10.0.0.0/8</code> or <code>130.211.204.1/32</code>) from which clients can connect to load balancer type listeners. If supported by the platform, traffic through the loadbalancer is restricted to the specified CIDR ranges. This field is applicable only for loadbalancer type services and is ignored if the cloud provider does not support the feature. For more information, see <a href="https://v1-17.docs.kubernetes.io/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/" class="bare">https://v1-17.docs.kubernetes.io/docs/tasks/access-application-cluster/configure-cloud-provider-firewall/</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-PodDisruptionBudgetTemplate-reference"><a class="link" href="#type-PodDisruptionBudgetTemplate-reference">B.59. <code>PodDisruptionBudgetTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p>Strimzi creates a <code>PodDisruptionBudget</code> for every new <code>StatefulSet</code> or <code>Deployment</code>.
By default, pod disruption budgets only allow a single pod to be unavailable at a given time.
You can increase the amount of unavailable pods allowed by changing the default value of the <code>maxUnavailable</code> property in the <code>PodDisruptionBudget.spec</code> resource.</p>
</div>
<div class="listingblock">
<div class="title">An example of <code>PodDisruptionBudget</code> template</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
    podDisruptionBudget:
        metadata:
            labels:
                key1: label1
                key2: label2
            annotations:
                key1: label1
                key2: label2
        maxUnavailable: 1
# ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metadata</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Metadata to apply to the <code>PodDistruptionBugetTemplate</code> resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-MetadataTemplate-reference"><code>MetadataTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxUnavailable</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Maximum number of unavailable pods to allow automatic Pod eviction. A Pod eviction is allowed when the <code>maxUnavailable</code> number of pods or fewer are unavailable after the eviction. Setting this value to 0 prevents all voluntary evictions, so the pods must be evicted manually. Defaults to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ContainerTemplate-reference"><a class="link" href="#type-ContainerTemplate-reference">B.60. <code>ContainerTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a>, <a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a>, <a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a>, <a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a>, <a href="#type-KafkaClusterTemplate-reference"><code>KafkaClusterTemplate</code></a>, <a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a>, <a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a>, <a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a>, <a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p>
</div>
<div class="paragraph">
<p>You can set custom security context and environment variables for a container.</p>
</div>
<div class="paragraph">
<p>The environment variables are defined under the <code>env</code> property as a list of objects with <code>name</code> and <code>value</code> fields.
The following example shows two custom environment variables and a custom security context set for the Kafka broker containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs"># ...
template:
  kafkaContainer:
    env:
    - name: EXAMPLE_ENV_1
      value: example.env.one
    - name: EXAMPLE_ENV_2
      value: example.env.two
    securityContext:
      runAsUser: 2000
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment variables prefixed with <code>KAFKA_</code> are internal to Strimzi and should be avoided.
If you set a custom environment variable that is already in use by Strimzi, it is ignored and a warning is recorded in the log.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Environment variables which should be applied to the container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerEnvVar-reference"><code>ContainerEnvVar</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">securityContext</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Security context for the container. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core">core/v1 securitycontext</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#securitycontext-v1-core">SecurityContext</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ContainerEnvVar-reference"><a class="link" href="#type-ContainerEnvVar-reference">B.61. <code>ContainerEnvVar</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The environment variable key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The environment variable value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ZookeeperClusterSpec-reference"><a class="link" href="#type-ZookeeperClusterSpec-reference">B.62. <code>ZookeeperClusterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">storage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Storage configuration (disk). Cannot be updated. The type depends on the value of the <code>storage.type</code> property within the given object, which must be one of [ephemeral, persistent-claim].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EphemeralStorage-reference"><code>EphemeralStorage</code></a>, <a href="#type-PersistentClaimStorage-reference"><code>PersistentClaimStorage</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The ZooKeeper broker config. Properties with the following prefixes cannot be set: server., dataDir, dataLogDir, clientPort, authProvider, quorum.auth, requireClientAuthScheme, snapshot.trust.empty, standaloneEnabled, reconfigEnabled, 4lw.commands.whitelist, secureClientPort, ssl., serverCnxnFactory, sslQuorum (with the exception of: ssl.protocol, ssl.quorum.protocol, ssl.enabledProtocols, ssl.quorum.enabledProtocols, ssl.ciphersuites, ssl.quorum.ciphersuites, ssl.hostnameVerification, ssl.quorum.hostnameVerification).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.zookeeper.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.zookeeper.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for ZooKeeper. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper cluster resources. The template allows users to specify how are the <code>StatefulSet</code>, <code>Pods</code> and <code>Services</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ZookeeperClusterTemplate-reference"><code>ZookeeperClusterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tlsSidecar</code> has been deprecated.</strong> TLS sidecar configuration. The TLS sidecar is not used anymore and this option will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ZookeeperClusterTemplate-reference"><a class="link" href="#type-ZookeeperClusterTemplate-reference">B.63. <code>ZookeeperClusterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ZookeeperClusterSpec-reference"><code>ZookeeperClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">statefulset</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper <code>StatefulSet</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-StatefulSetTemplate-reference"><code>StatefulSetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper client <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodesService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper nodes <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">persistentVolumeClaim</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for all ZooKeeper <code>PersistentVolumeClaims</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for ZooKeeper <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the ZooKeeper container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tlsSidecarContainer</code> has been deprecated.</strong> Template for the Zookeeper server TLS sidecar container. The TLS sidecar is not used anymore and this option will be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-TopicOperatorSpec-reference"><a class="link" href="#type-TopicOperatorSpec-reference">B.64. <code>TopicOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p><strong>The type <code>TopicOperatorSpec</code> has been deprecated.</strong>
Please use <a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a> instead.</p>
</div>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the Topic Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the ZooKeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicMetadataMaxAttempts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of attempts at getting topic metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityOperatorSpec-reference"><a class="link" href="#type-EntityOperatorSpec-reference">B.65. <code>EntityOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityTopicOperatorSpec-reference"><code>EntityTopicOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperator</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the User Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityUserOperatorSpec-reference"><code>EntityUserOperatorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator resources. The template allows users to specify how is the <code>Deployment</code> and <code>Pods</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-EntityOperatorTemplate-reference"><code>EntityOperatorTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityTopicOperatorSpec-reference"><a class="link" href="#type-EntityTopicOperatorSpec-reference">B.66. <code>EntityTopicOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the Topic Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the Topic Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the ZooKeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicMetadataMaxAttempts</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of attempts at getting topic metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityUserOperatorSpec-reference"><a class="link" href="#type-EntityUserOperatorSpec-reference">B.67. <code>EntityUserOperatorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchedNamespace</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The namespace the User Operator should watch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the User Operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reconciliationIntervalSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Interval between periodic reconciliations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zookeeperSessionTimeoutSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Timeout for the ZooKeeper session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-EntityOperatorTemplate-reference"><a class="link" href="#type-EntityOperatorTemplate-reference">B.68. <code>EntityOperatorTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-EntityOperatorSpec-reference"><code>EntityOperatorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Entity Operator <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity Operator TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity Topic Operator container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userOperatorContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Entity User Operator container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CertificateAuthority-reference"><a class="link" href="#type-CertificateAuthority-reference">B.69. <code>CertificateAuthority</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configuration of how TLS certificates are used within the cluster. This applies to certificates used for both internal communication within the cluster and to certificates used for client access via <code>Kafka.spec.kafka.listeners.tls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">generateCertificateAuthority</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">If true then Certificate Authority certificates will be generated automatically. Otherwise the user will need to provide a Secret with the CA certificate. Default is true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">validityDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of days generated certificates should be valid for. The default is 365.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">renewalDays</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of days in the certificate renewal period. This is the number of days before the a certificate expires during which renewal actions may be performed. When <code>generateCertificateAuthority</code> is true, this will cause the generation of a new certificate. When <code>generateCertificateAuthority</code> is true, this will cause extra logging at WARN level about the pending certificate expiry. Default is 30.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateExpirationPolicy</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">How should CA certificate expiration be handled when <code>generateCertificateAuthority=true</code>. The default is for a new CA certificate to be generated reusing the existing private key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [replace-key, renew-certificate])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CruiseControlSpec-reference"><a class="link" href="#type-CruiseControlSpec-reference">B.70. <code>CruiseControlSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecar</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS sidecar configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-TlsSidecar-reference"><code>TlsSidecar</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve for the Cruise Control container. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking for the Cruise Control container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking for the Cruise Control container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for the Cruise Control container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration (log4j1) for Cruise Control. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template to specify how Cruise Control resources, <code>Deployments</code> and <code>Pods</code>, are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CruiseControlTemplate-reference"><code>CruiseControlTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">brokerCapacity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Cruise Control <code>brokerCapacity</code> configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-BrokerCapacity-reference"><code>BrokerCapacity</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Cruise Control configuration. For a full list of configuration options refer to <a href="https://github.com/linkedin/cruise-control/wiki/Configurations" class="bare">https://github.com/linkedin/cruise-control/wiki/Configurations</a>. Note that properties with the following prefixes cannot be set: bootstrap.servers, client.id, zookeeper., network., security., failed.brokers.zk.path,webserver.http., webserver.api.urlprefix, webserver.session.path, webserver.accesslog., two.step., request.reason.required,metric.reporter.sampler.bootstrap.servers, metric.reporter.topic, partition.metric.sample.store.topic, broker.metric.sample.store.topic,capacity.config.file, self.healing., anomaly.detection., ssl.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-CruiseControlTemplate-reference"><a class="link" href="#type-CruiseControlTemplate-reference">B.71. <code>CruiseControlTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Cruise Control <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Cruise Control <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Cruise Control API <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Cruise Control <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cruiseControlContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Cruise Control container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsSidecarContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Cruise Control TLS sidecar container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-BrokerCapacity-reference"><a class="link" href="#type-BrokerCapacity-reference">B.72. <code>BrokerCapacity</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-CruiseControlSpec-reference"><code>CruiseControlSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disk</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Broker capacity for disk in bytes, for example, 100Gi.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpuUtilization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Broker capacity for CPU resource utilization as a percentage (0 - 100).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">inboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Broker capacity for inbound network throughput in bytes per second, for example, 10000KB/s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outboundNetwork</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Broker capacity for outbound network throughput in bytes per second, for example 10000KB/s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JmxTransSpec-reference"><a class="link" href="#type-JmxTransSpec-reference">B.73. <code>JmxTransSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image to use for the JmxTrans.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputDefinitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Defines the output hosts that will be referenced later on. For more information on these properties see, <a href="#type-JmxTransOutputDefinitionTemplate-reference"><code>JmxTransOutputDefinitionTemplate</code> schema reference</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransOutputDefinitionTemplate-reference"><code>JmxTransOutputDefinitionTemplate</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logLevel</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Sets the logging level of the JmxTrans deployment.For more information see, <a href="https://github.com/jmxtrans/jmxtrans-agent/wiki/Troubleshooting">JmxTrans Logging Level</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kafkaQueries</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Queries to send to the Kafka brokers to define what data should be read from each broker. For more information on these properties see, <a href="#type-JmxTransQueryTemplate-reference"><code>JmxTransQueryTemplate</code> schema reference</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransQueryTemplate-reference"><code>JmxTransQueryTemplate</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for JmxTrans resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JmxTransTemplate-reference"><code>JmxTransTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JmxTransOutputDefinitionTemplate-reference"><a class="link" href="#type-JmxTransOutputDefinitionTemplate-reference">B.74. <code>JmxTransOutputDefinitionTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for setting the format of the data that will be pushed.For more information see <a href="https://github.com/jmxtrans/jmxtrans/wiki/OutputWriters">JmxTrans OutputWriters</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The DNS/hostname of the remote host that the data is pushed to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port of the remote host that the data is pushed to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushDelayInSeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">How many seconds the JmxTrans waits before pushing a new set of data out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">typeNames</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for filtering data to be included in response to a wildcard query. For more information see <a href="https://github.com/jmxtrans/jmxtrans/wiki/Queries">JmxTrans queries</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for setting the name of the output definition. This is used to identify where to send the results of queries should be sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JmxTransQueryTemplate-reference"><a class="link" href="#type-JmxTransQueryTemplate-reference">B.75. <code>JmxTransQueryTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetMBean</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">If using wildcards instead of a specific MBean then the data is gathered from multiple MBeans. Otherwise if specifying an MBean then data is gathered from that specified MBean.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">attributes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Determine which attributes of the targeted MBean should be included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">outputs</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of the names of output definitions specified in the spec.kafka.jmxTrans.outputDefinitions that have defined where JMX metrics are pushed to, and in which data format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JmxTransTemplate-reference"><a class="link" href="#type-JmxTransTemplate-reference">B.76. <code>JmxTransTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-JmxTransSpec-reference"><code>JmxTransSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for JmxTrans <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for JmxTrans <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for JmxTrans container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaExporterSpec-reference"><a class="link" href="#type-KafkaExporterSpec-reference">B.77. <code>KafkaExporterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaSpec-reference"><code>KafkaSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Regular expression to specify which consumer groups to collect. Default value is <code>.*</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicRegex</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Regular expression to specify which topics to collect. Default value is <code>.*</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Only log messages with the given severity or above. Valid levels: [<code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>]. Default log level is <code>info</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableSaramaLogging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable Sarama logging, a Go client library used by the Kafka Exporter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Customization of deployment templates and pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaExporterTemplate-reference"><code>KafkaExporterTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness check.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaExporterTemplate-reference"><a class="link" href="#type-KafkaExporterTemplate-reference">B.78. <code>KafkaExporterTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaExporterSpec-reference"><code>KafkaExporterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">service</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Exporter <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Exporter container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaStatus-reference"><a class="link" href="#type-KafkaStatus-reference">B.79. <code>KafkaStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-Kafka-reference"><code>Kafka</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listeners</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Addresses of the internal and external listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-Condition-reference"><a class="link" href="#type-Condition-reference">B.80. <code>Condition</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a>, <a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code></a>, <a href="#type-KafkaConnectS2IStatus-reference"><code>KafkaConnectS2IStatus</code></a>, <a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a>, <a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a>, <a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a>, <a href="#type-KafkaRebalanceStatus-reference"><code>KafkaRebalanceStatus</code></a>, <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a>, <a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a>, <a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The unique identifier of a condition, used to distinguish between other conditions in the resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the condition, either True, False or Unknown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastTransitionTime</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Last time the condition of a type changed from one status to another. The required format is 'yyyy-MM-ddTHH:mm:ssZ', in the UTC time zone.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reason</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The reason for the condition&#8217;s last transition (a single word in CamelCase).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Human-readable message indicating details about the condition&#8217;s last transition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ListenerStatus-reference"><a class="link" href="#type-ListenerStatus-reference">B.81. <code>ListenerStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaStatus-reference"><code>KafkaStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The type of the listener. Can be one of the following three types: <code>plain</code>, <code>tls</code>, and <code>external</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addresses</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of the addresses for this listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ListenerAddress-reference"><code>ListenerAddress</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A comma-separated list of <code>host:port</code> pairs for connecting to the Kafka cluster using this listener.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of TLS certificates which can be used to verify the identity of the server when connecting to the given listener. Set only for <code>tls</code> and <code>external</code> listeners.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ListenerAddress-reference"><a class="link" href="#type-ListenerAddress-reference">B.82. <code>ListenerAddress</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ListenerStatus-reference"><code>ListenerStatus</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The DNS name or IP address of the Kafka bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port of the Kafka bootstrap service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnect-reference"><a class="link" href="#type-KafkaConnect-reference">B.83. <code>KafkaConnect</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Connect cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Connect cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectSpec-reference"><a class="link" href="#type-KafkaConnectSpec-reference">B.84. <code>KafkaConnectSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka Connect cluster.</p>
</div>
<div class="sect3">
<h4 id="property-kafka-connect-config-reference"><a class="link" href="#property-kafka-connect-config-reference">B.84.1. <code>config</code></a></h4>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka options as keys.</p>
</div>
<div class="paragraph">
<p>Standard Apache Kafka Connect configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>Configuration options that cannot be configured relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Listener / REST interface configuration</p>
</li>
<li>
<p>Plugin path configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/documentation/#connectconfigs" target="_blank" rel="noopener">Apache Kafka documentation</a> with the exception of those options that are managed directly by Strimzi.
Specifically, configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>listeners</code></p>
</li>
<li>
<p><code>plugin.path</code></p>
</li>
<li>
<p><code>rest.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka Connect.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object provided.
When an invalid configuration is provided, the Kafka Connect cluster might not start or might become unstable.
In this circumstance, fix the configuration in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> object, then the Cluster Operator can roll out the new configuration to all Kafka Connect nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain options have default values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group.id</code> with default value <code>connect-cluster</code></p>
</li>
<li>
<p><code>offset.storage.topic</code> with default value <code>connect-cluster-offsets</code></p>
</li>
<li>
<p><code>config.storage.topic</code> with default value <code>connect-cluster-configs</code></p>
</li>
<li>
<p><code>status.storage.topic</code> with default value <code>connect-cluster-status</code></p>
</li>
<li>
<p><code>key.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
<li>
<p><code>value.converter</code> with default value <code>org.apache.kafka.connect.json.JsonConverter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These options are automatically configured in case they are not present in the <code>KafkaConnect.spec.config</code> or <code>KafkaConnectS2I.spec.config</code> properties.</p>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
You can use three allowed <code>ssl</code> configuration options for client connection using a specific <em>cipher suite</em> for a TLS version.
A cipher suite combines algorithms for secure connection and data transfer.
You can also configure the <code>ssl.endpoint.identification.algorithm</code> property to enable or disable hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Connect configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    group.id: my-connect-cluster
    offset.storage.topic: my-connect-cluster-offsets
    config.storage.topic: my-connect-cluster-configs
    status.storage.topic: my-connect-cluster-status
    key.converter: org.apache.kafka.connect.json.JsonConverter
    value.converter: org.apache.kafka.connect.json.JsonConverter
    key.converter.schemas.enable: true
    value.converter.schemas.enable: true
    config.storage.replication.factor: 3
    offset.storage.replication.factor: 3
    status.storage.replication.factor: 3
    ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
    ssl.enabled.protocols: "TLSv1.2"
    ssl.protocol: "TLSv1.2"
    ssl.endpoint.identification.algorithm: HTTPS
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-kafka-connect-logging-reference"><a class="link" href="#property-kafka-connect-logging-reference">B.84.2. <code>logging</code></a></h4>
<div class="paragraph">
<p>Kafka Connect (and Kafka Connect with Source2Image support) has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>connect.root.logger.level</code></p>
</li>
<li>
<p><code>log4j.logger.org.reflections</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further loggers are added depending on the Kafka Connect plugins running.</p>
</div>
<div class="paragraph">
<p>Use a curl request to get a complete list of Kafka Connect loggers running from any Kafka broker pod:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="curl" class="language-curl hljs">curl -s http://&lt;connect-cluster-name&gt;-connect-api:8083/admin/loggers/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka Connect uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
spec:
  # ...
  logging:
    type: inline
    loggers:
      connect.root.logger.level: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any available loggers that are not configured have their level set to <code>OFF</code>.</p>
</div>
<div class="paragraph">
<p>If Kafka Connect was deployed using the Cluster Operator,
changes to Kafka Connect logging levels are applied dynamically.</p>
</div>
<div class="paragraph">
<p>If you use external logging, a rolling update is triggered when logging appenders are changed.</p>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the Kafka Connect group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect version. Defaults to 2.6.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Bootstrap servers to connect to. This should be given as a comma separated list of <em>&lt;hostname&gt;</em>:<em>&lt;port&gt;</em> pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka Connect. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect configuration. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum limits for CPU and memory resources and the requested initial resources. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect and Kafka Connect S2I resources. The template allows users to specify how the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image of the init container used for initializing the <code>client.rack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the node label which will be used as the client.rack consumer configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectTls-reference"><a class="link" href="#type-KafkaConnectTls-reference">B.85. <code>KafkaConnectTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures TLS trusted certificates for connecting Kafka Connect to the cluster.</p>
</div>
<div class="sect3">
<h4 id="trustedcertificates"><a class="link" href="#trustedcertificates">B.85.1. <code>trustedCertificates</code></a></h4>
<div class="paragraph">
<p>Provide a list of secrets using the <a href="#con-common-configuration-trusted-certificates-reference"><code>trustedCertificates</code> property</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationTls-reference"><a class="link" href="#type-KafkaClientAuthenticationTls-reference">B.86. <code>KafkaClientAuthenticationTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To use TLS client authentication, set the <code>type</code> property to the value <code>tls</code>.
TLS client authentication uses a TLS certificate to authenticate.</p>
</div>
<div class="sect3">
<h4 id="certificateandkey"><a class="link" href="#certificateandkey">B.86.1. <code>certificateAndKey</code></a></h4>
<div class="paragraph">
<p>The certificate is specified in the <code>certificateAndKey</code> property and is always loaded from a Kubernetes secret.
In the secret, the certificate must be stored in X509 format under two different keys: public and private.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator,
or you can create your own TLS certificate file, with the keys used for authentication, then create a <code>Secret</code> from the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>MY-SECRET</em> \
--from-file=<em>MY-PUBLIC-TLS-CERTIFICATE-FILE.crt</em> \
--from-file=<em>MY-PRIVATE.key</em></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TLS client authentication can only be used with TLS connections.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example TLS client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: tls
  certificateAndKey:
    secretName: my-secret
    certificate: my-public-tls-certificate-file.crt
    key: private.key</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationTls</code> from <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaClientAuthenticationTls</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificateAndKey</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the certificate and private key pair.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertAndKeySecretSource-reference"><code>CertAndKeySecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationScramSha512-reference"><a class="link" href="#type-KafkaClientAuthenticationScramSha512-reference">B.87. <code>KafkaClientAuthenticationScramSha512</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based SCRAM-SHA-512 authentication, set the <code>type</code> property to <code>scram-sha-512</code>.
The SCRAM-SHA-512 authentication mechanism requires a username and password.</p>
</div>
<div class="sect3">
<h4 id="username"><a class="link" href="#username">B.87.1. <code>username</code></a></h4>
<div class="paragraph">
<p>Specify the username in the <code>username</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="passwordsecret"><a class="link" href="#passwordsecret">B.87.2. <code>passwordSecret</code></a></h4>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator.</p>
</div>
<div class="paragraph">
<p>If required, you can create a text file that contains the password, in cleartext, to use for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">echo -n <em>PASSWORD</em> &gt; <em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create a <code>Secret</code> from the text file, setting your own field name (key) for the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>MY-CONNECT-SECRET-NAME</em> --from-file=<em>MY-PASSWORD-FIELD-NAME</em>=./<em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Secret for SCRAM-SHA-512 client authentication for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-connect-secret-name
type: Opaque
data:
  my-connect-password-field: LFTIyFRFlMmU2N2Tm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secretName</code> property contains the name of the <code>Secret</code>, and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example SASL-based SCRAM-SHA-512 client authentication configuration for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: scram-sha-512
  username: my-connect-username
  passwordSecret:
    secretName: my-connect-secret-name
    password: my-connect-password-field</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationScramSha512</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaClientAuthenticationScramSha512</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username used for the authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-PasswordSecretSource-reference"><a class="link" href="#type-PasswordSecretSource-reference">B.88. <code>PasswordSecretSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the key in the Secret under which the password is stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the Secret containing the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationPlain-reference"><a class="link" href="#type-KafkaClientAuthenticationPlain-reference">B.89. <code>KafkaClientAuthenticationPlain</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To configure SASL-based PLAIN authentication, set the <code>type</code> property to <code>plain</code>.
SASL PLAIN authentication mechanism requires a username and password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The SASL PLAIN mechanism will transfer the username and password across the network in cleartext.
Only use SASL PLAIN authentication if TLS encryption is enabled.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="username_2"><a class="link" href="#username_2">B.89.1. <code>username</code></a></h4>
<div class="paragraph">
<p>Specify the username in the <code>username</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="passwordsecret_2"><a class="link" href="#passwordsecret_2">B.89.2. <code>passwordSecret</code></a></h4>
<div class="paragraph">
<p>In the <code>passwordSecret</code> property, specify a link to a <code>Secret</code> containing the password.</p>
</div>
<div class="paragraph">
<p>You can use the secrets created by the User Operator.</p>
</div>
<div class="paragraph">
<p>If required, create a text file that contains the password, in cleartext, to use for authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">echo -n <em>PASSWORD</em> &gt; <em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then create a <code>Secret</code> from the text file, setting your own field name (key) for the password:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">kubectl create secret generic <em>MY-CONNECT-SECRET-NAME</em> --from-file=<em>MY-PASSWORD-FIELD-NAME</em>=./<em>MY-PASSWORD</em>.txt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example Secret for PLAIN client authentication for Kafka Connect</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: my-connect-secret-name
type: Opaque
data:
  my-password-field-name: LFTIyFRFlMmU2N2Tm</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>secretName</code> property contains the name of the <code>Secret</code> and the <code>password</code> property contains the name of the key under which the password is stored inside the <code>Secret</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not specify the actual password in the <code>password</code> property.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">An example SASL based PLAIN client authentication configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: plain
  username: my-connect-username
  passwordSecret:
    secretName: my-connect-secret-name
    password: my-password-field-name</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationPlain</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a>.
It must have the value <code>plain</code> for the type <code>KafkaClientAuthenticationPlain</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">passwordSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to the <code>Secret</code> which holds the password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PasswordSecretSource-reference"><code>PasswordSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>plain</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username used for the authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaClientAuthenticationOAuth-reference"><a class="link" href="#type-KafkaClientAuthenticationOAuth-reference">B.90. <code>KafkaClientAuthenticationOAuth</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a>, <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>To use OAuth client authentication, set the <code>type</code> property to the value <code>oauth</code>.</p>
</div>
<div class="paragraph">
<p>OAuth authentication can be configured using one of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID and secret</p>
</li>
<li>
<p>Client ID and refresh token</p>
</li>
<li>
<p>Access token</p>
</li>
<li>
<p>TLS</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Client ID and secret</div>
<p>You can configure the address of your authorization server in the <code>tokenEndpointUri</code> property together with the client ID and client secret used in authentication.
The OAuth client will connect to the OAuth server, authenticate using the client ID and secret and get an access token which it will use to authenticate with the Kafka broker.
In the <code>clientSecret</code> property, specify a link to a <code>Secret</code> containing the client secret.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using client ID and client secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  clientSecret:
    secretName: my-client-oauth-secret
    key: client-secret</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Client ID and refresh token</div>
<p>You can configure the address of your OAuth server in the <code>tokenEndpointUri</code> property together with the OAuth client ID and refresh token.
The OAuth client will connect to the OAuth server, authenticate using the client ID and refresh token and get an access token which it will use to authenticate with the Kafka broker.
In the <code>refreshToken</code> property, specify a link to a <code>Secret</code> containing the refresh token.</p>
</div>
<div class="paragraph">
<p>+
.An example of OAuth client authentication using client ID and refresh token</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Access token</div>
<p>You can configure the access token used for authentication with the Kafka broker directly.
In this case, you do not specify the <code>tokenEndpointUri</code>.
In the <code>accessToken</code> property, specify a link to a <code>Secret</code> containing the access token.</p>
</div>
<div class="listingblock">
<div class="title">An example of OAuth client authentication using only an access token</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  accessToken:
    secretName: my-access-token-secret
    key: access-token</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">TLS</div>
<p>Accessing the OAuth server using the HTTPS protocol does not require any additional configuration as long as the TLS certificates used by it are signed by a trusted certification authority and its hostname is listed in the certificate.</p>
</div>
<div class="paragraph">
<p>If your OAuth server is using certificates which are self-signed or are signed by a certification authority which is not trusted, you can configure a list of trusted certificates in the custom resoruce.
The <code>tlsTrustedCertificates</code> property contains a list of secrets with key names under which the certificates are stored.
The certificates must be stored in X509 format.</p>
</div>
<div class="listingblock">
<div class="title">An example of TLS certificates provided</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  tlsTrustedCertificates:
    - secretName: oauth-server-ca
      certificate: tls.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OAuth client will by default verify that the hostname of your OAuth server matches either the certificate subject or one of the alternative DNS names.
If it is not required, you can disable the hostname verification.</p>
</div>
<div class="listingblock">
<div class="title">An example of disabled TLS hostname verification</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">authentication:
  type: oauth
  tokenEndpointUri: https://sso.myproject.svc:8443/auth/realms/internal/protocol/openid-connect/token
  clientId: my-client-id
  refreshToken:
    secretName: my-refresh-token-secret
    key: refresh-token
  disableTlsHostnameVerification: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaClientAuthenticationOAuth</code> from <a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>.
It must have the value <code>oauth</code> for the type <code>KafkaClientAuthenticationOAuth</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the access token which was obtained from the authorization server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessTokenIsJwt</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configure whether access token should be treated as JWT. This should be set to <code>false</code> if the authorization server returns opaque tokens. Defaults to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth Client ID which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientSecret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the OAuth client secret which the Kafka client can use to authenticate against the OAuth server and use the token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disableTlsHostnameVerification</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable or disable TLS hostname verification. Default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxTokenExpirySeconds</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Set or limit time-to-live of the access tokens to the specified number of seconds. This should be set if the authorization server returns opaque tokens.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">refreshToken</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Link to Kubernetes Secret containing the refresh token which can be used to obtain access token from the authorization server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-GenericSecretSource-reference"><code>GenericSecretSource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">OAuth scope to use when authenticating against the authorization server. Some authorization servers require this to be set. The possible values depend on how authorization server is configured. By default <code>scope</code> is not specified when doing the token endpoint request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tlsTrustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection to the OAuth server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenEndpointUri</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization server token endpoint URI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>oauth</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-JaegerTracing-reference"><a class="link" href="#type-JaegerTracing-reference">B.91. <code>JaegerTracing</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a>, <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a>, <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>JaegerTracing</code> from other subtypes which may be added in the future.
It must have the value <code>jaeger</code> for the type <code>JaegerTracing</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>jaeger</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectTemplate-reference"><a class="link" href="#type-KafkaConnectTemplate-reference">B.92. <code>KafkaConnectTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect API <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Connect container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka init container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfiguration-reference"><a class="link" href="#type-ExternalConfiguration-reference">B.93. <code>ExternalConfiguration</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a>, <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code></a>, <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<div class="paragraph">
<p>Configures external storage properties that define configuration options for Kafka Connect connectors.</p>
</div>
<div class="paragraph">
<p>You can mount ConfigMaps or Secrets into a Kafka Connect pod as environment variables or volumes.
Volumes and environment variables are configured in the <code>externalConfiguration</code> property in <code>KafkaConnect.spec</code> and <code>KafkaConnectS2I.spec</code>.</p>
</div>
<div class="paragraph">
<p>When applied, the environment variables and volumes are available for use when developing your connectors.</p>
</div>
<div class="sect3">
<h4 id="property-kafka-connect-external-env-reference"><a class="link" href="#property-kafka-connect-external-env-reference">B.93.1. <code>env</code></a></h4>
<div class="paragraph">
<p>The <code>env</code> property is used to specify one or more environment variables.
These variables can contain a value from either a ConfigMap or a Secret.</p>
</div>
<div class="listingblock">
<div class="title">Example Secret containing values for environment variables</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: aws-creds
type: Opaque
data:
  awsAccessKey: QUtJQVhYWFhYWFhYWFhYWFg=
  awsSecretAccessKey: Ylhsd1lYTnpkMjl5WkE=</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The names of user-defined environment variables cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To mount a value from a Secret to an environment variable, use the <code>valueFrom</code> property and the <code>secretKeyRef</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example environment variables set to values from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: AWS_ACCESS_KEY_ID
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsAccessKey
      - name: AWS_SECRET_ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: aws-creds
            key: awsSecretAccessKey</code></pre>
</div>
</div>
<div class="paragraph">
<p>A common use case for mounting Secrets to environment variables is when your connector needs to communicate with Amazon AWS and needs to read the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> environment variables with credentials.</p>
</div>
<div class="paragraph">
<p>To mount a value from a ConfigMap to an environment variable, use <code>configMapKeyRef</code> in the <code>valueFrom</code> property as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">Example environment variables set to values from a ConfigMap</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  externalConfiguration:
    env:
      - name: MY_ENVIRONMENT_VARIABLE
        valueFrom:
          configMapKeyRef:
            name: my-config-map
            key: my-key</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="property-kafka-connect-external-volumes-reference"><a class="link" href="#property-kafka-connect-external-volumes-reference">B.93.2. <code>volumes</code></a></h4>
<div class="paragraph">
<p>You can also mount ConfigMaps or Secrets to a Kafka Connect pod as volumes.</p>
</div>
<div class="paragraph">
<p>Using volumes instead of environment variables is useful in the following scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mounting truststores or keystores with TLS certificates</p>
</li>
<li>
<p>Mounting a properties file that is used to configure Kafka Connect connectors</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example Secret with properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: v1
kind: Secret
metadata:
  name: mysecret
type: Opaque
stringData:
  connector.properties: |- <b class="conum">(1)</b>
    dbUsername: my-user <b class="conum">(2)</b>
    dbPassword: my-password</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The connector configuration in properties file format.</p>
</li>
<li>
<p>Database username and password properties used in the configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this example, a Secret named <code>mysecret</code> is mounted to a volume named <code>connector-config</code>.
In the <code>config</code> property, a configuration provider (<code>FileConfigProvider</code>) is specified, which will load configuration values from external sources.
The Kafka <code>FileConfigProvider</code> is given the alias <code>file</code>,
and will read and extract database <em>username</em> and <em>password</em> property values from the file to use in the connector configuration.</p>
</div>
<div class="listingblock">
<div class="title">Example external volumes set to values from a Secret</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaConnect
metadata:
  name: my-connect
spec:
  # ...
  config:
    config.providers: file <b class="conum">(1)</b>
    config.providers.file.class: org.apache.kafka.common.config.provider.FileConfigProvider <b class="conum">(2)</b>
  #...
  externalConfiguration:
    volumes:
      - name: connector-config <b class="conum">(3)</b>
        secret:
          secretName: mysecret <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The alias for the configuration provider, which is used to define other configuration parameters.
Use a comma-separated list if you want to add more than one provider.</p>
</li>
<li>
<p>The <code>FileConfigProvider</code> is the configuration provider that provides values from properties files.
The parameter uses the alias from <code>config.providers</code>, taking the form <code>config.providers.${alias}.class</code>.</p>
</li>
<li>
<p>The name of the volume containing the Secret. Each volume must specify a name in the <code>name</code> property and a reference to ConfigMap or Secret.</p>
</li>
<li>
<p>The name of the Secret.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The volumes are mounted inside the Kafka Connect containers in the path <code>/opt/kafka/external-configuration/<em>&lt;volume-name&gt;</em></code>.
For example, the files from a volume named <code>connector-config</code> would appear in the directory <code>/opt/kafka/external-configuration/connector-config</code>.</p>
</div>
<div class="paragraph">
<p>The <code>FileConfigProvider</code> is used to read the values from the mounted properties files in connector configurations.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">env</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Allows to pass data from Secret or ConfigMap to the Kafka Connect pods as environment variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">volumes</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Allows to pass data from Secret or ConfigMap to the Kafka Connect pods as volumes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationVolumeSource-reference"><code>ExternalConfigurationVolumeSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationEnv-reference"><a class="link" href="#type-ExternalConfigurationEnv-reference">B.94. <code>ExternalConfigurationEnv</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the environment variable which will be passed to the Kafka Connect pods. The name of the environment variable cannot start with <code>KAFKA_</code> or <code>STRIMZI_</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueFrom</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Value of the environment variable which will be passed to the Kafka Connect pods. It can be passed either as a reference to Secret or ConfigMap field. The field has to specify exactly one Secret or ConfigMap.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfigurationEnvVarSource-reference"><code>ExternalConfigurationEnvVarSource</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationEnvVarSource-reference"><a class="link" href="#type-ExternalConfigurationEnvVarSource-reference">B.95. <code>ExternalConfigurationEnvVarSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfigurationEnv-reference"><code>ExternalConfigurationEnv</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMapKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Refernce to a key in a ConfigMap. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#configmapkeyselector-v1-core">core/v1 configmapkeyselector</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#configmapkeyselector-v1-core">ConfigMapKeySelector</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secretKeyRef</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a Secret. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#secretkeyselector-v1-core">core/v1 secretkeyselector</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#secretkeyselector-v1-core">SecretKeySelector</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ExternalConfigurationVolumeSource-reference"><a class="link" href="#type-ExternalConfigurationVolumeSource-reference">B.96. <code>ExternalConfigurationVolumeSource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configMap</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a ConfigMap. Exactly one Secret or ConfigMap has to be specified. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#configmapvolumesource-v1-core">core/v1 configmapvolumesource</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#configmapvolumesource-v1-core">ConfigMapVolumeSource</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of the volume which will be added to the Kafka Connect pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Reference to a key in a Secret. Exactly one Secret or ConfigMap has to be specified. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#secretvolumesource-v1-core">core/v1 secretvolumesource</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#secretvolumesource-v1-core">SecretVolumeSource</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectStatus-reference"><a class="link" href="#type-KafkaConnectStatus-reference">B.97. <code>KafkaConnectStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnect-reference"><code>KafkaConnect</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPlugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The list of connector plugins available in this Kafka Connect deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ConnectorPlugin-reference"><code>ConnectorPlugin</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Label selector for pods providing this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The current number of pods being used to provide this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-ConnectorPlugin-reference"><a class="link" href="#type-ConnectorPlugin-reference">B.98. <code>ConnectorPlugin</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2IStatus-reference"><code>KafkaConnectS2IStatus</code></a>, <a href="#type-KafkaConnectStatus-reference"><code>KafkaConnectStatus</code></a>, <a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The type of the connector plugin. The available types are <code>sink</code> and <code>source</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The version of the connector plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The class of the connector plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2I-reference"><a class="link" href="#type-KafkaConnectS2I-reference">B.99. <code>KafkaConnectS2I</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Connect Source-to-Image (S2I) cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2ISpec-reference"><code>KafkaConnectS2ISpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Connect Source-to-Image (S2I) cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectS2IStatus-reference"><code>KafkaConnectS2IStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2ISpec-reference"><a class="link" href="#type-KafkaConnectS2ISpec-reference">B.100. <code>KafkaConnectS2ISpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code></a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka Connect cluster with Source-to-Image (S2I) support.</p>
</div>
<div class="paragraph">
<p>When extending Kafka Connect with connector plugins on OpenShift (only),
you can use OpenShift builds and S2I to create a container image that is used by the Kafka Connect deployment.</p>
</div>
<div class="paragraph">
<p>The configuration options are similar to Kafka Connect configuration using the <a href="#type-KafkaConnectSpec-reference"><code>KafkaConnectSpec</code> schema</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the Kafka Connect group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildResources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect and Kafka Connect S2I resources. The template allows users to specify how the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for Kafka Connect. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Bootstrap servers to connect to. This should be given as a comma separated list of <em>&lt;hostname&gt;</em>:<em>&lt;port&gt;</em> pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clientRackInitImage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The image of the init container used for initializing the <code>client.rack</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect configuration. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">insecureSourceRepository</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">When true this configures the source repository with the 'Local' reference policy and an import policy that accepts insecure source tags.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the node label which will be used as the client.rack consumer configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Rack-reference"><code>Rack</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum limits for CPU and memory resources and the requested initial resources. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTls-reference"><code>KafkaConnectTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect version. Defaults to 2.6.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectS2IStatus-reference"><a class="link" href="#type-KafkaConnectS2IStatus-reference">B.101. <code>KafkaConnectS2IStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnectS2I-reference"><code>KafkaConnectS2I</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPlugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The list of connector plugins available in this Kafka Connect deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ConnectorPlugin-reference"><code>ConnectorPlugin</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildConfigName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the build configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Label selector for pods providing this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The current number of pods being used to provide this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopic-reference"><a class="link" href="#type-KafkaTopic-reference">B.102. <code>KafkaTopic</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the topic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicSpec-reference"><code>KafkaTopicSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the topic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaTopicStatus-reference"><code>KafkaTopicStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopicSpec-reference"><a class="link" href="#type-KafkaTopicSpec-reference">B.103. <code>KafkaTopicSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">partitions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of partitions the topic should have. This cannot be decreased after topic creation. It can be increased after topic creation, but it is important to understand the consequences that has, especially for topics with semantic partitioning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of replicas the topic should have.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The topic configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicName</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of the topic. When absent this will default to the metadata.name of the topic. It is recommended to not set this unless the topic name is not a valid Kubernetes resource name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaTopicStatus-reference"><a class="link" href="#type-KafkaTopicStatus-reference">B.104. <code>KafkaTopicStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaTopic-reference"><code>KafkaTopic</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUser-reference"><a class="link" href="#type-KafkaUser-reference">B.105. <code>KafkaUser</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka User.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserStatus-reference"><code>KafkaUserStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserSpec-reference"><a class="link" href="#type-KafkaUserSpec-reference">B.106. <code>KafkaUserSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication mechanism enabled for this Kafka user. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>, <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authorization</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authorization rules for this Kafka user. The type depends on the value of the <code>authorization.type</code> property within the given object, which must be one of [simple].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">quotas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Quotas on requests to control the broker resources used by clients. Network bandwidth and request rate quotas can be enforced.Kafka documentation for Kafka User quotas can be found at <a href="http://kafka.apache.org/documentation/#design_quotas" class="bare">http://kafka.apache.org/documentation/#design_quotas</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserQuotas-reference"><code>KafkaUserQuotas</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template to specify how Kafka User <code>Secrets</code> are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaUserTemplate-reference"><code>KafkaUserTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserTlsClientAuthentication-reference"><a class="link" href="#type-KafkaUserTlsClientAuthentication-reference">B.107. <code>KafkaUserTlsClientAuthentication</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserTlsClientAuthentication</code> from <a href="#type-KafkaUserScramSha512ClientAuthentication-reference"><code>KafkaUserScramSha512ClientAuthentication</code></a>.
It must have the value <code>tls</code> for the type <code>KafkaUserTlsClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserScramSha512ClientAuthentication-reference"><a class="link" href="#type-KafkaUserScramSha512ClientAuthentication-reference">B.108. <code>KafkaUserScramSha512ClientAuthentication</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserScramSha512ClientAuthentication</code> from <a href="#type-KafkaUserTlsClientAuthentication-reference"><code>KafkaUserTlsClientAuthentication</code></a>.
It must have the value <code>scram-sha-512</code> for the type <code>KafkaUserScramSha512ClientAuthentication</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>scram-sha-512</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserAuthorizationSimple-reference"><a class="link" href="#type-KafkaUserAuthorizationSimple-reference">B.109. <code>KafkaUserAuthorizationSimple</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>KafkaUserAuthorizationSimple</code> from other subtypes which may be added in the future.
It must have the value <code>simple</code> for the type <code>KafkaUserAuthorizationSimple</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>simple</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of ACL rules which should be applied to this user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRule-reference"><code>AclRule</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRule-reference"><a class="link" href="#type-AclRule-reference">B.110. <code>AclRule</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserAuthorizationSimple-reference"><code>KafkaUserAuthorizationSimple</code></a></p>
</div>
<div class="paragraph">
<p>Configures access control rule for a <code>KafkaUser</code> when brokers are using the <code>AclAuthorizer</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaUser</code> configuration with authorization</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  # ...
  authorization:
    type: simple
    acls:
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Read
      - resource:
          type: topic
          name: my-topic
          patternType: literal
        operation: Describe
      - resource:
          type: group
          name: my-group
          patternType: prefix
        operation: Read</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="property-acl-resource-reference"><a class="link" href="#property-acl-resource-reference">B.110.1. <code>resource</code></a></h4>
<div class="paragraph">
<p>Use the <code>resource</code> property to specify the resource that the rule applies to.</p>
</div>
<div class="paragraph">
<p>Simple authorization supports four resource types, which are specified in the <code>type</code> property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Topics (<code>topic</code>)</p>
</li>
<li>
<p>Consumer Groups (<code>group</code>)</p>
</li>
<li>
<p>Clusters (<code>cluster</code>)</p>
</li>
<li>
<p>Transactional IDs (<code>transactionalId</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Topic, Group, and Transactional ID resources you can specify the name of the resource the rule applies to in the <code>name</code> property.</p>
</div>
<div class="paragraph">
<p>Cluster type resources have no name.</p>
</div>
<div class="paragraph">
<p>A name is specified as a <code>literal</code> or a <code>prefix</code> using the <code>patternType</code> property.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Literal names are taken exactly as they are specified in the <code>name</code> field.</p>
</li>
<li>
<p>Prefix names use the value from the <code>name</code> as a prefix, and will apply the rule to all resources with names starting with the value.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="property-acl-type-reference"><a class="link" href="#property-acl-type-reference">B.110.2. <code>type</code></a></h4>
<div class="paragraph">
<p>The <code>type</code> of rule, which is to <code>allow</code> or <code>deny</code> (not currently supported) an operation.</p>
</div>
<div class="paragraph">
<p>The <code>type</code> field is optional.
If <code>type</code> is unspecified, the ACL rule is treated as an <code>allow</code> rule.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-acl-operation-reference"><a class="link" href="#property-acl-operation-reference">B.110.3. <code>operation</code></a></h4>
<div class="paragraph">
<p>Specify an <code>operation</code> for the rule to allow or deny.</p>
</div>
<div class="paragraph">
<p>The following operations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read</p>
</li>
<li>
<p>Write</p>
</li>
<li>
<p>Delete</p>
</li>
<li>
<p>Alter</p>
</li>
<li>
<p>Describe</p>
</li>
<li>
<p>All</p>
</li>
<li>
<p>IdempotentWrite</p>
</li>
<li>
<p>ClusterAction</p>
</li>
<li>
<p>Create</p>
</li>
<li>
<p>AlterConfigs</p>
</li>
<li>
<p>DescribeConfigs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only certain operations work with each resource.</p>
</div>
<div class="paragraph">
<p>For more details about <code>AclAuthorizer</code>, ACLs and supported combinations of resources and operations, see <a href="http://kafka.apache.org/documentation/#security_authz" target="_blank" rel="noopener">Authorization and ACLs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-acl-host-reference"><a class="link" href="#property-acl-host-reference">B.110.4. <code>host</code></a></h4>
<div class="paragraph">
<p>Use the <code>host</code> property to specify a remote host from which the rule is allowed or denied.</p>
</div>
<div class="paragraph">
<p>Use an asterisk (<code>*</code>) to allow or deny the operation from all hosts.
The <code>host</code> field is optional. If <code>host</code> is unspecified, the <code>*</code> value is used by default.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The host from which the action described in the ACL rule is allowed or denied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Operation which will be allowed or denied. Supported operations are: Read, Write, Create, Delete, Alter, Describe, ClusterAction, AlterConfigs, DescribeConfigs, IdempotentWrite and All.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [Read, Write, Delete, Alter, Describe, All, IdempotentWrite, ClusterAction, Create, AlterConfigs, DescribeConfigs])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Indicates the resource for which given ACL rule applies. The type depends on the value of the <code>resource.type</code> property within the given object, which must be one of [topic, group, cluster, transactionalId].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The type of the rule. Currently the only supported type is <code>allow</code>. ACL rules with type <code>allow</code> are used to allow user to execute the specified operations. Default value is <code>allow</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [allow, deny])</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-AclRuleTopicResource-reference"><a class="link" href="#type-AclRuleTopicResource-reference">B.111. <code>AclRuleTopicResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleTopicResource</code> from <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>topic</code> for the type <code>AclRuleTopicResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>topic</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleGroupResource-reference"><a class="link" href="#type-AclRuleGroupResource-reference">B.112. <code>AclRuleGroupResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleGroupResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>group</code> for the type <code>AclRuleGroupResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>group</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full topic name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleClusterResource-reference"><a class="link" href="#type-AclRuleClusterResource-reference">B.113. <code>AclRuleClusterResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleClusterResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleTransactionalIdResource-reference"><code>AclRuleTransactionalIdResource</code></a>.
It must have the value <code>cluster</code> for the type <code>AclRuleClusterResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>cluster</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-AclRuleTransactionalIdResource-reference"><a class="link" href="#type-AclRuleTransactionalIdResource-reference">B.114. <code>AclRuleTransactionalIdResource</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-AclRule-reference"><code>AclRule</code></a></p>
</div>
<div class="paragraph">
<p>The <code>type</code> property is a discriminator that distinguishes the use of the type <code>AclRuleTransactionalIdResource</code> from <a href="#type-AclRuleTopicResource-reference"><code>AclRuleTopicResource</code></a>, <a href="#type-AclRuleGroupResource-reference"><code>AclRuleGroupResource</code></a>, <a href="#type-AclRuleClusterResource-reference"><code>AclRuleClusterResource</code></a>.
It must have the value <code>transactionalId</code> for the type <code>AclRuleTransactionalIdResource</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Must be <code>transactionalId</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Name of resource for which given ACL rule applies. Can be combined with <code>patternType</code> field to use prefix pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">patternType</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Describes the pattern used in the resource field. The supported types are <code>literal</code> and <code>prefix</code>. With <code>literal</code> pattern type, the resource field will be used as a definition of a full name. With <code>prefix</code> pattern type, the resource name will be used only as a prefix. Default value is <code>literal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string (one of [prefix, literal])</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserQuotas-reference"><a class="link" href="#type-KafkaUserQuotas-reference">B.115. <code>KafkaUserQuotas</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>Kafka allows a user to set <code>quotas</code> to control the use of resources by clients.</p>
</div>
<div class="sect3">
<h4 id="quotas"><a class="link" href="#quotas">B.115.1. <code>quotas</code></a></h4>
<div class="paragraph">
<p>Quotas split into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Network usage</em> quotas, which are defined as the byte rate threshold for each group of clients sharing a quota</p>
</li>
<li>
<p><em>CPU utilization</em> quotas, which are defined as the percentage of time a client can utilize on request handler I/O threads and network threads of each broker within a quota window</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using quotas for Kafka clients might be useful in a number of situations.
Consider a wrongly configured Kafka producer which is sending requests at too high a rate.
Such misconfiguration can cause a denial of service to other clients, so the problematic client ought to be blocked.
By using a network limiting quota, it is possible to prevent this situation from significantly impacting other clients.</p>
</div>
<div class="paragraph">
<p>Strimzi supports user-level quotas, but not client-level quotas.</p>
</div>
<div class="listingblock">
<div class="title">An example Kafka user quotas</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">spec:
  quotas:
    producerByteRate: 1048576
    consumerByteRate: 2097152
    requestPercentage: 55</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more info about Kafka user quotas, refer to the <a href="http://kafka.apache.org/documentation/#design_quotas" target="_blank" rel="noopener">Apache Kafka documentation</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumerByteRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A quota on the maximum bytes per-second that each client group can fetch from a broker before the clients in the group are throttled. Defined on a per-broker basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producerByteRate</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A quota on the maximum bytes per-second that each client group can publish to a broker before the clients in the group are throttled. Defined on a per-broker basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requestPercentage</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A quota on the maximum CPU utilization of each client group as a percentage of network and I/O threads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaUserTemplate-reference"><a class="link" href="#type-KafkaUserTemplate-reference">B.116. <code>KafkaUserTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUserSpec-reference"><code>KafkaUserSpec</code></a></p>
</div>
<div class="paragraph">
<p>Specify additional labels and annotations for the secret created by the User Operator.</p>
</div>
<div class="listingblock">
<div class="title">An example showing the <code>KafkaUserTemplate</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaUser
metadata:
  name: my-user
  labels:
    strimzi.io/cluster: my-cluster
spec:
  authentication:
    type: tls
  template:
    secret:
      metadata:
        labels:
          label1: value1
        annotations:
          anno1: value1
  # ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for KafkaUser resources. The template allows users to specify how the <code>Secret</code> with password or TLS certificates is generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaUserStatus-reference"><a class="link" href="#type-KafkaUserStatus-reference">B.117. <code>KafkaUserStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaUser-reference"><code>KafkaUser</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Username.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The name of <code>Secret</code> where the credentials are stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker-reference"><a class="link" href="#type-KafkaMirrorMaker-reference">B.118. <code>KafkaMirrorMaker</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of Kafka MirrorMaker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of Kafka MirrorMaker.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerStatus-reference"><code>KafkaMirrorMakerStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerSpec-reference">B.119. <code>KafkaMirrorMakerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<div class="paragraph">
<p>Configures Kafka MirrorMaker.</p>
</div>
<div class="sect3">
<h4 id="property-mm-whitelist-reference"><a class="link" href="#property-mm-whitelist-reference">B.119.1. <code>whitelist</code></a></h4>
<div class="paragraph">
<p>Use the <code>whitelist</code> property to configure a list of topics that Kafka MirrorMaker mirrors from the source to the target Kafka cluster.</p>
</div>
<div class="paragraph">
<p>The property allows any regular expression from the simplest case with a single topic name to complex patterns.
For example, you can mirror topics A and B using "A|B" or all topics using "*".
You can also pass multiple regular expressions separated by commas to the Kafka MirrorMaker.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-mm-producer-consumer-reference"><a class="link" href="#property-mm-producer-consumer-reference">B.119.2. <code>KafkaMirrorMakerConsumerSpec</code> and <code>KafkaMirrorMakerProducerSpec</code></a></h4>
<div class="paragraph">
<p>Use the <code>KafkaMirrorMakerConsumerSpec</code> and <code>KafkaMirrorMakerProducerSpec</code> to configure source (consumer) and target (producer) clusters.</p>
</div>
<div class="paragraph">
<p>Kafka MirrorMaker always works together with two Kafka clusters (source and target).
To establish a connection, the bootstrap servers for the source and the target Kafka clusters are specified as comma-separated lists of <code><em>HOSTNAME:PORT</em></code> pairs.
Each comma-separated list contains one or more Kafka brokers or a <code>Service</code> pointing to Kafka brokers specified as a <code><em>HOSTNAME:PORT</em></code> pair.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-mm-loggers-reference"><a class="link" href="#property-mm-loggers-reference">B.119.3. <code>logging</code></a></h4>
<div class="paragraph">
<p>Kafka MirrorMaker has its own configurable logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mirrormaker.root.logger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>MirrorMaker uses the Apache <code>log4j</code> logger implementation.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration. Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: inline
    loggers:
      mirrormaker.root.logger: "INFO"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaMirrorMaker
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">whitelist</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of topics which are included for mirroring. This option allows any regular expression using Java-style regular expressions. Mirroring two topics named A and B is achieved by using the whitelist <code>'A|B'</code>. Or, as a special case, you can mirror all topics using the whitelist '*'. You can also specify multiple regular expressions separated by commas.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of source cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of target cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for MirrorMaker. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="noopener">JMX Exporter documentation</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka MirrorMaker. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template to specify how Kafka MirrorMaker resources, <code>Deployments</code> and <code>Pods</code>, are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTemplate-reference"><code>KafkaMirrorMakerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka MirrorMaker version. Defaults to 2.6.0. Consult the documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerConsumerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerConsumerSpec-reference">B.120. <code>KafkaMirrorMakerConsumerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures a MirrorMaker consumer.</p>
</div>
<div class="sect3">
<h4 id="property-consumer-streams-reference"><a class="link" href="#property-consumer-streams-reference">B.120.1. <code>numStreams</code></a></h4>
<div class="paragraph">
<p>Use the <code>consumer.numStreams</code> property to configure the number of streams for the consumer.</p>
</div>
<div class="paragraph">
<p>You can increase the throughput in mirroring topics by increasing the number of consumer threads.
Consumer threads belong to the consumer group specified for Kafka MirrorMaker.
Topic partitions are assigned across the consumer threads, which consume messages in parallel.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-consumer-offset-autocommit-reference"><a class="link" href="#property-consumer-offset-autocommit-reference">B.120.2. <code>offsetCommitInterval</code></a></h4>
<div class="paragraph">
<p>Use the <code>consumer.offsetCommitInterval</code> property to configure an offset auto-commit interval for the consumer.</p>
</div>
<div class="paragraph">
<p>You can specify the regular time interval at which an offset is committed after Kafka MirrorMaker has consumed data from the source Kafka cluster.
The time interval is set in milliseconds, with a default value of 60,000.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-consumer-config-reference"><a class="link" href="#property-consumer-config-reference">B.120.3. <code>config</code></a></h4>
<div class="paragraph">
<p>Use the <code>consumer.config</code> properties to configure Kafka options for the consumer.</p>
</div>
<div class="paragraph">
<p>The <code>config</code> property contains the Kafka MirrorMaker consumer configuration options as keys, with values set in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
<div class="paragraph">
<p><strong>Exceptions</strong></p>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/documentation/#consumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a>.</p>
</div>
<div class="paragraph">
<p>However, there are exceptions for options automatically configured and managed directly by Strimzi related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (encryption, authentication, and authorization)</p>
</li>
<li>
<p>Consumer group identifier</p>
</li>
<li>
<p>Interceptors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
<li>
<p><code>interceptor.classes</code></p>
</li>
<li>
<p><code>ssl.</code> (<a href="#con-common-configuration-ssl-reference">not including specific exceptions</a>)</p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka MirrorMaker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When an invalid configuration is provided, the Kafka MirrorMaker might not start or might become unstable.
In such cases, the configuration in the <code>KafkaMirrorMaker.spec.consumer.config</code> object should be fixed and the Cluster Operator will roll out the new configuration for Kafka MirrorMaker.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="property-consumer-group-reference"><a class="link" href="#property-consumer-group-reference">B.120.4. <code>groupId</code></a></h4>
<div class="paragraph">
<p>Use the <code>consumer.groupId</code> property to configure a consumer group identifier for the consumer.</p>
</div>
<div class="paragraph">
<p>Kafka MirrorMaker uses a Kafka consumer to consume messages, behaving like any other Kafka consumer client.
Messages consumed from the source Kafka cluster are mirrored to a target Kafka cluster.
A group identifier is required, as the consumer needs to be part of a consumer group for the assignment of partitions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">numStreams</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies the number of consumer stream threads to create.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">offsetCommitInterval</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Specifies the offset auto-commit interval in ms. Default value is 60000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A unique string that identifies the consumer group this consumer belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The MirrorMaker consumer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security., interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting MirrorMaker to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerTls-reference"><a class="link" href="#type-KafkaMirrorMakerTls-reference">B.121. <code>KafkaMirrorMakerTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerConsumerSpec-reference"><code>KafkaMirrorMakerConsumerSpec</code></a>, <a href="#type-KafkaMirrorMakerProducerSpec-reference"><code>KafkaMirrorMakerProducerSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures TLS trusted certificates for connecting MirrorMaker to the cluster.</p>
</div>
<div class="sect3">
<h4 id="trustedcertificates_2"><a class="link" href="#trustedcertificates_2">B.121.1. <code>trustedCertificates</code></a></h4>
<div class="paragraph">
<p>Provide a list of secrets using the <a href="#con-common-configuration-trusted-certificates-reference"><code>trustedCertificates</code> property</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerProducerSpec-reference"><a class="link" href="#type-KafkaMirrorMakerProducerSpec-reference">B.122. <code>KafkaMirrorMakerProducerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures a MirrorMaker producer.</p>
</div>
<div class="sect3">
<h4 id="property-producer-abort-on-send-reference"><a class="link" href="#property-producer-abort-on-send-reference">B.122.1. <code>abortOnSendFailure</code></a></h4>
<div class="paragraph">
<p>Use the <code>producer.abortOnSendFailure</code> property to configure how to handle message send failure from the producer.</p>
</div>
<div class="paragraph">
<p>By default, if an error occurs when sending a message from Kafka MirrorMaker to a Kafka cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Kafka MirrorMaker container is terminated in Kubernetes.</p>
</li>
<li>
<p>The container is then recreated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>abortOnSendFailure</code> option is set to <code>false</code>, message sending errors are ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="property-producer-config-reference"><a class="link" href="#property-producer-config-reference">B.122.2. <code>config</code></a></h4>
<div class="paragraph">
<p>Use the <code>producer.config</code> properties to configure Kafka options for the producer.</p>
</div>
<div class="paragraph">
<p>The <code>config</code> property contains the Kafka MirrorMaker producer configuration options as keys, with values set in one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
<div class="paragraph">
<p><strong>Exceptions</strong></p>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/documentation/#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a>.</p>
</div>
<div class="paragraph">
<p>However, there are exceptions for options automatically configured and managed directly by Strimzi related to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (encryption, authentication, and authorization)</p>
</li>
<li>
<p>Interceptors</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>interceptor.classes</code></p>
</li>
<li>
<p><code>ssl.</code> (<a href="#con-common-configuration-ssl-reference">not including specific exceptions</a>)</p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a forbidden option is present in the <code>config</code> property, it is ignored and a warning message is printed to the Cluster Operator log file.
All other options are passed to Kafka MirrorMaker.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the provided <code>config</code> object.
When an invalid configuration is provided, the Kafka MirrorMaker might not start or might become unstable.
In such cases, the configuration in the <code>KafkaMirrorMaker.spec.producer.config</code> object should be fixed and the Cluster Operator will roll out the new configuration for Kafka MirrorMaker.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">abortOnSendFailure</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Flag to set the MirrorMaker to exit on a failed send. Default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The MirrorMaker producer config. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security., interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting MirrorMaker to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMakerTls-reference"><code>KafkaMirrorMakerTls</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerTemplate-reference"><a class="link" href="#type-KafkaMirrorMakerTemplate-reference">B.123. <code>KafkaMirrorMakerTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMakerSpec-reference"><code>KafkaMirrorMakerSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka MirrorMaker <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka MirrorMaker <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mirrorMakerContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka MirrorMaker container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka MirrorMaker <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMakerStatus-reference"><a class="link" href="#type-KafkaMirrorMakerStatus-reference">B.124. <code>KafkaMirrorMakerStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker-reference"><code>KafkaMirrorMaker</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Label selector for pods providing this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The current number of pods being used to provide this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridge-reference"><a class="link" href="#type-KafkaBridge-reference">B.125. <code>KafkaBridge</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeStatus-reference"><code>KafkaBridgeStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeSpec-reference"><a class="link" href="#type-KafkaBridgeSpec-reference">B.126. <code>KafkaBridgeSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<div class="paragraph">
<p>Configures a Kafka Bridge cluster.</p>
</div>
<div class="paragraph">
<p>Configuration options relate to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka cluster bootstrap address</p>
</li>
<li>
<p>Security (Encryption, Authentication, and Authorization)</p>
</li>
<li>
<p>Consumer configuration</p>
</li>
<li>
<p>Producer configuration</p>
</li>
<li>
<p>HTTP configuration</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="property-kafka-bridge-logging-reference"><a class="link" href="#property-kafka-bridge-logging-reference">B.126.1. <code>logging</code></a></h4>
<div class="paragraph">
<p>Kafka Bridge has its own configurable loggers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>logger.bridge</code></p>
</li>
<li>
<p><code>logger.<em>&lt;operation-id&gt;</em></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can replace <code><em>&lt;operation-id&gt;</em></code> in the <code>logger.<em>&lt;operation-id&gt;</em></code> logger to set log levels for specific operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>createConsumer</code></p>
</li>
<li>
<p><code>deleteConsumer</code></p>
</li>
<li>
<p><code>subscribe</code></p>
</li>
<li>
<p><code>unsubscribe</code></p>
</li>
<li>
<p><code>poll</code></p>
</li>
<li>
<p><code>assign</code></p>
</li>
<li>
<p><code>commit</code></p>
</li>
<li>
<p><code>send</code></p>
</li>
<li>
<p><code>sendToPartition</code></p>
</li>
<li>
<p><code>seekToBeginning</code></p>
</li>
<li>
<p><code>seekToEnd</code></p>
</li>
<li>
<p><code>seek</code></p>
</li>
<li>
<p><code>healthy</code></p>
</li>
<li>
<p><code>ready</code></p>
</li>
<li>
<p><code>openapi</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each operation is defined according OpenAPI specification, and has a corresponding API endpoint through which the bridge receives requests from HTTP clients.
You can change the log level on each endpoint to create fine-grained logging information about the incoming and outgoing HTTP requests.</p>
</div>
<div class="paragraph">
<p>Each logger has to be configured assigning it a <code>name</code> as <code>http.openapi.operation.<em>&lt;operation-id&gt;</em></code>.
For example, configuring the logging level for the <code>send</code> operation logger means defining the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logger.send.name = http.openapi.operation.send
logger.send.level = DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kafka Bridge uses the Apache <code>log4j2</code> logger implementation.
Loggers are defined in the <code>log4j2.properties</code> file, which has the following default configuration for <code>healthy</code> and <code>ready</code> endpoints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">logger.healthy.name = http.openapi.operation.healthy
logger.healthy.level = WARN
logger.ready.name = http.openapi.operation.ready
logger.ready.level = WARN</code></pre>
</div>
</div>
<div class="paragraph">
<p>The log level of all other operations is set to <code>INFO</code> by default.</p>
</div>
<div class="paragraph">
<p>Use the <code>logging</code> property to configure loggers and logger levels.</p>
</div>
<div class="paragraph">
<p>You can set the log levels by specifying the logger and level directly (inline) or use a custom (external) ConfigMap.
If a ConfigMap is used, you set <code>logging.name</code> property to the name of the ConfigMap containing the external logging configuration.
Inside the ConfigMap, the logging configuration is described using <code>log4j.properties</code>.
For more information about log levels, see <a href="https://logging.apache.org/" target="_blank" rel="noopener">Apache logging services</a>.</p>
</div>
<div class="paragraph">
<p>Here we see examples of <code>inline</code> and <code>external</code> logging.</p>
</div>
<div class="listingblock">
<div class="title">Inline logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
spec:
  # ...
  logging:
    type: inline
    loggers:
      logger.bridge.level: "INFO"
      # enabling DEBUG just for send operation
      logger.send.name: "http.openapi.operation.send"
      logger.send.level: "DEBUG"
  # ...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External logging</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1beta1
kind: KafkaBridge
spec:
  # ...
  logging:
    type: external
    name: customConfigMap
  # ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any available loggers that are not configured have their level set to <code>OFF</code>.</p>
</div>
<div class="paragraph">
<p>If the Kafka Bridge was deployed using the Cluster Operator,
changes to Kafka Bridge logging levels are applied dynamically.</p>
</div>
<div class="paragraph">
<p>If you use external logging, a rolling update is triggered when logging appenders are changed.</p>
</div>
<div class="paragraph">
<div class="title">Garbage collector (GC)</div>
<p>Garbage collector logging can also be enabled (or disabled) using the <a href="#con-common-configuration-garbage-collection-reference"><code>jvmOptions</code> property</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of host:port pairs for establishing the initial connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting Kafka Bridge to the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeTls-reference"><code>KafkaBridgeTls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">http</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The HTTP related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeHttpConfig-reference"><code>KafkaBridgeHttpConfig</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">consumer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka consumer related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeConsumerSpec-reference"><code>KafkaBridgeConsumerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">producer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka producer related configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeProducerSpec-reference"><code>KafkaBridgeProducerSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CPU and memory resources to reserve. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>Currently not supported</strong> JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Bridge. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enableMetrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Enable the metrics for the Kafka Bridge. Default is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge resources. The template allows users to specify how is the <code>Deployment</code> and <code>Pods</code> generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeTemplate-reference"><code>KafkaBridgeTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Bridge. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeTls-reference"><a class="link" href="#type-KafkaBridgeTls-reference">B.127. <code>KafkaBridgeTls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeHttpConfig-reference"><a class="link" href="#type-KafkaBridgeHttpConfig-reference">B.128. <code>KafkaBridgeHttpConfig</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures HTTP access to a Kafka cluster for the Kafka Bridge.</p>
</div>
<div class="paragraph">
<p>The default HTTP configuration is for the Kafka Bridge to listen on port 8080.</p>
</div>
<div class="sect3">
<h4 id="property-kafka-bridge-cors-config-reference"><a class="link" href="#property-kafka-bridge-cors-config-reference">B.128.1. <code>cors</code></a></h4>
<div class="paragraph">
<p>As well as enabling HTTP access to a Kafka cluster, HTTP properties provide the capability to enable and define access control for the Kafka Bridge through Cross-Origin Resource Sharing (CORS).
CORS is a HTTP mechanism that allows browser access to selected resources from more than one origin.
To configure CORS, you define a list of allowed resource origins and HTTP access methods.
For the origins, you can use a URL or a Java regular expression.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge HTTP configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  http:
    port: 8080
    cors:
      allowedOrigins: "https://strimzi.io"
      allowedMethods: "GET,POST,PUT,DELETE,OPTIONS,PATCH"
  # ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The port which is the server listening on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">CORS configuration for the HTTP Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaBridgeHttpCors-reference"><code>KafkaBridgeHttpCors</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeHttpCors-reference"><a class="link" href="#type-KafkaBridgeHttpCors-reference">B.129. <code>KafkaBridgeHttpCors</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeHttpConfig-reference"><code>KafkaBridgeHttpConfig</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedOrigins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of allowed origins. Java regular expressions can be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedMethods</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of allowed HTTP methods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeConsumerSpec-reference"><a class="link" href="#type-KafkaBridgeConsumerSpec-reference">B.130. <code>KafkaBridgeConsumerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures consumer options for the Kafka Bridge as keys.</p>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/documentation/#consumerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for consumers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
<li>
<p><code>group.id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message will be printed to the Cluster Operator log file.
All other options will be passed to Kafka</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object.
If an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
Fix the configuration so that the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge consumer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  consumer:
    config:
      auto.offset.reset: earliest
      enable.auto.commit: true
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS
    # ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka consumer configuration used for consumer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, group.id, sasl., security. (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeProducerSpec-reference"><a class="link" href="#type-KafkaBridgeProducerSpec-reference">B.131. <code>KafkaBridgeProducerSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<div class="paragraph">
<p>Configures producer options for the Kafka Bridge as keys.</p>
</div>
<div class="paragraph">
<p>The values can be one of the following JSON types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Number</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify and configure the options listed in the <a href="http://kafka.apache.org/documentation/#producerconfigs" target="_blank" rel="noopener">Apache Kafka configuration documentation for producers</a> with the exception of those options which are managed directly by Strimzi.
Specifically, all configuration options with keys equal to or starting with one of the following strings are forbidden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ssl.</code></p>
</li>
<li>
<p><code>sasl.</code></p>
</li>
<li>
<p><code>security.</code></p>
</li>
<li>
<p><code>bootstrap.servers</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When one of the forbidden options is present in the <code>config</code> property, it is ignored and a warning message will be printed to the Cluster Operator log file.
All other options will be passed to Kafka</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Cluster Operator does not validate keys or values in the <code>config</code> object.
If an invalid configuration is provided, the Kafka Bridge cluster might not start or might become unstable.
Fix the configuration so that the Cluster Operator can roll out the new configuration to all Kafka Bridge nodes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are exceptions to the forbidden options.
For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example Kafka Bridge producer configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="yaml" class="language-yaml hljs">apiVersion: kafka.strimzi.io/v1alpha1
kind: KafkaBridge
metadata:
  name: my-bridge
spec:
  # ...
  producer:
    config:
      acks: 1
      delivery.timeout.ms: 300000
      ssl.cipher.suites: "TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"
      ssl.enabled.protocols: "TLSv1.2"
      ssl.protocol: "TLSv1.2"
      ssl.endpoint.identification.algorithm: HTTPS
    # ...</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka producer configuration used for producer instances created by the bridge. Properties with the following prefixes cannot be set: ssl., bootstrap.servers, sasl., security. (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeTemplate-reference"><a class="link" href="#type-KafkaBridgeTemplate-reference">B.132. <code>KafkaBridgeTemplate</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridgeSpec-reference"><code>KafkaBridgeSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deployment</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>Deployment</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pod</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>Pods</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodTemplate-reference"><code>PodTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apiService</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge API <code>Service</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ResourceTemplate-reference"><code>ResourceTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bridgeContainer</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for the Kafka Bridge container.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ContainerTemplate-reference"><code>ContainerTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">podDisruptionBudget</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Bridge <code>PodDisruptionBudget</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-PodDisruptionBudgetTemplate-reference"><code>PodDisruptionBudgetTemplate</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaBridgeStatus-reference"><a class="link" href="#type-KafkaBridgeStatus-reference">B.133. <code>KafkaBridgeStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaBridge-reference"><code>KafkaBridge</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL at which external client applications can access the Kafka Bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Label selector for pods providing this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The current number of pods being used to provide this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnector-reference"><a class="link" href="#type-KafkaConnector-reference">B.134. <code>KafkaConnector</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectorSpec-reference"><code>KafkaConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectorStatus-reference"><code>KafkaConnectorStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectorSpec-reference"><a class="link" href="#type-KafkaConnectorSpec-reference">B.135. <code>KafkaConnectorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnector-reference"><code>KafkaConnector</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Class for the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of tasks for the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connector configuration. The following properties cannot be set: connector.class, tasks.max.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pause</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Whether the connector should be paused. Defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaConnectorStatus-reference"><a class="link" href="#type-KafkaConnectorStatus-reference">B.136. <code>KafkaConnectorStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaConnector-reference"><code>KafkaConnector</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorStatus</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The connector status, as reported by the Kafka Connect REST API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of tasks for the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2-reference"><a class="link" href="#type-KafkaMirrorMaker2-reference">B.137. <code>KafkaMirrorMaker2</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka MirrorMaker 2.0 cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka MirrorMaker 2.0 cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2Status-reference"><code>KafkaMirrorMaker2Status</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2Spec-reference"><a class="link" href="#type-KafkaMirrorMaker2Spec-reference">B.138. <code>KafkaMirrorMaker2Spec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The number of pods in the Kafka Connect group.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">version</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connect version. Defaults to 2.6.0. Consult the user documentation to understand the process required to upgrade or downgrade the version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The docker image for the pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The cluster alias used for Kafka Connect. The alias must match a cluster in the list at <code>spec.clusters</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clusters</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Kafka clusters for mirroring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mirrors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Configuration of the MirrorMaker 2.0 connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2MirrorSpec-reference"><code>KafkaMirrorMaker2MirrorSpec</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resources</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum limits for CPU and memory resources and the requested initial resources. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">core/v1 resourcerequirements</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#resourcerequirements-v1-core">ResourceRequirements</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">livenessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod liveness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">readinessProbe</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pod readiness checking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Probe-reference"><code>Probe</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmOptions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">JVM Options for pods.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JvmOptions-reference"><code>JvmOptions</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">affinity</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>affinity</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.affinity</code>.</strong> The pod&#8217;s affinity rules. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">core/v1 affinity</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#affinity-v1-core">Affinity</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tolerations</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>The property <code>tolerations</code> has been deprecated. This feature should now be configured at path <code>spec.template.pod.tolerations</code>.</strong> The pod&#8217;s tolerations. See external documentation of <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">core/v1 toleration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#toleration-v1-core">Toleration</a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Logging configuration for Kafka Connect. The type depends on the value of the <code>logging.type</code> property within the given object, which must be one of [inline, external].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-InlineLogging-reference"><code>InlineLogging</code></a>, <a href="#type-ExternalLogging-reference"><code>ExternalLogging</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Prometheus JMX Exporter configuration. See <a href="https://github.com/prometheus/jmx_exporter" class="bare">https://github.com/prometheus/jmx_exporter</a> for details of the structure of this configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tracing</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The configuration of tracing in Kafka Connect. The type depends on the value of the <code>tracing.type</code> property within the given object, which must be one of [jaeger].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-JaegerTracing-reference"><code>JaegerTracing</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">template</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Template for Kafka Connect and Kafka Connect S2I resources. The template allows users to specify how the <code>Deployment</code>, <code>Pods</code> and <code>Service</code> are generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaConnectTemplate-reference"><code>KafkaConnectTemplate</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">externalConfiguration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Pass data from Secrets or ConfigMaps to the Kafka Connect pods and use them to configure connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ExternalConfiguration-reference"><code>ExternalConfiguration</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2ClusterSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2ClusterSpec-reference">B.139. <code>KafkaMirrorMaker2ClusterSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<div class="paragraph">
<p>Configures Kafka clusters for mirroring.</p>
</div>
<div class="sect3">
<h4 id="property-mirrormaker2-config-reference"><a class="link" href="#property-mirrormaker2-config-reference">B.139.1. <code>config</code></a></h4>
<div class="paragraph">
<p>Use the <code>config</code> properties to configure Kafka options.</p>
</div>
<div class="paragraph">
<p>Standard Apache Kafka configuration may be provided, restricted to those properties not managed directly by Strimzi.</p>
</div>
<div class="paragraph">
<p>For client connection using a specific <em>cipher suite</em> for a TLS version, you can <a href="#con-common-configuration-ssl-reference">configure allowed <code>ssl</code> properties</a>.
You can also <a href="#con-common-configuration-ssl-reference">configure the <code>ssl.endpoint.identification.algorithm</code> property</a> to enable or disable hostname verification.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Alias used to reference the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrapServers</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A comma-separated list of <code>host:port</code> pairs for establishing the connection to the Kafka cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The MirrorMaker 2.0 cluster config. Properties with the following prefixes cannot be set: ssl., sasl., security., listeners, plugin.path, rest., bootstrap.servers, consumer.interceptor.classes, producer.interceptor.classes (with the exception of: ssl.endpoint.identification.algorithm, ssl.cipher.suites, ssl.protocol, ssl.enabled.protocols).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tls</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">TLS configuration for connecting MirrorMaker 2.0 connectors to a cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2Tls-reference"><code>KafkaMirrorMaker2Tls</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Authentication configuration for connecting to the cluster. The type depends on the value of the <code>authentication.type</code> property within the given object, which must be one of [tls, scram-sha-512, plain, oauth].</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaClientAuthenticationTls-reference"><code>KafkaClientAuthenticationTls</code></a>, <a href="#type-KafkaClientAuthenticationScramSha512-reference"><code>KafkaClientAuthenticationScramSha512</code></a>, <a href="#type-KafkaClientAuthenticationPlain-reference"><code>KafkaClientAuthenticationPlain</code></a>, <a href="#type-KafkaClientAuthenticationOAuth-reference"><code>KafkaClientAuthenticationOAuth</code></a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2Tls-reference"><a class="link" href="#type-KafkaMirrorMaker2Tls-reference">B.140. <code>KafkaMirrorMaker2Tls</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2ClusterSpec-reference"><code>KafkaMirrorMaker2ClusterSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trustedCertificates</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Trusted certificates for TLS connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-CertSecretSource-reference"><code>CertSecretSource</code></a> array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2MirrorSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2MirrorSpec-reference">B.141. <code>KafkaMirrorMaker2MirrorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2Spec-reference"><code>KafkaMirrorMaker2Spec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The alias of the source cluster used by the Kafka MirrorMaker 2.0 connectors. The alias must match a cluster in the list at <code>spec.clusters</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targetCluster</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The alias of the target cluster used by the Kafka MirrorMaker 2.0 connectors. The alias must match a cluster in the list at <code>spec.clusters</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourceConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka MirrorMaker 2.0 source connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkpointConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka MirrorMaker 2.0 checkpoint connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heartbeatConnector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka MirrorMaker 2.0 heartbeat connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaMirrorMaker2ConnectorSpec-reference"><code>KafkaMirrorMaker2ConnectorSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicsPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A regular expression matching the topics to be mirrored, for example, "topic1|topic2|topic3". Comma-separated lists are also supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">topicsBlacklistPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A regular expression matching the topics to exclude from mirroring. Comma-separated lists are also supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A regular expression matching the consumer groups to be mirrored. Comma-separated lists are also supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">groupsBlacklistPattern</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A regular expression matching the consumer groups to exclude from mirroring. Comma-separated lists are also supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2ConnectorSpec-reference"><a class="link" href="#type-KafkaMirrorMaker2ConnectorSpec-reference">B.142. <code>KafkaMirrorMaker2ConnectorSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2MirrorSpec-reference"><code>KafkaMirrorMaker2MirrorSpec</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tasksMax</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The maximum number of tasks for the Kafka Connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">config</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The Kafka Connector configuration. The following properties cannot be set: connector.class, tasks.max.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pause</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Whether the connector should be paused. Defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaMirrorMaker2Status-reference"><a class="link" href="#type-KafkaMirrorMaker2Status-reference">B.143. <code>KafkaMirrorMaker2Status</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaMirrorMaker2-reference"><code>KafkaMirrorMaker2</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The URL of the REST API endpoint for managing and monitoring Kafka Connect connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectorPlugins</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The list of connector plugins available in this Kafka Connect deployment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-ConnectorPlugin-reference"><code>ConnectorPlugin</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectors</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of MirrorMaker 2.0 connector statuses, as reported by the Kafka Connect REST API.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">labelSelector</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Label selector for pods providing this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicas</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The current number of pods being used to provide this resource.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaRebalance-reference"><a class="link" href="#type-KafkaRebalance-reference">B.144. <code>KafkaRebalance</code> schema reference</a></h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">spec</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The specification of the Kafka rebalance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaRebalanceSpec-reference"><code>KafkaRebalanceSpec</code></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The status of the Kafka rebalance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-KafkaRebalanceStatus-reference"><code>KafkaRebalanceStatus</code></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaRebalanceSpec-reference"><a class="link" href="#type-KafkaRebalanceSpec-reference">B.145. <code>KafkaRebalanceSpec</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaRebalance-reference"><code>KafkaRebalance</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">goals</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of goals, ordered by decreasing priority, to use for generating and executing the rebalance proposal. The supported goals are available at <a href="https://github.com/linkedin/cruise-control#goals" class="bare">https://github.com/linkedin/cruise-control#goals</a>. If an empty goals list is provided, the goals declared in the default.goals Cruise Control configuration parameter are used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skipHardGoalCheck</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Whether to allow the hard goals specified in the Kafka CR to be skipped in optimization proposal generation. This can be useful when some of those hard goals are preventing a balance solution being found. Default is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludedTopics</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A regular expression where any matching topics will be excluded from the calculation of optimization proposals. This expression will be parsed by the java.util.regex.Pattern class; for more information on the supported formar consult the documentation for that class.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentPartitionMovementsPerBroker</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The upper bound of ongoing partition replica movements going into/out of each broker. Default is 5.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentIntraBrokerPartitionMovements</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The upper bound of ongoing partition replica movements between disks within each broker. Default is 2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrentLeaderMovements</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The upper bound of ongoing partition leadership movements. Default is 1000.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicationThrottle</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The upper bound, in bytes per second, on the bandwidth used to move replicas. There is no limit by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">replicaMovementStrategies</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A list of strategy class names used to determine the execution order for the replica movements in the generated optimization proposal. By default BaseReplicaMovementStrategy is used, which will execute the replica movements in the order that they were generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string array</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="type-KafkaRebalanceStatus-reference"><a class="link" href="#type-KafkaRebalanceStatus-reference">B.146. <code>KafkaRebalanceStatus</code> schema reference</a></h3>
<div class="paragraph">
<p>Used in: <a href="#type-KafkaRebalance-reference"><code>KafkaRebalance</code></a></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditions</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">List of status conditions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#type-Condition-reference"><code>Condition</code></a> array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">observedGeneration</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The generation of the CRD that was last reconciled by the operator.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionId</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">The session identifier for requests to Cruise Control pertaining to this KafkaRebalance resource. This is used by the Kafka Rebalance operator to track the status of ongoing rebalancing operations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optimizationResult</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">A JSON object describing the optimization result.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">map</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-11-13 23:17:57 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview-str">1. Overview of Strimzi</a>
<ul class="sectlevel2">
<li><a href="#key-features-kafka_str">1.1. Kafka capabilities</a></li>
<li><a href="#kafka_use_cases">1.2. Kafka use cases</a></li>
<li><a href="#key-features-product_str">1.3. How Strimzi supports Kafka</a></li>
<li><a href="#key-features-operators_str">1.4. Operators</a></li>
<li><a href="#document-conventions-str">1.5. Document Conventions</a></li>
</ul>
</li>
<li><a href="#assembly-evaluation-str">2. Evaluate Strimzi</a>
<ul class="sectlevel2">
<li><a href="#ref-install-prerequisites-str">2.1. Prerequisites</a></li>
<li><a href="#proc-product-downloads-str">2.2. Downloading Strimzi</a></li>
<li><a href="#proc-install-product-str">2.3. Installing Strimzi</a></li>
<li><a href="#proc-kafka-cluster-str">2.4. Creating a cluster</a></li>
<li><a href="#proc-using-amq-streams-str">2.5. Sending and receiving messages from a topic</a></li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="overview-str"><a class="link" href="#overview-str">1. Overview of Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strimzi simplifies the process of running Apache Kafka in a Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>This guide provides instructions for evaluating a working environment of Strimzi.
The steps describe how to get a Strimzi deployment up-and-running as quickly as possible.</p>
</div>
<div class="paragraph">
<p>Before trying Strimzi, it is useful to understand its capabilities and how you might wish to use it.
This chapter introduces some of the key concepts behind Kafka, and also provides a brief overview of the Strimzi Operators.</p>
</div>
<div class="paragraph">
<p>Operators are a method of packaging, deploying, and managing a Kubernetes application.
Strimzi Operators extend Kubernetes functionality, automating common and complex tasks related to a Kafka deployment.
By implementing knowledge of Kafka operations in code, Kafka administration tasks are simplified and require less manual intervention.</p>
</div>
<div class="sect2">
<h3 id="key-features-kafka_str"><a class="link" href="#key-features-kafka_str">1.1. Kafka capabilities</a></h3>
<div class="paragraph">
<p>The underlying data stream-processing capabilities and component architecture of Kafka can deliver:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Microservices and other applications to share data with extremely high throughput and low latency</p>
</li>
<li>
<p>Message ordering guarantees</p>
</li>
<li>
<p>Message rewind/replay from data storage to reconstruct an application state</p>
</li>
<li>
<p>Message compaction to remove old records when using a key-value log</p>
</li>
<li>
<p>Horizontal scalability in a cluster configuration</p>
</li>
<li>
<p>Replication of data to control fault tolerance</p>
</li>
<li>
<p>Retention of high volumes of data for immediate access</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kafka_use_cases"><a class="link" href="#kafka_use_cases">1.2. Kafka use cases</a></h3>
<div class="paragraph">
<p>Kafka&#8217;s capabilities make it suitable for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Event-driven architectures</p>
</li>
<li>
<p>Event sourcing to capture changes to the state of an application as a log of events</p>
</li>
<li>
<p>Message brokering</p>
</li>
<li>
<p>Website activity tracking</p>
</li>
<li>
<p>Operational monitoring through metrics</p>
</li>
<li>
<p>Log collection and aggregation</p>
</li>
<li>
<p>Commit logs for distributed systems</p>
</li>
<li>
<p>Stream processing so that applications can respond to data in real time</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="key-features-product_str"><a class="link" href="#key-features-product_str">1.3. How Strimzi supports Kafka</a></h3>
<div class="paragraph">
<p>Strimzi provides container images and Operators for running Kafka on Kubernetes.
Strimzi Operators are fundamental to the running of Strimzi.
The Operators provided with Strimzi are purpose-built with specialist operational knowledge to effectively manage Kafka.</p>
</div>
<div class="paragraph">
<p>Operators simplify the process of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploying and running Kafka clusters</p>
</li>
<li>
<p>Deploying and running Kafka components</p>
</li>
<li>
<p>Configuring access to Kafka</p>
</li>
<li>
<p>Securing access to Kafka</p>
</li>
<li>
<p>Upgrading Kafka</p>
</li>
<li>
<p>Managing brokers</p>
</li>
<li>
<p>Creating and managing topics</p>
</li>
<li>
<p>Creating and managing users</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="key-features-operators_str"><a class="link" href="#key-features-operators_str">1.4. Operators</a></h3>
<div class="paragraph">
<p>Strimzi provides Operators for managing a Kafka cluster running within a Kubernetes cluster.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Cluster Operator</dt>
<dd>
<p>Deploys and manages Apache Kafka clusters, Kafka Connect, Kafka MirrorMaker, Kafka Bridge, Kafka Exporter, Cruise Control, and the Entity Operator</p>
</dd>
<dt class="hdlist1">Entity Operator</dt>
<dd>
<p>Comprises the Topic Operator and User Operator</p>
</dd>
<dt class="hdlist1">Topic Operator</dt>
<dd>
<p>Manages Kafka topics</p>
</dd>
<dt class="hdlist1">User Operator</dt>
<dd>
<p>Manages Kafka users</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Cluster Operator can deploy the Topic Operator and User Operator as part of an <strong>Entity Operator</strong> configuration at the same time as a Kafka cluster.</p>
</div>
<div class="paragraph">
<div class="title">Operators within the Strimzi architecture</div>
<p><span class="image"><img src="images/operators.png" alt="Operators within the Strimzi architecture"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="document-conventions-str"><a class="link" href="#document-conventions-str">1.5. Document Conventions</a></h3>
<div class="paragraph">
<div class="title">User-replaced values</div>
<p>User-replaced values, also known as <em>replaceables</em>, are shown in <em>italics</em> with angle brackets (&lt; &gt;).
Underscores ( _ ) are used for multi-word values.
If the value refers to code or commands, <code>monospace</code> is also used.</p>
</div>
<div class="paragraph">
<p>For example, in the following code, you will want to replace <code><em>&lt;my_namespace&gt;</em></code> with the name of your namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: <em>&lt;my_namespace&gt;</em>/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-evaluation-str"><a class="link" href="#assembly-evaluation-str">2. Evaluate Strimzi</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The procedures in this chapter provide a quick way to evaluate the functionality of Strimzi.</p>
</div>
<div class="paragraph">
<p>Follow the steps in the order provided to install Strimzi, and start sending and receiving messages from a topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure you have the required prerequisites</p>
</li>
<li>
<p>Install and start Minikube</p>
</li>
<li>
<p>Install Strimzi</p>
</li>
<li>
<p>Create a Kafka cluster</p>
</li>
<li>
<p>Access the Kafka cluster to send and receive messages</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ref-install-prerequisites-str"><a class="link" href="#ref-install-prerequisites-str">2.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/">Install and start Minikube</a>.</p>
</li>
<li>
<p>You need to be able to access the <a href="https://github.com/strimzi/strimzi-kafka-operator/releases" target="_blank" rel="noopener">GitHub releases page</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-product-downloads-str"><a class="link" href="#proc-product-downloads-str">2.2. Downloading Strimzi</a></h3>
<div class="paragraph">
<p>The resources and artifacts required to install Strimzi, along with examples for configuration, are provided in a ZIP file.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the <code>strimzi-<em>&lt;version&gt;</em>.zip</code> file from the <a href="https://github.com/strimzi/strimzi-kafka-operator/releases" target="_blank" rel="noopener">GitHub releases page</a>.</p>
</li>
<li>
<p>Unzip the file to any destination.</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Windows or Mac: Extract the contents of the ZIP archive by double-clicking on the ZIP file.</p>
</li>
<li>
<p>Linux: Open a terminal window in the target machine and navigate to where the ZIP file was downloaded.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Extract the ZIP file with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">unzip strimzi-<em>&lt;version&gt;</em>.zip</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-install-product-str"><a class="link" href="#proc-install-product-str">2.3. Installing Strimzi</a></h3>
<div class="paragraph">
<p>Using the <a href="#proc-product-downloads-str">download files</a>, install Strimzi with the Custom Resource Definitions (CRDs) and RBAC configuration required for deployment.</p>
</div>
<div class="paragraph">
<p>In this task you create namespaces in the cluster for your deployment.
Use namespaces to separate functions.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Installation requires a Kubernetes account with cluster admin credentials.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Kubernetes cluster using an account that has cluster admin privileges.</p>
</li>
<li>
<p>Create a new <code>kafka</code> namespace for the Strimzi Kafka Cluster Operator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create ns kafka</code></pre>
</div>
</div>
</li>
<li>
<p>Modify the installation files to reference the <code>kafka</code> namespace where you will install the Strimzi Kafka Cluster Operator.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, the files work in the <code>myproject</code> namespace.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>On Linux, use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sed -i 's/namespace: .*/namespace: kafka/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>On Mac, use:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">sed -i '' 's/namespace: .*/namespace: kafka/' install/cluster-operator/*RoleBinding*.yaml</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Create a new <code>my-kafka-project</code> namespace where you will deploy your Kafka cluster.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create ns my-kafka-project</code></pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>install/cluster-operator/060-Deployment-strimzi-cluster-operator.yaml</code> file and set the <code>STRIMZI_NAMESPACE</code> environment variable to the namespace <code>my-kafka-project</code>.
Change the environment variable configuration from this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
env:
- name: STRIMZI_NAMESPACE
  valueFrom:
    fieldRef:
      fieldPath: metadata.namespace
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
env:
- name: STRIMZI_NAMESPACE
  value: my-kafka-project
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Give permission to the Cluster Operator to watch the <code>my-kafka-project</code> namespace.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/020-RoleBinding-strimzi-cluster-operator.yaml -n my-kafka-project</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/023-RoleBinding-strimzi-cluster-operator.yaml -n my-kafka-project</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/031-RoleBinding-strimzi-cluster-operator-entity-operator-delegation.yaml -n my-kafka-project</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The commands create role bindings that grant permission for the Cluster Operator to access the Kafka cluster.</p>
</div>
</li>
<li>
<p>Deploy the CRDs and role-based access control (RBAC) resources to manage the CRDs.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install/cluster-operator/ -n kafka</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-kafka-cluster-str"><a class="link" href="#proc-kafka-cluster-str">2.4. Creating a cluster</a></h3>
<div class="paragraph">
<p>With Strimzi installed, you create a Kafka cluster, then a topic within the cluster.</p>
</div>
<div class="paragraph">
<p>When you create a cluster, the Cluster Operator you deployed when installing Strimzi watches for new Kafka resources.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>For the Kafka cluster, ensure a Cluster Operator is deployed.</p>
</li>
<li>
<p>For the topic, you must have a running Kafka cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Kubernetes cluster as a non-privileged user.</p>
</li>
<li>
<p>Create a new <code>my-cluster</code> Kafka cluster with one ZooKeeper and one Kafka broker.</p>
<div class="ulist">
<ul>
<li>
<p>Use <code>persistent-claim</code> storage</p>
</li>
<li>
<p>Expose the Kafka cluster outside of the Kubernetes cluster using an external listener configured to use a <code>nodeport</code>.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt; EOF | kubectl create -n my-kafka-project -f -
apiVersion: kafka.strimzi.io/v1beta2
kind: Kafka
metadata:
  name: my-cluster
spec:
  kafka:
    replicas: 1
    listeners:
      - name: plain
        port: 9092
        type: internal
        tls: false
      - name: tls
        port: 9093
        type: internal
        tls: true
        authentication:
          type: tls
      - name: external
        port: 9094
        type: nodeport
        tls: false
    storage:
      type: jbod
      volumes:
      - id: 0
        type: persistent-claim
        size: 100Gi
        deleteClaim: false
    config:
      offsets.topic.replication.factor: 1
      transaction.state.log.replication.factor: 1
      transaction.state.log.min.isr: 1
      default.replication.factor: 1
      min.insync.replicas: 1
  zookeeper:
    replicas: 1
    storage:
      type: persistent-claim
      size: 100Gi
      deleteClaim: false
  entityOperator:
    topicOperator: {}
    userOperator: {}
EOF</code></pre>
</div>
</div>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Wait for the cluster to be deployed:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl wait kafka/my-cluster --for=condition=Ready --timeout=300s -n my-kafka-project</code></pre>
</div>
</div>
</li>
<li>
<p>When your cluster is ready, create a topic to publish and subscribe from your external client.</p>
<div class="paragraph">
<p>Create the following <code>my-topic</code> custom resource definition with 3 partitions and replication factor 1 in the <code>my-cluster</code> Kafka cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">cat &lt;&lt; EOF | kubectl create -n my-kafka-project -f -
apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: "my-cluster"
spec:
  partitions: 3
  replicas: 1
EOF</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-using-amq-streams-str"><a class="link" href="#proc-using-amq-streams-str">2.5. Sending and receiving messages from a topic</a></h3>
<div class="paragraph">
<p>You can test your Strimzi installation by sending and receiving messages to <code>my-topic</code> from outside the cluster.</p>
</div>
<div class="paragraph">
<p>Use a terminal to run a Kafka producer and consumer on a local machine.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure Strimzi is installed on the Kubernetes cluster.</p>
</li>
<li>
<p>ZooKeeper and Kafka must be running to be able to send and receive messages.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the latest Kafka binaries and install Kafka on your local machine.</p>
<div class="paragraph">
<p><a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka download</a></p>
</div>
</li>
<li>
<p>Find the port of the bootstrap service:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">kubectl get service my-cluster-kafka-external-bootstrap -n my-kafka-project -o=jsonpath='{.spec.ports[0].nodePort}{"\n"}'</code></pre>
</div>
</div>
</li>
<li>
<p>Find the IP address of the Minikube node:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-shell hljs" data-lang="shell">kubectl get nodes --output=jsonpath='{range .items[*]}{.status.addresses[?(@.type=="InternalIP")].address}{"\n"}{end}'</code></pre>
</div>
</div>
</li>
<li>
<p>Open a terminal, and start the Kafka console producer with the topic <code>my-topic</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-console-producer.sh --bootstrap-server <em>&lt;node-address&gt;</em>:_&lt;node-port&gt;_ --topic my-topic</code></pre>
</div>
</div>
</li>
<li>
<p>Type your message into the console where the producer is running.</p>
</li>
<li>
<p>Open a new terminal tab or window, and start the consumer to receive the messages:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">bin/kafka-console-consumer.sh --bootstrap-server <em>&lt;node-address&gt;</em>:_&lt;node-port&gt;_ --topic my-topic --from-beginning</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that you see the incoming messages in the consumer console.</p>
</li>
<li>
<p>Press Crtl+C to exit the Kafka console producer and consumer.</p>
</li>
</ol>
</div>
</div>
</div>
</div>